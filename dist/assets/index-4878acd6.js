var p1=Object.defineProperty;var m1=(M,f,A)=>f in M?p1(M,f,{enumerable:!0,configurable:!0,writable:!0,value:A}):M[f]=A;var co=(M,f,A)=>(m1(M,typeof f!="symbol"?f+"":f,A),A);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))D(R);new MutationObserver(R=>{for(const z of R)if(z.type==="childList")for(const V of z.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&D(V)}).observe(document,{childList:!0,subtree:!0});function A(R){const z={};return R.integrity&&(z.integrity=R.integrity),R.referrerPolicy&&(z.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?z.credentials="include":R.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function D(R){if(R.ep)return;R.ep=!0;const z=A(R);fetch(R.href,z)}})();document.addEventListener("click",function(M){try{let c=function(g,C){return g.nodeName===C?g:c(g.parentNode,C)},_=function(g,C){g.classList.remove("dir-d"),g.classList.remove("dir-u"),C&&g.classList.add(C)},w=function(g){return f&&g.dataset.sortAlt||g.dataset.sort||g.textContent};var f=M.shiftKey||M.altKey,A=c(M.target,"TH"),D=c(A,"TR"),R=c(D,"TABLE");if(R.classList.contains("sortable")){var z,V=D.cells,t=parseInt(A.dataset.sortTbr);for(M=0;M<V.length;M++)V[M]===A?z=parseInt(A.dataset.sortCol)||M:_(V[M],"");V="dir-d",(A.classList.contains("dir-d")||R.classList.contains("asc")&&!A.classList.contains("dir-u"))&&(V="dir-u"),_(A,V);var l=V==="dir-u",v=function(g,C,L){var B=w((l?g:C).cells[L]);return g=w((l?C:g).cells[L]),C=parseFloat(B)-parseFloat(g),isNaN(C)?B.localeCompare(g):C};for(M=0;M<R.tBodies.length;M++){var x=R.tBodies[M],d=[].slice.call(x.rows,0);d.sort(function(g,C){var L=v(g,C,z);return L!==0||isNaN(t)?L:v(g,C,t)});var m=x.cloneNode();m.append.apply(m,d),R.replaceChild(m,x)}}}catch{}});var Jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mp(M){return M&&M.__esModule&&Object.prototype.hasOwnProperty.call(M,"default")?M.default:M}function x_(M){if(M.__esModule)return M;var f=M.default;if(typeof f=="function"){var A=function D(){if(this instanceof D){var R=[null];R.push.apply(R,arguments);var z=Function.bind.apply(f,R);return new z}return f.apply(this,arguments)};A.prototype=f.prototype}else A={};return Object.defineProperty(A,"__esModule",{value:!0}),Object.keys(M).forEach(function(D){var R=Object.getOwnPropertyDescriptor(M,D);Object.defineProperty(A,D,R.get?R:{enumerable:!0,get:function(){return M[D]}})}),A}var b_={exports:{}};(function(M,f){(function(A,D){M.exports=D()})(Jc,function(){var A,D,R;function z(t,l){if(!A)A=l;else if(!D)D=l;else{var v="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+A+")(sharedChunk); ("+D+")(sharedChunk); self.onerror = null;",x={};A(x),R=l(x),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(R.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}z(["exports"],function(t){var l=typeof self<"u"?self:{},v="2.15.0";let x;const d={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(x==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{x={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{x=i}}return x},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!d.API_URL)return null;try{const i=new URL(d.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},m={supported:!1,testSupport:function(i){!w&&_&&(g?C(i):c=i)}};let c,_,w=!1,g=!1;function C(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,_),i.isContextLost())return;m.supported=!0}catch{}i.deleteTexture(e),w=!0}l.document&&(_=l.document.createElement("img"),_.onload=function(){c&&C(c),c=null,g=!0},_.onerror=function(){w=!0,c=null},_.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const L="01";function B(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var q=K;function K(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}K.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var a=this.sampleCurveX(n)-i;if(Math.abs(a)<e)return n;var p=this.sampleCurveDerivativeX(n);if(Math.abs(p)<1e-6)break;n-=a/p}var y=0,T=1;for(n=i,s=0;s<20&&(a=this.sampleCurveX(n),!(Math.abs(a-i)<e));s++)i>a?y=n:T=n,n=.5*(T-y)+y;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var se=B(q),he=le;function le(i,e){this.x=i,this.y=e}le.prototype={clone:function(){return new le(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),a=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},le.convert=function(i){return i instanceof le?i:Array.isArray(i)?new le(i[0],i[1]):i};var ve=B(he);const ot=Math.PI/180,_e=180/Math.PI;function pe(i){return i*ot}function ze(i){return i*_e}const De=[[0,0],[1,0],[1,1],[0,1]];function at(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function ft(i,e,n,s){const a=new se(i,e,n,s);return function(p){return a.solve(p)}}const xt=ft(.25,.1,.25,1);function He(i,e,n){return Math.min(n,Math.max(e,i))}function ae(i,e,n){return(n=He((n-i)/(e-i),0,1))*n*(3-2*n)}function Te(i,e,n){const s=n-e,a=((i-e)%s+s)%s+e;return a===e?n:a}function Oe(i,e,n){if(!i.length)return n(null,[]);let s=i.length;const a=new Array(i.length);let p=null;i.forEach((y,T)=>{e(y,(P,O)=>{P&&(p=P),a[T]=O,--s==0&&n(p,a)})})}function Y(i){const e=[];for(const n in i)e.push(i[n]);return e}function ce(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}let re=1;function te(){return re++}function we(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ke(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function We(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function qe(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function gt(i,e){return i.indexOf(e,i.length-e.length)!==-1}function lt(i,e,n){const s={};for(const a in i)s[a]=e.call(n||this,i[a],a,i);return s}function Bt(i,e,n){const s={};for(const a in i)e.call(n||this,i[a],a,i)&&(s[a]=i[a]);return s}function ht(i){return Array.isArray(i)?i.map(ht):typeof i=="object"&&i?lt(i,ht):i}const ct={};function Xe(i){ct[i]||(typeof console<"u"&&console.warn(i),ct[i]=!0)}function Se(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function At(i){let e=0;for(let n,s,a=0,p=i.length,y=p-1;a<p;y=a++)n=i[a],s=i[y],e+=(s.x-n.x)*(n.y+s.y);return e}function Et(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,a,p)=>{const y=a||p;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Kt=null;function $t(i){if(Kt==null){const e=i.navigator?i.navigator.userAgent:null;Kt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Kt}function yt(i){try{const e=l[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ri(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const mi="mapbox-tiles";let xi=500,Li=50,Ue,ge;function Rt(){try{return l.caches}catch{}}function si(){Rt()&&!Ue&&(Ue=l.caches.open(mi))}function jt(i){const e=i.indexOf("?");if(e<0)return i;const n=function(a){const p=a.indexOf("?");return p>0?a.slice(p+1).split("&"):[]}(i),s=n.filter(a=>{const p=a.split("=");return p[0]==="language"||p[0]==="worldview"});return s.length?`${i.slice(0,e)}?${s.join("&")}`:i.slice(0,e)}let Ii=1/0;const wi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(wi);class or extends Error{constructor(e,n,s){n===401&&dt(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ti=Et()?()=>self.worker&&self.worker.referrer:()=>(l.location.protocol==="blob:"?l.parent:l).location.href,Yi=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(Ti())&&!/^\w+:/.test(n))){if(l.fetch&&l.Request&&l.AbortController&&l.Request.prototype.hasOwnProperty("signal"))return function(s,a){const p=new l.AbortController,y=new l.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Ti(),referrerPolicy:s.referrerPolicy,signal:p.signal});let T=!1,P=!1;const O=(j=y.url).indexOf("sku=")>0&&dt(j);var j;s.type==="json"&&y.headers.set("Accept","application/json");const G=(Z,Q,ne)=>{if(P)return;if(Z&&Z.message!=="SecurityError"&&Xe(Z.toString()),Q&&ne)return $(Q);const Ae=Date.now();l.fetch(y).then(Fe=>{if(Fe.ok){const Je=O?Fe.clone():null;return $(Fe,Je,Ae)}return a(new or(Fe.statusText,Fe.status,s.url))}).catch(Fe=>{Fe.name!=="AbortError"&&a(new Error(`${Fe.message} ${s.url}`))})},$=(Z,Q,ne)=>{(s.type==="arrayBuffer"?Z.arrayBuffer():s.type==="json"?Z.json():Z.text()).then(Ae=>{P||(Q&&ne&&function(Fe,Je,Be){if(si(),!Ue)return;const Ze={status:Je.status,statusText:Je.statusText,headers:new l.Headers};Je.headers.forEach((Ot,kt)=>Ze.headers.set(kt,Ot));const nt=wt(Je.headers.get("Cache-Control")||"");if(nt["no-store"])return;nt["max-age"]&&Ze.headers.set("Expires",new Date(Be+1e3*nt["max-age"]).toUTCString());const rt=Ze.headers.get("Expires");rt&&(new Date(rt).getTime()-Be<42e4||function(Ot,kt){if(ge===void 0)try{new Response(new ReadableStream),ge=!0}catch{ge=!1}ge?kt(Ot.body):Ot.blob().then(kt)}(Je,Ot=>{const kt=new l.Response(Ot,Ze);si(),Ue&&Ue.then(Ht=>Ht.put(jt(Fe.url),kt)).catch(Ht=>Xe(Ht.message))}))}(y,Q,ne),T=!0,a(null,Ae,Z.headers.get("Cache-Control"),Z.headers.get("Expires")))}).catch(Ae=>{P||a(new Error(Ae.message))})};return O?function(Z,Q){if(si(),!Ue)return Q(null);const ne=jt(Z.url);Ue.then(Ae=>{Ae.match(ne).then(Fe=>{const Je=function(Be){if(!Be)return!1;const Ze=new Date(Be.headers.get("Expires")||0),nt=wt(Be.headers.get("Cache-Control")||"");return Ze>Date.now()&&!nt["no-cache"]}(Fe);Ae.delete(ne),Je&&Ae.put(ne,Fe.clone()),Q(null,Fe,Je)}).catch(Q)}).catch(Q)}(y,G):G(null,null),{cancel:()=>{P=!0,T||p.abort()}}}(i,e);if(Et()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(s,a){const p=new l.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const y in s.headers)p.setRequestHeader(y,s.headers[y]);return s.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=s.credentials==="include",p.onerror=()=>{a(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let y=p.response;if(s.type==="json")try{y=JSON.parse(p.response)}catch(T){return a(T)}a(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else a(new or(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(i,e)},qr=function(i,e){return Yi(ce(i,{type:"arrayBuffer"}),e)};function Hi(i){const e=l.document.createElement("a");return e.href=i,e.protocol===l.document.location.protocol&&e.host===l.document.location.host}const je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let oe,fe;oe=[],fe=0;const Ve=function(i,e){if(m.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),fe>=d.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return oe.push(p),p}fe++;let n=!1;const s=()=>{if(!n)for(n=!0,fe--;oe.length&&fe<d.MAX_PARALLEL_IMAGE_REQUESTS;){const p=oe.shift(),{requestParameters:y,callback:T,cancelled:P}=p;P||(p.cancel=Ve(y,T).cancel)}},a=qr(i,(p,y,T,P)=>{s(),p?e(p):y&&(l.createImageBitmap?function(O,j){const G=new l.Blob([new Uint8Array(O)],{type:"image/png"});l.createImageBitmap(G).then($=>{j(null,$)}).catch($=>{j(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(O,j)=>e(O,j,T,P)):function(O,j){const G=new l.Image,$=l.URL;G.onload=()=>{j(null,G),$.revokeObjectURL(G.src),G.onload=null,l.requestAnimationFrame(()=>{G.src=je})},G.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new l.Blob([new Uint8Array(O)],{type:"image/png"});G.src=O.byteLength?$.createObjectURL(Z):je}(y,(O,j)=>e(O,j,T,P)))});return{cancel:()=>{a.cancel(),s()}}},Ke="NO_ACCESS_TOKEN";function $e(i){return i.indexOf("mapbox:")===0}function dt(i){return d.API_URL_REGEX.test(i)}function bt(i){return d.API_CDN_URL_REGEX.test(i)}function st(i){return d.API_STYLE_REGEX.test(i)&&!Dt(i)}function Dt(i){return d.API_SPRITE_REGEX.test(i)}const ti=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Vt(i){const e=i.match(ti);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ni(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}const Ui="mapbox.eventData";function Vi(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(l.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ki{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Vi(d.ACCESS_TOKEN);let s="";return s=n&&n.u?l.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,p)=>String.fromCharCode(+("0x"+p)))):d.ACCESS_TOKEN||"",e?`${Ui}.${e}:${s}`:`${Ui}:${s}`}fetchEventData(){const e=yt("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const a=l.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const p=l.localStorage.getItem(s);p&&(this.anonId=p)}catch{Xe("Unable to read from LocalStorage")}}saveEventData(){const e=yt("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{l.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&l.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Xe("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,a){if(!d.EVENTS_URL)return;const p=Vt(d.EVENTS_URL);p.params.push(`access_token=${a||d.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},T=n?ce(y,n):y,P={url:ni(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=function(O,j){return Yi(ce(O,{method:"POST"}),j)}(P,O=>{this.pendingRequest=null,s(O),this.saveEventData(),this.processRequests(a)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Fi=new class extends ki{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){d.EVENTS_URL&&d.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>$e(n)||dt(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Vi(d.ACCESS_TOKEN),n=e?e.u:d.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;We(this.anonId)||(this.anonId=we(),s=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),y=new Date(a),T=(a-this.eventData.lastSuccess)/864e5;s=s||T>=1||T<-1||p.getDate()!==y.getDate()}else s=!0;s?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:L,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},i):this.processRequests()}},Wi=Fi.postTurnstileEvent.bind(Fi),Ar=new class extends ki{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,s){this.skuToken=e,this.errorCb=s,d.EVENTS_URL&&(n||d.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ke)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),We(this.anonId)||(this.anonId=we()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:L,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i))}},Pr=Ar.postMapLoadEvent.bind(Ar),kr=new class extends ki{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){d.EVENTS_URL&&(i||d.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(a){const p=l.performance.getEntriesByType("resource"),y=l.performance.getEntriesByType("mark"),T=function($){const Z={};if($){for(const Q in $)if(Q!=="other")for(const ne of $[Q]){const Ae=`${Q}ResolveRangeMin`,Fe=`${Q}ResolveRangeMax`,Je=`${Q}RequestCount`,Be=`${Q}RequestCachedCount`;Z[Ae]=Math.min(Z[Ae]||1/0,ne.startTime),Z[Fe]=Math.max(Z[Fe]||-1/0,ne.responseEnd);const Ze=nt=>{Z[nt]===void 0&&(Z[nt]=0),++Z[nt]};ne.transferSize!==void 0&&ne.transferSize===0&&Ze(Be),Ze(Je)}}return Z}(function($,Z){const Q={};if($)for(const ne of $){const Ae=Z(ne);Q[Ae]===void 0&&(Q[Ae]=[]),Q[Ae].push(ne)}return Q}(p,Hs)),P=l.devicePixelRatio,O=l.navigator.connection||l.navigator.mozConnection||l.navigator.webkitConnection,j={counters:[],metadata:[],attributes:[]},G=($,Z,Q)=>{Q!=null&&$.push({name:Z,value:Q.toString()})};for(const $ in T)G(j.counters,$,T[$]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(G(j.counters,"interactionRangeMin",a.interactionRange[0]),G(j.counters,"interactionRangeMax",a.interactionRange[1])),y)for(const $ of Object.keys(Bn)){const Z=Bn[$],Q=y.find(ne=>ne.name===Z);Q&&G(j.counters,Z,Q.startTime)}return G(j.counters,"visibilityHidden",a.visibilityHidden),G(j.attributes,"style",function($){if($)for(const Z of $){const Q=Z.name.split("?")[0];if(st(Q)){const ne=Q.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(p)),G(j.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),G(j.attributes,"fogEnabled",a.fogEnabled?"true":"false"),G(j.attributes,"projection",a.projection),G(j.attributes,"zoom",a.zoom),G(j.metadata,"devicePixelRatio",P),G(j.metadata,"connectionEffectiveType",O?O.effectiveType:void 0),G(j.metadata,"navigatorUserAgent",l.navigator.userAgent),G(j.metadata,"screenWidth",l.screen.width),G(j.metadata,"screenHeight",l.screen.height),G(j.metadata,"windowWidth",l.innerWidth),G(j.metadata,"windowHeight",l.innerHeight),G(j.metadata,"mapWidth",a.width/P),G(j.metadata,"mapHeight",a.height/P),G(j.metadata,"webglRenderer",a.renderer),G(j.metadata,"webglVendor",a.vendor),G(j.metadata,"sdkVersion",v),G(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(n);for(const a of s.metadata);for(const a of s.counters);for(const a of s.attributes);this.postEvent(e,s,()=>{},i)}},Sr=kr.postPerformanceEvent.bind(kr),un=new class extends ki{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,s){if(!d.API_URL||!d.SESSION_PATH)return;const a=Vt(d.API_URL+d.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${s||d.ACCESS_TOKEN||""}`);const p={url:ni(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,T){return Yi(ce(y,{method:"GET"}),T)}(p,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(s)})}getSessionAPI(i,e,n,s){this.skuToken=e,this.errorCb=s,d.SESSION_PATH&&d.API_URL&&(n||d.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ke)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i)}},Or=un.getSessionAPI.bind(un),Fr=new Set,Bn={create:"create",load:"load",fullLoad:"fullLoad"},Io={mark(i){l.performance.mark(i)},measure(i,e,n){l.performance.measure(i,e,n)}};function Hs(i){const e=i.name.split("?")[0];return bt(e)&&e.includes("mapbox-gl.js")?"javascript":bt(e)&&e.includes("mapbox-gl.css")?"css":function(n){return d.API_FONTS_REGEX.test(n)}(e)?"fontRange":Dt(e)?"sprite":st(e)?"style":function(n){return d.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}const hr=l.performance;function $s(i){const e=i?i.url.toString():void 0;return hr.getEntriesByName(e)}let kn,Qo,ko,cs;const Gn={now:()=>ko!==void 0?ko:l.performance.now(),setNow(i){ko=i},restoreNow(){ko=void 0},frame(i){const e=l.requestAnimationFrame(i);return{cancel:()=>l.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:n,height:s}=i;cs||(cs=l.document.createElement("canvas"));const a=cs.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>cs.width||s>cs.height)&&(cs.width=n,cs.height=s),a.clearRect(-e,-e,n+2*e,s+2*e),a.drawImage(i,0,0,n,s),a.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:i=>(kn||(kn=l.document.createElement("a")),kn.href=i,kn.href),get devicePixelRatio(){return l.devicePixelRatio},get prefersReducedMotion(){return!!l.matchMedia&&(Qo==null&&(Qo=l.matchMedia("(prefers-reduced-motion: reduce)")),Qo.matches)}};function ea(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Do(i,e,n){if(n&&n[i]){const s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class Qn{constructor(e,n={}){ce(this,n),this.type=e}}class bs extends Qn{constructor(e,n={}){super("error",ce({error:e},n))}}class fo{on(e,n){return this._listeners=this._listeners||{},ea(e,n,this._listeners),this}off(e,n){return Do(e,n,this._listeners),Do(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ea(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new Qn(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const a=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const T of a)T.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const T of p)Do(s,T,this._oneTimeListeners),T.call(this,e);const y=this._eventedParent;y&&(ce(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof bs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wn(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}function Gr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ur(i){if(Array.isArray(i))return i.map(ur);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=ur(i[n]);return e}return Gr(i)}class Ys extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var br=Ys;class Zs{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,a]of n)this.bindings[s]=a}concat(e){return new Zs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var po=Zs;const Ks={kind:"null"},di={kind:"number"},Zi={kind:"string"},ji={kind:"boolean"},tn={kind:"color"},Nn={kind:"object"},Ki={kind:"value"},mn={kind:"collator"},Oo={kind:"formatted"},Es={kind:"resolvedImage"};function jn(i,e){return{kind:"array",itemType:i,N:e}}function Er(i){if(i.kind==="array"){const e=Er(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ma=[Ks,di,Zi,ji,tn,Oo,Nn,jn(Ki),Es];function ws(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ws(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of ma)if(!ws(n,e))return null}}return`Expected ${Er(i)} but found ${Er(e)} instead.`}function Fo(i,e){return e.some(n=>n.kind===i.kind)}function es(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}var Ss,it={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vt(i){return(i=Math.round(i))<0?0:i>255?255:i}function Lt(i){return vt(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function li(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function _i(i,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(e-i)*n*6:2*n<1?e:3*n<2?i+(e-i)*(2/3-n)*6:i}try{Ss={}.parseCSSColor=function(i){var e,n=i.replace(/ /g,"").toLowerCase();if(n in it)return it[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),a=n.indexOf(")");if(s!==-1&&a+1===n.length){var p=n.substr(0,s),y=n.substr(s+1,a-(s+1)).split(","),T=1;switch(p){case"rgba":if(y.length!==4)return null;T=li(y.pop());case"rgb":return y.length!==3?null:[Lt(y[0]),Lt(y[1]),Lt(y[2]),T];case"hsla":if(y.length!==4)return null;T=li(y.pop());case"hsl":if(y.length!==3)return null;var P=(parseFloat(y[0])%360+360)%360/360,O=li(y[1]),j=li(y[2]),G=j<=.5?j*(O+1):j+O-j*O,$=2*j-G;return[vt(255*_i($,G,P+1/3)),vt(255*_i($,G,P)),vt(255*_i($,G,P-1/3)),T];default:return null}}return null}}catch{}class Yt{constructor(e,n,s,a=1){this.r=e,this.g=n,this.b=s,this.a=a}static parse(e){if(!e)return;if(e instanceof Yt)return e;if(typeof e!="string")return;const n=Ss(e);return n?new Yt(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${a})`}toArray(){const{r:e,g:n,b:s,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*n/a,255*s/a,a]}toArray01(){const{r:e,g:n,b:s,a}=this;return a===0?[0,0,0,0]:[e/a,n/a,s/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a}=this;return[e,n,s,a]}}Yt.black=new Yt(0,0,0,1),Yt.white=new Yt(1,1,1,1),Yt.transparent=new Yt(0,0,0,0),Yt.red=new Yt(1,0,0,1),Yt.blue=new Yt(0,0,1,1);var Mi=Yt;class Di{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gr{constructor(e,n,s,a,p){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=a,this.textColor=p}}class ar{constructor(e){this.sections=e}static fromString(e){return new ar([new gr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ar?e:ar.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class pr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new pr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Mr(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fr(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Mi||i instanceof Di||i instanceof ar||i instanceof pr)return!0;if(Array.isArray(i)){for(const e of i)if(!fr(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!fr(i[e]))return!1;return!0}return!1}function ir(i){if(i===null)return Ks;if(typeof i=="string")return Zi;if(typeof i=="boolean")return ji;if(typeof i=="number")return di;if(i instanceof Mi)return tn;if(i instanceof Di)return mn;if(i instanceof ar)return Oo;if(i instanceof pr)return Es;if(Array.isArray(i)){const e=i.length;let n;for(const s of i){const a=ir(s);if(n){if(n===a)continue;n=Ki;break}n=a}return jn(n||Ki,e)}return Nn}function nn(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Mi||i instanceof ar||i instanceof pr?i.toString():JSON.stringify(i)}class sn{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!fr(e[1]))return n.error("invalid value");const s=e[1];let a=ir(s);const p=n.expectedType;return a.kind!=="array"||a.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(a=p),new sn(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mi?["rgba"].concat(this.value.toArray()):this.value instanceof ar?this.value.serialize():this.value}}var zr=sn,Wr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const hs={string:Zi,number:di,boolean:ji,object:Nn};class zo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,a=1;const p=e[0];if(p==="array"){let T,P;if(e.length>2){const O=e[1];if(typeof O!="string"||!(O in hs)||O==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=hs[O],a++}else T=Ki;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);P=e[2],a++}s=jn(T,P)}else s=hs[p];const y=[];for(;a<e.length;a++){const T=n.parse(e[a],a,Ki);if(!T)return null;y.push(T)}return new zo(s,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!ws(this.type,ir(s)))return s;if(n===this.args.length-1)throw new Wr(`Expected value to be of type ${Er(this.type)}, but found ${Er(ir(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(s=>s.serialize()))}}var Dn=zo;class Xn{constructor(e){this.type=Oo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const a=[];let p=!1;for(let y=1;y<=e.length-1;++y){const T=e[y];if(p&&typeof T=="object"&&!Array.isArray(T)){p=!1;let P=null;if(T["font-scale"]&&(P=n.parse(T["font-scale"],1,di),!P))return null;let O=null;if(T["text-font"]&&(O=n.parse(T["text-font"],1,jn(Zi)),!O))return null;let j=null;if(T["text-color"]&&(j=n.parse(T["text-color"],1,tn),!j))return null;const G=a[a.length-1];G.scale=P,G.font=O,G.textColor=j}else{const P=n.parse(e[y],1,Ki);if(!P)return null;const O=P.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,a.push({content:P,scale:null,font:null,textColor:null})}}return new Xn(a)}evaluate(e){return new ar(this.sections.map(n=>{const s=n.content.evaluate(e);return ir(s)===Es?new gr("",s,null,null,null):new gr(nn(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Ps{constructor(e){this.type=Es,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Zi);return s?new Ps(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=pr.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ga={"to-boolean":ji,"to-color":tn,"to-number":di,"to-string":Zi};class Ka{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const a=ga[s],p=[];for(let y=1;y<e.length;y++){const T=n.parse(e[y],y,Ki);if(!T)return null;p.push(T)}return new Ka(a,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,s;for(const a of this.args){if(n=a.evaluate(e),s=null,n instanceof Mi)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Mr(n[0],n[1],n[2],n[3]),!s))return new Mi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Wr(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const a=Number(n);if(!isNaN(a))return a}throw new Wr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ar.fromString(nn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?pr.fromString(nn(this.args[0].evaluate(e))):nn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Xn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ps(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ro=Ka;const Ts=["Unknown","Point","LineString","Polygon"];var Js=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ts[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-i[0])+this.featureDistanceData.bearing[1]*(s*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Mi.parse(i)),e}};class us{constructor(e,n,s,a){this.name=e,this.type=n,this._evaluate=s,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],a=us.definitions[s];if(!a)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(a)?a[0]:a.type,y=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,T=y.filter(([O])=>!Array.isArray(O)||O.length===e.length-1);let P=null;for(const[O,j]of T){P=new Zt(n.registry,n.path,null,n.scope);const G=[];let $=!1;for(let Z=1;Z<e.length;Z++){const Q=e[Z],ne=Array.isArray(O)?O[Z-1]:O.type,Ae=P.parse(Q,1+G.length,ne);if(!Ae){$=!0;break}G.push(Ae)}if(!$)if(Array.isArray(O)&&O.length!==G.length)P.error(`Expected ${O.length} arguments, but found ${G.length} instead.`);else{for(let Z=0;Z<G.length;Z++){const Q=Array.isArray(O)?O[Z]:O.type,ne=G[Z];P.concat(Z+1).checkSubtype(Q,ne.type)}if(P.errors.length===0)return new us(s,p,j,G)}}if(T.length===1)n.errors.push(...P.errors);else{const O=(T.length?T:y).map(([G])=>{return $=G,Array.isArray($)?`(${$.map(Er).join(", ")})`:`(${Er($.type)}...)`;var $}).join(" | "),j=[];for(let G=1;G<e.length;G++){const $=n.parse(e[G],1+j.length);if(!$)return null;j.push(Er($.type))}n.error(`Expected arguments of type ${O}, but found (${j.join(", ")}) instead.`)}return null}static register(e,n){us.definitions=n;for(const s in n)e[s]=us}}var Qs=us;class Ms{constructor(e,n,s){this.type=mn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const a=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ji);if(!a)return null;const p=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ji);if(!p)return null;let y=null;return s.locale&&(y=n.parse(s.locale,1,Zi),!y)?null:new Ms(a,p,y)}evaluate(e){return new Di(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Tn=8192;function ta(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ls(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function _a(i,e){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(n*a*Tn),Math.round(s*a*Tn)]}function ya(i,e,n){const s=i[0]-e[0],a=i[1]-e[1],p=i[0]-n[0],y=i[1]-n[1];return s*y-p*a==0&&s*p<=0&&a*y<=0}function Ja(i,e){let n=!1;for(let y=0,T=e.length;y<T;y++){const P=e[y];for(let O=0,j=P.length;O<j-1;O++){if(ya(i,P[O],P[O+1]))return!1;(a=P[O])[1]>(s=i)[1]!=(p=P[O+1])[1]>s[1]&&s[0]<(p[0]-a[0])*(s[1]-a[1])/(p[1]-a[1])+a[0]&&(n=!n)}}var s,a,p;return n}function va(i,e){for(let n=0;n<e.length;n++)if(Ja(i,e[n]))return!0;return!1}function xa(i,e,n,s){const a=s[0]-n[0],p=s[1]-n[1],y=(i[0]-n[0])*p-a*(i[1]-n[1]),T=(e[0]-n[0])*p-a*(e[1]-n[1]);return y>0&&T<0||y<0&&T>0}function Bo(i,e,n){for(const O of n)for(let j=0;j<O.length-1;++j)if((T=[(y=O[j+1])[0]-(p=O[j])[0],y[1]-p[1]])[0]*(P=[(a=e)[0]-(s=i)[0],a[1]-s[1]])[1]-T[1]*P[0]!=0&&xa(s,a,p,y)&&xa(p,y,s,a))return!0;var s,a,p,y,T,P;return!1}function mr(i,e){for(let n=0;n<i.length;++n)if(!Ja(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Bo(i[n],i[n+1],e))return!1;return!0}function Il(i,e){for(let n=0;n<e.length;n++)if(mr(i,e[n]))return!0;return!1}function ba(i,e,n){const s=[];for(let a=0;a<i.length;a++){const p=[];for(let y=0;y<i[a].length;y++){const T=_a(i[a][y],n);ta(e,T),p.push(T)}s.push(p)}return s}function kl(i,e,n){const s=[];for(let a=0;a<i.length;a++){const p=ba(i[a],e,n);s.push(p)}return s}function Dl(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){const a=.5*s;let p=i[0]-n[0]>a?-s:n[0]-i[0]>a?s:0;p===0&&(p=i[0]-n[2]>a?-s:n[2]-i[0]>a?s:0),i[0]+=p}ta(e,i)}function wa(i,e,n,s){const a=Math.pow(2,s.z)*Tn,p=[s.x*Tn,s.y*Tn],y=[];if(!i)return y;for(const T of i)for(const P of T){const O=[P.x+p[0],P.y+p[1]];Dl(O,e,n,a),y.push(O)}return y}function No(i,e,n,s){const a=Math.pow(2,s.z)*Tn,p=[s.x*Tn,s.y*Tn],y=[];if(!i)return y;for(const P of i){const O=[];for(const j of P){const G=[j.x+p[0],j.y+p[1]];ta(e,G),O.push(G)}y.push(O)}if(e[2]-e[0]<=a/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const P of y)for(const O of P)Dl(O,e,n,a)}var T;return y}class mo{constructor(e,n){this.type=ji,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(fr(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let a=0;a<s.features.length;++a){const p=s.features[a].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new mo(s,s.features[a].geometry)}else if(s.type==="Feature"){const a=s.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new mo(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new mo(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const a=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if(s.type==="Polygon"){const T=ba(s.coordinates,p,y),P=wa(n.geometry(),a,p,y);if(!Ls(a,p))return!1;for(const O of P)if(!Ja(O,T))return!1}if(s.type==="MultiPolygon"){const T=kl(s.coordinates,p,y),P=wa(n.geometry(),a,p,y);if(!Ls(a,p))return!1;for(const O of P)if(!va(O,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const a=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if(s.type==="Polygon"){const T=ba(s.coordinates,p,y),P=No(n.geometry(),a,p,y);if(!Ls(a,p))return!1;for(const O of P)if(!mr(O,T))return!1}if(s.type==="MultiPolygon"){const T=kl(s.coordinates,p,y),P=No(n.geometry(),a,p,y);if(!Ls(a,p))return!1;for(const O of P)if(!Il(O,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var eo=mo;function go(i){if(i instanceof Qs&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof eo)return!1;let e=!0;return i.eachChild(n=>{e&&!go(n)&&(e=!1)}),e}function U(i){if(i instanceof Qs&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!U(n)&&(e=!1)}),e}function ue(i,e){if(i instanceof Qs&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!ue(s,e)&&(n=!1)}),n}class Ye{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ye(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var pt=Ye;class It{constructor(e,n=[],s,a=new po,p=[]){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=a,this.errors=p,this.expectedType=s}parse(e,n,s,a,p={}){return n?this.concat(n,s,a)._parse(e,p):this._parse(e,p)}_parse(e,n){function s(a,p,y){return y==="assert"?new Dn(p,[a]):y==="coerce"?new Ro(p,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[a];if(p){let y=p.parse(e,this);if(!y)return null;if(this.expectedType){const T=this.expectedType,P=y.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||P.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(T,P))return null}else y=s(y,T,n.typeAnnotation||"coerce");else y=s(y,T,n.typeAnnotation||"assert")}if(!(y instanceof zr)&&y.type.kind!=="resolvedImage"&&pi(y)){const T=new Js;try{y=new zr(y.type,y.evaluate(T))}catch(P){return this.error(P.message),null}}return y}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const a=typeof e=="number"?this.path.concat(e):this.path,p=s?this.scope.concat(s):this.scope;return new It(this.registry,a,n||null,p,this.errors)}error(e,...n){const s=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new br(s,e))}checkSubtype(e,n){const s=ws(e,n);return s&&this.error(s),s}}var Zt=It;function pi(i){if(i instanceof pt)return pi(i.boundExpression);if(i instanceof Qs&&i.name==="error"||i instanceof Ms||i instanceof eo)return!1;const e=i instanceof Ro||i instanceof Dn;let n=!0;return i.eachChild(s=>{n=e?n&&pi(s):n&&s instanceof zr}),!!n&&go(i)&&ue(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ei(i,e){const n=i.length-1;let s,a,p=0,y=n,T=0;for(;p<=y;)if(T=Math.floor((p+y)/2),s=i[T],a=i[T+1],s<=e){if(T===n||e<a)return T;p=T+1}else{if(!(s>e))throw new Wr("Input is not a number.");y=T-1}return 0}class qi{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[a,p]of s)this.labels.push(a),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,di);if(!s)return null;const a=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let y=1;y<e.length;y+=2){const T=y===1?-1/0:e[y],P=e[y+1],O=y,j=y+1;if(typeof T!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(a.length&&a[a.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const G=n.parse(P,j,p);if(!G)return null;p=p||G.type,a.push([T,G])}return new qi(p,s,a)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return s[0].evaluate(e);const p=n.length;return a>=n[p-1]?s[p-1].evaluate(e):s[Ei(n,a)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var lr=qi;function Ci(i,e,n){return i*(1-n)+e*n}var _r=Object.freeze({__proto__:null,array:function(i,e,n){return i.map((s,a)=>Ci(s,e[a],n))},color:function(i,e,n){return new Mi(Ci(i.r,e.r,n),Ci(i.g,e.g,n),Ci(i.b,e.b,n),Ci(i.a,e.a,n))},number:Ci});const on=.95047,an=1.08883,gn=4/29,fn=6/29,vn=3*fn*fn,to=fn*fn*fn,Cs=Math.PI/180,jo=180/Math.PI;function Qa(i){return i>to?Math.pow(i,1/3):i/vn+gn}function Sa(i){return i>fn?i*i*i:vn*(i-gn)}function Ta(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Uo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function el(i){const e=Uo(i.r),n=Uo(i.g),s=Uo(i.b),a=Qa((.4124564*e+.3575761*n+.1804375*s)/on),p=Qa((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*p-16,a:500*(a-p),b:200*(p-Qa((.0193339*e+.119192*n+.9503041*s)/an)),alpha:i.a}}function tl(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*Sa(e),n=on*Sa(n),s=an*Sa(s),new Mi(Ta(3.2404542*n-1.5371385*e-.4985314*s),Ta(-.969266*n+1.8760108*e+.041556*s),Ta(.0556434*n-.2040259*e+1.0572252*s),i.alpha)}function il(i,e,n){const s=e-i;return i+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const On={forward:el,reverse:tl,interpolate:function(i,e,n){return{l:Ci(i.l,e.l,n),a:Ci(i.a,e.a,n),b:Ci(i.b,e.b,n),alpha:Ci(i.alpha,e.alpha,n)}}},io={forward:function(i){const{l:e,a:n,b:s}=el(i),a=Math.atan2(s,n)*jo;return{h:a<0?a+360:a,c:Math.sqrt(n*n+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Cs,n=i.c;return tl({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:il(i.h,e.h,n),c:Ci(i.c,e.c,n),l:Ci(i.l,e.l,n),alpha:Ci(i.alpha,e.alpha,n)}}};var ia=Object.freeze({__proto__:null,hcl:io,lab:On});class _o{constructor(e,n,s,a,p){this.type=e,this.operator=n,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[y,T]of p)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(e,n,s,a){let p=0;if(e.name==="exponential")p=Ca(n,e.base,s,a);else if(e.name==="linear")p=Ca(n,1,s,a);else if(e.name==="cubic-bezier"){const y=e.controlPoints;p=new se(y[0],y[1],y[2],y[3]).solve(Ca(n,1,s,a))}return p}static parse(e,n){let[s,a,p,...y]=e;if(!Array.isArray(a)||a.length===0)return n.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const O=a[1];if(typeof O!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:O}}else{if(a[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const O=a.slice(1);if(O.length!==4||O.some(j=>typeof j!="number"||j<0||j>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:O}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,di),!p)return null;const T=[];let P=null;s==="interpolate-hcl"||s==="interpolate-lab"?P=tn:n.expectedType&&n.expectedType.kind!=="value"&&(P=n.expectedType);for(let O=0;O<y.length;O+=2){const j=y[O],G=y[O+1],$=O+3,Z=O+4;if(typeof j!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=j)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const Q=n.parse(G,Z,P);if(!Q)return null;P=P||Q.type,T.push([j,Q])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new _o(P,s,a,p,T):n.error(`Type ${Er(P)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return s[0].evaluate(e);const p=n.length;if(a>=n[p-1])return s[p-1].evaluate(e);const y=Ei(n,a),T=_o.interpolationFactor(this.interpolation,a,n[y],n[y+1]),P=s[y].evaluate(e),O=s[y+1].evaluate(e);return this.operator==="interpolate"?_r[this.type.kind.toLowerCase()](P,O,T):this.operator==="interpolate-hcl"?io.reverse(io.interpolate(io.forward(P),io.forward(O),T)):On.reverse(On.interpolate(On.forward(P),On.forward(O),T))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ca(i,e,n,s){const a=s-n,p=i-n;return a===0?0:e===1?p/a:(Math.pow(e,p)-1)/(Math.pow(e,a)-1)}var ln=_o;class rl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const a=n.expectedType;a&&a.kind!=="value"&&(s=a);const p=[];for(const T of e.slice(1)){const P=n.parse(T,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!P)return null;s=s||P.type,p.push(P)}const y=a&&p.some(T=>ws(a,T.type));return new rl(y?Ki:s,p)}evaluate(e){let n,s=null,a=0;for(const p of this.args){if(a++,s=p.evaluate(e),s&&s instanceof pr&&!s.available&&(n||(n=s),s=null,a===this.args.length))return n;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Aa=rl;class Ea{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const y=e[p];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const T=n.parse(e[p+1],p+1);if(!T)return null;s.push([y,T])}const a=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return a?new Ea(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var Is=Ea;class Pa{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,di),a=n.parse(e[2],2,jn(n.expectedType||Ki));return s&&a?new Pa(a.type.itemType,s,a):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Wr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Wr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Wr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var yc=Pa;class Ol{constructor(e,n){this.type=ji,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Ki),a=n.parse(e[2],2,Ki);return s&&a?Fo(s.type,[ji,Zi,di,Ks,Ki])?new Ol(s,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!es(n,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(ir(n))} instead.`);if(!es(s,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Er(ir(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ro=Ol;class Hn{constructor(e,n,s){this.type=di,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Ki),a=n.parse(e[2],2,Ki);if(!s||!a)return null;if(!Fo(s.type,[ji,Zi,di,Ks,Ki]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(s.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,di);return p?new Hn(s,a,p):null}return new Hn(s,a)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!es(n,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(ir(n))} instead.`);if(!es(s,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Er(ir(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return s.indexOf(n,a)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ks=Hn;class yo{constructor(e,n,s,a,p,y){this.inputType=e,this.type=n,this.input=s,this.cases=a,this.outputs=p,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const p={},y=[];for(let O=2;O<e.length-1;O+=2){let j=e[O];const G=e[O+1];Array.isArray(j)||(j=[j]);const $=n.concat(O);if(j.length===0)return $.error("Expected at least one branch label.");for(const Q of j){if(typeof Q!="number"&&typeof Q!="string")return $.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return $.error("Numeric branch labels must be integer values.");if(s){if($.checkSubtype(s,ir(Q)))return null}else s=ir(Q);if(p[String(Q)]!==void 0)return $.error("Branch labels must be unique.");p[String(Q)]=y.length}const Z=n.parse(G,O,a);if(!Z)return null;a=a||Z.type,y.push(Z)}const T=n.parse(e[1],1,Ki);if(!T)return null;const P=n.parse(e[e.length-1],e.length-1,a);return P?T.type.kind!=="value"&&n.concat(1).checkSubtype(s,T.type)?null:new yo(s,a,T,p,y,P):null}evaluate(e){const n=this.input.evaluate(e);return(ir(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],a={};for(const y of n){const T=a[this.cases[y]];T===void 0?(a[this.cases[y]]=s.length,s.push([this.cases[y],[y]])):s[T][1].push(y)}const p=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of s)e.push(T.length===1?p(T[0]):T.map(p)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var vo=yo;class no{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const a=[];for(let y=1;y<e.length-1;y+=2){const T=n.parse(e[y],y,ji);if(!T)return null;const P=n.parse(e[y+1],y+1,s);if(!P)return null;a.push([T,P]),s=s||P.type}const p=n.parse(e[e.length-1],e.length-1,s);return p?new no(s,a,p):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ma=no;class ts{constructor(e,n,s,a){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Ki),a=n.parse(e[2],2,di);if(!s||!a)return null;if(!Fo(s.type,[jn(Ki),Zi,Ki]))return n.error(`Expected first argument to be of type array or string, but found ${Er(s.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,di);return p?new ts(s.type,s,a,p):null}return new ts(s.type,s,a)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!es(n,["string","array"]))throw new Wr(`Expected first argument to be of type array or string, but found ${Er(ir(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return n.slice(s,a)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var La=ts;function ra(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Vo(i,e,n,s){return s.compare(e,n)===0}function $n(i,e,n){const s=i!=="=="&&i!=="!=";return class w_{constructor(p,y,T){this.type=ji,this.lhs=p,this.rhs=y,this.collator=T,this.hasUntypedArgument=p.type.kind==="value"||y.type.kind==="value"}static parse(p,y){if(p.length!==3&&p.length!==4)return y.error("Expected two or three arguments.");const T=p[0];let P=y.parse(p[1],1,Ki);if(!P)return null;if(!ra(T,P.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Er(P.type)}'.`);let O=y.parse(p[2],2,Ki);if(!O)return null;if(!ra(T,O.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Er(O.type)}'.`);if(P.type.kind!==O.type.kind&&P.type.kind!=="value"&&O.type.kind!=="value")return y.error(`Cannot compare types '${Er(P.type)}' and '${Er(O.type)}'.`);s&&(P.type.kind==="value"&&O.type.kind!=="value"?P=new Dn(O.type,[P]):P.type.kind!=="value"&&O.type.kind==="value"&&(O=new Dn(P.type,[O])));let j=null;if(p.length===4){if(P.type.kind!=="string"&&O.type.kind!=="string"&&P.type.kind!=="value"&&O.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(j=y.parse(p[3],3,mn),!j)return null}return new w_(P,O,j)}evaluate(p){const y=this.lhs.evaluate(p),T=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const P=ir(y),O=ir(T);if(P.kind!==O.kind||P.kind!=="string"&&P.kind!=="number")throw new Wr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${P.kind}, ${O.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const P=ir(y),O=ir(T);if(P.kind!=="string"||O.kind!=="string")return e(p,y,T)}return this.collator?n(p,y,T,this.collator.evaluate(p)):e(p,y,T)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(y=>{p.push(y.serialize())}),p}}}const qo=$n("==",function(i,e,n){return e===n},Vo),Ia=$n("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!Vo(0,e,n,s)}),nl=$n("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),ka=$n(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),na=$n("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),sl=$n(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class is{constructor(e,n,s,a,p,y){this.type=Zi,this.number=e,this.locale=n,this.currency=s,this.unit=a,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,di);if(!s)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let p=null;if(a.locale&&(p=n.parse(a.locale,1,Zi),!p))return null;let y=null;if(a.currency&&(y=n.parse(a.currency,1,Zi),!y))return null;let T=null;if(a.unit&&(T=n.parse(a.unit,1,Zi),!T))return null;let P=null;if(a["min-fraction-digits"]&&(P=n.parse(a["min-fraction-digits"],1,di),!P))return null;let O=null;return a["max-fraction-digits"]&&(O=n.parse(a["max-fraction-digits"],1,di),!O)?null:new is(s,p,y,T,P,O)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fs{constructor(e){this.type=di,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Er(s.type)} instead.`):new fs(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Wr(`Expected value to be of type string or array, but found ${Er(ir(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Xr={"==":qo,"!=":Ia,">":ka,"<":nl,">=":sl,"<=":na,array:Dn,at:yc,boolean:Dn,case:Ma,coalesce:Aa,collator:Ms,format:Xn,image:Ps,in:ro,"index-of":ks,interpolate:ln,"interpolate-hcl":ln,"interpolate-lab":ln,length:fs,let:Is,literal:zr,match:vo,number:Dn,"number-format":is,object:Dn,slice:La,step:lr,string:Dn,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:pt,within:eo};function Hr(i,[e,n,s,a]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const p=a?a.evaluate(i):1,y=Mr(e,n,s,p);if(y)throw new Wr(y);return new Mi(e/255*p,n/255*p,s/255*p,p)}function Rr(i,e){return i in e}function dn(i,e){const n=e[i];return n===void 0?null:n}function xn(i){return{type:i}}Qs.register(Xr,{error:[{kind:"error"},[Zi],(i,[e])=>{throw new Wr(e.evaluate(i))}],typeof:[Zi,[Ki],(i,[e])=>Er(ir(e.evaluate(i)))],"to-rgba":[jn(di,4),[tn],(i,[e])=>e.evaluate(i).toArray()],rgb:[tn,[di,di,di],Hr],rgba:[tn,[di,di,di,di],Hr],has:{type:ji,overloads:[[[Zi],(i,[e])=>Rr(e.evaluate(i),i.properties())],[[Zi,Nn],(i,[e,n])=>Rr(e.evaluate(i),n.evaluate(i))]]},get:{type:Ki,overloads:[[[Zi],(i,[e])=>dn(e.evaluate(i),i.properties())],[[Zi,Nn],(i,[e,n])=>dn(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Ki,[Zi],(i,[e])=>dn(e.evaluate(i),i.featureState||{})],properties:[Nn,[],i=>i.properties()],"geometry-type":[Zi,[],i=>i.geometryType()],id:[Ki,[],i=>i.id()],zoom:[di,[],i=>i.globals.zoom],pitch:[di,[],i=>i.globals.pitch||0],"distance-from-center":[di,[],i=>i.distanceFromCenter()],"heatmap-density":[di,[],i=>i.globals.heatmapDensity||0],"line-progress":[di,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[di,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ki,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[di,xn(di),(i,e)=>{let n=0;for(const s of e)n+=s.evaluate(i);return n}],"*":[di,xn(di),(i,e)=>{let n=1;for(const s of e)n*=s.evaluate(i);return n}],"-":{type:di,overloads:[[[di,di],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[di],(i,[e])=>-e.evaluate(i)]]},"/":[di,[di,di],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[di,[di,di],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[di,[],()=>Math.LN2],pi:[di,[],()=>Math.PI],e:[di,[],()=>Math.E],"^":[di,[di,di],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[di,[di],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[di,[di],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[di,[di],(i,[e])=>Math.log(e.evaluate(i))],log2:[di,[di],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[di,[di],(i,[e])=>Math.sin(e.evaluate(i))],cos:[di,[di],(i,[e])=>Math.cos(e.evaluate(i))],tan:[di,[di],(i,[e])=>Math.tan(e.evaluate(i))],asin:[di,[di],(i,[e])=>Math.asin(e.evaluate(i))],acos:[di,[di],(i,[e])=>Math.acos(e.evaluate(i))],atan:[di,[di],(i,[e])=>Math.atan(e.evaluate(i))],min:[di,xn(di),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[di,xn(di),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[di,[di],(i,[e])=>Math.abs(e.evaluate(i))],round:[di,[di],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[di,[di],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[di,[di],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ji,[Zi,Ki],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[ji,[Ki],(i,[e])=>i.id()===e.value],"filter-type-==":[ji,[Zi],(i,[e])=>i.geometryType()===e.value],"filter-<":[ji,[Zi,Ki],(i,[e,n])=>{const s=i.properties()[e.value],a=n.value;return typeof s==typeof a&&s<a}],"filter-id-<":[ji,[Ki],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[ji,[Zi,Ki],(i,[e,n])=>{const s=i.properties()[e.value],a=n.value;return typeof s==typeof a&&s>a}],"filter-id->":[ji,[Ki],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[ji,[Zi,Ki],(i,[e,n])=>{const s=i.properties()[e.value],a=n.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[ji,[Ki],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[ji,[Zi,Ki],(i,[e,n])=>{const s=i.properties()[e.value],a=n.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[ji,[Ki],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[ji,[Ki],(i,[e])=>e.value in i.properties()],"filter-has-id":[ji,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ji,[jn(Zi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ji,[jn(Ki)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ji,[Zi,jn(Ki)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ji,[Zi,jn(Ki)],(i,[e,n])=>function(s,a,p,y){for(;p<=y;){const T=p+y>>1;if(a[T]===s)return!0;a[T]>s?y=T-1:p=T+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ji,overloads:[[[ji,ji],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[xn(ji),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ji,overloads:[[[ji,ji],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[xn(ji),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[ji,[ji],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ji,[Zi],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Zi,[Zi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Zi,[Zi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Zi,xn(Ki),(i,e)=>e.map(n=>nn(n.evaluate(i))).join("")],"resolved-locale":[Zi,[mn],(i,[e])=>e.evaluate(i).resolvedLocale()]});var Ds=Xr;function Da(i){return{result:"success",value:i}}function xo(i){return{result:"error",value:i}}function Oa(i){return i["property-type"]==="data-driven"}function Fl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function zl(i){return!!i.expression&&i.expression.interpolated}function vr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ol(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function vc(i){return i}function al(i,e){const n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",a=s||!(s||i.property!==void 0),p=i.type||(zl(e)?"exponential":"interval");if(n&&((i=Wn({},i)).stops&&(i.stops=i.stops.map(O=>[O[0],Mi.parse(O[1])])),i.default=Mi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!ia[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,T,P;if(p==="exponential")y=Os;else if(p==="interval")y=rs;else if(p==="categorical"){y=ds,T=Object.create(null);for(const O of i.stops)T[O[0]]=O[1];P=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);y=Rl}if(s){const O={},j=[];for(let Z=0;Z<i.stops.length;Z++){const Q=i.stops[Z],ne=Q[0].zoom;O[ne]===void 0&&(O[ne]={zoom:ne,type:i.type,property:i.property,default:i.default,stops:[]},j.push(ne)),O[ne].stops.push([Q[0].value,Q[1]])}const G=[];for(const Z of j)G.push([O[Z].zoom,al(O[Z],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:ln.interpolationFactor.bind(void 0,$),zoomStops:G.map(Z=>Z[0]),evaluate:({zoom:Z},Q)=>Os({stops:G,base:i.base},e,Z).evaluate(Z,Q)}}if(a){const O=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:ln.interpolationFactor.bind(void 0,O),zoomStops:i.stops.map(j=>j[0]),evaluate:({zoom:j})=>y(i,e,j,T,P)}}return{kind:"source",evaluate(O,j){const G=j&&j.properties?j.properties[i.property]:void 0;return G===void 0?Go(i.default,e.default):y(i,e,G,T,P)}}}function Go(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function ds(i,e,n,s,a){return Go(typeof n===a?s[n]:void 0,i.default,e.default)}function rs(i,e,n){if(vr(n)!=="number")return Go(i.default,e.default);const s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const a=Ei(i.stops.map(p=>p[0]),n);return i.stops[a][1]}function Os(i,e,n){const s=i.base!==void 0?i.base:1;if(vr(n)!=="number")return Go(i.default,e.default);const a=i.stops.length;if(a===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[a-1][0])return i.stops[a-1][1];const p=Ei(i.stops.map(j=>j[0]),n),y=function(j,G,$,Z){const Q=Z-$,ne=j-$;return Q===0?0:G===1?ne/Q:(Math.pow(G,ne)-1)/(Math.pow(G,Q)-1)}(n,s,i.stops[p][0],i.stops[p+1][0]),T=i.stops[p][1],P=i.stops[p+1][1];let O=_r[e.type]||vc;if(i.colorSpace&&i.colorSpace!=="rgb"){const j=ia[i.colorSpace];O=(G,$)=>j.reverse(j.interpolate(j.forward(G),j.forward($),y))}return typeof T.evaluate=="function"?{evaluate(...j){const G=T.evaluate.apply(void 0,j),$=P.evaluate.apply(void 0,j);if(G!==void 0&&$!==void 0)return O(G,$,y)}}:O(T,P,y)}function Rl(i,e,n){return e.type==="color"?n=Mi.parse(n):e.type==="formatted"?n=ar.fromString(n.toString()):e.type==="resolvedImage"?n=pr.fromString(n.toString()):vr(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Go(n,i.default,e.default)}class Bl{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Js,this._defaultValue=n?function(s){return s.type==="color"&&(ol(s.default)||Array.isArray(s.default))?new Mi(0,0,0,0):s.type==="color"?Mi.parse(s.default)||null:s.default===void 0?null:s.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,a,p,y,T,P){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,a,p,y,T,P){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(O.message)),this._defaultValue}}}function Wo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ds}function Xo(i,e){const n=new Zt(Ds,[],e?function(a){const p={color:tn,string:Zi,number:di,enum:Zi,boolean:ji,formatted:Oo,resolvedImage:Es};return a.type==="array"?jn(p[a.value]||Ki,a.length):p[a.type]}(e):void 0),s=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Da(new Bl(s,e)):xo(n.errors)}class Nl{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!U(n.expression)}evaluateWithoutErrorHandling(e,n,s,a,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,a,p,y)}evaluate(e,n,s,a,p,y){return this._styleExpression.evaluate(e,n,s,a,p,y)}}class ll{constructor(e,n,s,a){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!U(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,n,s,a,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,a,p,y)}evaluate(e,n,s,a,p,y){return this._styleExpression.evaluate(e,n,s,a,p,y)}interpolationFactor(e,n,s){return this.interpolationType?ln.interpolationFactor(this.interpolationType,e,n,s):0}}function Fa(i,e){if((i=Xo(i,e)).result==="error")return i;const n=i.value.expression,s=go(n);if(!s&&!Oa(e))return xo([new br("","data expressions not supported")]);const a=ue(n,["zoom","pitch","distance-from-center"]);if(!a&&!Fl(e))return xo([new br("","zoom expressions not supported")]);const p=za(n);return p||a?p instanceof br?xo([p]):p instanceof ln&&!zl(e)?xo([new br("",'"interpolate" expressions cannot be used with this property')]):Da(p?new ll(s?"camera":"composite",i.value,p.labels,p instanceof ln?p.interpolation:void 0):new Nl(s?"constant":"source",i.value)):xo([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cl{constructor(e,n){this._parameters=e,this._specification=n,Wn(this,al(this._parameters,this._specification))}static deserialize(e){return new cl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function za(i){let e=null;if(i instanceof Is)e=za(i.result);else if(i instanceof Aa){for(const n of i.args)if(e=za(n),e)break}else(i instanceof lr||i instanceof ln)&&i.input instanceof Qs&&i.input.name==="zoom"&&(e=i);return e instanceof br||i.eachChild(n=>{const s=za(n);s instanceof br?e=s:!e&&s?e=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class yi{constructor(e,n,s,a){this.message=(e?`${e}: `:"")+s,a&&(this.identifier=a),n!=null&&n.__line__&&(this.line=n.__line__)}}function so(i){const e=i.key,n=i.value,s=i.valueSpec||{},a=i.objectElementValidators||{},p=i.style,y=i.styleSpec;let T=[];const P=vr(n);if(P!=="object")return[new yi(e,n,`object expected, ${P} found`)];for(const O in n){const j=O.split(".")[0];let G;a[j]?G=a[j]:s[j]?G=bn:a["*"]?G=a["*"]:s["*"]&&(G=bn),G?T=T.concat(G({key:(e&&`${e}.`)+O,value:n[O],valueSpec:s[j]||s["*"],style:p,styleSpec:y,object:n,objectKey:O},n)):T.push(new yi(e,n[O],`unknown property "${O}"`))}for(const O in s)a[O]||s[O].required&&s[O].default===void 0&&n[O]===void 0&&T.push(new yi(e,n,`missing required property "${O}"`));return T}function oh(i){const e=i.value,n=i.valueSpec,s=i.style,a=i.styleSpec,p=i.key,y=i.arrayElementValidator||bn;if(vr(e)!=="array")return[new yi(p,e,`array expected, ${vr(e)} found`)];if(n.length&&e.length!==n.length)return[new yi(p,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new yi(p,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let T={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(T.function=n.function),vr(n.value)==="object"&&(T=n.value);let P=[];for(let O=0;O<e.length;O++)P=P.concat(y({array:e,arrayIndex:O,value:e[O],valueSpec:T,style:s,styleSpec:a,key:`${p}[${O}]`}));return P}function hl(i){const e=i.key,n=i.value,s=i.valueSpec;let a=vr(n);if(a==="number"&&n!=n&&(a="NaN"),a!=="number")return[new yi(e,n,`number expected, ${a} found`)];if("minimum"in s){let p=s.minimum;if(vr(s.minimum)==="array"&&(p=s.minimum[i.arrayIndex]),n<p)return[new yi(e,n,`${n} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if(vr(s.maximum)==="array"&&(p=s.maximum[i.arrayIndex]),n>p)return[new yi(e,n,`${n} is greater than the maximum value ${p}`)]}return[]}function jl(i){const e=i.valueSpec,n=Gr(i.value.type);let s,a,p,y={};const T=n!=="categorical"&&i.value.property===void 0,P=!T,O=vr(i.value.stops)==="array"&&vr(i.value.stops[0])==="array"&&vr(i.value.stops[0][0])==="object",j=so({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(n==="identity")return[new yi(Z.key,Z.value,'identity function may not have a "stops" property')];let Q=[];const ne=Z.value;return Q=Q.concat(oh({key:Z.key,value:ne,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:G})),vr(ne)==="array"&&ne.length===0&&Q.push(new yi(Z.key,ne,"array must have at least one stop")),Q},default:function(Z){return bn({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return n==="identity"&&T&&j.push(new yi(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||j.push(new yi(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!zl(i.valueSpec)&&j.push(new yi(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(P&&!Oa(i.valueSpec)?j.push(new yi(i.key,i.value,"property functions not supported")):T&&!Fl(i.valueSpec)&&j.push(new yi(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!O||i.value.property!==void 0||j.push(new yi(i.key,i.value,'"property" property is required')),j;function G(Z){let Q=[];const ne=Z.value,Ae=Z.key;if(vr(ne)!=="array")return[new yi(Ae,ne,`array expected, ${vr(ne)} found`)];if(ne.length!==2)return[new yi(Ae,ne,`array length 2 expected, length ${ne.length} found`)];if(O){if(vr(ne[0])!=="object")return[new yi(Ae,ne,`object expected, ${vr(ne[0])} found`)];if(ne[0].zoom===void 0)return[new yi(Ae,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new yi(Ae,ne,"object stop key must have value")];const Fe=Gr(ne[0].zoom);if(typeof Fe!="number")return[new yi(Ae,ne[0].zoom,"stop zoom values must be numbers")];if(p&&p>Fe)return[new yi(Ae,ne[0].zoom,"stop zoom values must appear in ascending order")];Fe!==p&&(p=Fe,a=void 0,y={}),Q=Q.concat(so({key:`${Ae}[0]`,value:ne[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:hl,value:$}}))}else Q=Q.concat($({key:`${Ae}[0]`,value:ne[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},ne));return Wo(ur(ne[1]))?Q.concat([new yi(`${Ae}[1]`,ne[1],"expressions are not allowed in function stops.")]):Q.concat(bn({key:`${Ae}[1]`,value:ne[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function $(Z,Q){const ne=vr(Z.value),Ae=Gr(Z.value),Fe=Z.value!==null?Z.value:Q;if(s){if(ne!==s)return[new yi(Z.key,Fe,`${ne} stop domain type must match previous stop domain type ${s}`)]}else s=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof Ae!="number"&&typeof Ae!="string"&&typeof Ae!="boolean")return[new yi(Z.key,Fe,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&n!=="categorical"){let Je=`number expected, ${ne} found`;return Oa(e)&&n===void 0&&(Je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yi(Z.key,Fe,Je)]}return n!=="categorical"||ne!=="number"||typeof Ae=="number"&&isFinite(Ae)&&Math.floor(Ae)===Ae?n!=="categorical"&&ne==="number"&&typeof Ae=="number"&&typeof a=="number"&&a!==void 0&&Ae<a?[new yi(Z.key,Fe,"stop domain values must appear in ascending order")]:(a=Ae,n==="categorical"&&Ae in y?[new yi(Z.key,Fe,"stop domain values must be unique")]:(y[Ae]=!0,[])):[new yi(Z.key,Fe,`integer expected, found ${String(Ae)}`)]}}function Fn(i){const e=(i.expressionContext==="property"?Fa:Xo)(ur(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new yi(`${i.key}${s.key}`,i.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new yi(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!U(n))return[new yi(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Ul(n,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ue(n,["zoom","feature-state"]))return[new yi(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!go(n))return[new yi(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ul(i,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)n.delete(a);if(n.size===0)return[];const s=[];return i instanceof Qs&&n.has(i.name)?[new yi(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(a=>{s.push(...Ul(a,e))}),s)}function Ql(i){const e=i.key,n=i.value,s=i.valueSpec,a=[];return Array.isArray(s.values)?s.values.indexOf(Gr(n))===-1&&a.push(new yi(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(Gr(n))===-1&&a.push(new yi(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function xc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!xc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ul(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xc(i)||(i=dl(i));const n=i;let s=!0;try{s=function(O){if(!fl(O))return O;let j=ur(O);return sa(j),j=ec(j),j}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const a=Ut[`filter_${e}`],p=Xo(s,a);let y=null;if(p.result==="error")throw new Error(p.value.map(O=>`${O.key}: ${O.message}`).join(", "));y=(O,j,G)=>p.value.evaluate(O,j,{},G);let T=null,P=null;if(s!==n){const O=Xo(n,a);if(O.result==="error")throw new Error(O.value.map(j=>`${j.key}: ${j.message}`).join(", "));T=(j,G,$,Z,Q)=>O.value.evaluate(j,G,{},$,void 0,void 0,Z,Q),P=!go(O.value.expression)}return{filter:y,dynamicFilter:T||void 0,needGeometry:lh(s),needFeature:!!P}}function ec(i){if(!Array.isArray(i))return i;const e=function(n){if(bc.has(n[0])){for(let s=1;s<n.length;s++)if(fl(n[s]))return!0}return n}(i);return e===!0?e:e.map(n=>ec(n))}function sa(i){let e=!1;const n=[];if(i[0]==="case"){for(let s=1;s<i.length-1;s+=2)e=e||fl(i[s]),n.push(i[s+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||fl(i[1]);for(let s=2;s<i.length-1;s+=2)n.push(i[s+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||fl(i[1]);for(let s=1;s<i.length-1;s+=2)n.push(i[s+1])}e&&(i.length=0,i.push("any",...n));for(let s=1;s<i.length;s++)sa(i[s])}function fl(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(fl(i[n]))return!0;return!1}const bc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ah(i,e){return i<e?-1:i>e?1:0}function lh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(lh(i[e]))return!0;return!1}function dl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?wc(i[1],i[2],"=="):e==="!="?ps(wc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?wc(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(dl))):e==="all"?["all"].concat(i.slice(1).map(dl)):e==="none"?["all"].concat(i.slice(1).map(dl).map(ps)):e==="in"?Sc(i[1],i.slice(2)):e==="!in"?ps(Sc(i[1],i.slice(2))):e==="has"?bo(i[1]):e==="!has"?ps(bo(i[1])):e!=="within"||i;var n}function wc(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Sc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ah)]]:["filter-in-small",i,["literal",e]]}}function bo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ps(i){return["!",i]}function As(i){return xc(ur(i.value))?Fn(Wn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Vl(i)}function Vl(i){const e=i.value,n=i.key;if(vr(e)!=="array")return[new yi(n,e,`array expected, ${vr(e)} found`)];const s=i.styleSpec;let a,p=[];if(e.length<1)return[new yi(n,e,"filter array must have at least 1 element")];switch(p=p.concat(Ql({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Gr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gr(e[1])==="$type"&&p.push(new yi(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new yi(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=vr(e[1]),a!=="string"&&p.push(new yi(`${n}[1]`,e[1],`string expected, ${a} found`)));for(let y=2;y<e.length;y++)a=vr(e[y]),Gr(e[1])==="$type"?p=p.concat(Ql({key:`${n}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&p.push(new yi(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)p=p.concat(Vl({key:`${n}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=vr(e[1]),e.length!==2?p.push(new yi(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&p.push(new yi(`${n}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=vr(e[1]),e.length!==2?p.push(new yi(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&p.push(new yi(`${n}[1]`,e[1],`object expected, ${a} found`))}return p}function tc(i,e){const n=i.key,s=i.style,a=i.styleSpec,p=i.value,y=i.objectKey,T=a[`${e}_${i.layerType}`];if(!T)return[];const P=y.match(/^(.*)-transition$/);if(e==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return bn({key:n,value:p,valueSpec:a.transition,style:s,styleSpec:a});const O=i.valueSpec||T[y];if(!O)return[new yi(n,p,`unknown property "${y}"`)];let j;if(vr(p)==="string"&&Oa(O)&&!O.tokens&&(j=/^{([^}]+)}$/.exec(p))){const $=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new yi(n,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const G=[];return i.layerType==="symbol"&&(y==="text-field"&&s&&!s.glyphs&&G.push(new yi(n,p,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&ol(ur(p))&&Gr(p.type)==="identity"&&G.push(new yi(n,p,'"text-font" does not support identity functions'))),G.concat(bn({key:i.key,value:p,valueSpec:O,style:s,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:y}))}function Ho(i){return tc(i,"paint")}function ms(i){return tc(i,"layout")}function ch(i){let e=[];const n=i.value,s=i.key,a=i.style,p=i.styleSpec;n.type||n.ref||e.push(new yi(s,n,'either "type" or "ref" is required'));let y=Gr(n.type);const T=Gr(n.ref);if(n.id){const P=Gr(n.id);for(let O=0;O<i.arrayIndex;O++){const j=a.layers[O];Gr(j.id)===P&&e.push(new yi(s,n.id,`duplicate layer id "${n.id}", previously used at line ${j.id.__line__}`))}}if("ref"in n){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in n&&e.push(new yi(s,n[O],`"${O}" is prohibited for ref layers`))}),a.layers.forEach(O=>{Gr(O.id)===T&&(P=O)}),P?P.ref?e.push(new yi(s,n.ref,"ref cannot reference another ref layer")):y=Gr(P.type):typeof T=="string"&&e.push(new yi(s,n.ref,`ref layer "${T}" not found`))}else if(y!=="background"&&y!=="sky")if(n.source){const P=a.sources&&a.sources[n.source],O=P&&Gr(P.type);P?O==="vector"&&y==="raster"?e.push(new yi(s,n.source,`layer "${n.id}" requires a raster source`)):O==="raster"&&y!=="raster"?e.push(new yi(s,n.source,`layer "${n.id}" requires a vector source`)):O!=="vector"||n["source-layer"]?O==="raster-dem"&&y!=="hillshade"?e.push(new yi(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||O==="geojson"&&P.lineMetrics||e.push(new yi(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new yi(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new yi(s,n.source,`source "${n.source}" not found`))}else e.push(new yi(s,n,'missing required property "source"'));return e=e.concat(so({key:s,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bn({key:`${s}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:P=>As(Wn({layerType:y},P)),layout:P=>so({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>ms(Wn({layerType:y},O))}}),paint:P=>so({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>Ho(Wn({layerType:y},O))}})}})),e}function oa(i){const e=i.value,n=i.key,s=vr(e);return s!=="string"?[new yi(n,e,`string expected, ${s} found`)]:[]}const Tc={promoteId:function({key:i,value:e}){if(vr(e)==="string")return oa({key:i,value:e});{const n=[];for(const s in e)n.push(...oa({key:`${i}.${s}`,value:e[s]}));return n}}};function Cc(i){const e=i.value,n=i.key,s=i.styleSpec,a=i.style;if(!e.type)return[new yi(n,e,'"type" is required')];const p=Gr(e.type);let y;switch(p){case"vector":case"raster":case"raster-dem":return y=so({key:n,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Tc}),y;case"geojson":if(y=so({key:n,value:e,valueSpec:s.source_geojson,style:a,styleSpec:s,objectElementValidators:Tc}),e.cluster)for(const T in e.clusterProperties){const[P,O]=e.clusterProperties[T],j=typeof P=="string"?[P,["accumulated"],["get",T]]:P;y.push(...Fn({key:`${n}.${T}.map`,value:O,expressionContext:"cluster-map"})),y.push(...Fn({key:`${n}.${T}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return y;case"video":return so({key:n,value:e,valueSpec:s.source_video,style:a,styleSpec:s});case"image":return so({key:n,value:e,valueSpec:s.source_image,style:a,styleSpec:s});case"canvas":return[new yi(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ql({key:`${n}.type`,value:e.type,valueSpec:{values:hh(s)},style:a,styleSpec:s})}}function hh(i){return i.source.reduce((e,n)=>{const s=i[n];return s.type.type==="enum"&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Ac(i){const e=i.value,n=i.styleSpec,s=n.light,a=i.style;let p=[];const y=vr(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new yi("light",e,`object expected, ${y} found`)]),p;for(const T in e){const P=T.match(/^(.*)-transition$/);p=p.concat(P&&s[P[1]]&&s[P[1]].transition?bn({key:T,value:e[T],valueSpec:n.transition,style:a,styleSpec:n}):s[T]?bn({key:T,value:e[T],valueSpec:s[T],style:a,styleSpec:n}):[new yi(T,e[T],`unknown property "${T}"`)])}return p}function Ec(i){const e=i.value,n=i.key,s=i.style,a=i.styleSpec,p=a.terrain;let y=[];const T=vr(e);if(e===void 0)return y;if(T!=="object")return y=y.concat([new yi("terrain",e,`object expected, ${T} found`)]),y;for(const P in e){const O=P.match(/^(.*)-transition$/);y=y.concat(O&&p[O[1]]&&p[O[1]].transition?bn({key:P,value:e[P],valueSpec:a.transition,style:s,styleSpec:a}):p[P]?bn({key:P,value:e[P],valueSpec:p[P],style:s,styleSpec:a}):[new yi(P,e[P],`unknown property "${P}"`)])}if(e.source){const P=s.sources&&s.sources[e.source],O=P&&Gr(P.type);P?O!=="raster-dem"&&y.push(new yi(n,e.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):y.push(new yi(n,e.source,`source "${e.source}" not found`))}else y.push(new yi(n,e,'terrain is missing required property "source"'));return y}function ql(i){const e=i.value,n=i.style,s=i.styleSpec,a=s.fog;let p=[];const y=vr(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new yi("fog",e,`object expected, ${y} found`)]),p;for(const T in e){const P=T.match(/^(.*)-transition$/);p=p.concat(P&&a[P[1]]&&a[P[1]].transition?bn({key:T,value:e[T],valueSpec:s.transition,style:n,styleSpec:s}):a[T]?bn({key:T,value:e[T],valueSpec:a[T],style:n,styleSpec:s}):[new yi(T,e[T],`unknown property "${T}"`)])}return p}const Gl={"*":()=>[],array:oh,boolean:function(i){const e=i.value,n=i.key,s=vr(e);return s!=="boolean"?[new yi(n,e,`boolean expected, ${s} found`)]:[]},number:hl,color:function(i){const e=i.key,n=i.value,s=vr(n);return s!=="string"?[new yi(e,n,`color expected, ${s} found`)]:Ss(n)===null?[new yi(e,n,`color expected, "${n}" found`)]:[]},enum:Ql,filter:As,function:jl,layer:ch,object:so,source:Cc,light:Ac,terrain:Ec,fog:ql,string:oa,formatted:function(i){return oa(i).length===0?[]:Fn(i)},resolvedImage:function(i){return oa(i).length===0?[]:Fn(i)},projection:function(i){const e=i.value,n=i.styleSpec,s=n.projection,a=i.style;let p=[];const y=vr(e);if(y==="object")for(const T in e)p=p.concat(bn({key:T,value:e[T],valueSpec:s[T],style:a,styleSpec:n}));else y!=="string"&&(p=p.concat([new yi("projection",e,`object or string expected, ${y} found`)]));return p}};function bn(i){const e=i.value,n=i.valueSpec,s=i.styleSpec;return n.expression&&ol(Gr(e))?jl(i):n.expression&&Wo(ur(e))?Fn(i):n.type&&Gl[n.type]?Gl[n.type](i):so(Wn({},i,{valueSpec:n.type?s[n.type]:n}))}function Pc(i){const e=i.value,n=i.key,s=oa(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new yi(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new yi(n,e,'"glyphs" url must include a "{range}" token'))),s}function Mc(i,e=Ut){return Fs(bn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Pc,"*":()=>[]}}))}const jh=i=>Fs(Ho(i)),uh=i=>Fs(ms(i));function Fs(i){return i.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function fh(i,e){let n=!1;if(e&&e.length)for(const s of e)i.fire(new bs(new Error(s.message))),n=!0;return n}var Uh=wo,oo=3;function wo(i,e,n){var s=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var a=new Int32Array(this.arrayBuffer);i=a[0],this.d=(e=a[1])+2*(n=a[2]);for(var p=0;p<this.d*this.d;p++){var y=a[oo+p],T=a[oo+p+1];s.push(y===T?null:a.subarray(y,T))}var P=a[oo+s.length+1];this.keys=a.subarray(a[oo+s.length],P),this.bboxes=a.subarray(P),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var O=0;O<this.d*this.d;O++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var j=n/e*i;this.min=-j,this.max=i+j}wo.prototype.insert=function(i,e,n,s,a){this._forEachCell(e,n,s,a,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(a)},wo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},wo.prototype._insertCell=function(i,e,n,s,a,p){this.cells[a].push(p)},wo.prototype.query=function(i,e,n,s,a){var p=this.min,y=this.max;if(i<=p&&e<=p&&y<=n&&y<=s&&!a)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,e,n,s,this._queryCell,T,{},a),T},wo.prototype._queryCell=function(i,e,n,s,a,p,y,T){var P=this.cells[a];if(P!==null)for(var O=this.keys,j=this.bboxes,G=0;G<P.length;G++){var $=P[G];if(y[$]===void 0){var Z=4*$;(T?T(j[Z+0],j[Z+1],j[Z+2],j[Z+3]):i<=j[Z+2]&&e<=j[Z+3]&&n>=j[Z+0]&&s>=j[Z+1])?(y[$]=!0,p.push(O[$])):y[$]=!1}}},wo.prototype._forEachCell=function(i,e,n,s,a,p,y,T){for(var P=this._convertToCellCoord(i),O=this._convertToCellCoord(e),j=this._convertToCellCoord(n),G=this._convertToCellCoord(s),$=P;$<=j;$++)for(var Z=O;Z<=G;Z++){var Q=this.d*Z+$;if((!T||T(this._convertFromCellCoord($),this._convertFromCellCoord(Z),this._convertFromCellCoord($+1),this._convertFromCellCoord(Z+1)))&&a.call(this,i,e,n,s,Q,p,y,T))return}},wo.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},wo.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},wo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=oo+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var a=new Int32Array(e+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var p=e,y=0;y<i.length;y++){var T=i[y];a[oo+y]=p,a.set(T,p),p+=T.length}return a[oo+i.length]=p,a.set(this.keys,p),a[oo+i.length+1]=p+=this.keys.length,a.set(this.bboxes,p),p+=this.bboxes.length,a.buffer};var Ra=B(Uh);const Wl={};function bi(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Wl[e]={klass:i,omit:n.omit||[]}}bi(Object,"Object"),Ra.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ra.deserialize=function(i){return new Ra(i.buffer)},Object.defineProperty(Ra,"name",{value:"Grid"}),bi(Ra,"Grid"),bi(Mi,"Color"),bi(Error,"Error"),bi(or,"AJAXError"),bi(pr,"ResolvedImage"),bi(cl,"StylePropertyFunction"),bi(Bl,"StyleExpression",{omit:["_evaluator"]}),bi(ll,"ZoomDependentExpression"),bi(Nl,"ZoomConstantExpression"),bi(Qs,"CompoundExpression",{omit:["_evaluate"]});for(const i in Ds)Wl[Ds[i]._classRegistryKey]||bi(Ds[i],`Expression${i}`);function Lc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ic(i){return l.ImageBitmap&&i instanceof l.ImageBitmap}function Ba(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Lc(i)||Ic(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof l.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(Ba(s,e));return n}if(typeof i=="object"){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const a=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const p in i)i.hasOwnProperty(p)&&(Wl[s].omit.indexOf(p)>=0||(a[p]=Ba(i[p],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof i)}function E(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Lc(i)||Ic(i)||ArrayBuffer.isView(i)||i instanceof l.ImageData)return i;if(Array.isArray(i))return i.map(E);if(typeof i=="object"){const e=i.$name||"Object",{klass:n}=Wl[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const a of Object.keys(i))a!=="$name"&&(s[a]=E(i[a]));return s}throw new Error("can't deserialize object of type "+typeof i)}const k={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function W(i){for(const e of i)if(ye(e.charCodeAt(0)))return!0;return!1}function J(i){for(const e of i)if(!de(e.charCodeAt(0)))return!1;return!0}function de(i){return!(k.Arabic(i)||k["Arabic Supplement"](i)||k["Arabic Extended-A"](i)||k["Arabic Presentation Forms-A"](i)||k["Arabic Presentation Forms-B"](i))}function ye(i){return!(i!==746&&i!==747&&(i<4352||!(k["Bopomofo Extended"](i)||k.Bopomofo(i)||k["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||k["CJK Compatibility Ideographs"](i)||k["CJK Compatibility"](i)||k["CJK Radicals Supplement"](i)||k["CJK Strokes"](i)||!(!k["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||k["CJK Unified Ideographs Extension A"](i)||k["CJK Unified Ideographs"](i)||k["Enclosed CJK Letters and Months"](i)||k["Hangul Compatibility Jamo"](i)||k["Hangul Jamo Extended-A"](i)||k["Hangul Jamo Extended-B"](i)||k["Hangul Jamo"](i)||k["Hangul Syllables"](i)||k.Hiragana(i)||k["Ideographic Description Characters"](i)||k.Kanbun(i)||k["Kangxi Radicals"](i)||k["Katakana Phonetic Extensions"](i)||k.Katakana(i)&&i!==12540||!(!k["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!k["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||k["Unified Canadian Aboriginal Syllabics"](i)||k["Unified Canadian Aboriginal Syllabics Extended"](i)||k["Vertical Forms"](i)||k["Yijing Hexagram Symbols"](i)||k["Yi Syllables"](i)||k["Yi Radicals"](i))))}function be(i){return!(ye(i)||function(e){return!!(k["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||k["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||k["Letterlike Symbols"](e)||k["Number Forms"](e)||k["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||k["Control Pictures"](e)&&e!==9251||k["Optical Character Recognition"](e)||k["Enclosed Alphanumerics"](e)||k["Geometric Shapes"](e)||k["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||k["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||k["CJK Symbols and Punctuation"](e)||k.Katakana(e)||k["Private Use Area"](e)||k["CJK Compatibility Forms"](e)||k["Small Form Variants"](e)||k["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Me(i){return i>=1424&&i<=2303||k["Arabic Presentation Forms-A"](i)||k["Arabic Presentation Forms-B"](i)}function Ie(i,e){return!(!e&&Me(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||k.Khmer(i))}function Ge(i){for(const e of i)if(Me(e.charCodeAt(0)))return!0;return!1}const mt="deferred",Ft="loading",zt="loaded";let St=null,h="unavailable",r=null;const o=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(h="error"),St&&St(i)};function u(){b.fire(new Qn("pluginStateChange",{pluginStatus:h,pluginURL:r}))}const b=new fo,S=function(){return h},I=function(){if(h!==mt||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Ft,u(),r&&qr({url:r},i=>{i?o(i):(h=zt,u())})},F={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===zt||F.applyArabicShaping!=null,isLoading:()=>h===Ft,setState(i){h=i.pluginStatus,r=i.pluginURL},isParsed:()=>F.applyArabicShaping!=null&&F.processBidirectionalText!=null&&F.processStyledBidirectionalText!=null,getPluginURL:()=>r};class N{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const a of n)if(!Ie(a.charCodeAt(0),s))return!1;return!0}(e,F.isLoaded())}}class H{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,a){if(ol(s))return new cl(s,a);if(Wo(s)){const p=Fa(s,a);if(p.result==="error")throw new Error(p.value.map(y=>`${y.key}: ${y.message}`).join(", "));return p.value}{let p=s;return typeof s=="string"&&a.type==="color"&&(p=Mi.parse(s)),{kind:"constant",evaluate:()=>p}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class X{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,n){return new me(this.property,this.value,n,ce({},e.transition,this.transition),e.now)}untransitioned(){return new me(this.property,this.value,null,{},0)}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ht(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new X(this._values[e].property)),this._values[e].value=new H(this._values[e].property,n===null?void 0:ht(n))}getTransition(e){return ht(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new X(this._values[e].property)),this._values[e].transition=ht(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const a=this.getTransition(n);a!==void 0&&(e[`${n}-transition`]=a)}return e}transitioned(e,n){const s=new xe(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(e,n._values[a]);return s}untransitioned(){const e=new xe(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class me{constructor(e,n,s,a,p){const y=a.delay||0,T=a.duration||0;p=p||0,this.property=e,this.value=n,this.begin=p+y,this.end=this.begin+T,e.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const a=e.now||0,p=this.value.possiblyEvaluate(e,n,s),y=this.prior;if(y){if(a>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(a<this.begin)return y.possiblyEvaluate(e,n,s);{const T=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,s),p,at(T))}}return p}}class xe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const a=new Le(this._properties);for(const p of Object.keys(this._values))a._values[p]=this._values[p].possiblyEvaluate(e,n,s);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ht(this._values[e].value)}setValue(e,n){this._values[e]=new H(this._values[e].property,n===null?void 0:ht(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const a=new Le(this._properties);for(const p of Object.keys(this._values))a._values[p]=this._values[p].possiblyEvaluate(e,n,s);return a}}class Pe{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,a){return this.property.evaluate(this.value,this.parameters,e,n,s,a)}}class Le{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ie{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const a=_r[this.specification.type];return a?a(e,n,s):e}}class Ce{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,a){return new Pe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,a)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Pe(this,{kind:"constant",value:void 0},e.parameters);const a=_r[this.specification.type];return a?new Pe(this,{kind:"constant",value:a(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,a,p,y){return e.kind==="constant"?e.value:e.evaluate(n,s,a,p,y)}}class Re{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,a){return!!e.expression.evaluate(n,null,{},s,a)}interpolate(){return!1}}class Ne{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new N(0,{});for(const s in e){const a=e[s];a.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new H(a,void 0),y=this.defaultTransitionablePropertyValues[s]=new X(a);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(n)}}}function et(i,e){return 256*(i=He(Math.floor(i),0,255))+He(Math.floor(e),0,255)}bi(Ce,"DataDrivenProperty"),bi(ie,"DataConstantProperty"),bi(Re,"ColorRampProperty");const Qe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class tt{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _t{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ut(i,e=1){let n=0,s=0;return{members:i.map(a=>{const p=Qe[a.type].BYTES_PER_ELEMENT,y=n=Ct(n,Math.max(e,p)),T=a.components||1;return s=Math.max(s,p),n+=p*T,{name:a.name,type:a.type,components:T,offset:y}}),size:Ct(n,Math.max(s,e)),alignment:e}}function Ct(i,e){return Math.ceil(i/e)*e}class ei extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const a=2*e;return this.int16[a+0]=n,this.int16[a+1]=s,e}}ei.prototype.bytesPerElement=4,bi(ei,"StructArrayLayout2i4");class Tt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,s)}emplace(e,n,s,a){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=s,this.int16[p+2]=a,e}}Tt.prototype.bytesPerElement=6,bi(Tt,"StructArrayLayout3i6");class Gt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,a)}emplace(e,n,s,a,p){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=a,this.int16[y+3]=p,e}}Gt.prototype.bytesPerElement=8,bi(Gt,"StructArrayLayout4i8");class Pt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,a,p,y,T)}emplace(e,n,s,a,p,y,T,P){const O=6*e,j=12*e,G=3*e;return this.int16[O+0]=n,this.int16[O+1]=s,this.uint8[j+4]=a,this.uint8[j+5]=p,this.uint8[j+6]=y,this.uint8[j+7]=T,this.float32[G+2]=P,e}}Pt.prototype.bytesPerElement=12,bi(Pt,"StructArrayLayout2i4ub1f12");class ii extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,a)}emplace(e,n,s,a,p){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=a,this.float32[y+3]=p,e}}ii.prototype.bytesPerElement=16,bi(ii,"StructArrayLayout4f16");class Mt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,a,p)}emplace(e,n,s,a,p,y){const T=6*e,P=3*e;return this.uint16[T+0]=n,this.uint16[T+1]=s,this.uint16[T+2]=a,this.uint16[T+3]=p,this.float32[P+2]=y,e}}Mt.prototype.bytesPerElement=12,bi(Mt,"StructArrayLayout4ui1f12");class Xt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,a)}emplace(e,n,s,a,p){const y=4*e;return this.uint16[y+0]=n,this.uint16[y+1]=s,this.uint16[y+2]=a,this.uint16[y+3]=p,e}}Xt.prototype.bytesPerElement=8,bi(Xt,"StructArrayLayout4ui8");class oi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,a,p,y)}emplace(e,n,s,a,p,y,T){const P=6*e;return this.int16[P+0]=n,this.int16[P+1]=s,this.int16[P+2]=a,this.int16[P+3]=p,this.int16[P+4]=y,this.int16[P+5]=T,e}}oi.prototype.bytesPerElement=12,bi(oi,"StructArrayLayout6i12");class qt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T,P,O,j,G,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,s,a,p,y,T,P,O,j,G,$)}emplace(e,n,s,a,p,y,T,P,O,j,G,$,Z){const Q=12*e;return this.int16[Q+0]=n,this.int16[Q+1]=s,this.int16[Q+2]=a,this.int16[Q+3]=p,this.uint16[Q+4]=y,this.uint16[Q+5]=T,this.uint16[Q+6]=P,this.uint16[Q+7]=O,this.int16[Q+8]=j,this.int16[Q+9]=G,this.int16[Q+10]=$,this.int16[Q+11]=Z,e}}qt.prototype.bytesPerElement=24,bi(qt,"StructArrayLayout4i4ui4i24");class ci extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,a,p,y)}emplace(e,n,s,a,p,y,T){const P=10*e,O=5*e;return this.int16[P+0]=n,this.int16[P+1]=s,this.int16[P+2]=a,this.float32[O+2]=p,this.float32[O+3]=y,this.float32[O+4]=T,e}}ci.prototype.bytesPerElement=20,bi(ci,"StructArrayLayout3i3f20");class Oi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Oi.prototype.bytesPerElement=4,bi(Oi,"StructArrayLayout1ul4");class $i extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T,P,O,j,G,$,Z){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,n,s,a,p,y,T,P,O,j,G,$,Z)}emplace(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q){const ne=20*e,Ae=10*e;return this.int16[ne+0]=n,this.int16[ne+1]=s,this.int16[ne+2]=a,this.int16[ne+3]=p,this.int16[ne+4]=y,this.float32[Ae+3]=T,this.float32[Ae+4]=P,this.float32[Ae+5]=O,this.float32[Ae+6]=j,this.int16[ne+14]=G,this.uint32[Ae+8]=$,this.uint16[ne+18]=Z,this.uint16[ne+19]=Q,e}}$i.prototype.bytesPerElement=40,bi($i,"StructArrayLayout5i4f1i1ul2ui40");class Si extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,a,p,y,T)}emplace(e,n,s,a,p,y,T,P){const O=8*e;return this.int16[O+0]=n,this.int16[O+1]=s,this.int16[O+2]=a,this.int16[O+4]=p,this.int16[O+5]=y,this.int16[O+6]=T,this.int16[O+7]=P,e}}Si.prototype.bytesPerElement=16,bi(Si,"StructArrayLayout3i2i2i16");class zi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,a,p)}emplace(e,n,s,a,p,y){const T=4*e,P=8*e;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=a,this.int16[P+6]=p,this.int16[P+7]=y,e}}zi.prototype.bytesPerElement=16,bi(zi,"StructArrayLayout2f1f2i16");class rr extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,a)}emplace(e,n,s,a,p){const y=12*e,T=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=s,this.float32[T+1]=a,this.float32[T+2]=p,e}}rr.prototype.bytesPerElement=12,bi(rr,"StructArrayLayout2ub2f12");class Xi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,s)}emplace(e,n,s,a){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=s,this.float32[p+2]=a,e}}Xi.prototype.bytesPerElement=12,bi(Xi,"StructArrayLayout3f12");class Pi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,s)}emplace(e,n,s,a){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=s,this.uint16[p+2]=a,e}}Pi.prototype.bytesPerElement=6,bi(Pi,"StructArrayLayout3ui6");class yr extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt)}emplace(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt,rt){const Ot=30*e,kt=15*e,Ht=60*e;return this.int16[Ot+0]=n,this.int16[Ot+1]=s,this.int16[Ot+2]=a,this.float32[kt+2]=p,this.float32[kt+3]=y,this.uint16[Ot+8]=T,this.uint16[Ot+9]=P,this.uint32[kt+5]=O,this.uint32[kt+6]=j,this.uint32[kt+7]=G,this.uint16[Ot+16]=$,this.uint16[Ot+17]=Z,this.uint16[Ot+18]=Q,this.float32[kt+10]=ne,this.float32[kt+11]=Ae,this.uint8[Ht+48]=Fe,this.uint8[Ht+49]=Je,this.uint8[Ht+50]=Be,this.uint32[kt+13]=Ze,this.int16[Ot+28]=nt,this.uint8[Ht+58]=rt,e}}yr.prototype.bytesPerElement=60,bi(yr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Lr extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai){const ui=this.length;return this.resize(ui+1),this.emplace(ui,e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai)}emplace(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae,Fe,Je,Be,Ze,nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai,ui){const Wt=38*e,gi=19*e;return this.int16[Wt+0]=n,this.int16[Wt+1]=s,this.int16[Wt+2]=a,this.float32[gi+2]=p,this.float32[gi+3]=y,this.int16[Wt+8]=T,this.int16[Wt+9]=P,this.int16[Wt+10]=O,this.int16[Wt+11]=j,this.int16[Wt+12]=G,this.int16[Wt+13]=$,this.uint16[Wt+14]=Z,this.uint16[Wt+15]=Q,this.uint16[Wt+16]=ne,this.uint16[Wt+17]=Ae,this.uint16[Wt+18]=Fe,this.uint16[Wt+19]=Je,this.uint16[Wt+20]=Be,this.uint16[Wt+21]=Ze,this.uint16[Wt+22]=nt,this.uint16[Wt+23]=rt,this.uint16[Wt+24]=Ot,this.uint16[Wt+25]=kt,this.uint16[Wt+26]=Ht,this.uint16[Wt+27]=hi,this.uint16[Wt+28]=Nt,this.uint32[gi+15]=Jt,this.float32[gi+16]=Qt,this.float32[gi+17]=ai,this.float32[gi+18]=ui,e}}Lr.prototype.bytesPerElement=76,bi(Lr,"StructArrayLayout3i2f6i15ui1ul3f76");class Tr extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Tr.prototype.bytesPerElement=4,bi(Tr,"StructArrayLayout1f4");class Ir extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,a,p)}emplace(e,n,s,a,p,y){const T=5*e;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=a,this.float32[T+3]=p,this.float32[T+4]=y,e}}Ir.prototype.bytesPerElement=20,bi(Ir,"StructArrayLayout5f20");class Cn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,a)}emplace(e,n,s,a,p){const y=6*e;return this.uint32[3*e+0]=n,this.uint16[y+2]=s,this.uint16[y+3]=a,this.uint16[y+4]=p,e}}Cn.prototype.bytesPerElement=12,bi(Cn,"StructArrayLayout1ul3ui12");class wn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const a=2*e;return this.uint16[a+0]=n,this.uint16[a+1]=s,e}}wn.prototype.bytesPerElement=4,bi(wn,"StructArrayLayout2ui4");class ns extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}ns.prototype.bytesPerElement=2,bi(ns,"StructArrayLayout1ui2");class gs extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const a=2*e;return this.float32[a+0]=n,this.float32[a+1]=s,e}}gs.prototype.bytesPerElement=8,bi(gs,"StructArrayLayout2f8");class Qr extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qr.prototype.size=40;class Dr extends $i{get(e){return new Qr(this,e)}}bi(Dr,"CollisionBoxArray");class xr extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xr.prototype.size=60;class Br extends yr{get(e){return new xr(this,e)}}bi(Br,"PlacedSymbolArray");class ss extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ss.prototype.size=76;class $r extends Lr{get(e){return new ss(this,e)}}bi($r,"SymbolInstanceArray");class _s extends Tr{getoffsetX(e){return this.float32[1*e+0]}}bi(_s,"GlyphOffsetArray");class Xl extends ei{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}bi(Xl,"SymbolLineVertexArray");class So extends tt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}So.prototype.size=12;class pl extends Cn{get(e){return new So(this,e)}}bi(pl,"FeatureIndexArray");class To extends wn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}bi(To,"FillExtrusionCentroidArray");const ao=ut([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),$o=ut([{name:"a_dash",components:4,type:"Uint16"}]);var aa={exports:{}},ml={exports:{}};ml.exports=function(i,e){var n,s,a,p,y,T,P,O;for(s=i.length-(n=3&i.length),a=e,y=3432918353,T=461845907,O=0;O<s;)P=255&i.charCodeAt(O)|(255&i.charCodeAt(++O))<<8|(255&i.charCodeAt(++O))<<16|(255&i.charCodeAt(++O))<<24,++O,a=27492+(65535&(p=5*(65535&(a=(a^=P=(65535&(P=(P=(65535&P)*y+(((P>>>16)*y&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(P=0,n){case 3:P^=(255&i.charCodeAt(O+2))<<16;case 2:P^=(255&i.charCodeAt(O+1))<<8;case 1:a^=P=(65535&(P=(P=(65535&(P^=255&i.charCodeAt(O)))*y+(((P>>>16)*y&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return a^=i.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var kc=ml.exports,Dc={exports:{}};Dc.exports=function(i,e){for(var n,s=i.length,a=e^s,p=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:a^=(255&i.charCodeAt(p+2))<<16;case 2:a^=(255&i.charCodeAt(p+1))<<8;case 1:a=1540483477*(65535&(a^=255&i.charCodeAt(p)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var Vh=kc,qh=Dc.exports;aa.exports=Vh,aa.exports.murmur3=Vh,aa.exports.murmur2=qh;var la=B(aa.exports);class Oc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,a){this.ids.push(Gh(e)),this.positions.push(n,s,a)}getPositions(e){const n=Gh(e);let s=0,a=this.ids.length-1;for(;s<a;){const y=s+a>>1;this.ids[y]>=n?a=y:s=y+1}const p=[];for(;this.ids[s]===n;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(e,n){const s=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Wh(s,a,0,s.length-1),n&&n.push(s.buffer,a.buffer),{ids:s,positions:a}}static deserialize(e){const n=new Oc;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Gh(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:la(String(i))}function Wh(i,e,n,s){for(;n<s;){const a=i[n+s>>1];let p=n-1,y=s+1;for(;;){do p++;while(i[p]<a);do y--;while(i[y]>a);if(p>=y)break;Fc(i,p,y),Fc(e,3*p,3*y),Fc(e,3*p+1,3*y+1),Fc(e,3*p+2,3*y+2)}y-n<s-y?(Wh(i,e,n,y),n=y+1):(Wh(i,e,y+1,s),s=y)}}function Fc(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}bi(Oc,"FeaturePositionMap");class zs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class dh extends zs{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Xh extends zs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Nu extends zs{constructor(e){super(e),this.current=Mi.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const ju=new Float32Array(16),Of=new Float32Array(9),zc=new Float32Array(4);function Rc(i){return[et(255*i.r,255*i.g),et(255*i.b,255*i.a)]}class gl{constructor(e,n,s){this.value=e,this.uniformNames=n.map(a=>`u_${a}`),this.type=s}setUniform(e,n,s,a,p){n.set(e,p,a.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new Nu(e):new dh(e)}}class Rs{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,a,p){const y=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;y&&n.set(e,p,y)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Xh(e):new dh(e)}}class ys{constructor(e,n,s,a){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,n,s,a,p,y){const T=this.paintVertexArray.length,P=this.expression.evaluate(new N(0),n,{},p,a,y);this.paintVertexArray.resize(e),this._setPaintValue(T,e,P)}updatePaintArray(e,n,s,a,p){const y=this.expression.evaluate({zoom:0},s,a,void 0,p);this._setPaintValue(e,n,y)}_setPaintValue(e,n,s){if(this.type==="color"){const a=Rc(s);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a[0],a[1])}else{for(let a=e;a<n;a++)this.paintVertexArray.emplace(a,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yn{constructor(e,n,s,a,p,y){this.expression=e,this.uniformNames=n.map(T=>`u_${T}_t`),this.type=s,this.useIntegerZoom=a,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map(T=>({name:`a_${T}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,s,a,p,y){const T=this.expression.evaluate(new N(this.zoom),n,{},p,a,y),P=this.expression.evaluate(new N(this.zoom+1),n,{},p,a,y),O=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(O,e,T,P)}updatePaintArray(e,n,s,a,p){const y=this.expression.evaluate({zoom:this.zoom},s,a,void 0,p),T=this.expression.evaluate({zoom:this.zoom+1},s,a,void 0,p);this._setPaintValue(e,n,y,T)}_setPaintValue(e,n,s,a){if(this.type==="color"){const p=Rc(s),y=Rc(a);for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,p[0],p[1],y[0],y[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,a,p){const y=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,T=He(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);n.set(e,p,T)}getBinding(e,n){return new dh(e)}}class Yo{constructor(e,n,s,a,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(s==="array"?$o:ao).members;for(let y=0;y<n.length;++y);this.paintVertexArray=new a}populatePaintArray(e,n,s){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,a,p,y){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],y)}_setPaintValues(e,n,s,a){if(!a||!s)return;const p=a[s];if(!p)return;const{tl:y,br:T,pixelRatio:P}=p;for(let O=e;O<n;O++)this.paintVertexArray.emplace(O,y[0],y[1],T[0],T[1],P)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ca{constructor(e,n,s=()=>!0){this.binders={},this._buffers=[];const a=[];for(const p in e.paint._values){if(!s(p))continue;const y=e.paint.get(p);if(!(y instanceof Pe&&Oa(y.property.specification)))continue;const T=Hh(p,e.type),P=y.value,O=y.property.specification.type,j=!!y.property.useIntegerZoom,G=p==="line-dasharray"||p.endsWith("pattern"),$=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||$)if(P.kind==="source"||$||G){const Z=Ep(p,O,"source");this.binders[p]=G?new Yo(P,T,O,Z,e.id):new ys(P,T,O,Z),a.push(`/a_${p}`)}else{const Z=Ep(p,O,"composite");this.binders[p]=new Yn(P,T,O,j,n,Z),a.push(`/z_${p}`)}else this.binders[p]=G?new Rs(P.value,T):new gl(P.value,T,O),a.push(`/u_${p}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ys||n instanceof Yn?n.maxValue:0}populatePaintArrays(e,n,s,a,p,y){for(const T in this.binders){const P=this.binders[T];(P instanceof ys||P instanceof Yn||P instanceof Yo)&&P.populatePaintArray(e,n,s,a,p,y)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Rs&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,a,p,y){let T=!1;for(const P in e){const O=n.getPositions(P);for(const j of O){const G=s.feature(j.index);for(const $ in this.binders){const Z=this.binders[$];if((Z instanceof ys||Z instanceof Yn||Z instanceof Yo)&&Z.expression.isStateDependent===!0){const Q=a.paint.get($);Z.expression=Q.value,Z.updatePaintArray(j.start,j.end,G,e[P],p,y),T=!0}}}}return T}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof gl||s instanceof Rs)&&e.push(...s.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof ys||s instanceof Yn||s instanceof Yo)for(let a=0;a<s.paintVertexAttributes.length;a++)e.push(s.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof gl||s instanceof Rs||s instanceof Yn)for(const a of s.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof gl||a instanceof Rs||a instanceof Yn)for(const p of a.uniformNames)n.push({name:p,property:s,binding:a.getBinding(e,p)})}return n}setUniforms(e,n,s,a,p){for(const{name:y,property:T,binding:P}of s)this.binders[T].setUniform(e,P,p,a.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof ys||n instanceof Yn||n instanceof Yo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof ys||s instanceof Yn||s instanceof Yo)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ys||n instanceof Yn||n instanceof Yo)&&n.destroy()}}}class _l{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new ca(a,n,s);this.needsUpload=!1,this._featureMap=new Oc,this._bufferOffset=0}populatePaintArrays(e,n,s,a,p,y,T){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,n,a,p,y,T);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,a,p){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,n,y,a,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ff={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Hh(i,e){return Ff[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const $h={"line-pattern":{source:Mt,composite:Mt},"fill-pattern":{source:Mt,composite:Mt},"fill-extrusion-pattern":{source:Mt,composite:Mt},"line-dasharray":{source:Xt,composite:Xt}},H_={color:{source:gs,composite:ii},number:{source:Tr,composite:gs}};function Ep(i,e,n){const s=$h[i];return s&&s[n]||H_[e][n]}bi(gl,"ConstantBinder"),bi(Rs,"PatternConstantBinder"),bi(ys,"SourceExpressionBinder"),bi(Yo,"PatternCompositeBinder"),bi(Yn,"CompositeExpressionBinder"),bi(ca,"ProgramConfiguration",{omit:["_buffers"]}),bi(_l,"ProgramConfigurationSet");const Pp="-transition";class Na extends fo{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Ee(n.layout)),n.paint)){this._transitionablePaint=new ee(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Le(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(uh,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return gt(e,Pp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(jh,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(gt(e,Pp))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const a=this._transitionablePaint._values[e],p=a.value.isDataDriven(),y=a.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value,P=T.isDataDriven(),O=gt(e,"pattern")||e==="line-dasharray";return P||p||O||this._handleOverridablePaintPropertyUpdate(e,y,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Bt(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,a,p={}){return(!p||p.validate!==!1)&&fh(this,e.call(Mc,{key:n,layerType:this.type,objectKey:s,value:a,styleSpec:Ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Pe&&Oa(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ul(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const $_=ut([{name:"a_pos",components:2,type:"Int16"}],4),Y_=ut([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class An{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,a){let p=this.segments[this.segments.length-1];return e>An.MAX_VERTEX_ARRAY_LENGTH&&Xe(`Max vertices per segment is ${An.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>An.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==a)&&(p={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},a!==void 0&&(p.sortKey=a),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,a){return new An([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}An.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bi(An,"SegmentVector");var Bi=8192;class ic{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Nr?new Nr(e.lng,e.lat):Nr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Nr?new Nr(e.lng,e.lat):Nr.convert(e),this}extend(e){const n=this._sw,s=this._ne;let a,p;if(e instanceof Nr)a=e,p=e;else{if(!(e instanceof ic))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ic.convert(e)):this.extend(Nr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Nr.convert(e)):this;if(a=e._sw,p=e._ne,!a||!p)return this}return n||s?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new Nr(a.lng,a.lat),this._ne=new Nr(p.lng,p.lat)),this}getCenter(){return new Nr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nr(this.getWest(),this.getNorth())}getSouthEast(){return new Nr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Nr.convert(e);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(e){return!e||e instanceof ic?e:new ic(e)}}var Uu=1e-6,Co=typeof Float32Array<"u"?Float32Array:Array;function Mp(){var i=new Co(9);return Co!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Lp(i,e,n){var s=e[0],a=e[1],p=e[2],y=e[3],T=e[4],P=e[5],O=e[6],j=e[7],G=e[8],$=n[0],Z=n[1],Q=n[2],ne=n[3],Ae=n[4],Fe=n[5],Je=n[6],Be=n[7],Ze=n[8];return i[0]=$*s+Z*y+Q*O,i[1]=$*a+Z*T+Q*j,i[2]=$*p+Z*P+Q*G,i[3]=ne*s+Ae*y+Fe*O,i[4]=ne*a+Ae*T+Fe*j,i[5]=ne*p+Ae*P+Fe*G,i[6]=Je*s+Be*y+Ze*O,i[7]=Je*a+Be*T+Ze*j,i[8]=Je*p+Be*P+Ze*G,i}function ja(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zf(i,e){var n=e[0],s=e[1],a=e[2],p=e[3],y=e[4],T=e[5],P=e[6],O=e[7],j=e[8],G=e[9],$=e[10],Z=e[11],Q=e[12],ne=e[13],Ae=e[14],Fe=e[15],Je=n*T-s*y,Be=n*P-a*y,Ze=n*O-p*y,nt=s*P-a*T,rt=s*O-p*T,Ot=a*O-p*P,kt=j*ne-G*Q,Ht=j*Ae-$*Q,hi=j*Fe-Z*Q,Nt=G*Ae-$*ne,Jt=G*Fe-Z*ne,Qt=$*Fe-Z*Ae,ai=Je*Qt-Be*Jt+Ze*Nt+nt*hi-rt*Ht+Ot*kt;return ai?(i[0]=(T*Qt-P*Jt+O*Nt)*(ai=1/ai),i[1]=(a*Jt-s*Qt-p*Nt)*ai,i[2]=(ne*Ot-Ae*rt+Fe*nt)*ai,i[3]=($*rt-G*Ot-Z*nt)*ai,i[4]=(P*hi-y*Qt-O*Ht)*ai,i[5]=(n*Qt-a*hi+p*Ht)*ai,i[6]=(Ae*Ze-Q*Ot-Fe*Be)*ai,i[7]=(j*Ot-$*Ze+Z*Be)*ai,i[8]=(y*Jt-T*hi+O*kt)*ai,i[9]=(s*hi-n*Jt-p*kt)*ai,i[10]=(Q*rt-ne*Ze+Fe*Je)*ai,i[11]=(G*Ze-j*rt-Z*Je)*ai,i[12]=(T*Ht-y*Nt-P*kt)*ai,i[13]=(n*Nt-s*Ht+a*kt)*ai,i[14]=(ne*Be-Q*nt-Ae*Je)*ai,i[15]=(j*nt-G*Be+$*Je)*ai,i):null}function Bc(i,e,n){var s=e[0],a=e[1],p=e[2],y=e[3],T=e[4],P=e[5],O=e[6],j=e[7],G=e[8],$=e[9],Z=e[10],Q=e[11],ne=e[12],Ae=e[13],Fe=e[14],Je=e[15],Be=n[0],Ze=n[1],nt=n[2],rt=n[3];return i[0]=Be*s+Ze*T+nt*G+rt*ne,i[1]=Be*a+Ze*P+nt*$+rt*Ae,i[2]=Be*p+Ze*O+nt*Z+rt*Fe,i[3]=Be*y+Ze*j+nt*Q+rt*Je,i[4]=(Be=n[4])*s+(Ze=n[5])*T+(nt=n[6])*G+(rt=n[7])*ne,i[5]=Be*a+Ze*P+nt*$+rt*Ae,i[6]=Be*p+Ze*O+nt*Z+rt*Fe,i[7]=Be*y+Ze*j+nt*Q+rt*Je,i[8]=(Be=n[8])*s+(Ze=n[9])*T+(nt=n[10])*G+(rt=n[11])*ne,i[9]=Be*a+Ze*P+nt*$+rt*Ae,i[10]=Be*p+Ze*O+nt*Z+rt*Fe,i[11]=Be*y+Ze*j+nt*Q+rt*Je,i[12]=(Be=n[12])*s+(Ze=n[13])*T+(nt=n[14])*G+(rt=n[15])*ne,i[13]=Be*a+Ze*P+nt*$+rt*Ae,i[14]=Be*p+Ze*O+nt*Z+rt*Fe,i[15]=Be*y+Ze*j+nt*Q+rt*Je,i}function Yh(i,e,n){var s,a,p,y,T,P,O,j,G,$,Z,Q,ne=n[0],Ae=n[1],Fe=n[2];return e===i?(i[12]=e[0]*ne+e[4]*Ae+e[8]*Fe+e[12],i[13]=e[1]*ne+e[5]*Ae+e[9]*Fe+e[13],i[14]=e[2]*ne+e[6]*Ae+e[10]*Fe+e[14],i[15]=e[3]*ne+e[7]*Ae+e[11]*Fe+e[15]):(a=e[1],p=e[2],y=e[3],T=e[4],P=e[5],O=e[6],j=e[7],G=e[8],$=e[9],Z=e[10],Q=e[11],i[0]=s=e[0],i[1]=a,i[2]=p,i[3]=y,i[4]=T,i[5]=P,i[6]=O,i[7]=j,i[8]=G,i[9]=$,i[10]=Z,i[11]=Q,i[12]=s*ne+T*Ae+G*Fe+e[12],i[13]=a*ne+P*Ae+$*Fe+e[13],i[14]=p*ne+O*Ae+Z*Fe+e[14],i[15]=y*ne+j*Ae+Q*Fe+e[15]),i}function Nc(i,e,n){var s=n[0],a=n[1],p=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Rf(i,e,n){var s=Math.sin(n),a=Math.cos(n),p=e[4],y=e[5],T=e[6],P=e[7],O=e[8],j=e[9],G=e[10],$=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*a+O*s,i[5]=y*a+j*s,i[6]=T*a+G*s,i[7]=P*a+$*s,i[8]=O*a-p*s,i[9]=j*a-y*s,i[10]=G*a-T*s,i[11]=$*a-P*s,i}function Vu(i,e,n){var s=Math.sin(n),a=Math.cos(n),p=e[0],y=e[1],T=e[2],P=e[3],O=e[8],j=e[9],G=e[10],$=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*a-O*s,i[1]=y*a-j*s,i[2]=T*a-G*s,i[3]=P*a-$*s,i[8]=p*s+O*a,i[9]=y*s+j*a,i[10]=T*s+G*a,i[11]=P*s+$*a,i}function Ip(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function kp(i,e,n){var s,a,p,y=n[0],T=n[1],P=n[2],O=Math.hypot(y,T,P);return O<Uu?null:(y*=O=1/O,T*=O,P*=O,s=Math.sin(e),a=Math.cos(e),i[0]=y*y*(p=1-a)+a,i[1]=T*y*p+P*s,i[2]=P*y*p-T*s,i[3]=0,i[4]=y*T*p-P*s,i[5]=T*T*p+a,i[6]=P*T*p+y*s,i[7]=0,i[8]=y*P*p+T*s,i[9]=T*P*p-y*s,i[10]=P*P*p+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Z_=Bc;function Bf(){var i=new Co(3);return Co!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Dp(i){var e=new Co(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Zh(i){return Math.hypot(i[0],i[1],i[2])}function ph(i,e,n){var s=new Co(3);return s[0]=i,s[1]=e,s[2]=n,s}function Hl(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function Nf(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function Op(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function Kh(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i}function Jh(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i}function Zo(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function Qh(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i}function Bs(i,e){var n=e[0],s=e[1],a=e[2],p=n*n+s*s+a*a;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i}function ha(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function jf(i,e,n){var s=e[0],a=e[1],p=e[2],y=n[0],T=n[1],P=n[2];return i[0]=a*P-p*T,i[1]=p*y-s*P,i[2]=s*T-a*y,i}function Sn(i,e,n){var s=e[0],a=e[1],p=e[2],y=n[3]*s+n[7]*a+n[11]*p+n[15];return i[0]=(n[0]*s+n[4]*a+n[8]*p+n[12])/(y=y||1),i[1]=(n[1]*s+n[5]*a+n[9]*p+n[13])/y,i[2]=(n[2]*s+n[6]*a+n[10]*p+n[14])/y,i}function Fp(i,e,n){var s=n[0],a=n[1],p=n[2],y=e[0],T=e[1],P=e[2],O=a*P-p*T,j=p*y-s*P,G=s*T-a*y,$=a*G-p*j,Z=p*O-s*G,Q=s*j-a*O,ne=2*n[3];return j*=ne,G*=ne,Z*=2,Q*=2,i[0]=y+(O*=ne)+($*=2),i[1]=T+j+Z,i[2]=P+G+Q,i}var eu,Ua=Nf,K_=Op,J_=Zh;function zp(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}function Rp(i,e){var n=e[0],s=e[1],a=e[2],p=e[3],y=n*n+s*s+a*a+p*p;return y>0&&(y=1/Math.sqrt(y)),i[0]=n*y,i[1]=s*y,i[2]=a*y,i[3]=p*y,i}function jc(i,e,n){var s=e[0],a=e[1],p=e[2],y=e[3];return i[0]=n[0]*s+n[4]*a+n[8]*p+n[12]*y,i[1]=n[1]*s+n[5]*a+n[9]*p+n[13]*y,i[2]=n[2]*s+n[6]*a+n[10]*p+n[14]*y,i[3]=n[3]*s+n[7]*a+n[11]*p+n[15]*y,i}function Bp(){var i=new Co(4);return Co!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Np(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function jp(i,e,n){n*=.5;var s=e[0],a=e[1],p=e[2],y=e[3],T=Math.sin(n),P=Math.cos(n);return i[0]=s*P+y*T,i[1]=a*P+p*T,i[2]=p*P-a*T,i[3]=y*P-s*T,i}function Up(i,e,n){n*=.5;var s=e[0],a=e[1],p=e[2],y=e[3],T=Math.sin(n),P=Math.cos(n);return i[0]=s*P-p*T,i[1]=a*P+y*T,i[2]=p*P+s*T,i[3]=y*P-a*T,i}Bf(),eu=new Co(4),Co!=Float32Array&&(eu[0]=0,eu[1]=0,eu[2]=0,eu[3]=0);var Q_=Rp;Bf(),ph(1,0,0),ph(0,1,0),Bp(),Bp(),Mp();const e0=ut([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vp}=e0,qp=ut([{name:"a_pos_3",components:3,type:"Int16"}]);var tu=ut([{name:"a_pos",type:"Int16",components:2}]);class Uf{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const a=ha(n,this.dir);if(Math.abs(a)<1e-6)return!1;const p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/a;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,n,s){if(function(Z,Q){var ne=Z[0],Ae=Z[1],Fe=Z[2],Je=Q[0],Be=Q[1],Ze=Q[2];return Math.abs(ne-Je)<=Uu*Math.max(1,Math.abs(ne),Math.abs(Je))&&Math.abs(Ae-Be)<=Uu*Math.max(1,Math.abs(Ae),Math.abs(Be))&&Math.abs(Fe-Ze)<=Uu*Math.max(1,Math.abs(Fe),Math.abs(Ze))}(this.pos,e)||n===0)return s[0]=s[1]=s[2]=0,!1;const[a,p,y]=this.dir,T=this.pos[0]-e[0],P=this.pos[1]-e[1],O=this.pos[2]-e[2],j=a*a+p*p+y*y,G=2*(T*a+P*p+O*y),$=G*G-4*j*(T*T+P*P+O*O-n*n);if($<0){const Z=Math.max(-G/2,0),Q=T+a*Z,ne=P+p*Z,Ae=O+y*Z,Fe=Math.hypot(Q,ne,Ae);return s[0]=Q*n/Fe,s[1]=ne*n/Fe,s[2]=Ae*n/Fe,!1}{const Z=(-G-Math.sqrt($))/(2*j);if(Z<0){const Q=Math.hypot(T,P,O);return s[0]=T*n/Q,s[1]=P*n/Q,s[2]=O*n/Q,!1}return s[0]=T+a*Z,s[1]=P+p*Z,s[2]=O+y*Z,!0}}}class Vf{constructor(e,n,s,a,p){this.TL=e,this.TR=n,this.BR=s,this.BL=a,this.horizon=p}static fromInvProjectionMatrix(e,n,s){const a=[-1,1,1],p=[1,1,1],y=[1,-1,1],T=[-1,-1,1],P=Sn(a,a,e),O=Sn(p,p,e),j=Sn(y,y,e),G=Sn(T,T,e);return new Vf(P,O,j,G,n/s)}}class qf{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,a){const p=Math.pow(2,s),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const O=jc([],P,e),j=1/O[3]/n*p;return function(G,$,Z){return G[0]=$[0]*Z[0],G[1]=$[1]*Z[1],G[2]=$[2]*Z[2],G[3]=$[3]*Z[3],G}(O,O,[j,j,a?1/O[3]:j,j])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const O=Bs([],jf([],Ua([],y[P[0]],y[P[1]]),Ua([],y[P[2]],y[P[1]]))),j=-ha(O,y[P[1]]);return O.concat(j)});return new qf(y,T)}}class Ns{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of e)Kh(n,n,a),Jh(s,s,a);return new Ns(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let a=0;a<s.length;++a)Sn(s[a],s[a],n);return Ns.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=Zo([],Hl([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=Dp(this.min),a=Dp(this.max);for(let p=0;p<n.length;p++)s[p]=n[p]?this.min[p]:this.center[p],a[p]=n[p]?this.center[p]:this.max[p];return a[2]=this.max[2],new Ns(s,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let a=0;a<e.planes.length;a++){const p=e.planes[a];let y=0;for(let T=0;T<n.length;T++)y+=ha(p,n[T])+p[3]>=0;if(y===0)return 0;y!==n.length&&(s=!1)}if(s)return 2;for(let a=0;a<3;a++){let p=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const P=e.points[T][a]-this.min[a];p=Math.min(p,P),y=Math.max(y,P)}if(y<0||p>this.max[a]-this.min[a])return 0}return 1}}const Gf=5,Gp=6,yl=Bi/Math.PI/2,t0=16383,Uc=64,iu=[Uc,32,16],ua=-yl,fa=yl,i0=[new Ns([ua,ua,ua],[fa,fa,fa]),new Ns([ua,ua,ua],[0,0,fa]),new Ns([0,ua,ua],[fa,0,fa]),new Ns([ua,0,ua],[0,fa,fa]),new Ns([0,0,ua],[fa,fa,fa])];function qu(i){return i*yl/su}function Wp(i,e,n,s=!0){const a=Zo([],i._camera.position,i.worldSize),p=[e,n,1,1];jc(p,p,i.pixelMatrixInverse),zp(p,p,1/p[3]);const y=Bs([],Ua([],p,a)),T=i.globeMatrix,P=[T[12],T[13],T[14]],O=Ua([],P,a),j=Zh(O),G=Bs([],O),$=i.worldSize/(2*Math.PI),Z=ha(G,y),Q=Math.asin($/j);if(Q<Math.acos(Z)){if(!s)return null;const hi=[],Nt=[];Zo(hi,y,j/Z),Bs(Nt,Ua(Nt,hi,O)),Bs(y,Hl(y,O,Zo(y,Nt,Math.tan(Q)*j)))}const ne=[];new Uf(a,y).closestPointOnSphere(P,$,ne);const Ae=Bs([],ri(T,0)),Fe=Bs([],ri(T,1)),Je=Bs([],ri(T,2)),Be=ha(Ae,ne),Ze=ha(Fe,ne),nt=ha(Je,ne),rt=ze(Math.asin(-Ze/$));let Ot=ze(Math.atan2(Be,nt));Ot=i.center.lng+function(hi,Nt){const Jt=(Nt-hi+180)%360-180;return Jt<-180?Jt+360:Jt}(i.center.lng,Ot);const kt=xl(Ot),Ht=He(bl(rt),0,1);return new yh(kt,Ht)}class r0{constructor(e,n,s){this.a=Ua([],e,s),this.b=Ua([],n,s),this.center=s;const a=Bs([],this.a),p=Bs([],this.b);this.angle=Math.acos(ha(a,p))}}function Wf(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(s,a,p,y){const T=Math.sin(p);return s*(Math.sin((1-y)*p)/T)+a*(Math.sin(y*p)/T)}(i.a[e],i.b[e],i.angle,He(n,0,1))+i.center[e]}function vl(i){if(i.z<=1)return i0[i.z+2*i.y+i.x];const e=Xf(Gu(i));return Ns.fromPoints(e)}function Vc(i,e,n){return Zo(i,i,1-n),Qh(i,i,e,n)}function Xp(i,e){const n=_h(e.zoom);if(n===0)return vl(i);const s=Gu(i),a=Xf(s),p=xl(s.getWest())*e.worldSize,y=xl(s.getEast())*e.worldSize,T=bl(s.getNorth())*e.worldSize,P=bl(s.getSouth())*e.worldSize,O=[p,T,0],j=[y,T,0],G=[p,P,0],$=[y,P,0],Z=zf([],e.globeMatrix);return Sn(O,O,Z),Sn(j,j,Z),Sn(G,G,Z),Sn($,$,Z),a[0]=Vc(a[0],G,n),a[1]=Vc(a[1],$,n),a[2]=Vc(a[2],j,n),a[3]=Vc(a[3],O,n),Ns.fromPoints(a)}function Hp(i,e,n){for(const s of i)Sn(s,s,e),Zo(s,s,n)}function n0(i,e,n){const s=e/i.worldSize,a=i.globeMatrix;if(n.z<=1){const kt=vl(n).getCorners();return Hp(kt,a,s),Ns.fromPoints(kt)}const p=Gu(n),y=Xf(p);Hp(y,a,s);const T=Number.MAX_VALUE,P=[-T,-T,-T],O=[T,T,T];if(p.contains(i.center)){for(const hi of y)Kh(O,O,hi),Jh(P,P,hi);P[2]=0;const kt=i.point,Ht=[kt.x*s,kt.y*s,0];return Kh(O,O,Ht),Jh(P,P,Ht),new Ns(O,P)}const j=[a[12]*s,a[13]*s,a[14]*s],G=p.getCenter(),$=He(i.center.lat,-xs,xs),Z=He(G.lat,-xs,xs),Q=xl(i.center.lng),ne=bl($);let Ae=Q-xl(G.lng);const Fe=ne-bl(Z);Ae>.5?Ae-=1:Ae<-.5&&(Ae+=1);let Je=0;Math.abs(Ae)>Math.abs(Fe)?Je=Ae>=0?1:3:(Je=Fe>=0?0:2,Qh(j,j,[a[4]*s,a[5]*s,a[6]*s],-Math.sin(pe(Fe>=0?p.getSouth():p.getNorth()))*yl));const Be=y[Je],Ze=y[(Je+1)%4],nt=new r0(Be,Ze,j),rt=[Wf(nt,0)||Be[0],Wf(nt,1)||Be[1],Wf(nt,2)||Be[2]],Ot=_h(i.zoom);if(Ot>0){const kt=function({x:hi,y:Nt,z:Jt},Qt,ai,ui,Wt){const gi=1/(1<<Jt);let Ai=hi*gi,vi=Ai+gi,Ji=Nt*gi,fi=Ji+gi,Ri=0;const Qi=(Ai+vi)/2-ui;return Qi>.5?Ri=-1:Qi<-.5&&(Ri=1),Ai=((Ai+Ri)*Qt-(ui*=Qt))*ai+ui,vi=((vi+Ri)*Qt-ui)*ai+ui,Ji=(Ji*Qt-(Wt*=Qt))*ai+Wt,fi=(fi*Qt-Wt)*ai+Wt,[[Ai,fi,0],[vi,fi,0],[vi,Ji,0],[Ai,Ji,0]]}(n,e,i._pixelsPerMercatorPixel,Q,ne);for(let hi=0;hi<y.length;hi++)Vc(y[hi],kt[hi],Ot);const Ht=Hl([],kt[Je],kt[(Je+1)%4]);Zo(Ht,Ht,.5),Vc(rt,Ht,Ot)}for(const kt of y)Kh(O,O,kt),Jh(P,P,kt);return O[2]=Math.min(Be[2],Ze[2]),Kh(O,O,rt),Jh(P,P,rt),new Ns(O,P)}function Gu({x:i,y:e,z:n}){const s=1/(1<<n),a=new Nr(Ko(i*s),vs((e+1)*s)),p=new Nr(Ko((i+1)*s),vs(e*s));return new ic(a,p)}function Xf(i){const e=pe(i.getNorth()),n=pe(i.getSouth()),s=Math.cos(e),a=Math.cos(n),p=Math.sin(e),y=Math.sin(n),T=i.getWest(),P=i.getEast();return[mh(a,y,T),mh(a,y,P),mh(s,p,P),mh(s,p,T)]}function mh(i,e,n,s=yl){return n=pe(n),[i*Math.sin(n)*s,-e*s,i*Math.cos(n)*s]}function gh(i,e,n){return mh(Math.cos(pe(i)),Math.sin(pe(i)),e,n)}function ru(i,e,n,s){const a=1<<n.z,p=(i/Bi+n.x)/a;return gh(vs((e/Bi+n.y)/a),Ko(p),s)}function Wu({min:i,max:e}){return t0/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const $p=new Float64Array(16);function nu(i){const e=Wu(i),n=Ip($p,[e,e,e]);return Yh(n,n,((s=[])[0]=-(a=i.min)[0],s[1]=-a[1],s[2]=-a[2],s));var s,a}function Hf(i){const e=(s=i.min,(n=$p)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const a=1/Wu(i);return Nc(e,e,[a,a,a])}function Yp(i,e,n,s,a){const p=function(P){const O=Bi/(2*Math.PI);return P/(2*Math.PI)/O}(n),y=[i,e,-n/(2*Math.PI)],T=ja(new Float64Array(16));return Yh(T,T,y),Nc(T,T,[p,p,p]),Rf(T,T,pe(-a)),Vu(T,T,pe(-s)),T}function _h(i){return ae(Gf,Gp,i)}function Zp(i,e){const n=gh(e.lat,e.lng),s=function(Q){const ne=gh(Q._center.lat,Q._center.lng);let Ae=jf([],ph(0,1,0),ne);const Fe=kp([],-Q.angle,ne);Ae=Sn(Ae,Ae,Fe),kp(Fe,-Q._pitch,Ae);const Je=Bs([],ne);return Zo(Je,Je,qu(Q.cameraToCenterDistance/Q.pixelsPerMeter)),Sn(Je,Je,Fe),Hl([],ne,Je)}(i);return y=(a=Nf([],s,n))[0],T=a[1],P=a[2],O=(p=n)[0],j=p[1],G=p[2],Z=($=Math.sqrt(y*y+T*T+P*P)*Math.sqrt(O*O+j*j+G*G))&&ha(a,p)/$,Math.acos(Math.min(Math.max(Z,-1),1));var a,p,y,T,P,O,j,G,$,Z}function $f(i,e){return Zp(i,e)>Math.PI/2*1.01}const Kp=pe(85),s0=Math.cos(Kp),o0=Math.sin(Kp),su=63710088e-1,Jp=2*Math.PI*su;class rc{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new rc(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,a=e.lat*n,p=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((e.lng-this.lng)*n);return su*Math.acos(Math.min(p,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new ic(new rc(this.lng-s,this.lat-n),new rc(this.lng+s,this.lat+n))}toEcef(e){const n=qu(e);return gh(this.lat,this.lng,yl+n)}static convert(e){if(e instanceof rc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new rc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new rc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Nr=rc;function Yf(i){return Jp*Math.cos(i*Math.PI/180)}function xl(i){return(180+i)/360}function bl(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Va(i,e){return i/Yf(e)}function Ko(i){return 360*i-180}function vs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Qp(i,e){return i*Yf(vs(e))}const xs=85.051129;function em(i){return 1/Math.cos(i*Math.PI/180)}class yh{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Nr.convert(e);return new yh(xl(s.lng),bl(s.lat),Va(n,s.lat))}toLngLat(){return new Nr(Ko(this.x),vs(this.y))}toAltitude(){return Qp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jp*em(vs(this.y))}}function Zf(i,e,n,s,a,p,y,T,P){const O=(e+s)/2,j=(n+a)/2,G=new ve(O,j);T(G),function($,Z,Q,ne,Ae,Fe){const Je=Q-Ae,Be=ne-Fe;return Math.abs((ne-Z)*Je-(Q-$)*Be)/Math.hypot(Je,Be)}(G.x,G.y,p.x,p.y,y.x,y.y)>=P?(Zf(i,e,n,O,j,p,G,T,P),Zf(i,O,j,s,a,G,y,T,P)):i.push(y)}function tm(i,e,n){let s=i[0],a=s.x,p=s.y;e(s);const y=[s];for(let T=1;T<i.length;T++){const P=i[T],{x:O,y:j}=P;e(P),Zf(y,a,p,O,j,s,P,e,n),a=O,p=j,s=P}return y}function Kf(i,e,n,s){if(s(e,n)){const a=e.add(n)._mult(.5);Kf(i,e,a,s),Kf(i,a,n,s)}else i.push(n)}function a0(i,e){let n=i[0];const s=[n];for(let a=1;a<i.length;a++){const p=i[a];Kf(s,n,p,e),n=p}return s}const Jf=Math.pow(2,14)-1,im=-Jf-1;function l0(i,e){const n=Math.round(i.x*e),s=Math.round(i.y*e);return i.x=He(n,im,Jf),i.y=He(s,im,Jf),(n<i.x||n>i.x+1||s<i.y||s>i.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function $l(i,e,n){const s=i.loadGeometry(),a=i.extent,p=Bi/a;if(e&&n&&n.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:T,x:P,y:O,projection:j}=n,G=$=>{const Z=Ko((e.x+$.x/a)/y),Q=vs((e.y+$.y/a)/y),ne=j.project(Z,Q);$.x=(ne.x*T-P)*a,$.y=(ne.y*T-O)*a};for(let $=0;$<s.length;$++)if(i.type!==1)s[$]=tm(s[$],G,1);else{const Z=[];for(const Q of s[$])Q.x<0||Q.x>=a||Q.y<0||Q.y>=a||(G(Q),Z.push(Q));s[$]=Z}}for(const y of s)for(const T of y)l0(T,p);return s}function qc(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?$l(i):[]}}function Xu(i,e,n,s,a){i.emplaceBack(2*e+(s+1)/2,2*n+(a+1)/2)}function Hu(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Qf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ei,this.indexArray=new Pi,this.segments=new An,this.programConfigurations=new _l(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,a){const p=this.layers[0],y=[];let T=null;p.type==="circle"&&(T=p.layout.get("circle-sort-key"));for(const{feature:O,id:j,index:G,sourceLayerIndex:$}of e){const Z=this.layers[0]._featureFilter.needGeometry,Q=qc(O,Z);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),Q,s))continue;const ne=T?T.evaluate(Q,{},s):void 0,Ae={id:j,properties:O.properties,type:O.type,sourceLayerIndex:$,index:G,geometry:Z?Q.geometry:$l(O,s,a),patterns:{},sortKey:ne};y.push(Ae)}T&&y.sort((O,j)=>O.sortKey-j.sortKey);let P=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new oi,P=a.projection);for(const O of y){const{geometry:j,index:G,sourceLayerIndex:$}=O,Z=e[G].feature;this.addFeature(O,j,G,n.availableImages,s,P),n.featureIndex.insert(Z,j,G,$,this.index)}}update(e,n,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Y_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,a,p,y){for(const T of n)for(const P of T){const O=P.x,j=P.y;if(O<0||O>=Bi||j<0||j>=Bi)continue;if(y){const Z=y.projectTilePoint(O,j,p),Q=y.upVector(p,O,j),ne=this.globeExtVertexArray;Hu(ne,Z,Q),Hu(ne,Z,Q),Hu(ne,Z,Q),Hu(ne,Z,Q)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),$=G.vertexLength;Xu(this.layoutVertexArray,O,j,-1,-1),Xu(this.layoutVertexArray,O,j,1,-1),Xu(this.layoutVertexArray,O,j,1,1),Xu(this.layoutVertexArray,O,j,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a,p)}}function rm(i,e){for(let n=0;n<i.length;n++)if(Gc(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Gc(i,e[n]))return!0;return!!ed(i,e)}function c0(i,e,n){return!!Gc(i,e)||!!td(e,i,n)}function nm(i,e){if(i.length===1)return om(e,i[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let a=0;a<s.length;a++)if(Gc(i,s[a]))return!0}for(let n=0;n<i.length;n++)if(om(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ed(i,e[n]))return!0;return!1}function h0(i,e,n){if(i.length>1){if(ed(i,e))return!0;for(let s=0;s<e.length;s++)if(td(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(td(i[s],e,n))return!0;return!1}function ed(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],a=i[n+1];for(let p=0;p<e.length-1;p++)if(u0(s,a,e[p],e[p+1]))return!0}return!1}function u0(i,e,n,s){return Se(i,n,s)!==Se(e,n,s)&&Se(i,e,n)!==Se(i,e,s)}function td(i,e,n){const s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let a=1;a<e.length;a++)if(sm(i,e[a-1],e[a])<s)return!0;return!1}function sm(i,e,n){const s=e.distSqr(n);if(s===0)return i.distSqr(e);const a=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(a<0?e:a>1?n:n.sub(e)._mult(a)._add(e))}function om(i,e){let n,s,a,p=!1;for(let y=0;y<i.length;y++){n=i[y];for(let T=0,P=n.length-1;T<n.length;P=T++)s=n[T],a=n[P],s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(p=!p)}return p}function Gc(i,e){let n=!1;for(let s=0,a=i.length-1;s<i.length;a=s++){const p=i[s],y=i[a];p.y>e.y!=y.y>e.y&&e.x<(y.x-p.x)*(e.y-p.y)/(y.y-p.y)+p.x&&(n=!n)}return n}function am(i,e,n,s,a){for(const y of i)if(e<=y.x&&n<=y.y&&s>=y.x&&a>=y.y)return!0;const p=[new ve(e,n),new ve(e,a),new ve(s,a),new ve(s,n)];if(i.length>2){for(const y of p)if(Gc(i,y))return!0}for(let y=0;y<i.length-1;y++)if(f0(i[y],i[y+1],p))return!0;return!1}function f0(i,e,n){const s=n[0],a=n[2];if(i.x<s.x&&e.x<s.x||i.x>a.x&&e.x>a.x||i.y<s.y&&e.y<s.y||i.y>a.y&&e.y>a.y)return!1;const p=Se(i,e,n[0]);return p!==Se(i,e,n[1])||p!==Se(i,e,n[2])||p!==Se(i,e,n[3])}function vh(i,e,n){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function $u(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function lm(i,e,n,s,a){if(!e[0]&&!e[1])return i;const p=ve.convert(e)._mult(a);n==="viewport"&&p._rotate(-s);const y=[];for(let T=0;T<i.length;T++)y.push(i[T].sub(p));return y}function cm(i,e,n,s){const a=ve.convert(i)._mult(s);return e==="viewport"&&a._rotate(-n),a}bi(Qf,"CircleBucket",{omit:["layers"]});const d0=new Ne({"circle-sort-key":new Ce(Ut.layout_circle["circle-sort-key"])});var p0={paint:new Ne({"circle-radius":new Ce(Ut.paint_circle["circle-radius"]),"circle-color":new Ce(Ut.paint_circle["circle-color"]),"circle-blur":new Ce(Ut.paint_circle["circle-blur"]),"circle-opacity":new Ce(Ut.paint_circle["circle-opacity"]),"circle-translate":new ie(Ut.paint_circle["circle-translate"]),"circle-translate-anchor":new ie(Ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ie(Ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ie(Ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ce(Ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ce(Ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ce(Ut.paint_circle["circle-stroke-opacity"])}),layout:d0};function hm(i,e,n,s,a,p,y,T,P){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(P*=i.pixelToTileUnitsFactor);const O=i.tileID.canonical,j=n.projection.upVectorScale(O,n.center.lat,n.worldSize).metersToTile;for(const G of e)for(const $ of G){const Z=$.add(T),Q=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(Z.x,Z.y,!0):0,ne=n.projection.projectTilePoint(Z.x,Z.y,O);if(Q>0){const Be=n.projection.upVector(O,Z.x,Z.y);ne.x+=Be[0]*j*Q,ne.y+=Be[1]*j*Q,ne.z+=Be[2]*j*Q}const Ae=p?Z:m0(ne.x,ne.y,ne.z,s),Fe=p?i.tilespaceRays.map(Be=>_0(Be,Q)):i.queryGeometry.screenGeometry,Je=jc([],[ne.x,ne.y,ne.z,1],s);if(!y&&p?P*=Je[3]/n.cameraToCenterDistance:y&&!p&&(P*=n.cameraToCenterDistance/Je[3]),p){const Be=vs(($.y/Bi+O.y)/(1<<O.z));P/=n.projection.pixelsPerMeter(Be,1)/Va(1,Be)}if(c0(Fe,Ae,P))return!0}return!1}function m0(i,e,n,s){const a=jc([],[i,e,n,1],s);return new ve(a[0]/a[3],a[1]/a[3])}const um=ph(0,0,0),g0=ph(0,0,1);function _0(i,e){const n=Bf();return um[2]=e,i.intersectsPlane(um,g0,n),new ve(n[0],n[1])}class fm extends Qf{}function dm(i,{width:e,height:n},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*n*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=a,i}function pm(i,e,n){const{width:s,height:a}=e;s===i.width&&a===i.height||(id(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,s),height:Math.min(i.height,a)},n),i.width=s,i.height=a,i.data=e.data)}function id(i,e,n,s,a,p){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||n.x>i.width-a.width||n.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||s.x>e.width-a.width||s.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,T=e.data;for(let P=0;P<a.height;P++){const O=((n.y+P)*i.width+n.x)*p,j=((s.y+P)*e.width+s.x)*p;for(let G=0;G<a.width*p;G++)T[j+G]=y[O+G]}return e}bi(fm,"HeatmapBucket",{omit:["layers"]});class Yl{constructor(e,n){dm(this,e,1,n)}resize(e){pm(this,new Yl(e),1)}clone(){return new Yl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,a,p){id(e,n,s,a,p,1)}}class Ao{constructor(e,n){dm(this,e,4,n)}resize(e){pm(this,new Ao(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,a,p){id(e,n,s,a,p,4)}}bi(Yl,"AlphaImage"),bi(Ao,"RGBAImage");var y0={paint:new Ne({"heatmap-radius":new Ce(Ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ce(Ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ie(Ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Re(Ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ie(Ut.paint_heatmap["heatmap-opacity"])})};function rd(i){const e={},n=i.resolution||256,s=i.clips?i.clips.length:1,a=i.image||new Ao({width:n,height:s}),p=(y,T,P)=>{e[i.evaluationKey]=P;const O=i.expression.evaluate(e);a.data[y+T+0]=Math.floor(255*O.r/O.a),a.data[y+T+1]=Math.floor(255*O.g/O.a),a.data[y+T+2]=Math.floor(255*O.b/O.a),a.data[y+T+3]=Math.floor(255*O.a)};if(i.clips)for(let y=0,T=0;y<s;++y,T+=4*n)for(let P=0,O=0;P<n;P++,O+=4){const j=P/(n-1),{start:G,end:$}=i.clips[y];p(T,O,G*(1-j)+$*j)}else for(let y=0,T=0;y<n;y++,T+=4)p(0,T,y/(n-1));return a}var v0={paint:new Ne({"hillshade-illumination-direction":new ie(Ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ie(Ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ie(Ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ie(Ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ie(Ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ie(Ut.paint_hillshade["hillshade-accent-color"])})};const x0=ut([{name:"a_pos",components:2,type:"Int16"}],4),{members:b0}=x0;var nd={exports:{}};function Yu(i,e,n){n=n||2;var s,a,p,y,T,P,O,j=e&&e.length,G=j?e[0]*n:i.length,$=mm(i,0,G,n,!0),Z=[];if(!$||$.next===$.prev)return Z;if(j&&($=function(ne,Ae,Fe,Je){var Be,Ze,nt,rt=[];for(Be=0,Ze=Ae.length;Be<Ze;Be++)(nt=mm(ne,Ae[Be]*Je,Be<Ze-1?Ae[Be+1]*Je:ne.length,Je,!1))===nt.next&&(nt.steiner=!0),rt.push(M0(nt));for(rt.sort(A0),Be=0;Be<rt.length;Be++)Fe=E0(rt[Be],Fe);return Fe}(i,e,$,n)),i.length>80*n){s=p=i[0],a=y=i[1];for(var Q=n;Q<G;Q+=n)(T=i[Q])<s&&(s=T),(P=i[Q+1])<a&&(a=P),T>p&&(p=T),P>y&&(y=P);O=(O=Math.max(p-s,y-a))!==0?32767/O:0}return ou($,Z,n,s,a,O,0),Z}function mm(i,e,n,s,a){var p,y;if(a===ad(i,e,n,s)>0)for(p=e;p<n;p+=s)y=ym(p,i[p],i[p+1],y);else for(p=n-s;p>=e;p-=s)y=ym(p,i[p],i[p+1],y);return y&&Zu(y,y.next)&&(lu(y),y=y.next),y}function Wc(i,e){if(!i)return i;e||(e=i);var n,s=i;do if(n=!1,s.steiner||!Zu(s,s.next)&&En(s.prev,s,s.next)!==0)s=s.next;else{if(lu(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function ou(i,e,n,s,a,p,y){if(i){!y&&p&&function(j,G,$,Z){var Q=j;do Q.z===0&&(Q.z=sd(Q.x,Q.y,G,$,Z)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==j);Q.prevZ.nextZ=null,Q.prevZ=null,function(ne){var Ae,Fe,Je,Be,Ze,nt,rt,Ot,kt=1;do{for(Fe=ne,ne=null,Ze=null,nt=0;Fe;){for(nt++,Je=Fe,rt=0,Ae=0;Ae<kt&&(rt++,Je=Je.nextZ);Ae++);for(Ot=kt;rt>0||Ot>0&&Je;)rt!==0&&(Ot===0||!Je||Fe.z<=Je.z)?(Be=Fe,Fe=Fe.nextZ,rt--):(Be=Je,Je=Je.nextZ,Ot--),Ze?Ze.nextZ=Be:ne=Be,Be.prevZ=Ze,Ze=Be;Fe=Je}Ze.nextZ=null,kt*=2}while(nt>1)}(Q)}(i,s,a,p);for(var T,P,O=i;i.prev!==i.next;)if(T=i.prev,P=i.next,p?S0(i,s,a,p):w0(i))e.push(T.i/n|0),e.push(i.i/n|0),e.push(P.i/n|0),lu(i),i=P.next,O=P.next;else if((i=P)===O){y?y===1?ou(i=T0(Wc(i),e,n),e,n,s,a,p,2):y===2&&C0(i,e,n,s,a,p):ou(Wc(i),e,n,s,a,p,1);break}}}function w0(i){var e=i.prev,n=i,s=i.next;if(En(e,n,s)>=0)return!1;for(var a=e.x,p=n.x,y=s.x,T=e.y,P=n.y,O=s.y,j=a<p?a<y?a:y:p<y?p:y,G=T<P?T<O?T:O:P<O?P:O,$=a>p?a>y?a:y:p>y?p:y,Z=T>P?T>O?T:O:P>O?P:O,Q=s.next;Q!==e;){if(Q.x>=j&&Q.x<=$&&Q.y>=G&&Q.y<=Z&&xh(a,T,p,P,y,O,Q.x,Q.y)&&En(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function S0(i,e,n,s){var a=i.prev,p=i,y=i.next;if(En(a,p,y)>=0)return!1;for(var T=a.x,P=p.x,O=y.x,j=a.y,G=p.y,$=y.y,Z=T<P?T<O?T:O:P<O?P:O,Q=j<G?j<$?j:$:G<$?G:$,ne=T>P?T>O?T:O:P>O?P:O,Ae=j>G?j>$?j:$:G>$?G:$,Fe=sd(Z,Q,e,n,s),Je=sd(ne,Ae,e,n,s),Be=i.prevZ,Ze=i.nextZ;Be&&Be.z>=Fe&&Ze&&Ze.z<=Je;){if(Be.x>=Z&&Be.x<=ne&&Be.y>=Q&&Be.y<=Ae&&Be!==a&&Be!==y&&xh(T,j,P,G,O,$,Be.x,Be.y)&&En(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Ze.x>=Z&&Ze.x<=ne&&Ze.y>=Q&&Ze.y<=Ae&&Ze!==a&&Ze!==y&&xh(T,j,P,G,O,$,Ze.x,Ze.y)&&En(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;Be&&Be.z>=Fe;){if(Be.x>=Z&&Be.x<=ne&&Be.y>=Q&&Be.y<=Ae&&Be!==a&&Be!==y&&xh(T,j,P,G,O,$,Be.x,Be.y)&&En(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Ze&&Ze.z<=Je;){if(Ze.x>=Z&&Ze.x<=ne&&Ze.y>=Q&&Ze.y<=Ae&&Ze!==a&&Ze!==y&&xh(T,j,P,G,O,$,Ze.x,Ze.y)&&En(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function T0(i,e,n){var s=i;do{var a=s.prev,p=s.next.next;!Zu(a,p)&&gm(a,s,s.next,p)&&au(a,p)&&au(p,a)&&(e.push(a.i/n|0),e.push(s.i/n|0),e.push(p.i/n|0),lu(s),lu(s.next),s=i=p),s=s.next}while(s!==i);return Wc(s)}function C0(i,e,n,s,a,p){var y=i;do{for(var T=y.next.next;T!==y.prev;){if(y.i!==T.i&&L0(y,T)){var P=_m(y,T);return y=Wc(y,y.next),P=Wc(P,P.next),ou(y,e,n,s,a,p,0),void ou(P,e,n,s,a,p,0)}T=T.next}y=y.next}while(y!==i)}function A0(i,e){return i.x-e.x}function E0(i,e){var n=function(a,p){var y,T=p,P=a.x,O=a.y,j=-1/0;do{if(O<=T.y&&O>=T.next.y&&T.next.y!==T.y){var G=T.x+(O-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(G<=P&&G>j&&(j=G,y=T.x<T.next.x?T:T.next,G===P))return y}T=T.next}while(T!==p);if(!y)return null;var $,Z=y,Q=y.x,ne=y.y,Ae=1/0;T=y;do P>=T.x&&T.x>=Q&&P!==T.x&&xh(O<ne?P:j,O,Q,ne,O<ne?j:P,O,T.x,T.y)&&($=Math.abs(O-T.y)/(P-T.x),au(T,a)&&($<Ae||$===Ae&&(T.x>y.x||T.x===y.x&&P0(y,T)))&&(y=T,Ae=$)),T=T.next;while(T!==Z);return y}(i,e);if(!n)return e;var s=_m(n,i);return Wc(s,s.next),Wc(n,n.next)}function P0(i,e){return En(i.prev,i,e.prev)<0&&En(e.next,i,i.next)<0}function sd(i,e,n,s,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*a|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function M0(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function xh(i,e,n,s,a,p,y,T){return(a-y)*(e-T)>=(i-y)*(p-T)&&(i-y)*(s-T)>=(n-y)*(e-T)&&(n-y)*(p-T)>=(a-y)*(s-T)}function L0(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==s.i&&a.next.i!==s.i&&gm(a,a.next,n,s))return!0;a=a.next}while(a!==n);return!1}(i,e)&&(au(i,e)&&au(e,i)&&function(n,s){var a=n,p=!1,y=(n.x+s.x)/2,T=(n.y+s.y)/2;do a.y>T!=a.next.y>T&&a.next.y!==a.y&&y<(a.next.x-a.x)*(T-a.y)/(a.next.y-a.y)+a.x&&(p=!p),a=a.next;while(a!==n);return p}(i,e)&&(En(i.prev,i,e.prev)||En(i,e.prev,e))||Zu(i,e)&&En(i.prev,i,i.next)>0&&En(e.prev,e,e.next)>0)}function En(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Zu(i,e){return i.x===e.x&&i.y===e.y}function gm(i,e,n,s){var a=Ju(En(i,e,n)),p=Ju(En(i,e,s)),y=Ju(En(n,s,i)),T=Ju(En(n,s,e));return a!==p&&y!==T||!(a!==0||!Ku(i,n,e))||!(p!==0||!Ku(i,s,e))||!(y!==0||!Ku(n,i,s))||!(T!==0||!Ku(n,e,s))}function Ku(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Ju(i){return i>0?1:i<0?-1:0}function au(i,e){return En(i.prev,i,i.next)<0?En(i,e,i.next)>=0&&En(i,i.prev,e)>=0:En(i,e,i.prev)<0||En(i,i.next,e)<0}function _m(i,e){var n=new od(i.i,i.x,i.y),s=new od(e.i,e.x,e.y),a=i.next,p=e.prev;return i.next=e,e.prev=i,n.next=a,a.prev=n,s.next=n,n.prev=s,p.next=s,s.prev=p,s}function ym(i,e,n,s){var a=new od(i,e,n);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function lu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function od(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ad(i,e,n,s){for(var a=0,p=e,y=n-s;p<n;p+=s)a+=(i[y]-i[p])*(i[p+1]+i[y+1]),y=p;return a}nd.exports=Yu,nd.exports.default=Yu,Yu.deviation=function(i,e,n,s){var a=e&&e.length,p=Math.abs(ad(i,0,a?e[0]*n:i.length,n));if(a)for(var y=0,T=e.length;y<T;y++)p-=Math.abs(ad(i,e[y]*n,y<T-1?e[y+1]*n:i.length,n));var P=0;for(y=0;y<s.length;y+=3){var O=s[y]*n,j=s[y+1]*n,G=s[y+2]*n;P+=Math.abs((i[O]-i[G])*(i[j+1]-i[O+1])-(i[O]-i[j])*(i[G+1]-i[O+1]))}return p===0&&P===0?0:Math.abs((P-p)/p)},Yu.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,a=0;a<i.length;a++){for(var p=0;p<i[a].length;p++)for(var y=0;y<e;y++)n.vertices.push(i[a][p][y]);a>0&&n.holes.push(s+=i[a-1].length)}return n};var ld=B(nd.exports);function I0(i,e,n,s,a){vm(i,e,n||0,s||i.length-1,a||k0)}function vm(i,e,n,s,a){for(;s>n;){if(s-n>600){var p=s-n+1,y=e-n+1,T=Math.log(p),P=.5*Math.exp(2*T/3),O=.5*Math.sqrt(T*P*(p-P)/p)*(y-p/2<0?-1:1);vm(i,e,Math.max(n,Math.floor(e-y*P/p+O)),Math.min(s,Math.floor(e+(p-y)*P/p+O)),a)}var j=i[e],G=n,$=s;for(cu(i,n,e),a(i[s],j)>0&&cu(i,n,s);G<$;){for(cu(i,G,$),G++,$--;a(i[G],j)<0;)G++;for(;a(i[$],j)>0;)$--}a(i[n],j)===0?cu(i,n,$):cu(i,++$,s),$<=e&&(n=$+1),e<=$&&(s=$-1)}}function cu(i,e,n){var s=i[e];i[e]=i[n],i[n]=s}function k0(i,e){return i<e?-1:i>e?1:0}function cd(i,e){const n=i.length;if(n<=1)return[i];const s=[];let a,p;for(let y=0;y<n;y++){const T=At(i[y]);T!==0&&(i[y].area=Math.abs(T),p===void 0&&(p=T<0),p===T<0?(a&&s.push(a),a=[i[y]]):a.push(i[y]))}if(a&&s.push(a),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(I0(s[y],e,1,s[y].length-1,D0),s[y]=s[y].slice(0,e));return s}function D0(i,e){return e.area-i.area}function hd(i,e,n){const s=n.patternDependencies;let a=!1;for(const p of e){const y=p.paint.get(`${i}-pattern`);y.isConstant()||(a=!0);const T=y.constantOr(null);T&&(a=!0,s[T]=!0)}return a}function ud(i,e,n,s,a){const p=a.patternDependencies;for(const y of e){const T=y.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let P=T.evaluate({zoom:s},n,{},a.availableImages);P=P&&P.name?P.name:P,p[P]=!0,n.patterns[y.id]=P}}return n}class Qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ei,this.indexArray=new Pi,this.indexArray2=new wn,this.programConfigurations=new _l(e.layers,e.zoom),this.segments=new An,this.segments2=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,a){this.hasPattern=hd("fill",this.layers,n);const p=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:P,index:O,sourceLayerIndex:j}of e){const G=this.layers[0]._featureFilter.needGeometry,$=qc(T,G);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),$,s))continue;const Z=p?p.evaluate($,{},s,n.availableImages):void 0,Q={id:P,properties:T.properties,type:T.type,sourceLayerIndex:j,index:O,geometry:G?$.geometry:$l(T,s,a),patterns:{},sortKey:Z};y.push(Q)}p&&y.sort((T,P)=>T.sortKey-P.sortKey);for(const T of y){const{geometry:P,index:O,sourceLayerIndex:j}=T;if(this.hasPattern){const G=ud("fill",this.layers,T,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(T,P,O,s,{},n.availableImages);n.featureIndex.insert(e[O].feature,P,O,j,this.index)}}update(e,n,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,a)}addFeatures(e,n,s,a,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,a,p,y=[]){for(const T of cd(n,500)){let P=0;for(const Q of T)P+=Q.length;const O=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),j=O.vertexLength,G=[],$=[];for(const Q of T){if(Q.length===0)continue;Q!==T[0]&&$.push(G.length/2);const ne=this.segments2.prepareSegment(Q.length,this.layoutVertexArray,this.indexArray2),Ae=ne.vertexLength;this.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),this.indexArray2.emplaceBack(Ae+Q.length-1,Ae),G.push(Q[0].x),G.push(Q[0].y);for(let Fe=1;Fe<Q.length;Fe++)this.layoutVertexArray.emplaceBack(Q[Fe].x,Q[Fe].y),this.indexArray2.emplaceBack(Ae+Fe-1,Ae+Fe),G.push(Q[Fe].x),G.push(Q[Fe].y);ne.vertexLength+=Q.length,ne.primitiveLength+=Q.length}const Z=ld(G,$);for(let Q=0;Q<Z.length;Q+=3)this.indexArray.emplaceBack(j+Z[Q],j+Z[Q+1],j+Z[Q+2]);O.vertexLength+=P,O.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,a)}}bi(Qu,"FillBucket",{omit:["layers","patternFeatures"]});const O0=new Ne({"fill-sort-key":new Ce(Ut.layout_fill["fill-sort-key"])});var F0={paint:new Ne({"fill-antialias":new ie(Ut.paint_fill["fill-antialias"]),"fill-opacity":new Ce(Ut.paint_fill["fill-opacity"]),"fill-color":new Ce(Ut.paint_fill["fill-color"]),"fill-outline-color":new Ce(Ut.paint_fill["fill-outline-color"]),"fill-translate":new ie(Ut.paint_fill["fill-translate"]),"fill-translate-anchor":new ie(Ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ce(Ut.paint_fill["fill-pattern"])}),layout:O0};const z0=ut([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),R0=ut([{name:"a_centroid_pos",components:2,type:"Uint16"}]),B0=ut([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:N0}=z0;var ef={},j0=he,xm=bh;function bh(i,e,n,s,a){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=a,i.readFields(U0,this,e)}function U0(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,a){for(var p=s.readVarint()+s.pos;s.pos<p;){var y=a._keys[s.readVarint()],T=a._values[s.readVarint()];a.properties[y]=T}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function V0(i){for(var e,n,s=0,a=0,p=i.length,y=p-1;a<p;y=a++)s+=((n=i[y]).x-(e=i[a]).x)*(e.y+n.y);return s}bh.types=["Unknown","Point","LineString","Polygon"],bh.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,a=0,p=0,y=0,T=[];i.pos<n;){if(a<=0){var P=i.readVarint();s=7&P,a=P>>3}if(a--,s===1||s===2)p+=i.readSVarint(),y+=i.readSVarint(),s===1&&(e&&T.push(e),e=[]),e.push(new j0(p,y));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&T.push(e),T},bh.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,a=0,p=0,y=1/0,T=-1/0,P=1/0,O=-1/0;i.pos<e;){if(s<=0){var j=i.readVarint();n=7&j,s=j>>3}if(s--,n===1||n===2)(a+=i.readSVarint())<y&&(y=a),a>T&&(T=a),(p+=i.readSVarint())<P&&(P=p),p>O&&(O=p);else if(n!==7)throw new Error("unknown command "+n)}return[y,P,T,O]},bh.prototype.toGeoJSON=function(i,e,n){var s,a,p=this.extent*Math.pow(2,n),y=this.extent*i,T=this.extent*e,P=this.loadGeometry(),O=bh.types[this.type];function j(Z){for(var Q=0;Q<Z.length;Q++){var ne=Z[Q];Z[Q]=[360*(ne.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+T)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(s=0;s<P.length;s++)G[s]=P[s][0];j(P=G);break;case 2:for(s=0;s<P.length;s++)j(P[s]);break;case 3:for(P=function(Z){var Q=Z.length;if(Q<=1)return[Z];for(var ne,Ae,Fe=[],Je=0;Je<Q;Je++){var Be=V0(Z[Je]);Be!==0&&(Ae===void 0&&(Ae=Be<0),Ae===Be<0?(ne&&Fe.push(ne),ne=[Z[Je]]):ne.push(Z[Je]))}return ne&&Fe.push(ne),Fe}(P),s=0;s<P.length;s++)for(a=0;a<P[s].length;a++)j(P[s][a])}P.length===1?P=P[0]:O="Multi"+O;var $={type:"Feature",geometry:{type:O,coordinates:P},properties:this.properties};return"id"in this&&($.id=this.id),$};var q0=xm,bm=wm;function wm(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(G0,this,e),this.length=this._features.length}function G0(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var a=null,p=s.readVarint()+s.pos;s.pos<p;){var y=s.readVarint()>>3;a=y===1?s.readString():y===2?s.readFloat():y===3?s.readDouble():y===4?s.readVarint64():y===5?s.readVarint():y===6?s.readSVarint():y===7?s.readBoolean():null}return a}(n))}wm.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new q0(this._pbf,e,this.extent,this._keys,this._values)};var W0=bm;function X0(i,e,n){if(i===3){var s=new W0(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var fd=ef.VectorTile=function(i,e){this.layers=i.readFields(X0,{},e)},tf=ef.VectorTileFeature=xm;function rf(i,e,n,s){const a=[],p=s===0?(y,T,P,O,j,G)=>{y.push(new ve(G,P+(G-T)/(O-T)*(j-P)))}:(y,T,P,O,j,G)=>{y.push(new ve(T+(G-P)/(j-P)*(O-T),G))};for(const y of i){const T=[];for(const P of y){if(P.length<=2)continue;const O=[];for(let $=0;$<P.length-1;$++){const Z=P[$].x,Q=P[$].y,ne=P[$+1].x,Ae=P[$+1].y,Fe=s===0?Z:Q,Je=s===0?ne:Ae;Fe<e?Je>e&&p(O,Z,Q,ne,Ae,e):Fe>n?Je<n&&p(O,Z,Q,ne,Ae,n):O.push(P[$]),Je<e&&Fe>=e&&p(O,Z,Q,ne,Ae,e),Je>n&&Fe<=n&&p(O,Z,Q,ne,Ae,n)}let j=P[P.length-1];const G=s===0?j.x:j.y;G>=e&&G<=n&&O.push(j),O.length&&(j=O[O.length-1],O[0].x===j.x&&O[0].y===j.y||O.push(O[0]),T.push(O))}T.length&&a.push(T)}return a}ef.VectorTileLayer=bm;const H0=tf.types,$0=Math.pow(2,13);function hu(i,e,n,s,a,p,y,T){i.emplaceBack((e<<1)+y,(n<<1)+p,(Math.floor(s*$0)<<1)+a,Math.round(T))}function uu(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Sm{constructor(){this.acc=new ve(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ve(e.x,e.y),this.max=new ve(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,a=this.max;e.x<s.x?s.x=e.x:e.x>a.x&&(a.x=e.x),e.y<s.y?s.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===Bi)&&e.x===n.x)!=((e.y===0||e.y===Bi)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Ci(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Bi!=e.x>Bi&&this.addBorderIntersection(1,Ci(n.y,e.y,(Bi-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ci(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Bi!=e.y>Bi&&this.addBorderIntersection(3,Ci(n.x,e.x,(Bi-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return e!==0?this.acc.div(e)._round():new ve(0,0)}span(){return new ve(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class fu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Gt,this.centroidVertexArray=new To,this.indexArray=new Pi,this.programConfigurations=new _l(e.layers,e.zoom),this.segments=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,a){this.features=[],this.hasPattern=hd("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const y=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*y/(y*y+1)/Bi/(1<<p.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:y,index:T,sourceLayerIndex:P}of e){const O=this.layers[0]._featureFilter.needGeometry,j=qc(p,O);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),j,s))continue;const G={id:y,sourceLayerIndex:P,index:T,geometry:O?j.geometry:$l(p,s,a),properties:p.properties,type:p.type,patterns:{}},$=this.layoutVertexArray.length;this.hasPattern?this.features.push(ud("fill-extrusion",this.layers,G,this.zoom,n)):this.addFeature(G,G.geometry,T,s,{},n.availableImages,a),n.featureIndex.insert(p,G.geometry,T,P,this.index,$)}this.sortBorders()}addFeatures(e,n,s,a,p){for(const y of this.features){const{geometry:T}=y;this.addFeature(y,T,y.index,n,s,a,p)}this.sortBorders()}update(e,n,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,N0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,B0.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,R0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,a,p,y,T){const P=[new ve(0,0),new ve(Bi,Bi)],O=T.projection,j=O.name==="globe",G=this.enableTerrain&&!j?new Sm:null,$=H0[e.type]==="Polygon";j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new oi);const Z=cd(n,500);for(let Fe=Z.length-1;Fe>=0;Fe--){const Je=Z[Fe];(Je.length===0||(Q=Je[0]).every(Be=>Be.x<=0)||Q.every(Be=>Be.x>=Bi)||Q.every(Be=>Be.y<=0)||Q.every(Be=>Be.y>=Bi))&&Z.splice(Fe,1)}var Q;let ne;if(j)ne=Lm(Z,P,a);else{ne=[];for(const Fe of Z)ne.push({polygon:Fe,bounds:P})}const Ae=$?this.edgeRadius:0;for(const{polygon:Fe,bounds:Je}of ne){let Be=0,Ze=0;for(const rt of Fe)$&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),Ze+=$?rt.length-1:rt.length;const nt=this.segments.prepareSegment(($?5:4)*Ze,this.layoutVertexArray,this.indexArray);if($){const rt=[],Ot=[];Be=nt.vertexLength;for(const Ht of Fe){let hi,Nt;Ht.length&&Ht!==Fe[0]&&Ot.push(rt.length/2),hi=Ht[1].sub(Ht[0])._perp()._unit();for(let Jt=1;Jt<Ht.length;Jt++){const Qt=Ht[Jt],ai=Ht[Jt===Ht.length-1?1:Jt+1];let{x:ui,y:Wt}=Qt;if(Ae){Nt=ai.sub(Qt)._perp()._unit();const gi=hi.add(Nt)._unit(),Ai=Ae*Math.min(4,1/(hi.x*gi.x+hi.y*gi.y));ui+=Ai*gi.x,Wt+=Ai*gi.y,hi=Nt}hu(this.layoutVertexArray,ui,Wt,0,0,1,1,0),nt.vertexLength++,rt.push(Qt.x,Qt.y),j&&uu(this.layoutVertexExtArray,O.projectTilePoint(ui,Wt,a),O.upVector(a,ui,Wt))}}const kt=ld(rt,Ot);for(let Ht=0;Ht<kt.length;Ht+=3)this.indexArray.emplaceBack(Be+kt[Ht],Be+kt[Ht+2],Be+kt[Ht+1]),nt.primitiveLength++}for(const rt of Fe){G&&rt.length&&G.startRing(rt[0]);let Ot,kt,Ht,hi=rt.length>4&&Em(rt[rt.length-2],rt[0],rt[1]),Nt=Ae?Y0(rt[rt.length-2],rt[0],rt[1],Ae):0;kt=rt[1].sub(rt[0])._perp()._unit();let Jt=!0;for(let Qt=1,ai=0;Qt<rt.length;Qt++){let ui=rt[Qt-1],Wt=rt[Qt];const gi=rt[Qt===rt.length-1?1:Qt+1];if(G&&$&&G.currentPolyCount.top++,Am(Wt,ui,Je)){Ae&&(kt=gi.sub(Wt)._perp()._unit(),Jt=!Jt);continue}G&&G.append(Wt,ui);const Ai=Wt.sub(ui)._perp(),vi=Ai.x/(Math.abs(Ai.x)+Math.abs(Ai.y)),Ji=Ai.y>0?1:0,fi=ui.dist(Wt);if(ai+fi>32768&&(ai=0),Ae){Ht=gi.sub(Wt)._perp()._unit();let er=Cm(ui,Wt,gi,Tm(kt,Ht),Ae);isNaN(er)&&(er=0);const Gi=Wt.sub(ui)._unit();ui=ui.add(Gi.mult(Nt))._round(),Wt=Wt.add(Gi.mult(-er))._round(),Nt=er,kt=Ht}const Ri=nt.vertexLength,Qi=rt.length>4&&Em(ui,Wt,gi);let wr=Pm(ai,hi,Jt);if(hu(this.layoutVertexArray,ui.x,ui.y,vi,Ji,0,0,wr),hu(this.layoutVertexArray,ui.x,ui.y,vi,Ji,0,1,wr),ai+=fi,wr=Pm(ai,Qi,!Jt),hi=Qi,hu(this.layoutVertexArray,Wt.x,Wt.y,vi,Ji,0,0,wr),hu(this.layoutVertexArray,Wt.x,Wt.y,vi,Ji,0,1,wr),nt.vertexLength+=4,this.indexArray.emplaceBack(Ri+0,Ri+1,Ri+2),this.indexArray.emplaceBack(Ri+1,Ri+3,Ri+2),nt.primitiveLength+=2,Ae){const er=Be+(Qt===1?rt.length-2:Qt-2),Gi=Qt===1?Be:er+1;if(this.indexArray.emplaceBack(Ri+1,er,Ri+3),this.indexArray.emplaceBack(er,Gi,Ri+3),nt.primitiveLength+=2,Ot===void 0&&(Ot=Ri),!Am(gi,rt[Qt],Je)){const en=Qt===rt.length-1?Ot:nt.vertexLength;this.indexArray.emplaceBack(Ri+2,Ri+3,en),this.indexArray.emplaceBack(Ri+3,en+1,en),this.indexArray.emplaceBack(Ri+3,Gi,en+1),nt.primitiveLength+=3}Jt=!Jt}if(j){const er=this.layoutVertexExtArray,Gi=O.projectTilePoint(ui.x,ui.y,a),en=O.projectTilePoint(Wt.x,Wt.y,a),nr=O.upVector(a,ui.x,ui.y),sr=O.upVector(a,Wt.x,Wt.y);uu(er,Gi,nr),uu(er,Gi,nr),uu(er,en,sr),uu(er,en,sr)}}$&&(Be+=rt.length-1)}}if(G&&G.polyCount.length>0){if(G.borders){G.vertexArrayOffset=this.centroidVertexArray.length;const Fe=G.borders,Je=this.featuresOnBorder.push(G)-1;for(let Be=0;Be<4;Be++)Fe[Be][0]!==Number.MAX_VALUE&&this.borders[Be].push(Je)}this.encodeCentroid(G.borders?void 0:G.centroid(),G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let a,p;if(e)if(e.y!==0){const T=n.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(T.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else a=Math.ceil(7*(e.x+450)),p=0;else a=0,p=+s;let y=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const T of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let P=0;P<T.top;P++)this.centroidVertexArray.emplace(y++,a,p);for(let P=0;P<2*T.edges;P++)this.centroidVertexArray.emplace(y++,0,p),this.centroidVertexArray.emplace(y++,a,p)}}}function Tm(i,e){const n=i.add(e)._unit();return i.x*n.x+i.y*n.y}function Y0(i,e,n,s){const a=e.sub(i)._perp()._unit(),p=n.sub(e)._perp()._unit();return Cm(i,e,n,Tm(a,p),s)}function Cm(i,e,n,s,a){const p=Math.sqrt(1-s*s);return Math.min(i.dist(e)/3,e.dist(n)/3,a*p/s)}function Am(i,e,n){return i.x<n[0].x&&e.x<n[0].x||i.x>n[1].x&&e.x>n[1].x||i.y<n[0].y&&e.y<n[0].y||i.y>n[1].y&&e.y>n[1].y}function Em(i,e,n){if(i.x<0||i.x>=Bi||e.x<0||e.x>=Bi||n.x<0||n.x>=Bi)return!1;const s=n.sub(e),a=s.perp(),p=i.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&a.x*p.x+a.y*p.y<0}function Pm(i,e,n){const s=e?2|i:-3&i;return n?1|s:-2&s}function Mm(){const i=Math.PI/32,e=Math.tan(i),n=su;return n*Math.sqrt(1+2*e*e)-n}function Lm(i,e,n){const s=1<<n.z,a=Ko(n.x/s),p=Ko((n.x+1)/s),y=vs(n.y/s),T=vs((n.y+1)/s);return function(P,O,j,G,$=0,Z){const Q=[];if(!P.length||!j||!G)return Q;const ne=(rt,Ot)=>{for(const kt of rt)Q.push({polygon:kt,bounds:Ot})},Ae=Math.ceil(Math.log2(j)),Fe=Math.ceil(Math.log2(G)),Je=Ae-Fe,Be=[];for(let rt=0;rt<Math.abs(Je);rt++)Be.push(Je>0?0:1);for(let rt=0;rt<Math.min(Ae,Fe);rt++)Be.push(0),Be.push(1);let Ze=P;if(Ze=rf(Ze,O[0].y-$,O[1].y+$,1),Ze=rf(Ze,O[0].x-$,O[1].x+$,0),!Ze.length)return Q;const nt=[];for(Be.length?nt.push({polygons:Ze,bounds:O,depth:0}):ne(Ze,O);nt.length;){const rt=nt.pop(),Ot=rt.depth,kt=Be[Ot],Ht=rt.bounds[0],hi=rt.bounds[1],Nt=kt===0?Ht.x:Ht.y,Jt=kt===0?hi.x:hi.y,Qt=Z?Z(kt,Nt,Jt):.5*(Nt+Jt),ai=rf(rt.polygons,Nt-$,Qt+$,kt),ui=rf(rt.polygons,Qt-$,Jt+$,kt);if(ai.length){const Wt=[Ht,new ve(kt===0?Qt:hi.x,kt===1?Qt:hi.y)];Be.length>Ot+1?nt.push({polygons:ai,bounds:Wt,depth:Ot+1}):ne(ai,Wt)}if(ui.length){const Wt=[new ve(kt===0?Qt:Ht.x,kt===1?Qt:Ht.y),hi];Be.length>Ot+1?nt.push({polygons:ui,bounds:Wt,depth:Ot+1}):ne(ui,Wt)}}return Q}(i,e,Math.ceil((p-a)/11.25),Math.ceil((y-T)/11.25),1,(P,O,j)=>{if(P===0)return .5*(O+j);{const G=vs((n.y+O/Bi)/s);return(bl(.5*(vs((n.y+j/Bi)/s)+G))*s-n.y)*Bi}})}bi(fu,"FillExtrusionBucket",{omit:["layers","features"]}),bi(Sm,"PartMetadata");const Z0=new Ne({"fill-extrusion-edge-radius":new ie(Ut["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var K0={paint:new Ne({"fill-extrusion-opacity":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ce(Ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ce(Ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ce(Ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ce(Ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ie(Ut["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Z0};function Im(i,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class nf{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=du(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=function(p,y,T){var P=Im(256*p,256*(y=Math.pow(2,T)-y-1),T),O=Im(256*(p+1),256*(y+1),T);return P[0]+","+P[1]+","+O[0]+","+O[1]}(this.x,this.y,this.z),a=function(p,y,T){let P,O="";for(let j=p;j>0;j--)P=1<<j-1,O+=(y&P?1:0)+(T&P?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class km{constructor(e,n){this.wrap=e,this.canonical=n,this.key=du(e,n.z,n.z,n.x,n.y)}}class js{constructor(e,n,s,a,p){this.overscaledZ=e,this.wrap=n,this.canonical=new nf(s,+a,+p),this.key=n===0&&e===s?this.canonical.key:du(n,e,s,a,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new js(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new js(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return du(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return du(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new js(n,this.wrap,n,s,a),new js(n,this.wrap,n,s+1,a),new js(n,this.wrap,n,s,a+1),new js(n,this.wrap,n,s+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new js(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new km(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function du(i,e,n,s,a){const p=1<<Math.min(n,22);let y=p*(a%p)+s%p;return i&&n<22&&(y+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*y+n)+(e-n)}bi(nf,"CanonicalTileID"),bi(js,"OverscaledTileID",{omit:["projMatrix"]});class wh extends ve{constructor(e,n,s){super(e,n),this.z=s}}function pu(i,e){return i.x*e.x+i.y*e.y}function Dm(i,e){if(i.length===1){let n=0;const s=e[n++];let a;for(;!a||s.equals(a);)if(a=e[n++],!a)return 1/0;for(;n<e.length;n++){const p=e[n],y=i[0],T=a.sub(s),P=p.sub(s),O=y.sub(s),j=pu(T,T),G=pu(T,P),$=pu(P,P),Z=pu(O,T),Q=pu(O,P),ne=j*$-G*G,Ae=($*Z-G*Q)/ne,Fe=(j*Q-G*Z)/ne,Je=s.z*(1-Ae-Fe)+a.z*Ae+p.z*Fe;if(isFinite(Je))return Je}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Om(i,e,n,s,a,p,y,T){const P=y*a.getElevationAt(i,e,!0,!0),O=p[0]!==0,j=O?p[1]===0?y*(p[0]/7-450):y*function(G,$,Z){const Q=Math.floor($[0]/8),ne=Math.floor($[1]/8),Ae=10*($[0]-8*Q),Fe=10*($[1]-8*ne),Je=G.getElevationAt(Q,ne,!0,!0),Be=G.getMeterToDEM(Z),Ze=Math.floor(.5*(Ae*Be-1)),nt=Math.floor(.5*(Fe*Be-1)),rt=G.tileCoordToPixel(Q,ne),Ot=2*Ze+1,kt=2*nt+1,Ht=function(ui,Wt,gi,Ai,vi){return[ui.getElevationAtPixel(Wt,gi,!0),ui.getElevationAtPixel(Wt+vi,gi,!0),ui.getElevationAtPixel(Wt,gi+vi,!0),ui.getElevationAtPixel(Wt+Ai,gi+vi,!0)]}(G,rt.x-Ze,rt.y-nt,Ot,kt),hi=Math.abs(Ht[0]-Ht[1]),Nt=Math.abs(Ht[2]-Ht[3]),Jt=Math.abs(Ht[0]-Ht[2])+Math.abs(Ht[1]-Ht[3]),Qt=Math.min(.25,.5*Be*(hi+Nt)/Ot),ai=Math.min(.25,.5*Be*Jt/kt);return Je+Math.max(Qt*Ae,ai*Fe)}(a,p,T):P;return{base:P+(n===0)?-1:n,top:O?Math.max(j+s,P+n+2):P+s}}const J0=ut([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Q0}=J0,ey=ut([{name:"a_packed",components:4,type:"Float32"}]),{members:ty}=ey,iy=tf.types,ry=Math.cos(Math.PI/180*37.5);class sf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Pt,this.layoutVertexArray2=new ii,this.indexArray=new Pi,this.programConfigurations=new _l(e.layers,e.zoom),this.segments=new An,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,a){this.hasPattern=hd("line",this.layers,n);const p=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:j,id:G,index:$,sourceLayerIndex:Z}of e){const Q=this.layers[0]._featureFilter.needGeometry,ne=qc(j,Q);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),ne,s))continue;const Ae=p?p.evaluate(ne,{},s):void 0,Fe={id:G,properties:j.properties,type:j.type,sourceLayerIndex:Z,index:$,geometry:Q?ne.geometry:$l(j,s,a),patterns:{},sortKey:Ae};y.push(Fe)}p&&y.sort((j,G)=>j.sortKey-G.sortKey);const{lineAtlas:T,featureIndex:P}=n,O=this.addConstantDashes(T);for(const j of y){const{geometry:G,index:$,sourceLayerIndex:Z}=j;if(O&&this.addFeatureDashes(j,T),this.hasPattern){const Q=ud("line",this.layers,j,this.zoom,n);this.patternFeatures.push(Q)}else this.addFeature(j,G,$,s,T.positions,n.availableImages);P.insert(e[$].feature,G,$,Z,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(a.kind!=="constant"||p.kind!=="constant")n=!0;else{const y=p.value,T=a.value;if(!T)continue;e.addDash(T,y)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const a of this.layers){const p=a.paint.get("line-dasharray").value,y=a.layout.get("line-cap").value;if(p.kind==="constant"&&y.kind==="constant")continue;let T,P;if(p.kind==="constant"){if(T=p.value,!T)continue}else T=p.evaluate({zoom:s},e);P=y.kind==="constant"?y.value:y.evaluate({zoom:s},e),n.addDash(T,P),e.patterns[a.id]=n.getKey(T,P)}}update(e,n,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,a)}addFeatures(e,n,s,a,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ty)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Q0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,a,p,y){const T=this.layers[0].layout,P=T.get("line-join").evaluate(e,{}),O=T.get("line-cap").evaluate(e,{}),j=T.get("line-miter-limit"),G=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const $ of n)this.addLine($,e,P,O,j,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,a)}addLine(e,n,s,a,p,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Fe=0;Fe<e.length-1;Fe++)this.totalDistance+=e[Fe].dist(e[Fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=iy[n.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let O=0;for(;O<P-1&&e[O].equals(e[O+1]);)O++;if(P<(T?3:2))return;s==="bevel"&&(p=1.05);const j=this.overscaling<=16?15*Bi/(512*this.overscaling):0,G=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let $,Z,Q,ne,Ae;this.e1=this.e2=-1,T&&($=e[P-2],Ae=e[O].sub($)._unit()._perp());for(let Fe=O;Fe<P;Fe++){if(Q=Fe===P-1?T?e[O+1]:void 0:e[Fe+1],Q&&e[Fe].equals(Q))continue;Ae&&(ne=Ae),$&&(Z=$),$=e[Fe],Ae=Q?Q.sub($)._unit()._perp():ne,ne=ne||Ae;let Je=ne.add(Ae);Je.x===0&&Je.y===0||Je._unit();const Be=ne.x*Ae.x+ne.y*Ae.y,Ze=Je.x*Ae.x+Je.y*Ae.y,nt=Ze!==0?1/Ze:1/0,rt=2*Math.sqrt(2-2*Ze),Ot=Ze<ry&&Z&&Q,kt=ne.x*Ae.y-ne.y*Ae.x>0;if(Ot&&Fe>O){const Nt=$.dist(Z);if(Nt>2*j){const Jt=$.sub($.sub(Z)._mult(j/Nt)._round());this.updateDistance(Z,Jt),this.addCurrentVertex(Jt,ne,0,0,G),Z=Jt}}const Ht=Z&&Q;let hi=Ht?s:T?"butt":a;if(Ht&&hi==="round"&&(nt<y?hi="miter":nt<=2&&(hi="fakeround")),hi==="miter"&&nt>p&&(hi="bevel"),hi==="bevel"&&(nt>2&&(hi="flipbevel"),nt<p&&(hi="miter")),Z&&this.updateDistance(Z,$),hi==="miter")Je._mult(nt),this.addCurrentVertex($,Je,0,0,G);else if(hi==="flipbevel"){if(nt>100)Je=Ae.mult(-1);else{const Nt=nt*ne.add(Ae).mag()/ne.sub(Ae).mag();Je._perp()._mult(Nt*(kt?-1:1))}this.addCurrentVertex($,Je,0,0,G),this.addCurrentVertex($,Je.mult(-1),0,0,G)}else if(hi==="bevel"||hi==="fakeround"){const Nt=-Math.sqrt(nt*nt-1),Jt=kt?Nt:0,Qt=kt?0:Nt;if(Z&&this.addCurrentVertex($,ne,Jt,Qt,G),hi==="fakeround"){const ai=Math.round(180*rt/Math.PI/20);for(let ui=1;ui<ai;ui++){let Wt=ui/ai;if(Wt!==.5){const Ai=Wt-.5;Wt+=Wt*Ai*(Wt-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*Ai*Ai+(.848013+Be*(.215638*Be-1.06021)))}const gi=Ae.sub(ne)._mult(Wt)._add(ne)._unit()._mult(kt?-1:1);this.addHalfVertex($,gi.x,gi.y,!1,kt,0,G)}}Q&&this.addCurrentVertex($,Ae,-Jt,-Qt,G)}else if(hi==="butt")this.addCurrentVertex($,Je,0,0,G);else if(hi==="square"){const Nt=Z?1:-1;Z||this.addCurrentVertex($,Je,Nt,Nt,G),this.addCurrentVertex($,Je,0,0,G),Z&&this.addCurrentVertex($,Je,Nt,Nt,G)}else hi==="round"&&(Z&&(this.addCurrentVertex($,ne,0,0,G),this.addCurrentVertex($,ne,1,1,G,!0)),Q&&(this.addCurrentVertex($,Ae,-1,-1,G,!0),this.addCurrentVertex($,Ae,0,0,G)));if(Ot&&Fe<P-1){const Nt=$.dist(Q);if(Nt>2*j){const Jt=$.add(Q.sub($)._mult(j/Nt)._round());this.updateDistance($,Jt),this.addCurrentVertex(Jt,Ae,0,0,G),$=Jt}}}}addCurrentVertex(e,n,s,a,p,y=!1){const T=n.y*a-n.x,P=-n.y-n.x*a;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,y,!1,s,p),this.addHalfVertex(e,T,P,y,!0,-a,p)}addHalfVertex({x:e,y:n},s,a,p,y,T,P){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const O=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),P.primitiveLength++),y?this.e2=O:this.e1=O}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}bi(sf,"LineBucket",{omit:["layers","patternFeatures"]});const ny=new Ne({"line-cap":new Ce(Ut.layout_line["line-cap"]),"line-join":new Ce(Ut.layout_line["line-join"]),"line-miter-limit":new ie(Ut.layout_line["line-miter-limit"]),"line-round-limit":new ie(Ut.layout_line["line-round-limit"]),"line-sort-key":new Ce(Ut.layout_line["line-sort-key"])});var Fm={paint:new Ne({"line-opacity":new Ce(Ut.paint_line["line-opacity"]),"line-color":new Ce(Ut.paint_line["line-color"]),"line-translate":new ie(Ut.paint_line["line-translate"]),"line-translate-anchor":new ie(Ut.paint_line["line-translate-anchor"]),"line-width":new Ce(Ut.paint_line["line-width"]),"line-gap-width":new Ce(Ut.paint_line["line-gap-width"]),"line-offset":new Ce(Ut.paint_line["line-offset"]),"line-blur":new Ce(Ut.paint_line["line-blur"]),"line-dasharray":new Ce(Ut.paint_line["line-dasharray"]),"line-pattern":new Ce(Ut.paint_line["line-pattern"]),"line-gradient":new Re(Ut.paint_line["line-gradient"]),"line-trim-offset":new ie(Ut.paint_line["line-trim-offset"])}),layout:ny};const zm=new class extends Ce{possiblyEvaluate(i,e){return e=new N(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,s){return e=ce({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,s)}}(Fm.paint.properties["line-width"].specification);function Rm(i,e){return e>0?e+2*i:i}zm.useIntegerZoom=!0;const sy=ut([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oy=ut([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ay=ut([{name:"a_projected_pos",components:4,type:"Float32"}],4);ut([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ly=ut([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),cy=ut([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bm=ut([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hy=ut([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ut([{name:"triangle",components:3,type:"Uint16"}]),ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ut([{type:"Float32",name:"offsetX"}]),ut([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var os=24;const qa=128;function dd(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new N(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:a}=n;let p=0;for(;p<s.length&&s[p]<=i;)p++;p=Math.max(0,p-1);let y=p;for(;y<s.length&&s[y]<i+1;)y++;y=Math.min(s.length-1,y);const T=s[p],P=s[y];return n.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:P,interpolationType:a}:{kind:"camera",minZoom:T,maxZoom:P,minSize:n.evaluate(new N(T)),maxSize:n.evaluate(new N(P)),interpolationType:a}}}function of(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:a}){return i.kind==="source"?s/qa:i.kind==="composite"?Ci(s/qa,a/qa,n):e}function Sh(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:a,minZoom:p,maxZoom:y}=i,T=a?He(ln.interpolationFactor(a,e,p,y),0,1):0;i.kind==="camera"?s=Ci(i.minSize,i.maxSize,T):n=T}return{uSizeT:n,uSize:s}}var uy=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:qa,evaluateSizeForFeature:of,evaluateSizeForZoom:Sh,getSizeData:dd});function fy(i,e,n){return i.sections.forEach(s=>{s.text=function(a,p,y){const T=p.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?a=a.toLocaleUpperCase():T==="lowercase"&&(a=a.toLocaleLowerCase()),F.applyArabicShaping&&(a=F.applyArabicShaping(a)),a}(s.text,e,n)}),i}const mu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function dy(i){return i==="︶"||i==="﹈"||i==="︸"||i==="﹄"||i==="﹂"||i==="︾"||i==="︼"||i==="︺"||i==="︘"||i==="﹀"||i==="︐"||i==="︓"||i==="︔"||i==="｀"||i==="￣"||i==="︑"||i==="︒"}function py(i){return i==="︵"||i==="﹇"||i==="︷"||i==="﹃"||i==="﹁"||i==="︽"||i==="︻"||i==="︹"||i==="︗"||i==="︿"}var Nm=Yr,jm=function(i,e,n,s,a){var p,y,T=8*a-s-1,P=(1<<T)-1,O=P>>1,j=-7,G=n?a-1:0,$=n?-1:1,Z=i[e+G];for(G+=$,p=Z&(1<<-j)-1,Z>>=-j,j+=T;j>0;p=256*p+i[e+G],G+=$,j-=8);for(y=p&(1<<-j)-1,p>>=-j,j+=s;j>0;y=256*y+i[e+G],G+=$,j-=8);if(p===0)p=1-O;else{if(p===P)return y?NaN:1/0*(Z?-1:1);y+=Math.pow(2,s),p-=O}return(Z?-1:1)*y*Math.pow(2,p-s)},Um=function(i,e,n,s,a,p){var y,T,P,O=8*p-a-1,j=(1<<O)-1,G=j>>1,$=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=s?0:p-1,Q=s?1:-1,ne=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,y=j):(y=Math.floor(Math.log(e)/Math.LN2),e*(P=Math.pow(2,-y))<1&&(y--,P*=2),(e+=y+G>=1?$/P:$*Math.pow(2,1-G))*P>=2&&(y++,P/=2),y+G>=j?(T=0,y=j):y+G>=1?(T=(e*P-1)*Math.pow(2,a),y+=G):(T=e*Math.pow(2,G-1)*Math.pow(2,a),y=0));a>=8;i[n+Z]=255&T,Z+=Q,T/=256,a-=8);for(y=y<<a|T,O+=a;O>0;i[n+Z]=255&y,Z+=Q,y/=256,O-=8);i[n+Z-Q]|=128*ne};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Yr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Yr.Varint=0,Yr.Fixed64=1,Yr.Bytes=2,Yr.Fixed32=5;var pd=4294967296,Vm=1/pd,qm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Zl(i){return i.type===Yr.Bytes?i.readVarint()+i.pos:i.pos+1}function Th(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Gm(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var a=n.pos-1;a>=i;a--)n.buf[a+s]=n.buf[a]}function my(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function gy(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function _y(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function yy(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function vy(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function xy(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function by(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function wy(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function Sy(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function af(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ch(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Wm(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Yr.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),a=s>>3,p=this.pos;this.type=7&s,i(a,e,this),this.pos===p&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=af(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Wm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=af(this.buf,this.pos)+af(this.buf,this.pos+4)*pd;return this.pos+=8,i},readSFixed64:function(){var i=af(this.buf,this.pos)+Wm(this.buf,this.pos+4)*pd;return this.pos+=8,i},readFloat:function(){var i=jm(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jm(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(a,p,y){var T,P,O=y.buf;if(T=(112&(P=O[y.pos++]))>>4,P<128||(T|=(127&(P=O[y.pos++]))<<3,P<128)||(T|=(127&(P=O[y.pos++]))<<10,P<128)||(T|=(127&(P=O[y.pos++]))<<17,P<128)||(T|=(127&(P=O[y.pos++]))<<24,P<128)||(T|=(1&(P=O[y.pos++]))<<31,P<128))return Th(a,T,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&qm?function(n,s,a){return qm.decode(n.subarray(s,a))}(this.buf,e,i):function(n,s,a){for(var p="",y=s;y<a;){var T,P,O,j=n[y],G=null,$=j>239?4:j>223?3:j>191?2:1;if(y+$>a)break;$===1?j<128&&(G=j):$===2?(192&(T=n[y+1]))==128&&(G=(31&j)<<6|63&T)<=127&&(G=null):$===3?(P=n[y+2],(192&(T=n[y+1]))==128&&(192&P)==128&&((G=(15&j)<<12|(63&T)<<6|63&P)<=2047||G>=55296&&G<=57343)&&(G=null)):$===4&&(P=n[y+2],O=n[y+3],(192&(T=n[y+1]))==128&&(192&P)==128&&(192&O)==128&&((G=(15&j)<<18|(63&T)<<12|(63&P)<<6|63&O)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,$=1):G>65535&&(G-=65536,p+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),p+=String.fromCharCode(G),y+=$}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Yr.Bytes)return i.push(this.readVarint(e));var n=Zl(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Yr.Bytes)return i.push(this.readSVarint());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Yr.Bytes)return i.push(this.readBoolean());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Yr.Bytes)return i.push(this.readFloat());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Yr.Bytes)return i.push(this.readDouble());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Yr.Bytes)return i.push(this.readFixed32());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Yr.Bytes)return i.push(this.readSFixed32());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Yr.Bytes)return i.push(this.readFixed64());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Yr.Bytes)return i.push(this.readSFixed64());var e=Zl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Yr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Yr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Yr.Fixed32)this.pos+=4;else{if(e!==Yr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ch(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ch(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ch(this.buf,-1&i,this.pos),Ch(this.buf,Math.floor(i*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ch(this.buf,-1&i,this.pos),Ch(this.buf,Math.floor(i*Vm),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,a;if(e>=0?(s=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,y,T){T.buf[T.pos++]=127&p|128,p>>>=7,T.buf[T.pos++]=127&p|128,p>>>=7,T.buf[T.pos++]=127&p|128,p>>>=7,T.buf[T.pos++]=127&p|128,T.buf[T.pos]=127&(p>>>=7)}(s,0,n),function(p,y){var T=(7&p)<<4;y.buf[y.pos++]|=T|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(a,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,a,p){for(var y,T,P=0;P<a.length;P++){if((y=a.charCodeAt(P))>55295&&y<57344){if(!T){y>56319||P+1===a.length?(s[p++]=239,s[p++]=191,s[p++]=189):T=y;continue}if(y<56320){s[p++]=239,s[p++]=191,s[p++]=189,T=y;continue}y=T-55296<<10|y-56320|65536,T=null}else T&&(s[p++]=239,s[p++]=191,s[p++]=189,T=null);y<128?s[p++]=y:(y<2048?s[p++]=y>>6|192:(y<65536?s[p++]=y>>12|224:(s[p++]=y>>18|240,s[p++]=y>>12&63|128),s[p++]=y>>6&63|128),s[p++]=63&y|128)}return p}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Gm(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Um(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Um(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&Gm(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,Yr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,my,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,gy,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,vy,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,_y,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,yy,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,xy,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,by,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,wy,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Sy,e)},writeBytesField:function(i,e){this.writeTag(i,Yr.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Yr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Yr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Yr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Yr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Yr.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Yr.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Yr.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Yr.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Yr.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var lf=B(Nm);const md=3;function Ty(i,e,n){e.glyphs=[],i===1&&n.readMessage(Cy,e)}function Cy(i,e,n){if(i===3){const{id:s,bitmap:a,width:p,height:y,left:T,top:P,advance:O}=n.readMessage(Ay,{});e.glyphs.push({id:s,bitmap:new Yl({width:p+2*md,height:y+2*md},a),metrics:{width:p,height:y,left:T,top:P,advance:O}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function Ay(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const Xm=md;function gd(i){let e=0,n=0;for(const y of i)e+=y.w*y.h,n=Math.max(n,y.w);i.sort((y,T)=>T.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let a=0,p=0;for(const y of i)for(let T=s.length-1;T>=0;T--){const P=s[T];if(!(y.w>P.w||y.h>P.h)){if(y.x=P.x,y.y=P.y,p=Math.max(p,y.y+y.h),a=Math.max(a,y.x+y.w),y.w===P.w&&y.h===P.h){const O=s.pop();T<s.length&&(s[T]=O)}else y.h===P.h?(P.x+=y.w,P.w-=y.w):y.w===P.w?(P.y+=y.h,P.h-=y.h):(s.push({x:P.x+y.w,y:P.y,w:P.w-y.w,h:y.h}),P.y+=y.h,P.h-=y.h);break}}return{w:a,h:p,fill:e/(a*p)||0}}const lo=1;class _d{constructor(e,{pixelRatio:n,version:s,stretchX:a,stretchY:p,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=a,this.stretchY=p,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+lo,this.paddedRect.y+lo]}get br(){return[this.paddedRect.x+this.paddedRect.w-lo,this.paddedRect.y+this.paddedRect.h-lo]}get displaySize(){return[(this.paddedRect.w-2*lo)/this.pixelRatio,(this.paddedRect.h-2*lo)/this.pixelRatio]}}class Hm{constructor(e,n){const s={},a={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,s,p),this.addImages(n,a,p);const{w:y,h:T}=gd(p),P=new Ao({width:y||1,height:T||1});for(const O in e){const j=e[O],G=s[O].paddedRect;Ao.copy(j.data,P,{x:0,y:0},{x:G.x+lo,y:G.y+lo},j.data)}for(const O in n){const j=n[O],G=a[O].paddedRect,$=G.x+lo,Z=G.y+lo,Q=j.data.width,ne=j.data.height;Ao.copy(j.data,P,{x:0,y:0},{x:$,y:Z},j.data),Ao.copy(j.data,P,{x:0,y:ne-1},{x:$,y:Z-1},{width:Q,height:1}),Ao.copy(j.data,P,{x:0,y:0},{x:$,y:Z+ne},{width:Q,height:1}),Ao.copy(j.data,P,{x:Q-1,y:0},{x:$-1,y:Z},{width:1,height:ne}),Ao.copy(j.data,P,{x:0,y:0},{x:$+Q,y:Z},{width:1,height:ne})}this.image=P,this.iconPositions=s,this.patternPositions=a}addImages(e,n,s){for(const a in e){const p=e[a],y={x:0,y:0,w:p.data.width+2*lo,h:p.data.height+2*lo};s.push(y),n[a]=new _d(y,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[a,p]=e.tl;s.update(n.data,void 0,{x:a,y:p})}}bi(_d,"ImagePosition"),bi(Hm,"ImageAtlas");const Jo={horizontal:1,vertical:2,horizontalOnly:3},$m=-17;class gu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new gu;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new gu;return n.imageName=e,n}}class Ah{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Ah;for(let a=0;a<e.sections.length;a++){const p=e.sections[a];p.image?s.addImageSection(p):s.addTextSection(p,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let a="";for(let p=0;p<n.length;p++){const y=n.charCodeAt(p+1)||null,T=n.charCodeAt(p-1)||null;a+=!s&&(y&&be(y)&&!mu[n[p+1]]||T&&be(T)&&!mu[n[p-1]])||!mu[n[p]]?n[p]:mu[n[p]]}return a}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&cf[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&cf[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Ah;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(gu.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Xe("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(gu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yd(i,e,n,s,a,p,y,T,P,O,j,G,$,Z,Q){const ne=Ah.fromFeature(i,a);G===Jo.vertical&&ne.verticalizePunctuation($);let Ae=[];const Fe=function(rt,Ot,kt,Ht,hi,Nt){if(!rt)return[];const Jt=[],Qt=function(gi,Ai,vi,Ji,fi,Ri){let Qi=0;for(let wr=0;wr<gi.length();wr++){const er=gi.getSection(wr);Qi+=Ym(gi.getCharCode(wr),er,Ji,fi,Ai,Ri)}return Qi/Math.max(1,Math.ceil(Qi/vi))}(rt,Ot,kt,Ht,hi,Nt),ai=rt.text.indexOf("​")>=0;let ui=0;for(let gi=0;gi<rt.length();gi++){const Ai=rt.getSection(gi),vi=rt.getCharCode(gi);if(cf[vi]||(ui+=Ym(vi,Ai,Ht,hi,Ot,Nt)),gi<rt.length()-1){const Ji=!((Wt=vi)<11904||!(k["Bopomofo Extended"](Wt)||k.Bopomofo(Wt)||k["CJK Compatibility Forms"](Wt)||k["CJK Compatibility Ideographs"](Wt)||k["CJK Compatibility"](Wt)||k["CJK Radicals Supplement"](Wt)||k["CJK Strokes"](Wt)||k["CJK Symbols and Punctuation"](Wt)||k["CJK Unified Ideographs Extension A"](Wt)||k["CJK Unified Ideographs"](Wt)||k["Enclosed CJK Letters and Months"](Wt)||k["Halfwidth and Fullwidth Forms"](Wt)||k.Hiragana(Wt)||k["Ideographic Description Characters"](Wt)||k["Kangxi Radicals"](Wt)||k["Katakana Phonetic Extensions"](Wt)||k.Katakana(Wt)||k["Vertical Forms"](Wt)||k["Yi Radicals"](Wt)||k["Yi Syllables"](Wt)));(Ey[vi]||Ji||Ai.imageName)&&Jt.push(Km(gi+1,ui,Qt,Jt,Py(vi,rt.getCharCode(gi+1),Ji&&ai),!1))}}var Wt;return Jm(Km(rt.length(),ui,Qt,Jt,0,!0))}(ne,O,p,e,s,Z),{processBidirectionalText:Je,processStyledBidirectionalText:Be}=F;if(Je&&ne.sections.length===1){const rt=Je(ne.toString(),Fe);for(const Ot of rt){const kt=new Ah;kt.text=Ot,kt.sections=ne.sections;for(let Ht=0;Ht<Ot.length;Ht++)kt.sectionIndex.push(0);Ae.push(kt)}}else if(Be){const rt=Be(ne.text,ne.sectionIndex,Fe);for(const Ot of rt){const kt=new Ah;kt.text=Ot[0],kt.sectionIndex=Ot[1],kt.sections=ne.sections,Ae.push(kt)}}else Ae=function(rt,Ot){const kt=[],Ht=rt.text;let hi=0;for(const Nt of Ot)kt.push(rt.substring(hi,Nt)),hi=Nt;return hi<Ht.length&&kt.push(rt.substring(hi,Ht.length)),kt}(ne,Fe);const Ze=[],nt={positionedLines:Ze,text:ne.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai,ui,Wt,gi){let Ai=0,vi=0,Ji=0;const fi=Qt==="right"?1:Qt==="left"?0:.5;let Ri=!1;for(const nr of hi){const sr=nr.getSections();for(const jr of sr){if(jr.imageName)continue;const Zr=Ot[jr.fontStack];if(Zr&&(Ri=Zr.ascender!==void 0&&Zr.descender!==void 0,!Ri))break}if(!Ri)break}let Qi=0;for(const nr of hi){nr.trim();const sr=nr.getMaxScale(),jr=(sr-1)*os,Zr={positionedGlyphs:[],lineOffset:0};rt.positionedLines[Qi]=Zr;const Kr=Zr.positionedGlyphs;let Ur=0;if(!nr.length()){vi+=Nt,++Qi;continue}let cn=0,_n=0;for(let Vr=0;Vr<nr.length();Vr++){const zn=nr.getSection(Vr),Mn=nr.getSectionIndex(Vr),pn=nr.getCharCode(Vr);let Cr=zn.scale,Ln=null,Jr=null,Us=null,In=os,as=0;const Zn=!(ai===Jo.horizontal||!Wt&&!ye(pn)||Wt&&(cf[pn]||(wr=pn,k.Arabic(wr)||k["Arabic Supplement"](wr)||k["Arabic Extended-A"](wr)||k["Arabic Presentation Forms-A"](wr)||k["Arabic Presentation Forms-B"](wr))));if(zn.imageName){const Vs=Ht[zn.imageName];if(!Vs)continue;Us=zn.imageName,rt.iconsInText=rt.iconsInText||!0,Jr=Vs.paddedRect;const Kn=Vs.displaySize;Cr=Cr*os/gi,Ln={width:Kn[0],height:Kn[1],left:lo,top:-Xm,advance:Zn?Kn[1]:Kn[0],localGlyph:!1},as=Ri?-Ln.height*Cr:$m+sr*os-Kn[1]*Cr,In=Ln.advance;const Xa=(Zn?Kn[0]:Kn[1])*Cr-os*sr;Xa>0&&Xa>Ur&&(Ur=Xa)}else{const Vs=kt[zn.fontStack];if(!Vs)continue;Vs[pn]&&(Jr=Vs[pn]);const Kn=Ot[zn.fontStack];if(!Kn)continue;const Xa=Kn.glyphs[pn];if(!Xa)continue;if(Ln=Xa.metrics,In=pn!==8203?os:0,Ri){const Dh=Kn.ascender!==void 0?Math.abs(Kn.ascender):0,Au=Kn.descender!==void 0?Math.abs(Kn.descender):0,Eu=(Dh+Au)*Cr;cn<Eu&&(cn=Eu,_n=(Dh-Au)/2*Cr),as=-Dh*Cr}else as=$m+(sr-Cr)*os}Zn?(rt.verticalizable=!0,Kr.push({glyph:pn,imageName:Us,x:Ai,y:vi+as,vertical:Zn,scale:Cr,localGlyph:Ln.localGlyph,fontStack:zn.fontStack,sectionIndex:Mn,metrics:Ln,rect:Jr}),Ai+=In*Cr+ui):(Kr.push({glyph:pn,imageName:Us,x:Ai,y:vi+as,vertical:Zn,scale:Cr,localGlyph:Ln.localGlyph,fontStack:zn.fontStack,sectionIndex:Mn,metrics:Ln,rect:Jr}),Ai+=Ln.advance*Cr+ui)}Kr.length!==0&&(Ji=Math.max(Ai-ui,Ji),Ri?Qm(Kr,fi,Ur,_n,Nt*sr/2):Qm(Kr,fi,Ur,0,Nt/2)),Ai=0;const Pn=Nt*sr+Ur;Zr.lineOffset=Math.max(Ur,jr),vi+=Pn,++Qi}var wr;const er=vi,{horizontalAlign:Gi,verticalAlign:en}=vd(Jt);(function(nr,sr,jr,Zr,Kr,Ur){const cn=(sr-jr)*Kr,_n=-Ur*Zr;for(const Pn of nr)for(const Vr of Pn.positionedGlyphs)Vr.x+=cn,Vr.y+=_n})(rt.positionedLines,fi,Gi,en,Ji,er),rt.top+=-en*er,rt.bottom=rt.top+er,rt.left+=-Gi*Ji,rt.right=rt.left+Ji,rt.hasBaseline=Ri}(nt,e,n,s,Ae,y,T,P,G,O,$,Q),!function(rt){for(const Ot of rt)if(Ot.positionedGlyphs.length!==0)return!1;return!0}(Ze)&&nt}const cf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ey={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ym(i,e,n,s,a,p){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*os/p+a:0}{const y=n[e.fontStack],T=y&&y.glyphs[i];return T?T.metrics.advance*e.scale+a:0}}function Zm(i,e,n,s){const a=Math.pow(i-e,2);return s?i<e?a/2:2*a:a+Math.abs(n)*n}function Py(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Km(i,e,n,s,a,p){let y=null,T=Zm(e,n,a,p);for(const P of s){const O=Zm(e-P.x,n,a,p)+P.badness;O<=T&&(y=P,T=O)}return{index:i,x:e,priorBreak:y,badness:T}}function Jm(i){return i?Jm(i.priorBreak).concat(i.index):[]}function vd(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Qm(i,e,n,s,a){if(!(e||n||s||a))return;const p=i.length-1,y=i[p],T=(y.x+y.metrics.advance*y.scale)*e;for(let P=0;P<=p;P++)i[P].x-=T,i[P].y+=n+s+a}function My(i,e,n){const{horizontalAlign:s,verticalAlign:a}=vd(n),p=e[0]-i.displaySize[0]*s,y=e[1]-i.displaySize[1]*a;return{image:i,top:y,bottom:y+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function eg(i,e,n,s,a,p){const y=i.image;let T;if(y.content){const Ae=y.content,Fe=y.pixelRatio||1;T=[Ae[0]/Fe,Ae[1]/Fe,y.displaySize[0]-Ae[2]/Fe,y.displaySize[1]-Ae[3]/Fe]}const P=e.left*p,O=e.right*p;let j,G,$,Z;n==="width"||n==="both"?(Z=a[0]+P-s[3],G=a[0]+O+s[1]):(Z=a[0]+(P+O-y.displaySize[0])/2,G=Z+y.displaySize[0]);const Q=e.top*p,ne=e.bottom*p;return n==="height"||n==="both"?(j=a[1]+Q-s[0],$=a[1]+ne+s[2]):(j=a[1]+(Q+ne-y.displaySize[1])/2,$=j+y.displaySize[1]),{image:y,top:j,right:G,bottom:$,left:Z,collisionPadding:T}}class Kl extends ve{constructor(e,n,s,a,p){super(e,n),this.angle=a,this.z=s,p!==void 0&&(this.segment=p)}clone(){return new Kl(this.x,this.y,this.z,this.angle,this.segment)}}function tg(i,e,n,s,a){if(e.segment===void 0)return!0;let p=e,y=e.segment+1,T=0;for(;T>-n/2;){if(y--,y<0)return!1;T-=i[y].dist(p),p=i[y]}T+=i[y].dist(i[y+1]),y++;const P=[];let O=0;for(;T<n/2;){const j=i[y],G=i[y+1];if(!G)return!1;let $=i[y-1].angleTo(j)-j.angleTo(G);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:T,angleDelta:$}),O+=$;T-P[0].distance>s;)O-=P.shift().angleDelta;if(O>a)return!1;y++,T+=j.dist(G)}return!0}function ig(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function rg(i,e,n){return i?.6*e*n:0}function ng(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Ly(i,e,n,s,a,p){const y=rg(n,a,p),T=ng(n,s)*p;let P=0;const O=ig(i)/2;for(let j=0;j<i.length-1;j++){const G=i[j],$=i[j+1],Z=G.dist($);if(P+Z>O){const Q=(O-P)/Z,ne=Ci(G.x,$.x,Q),Ae=Ci(G.y,$.y,Q),Fe=new Kl(ne,Ae,0,$.angleTo(G),j);return!y||tg(i,Fe,T,y,e)?Fe:void 0}P+=Z}}function Iy(i,e,n,s,a,p,y,T,P){const O=rg(s,p,y),j=ng(s,a),G=j*y,$=i[0].x===0||i[0].x===P||i[0].y===0||i[0].y===P;return e-G<e/4&&(e=G+e/4),sg(i,$?e/2*T%e:(j/2+2*p)*y*T%e,e,O,n,G,$,!1,P)}function sg(i,e,n,s,a,p,y,T,P){const O=p/2,j=ig(i);let G=0,$=e-n,Z=[];for(let Q=0;Q<i.length-1;Q++){const ne=i[Q],Ae=i[Q+1],Fe=ne.dist(Ae),Je=Ae.angleTo(ne);for(;$+n<G+Fe;){$+=n;const Be=($-G)/Fe,Ze=Ci(ne.x,Ae.x,Be),nt=Ci(ne.y,Ae.y,Be);if(Ze>=0&&Ze<P&&nt>=0&&nt<P&&$-O>=0&&$+O<=j){const rt=new Kl(Ze,nt,0,Je,Q);rt._round(),s&&!tg(i,rt,p,s,a)||Z.push(rt)}}G+=Fe}return T||Z.length||y||(Z=sg(i,G/2,n,s,a,p,y,!0,P)),Z}function og(i,e,n,s,a){const p=[];for(let y=0;y<i.length;y++){const T=i[y];let P;for(let O=0;O<T.length-1;O++){let j=T[O],G=T[O+1];j.x<e&&G.x<e||(j.x<e?j=new ve(e,j.y+(e-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<e&&(G=new ve(e,j.y+(e-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<n&&G.y<n||(j.y<n?j=new ve(j.x+(n-j.y)/(G.y-j.y)*(G.x-j.x),n)._round():G.y<n&&(G=new ve(j.x+(n-j.y)/(G.y-j.y)*(G.x-j.x),n)._round()),j.x>=s&&G.x>=s||(j.x>=s?j=new ve(s,j.y+(s-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=s&&(G=new ve(s,j.y+(s-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=a&&G.y>=a||(j.y>=a?j=new ve(j.x+(a-j.y)/(G.y-j.y)*(G.x-j.x),a)._round():G.y>=a&&(G=new ve(j.x+(a-j.y)/(G.y-j.y)*(G.x-j.x),a)._round()),P&&j.equals(P[P.length-1])||(P=[j],p.push(P)),P.push(G)))))}}return p}bi(Kl,"Anchor");const _u=1e20;function ag(i,e,n,s,a,p,y,T,P){for(let O=e;O<e+s;O++)lg(i,n*p+O,p,a,y,T,P);for(let O=n;O<n+a;O++)lg(i,O*p+e,1,s,y,T,P)}function lg(i,e,n,s,a,p,y){p[0]=0,y[0]=-_u,y[1]=_u,a[0]=i[e];for(let T=1,P=0,O=0;T<s;T++){a[T]=i[e+T*n];const j=T*T;do{const G=p[P];O=(a[T]-a[G]+j-G*G)/(T-G)/2}while(O<=y[P]&&--P>-1);P++,p[P]=T,y[P]=O,y[P+1]=_u}for(let T=0,P=0;T<s;T++){for(;y[P+1]<T;)P++;const O=p[P],j=T-O;i[e+T*n]=a[O]+j*j}}const Ga=2,xd={none:0,ideographs:1,all:2};class Eh{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const a in e)for(const p of e[a])s.push({stack:a,id:p});Oe(s,({stack:a,id:p},y)=>{let T=this.entries[a];T||(T=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=T.glyphs[p];if(P!==void 0)return void y(null,{stack:a,id:p,glyph:P});if(P=this._tinySDF(T,a,p),P)return T.glyphs[p]=P,void y(null,{stack:a,id:p,glyph:P});const O=Math.floor(p/256);if(256*O>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[O])return void y(null,{stack:a,id:p,glyph:P});let j=T.requests[O];j||(j=T.requests[O]=[],Eh.loadGlyphRange(a,O,this.url,this.requestManager,(G,$)=>{if($){T.ascender=$.ascender,T.descender=$.descender;for(const Z in $.glyphs)this._doesCharSupportLocalGlyph(+Z)||(T.glyphs[+Z]=$.glyphs[+Z]);T.ranges[O]=!0}for(const Z of j)Z(G,$);delete T.requests[O]})),j.push((G,$)=>{G?y(G):$&&y(null,{stack:a,id:p,glyph:$.glyphs[p]||null})})},(a,p)=>{if(a)n(a);else if(p){const y={};for(const{stack:T,id:P,glyph:O}of p)y[T]===void 0&&(y[T]={}),y[T].glyphs===void 0&&(y[T].glyphs={}),y[T].glyphs[P]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},y[T].ascender=this.entries[T].ascender,y[T].descender=this.entries[T].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==xd.none&&(this.localGlyphMode===xd.all?!!this.localFontFamily:!!this.localFontFamily&&(k["CJK Unified Ideographs"](e)||k["Hangul Syllables"](e)||k.Hiragana(e)||k.Katakana(e)||k["CJK Symbols and Punctuation"](e)))}_tinySDF(e,n,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let ne="400";/bold/i.test(n)?ne="900":/medium/i.test(n)?ne="500":/light/i.test(n)&&(ne="200"),p=e.tinySDF=new Eh.TinySDF({fontFamily:a,fontWeight:ne,fontSize:24*Ga,buffer:3*Ga,radius:8*Ga}),p.fontWeight=ne}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const y=String.fromCharCode(s),{data:T,width:P,height:O,glyphWidth:j,glyphHeight:G,glyphLeft:$,glyphTop:Z,glyphAdvance:Q}=p.draw(y);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Yl({width:P,height:O},T),metrics:{width:j/Ga,height:G/Ga,left:$/Ga,top:Z/Ga-27,advance:Q/Ga,localGlyph:!0}}}}Eh.loadGlyphRange=function(i,e,n,s,a){const p=256*e,y=p+255,T=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${p}-${y}`),wi.Glyphs);qr(T,(P,O)=>{if(P)a(P);else if(O){const j={},G=function($){return new lf($).readFields(Ty,{})}(O);for(const $ of G.glyphs)j[$.id]=$;a(null,{glyphs:j,ascender:G.ascender,descender:G.descender})}})},Eh.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:p="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const T=this.size=i+4*e,P=this._createCanvas(T),O=this.ctx=P.getContext("2d",{willReadFrequently:!0});O.font=`${y} ${p} ${i}px ${a}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:p}=this.ctx.measureText(i),y=Math.ceil(n),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-a))),P=Math.min(this.size-this.buffer,y+Math.ceil(s)),O=T+2*this.buffer,j=P+2*this.buffer,G=Math.max(O*j,0),$=new Uint8ClampedArray(G),Z={data:$,width:O,height:j,glyphWidth:T,glyphHeight:P,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||P===0)return Z;const{ctx:Q,buffer:ne,gridInner:Ae,gridOuter:Fe}=this;Q.clearRect(ne,ne,T,P),Q.fillText(i,ne,ne+y);const Je=Q.getImageData(ne,ne,T,P);Fe.fill(_u,0,G),Ae.fill(0,0,G);for(let Be=0;Be<P;Be++)for(let Ze=0;Ze<T;Ze++){const nt=Je.data[4*(Be*T+Ze)+3]/255;if(nt===0)continue;const rt=(Be+ne)*O+Ze+ne;if(nt===1)Fe[rt]=0,Ae[rt]=_u;else{const Ot=.5-nt;Fe[rt]=Ot>0?Ot*Ot:0,Ae[rt]=Ot<0?Ot*Ot:0}}ag(Fe,0,0,O,j,O,this.f,this.v,this.z),ag(Ae,ne,ne,T,P,O,this.f,this.v,this.z);for(let Be=0;Be<G;Be++){const Ze=Math.sqrt(Fe[Be])-Math.sqrt(Ae[Be]);$[Be]=Math.round(255-255*(Ze/this.radius+this.cutoff))}return Z}};const Ph=lo;function cg(i,e,n,s){const a=[],p=i.image,y=p.pixelRatio,T=p.paddedRect.w-2*Ph,P=p.paddedRect.h-2*Ph,O=i.right-i.left,j=i.bottom-i.top,G=p.stretchX||[[0,T]],$=p.stretchY||[[0,P]],Z=(Nt,Jt)=>Nt+Jt[1]-Jt[0],Q=G.reduce(Z,0),ne=$.reduce(Z,0),Ae=T-Q,Fe=P-ne;let Je=0,Be=Q,Ze=0,nt=ne,rt=0,Ot=Ae,kt=0,Ht=Fe;if(p.content&&s){const Nt=p.content;Je=hf(G,0,Nt[0]),Ze=hf($,0,Nt[1]),Be=hf(G,Nt[0],Nt[2]),nt=hf($,Nt[1],Nt[3]),rt=Nt[0]-Je,kt=Nt[1]-Ze,Ot=Nt[2]-Nt[0]-Be,Ht=Nt[3]-Nt[1]-nt}const hi=(Nt,Jt,Qt,ai)=>{const ui=uf(Nt.stretch-Je,Be,O,i.left),Wt=ff(Nt.fixed-rt,Ot,Nt.stretch,Q),gi=uf(Jt.stretch-Ze,nt,j,i.top),Ai=ff(Jt.fixed-kt,Ht,Jt.stretch,ne),vi=uf(Qt.stretch-Je,Be,O,i.left),Ji=ff(Qt.fixed-rt,Ot,Qt.stretch,Q),fi=uf(ai.stretch-Ze,nt,j,i.top),Ri=ff(ai.fixed-kt,Ht,ai.stretch,ne),Qi=new ve(ui,gi),wr=new ve(vi,gi),er=new ve(vi,fi),Gi=new ve(ui,fi),en=new ve(Wt/y,Ai/y),nr=new ve(Ji/y,Ri/y),sr=e*Math.PI/180;if(sr){const Kr=Math.sin(sr),Ur=Math.cos(sr),cn=[Ur,-Kr,Kr,Ur];Qi._matMult(cn),wr._matMult(cn),Gi._matMult(cn),er._matMult(cn)}const jr=Nt.stretch+Nt.fixed,Zr=Jt.stretch+Jt.fixed;return{tl:Qi,tr:wr,bl:Gi,br:er,tex:{x:p.paddedRect.x+Ph+jr,y:p.paddedRect.y+Ph+Zr,w:Qt.stretch+Qt.fixed-jr,h:ai.stretch+ai.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:en,pixelOffsetBR:nr,minFontScaleX:Ot/y/O,minFontScaleY:Ht/y/j,isSDF:n}};if(s&&(p.stretchX||p.stretchY)){const Nt=hg(G,Ae,Q),Jt=hg($,Fe,ne);for(let Qt=0;Qt<Nt.length-1;Qt++){const ai=Nt[Qt],ui=Nt[Qt+1];for(let Wt=0;Wt<Jt.length-1;Wt++)a.push(hi(ai,Jt[Wt],ui,Jt[Wt+1]))}}else a.push(hi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return a}function hf(i,e,n){let s=0;for(const a of i)s+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]));return s}function hg(i,e,n){const s=[{fixed:-Ph,stretch:0}];for(const[a,p]of i){const y=s[s.length-1];s.push({fixed:a-y.stretch,stretch:y.stretch}),s.push({fixed:a-y.stretch,stretch:y.stretch+(p-a)})}return s.push({fixed:e+Ph,stretch:n}),s}function uf(i,e,n,s){return i/e*n+s}function ff(i,e,n,s){return i-e*n/s}function ky(i,e,n,s){const a=e+i.positionedLines[s].lineOffset;return s===0?n+a/2:n+(a+(e+i.positionedLines[s-1].lineOffset))/2}class Dy{constructor(e=[],n=Oy){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,a=n[e];for(;e>0;){const p=e-1>>1,y=n[p];if(s(a,y)>=0)break;n[e]=y,e=p}n[e]=a}_down(e){const{data:n,compare:s}=this,a=this.length>>1,p=n[e];for(;e<a;){let y=1+(e<<1),T=n[y];const P=y+1;if(P<this.length&&s(n[P],T)<0&&(y=P,T=n[P]),s(T,p)>=0)break;n[e]=T,e=y}n[e]=p}}function Oy(i,e){return i<e?-1:i>e?1:0}function Fy(i,e=1,n=!1){let s=1/0,a=1/0,p=-1/0,y=-1/0;const T=i[0];for(let Z=0;Z<T.length;Z++){const Q=T[Z];(!Z||Q.x<s)&&(s=Q.x),(!Z||Q.y<a)&&(a=Q.y),(!Z||Q.x>p)&&(p=Q.x),(!Z||Q.y>y)&&(y=Q.y)}const P=Math.min(p-s,y-a);let O=P/2;const j=new Dy([],zy);if(P===0)return new ve(s,a);for(let Z=s;Z<p;Z+=P)for(let Q=a;Q<y;Q+=P)j.push(new Mh(Z+O,Q+O,O,i));let G=function(Z){let Q=0,ne=0,Ae=0;const Fe=Z[0];for(let Je=0,Be=Fe.length,Ze=Be-1;Je<Be;Ze=Je++){const nt=Fe[Je],rt=Fe[Ze],Ot=nt.x*rt.y-rt.x*nt.y;ne+=(nt.x+rt.x)*Ot,Ae+=(nt.y+rt.y)*Ot,Q+=3*Ot}return new Mh(ne/Q,Ae/Q,0,Z)}(i),$=j.length;for(;j.length;){const Z=j.pop();(Z.d>G.d||!G.d)&&(G=Z,n&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,$)),Z.max-G.d<=e||(O=Z.h/2,j.push(new Mh(Z.p.x-O,Z.p.y-O,O,i)),j.push(new Mh(Z.p.x+O,Z.p.y-O,O,i)),j.push(new Mh(Z.p.x-O,Z.p.y+O,O,i)),j.push(new Mh(Z.p.x+O,Z.p.y+O,O,i)),$+=4)}return n&&(console.log(`num probes: ${$}`),console.log(`best distance: ${G.d}`)),G.p}function zy(i,e){return e.max-i.max}class Mh{constructor(e,n,s,a){this.p=new ve(e,n),this.h=s,this.d=function(p,y){let T=!1,P=1/0;for(let O=0;O<y.length;O++){const j=y[O];for(let G=0,$=j.length,Z=$-1;G<$;Z=G++){const Q=j[G],ne=j[Z];Q.y>p.y!=ne.y>p.y&&p.x<(ne.x-Q.x)*(p.y-Q.y)/(ne.y-Q.y)+Q.x&&(T=!T),P=Math.min(P,sm(p,Q,ne))}}return(T?1:-1)*Math.sqrt(P)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Lh=7,bd=Number.POSITIVE_INFINITY,Ry=Math.sqrt(2);function ug(i,[e,n]){let s=0,a=0;if(n===bd){e<0&&(e=0);const p=e/Ry;switch(i){case"top-right":case"top-left":a=p-Lh;break;case"bottom-right":case"bottom-left":a=-p+Lh;break;case"bottom":a=-e+Lh;break;case"top":a=e-Lh}switch(i){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),i){case"top-right":case"top-left":case"top":a=n-Lh;break;case"bottom-right":case"bottom-left":case"bottom":a=-n+Lh}switch(i){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,a]}function By(i,e,n,s,a,p,y,T,P,O){i.createArrays(),i.tilePixelRatio=Bi/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const j=i.layers[0].layout,G=i.layers[0]._unevaluatedLayout._values,$={};if(i.textSizeData.kind==="composite"){const{minZoom:ne,maxZoom:Ae}=i.textSizeData;$.compositeTextSizes=[G["text-size"].possiblyEvaluate(new N(ne),T),G["text-size"].possiblyEvaluate(new N(Ae),T)]}if(i.iconSizeData.kind==="composite"){const{minZoom:ne,maxZoom:Ae}=i.iconSizeData;$.compositeIconSizes=[G["icon-size"].possiblyEvaluate(new N(ne),T),G["icon-size"].possiblyEvaluate(new N(Ae),T)]}$.layoutTextSize=G["text-size"].possiblyEvaluate(new N(P+1),T),$.layoutIconSize=G["icon-size"].possiblyEvaluate(new N(P+1),T),$.textMaxSize=G["text-size"].possiblyEvaluate(new N(18),T);const Z=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Q=j.get("text-size");for(const ne of i.features){const Ae=j.get("text-font").evaluate(ne,{},T).join(","),Fe=Q.evaluate(ne,{},T),Je=$.layoutTextSize.evaluate(ne,{},T),Be=($.layoutIconSize.evaluate(ne,{},T),{horizontal:{},vertical:void 0}),Ze=ne.text;let nt,rt=[0,0];if(Ze){const Ht=Ze.toString(),hi=j.get("text-letter-spacing").evaluate(ne,{},T)*os,Nt=j.get("text-line-height").evaluate(ne,{},T)*os,Jt=J(Ht)?hi:0,Qt=j.get("text-anchor").evaluate(ne,{},T),ai=j.get("text-variable-anchor");if(!ai){const vi=j.get("text-radial-offset").evaluate(ne,{},T);rt=vi?ug(Qt,[vi*os,bd]):j.get("text-offset").evaluate(ne,{},T).map(Ji=>Ji*os)}let ui=Z?"center":j.get("text-justify").evaluate(ne,{},T);const Wt=j.get("symbol-placement")==="point",gi=Wt?j.get("text-max-width").evaluate(ne,{},T)*os:1/0,Ai=vi=>{i.allowVerticalPlacement&&W(Ht)&&(Be.vertical=yd(Ze,e,n,a,Ae,gi,Nt,Qt,vi,Jt,rt,Jo.vertical,!0,Je,Fe))};if(!Z&&ai){const vi=ui==="auto"?ai.map(fi=>wd(fi)):[ui];let Ji=!1;for(let fi=0;fi<vi.length;fi++){const Ri=vi[fi];if(!Be.horizontal[Ri])if(Ji)Be.horizontal[Ri]=Be.horizontal[0];else{const Qi=yd(Ze,e,n,a,Ae,gi,Nt,"center",Ri,Jt,rt,Jo.horizontal,!1,Je,Fe);Qi&&(Be.horizontal[Ri]=Qi,Ji=Qi.positionedLines.length===1)}}Ai("left")}else{if(ui==="auto"&&(ui=wd(Qt)),Wt||j.get("text-writing-mode").indexOf("horizontal")>=0||!W(Ht)){const vi=yd(Ze,e,n,a,Ae,gi,Nt,Qt,ui,Jt,rt,Jo.horizontal,!1,Je,Fe);vi&&(Be.horizontal[ui]=vi)}Ai(Wt?"left":ui)}}let Ot=!1;if(ne.icon&&ne.icon.name){const Ht=s[ne.icon.name];Ht&&(nt=My(a[ne.icon.name],j.get("icon-offset").evaluate(ne,{},T),j.get("icon-anchor").evaluate(ne,{},T)),Ot=Ht.sdf,i.sdfIcons===void 0?i.sdfIcons=Ht.sdf:i.sdfIcons!==Ht.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==i.pixelRatio||j.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const kt=dg(Be.horizontal)||Be.vertical;i.iconsInText||(i.iconsInText=!!kt&&kt.iconsInText),(kt||nt)&&Ny(i,ne,Be,nt,s,$,Je,0,rt,Ot,y,T,O)}p&&i.generateCollisionDebugBuffers(P,i.collisionBoxArray)}function wd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ny(i,e,n,s,a,p,y,T,P,O,j,G,$){let Z=p.textMaxSize.evaluate(e,{},G);Z===void 0&&(Z=y);const Q=i.layers[0].layout,ne=Q.get("icon-offset").evaluate(e,{},G),Ae=dg(n.horizontal)||n.vertical,Fe=$.name==="globe",Je=os,Be=y/Je,Ze=i.tilePixelRatio*Z/Je,nt=(Qt=i.overscaling,i.zoom>18&&Qt>2&&(Qt>>=1),Math.max(Bi/(512*Qt),1)*Q.get("symbol-spacing")),rt=Q.get("text-padding")*i.tilePixelRatio,Ot=Q.get("icon-padding")*i.tilePixelRatio,kt=pe(Q.get("text-max-angle")),Ht=Q.get("text-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",hi=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",Nt=Q.get("symbol-placement"),Jt=nt/2;var Qt;const ai=Q.get("icon-text-fit");let ui;s&&ai!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(ui=eg(s,n.vertical,ai,Q.get("icon-text-fit-padding"),ne,Be)),Ae&&(s=eg(s,Ae,ai,Q.get("icon-text-fit-padding"),ne,Be)));const Wt=(gi,Ai,vi)=>{if(Ai.x<0||Ai.x>=Bi||Ai.y<0||Ai.y>=Bi)return;let Ji=null;if(Fe){const{x:fi,y:Ri,z:Qi}=$.projectTilePoint(Ai.x,Ai.y,vi);Ji={anchor:new Kl(fi,Ri,Qi,0,void 0),up:$.upVector(vi,Ai.x,Ai.y)}}(function(fi,Ri,Qi,wr,er,Gi,en,nr,sr,jr,Zr,Kr,Ur,cn,_n,Pn,Vr,zn,Mn,pn,Cr,Ln,Jr,Us,In){const as=fi.addToLineVertexArray(Ri,wr);let Zn,Vs,Kn,Xa,Dh,Au,Eu,Xg=0,Hg=0,$g=0,Yg=0,Rd=-1,Bd=-1;const Cl={};let Zg=la("");const $c=Qi?Qi.anchor:Ri;let Nd=0,jd=0;if(sr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Nd,jd]=sr.layout.get("text-offset").evaluate(Cr,{},In).map(Eo=>Eo*os):(Nd=sr.layout.get("text-radial-offset").evaluate(Cr,{},In)*os,jd=bd),fi.allowVerticalPlacement&&er.vertical){const Eo=er.vertical;if(_n)Au=Sd(Eo),nr&&(Eu=Sd(nr));else{const Po=sr.layout.get("text-rotate").evaluate(Cr,{},In)+90;Kn=df(jr,$c,Ri,Zr,Kr,Ur,Eo,cn,Po,Pn),nr&&(Xa=df(jr,$c,Ri,Zr,Kr,Ur,nr,zn,Po))}}if(Gi){const Eo=sr.layout.get("icon-rotate").evaluate(Cr,{},In),Po=sr.layout.get("icon-text-fit")!=="none",Pu=cg(Gi,Eo,Jr,Po),Vd=nr?cg(nr,Eo,Jr,Po):void 0;Vs=df(jr,$c,Ri,Zr,Kr,Ur,Gi,zn,Eo),Xg=4*Pu.length;const Kg=fi.iconSizeData;let Yc=null;Kg.kind==="source"?(Yc=[qa*sr.layout.get("icon-size").evaluate(Cr,{},In)],Yc[0]>nc&&Xe(`${fi.layerIds[0]}: Value for "icon-size" is >= ${yu}. Reduce your "icon-size".`)):Kg.kind==="composite"&&(Yc=[qa*Ln.compositeIconSizes[0].evaluate(Cr,{},In),qa*Ln.compositeIconSizes[1].evaluate(Cr,{},In)],(Yc[0]>nc||Yc[1]>nc)&&Xe(`${fi.layerIds[0]}: Value for "icon-size" is >= ${yu}. Reduce your "icon-size".`)),fi.addSymbols(fi.icon,Pu,Yc,pn,Mn,Cr,!1,Qi,Ri,as.lineStartIndex,as.lineLength,-1,Us,In),Rd=fi.icon.placedSymbolArray.length-1,Vd&&(Hg=4*Vd.length,fi.addSymbols(fi.icon,Vd,Yc,pn,Mn,Cr,Jo.vertical,Qi,Ri,as.lineStartIndex,as.lineLength,-1,Us,In),Bd=fi.icon.placedSymbolArray.length-1)}for(const Eo in er.horizontal){const Po=er.horizontal[Eo];Zn||(Zg=la(Po.text),_n?Dh=Sd(Po):Zn=df(jr,$c,Ri,Zr,Kr,Ur,Po,cn,sr.layout.get("text-rotate").evaluate(Cr,{},In),Pn));const Pu=Po.positionedLines.length===1;if($g+=fg(fi,Qi,Ri,Po,en,sr,_n,Cr,Pn,as,er.vertical?Jo.horizontal:Jo.horizontalOnly,Pu?Object.keys(er.horizontal):[Eo],Cl,Rd,Ln,Us,In),Pu)break}er.vertical&&(Yg+=fg(fi,Qi,Ri,er.vertical,en,sr,_n,Cr,Pn,as,Jo.vertical,["vertical"],Cl,Bd,Ln,Us,In));let hc=-1;const Ud=(Eo,Po)=>Eo?Math.max(Eo,Po):Po;hc=Ud(Dh,hc),hc=Ud(Au,hc),hc=Ud(Eu,hc);const d1=hc>-1?1:0;fi.glyphOffsetArray.length>=oc.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Cr.sortKey!==void 0&&fi.addToSortKeyRanges(fi.symbolInstances.length,Cr.sortKey),fi.symbolInstances.emplaceBack($c.x,$c.y,$c.z,Ri.x,Ri.y,Cl.right>=0?Cl.right:-1,Cl.center>=0?Cl.center:-1,Cl.left>=0?Cl.left:-1,Cl.vertical>=0?Cl.vertical:-1,Rd,Bd,Zg,Zn!==void 0?Zn:fi.collisionBoxArray.length,Zn!==void 0?Zn+1:fi.collisionBoxArray.length,Kn!==void 0?Kn:fi.collisionBoxArray.length,Kn!==void 0?Kn+1:fi.collisionBoxArray.length,Vs!==void 0?Vs:fi.collisionBoxArray.length,Vs!==void 0?Vs+1:fi.collisionBoxArray.length,Xa||fi.collisionBoxArray.length,Xa?Xa+1:fi.collisionBoxArray.length,Zr,$g,Yg,Xg,Hg,d1,0,Nd,jd,hc)})(i,Ai,Ji,gi,n,s,a,ui,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,rt,Ht,P,0,Ot,hi,ne,e,p,O,j,G)};if(Nt==="line")for(const gi of og(e.geometry,0,0,Bi,Bi)){const Ai=Iy(gi,nt,kt,n.vertical||Ae,s,Je,Ze,i.overscaling,Bi);for(const vi of Ai)Ae&&jy(i,Ae.text,Jt,vi)||Wt(gi,vi,G)}else if(Nt==="line-center"){for(const gi of e.geometry)if(gi.length>1){const Ai=Ly(gi,kt,n.vertical||Ae,s,Je,Ze);Ai&&Wt(gi,Ai,G)}}else if(e.type==="Polygon")for(const gi of cd(e.geometry,0)){const Ai=Fy(gi,16);Wt(gi[0],new Kl(Ai.x,Ai.y,0,0,void 0),G)}else if(e.type==="LineString")for(const gi of e.geometry)Wt(gi,new Kl(gi[0].x,gi[0].y,0,0,void 0),G);else if(e.type==="Point")for(const gi of e.geometry)for(const Ai of gi)Wt([Ai],new Kl(Ai.x,Ai.y,0,0,void 0),G)}const yu=255,nc=yu*qa;function fg(i,e,n,s,a,p,y,T,P,O,j,G,$,Z,Q,ne,Ae){const Fe=function(Ze,nt,rt,Ot,kt,Ht,hi,Nt){const Jt=[];if(nt.positionedLines.length===0)return Jt;const Qt=Ot.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,ai=function(vi){const Ji=vi[0],fi=vi[1],Ri=Ji*fi;return Ri>0?[Ji,-fi]:Ri<0?[-Ji,fi]:Ji===0?[fi,Ji]:[fi,-Ji]}(rt);let ui=Math.abs(nt.top-nt.bottom);for(const vi of nt.positionedLines)ui-=vi.lineOffset;const Wt=nt.positionedLines.length,gi=ui/Wt;let Ai=nt.top-rt[1];for(let vi=0;vi<Wt;++vi){const Ji=nt.positionedLines[vi];Ai=ky(nt,gi,Ai,vi);for(const fi of Ji.positionedGlyphs){if(!fi.rect)continue;const Ri=fi.rect||{};let Qi=Xm+1,wr=!0,er=1,Gi=0;if(fi.imageName){const Jr=hi[fi.imageName];if(!Jr)continue;if(Jr.sdf){Xe("SDF images are not supported in formatted text and will be ignored.");continue}wr=!1,er=Jr.pixelRatio,Qi=lo/er}const en=(kt||Nt)&&fi.vertical,nr=fi.metrics.advance*fi.scale/2,sr=fi.metrics,jr=fi.rect;if(jr===null)continue;Nt&&nt.verticalizable&&(Gi=fi.imageName?nr-fi.metrics.width*fi.scale/2:0);const Zr=kt?[fi.x+nr,fi.y]:[0,0];let Kr=[0,0],Ur=[0,0],cn=!1;kt||(en?(Ur=[fi.x+nr+ai[0],fi.y+ai[1]-Gi],cn=!0):Kr=[fi.x+nr+rt[0],fi.y+rt[1]-Gi]);const _n=jr.w*fi.scale/(er*(fi.localGlyph?Ga:1)),Pn=jr.h*fi.scale/(er*(fi.localGlyph?Ga:1));let Vr,zn,Mn,pn;if(en){const Jr=fi.y-Ai,Us=new ve(-nr,nr-Jr),In=-Math.PI/2,as=new ve(...Ur);Vr=new ve(-nr+Kr[0],Kr[1]),Vr._rotateAround(In,Us)._add(as),Vr.x+=-Jr+nr,Vr.y-=(sr.left-Qi)*fi.scale;const Zn=fi.imageName?sr.advance*fi.scale:os*fi.scale,Vs=String.fromCharCode(fi.glyph);dy(Vs)?Vr.x+=(1-Qi)*fi.scale:py(Vs)?Vr.x+=Zn-sr.height*fi.scale+(-Qi-1)*fi.scale:Vr.x+=fi.imageName||sr.width+2*Qi===jr.w&&sr.height+2*Qi===jr.h?(Zn-Pn)/2:(Zn-(sr.height+2*Qi)*fi.scale)/2,zn=new ve(Vr.x,Vr.y-_n),Mn=new ve(Vr.x+Pn,Vr.y),pn=new ve(Vr.x+Pn,Vr.y-_n)}else{const Jr=(sr.left-Qi)*fi.scale-nr+Kr[0],Us=(-sr.top-Qi)*fi.scale+Kr[1],In=Jr+_n,as=Us+Pn;Vr=new ve(Jr,Us),zn=new ve(In,Us),Mn=new ve(Jr,as),pn=new ve(In,as)}if(Qt){let Jr;Jr=kt?new ve(0,0):cn?new ve(ai[0],ai[1]):new ve(rt[0],rt[1]),Vr._rotateAround(Qt,Jr),zn._rotateAround(Qt,Jr),Mn._rotateAround(Qt,Jr),pn._rotateAround(Qt,Jr)}const Cr=new ve(0,0),Ln=new ve(0,0);Jt.push({tl:Vr,tr:zn,bl:Mn,br:pn,tex:Ri,writingMode:nt.writingMode,glyphOffset:Zr,sectionIndex:fi.sectionIndex,isSDF:wr,pixelOffsetTL:Cr,pixelOffsetBR:Ln,minFontScaleX:0,minFontScaleY:0})}}return Jt}(0,s,P,p,y,T,a,i.allowVerticalPlacement),Je=i.textSizeData;let Be=null;Je.kind==="source"?(Be=[qa*p.layout.get("text-size").evaluate(T,{},Ae)],Be[0]>nc&&Xe(`${i.layerIds[0]}: Value for "text-size" is >= ${yu}. Reduce your "text-size".`)):Je.kind==="composite"&&(Be=[qa*Q.compositeTextSizes[0].evaluate(T,{},Ae),qa*Q.compositeTextSizes[1].evaluate(T,{},Ae)],(Be[0]>nc||Be[1]>nc)&&Xe(`${i.layerIds[0]}: Value for "text-size" is >= ${yu}. Reduce your "text-size".`)),i.addSymbols(i.text,Fe,Be,P,y,T,j,e,n,O.lineStartIndex,O.lineLength,Z,ne,Ae);for(const Ze of G)$[Ze]=i.text.placedSymbolArray.length-1;return 4*Fe.length}function dg(i){for(const e in i)return i[e];return null}function df(i,e,n,s,a,p,y,T,P,O){let j=y.top,G=y.bottom,$=y.left,Z=y.right;const Q=y.collisionPadding;if(Q&&($-=Q[0],j-=Q[1],Z+=Q[2],G+=Q[3]),P){const ne=new ve($,j),Ae=new ve(Z,j),Fe=new ve($,G),Je=new ve(Z,G),Be=pe(P);let Ze=new ve(0,0);O&&(Ze=new ve(O[0],O[1])),ne._rotateAround(Be,Ze),Ae._rotateAround(Be,Ze),Fe._rotateAround(Be,Ze),Je._rotateAround(Be,Ze),$=Math.min(ne.x,Ae.x,Fe.x,Je.x),Z=Math.max(ne.x,Ae.x,Fe.x,Je.x),j=Math.min(ne.y,Ae.y,Fe.y,Je.y),G=Math.max(ne.y,Ae.y,Fe.y,Je.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,$,j,Z,G,T,s,a,p),i.length-1}function Sd(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function jy(i,e,n,s){const a=i.compareText;if(e in a){const p=a[e];for(let y=p.length-1;y>=0;y--)if(s.dist(p[y])<n)return!0}else a[e]=[];return a[e].push(s),!1}function pg(i,e){const n=i.fovAboveCenter,s=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,a=(i._camera.position[2]*i.worldSize-s)/Math.cos(i._pitch),p=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),y=Math.sin(i._pitch)*p+a;return Math.min(1.01*y,a*(1/i._horizonShift))}function Xc(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const n=Math.pow(2,-i.z),s=i.x*n,a=(i.x+1)*n,p=i.y*n,y=(i.y+1)*n,T=Ko(s),P=Ko(a),O=vs(p),j=vs(y),G=e.project(T,O),$=e.project(P,O),Z=e.project(P,j),Q=e.project(T,j);let ne=Math.min(G.x,$.x,Z.x,Q.x),Ae=Math.min(G.y,$.y,Z.y,Q.y),Fe=Math.max(G.x,$.x,Z.x,Q.x),Je=Math.max(G.y,$.y,Z.y,Q.y);const Be=n/16;function Ze(rt,Ot,kt,Ht,hi,Nt){const Jt=(kt+hi)/2,Qt=(Ht+Nt)/2,ai=e.project(Ko(Jt),vs(Qt)),ui=Math.max(0,ne-ai.x,Ae-ai.y,ai.x-Fe,ai.y-Je);ne=Math.min(ne,ai.x),Fe=Math.max(Fe,ai.x),Ae=Math.min(Ae,ai.y),Je=Math.max(Je,ai.y),ui>Be&&(Ze(rt,ai,kt,Ht,Jt,Qt),Ze(ai,Ot,Jt,Qt,hi,Nt))}Ze(G,$,s,p,a,p),Ze($,Z,a,p,a,y),Ze(Z,Q,a,y,s,y),Ze(Q,G,s,y,s,p),ne-=Be,Ae-=Be,Fe+=Be,Je+=Be;const nt=1/Math.max(Fe-ne,Je-Ae);return{scale:nt,x:ne*nt,y:Ae*nt,x2:Fe*nt,y2:Je*nt,projection:e}}const Uy=ja(new Float32Array(16));class sc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Nr(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Va(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return pg(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,a){const p=e.horizonLineFromTop(!1),y=new ve(n,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,a))}pointCoordinate3D(e,n,s){const a=new ve(n,s);if(e.elevation)return e.elevation.pointCoordinate(a);{const p=this.pointCoordinate(e,a.x,a.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return Uy}createTileMatrix(e,n,s){let a,p,y;const T=s.canonical,P=ja(new Float64Array(16));if(this.isReprojectedInTileSpace){const O=Xc(T,this);a=1,p=O.x+s.wrap*O.scale,y=O.y,Nc(P,P,[a/O.scale,a/O.scale,e.pixelsPerMeter/n])}else a=n/e.zoomScale(T.z),p=(T.x+Math.pow(2,T.z)*s.wrap)*a,y=T.y*a;return Yh(P,P,[p,y,0]),Nc(P,P,[a/Bi,a/Bi,1]),P}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class Vy extends sc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(pe(n));this.n=(a+Math.sin(pe(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:a,r0:p}=this,y=pe(e-this.center[0]),T=pe(n),P=Math.sqrt(a-2*s*Math.sin(T))/s;return{x:P*Math.sin(y*s),y:P*Math.cos(y*s)-p,z:0}}unproject(e,n){const{n:s,c:a,r0:p}=this,y=p+n;let T=Math.atan2(e,Math.abs(y))*Math.sign(y);y*s<0&&(T-=Math.PI*Math.sign(e)*Math.sign(y));const P=pe(this.center[0])*s;T=Te(T,-Math.PI-P,Math.PI-P);const O=He(ze(T/s)+this.center[0],-180,180),j=Math.asin(He((a-(e*e+y*y)*s*s)/(2*s),-1,1)),G=He(ze(j),-xs,xs);return new Nr(O,G)}}const vu=1.340264,xu=-.081106,bu=893e-6,wu=.003796,pf=Math.sqrt(3)/2;class qy extends sc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(pf*Math.sin(n)),a=s*s,p=a*a*a;return{x:.5*(e*Math.cos(s)/(pf*(vu+3*xu*a+p*(7*bu+9*wu*a)))/Math.PI+.5),y:1-.5*(s*(vu+xu*a+p*(bu+wu*a))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,a=s*s,p=a*a*a;for(let j,G,$,Z=0;Z<12&&(G=s*(vu+xu*a+p*(bu+wu*a))-n,$=vu+3*xu*a+p*(7*bu+9*wu*a),j=G/$,s=He(s-j,-Math.PI/3,Math.PI/3),a=s*s,p=a*a*a,!(Math.abs(j)<1e-12));++Z);const y=pf*e*(vu+3*xu*a+p*(7*bu+9*wu*a))/Math.cos(s),T=Math.asin(Math.sin(s)/pf),P=He(180*y/Math.PI,-180,180),O=He(180*T/Math.PI,-xs,xs);return new Nr(P,O)}}class Gy extends sc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),a=He(360*(.5-n),-xs,xs);return new Nr(s,a)}}const Ih=Math.PI/2;function mf(i){return Math.tan((Ih+i)/2)}class Wy extends sc{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let a=pe(n),p=pe(s);this.southernCenter=a+p<0,this.southernCenter&&(a=-a,p=-p);const y=Math.cos(a),T=mf(a);this.n=a===p?Math.sin(a):Math.log(y/Math.cos(p))/Math.log(mf(p)/T),this.f=y*Math.pow(mf(a),this.n)/this.n}project(e,n){n=pe(n),this.southernCenter&&(n=-n),e=pe(e-this.center[0]);const s=1e-6,{n:a,f:p}=this;p>0?n<-Ih+s&&(n=-Ih+s):n>Ih-s&&(n=Ih-s);const y=p/Math.pow(mf(n),a);let T=y*Math.sin(a*e),P=p-y*Math.cos(a*e);return T=.5*(T/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:T,y:this.southernCenter?P:1-P,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:a}=this,p=a-n,y=Math.sign(p),T=Math.sign(s)*Math.sqrt(e*e+p*p);let P=Math.atan2(e,Math.abs(p))*y;p*s<0&&(P-=Math.PI*Math.sign(e)*y);const O=He(ze(P/s)+this.center[0],-180,180),j=He(ze(2*Math.atan(Math.pow(a/T,1/s))-Ih),-xs,xs);return new Nr(O,this.southernCenter?-j:j)}}class mg extends sc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:xl(e),y:bl(n),z:0}}unproject(e,n){const s=Ko(e),a=vs(n);return new Nr(s,a)}}const gg=pe(xs);class Xy extends sc{project(e,n){const s=(n=pe(n))*n,a=s*s;return{x:.5*((e=pe(e))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,a=25,p=0,y=s*s;do{y=s*s;const O=y*y;p=(s*(1.007226+y*(.015085+O*(.028874*y-.044475-.005916*O)))-n)/(1.007226+y*(.045255+O*(.259866*y-.311325-.005916*11*O))),s=He(s-p,-gg,gg)}while(Math.abs(p)>1e-6&&--a>0);y=s*s;const T=He(ze(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),P=ze(s);return new Nr(T,P)}}const _g=pe(xs);class Hy extends sc{project(e,n){n=pe(n),e=pe(e);const s=Math.cos(n),a=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),y=Math.sin(p)/p,T=.5*(e*a+2*s*Math.sin(e/2)/y)||0,P=.5*(n+Math.sin(n)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,p=25;const y=1e-6;let T=0,P=0;do{const O=Math.cos(a),j=Math.sin(a),G=2*j*O,$=j*j,Z=O*O,Q=Math.cos(s/2),ne=Math.sin(s/2),Ae=2*Q*ne,Fe=ne*ne,Je=1-Z*Q*Q,Be=Je?1/Je:0,Ze=Je?Math.acos(O*Q)*Math.sqrt(1/Je):0,nt=.5*(2*Ze*O*ne+2*s/Math.PI)-e,rt=.5*(Ze*j+a)-n,Ot=.5*Be*(Z*Fe+Ze*O*Q*$)+1/Math.PI,kt=Be*(Ae*G/4-Ze*j*ne),Ht=.125*Be*(G*ne-Ze*j*Z*Ae),hi=.5*Be*($*Q+Ze*Fe*O)+.5,Nt=kt*Ht-hi*Ot;T=(rt*kt-nt*hi)/Nt,P=(nt*Ht-rt*Ot)/Nt,s=He(s-T,-Math.PI,Math.PI),a=He(a-P,-_g,_g)}while((Math.abs(T)>y||Math.abs(P)>y)&&--p>0);return new Nr(ze(s),ze(a))}}class yg extends sc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:a}=this;return{x:pe(e)*a*s+.5,y:-Math.sin(pe(n))/a*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:a}=this,p=-(n-.5)/s,y=He(ze((e-.5)/s)/a,-180,180),T=Math.asin(He(p*a,-1,1)),P=He(ze(T),-xs,xs);return new Nr(y,P)}}class $y extends mg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const a=ru(e,n,s);return Sn(a,a,nu(vl(s))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,n){const s=gh(n.lat,n.lng),a=Bs([],s),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Qh(s,s,a,Va(1,0)*Bi*p);const y=ja(new Float64Array(16));return Bc(y,e.pixelMatrix,e.globeMatrix),Sn(s,s,y),new ve(s[0],s[1])}pixelsPerMeter(e,n){return Va(1,0)*n}pixelSpaceConversion(e,n,s){const a=Va(1,e)*n,p=Ci(Va(1,45)*n,a,s);return this.pixelsPerMeter(e,n)/p}createTileMatrix(e,n,s){const a=Hf(vl(s.canonical));return Bc(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,n){const{center:s}=e,a=nu(vl(n));return Vu(a,a,pe(s.lng)),Rf(a,a,pe(s.lat)),Nc(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,n,s,a){return Wp(e,n,s,!0)||new yh(0,0)}pointCoordinate3D(e,n,s){const a=this.pointCoordinate(e,n,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,n){return!Wp(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(a,p){const y=a.cameraToCenterDistance,T=a._centerAltitude*p,P=a._camera,O=a._camera.forward(),j=Hl([],Zo([],O,-y),[0,0,T]),G=a.worldSize/(2*Math.PI),$=[0,0,-G],Z=a.width/a.height,Q=Math.tan(a.fovAboveCenter),ne=Zo([],P.up(),Q),Ae=Zo([],P.right(),Q*Z),Fe=Bs([],Hl([],Hl([],O,ne),Ae)),Je=[];let Be;if(new Uf(j,Fe).closestPointOnSphere($,G,Je)){const Ze=Hl([],Je,$),nt=Ua([],Ze,j);Be=Math.cos(a.fovAboveCenter)*Zh(nt)}else{const Ze=Ua([],j,$),nt=Ua([],$,j);Bs(nt,nt);const rt=Zh(Ze)-G;Be=Math.sqrt(rt*(rt+2*G));const Ot=Math.acos(Be/(G+rt))-Math.acos(ha(O,nt));Be*=Math.cos(Ot)}return 1.01*Be}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=_h(e.zoom);if(s>0){const a=pg(e,Va(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ci(n,a+p*(1-Math.cos(y)),Math.pow(s,10))}return n}upVector(e,n,s){return ru(n,s,e,1)}upVectorScale(e){return{metersToTile:qu(Wu(vl(e)))}}}function vg(i){const e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new mg(i);case"equirectangular":return new Gy(i);case"naturalEarth":return new Xy(i);case"equalEarth":return new qy(i);case"winkelTripel":return new Hy(i);case"albers":return n?new yg(i):new Vy(i);case"lambertConformalConic":return n?new yg(i):new Wy(i);case"globe":return new $y(i)}throw new Error(`Invalid projection name: ${i.name}`)}const Yy=tf.types,Zy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gf(i,e,n,s,a,p,y,T,P,O,j,G,$){const Z=T?Math.min(nc,Math.round(T[0])):0,Q=T?Math.min(nc,Math.round(T[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*a),p,y,(Z<<1)+(P?1:0),Q,16*O,16*j,256*G,256*$)}function _f(i,e,n,s,a,p,y){i.emplaceBack(e,n,s,a,p,y)}function yf(i,e,n,s,a){i.emplaceBack(e,n,s,a),i.emplaceBack(e,n,s,a),i.emplaceBack(e,n,s,a),i.emplaceBack(e,n,s,a)}function Ky(i){for(const e of i.sections)if(Ge(e.text))return!0;return!1}class Td{constructor(e){this.layoutVertexArray=new qt,this.indexArray=new Pi,this.programConfigurations=e,this.segments=new An,this.dynamicLayoutVertexArray=new ii,this.opacityVertexArray=new Oi,this.placedSymbolArray=new Br,this.globeExtVertexArray=new ci}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,a){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ay.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Zy,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,oy.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}bi(Td,"SymbolBuffers");class Cd{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new An,this.collisionVertexArray=new rr,this.collisionVertexArrayExt=new Xi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ly.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,cy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bi(Cd,"CollisionBuffers");class oc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ja([]),this.placementViewportMatrix=ja([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dd(this.zoom,n["text-size"]),this.iconSizeData=dd(this.zoom,n["icon-size"]);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(y=>Jo[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Td(new _l(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Td(new _l(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new _s,this.lineVertexArray=new Xl,this.symbolInstances=new $r}calculateGlyphDependencies(e,n,s,a,p){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,a&&p){const T=mu[e.charAt(y)];T&&(n[T.charCodeAt(0)]=!0)}}populate(e,n,s,a){const p=this.layers[0],y=p.layout,T=this.projection.name==="globe",P=y.get("text-font"),O=y.get("text-field"),j=y.get("icon-image"),G=(O.value.kind!=="constant"||O.value.value instanceof ar&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],!G&&!$)return;const Q=n.iconDependencies,ne=n.glyphDependencies,Ae=n.availableImages,Fe=new N(this.zoom);for(const{feature:Je,id:Be,index:Ze,sourceLayerIndex:nt}of e){const rt=p._featureFilter.needGeometry,Ot=qc(Je,rt);if(!p._featureFilter.filter(Fe,Ot,s))continue;if(rt||(Ot.geometry=$l(Je,s,a)),T&&Je.type!==1&&s.z<=5){const Nt=Ot.geometry,Jt=.98078528056,Qt=(ai,ui)=>ha(ru(ai.x,ai.y,s,1),ru(ui.x,ui.y,s,1))<Jt;for(let ai=0;ai<Nt.length;ai++)Nt[ai]=a0(Nt[ai],Qt)}let kt,Ht;if(G){const Nt=p.getValueAndResolveTokens("text-field",Ot,s,Ae),Jt=ar.factory(Nt);Ky(Jt)&&(this.hasRTLText=!0),(!this.hasRTLText||S()==="unavailable"||this.hasRTLText&&F.isParsed())&&(kt=fy(Jt,p,Ot))}if($){const Nt=p.getValueAndResolveTokens("icon-image",Ot,s,Ae);Ht=Nt instanceof pr?Nt:pr.fromString(Nt)}if(!kt&&!Ht)continue;const hi=this.sortFeaturesByKey?Z.evaluate(Ot,{},s):void 0;if(this.features.push({id:Be,text:kt,icon:Ht,index:Ze,sourceLayerIndex:nt,geometry:Ot.geometry,properties:Je.properties,type:Yy[Je.type],sortKey:hi}),Ht&&(Q[Ht.name]=!0),kt){const Nt=P.evaluate(Ot,{},s).join(","),Jt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Jo.vertical)>=0;for(const Qt of kt.sections)if(Qt.image)Q[Qt.image.name]=!0;else{const ai=W(kt.toString()),ui=Qt.fontStack||Nt,Wt=ne[ui]=ne[ui]||{};this.calculateGlyphDependencies(Qt.text,Wt,Jt,this.allowVerticalPlacement,ai)}}}y.get("symbol-placement")==="line"&&(this.features=function(Je){const Be={},Ze={},nt=[];let rt=0;function Ot(Nt){nt.push(Je[Nt]),rt++}function kt(Nt,Jt,Qt){const ai=Ze[Nt];return delete Ze[Nt],Ze[Jt]=ai,nt[ai].geometry[0].pop(),nt[ai].geometry[0]=nt[ai].geometry[0].concat(Qt[0]),ai}function Ht(Nt,Jt,Qt){const ai=Be[Jt];return delete Be[Jt],Be[Nt]=ai,nt[ai].geometry[0].shift(),nt[ai].geometry[0]=Qt[0].concat(nt[ai].geometry[0]),ai}function hi(Nt,Jt,Qt){const ai=Qt?Jt[0][Jt[0].length-1]:Jt[0][0];return`${Nt}:${ai.x}:${ai.y}`}for(let Nt=0;Nt<Je.length;Nt++){const Jt=Je[Nt],Qt=Jt.geometry,ai=Jt.text?Jt.text.toString():null;if(!ai){Ot(Nt);continue}const ui=hi(ai,Qt),Wt=hi(ai,Qt,!0);if(ui in Ze&&Wt in Be&&Ze[ui]!==Be[Wt]){const gi=Ht(ui,Wt,Qt),Ai=kt(ui,Wt,nt[gi].geometry);delete Be[ui],delete Ze[Wt],Ze[hi(ai,nt[Ai].geometry,!0)]=Ai,nt[gi].geometry=null}else ui in Ze?kt(ui,Wt,Qt):Wt in Be?Ht(ui,Wt,Qt):(Ot(Nt),Be[ui]=rt-1,Ze[Wt]=rt-1)}return nt.filter(Nt=>Nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Je,Be)=>Je.sortKey-Be.sortKey)}update(e,n,s,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,a),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=vg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:p}of n)this.lineVertexArray.emplaceBack(a,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,a,p,y,T,P,O,j,G,$,Z,Q){const ne=e.indexArray,Ae=e.layoutVertexArray,Fe=e.globeExtVertexArray,Je=e.segments.prepareSegment(4*n.length,Ae,ne,this.canOverlap?y.sortKey:void 0),Be=this.glyphOffsetArray.length,Ze=Je.vertexLength,nt=this.allowVerticalPlacement&&T===Jo.vertical?Math.PI/2:0,rt=y.text&&y.text.sections;for(let kt=0;kt<n.length;kt++){const{tl:Ht,tr:hi,bl:Nt,br:Jt,tex:Qt,pixelOffsetTL:ai,pixelOffsetBR:ui,minFontScaleX:Wt,minFontScaleY:gi,glyphOffset:Ai,isSDF:vi,sectionIndex:Ji}=n[kt],fi=Je.vertexLength,Ri=Ai[1];if(gf(Ae,O.x,O.y,Ht.x,Ri+Ht.y,Qt.x,Qt.y,s,vi,ai.x,ai.y,Wt,gi),gf(Ae,O.x,O.y,hi.x,Ri+hi.y,Qt.x+Qt.w,Qt.y,s,vi,ui.x,ai.y,Wt,gi),gf(Ae,O.x,O.y,Nt.x,Ri+Nt.y,Qt.x,Qt.y+Qt.h,s,vi,ai.x,ui.y,Wt,gi),gf(Ae,O.x,O.y,Jt.x,Ri+Jt.y,Qt.x+Qt.w,Qt.y+Qt.h,s,vi,ui.x,ui.y,Wt,gi),P){const{x:Qi,y:wr,z:er}=P.anchor,[Gi,en,nr]=P.up;_f(Fe,Qi,wr,er,Gi,en,nr),_f(Fe,Qi,wr,er,Gi,en,nr),_f(Fe,Qi,wr,er,Gi,en,nr),_f(Fe,Qi,wr,er,Gi,en,nr),yf(e.dynamicLayoutVertexArray,Qi,wr,er,nt)}else yf(e.dynamicLayoutVertexArray,O.x,O.y,O.z,nt);ne.emplaceBack(fi,fi+1,fi+2),ne.emplaceBack(fi+1,fi+2,fi+3),Je.vertexLength+=4,Je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ai[0]),kt!==n.length-1&&Ji===n[kt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ae.length,y,y.index,{},Z,Q,rt&&rt[Ji])}const Ot=P?P.anchor:O;e.placedSymbolArray.emplaceBack(Ot.x,Ot.y,Ot.z,O.x,O.y,Be,this.glyphOffsetArray.length-Be,Ze,j,G,O.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],T,0,!1,0,$,0)}_commitLayoutVertex(e,n,s,a,p,y,T){e.emplaceBack(n,s,a,p,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,n,s,a,p,y,T){const P=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),O=P.vertexLength,j=T.tileAnchorX,G=T.tileAnchorY;for(let Z=0;Z<4;Z++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,a,p,y,j,G,new ve(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,p,y,j,G,new ve(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,p,y,j,G,new ve(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,p,y,j,G,new ve(e.x1,e.y2)),P.vertexLength+=4;const $=s.indexArray;$.emplaceBack(O,O+1),$.emplaceBack(O+1,O+2),$.emplaceBack(O+2,O+3),$.emplaceBack(O+3,O),P.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,a,p,y){for(let T=a;T<p;T++){const P=s.get(T),O=this.getSymbolInstanceTextSize(e,y,n,T);this._addCollisionDebugVertices(P,O,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,n,s,a,p,y){for(let T=a;T<p;T++){const P=s.get(T),O=this.getSymbolInstanceIconSize(e,n,y.placedIconSymbolIndex);this._addCollisionDebugVertices(P,O,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cd(Si,Bm.members,wn),this.iconCollisionBox=new Cd(Si,Bm.members,wn);const s=Sh(this.iconSizeData,e),a=Sh(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(a,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(a,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,s,a){const p=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),y=of(this.textSizeData,e,p)/os;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,n,s){const a=this.icon.placedSymbolArray.get(s),p=of(this.iconSizeData,e,a);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,a,p,y){for(let T=a;T<p;T++){const P=s.get(T),O=this.getSymbolInstanceTextSize(e,y,n,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,P.padding)}}_updateIconDebugCollisionBoxes(e,n,s,a,p,y){for(let T=a;T<p;T++){const P=s.get(T),O=this.getSymbolInstanceIconSize(e,n,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,P.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Sh(this.iconSizeData,e),a=Sh(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(a,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(a,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,a,p,y,T,P,O){const j={};if(n<s){const{x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze,featureIndex:nt}=e.get(n);j.textBox={x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze},j.textFeatureIndex=nt}if(a<p){const{x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze,featureIndex:nt}=e.get(a);j.verticalTextBox={x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze},j.verticalTextFeatureIndex=nt}if(y<T){const{x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze,featureIndex:nt}=e.get(y);j.iconBox={x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze},j.iconFeatureIndex=nt}if(P<O){const{x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze,featureIndex:nt}=e.get(P);j.verticalIconBox={x1:G,y1:$,x2:Z,y2:Q,padding:ne,projectedAnchorX:Ae,projectedAnchorY:Fe,projectedAnchorZ:Je,tileAnchorX:Be,tileAnchorY:Ze},j.verticalIconFeatureIndex=nt}return j}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),a=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<a;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),a=[],p=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const P=this.symbolInstances.get(T);a.push(0|Math.round(n*P.tileAnchorX+s*P.tileAnchorY)),p.push(P.featureIndex)}return y.sort((T,P)=>a[T]-a[P]||p[P]-p[T]),y}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:O}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),p>=0&&p!==a&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&y!==a&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bi(oc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),oc.MAX_GLYPHS=65535,oc.addDynamicAttributes=yf;const Jy=new Ne({"symbol-placement":new ie(Ut.layout_symbol["symbol-placement"]),"symbol-spacing":new ie(Ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ie(Ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ce(Ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ie(Ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ie(Ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ie(Ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new ie(Ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ie(Ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ce(Ut.layout_symbol["icon-size"]),"icon-text-fit":new ie(Ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ie(Ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ce(Ut.layout_symbol["icon-image"]),"icon-rotate":new Ce(Ut.layout_symbol["icon-rotate"]),"icon-padding":new ie(Ut.layout_symbol["icon-padding"]),"icon-keep-upright":new ie(Ut.layout_symbol["icon-keep-upright"]),"icon-offset":new Ce(Ut.layout_symbol["icon-offset"]),"icon-anchor":new Ce(Ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ie(Ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ie(Ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ie(Ut.layout_symbol["text-rotation-alignment"]),"text-field":new Ce(Ut.layout_symbol["text-field"]),"text-font":new Ce(Ut.layout_symbol["text-font"]),"text-size":new Ce(Ut.layout_symbol["text-size"]),"text-max-width":new Ce(Ut.layout_symbol["text-max-width"]),"text-line-height":new Ce(Ut.layout_symbol["text-line-height"]),"text-letter-spacing":new Ce(Ut.layout_symbol["text-letter-spacing"]),"text-justify":new Ce(Ut.layout_symbol["text-justify"]),"text-radial-offset":new Ce(Ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ie(Ut.layout_symbol["text-variable-anchor"]),"text-anchor":new Ce(Ut.layout_symbol["text-anchor"]),"text-max-angle":new ie(Ut.layout_symbol["text-max-angle"]),"text-writing-mode":new ie(Ut.layout_symbol["text-writing-mode"]),"text-rotate":new Ce(Ut.layout_symbol["text-rotate"]),"text-padding":new ie(Ut.layout_symbol["text-padding"]),"text-keep-upright":new ie(Ut.layout_symbol["text-keep-upright"]),"text-transform":new Ce(Ut.layout_symbol["text-transform"]),"text-offset":new Ce(Ut.layout_symbol["text-offset"]),"text-allow-overlap":new ie(Ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ie(Ut.layout_symbol["text-ignore-placement"]),"text-optional":new ie(Ut.layout_symbol["text-optional"])});var Ad={paint:new Ne({"icon-opacity":new Ce(Ut.paint_symbol["icon-opacity"]),"icon-color":new Ce(Ut.paint_symbol["icon-color"]),"icon-halo-color":new Ce(Ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ce(Ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ce(Ut.paint_symbol["icon-halo-blur"]),"icon-translate":new ie(Ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new ie(Ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ce(Ut.paint_symbol["text-opacity"]),"text-color":new Ce(Ut.paint_symbol["text-color"],{runtimeType:tn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ce(Ut.paint_symbol["text-halo-color"]),"text-halo-width":new Ce(Ut.paint_symbol["text-halo-width"]),"text-halo-blur":new Ce(Ut.paint_symbol["text-halo-blur"]),"text-translate":new ie(Ut.paint_symbol["text-translate"]),"text-translate-anchor":new ie(Ut.paint_symbol["text-translate-anchor"])}),layout:Jy};class xg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ks,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bi(xg,"FormatSectionOverride",{omit:["defaultValue"]});class vf extends Na{constructor(e){super(e,Ad)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const p of s)a.indexOf(p)<0&&a.push(p);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,a){const p=this.layout.get(e).evaluate(n,{},s,a),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Wo(y.value)||!p?p:function(T,P){return P.replace(/{([^{}]+)}/g,(O,j)=>j in T?String(T[j]):"")}(n.properties,p)}createBucket(e){return new oc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ad.paint.overridableProperties){if(!vf.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new xg(n),a=new Bl(s,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Nl("source",a):new ll("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Pe(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&vf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),a=Ad.paint.properties[n];let p=!1;const y=T=>{for(const P of T)if(a.overrides&&a.overrides.hasOverride(P))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof ar)y(s.value.value.sections);else if(s.value.kind==="source"){const T=O=>{p||(O instanceof zr&&ir(O.value)===Oo?y(O.value.sections):O instanceof Xn?y(O.sections):O.eachChild(T))},P=s.value;P._styleExpression&&T(P._styleExpression.expression)}return p}getProgramConfiguration(e){return new ca(this,e)}}var Qy={paint:new Ne({"background-color":new ie(Ut.paint_background["background-color"]),"background-pattern":new ie(Ut.paint_background["background-pattern"]),"background-opacity":new ie(Ut.paint_background["background-opacity"])})},e1={paint:new Ne({"raster-opacity":new ie(Ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new ie(Ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ie(Ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ie(Ut.paint_raster["raster-brightness-max"]),"raster-saturation":new ie(Ut.paint_raster["raster-saturation"]),"raster-contrast":new ie(Ut.paint_raster["raster-contrast"]),"raster-resampling":new ie(Ut.paint_raster["raster-resampling"]),"raster-fade-duration":new ie(Ut.paint_raster["raster-fade-duration"])})};class t1 extends Na{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var i1={paint:new Ne({"sky-type":new ie(Ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new ie(Ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ie(Ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ie(Ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ie(Ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new Re(Ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ie(Ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ie(Ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ie(Ut.paint_sky["sky-opacity"])})};function Ed(i,e,n){const s=[0,0,1],a=Np([]);return Up(a,a,n?-pe(i)+Math.PI:pe(i)),jp(a,a,-pe(e)),Fp(s,s,a),Bs(s,s)}const r1={circle:class extends Na{constructor(i){super(i,p0)}createBucket(i){return new Qf(i)}queryRadius(i){const e=i;return vh("circle-radius",this,e)+vh("circle-stroke-width",this,e)+$u(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,s,a,p,y,T){const P=cm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return hm(i,s,p,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,O)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ca(this,i)}},heatmap:class extends Na{createBucket(i){return new fm(i)}constructor(i){super(i,y0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return vh("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,s,a,p,y,T){const P=this.paint.get("heatmap-radius").evaluate(e,n);return hm(i,s,p,y,T,!0,!0,new ve(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ca(this,i)}},hillshade:class extends Na{constructor(i){super(i,v0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Na{constructor(i){super(i,F0)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new ca(this,i)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Qu(i)}queryRadius(){return $u(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,s,a,p){return!i.queryGeometry.isAboveHorizon&&nm(lm(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Na{constructor(i){super(i,K0)}createBucket(i){return new fu(i)}queryRadius(){return $u(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ca(this,i)}queryIntersectsFeature(i,e,n,s,a,p,y,T,P){const O=cm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(e,n),G=this.paint.get("fill-extrusion-base").evaluate(e,n),$=[0,0],Z=T&&p.elevation,Q=p.elevation?p.elevation.exaggeration():1,ne=i.tile.getBucket(this);if(Z&&ne instanceof fu){const Ze=ne.centroidVertexArray,nt=P+1;nt<Ze.length&&($[0]=Ze.geta_centroid_pos0(nt),$[1]=Ze.geta_centroid_pos1(nt))}if($[0]===0&&$[1]===1)return!1;p.projection.name==="globe"&&(s=Lm([s],[new ve(0,0),new ve(Bi,Bi)],i.tileID.canonical).map(Ze=>Ze.polygon).flat());const Ae=Z?T:null,[Fe,Je]=function(Ze,nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai){return Ze.projection.name==="globe"?function(ui,Wt,gi,Ai,vi,Ji,fi,Ri,Qi,wr,er){const Gi=[],en=[],nr=ui.projection.upVectorScale(er,ui.center.lat,ui.worldSize).metersToTile,sr=[0,0,0,1],jr=[0,0,0,1],Zr=(Ur,cn,_n,Pn)=>{Ur[0]=cn,Ur[1]=_n,Ur[2]=Pn,Ur[3]=1},Kr=Mm();gi>0&&(gi+=Kr),Ai+=Kr;for(const Ur of Wt){const cn=[],_n=[];for(const Pn of Ur){const Vr=Pn.x+vi.x,zn=Pn.y+vi.y,Mn=ui.projection.projectTilePoint(Vr,zn,er),pn=ui.projection.upVector(er,Pn.x,Pn.y);let Cr=gi,Ln=Ai;if(fi){const Jr=Om(Vr,zn,gi,Ai,fi,Ri,Qi,wr);Cr+=Jr.base,Ln+=Jr.top}gi!==0?Zr(sr,Mn.x+pn[0]*nr*Cr,Mn.y+pn[1]*nr*Cr,Mn.z+pn[2]*nr*Cr):Zr(sr,Mn.x,Mn.y,Mn.z),Zr(jr,Mn.x+pn[0]*nr*Ln,Mn.y+pn[1]*nr*Ln,Mn.z+pn[2]*nr*Ln),Sn(sr,sr,Ji),Sn(jr,jr,Ji),cn.push(new wh(sr[0],sr[1],sr[2])),_n.push(new wh(jr[0],jr[1],jr[2]))}Gi.push(cn),en.push(_n)}return[Gi,en]}(Ze,nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt,ai):hi?function(ui,Wt,gi,Ai,vi,Ji,fi,Ri,Qi){const wr=[],er=[],Gi=[0,0,0,1];for(const en of ui){const nr=[],sr=[];for(const jr of en){const Zr=jr.x+Ai.x,Kr=jr.y+Ai.y,Ur=Om(Zr,Kr,Wt,gi,Ji,fi,Ri,Qi);Gi[0]=Zr,Gi[1]=Kr,Gi[2]=Ur.base,Gi[3]=1,jc(Gi,Gi,vi),Gi[3]=Math.max(Gi[3],1e-5);const cn=new wh(Gi[0]/Gi[3],Gi[1]/Gi[3],Gi[2]/Gi[3]);Gi[0]=Zr,Gi[1]=Kr,Gi[2]=Ur.top,Gi[3]=1,jc(Gi,Gi,vi),Gi[3]=Math.max(Gi[3],1e-5);const _n=new wh(Gi[0]/Gi[3],Gi[1]/Gi[3],Gi[2]/Gi[3]);nr.push(cn),sr.push(_n)}wr.push(nr),er.push(sr)}return[wr,er]}(nt,rt,Ot,kt,Ht,hi,Nt,Jt,Qt):function(ui,Wt,gi,Ai,vi){const Ji=[],fi=[],Ri=vi[8]*Wt,Qi=vi[9]*Wt,wr=vi[10]*Wt,er=vi[11]*Wt,Gi=vi[8]*gi,en=vi[9]*gi,nr=vi[10]*gi,sr=vi[11]*gi;for(const jr of ui){const Zr=[],Kr=[];for(const Ur of jr){const cn=Ur.x+Ai.x,_n=Ur.y+Ai.y,Pn=vi[0]*cn+vi[4]*_n+vi[12],Vr=vi[1]*cn+vi[5]*_n+vi[13],zn=vi[2]*cn+vi[6]*_n+vi[14],Mn=vi[3]*cn+vi[7]*_n+vi[15],pn=Pn+Ri,Cr=Vr+Qi,Ln=zn+wr,Jr=Math.max(Mn+er,1e-5),Us=Pn+Gi,In=Vr+en,as=zn+nr,Zn=Math.max(Mn+sr,1e-5);Zr.push(new wh(pn/Jr,Cr/Jr,Ln/Jr)),Kr.push(new wh(Us/Zn,In/Zn,as/Zn))}Ji.push(Zr),fi.push(Kr)}return[Ji,fi]}(nt,rt,Ot,kt,Ht)}(p,s,G,j,O,y,Ae,$,Q,p.center.lat,i.tileID.canonical),Be=i.queryGeometry;return function(Ze,nt,rt){let Ot=1/0;nm(rt,nt)&&(Ot=Dm(rt,nt[0]));for(let kt=0;kt<nt.length;kt++){const Ht=nt[kt],hi=Ze[kt];for(let Nt=0;Nt<Ht.length-1;Nt++){const Jt=Ht[Nt],Qt=[Jt,Ht[Nt+1],hi[Nt+1],hi[Nt],Jt];rm(rt,Qt)&&(Ot=Math.min(Ot,Dm(rt,Qt)))}}return Ot!==1/0&&Ot}(Fe,Je,Be.isPointQuery()?Be.screenBounds:Be.screenGeometry)}},line:class extends Na{constructor(i){super(i,Fm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof lr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=zm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new sf(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ca(this,i)}queryRadius(i){const e=i,n=Rm(vh("line-width",this,e),vh("line-gap-width",this,e)),s=vh("line-offset",this,e);return n/2+Math.abs(s)+$u(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,s,a,p){if(i.queryGeometry.isAboveHorizon)return!1;const y=lm(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),T=i.pixelToTileUnitsFactor/2*Rm(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),P=this.paint.get("line-offset").evaluate(e,n);return P&&(s=function(O,j){const G=[],$=new ve(0,0);for(let Z=0;Z<O.length;Z++){const Q=O[Z],ne=[];for(let Ae=0;Ae<Q.length;Ae++){const Fe=Q[Ae],Je=Q[Ae+1],Be=Ae===0?$:Fe.sub(Q[Ae-1])._unit()._perp(),Ze=Ae===Q.length-1?$:Je.sub(Fe)._unit()._perp(),nt=Be._add(Ze)._unit();nt._mult(1/(nt.x*Ze.x+nt.y*Ze.y)),ne.push(nt._mult(j)._add(Fe))}G.push(ne)}return G}(s,P*i.pixelToTileUnitsFactor)),function(O,j,G){for(let $=0;$<j.length;$++){const Z=j[$];if(O.length>=3){for(let Q=0;Q<Z.length;Q++)if(Gc(O,Z[Q]))return!0}if(h0(O,Z,G))return!0}return!1}(y,s,T)}isTileClipped(){return!0}},symbol:vf,background:class extends Na{constructor(i){super(i,Qy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Na{constructor(i){super(i,e1)}getProgramIds(){return["raster"]}},sky:class extends Na{constructor(i){super(i,i1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),a=!s,p=i.style.light,y=p.properties.get("position");return a&&p.properties.get("anchor")==="viewport"&&Xe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Ed(y.azimuthal,90-y.polar,e):Ed(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Ed(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class Su{constructor(e,n,s,a){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,a)}update(e,n,s){const{width:a,height:p}=e,{context:y}=this,{gl:T}=y,{HTMLImageElement:P,HTMLCanvasElement:O,HTMLVideoElement:j,ImageData:G,ImageBitmap:$}=l;if(T.bindTexture(T.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),s||this.size&&this.size[0]===a&&this.size[1]===p){const{x:Z,y:Q}=s||{x:0,y:0};e instanceof P||e instanceof O||e instanceof j||e instanceof G||$&&e instanceof $?T.texSubImage2D(T.TEXTURE_2D,0,Z,Q,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,Z,Q,a,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}else this.size=[a,p],e instanceof P||e instanceof O||e instanceof j||e instanceof G||$&&e instanceof $?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,a,p,0,this.format,T.UNSIGNED_BYTE,e.data);this.useMipmap=!!(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class n1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class s1{constructor(){this.tasks={},this.taskQueue=[],qe(["process"],this),this.invoker=new n1(this.process),this.nextId=0}add(e,n){const s=this.nextId++,a=function({type:p,isSymbolTile:y,zoom:T}){return T=T||0,p==="message"?0:p!=="maybePrepare"||y?p!=="parseTile"||y?p==="parseTile"&&y?300-T:p==="maybePrepare"&&y?400-T:500:200-T:100-T}(n);if(a===0){Et();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Et();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const p=this.tasks[this.taskQueue[a]];p.priority<n&&(n=p.priority,e=a)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class bg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const o1=["tile","layer","source","sourceLayer","state"];class wg{constructor(e,n,s,a,p){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=a,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of o1)this[n]!==void 0&&(e[n]=this[n]);return e}}const da=32,wl=33,ac=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,s=0,a=0,p=0,y=0,T=0;for(1&e?a=p=y=da:n=s=T=da;(e>>=1)>1;){const O=n+a>>1,j=s+p>>1;1&e?(a=n,p=s,n=y,s=T):(n=a,s=p,a=y,p=T),y=O,T=j}const P=4*i;ac[P+0]=n,ac[P+1]=s,ac[P+2]=a,ac[P+3]=p}const Sl=new Uint16Array(2178),lc=new Uint8Array(1089),xf=new Uint16Array(1089);function Sg(i){return i===0?-.03125:i===32?.03125:0}var Tg=ut([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Cg={type:2,extent:Bi,loadGeometry:()=>[[new ve(0,0),new ve(Bi+1,0),new ve(Bi+1,Bi+1),new ve(0,Bi+1),new ve(0,0)]]};class Pd{constructor(e,n,s,a,p){this.tileID=e,this.uid=te(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Gn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Xc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,p){const y={};if(!p)return y;for(const T of a){const P=T.layerIds.map(O=>p.getLayer(O)).filter(Boolean);if(P.length!==0){T.layers=P,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(O=>P.filter(j=>j.id===O)[0]));for(const O of P)y[O.id]=T}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const p=this.buckets[a];if(p instanceof oc){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const p=this.buckets[a];if(p instanceof oc&&p.hasRTLText){this.hasRTLText=!0,F.isLoading()||F.isLoaded()||S()!=="deferred"||I();break}}this.queryPadding=0;for(const a in this.buckets){const p=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(a).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Dr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const a=this.buckets[s];a.uploadPending()&&a.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Su(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Su(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Su(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,a,p,y,T,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:T,transform:y,params:p,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const a=s.loadVTLayers(),p=n?n.sourceLayer:"",y=a._geojsonTileLayer||a[p];if(!y)return;const T=ul(n&&n.filter),{z:P,x:O,y:j}=this.tileID.canonical,G={z:P,x:O,y:j};for(let $=0;$<y.length;$++){const Z=y.feature($);if(T.needGeometry){const Ae=qc(Z,!0);if(!T.filter(new N(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!T.filter(new N(this.tileID.overscaledZ),Z))continue;const Q=s.getId(Z,p),ne=new wg(Z,P,O,j,Q);ne.tile=G,e.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=wt(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let a=!1;if(this.expirationTime>s)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const p=this.expirationTime-n;p?this.expirationTime=s+Math.max(p,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages();for(const p in this.buckets){if(!n.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",P=s[T],O=e[T];if(!P||!O||Object.keys(O).length===0)continue;if(y.update(O,P,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof sf||y instanceof Qu){const G=n.style._getSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&G&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(G.id,this.tileID)}const j=n&&n.style&&n.style.getLayer(p);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Gn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Gn.now()+e}setTexture(e,n){const s=n.context,a=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Su(s,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(e,n){const s={};for(const a of n)s[a]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const a=this.dependencies[s];if(a){for(const p of n)if(a[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const s=$l(Cg,this.tileID.canonical,this.tileTransform)[0],a=new ei,p=new ns;for(let y=0;y<s.length;y++){const{x:T,y:P}=s[y];a.emplaceBack(T,P),p.emplaceBack(y)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(a,tu.members),this._tileDebugSegments=An.simpleSegment(0,0,a.length,p.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const s=$l(Cg,this.tileID.canonical,this.tileTransform)[0];let a,p;if(this.isRaster){const y=function(T,P){const O=Xc(T,P),j=Math.pow(2,T.z);for(let Ae=0;Ae<wl;Ae++)for(let Fe=0;Fe<wl;Fe++){const Je=Ko((T.x+(Fe+Sg(Fe))/da)/j),Be=vs((T.y+(Ae+Sg(Ae))/da)/j),Ze=P.project(Je,Be),nt=Ae*wl+Fe;Sl[2*nt+0]=Math.round((Ze.x*O.scale-O.x)*Bi),Sl[2*nt+1]=Math.round((Ze.y*O.scale-O.y)*Bi)}lc.fill(0),xf.fill(0);for(let Ae=2045;Ae>=0;Ae--){const Fe=4*Ae,Je=ac[Fe+0],Be=ac[Fe+1],Ze=ac[Fe+2],nt=ac[Fe+3],rt=Je+Ze>>1,Ot=Be+nt>>1,kt=rt+Ot-Be,Ht=Ot+Je-rt,hi=Be*wl+Je,Nt=nt*wl+Ze,Jt=Ot*wl+rt,Qt=Math.hypot((Sl[2*hi+0]+Sl[2*Nt+0])/2-Sl[2*Jt+0],(Sl[2*hi+1]+Sl[2*Nt+1])/2-Sl[2*Jt+1])>=16;lc[Jt]=lc[Jt]||(Qt?1:0),Ae<1022&&(lc[Jt]=lc[Jt]||lc[(Be+Ht>>1)*wl+(Je+kt>>1)]||lc[(nt+Ht>>1)*wl+(Ze+kt>>1)])}const G=new Gt,$=new Pi;let Z=0;function Q(Ae,Fe){const Je=Fe*wl+Ae;return xf[Je]===0&&(G.emplaceBack(Sl[2*Je+0],Sl[2*Je+1],Ae*Bi/da,Fe*Bi/da),xf[Je]=++Z),xf[Je]-1}function ne(Ae,Fe,Je,Be,Ze,nt){const rt=Ae+Je>>1,Ot=Fe+Be>>1;if(Math.abs(Ae-Ze)+Math.abs(Fe-nt)>1&&lc[Ot*wl+rt])ne(Ze,nt,Ae,Fe,rt,Ot),ne(Je,Be,Ze,nt,rt,Ot);else{const kt=Q(Ae,Fe),Ht=Q(Je,Be),hi=Q(Ze,nt);$.emplaceBack(kt,Ht,hi)}}return ne(0,0,da,da,da,0),ne(da,da,0,0,0,da),{vertices:G,indices:$}}(this.tileID.canonical,n);a=y.vertices,p=y.indices}else{a=new Gt,p=new Pi;for(const{x:T,y:P}of s)a.emplaceBack(T,P,0,0);const y=ld(a.int16,void 0,4);for(let T=0;T<y.length;T+=3)p.emplaceBack(y[T],y[T+1],y[T+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,Tg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=An.simpleSegment(0,0,a.length,p.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||s.name!=="globe"||n.freezeTileCoverage)return;const a=this.tileID.canonical,p=nu(Xp(a,n)),y=_h(n.zoom);let T;y>0&&(T=zf(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,n,p,T,y),this._makeGlobeTileDebugTextBuffer(e,a,n,p,T,y)}_globePoint(e,n,s,a,p,y,T){let P=ru(e,n,s);if(y){const O=1<<s.z,j=xl(a.center.lng),G=bl(a.center.lat),$=(s.x+.5)/O-j;let Z=0;$>.5?Z=-1:$<-.5&&(Z=1);let Q=(e/Bi+s.x)/O+Z,ne=(n/Bi+s.y)/O;Q=(Q-j)*a._pixelsPerMercatorPixel+j,ne=(ne-G)*a._pixelsPerMercatorPixel+G;const Ae=[Q*a.worldSize,ne*a.worldSize,0];Sn(Ae,Ae,y),P=Vc(P,Ae,T)}return Sn(P,P,p)}_makeGlobeTileDebugBorderBuffer(e,n,s,a,p,y){const T=new ei,P=new ns,O=new Tt,j=($,Z,Q,ne,Ae)=>{const Fe=(Q-$)/(Ae-1),Je=(ne-Z)/(Ae-1),Be=T.length;for(let Ze=0;Ze<Ae;Ze++){const nt=$+Ze*Fe,rt=Z+Ze*Je;T.emplaceBack(nt,rt);const Ot=this._globePoint(nt,rt,n,s,a,p,y);O.emplaceBack(Ot[0],Ot[1],Ot[2]),P.emplaceBack(Be+Ze)}},G=Bi;j(0,0,G,0,16),j(G,0,G,G,16),j(G,G,0,G,16),j(0,G,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(P),this._tileDebugBuffer=e.createVertexBuffer(T,tu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(O,qp.members),this._tileDebugSegments=An.simpleSegment(0,0,T.length,P.length)}_makeGlobeTileDebugTextBuffer(e,n,s,a,p,y){const T=Bi/4,P=new ei,O=new Pi,j=new Tt,G=25;O.reserve(32),P.reserve(G),j.reserve(G);const $=(Z,Q)=>G*Z+Q;for(let Z=0;Z<G;Z++){const Q=Z*T;for(let ne=0;ne<G;ne++){const Ae=ne*T;P.emplaceBack(Ae,Q);const Fe=this._globePoint(Ae,Q,n,s,a,p,y);j.emplaceBack(Fe[0],Fe[1],Fe[2])}}for(let Z=0;Z<4;Z++)for(let Q=0;Q<4;Q++){const ne=$(Z,Q),Ae=$(Z,Q+1),Fe=$(Z+1,Q),Je=$(Z+1,Q+1);O.emplaceBack(ne,Ae,Fe),O.emplaceBack(Fe,Ae,Je)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(O),this._tileDebugTextBuffer=e.createVertexBuffer(P,tu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(j,qp.members),this._tileDebugTextSegments=An.simpleSegment(0,0,G,32)}}class a1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const a=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},ce(this.stateChanges[e][a],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==a&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const p in this.state[e][a])s[p]||(this.deletedStates[e][a][p]=null)}else for(const p in s)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][p]===null&&delete this.deletedStates[e][a][p]}removeFeatureState(e,n,s){if(this.deletedStates[e]===null)return;const a=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&n!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][s]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(s in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][s]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),a=ce({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][n];if(p===null)return{};for(const y in p)delete a[y]}return a}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const p={};for(const y in this.stateChanges[a])this.state[a][y]||(this.state[a][y]={}),ce(this.state[a][y],this.stateChanges[a][y]),p[y]=this.state[a][y];s[a]=p}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const p={};if(this.deletedStates[a]===null)for(const y in this.state[a])p[y]={},this.state[a][y]={};else for(const y in this.deletedStates[a]){if(this.deletedStates[a][y]===null)this.state[a][y]={};else if(this.state[a][y])for(const T of Object.keys(this.deletedStates[a][y]))delete this.state[a][y][T];p[y]=this.state[a][y]}s[a]=s[a]||{},ce(s[a],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const a in e)e[a].setFeatureState(s,n)}}class Ag{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Eg(i,e,n,s){let a=0,p=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(s[y])<1e-15){if(n[y]<i[y]||n[y]>e[y])return null}else{const T=1/s[y];let P=(i[y]-n[y])*T,O=(e[y]-n[y])*T;if(P>O){const j=P;P=O,O=j}if(P>a&&(a=P),O<p&&(p=O),a>p)return null}return a}function Pg(i,e,n,s,a,p,y,T,P,O,j){const G=s-i,$=a-e,Z=p-n,Q=y-i,ne=T-e,Ae=P-n,Fe=j[1]*Ae-j[2]*ne,Je=j[2]*Q-j[0]*Ae,Be=j[0]*ne-j[1]*Q,Ze=G*Fe+$*Je+Z*Be;if(Math.abs(Ze)<1e-15)return null;const nt=1/Ze,rt=O[0]-i,Ot=O[1]-e,kt=O[2]-n,Ht=(rt*Fe+Ot*Je+kt*Be)*nt;if(Ht<0||Ht>1)return null;const hi=Ot*Z-kt*$,Nt=kt*G-rt*Z,Jt=rt*$-Ot*G,Qt=(j[0]*hi+j[1]*Nt+j[2]*Jt)*nt;return Qt<0||Ht+Qt>1?null:(Q*hi+ne*Nt+Ae*Jt)*nt}function Mg(i,e,n){return(i-e)/(n-e)}function Lg(i,e,n,s,a,p,y,T,P){const O=1<<n,j=p-s,G=y-a,$=(i+1)/O*j+s,Z=(e+0)/O*G+a,Q=(e+1)/O*G+a;T[0]=(i+0)/O*j+s,T[1]=Z,P[0]=$,P[1]=Q}class Ig{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(p){const y=Math.ceil(Math.log2(p.dim/8)),T=[];let P=Math.ceil(Math.pow(2,y));const O=1/P,j=(Z,Q,ne,Ae,Fe)=>{const Je=Ae?1:0,Be=(Z+1)*ne-Je,Ze=Q*ne,nt=(Q+1)*ne-Je;Fe[0]=Z*ne,Fe[1]=Ze,Fe[2]=Be,Fe[3]=nt};let G=new Ag(P);const $=[];for(let Z=0;Z<P*P;Z++){j(Z%P,Math.floor(Z/P),O,!1,$);const Q=cc($[0],$[1],p),ne=cc($[2],$[1],p),Ae=cc($[2],$[3],p),Fe=cc($[0],$[3],p);G.minimums.push(Math.min(Q,ne,Ae,Fe)),G.maximums.push(Math.max(Q,ne,Ae,Fe)),G.leaves.push(1)}for(T.push(G),P/=2;P>=1;P/=2){const Z=T[T.length-1];G=new Ag(P);for(let Q=0;Q<P*P;Q++){j(Q%P,Math.floor(Q/P),2,!0,$);const ne=Z.getElevation($[0],$[1]),Ae=Z.getElevation($[2],$[1]),Fe=Z.getElevation($[2],$[3]),Je=Z.getElevation($[0],$[3]),Be=Z.isLeaf($[0],$[1]),Ze=Z.isLeaf($[2],$[1]),nt=Z.isLeaf($[2],$[3]),rt=Z.isLeaf($[0],$[3]),Ot=Math.min(ne.min,Ae.min,Fe.min,Je.min),kt=Math.max(ne.max,Ae.max,Fe.max,Je.max),Ht=Be&&Ze&&nt&&rt;G.maximums.push(kt),G.minimums.push(Ot),G.leaves.push(kt-Ot<=5&&Ht?1:0)}T.push(G)}return T}(this.dem),s=n.length-1,a=n[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,a,p,y,T=1){return Eg([e,n,-100],[s,a,this.maximums[0]*T],p,y)}raycast(e,n,s,a,p,y,T=1){if(!this.nodeCount)return null;const P=this.raycastRoot(e,n,s,a,p,y,T);if(P==null)return null;const O=[],j=[],G=[],$=[],Z=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;Z.length>0;){const{idx:Q,t:ne,nodex:Ae,nodey:Fe,depth:Je}=Z.pop();if(this.leaves[Q]){Lg(Ae,Fe,Je,e,n,s,a,G,$);const Ze=1<<Je,nt=(Ae+0)/Ze,rt=(Ae+1)/Ze,Ot=(Fe+0)/Ze,kt=(Fe+1)/Ze,Ht=cc(nt,Ot,this.dem)*T,hi=cc(rt,Ot,this.dem)*T,Nt=cc(rt,kt,this.dem)*T,Jt=cc(nt,kt,this.dem)*T,Qt=Pg(G[0],G[1],Ht,$[0],G[1],hi,$[0],$[1],Nt,p,y),ai=Pg($[0],$[1],Nt,G[0],$[1],Jt,G[0],G[1],Ht,p,y),ui=Math.min(Qt!==null?Qt:Number.MAX_VALUE,ai!==null?ai:Number.MAX_VALUE);if(ui!==Number.MAX_VALUE)return ui;{const Wt=Qh([],p,y,ne);if(kg(Ht,hi,Jt,Nt,Mg(Wt[0],G[0],$[0]),Mg(Wt[1],G[1],$[1]))>=Wt[2])return ne}continue}let Be=0;for(let Ze=0;Ze<this._siblingOffset.length;Ze++){Lg((Ae<<1)+this._siblingOffset[Ze][0],(Fe<<1)+this._siblingOffset[Ze][1],Je+1,e,n,s,a,G,$),G[2]=-100,$[2]=this.maximums[this.childOffsets[Q]+Ze]*T;const nt=Eg(G,$,p,y);if(nt!=null){const rt=nt;O[Ze]=rt;let Ot=!1;for(let kt=0;kt<Be&&!Ot;kt++)rt>=O[j[kt]]&&(j.splice(kt,0,Ze),Ot=!0);Ot||(j[Be]=Ze),Be++}}for(let Ze=0;Ze<Be;Ze++){const nt=j[Ze];Z.push({idx:this.childOffsets[Q]+nt,t:O[nt],nodex:(Ae<<1)+this._siblingOffset[nt][0],nodey:(Fe<<1)+this._siblingOffset[nt][1],depth:Je+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,a,p){if(e[a].isLeaf(n,s)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const y=a-1,T=e[y];let P=0,O=0;for(let j=0;j<this._siblingOffset.length;j++){const G=2*n+this._siblingOffset[j][0],$=2*s+this._siblingOffset[j][1],Z=T.getElevation(G,$),Q=T.isLeaf(G,$),ne=this._addNode(Z.min,Z.max,Q);Q&&(P|=1<<j),O||(O=ne)}for(let j=0;j<this._siblingOffset.length;j++)P&1<<j||this._construct(e,2*n+this._siblingOffset[j][0],2*s+this._siblingOffset[j][1],y,O+j)}}function kg(i,e,n,s,a,p){return Ci(Ci(i,n,p),Ci(e,s,p),a)}function cc(i,e,n){const s=n.dim,a=He(i*s-.5,0,s-1),p=He(e*s-.5,0,s-1),y=Math.floor(a),T=Math.floor(p),P=Math.min(y+1,s-1),O=Math.min(T+1,s-1);return kg(n.get(y,T),n.get(P,T),n.get(y,O),n.get(P,O),a-y,p-T)}const Dg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function l1(i,e,n){return(256*i*256+256*e+n)/10-1e4}function c1(i,e,n){return 256*i+e+n/256-32768}class bf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,a=!1,p=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Xe(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,T=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=a,!a){for(let P=0;P<y;P++)T[this._idx(-1,P)]=T[this._idx(0,P)],T[this._idx(y,P)]=T[this._idx(y-1,P)],T[this._idx(P,-1)]=T[this._idx(P,0)],T[this._idx(P,y)]=T[this._idx(P,y-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(y,-1)]=T[this._idx(y-1,0)],T[this._idx(-1,y)]=T[this._idx(0,y-1)],T[this._idx(y,y)]=T[this._idx(y-1,y-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ig(this)}get(e,n,s=!1){s&&(e=He(e,-1,this.dim),n=He(n,-1,this.dim));const a=4*this._idx(e,n);return(this.encoding==="terrarium"?c1:l1)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return Dg[e]}get unpackVector(){return Dg[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const s=[0,0,0,0],a=bf.getUnpackVector(n);let p=Math.floor((e+a[3])/a[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new Ao({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,p=n*this.dim+this.dim,y=s*this.dim,T=s*this.dim+this.dim;switch(n){case-1:a=p-1;break;case 1:p=a+1}switch(s){case-1:y=T-1;break;case 1:T=y+1}const P=-n*this.dim,O=-s*this.dim;for(let j=y;j<T;j++)for(let G=a;G<p;G++){const $=4*this._idx(G,j),Z=4*this._idx(G+P,j+O);this.pixels[$+0]=e.pixels[Z+0],this.pixels[$+1]=e.pixels[Z+1],this.pixels[$+2]=e.pixels[Z+2],this.pixels[$+3]=e.pixels[Z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bi(bf,"DEMData"),bi(Ig,"DemMinMaxQuadTree",{omit:["dem"]});class h1{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const p={value:n,timeout:void 0};if(s!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[a].push(p),this.order.push(a),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,a=n===void 0?0:this.data[s].indexOf(n),p=this.data[s][a];return this.data[s].splice(a,1),p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const a of this.data[s])e(a.value)||n.push(a);for(const s of n)this.remove(s.value.tileID,s)}}class kh{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}kh.ReadOnly=!1,kh.ReadWrite=!0,kh.disabled=new kh(519,kh.ReadOnly,[0,1]);const Md=7680;class Ld{constructor(e,n,s,a,p,y){this.test=e,this.ref=n,this.mask=s,this.fail=a,this.depthFail=p,this.pass=y}}Ld.disabled=new Ld({func:519,mask:0},0,0,Md,Md,Md);class Tl{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}Tl.Replace=[1,0],Tl.disabled=new Tl(Tl.Replace,Mi.transparent,[!1,!1,!1,!1]),Tl.unblended=new Tl(Tl.Replace,Mi.transparent,[!0,!0,!0,!0]),Tl.alphaBlended=new Tl([1,771],Mi.transparent,[!0,!0,!0,!0]);const Id=1029,kd=2305;class Wa{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Wa.disabled=new Wa(!1,Id,kd),Wa.backCCW=new Wa(!0,Id,kd),Wa.backCW=new Wa(!0,Id,2304),Wa.frontCW=new Wa(!0,1028,2304),Wa.frontCCW=new Wa(!0,1028,kd);class Hc extends fo{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new h1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new a1,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Y(this._tiles).map(e=>e.tileID).sort(Og).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,a)=>{const p=s.tileID,y=a.tileID,T=new ve(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),P=new ve(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-y.overscaledZ||P.y-T.y||P.x-T.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(Og).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new bs(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Gn.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Qn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const p=n[a];if(e.neighboringTiles&&e.neighboringTiles[p]){const y=this.getTileByID(p);s(e,y),s(y,e)}}function s(a,p){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let y=p.tileID.canonical.x-a.tileID.canonical.x;const T=p.tileID.canonical.y-a.tileID.canonical.y,P=Math.pow(2,a.tileID.canonical.z),O=p.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+P)===1?y+=P:Math.abs(y-P)===1&&(y-=P)),p.dem&&a.dem&&(a.dem.backfillBorder(p.dem,y,T),a.neighboringTiles&&a.neighboringTiles[O]&&(a.neighboringTiles[O].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,a){for(const p in this._tiles){let y=this._tiles[p];if(a[p]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>s)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const O=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[O.key],y&&y.hasData()&&(T=O)}let P=T;for(;P.overscaledZ>n;)if(P=P.scaledTo(P.overscaledZ-1),e[P.key]){a[T.key]=T;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const a=e.scaledTo(s),p=this._getLoadedTile(a);if(p)return p}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,a=Math.ceil(e.height/n)+1,p=Math.floor(s*a*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(T)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const a in this._tiles){const p=this._tiles[a];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),s[p.tileID.key]=p}this._tiles=s;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let a;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new js(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(a=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(T=>this._source.hasTile(T)))):a=[];const p=this._updateRetainedTiles(a);if(Fg(this._source.type)&&a.length!==0){const T={},P={},O=Object.keys(p);for(const G of O){const $=p[G],Z=this._tiles[G];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=Gn.now())continue;const Q=this.findLoadedParent($,Math.max($.overscaledZ-Hc.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),T[Q.tileID.key]=Q.tileID),P[G]=$}const j=a[a.length-1].overscaledZ;for(const G in this._tiles){const $=this._tiles[G];if(p[G]||!$.hasData())continue;let Z=$.tileID;for(;Z.overscaledZ>j;){Z=Z.scaledTo(Z.overscaledZ-1);const Q=this._tiles[Z.key];if(Q&&Q.hasData()&&P[Z.key]){p[G]=$.tileID;break}}}for(const G in T)p[G]||(this._coveredTiles[G]=!0,p[G]=T[G])}for(const T in p)this._tiles[T].clearFadeHold();const y=function(T,P){const O=[];for(const j in T)j in P||O.push(j);return O}(this._tiles,p);for(const T of y){const P=this._tiles[T];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const s={},a=e.reduce((O,j)=>Math.min(O,j.overscaledZ),1/0),p=e[0].overscaledZ,y=Math.max(p-Hc.maxOverzooming,this._source.minzoom),T=Math.max(p+Hc.maxUnderzooming,this._source.minzoom),P={};for(const O of e){const j=this._addTile(O);n[O.key]=O,j.hasData()||a<this._source.maxzoom&&(P[O.key]=O)}this._retainLoadedChildren(P,a,T,n);for(const O of e){let j=this._tiles[O.key];if(j.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const $=O.children(this._source.maxzoom)[0],Z=this.getTile($);if(Z&&Z.hasData()){n[$.key]=$;continue}}else{const $=O.children(this._source.maxzoom);if(n[$[0].key]&&n[$[1].key]&&n[$[2].key]&&n[$[3].key])continue}let G=j.wasRequested();for(let $=O.overscaledZ-1;$>=y;--$){const Z=O.scaledTo($);if(s[Z.key]||(s[Z.key]=!0,j=this.getTile(Z),!j&&G&&(j=this._addTile(Z)),j&&(n[Z.key]=Z,G=j.wasRequested(),j.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){s=this._loadedParentTiles[a.key];break}n.push(a.key);const p=a.scaledTo(a.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;a=p}for(const p of n)this._loadedParentTiles[p]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=!!n;if(!s){const a=this.map?this.map.painter:null;n=new Pd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new Qn("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const a=[],p=this.transform;if(!p)return a;const y=p.projection.name==="globe",T=xl(p.center.lng);for(const P in this._tiles){const O=this._tiles[P];if(s&&O.clearQueryDebugViz(),O.holdingForFade())continue;let j;if(y){const G=O.tileID.canonical;if(G.z===0){const $=[Math.abs(He(T,...Tu(G,-1))-T),Math.abs(He(T,...Tu(G,1))-T)];j=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(He(T,...Tu(G,-1))-T),Math.abs(He(T,...Tu(G,0))-T),Math.abs(He(T,...Tu(G,1))-T)];j=[$.indexOf(Math.min(...$))-1]}}else j=[0];for(const G of j){const $=e.containsTile(O,p,n,G);$&&a.push($)}}return a}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Fg(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Gn.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const a=this._tiles[e];a&&a.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(e,n))};return void this._source.on("data",T)}const s=new Map,a=Array.isArray(e)?e:[e],p=this.map.painter.terrain,y=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const T of a){const P=T.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of P)s.set(O.key,O);this.usedForTerrain&&T.updateElevation(!1)}Oe(Array.from(s.values()),(T,P)=>{const O=new Pd(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(O,j=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),P(j,O)})},n)}}function Og(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||s-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Fg(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function Tu(i,e){const n=1<<i.z;return[i.x/n+e,(i.x+1)/n+e]}Hc.maxOverzooming=10,Hc.maxUnderzooming=3;class wf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const a=s||e.findDEMTileFor(n);if(!a||!a.dem)return;const p=a.dem,y=a.tileID,T=1<<n.canonical.z-y.canonical.z;return new wf(a,a.tileSize/Bi/T,[(n.canonical.x/T-y.canonical.x)*p.dim,(n.canonical.y/T-y.canonical.y)*p.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(s);return new ve(a,p)}getElevationAt(e,n,s,a){const p=e*this._scale+this._offset[0],y=n*this._scale+this._offset[1],T=Math.floor(p),P=Math.floor(y),O=this._dem;return a=!!a,s?Ci(Ci(O.get(T,P,a),O.get(T,P+1,a),y-P),Ci(O.get(T+1,P,a),O.get(T+1,P+1,a),y-P),p-T):O.get(T,P,a)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Va(1,e)*this._dem.stride}}class zg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ra(Bi,16,0),this.featureIndexArray=new pl,this.promoteId=n}insert(e,n,s,a,p,y=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,p,y);const P=this.grid;for(let O=0;O<n.length;O++){const j=n[O],G=[1/0,1/0,-1/0,-1/0];for(let $=0;$<j.length;$++){const Z=j[$];G[0]=Math.min(G[0],Z.x),G[1]=Math.min(G[1],Z.y),G[2]=Math.max(G[2],Z.x),G[3]=Math.max(G[3],Z.y)}G[0]<Bi&&G[1]<Bi&&G[2]>=0&&G[3]>=0&&P.insert(T,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fd(new lf(this.rawTileData)).layers,this.sourceLayerCoder=new bg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,a){this.loadVTLayers();const p=e.params||{},y=ul(p.filter),T=e.tileResult,P=e.transform,O=T.bufferedTilespaceBounds,j=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(Q,ne,Ae,Fe)=>am(T.bufferedTilespaceGeometry,Q,ne,Ae,Fe));j.sort(u1);let G=null;P.elevation&&j.length>0&&(G=wf.create(P.elevation,this.tileID));const $={};let Z;for(let Q=0;Q<j.length;Q++){const ne=j[Q];if(ne===Z)continue;Z=ne;const Ae=this.featureIndexArray.get(ne);let Fe=null;this.loadMatchingFeature($,Ae,y,p.layers,p.availableImages,n,s,a,(Je,Be,Ze,nt=0)=>(Fe||(Fe=$l(Je,this.tileID.canonical,e.tileTransform)),Be.queryIntersectsFeature(T,Je,Ze,Fe,this.z,e.transform,e.pixelPosMatrix,G,nt)))}return $}loadMatchingFeature(e,n,s,a,p,y,T,P,O){const{featureIndex:j,bucketIndex:G,sourceLayerIndex:$,layoutVertexArrayOffset:Z}=n,Q=this.bucketLayerIDs[G];if(a&&!function(Je,Be){for(let Ze=0;Ze<Je.length;Ze++)if(Be.indexOf(Je[Ze])>=0)return!0;return!1}(a,Q))return;const ne=this.sourceLayerCoder.decode($),Ae=this.vtLayers[ne].feature(j);if(s.needGeometry){const Je=qc(Ae,!0);if(!s.filter(new N(this.tileID.overscaledZ),Je,this.tileID.canonical))return}else if(!s.filter(new N(this.tileID.overscaledZ),Ae))return;const Fe=this.getId(Ae,ne);for(let Je=0;Je<Q.length;Je++){const Be=Q[Je];if(a&&a.indexOf(Be)<0)continue;const Ze=y[Be];if(!Ze)continue;let nt={};Fe!==void 0&&P&&(nt=P.getState(Ze.sourceLayer||"_geojsonTileLayer",Fe));const rt=ce({},T[Be]);rt.paint=Rg(rt.paint,Ze.paint,Ae,nt,p),rt.layout=Rg(rt.layout,Ze.layout,Ae,nt,p);const Ot=!O||O(Ae,Ze,nt,Z);if(!Ot)continue;const kt=new wg(Ae,this.z,this.x,this.y,Fe);kt.layer=rt;let Ht=e[Be];Ht===void 0&&(Ht=e[Be]=[]),Ht.push({featureIndex:j,feature:kt,intersectionZ:Ot})}}lookupSymbolFeatures(e,n,s,a,p,y,T,P){const O={};this.loadVTLayers();const j=ul(p);for(const G of e)this.loadMatchingFeature(O,{bucketIndex:s,sourceLayerIndex:a,featureIndex:G,layoutVertexArrayOffset:0},j,y,T,P,n);return O}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),p=this.vtFeatures[a];if(p[n])return p[n];const y=this.vtLayers[a].feature(n);return p[n]=y,y}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];a!=null&&(s=e.properties[a]),typeof s=="boolean"&&(s=Number(s))}return s}}function Rg(i,e,n,s,a){return lt(i,(p,y)=>{const T=e instanceof Le?e.get(y):null;return T&&T.evaluate?T.evaluate(n,s,a):T})}function u1(i,e){return e-i}bi(zg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Bg{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Yl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=ke(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const a=[];let p=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,T=!0;a.push({left:p,right:y,isDash:T,zeroLength:e[0]===0});let P=e[0];for(let O=1;O<e.length;O++){T=!T;const j=e[O];p=P*s,P+=j,y=P*s,a.push({left:p,right:y,isDash:T,zeroLength:j===0})}return a}addRoundDash(e,n,s){const a=n/2;for(let p=-s;p<=s;p++){const y=this.width*(this.nextRow+s+p);let T=0,P=e[T];for(let O=0;O<this.width;O++){O/P.right>1&&(P=e[++T]);const j=Math.abs(O-P.left),G=Math.abs(O-P.right),$=Math.min(j,G);let Z;const Q=p/s*(a+1);if(P.isDash){const ne=a-Math.abs(Q);Z=Math.sqrt($*$+ne*ne)}else Z=a-Math.sqrt($*$+Q*Q);this.image.data[y+O]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e,n){for(let P=e.length-1;P>=0;--P){const O=e[P],j=e[P+1];O.zeroLength?e.splice(P,1):j&&j.isDash===O.isDash&&(j.left=O.left,e.splice(P,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const p=this.width*this.nextRow;let y=0,T=e[y];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++y]);const O=Math.abs(P-T.left),j=Math.abs(P-T.right),G=Math.min(O,j);this.image.data[p+P]=Math.max(0,Math.min(255,(T.isDash?G:-G)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const a=n==="round",p=a?7:0,y=2*p+1;if(this.nextRow+y>this.height)return Xe("LineAtlas out of space"),null;e.length===0&&e.push(1);let T=0;for(let j=0;j<e.length;j++)e[j]<0&&(Xe("Negative value is found in line dasharray, replacing values with 0"),e[j]=0),T+=e[j];if(T!==0){const j=this.width/T,G=this.getDashRanges(e,this.width,j);a?this.addRoundDash(G,j,p):this.addRegularDash(G,n==="square"?.5*j:0)}const P=this.nextRow+p;this.nextRow+=y;const O={tl:[P,p],br:[T,0]};return this.positions[s]=O,O}}bi(Bg,"LineAtlas");const Ng=1*Ga;class jg{constructor(e){const n={},s=[];for(const T in e){const P=e[T],O=n[T]={};for(const j in P.glyphs){const G=P.glyphs[+j];if(!G||G.bitmap.width===0||G.bitmap.height===0)continue;const $=G.metrics.localGlyph?Ng:1,Z={x:0,y:0,w:G.bitmap.width+2*$,h:G.bitmap.height+2*$};s.push(Z),O[j]=Z}}const{w:a,h:p}=gd(s),y=new Yl({width:a||1,height:p||1});for(const T in e){const P=e[T];for(const O in P.glyphs){const j=P.glyphs[+O];if(!j||j.bitmap.width===0||j.bitmap.height===0)continue;const G=n[T][O],$=j.metrics.localGlyph?Ng:1;Yl.copy(j.bitmap,y,{x:0,y:0},{x:G.x+$,y:G.y+$},j.bitmap)}}this.image=y,this.positions=n}}bi(jg,"GlyphAtlas");class f1{constructor(e){this.tileID=new js(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Xc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,a,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Dr;const y=new bg(Object.keys(e.layers).sort()),T=new zg(this.tileID,this.promoteId);T.bucketLayerIDs=[];const P={},O=new Bg(256,256),j={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:O,availableImages:s},G=n.familiesBySource[this.source];for(const nt in G){const rt=e.layers[nt];if(!rt)continue;let Ot=!1,kt=!1;for(const Nt of G[nt])Nt[0].type==="symbol"?Ot=!0:kt=!0;if(this.isSymbolTile===!0&&!Ot||this.isSymbolTile===!1&&!kt)continue;rt.version===1&&Xe(`Vector tile source "${this.source}" layer "${nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=y.encode(nt),hi=[];for(let Nt=0;Nt<rt.length;Nt++){const Jt=rt.feature(Nt),Qt=T.getId(Jt,nt);hi.push({feature:Jt,id:Qt,index:Nt,sourceLayerIndex:Ht})}for(const Nt of G[nt]){const Jt=Nt[0];this.isSymbolTile!==void 0&&Jt.type==="symbol"!==this.isSymbolTile||Jt.minzoom&&this.zoom<Math.floor(Jt.minzoom)||Jt.maxzoom&&this.zoom>=Jt.maxzoom||Jt.visibility!=="none"&&(Dd(Nt,this.zoom,s),(P[Jt.id]=Jt.createBucket({index:T.bucketLayerIDs.length,layers:Nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(hi,j,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(Nt.map(Qt=>Qt.id)))}}let $,Z,Q,ne;O.trim();const Ae={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Fe=()=>{if($)return p($);if(Z&&Q&&ne){const nt=new jg(Z),rt=new Hm(Q,ne);for(const Ot in P){const kt=P[Ot];kt instanceof oc?(Dd(kt.layers,this.zoom,s),By(kt,Z,nt.positions,Q,rt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):kt.hasPattern&&(kt instanceof sf||kt instanceof Qu||kt instanceof fu)&&(Dd(kt.layers,this.zoom,s),kt.addFeatures(j,this.tileID.canonical,rt.patternPositions,s,this.tileTransform))}this.status="done",p(null,{buckets:Y(P).filter(Ot=>!Ot.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nt.image,lineAtlas:O,imageAtlas:rt,glyphMap:this.returnDependencies?Z:null,iconMap:this.returnDependencies?Q:null,glyphPositions:this.returnDependencies?nt.positions:null})}},Je=lt(j.glyphDependencies,nt=>Object.keys(nt).map(Number));Object.keys(Je).length?a.send("getGlyphs",{uid:this.uid,stacks:Je},(nt,rt)=>{$||($=nt,Z=rt,Fe())},void 0,!1,Ae):Z={};const Be=Object.keys(j.iconDependencies);Be.length?a.send("getImages",{icons:Be,source:this.source,tileID:this.tileID,type:"icons"},(nt,rt)=>{$||($=nt,Q=rt,Fe())},void 0,!1,Ae):Q={};const Ze=Object.keys(j.patternDependencies);Ze.length?a.send("getImages",{icons:Ze,source:this.source,tileID:this.tileID,type:"patterns"},(nt,rt)=>{$||($=nt,ne=rt,Fe())},void 0,!1,Ae):ne={},Fe()}}function Dd(i,e,n){const s=new N(e);for(const a of i)a.recalculate(s,n)}class Ug{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,a){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[y,T]=p.result;return this.scheduler?this.scheduler.add(()=>{a(y,T)},n):a(y,T),()=>{}}return p.callbacks.push(a),p.cancel||(p.cancel=s((y,T)=>{p.result=[y,T];for(const P of p.callbacks)this.scheduler?this.scheduler.add(()=>{P(y,T)},n):P(y,T);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==a),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function Vg(i,e,n){const s=JSON.stringify(i.request);return i.data&&(this.deduped.entries[s]={result:[null,i.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{const p=qr(i.request,(y,T,P,O)=>{y?a(y):T&&a(null,{vectorTile:n?void 0:new fd(new lf(T)),rawData:T,cacheControl:P,expires:O})});return()=>{p.cancel(),a()}},e)}const qg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Od{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const p=qg[15&s];if(!p)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new Od(T,y,p,e)}constructor(e,n=64,s=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=qg.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-T%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+P,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+P),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+P,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Fd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:T}=this,P=[0,p.length-1,0],O=[];for(;P.length;){const j=P.pop()||0,G=P.pop()||0,$=P.pop()||0;if(G-$<=T){for(let Ae=$;Ae<=G;Ae++){const Fe=y[2*Ae],Je=y[2*Ae+1];Fe>=e&&Fe<=s&&Je>=n&&Je<=a&&O.push(p[Ae])}continue}const Z=$+G>>1,Q=y[2*Z],ne=y[2*Z+1];Q>=e&&Q<=s&&ne>=n&&ne<=a&&O.push(p[Z]),(j===0?e<=Q:n<=ne)&&(P.push($),P.push(Z-1),P.push(1-j)),(j===0?s>=Q:a>=ne)&&(P.push(Z+1),P.push(G),P.push(1-j))}return O}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:p,nodeSize:y}=this,T=[0,a.length-1,0],P=[],O=s*s;for(;T.length;){const j=T.pop()||0,G=T.pop()||0,$=T.pop()||0;if(G-$<=y){for(let Ae=$;Ae<=G;Ae++)Wg(p[2*Ae],p[2*Ae+1],e,n)<=O&&P.push(a[Ae]);continue}const Z=$+G>>1,Q=p[2*Z],ne=p[2*Z+1];Wg(Q,ne,e,n)<=O&&P.push(a[Z]),(j===0?e-s<=Q:n-s<=ne)&&(T.push($),T.push(Z-1),T.push(1-j)),(j===0?e+s>=Q:n+s>=ne)&&(T.push(Z+1),T.push(G),T.push(1-j))}return P}}function Fd(i,e,n,s,a,p){if(a-s<=n)return;const y=s+a>>1;Gg(i,e,y,s,a,p),Fd(i,e,n,s,y-1,1-p),Fd(i,e,n,y+1,a,1-p)}function Gg(i,e,n,s,a,p){for(;a>s;){if(a-s>600){const O=a-s+1,j=n-s+1,G=Math.log(O),$=.5*Math.exp(2*G/3),Z=.5*Math.sqrt(G*$*(O-$)/O)*(j-O/2<0?-1:1);Gg(i,e,n,Math.max(s,Math.floor(n-j*$/O+Z)),Math.min(a,Math.floor(n+(O-j)*$/O+Z)),p)}const y=e[2*n+p];let T=s,P=a;for(Cu(i,e,s,n),e[2*a+p]>y&&Cu(i,e,s,a);T<P;){for(Cu(i,e,T,P),T++,P--;e[2*T+p]<y;)T++;for(;e[2*P+p]>y;)P--}e[2*s+p]===y?Cu(i,e,s,P):(P++,Cu(i,e,P,a)),P<=n&&(s=P+1),n<=P&&(a=P-1)}}function Cu(i,e,n,s){zd(i,n,s),zd(e,2*n,2*s),zd(e,2*n+1,2*s+1)}function zd(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}function Wg(i,e,n,s){const a=i-n,p=e-s;return a*a+p*p}t.ARRAY_TYPE=Co,t.AUTH_ERR_MSG=Ke,t.Aabb=Ns,t.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},qe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Et()?i:l,this.scheduler=new s1}send(i,e,n,s,a=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=p,this.callbacks[y]=n);const T=$t(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!n,targetMapId:s,mustQueue:a,sourceMapId:this.mapId,data:Ba(e,T)},T),{cancel:()=>{n&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||Et()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(E(e.error)):n(null,E(e.data)))}else{const n=$t(this.globalScope)?void 0:[],s=e.hasCallback?(p,y)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?Ba(p):null,data:Ba(y,n)},n)}:p=>{},a=E(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,s);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],a.source)[p[1]](a,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=nf,t.Color=Mi,t.ColorMode=Tl,t.CullFaceMode=Wa,t.DEMData=bf,t.DataConstantProperty=ie,t.DedupedRequest=Ug,t.DepthMode=kh,t.EXTENT=Bi,t.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,a=Math.floor(i.x),p=Math.floor((i.x-a)*s),y=Math.floor(i.y*s),T=this.findDEMTileFor(new js(n,a,n,p,y));return!(!T||!T.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||i.y<0||i.y>1)return e;const a=s.getSource().maxzoom,p=1<<a,y=Math.floor(i.x),T=i.x-y,P=new js(a,y,a,Math.floor(T*p),Math.floor(i.y*p)),O=this.findDEMTileFor(P);if(!O||!O.dem)return e;const j=O.dem,G=1<<O.tileID.canonical.z,$=(T*G-O.tileID.canonical.x)*j.dim,Z=(i.y*G-O.tileID.canonical.y)*j.dim,Q=Math.floor($),ne=Math.floor(Z);return(n?this.exaggeration():1)*Ci(Ci(j.get(Q,ne),j.get(Q,ne+1),Z-ne),Ci(j.get(Q+1,ne),j.get(Q+1,ne+1),Z-ne),$-Q)}getAtTileOffset(i,e,n){const s=1<<i.canonical.z;return this.getAtPointOrZero(new yh(i.wrap+(i.canonical.x+e/Bi)/s,(i.canonical.y+n/Bi)/s))}getAtTileOffsetFunc(i,e,n,s){return a=>{const p=this.getAtTileOffset(i,a.x,a.y),y=s.upVector(i.canonical,a.x,a.y);return Zo(y,y,p*s.upVectorScale(i.canonical,e,n).metersToTile),y}}getForTilePoints(i,e,n,s){if(this.isUsingMockSource())return!1;const a=wf.create(this,i,s);return!!a&&(e.forEach(p=>{p[2]=this.exaggeration()*a.getElevationAt(p[0],p[1],n)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,a=1<<i.canonical.z-s.canonical.z;let p=i.canonical.x/a-s.canonical.x,y=i.canonical.y/a-s.canonical.y,T=0;for(let P=0;P<i.canonical.z-s.canonical.z&&!n.leaves[T];P++){p*=2,y*=2;const O=2*Math.floor(y)+Math.floor(p);T=n.childOffsets[T]+O,p%=1,y%=1}return{min:this.exaggeration()*n.minimums[T],max:this.exaggeration()*n.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=bs,t.EvaluationParameters=N,t.Event=Qn,t.Evented=fo,t.FillExtrusionBucket=fu,t.Frustum=qf,t.FrustumCorners=Vf,t.GLOBE_RADIUS=yl,t.GLOBE_SCALE_MATCH_LATITUDE=45,t.GLOBE_ZOOM_THRESHOLD_MAX=Gp,t.GLOBE_ZOOM_THRESHOLD_MIN=Gf,t.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,e){const n=new ei,s=new Pi,a=[],p=i+1+2,y=e[0]+1,T=e[0]+1+(1+e.length),P=(O,j,G)=>{let $=O===p-1?O-2:O===0?O:O-1;return $+=G?24575:0,[$,j]};for(let O=0;O<p;++O)n.emplaceBack(...P(O,0,!0));for(let O=0;O<y;++O)for(let j=0;j<p;++j)n.emplaceBack(...P(j,O,(j===0||j===p-1)&&!0));for(let O=0;O<e.length;++O){const j=e[O];for(let G=0;G<p;++G)n.emplaceBack(...P(G,j,!0))}for(let O=0;O<e.length;++O){const j=s.length,G=e[O]+1+2,$=new Pi;for(let ne=0;ne<G-1;ne++){const Ae=ne===G-2,Fe=Ae?p*(T-e.length+O-ne):p;for(let Je=0;Je<p-1;Je++){const Be=ne*p+Je;ne===0||Ae||Je===0||Je===p-2?($.emplaceBack(Be+1,Be,Be+Fe),$.emplaceBack(Be+Fe,Be+Fe+1,Be+1)):(s.emplaceBack(Be+1,Be,Be+Fe),s.emplaceBack(Be+Fe,Be+Fe+1,Be+1))}}const Z=An.simpleSegment(0,j,n.length,s.length-j);for(let ne=0;ne<$.uint16.length;ne+=3)s.emplaceBack($.uint16[ne],$.uint16[ne+1],$.uint16[ne+2]);const Q=An.simpleSegment(0,j,n.length,s.length-j);a.push({withoutSkirts:Z,withSkirts:Q})}return{vertices:n,indices:s,segments:a}}_createGrid(i){const e=this._fillGridMeshWithLods(Uc,iu);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,tu.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){const e=new Pi;for(let a=0;a<=Uc;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const n=new Ir,s=new Ir;this._poleSegments=[];for(let a=0,p=0;a<Gf;a++){const y=360/(1<<a);n.emplaceBack(0,-yl,0,.5,0),s.emplaceBack(0,-yl,0,.5,1);for(let T=0;T<=Uc;T++){const P=T/Uc,O=Ci(0,y,P),[j,G,$]=mh(s0,o0,O,yl);n.emplaceBack(j,G,$,P,0),s.emplaceBack(j,G,$,P,1)}this._poleSegments.push(An.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,Vp,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(s,Vp,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const n=new wn,s=Uc,a=s+1+2,p=1;this._wireframeSegments=[];for(let y=0,T=0;y<iu.length;y++){const P=iu[y];for(let j=p;j<P+p;j++)for(let G=p;G<s+p;G++){const $=j*a+G;n.emplaceBack($,$+1),n.emplaceBack($,$+a),n.emplaceBack($,$+a+1)}const O=P*s*3;this._wireframeSegments.push(An.simpleSegment(0,T,(P+1)*a,O)),T+=O}this._wireframeIndexBuffer=i.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},t.GlyphManager=Eh,t.ImagePosition=_d,t.KDBush=Od,t.LivePerformanceUtils=Io,t.LngLat=Nr,t.LngLatBounds=ic,t.LocalGlyphMode=xd,t.MAX_MERCATOR_LATITUDE=xs,t.MercatorCoordinate=yh,t.ONE_EM=os,t.OverscaledTileID=js,t.PerformanceMarkers=Bn,t.Point=ve,t.Properties=Ne,t.RGBAImage=Ao,t.Ray=Uf,t.RequestManager=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",L,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!$e(i))return i;const n=Vt(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!$e(i))return i;const n=Vt(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e,n,s){if(!$e(i))return i;const a=Vt(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),n&&a.params.push(`language=${n}`),s&&a.params.push(`worldview=${s}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,s){const a=Vt(i);return $e(i)?(a.path=`/styles/v1${a.path}/sprite${e}${n}`,this._makeAPIURL(a,this._customAccessToken||s)):(a.path+=`${e}${n}`,ni(a))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!$e(i))return i;const s=Vt(i);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&s.authority!=="raster"&&n===512?"@2x":""}${m.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${d.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${d.TILE_URL_VERSION}${s.path}`);const a=this._customAccessToken||function(p){for(const y of p){const T=y.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(s.params)||d.ACCESS_TOKEN;return d.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,a)}canonicalizeTileURL(i,e){const n=Vt(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${d.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${d.TILE_URL_VERSION}/`,"")}`;let a=n.params;return e&&(a=a.filter(p=>!p.match(/^access_token=/))),a.length&&(s+=`?${a.join("&")}`),s}canonicalizeTileset(i,e){const n=!!e&&$e(e),s=[];for(const a of i.tiles||[])dt(a)?s.push(this.canonicalizeTileURL(a,n)):s.push(a);return s}_makeAPIURL(i,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Vt(d.API_URL);if(i.protocol=s.protocol,i.authority=s.authority,i.protocol==="http"){const a=i.params.indexOf("secure");a>=0&&i.params.splice(a,1)}if(s.path!=="/"&&(i.path=`${s.path}${i.path}`),!d.REQUIRE_ACCESS_TOKEN)return ni(i);if(e=e||d.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(a=>a.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),ni(i)}},t.ResourceType=wi,t.SegmentVector=An,t.SourceCache=Hc,t.StencilMode=Ld,t.StructArrayLayout1ui2=ns,t.StructArrayLayout2f1f2i16=zi,t.StructArrayLayout2i4=ei,t.StructArrayLayout2ui4=wn,t.StructArrayLayout3f12=Xi,t.StructArrayLayout3ui6=Pi,t.StructArrayLayout4i8=Gt,t.StructArrayLayout5f20=Ir,t.Texture=Su,t.Tile=Pd,t.Transitionable=ee,t.Uniform1f=dh,t.Uniform1i=class extends zs{constructor(i){super(i),this.current=0}set(i,e,n){this.fetchUniformLocation(i,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},t.Uniform2f=class extends zs{constructor(i){super(i),this.current=[0,0]}set(i,e,n){this.fetchUniformLocation(i,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},t.Uniform3f=class extends zs{constructor(i){super(i),this.current=[0,0,0]}set(i,e,n){this.fetchUniformLocation(i,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},t.Uniform4f=Xh,t.UniformColor=Nu,t.UniformMatrix2f=class extends zs{constructor(i){super(i),this.current=zc}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},t.UniformMatrix3f=class extends zs{constructor(i){super(i),this.current=Of}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},t.UniformMatrix4f=class extends zs{constructor(i){super(i),this.current=ju}set(i,e,n){if(this.fetchUniformLocation(i,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},t.UnwrappedTileID=km,t.ValidationError=yi,t.VectorTileFeature=tf,t.VectorTileWorkerSource=class extends fo{constructor(i,e,n,s,a){super(),this.actor=i,this.layerIndex=e,this.availableImages=n,this.loadVectorData=a||Vg,this.loading={},this.loaded={},this.deduped=new Ug(i.scheduler),this.isSpriteLoaded=s,this.scheduler=i.scheduler}loadTile(i,e){const n=i.uid,s=i&&i.request,a=s&&s.collectResourceTiming,p=this.loading[n]=new f1(i);p.abort=this.loadVectorData(i,(y,T)=>{const P=!this.loading[n];if(delete this.loading[n],P||y||!T)return p.status="done",P||(this.loaded[n]=p),e(y);const O=T.rawData,j={};T.expires&&(j.expires=T.expires),T.cacheControl&&(j.cacheControl=T.cacheControl),p.vectorTile=T.vectorTile||new fd(new lf(O));const G=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,($,Z)=>{if($||!Z)return e($);const Q={};if(a){const ne=$s(s);ne.length>0&&(Q.resourceTiming=JSON.parse(JSON.stringify(ne)))}e(null,ce({rawTileData:O.slice(0)},Z,j,Q))})};this.isSpriteLoaded?G():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(G,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):G()}),this.loaded=this.loaded||{},this.loaded[n]=p})}reloadTile(i,e){const n=this.loaded,s=i.uid,a=this;if(n&&n[s]){const p=n[s];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection,p.tileTransform=Xc(i.tileID.canonical,i.projection);const y=(T,P)=>{const O=p.reloadCallback;O&&(delete p.reloadCallback,p.parse(p.vectorTile,a.layerIndex,this.availableImages,a.actor,O)),e(T,P)};p.status==="parsing"?p.reloadCallback=y:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(i,e){const n=i.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(i,e){const n=this.loaded,s=i.uid;n&&n[s]&&delete n[s],e()}},t.WritingMode=Jo,t.ZoomDependentExpression=ll,t.add=Hl,t.addDynamicAttributes=yf,t.adjoint=function(i,e){var n=e[0],s=e[1],a=e[2],p=e[3],y=e[4],T=e[5],P=e[6],O=e[7],j=e[8];return i[0]=y*j-T*O,i[1]=a*O-s*j,i[2]=s*T-a*y,i[3]=T*P-p*j,i[4]=n*j-a*P,i[5]=a*p-n*T,i[6]=p*O-y*P,i[7]=s*P-n*O,i[8]=n*y-s*p,i},t.asyncAll=Oe,t.bezier=ft,t.bindAll=qe,t.boundsAttributes=Tg,t.bufferConvexPolygon=function(i,e){const n=[];for(let s=0;s<i.length;s++){const a=Te(s-1,-1,i.length-1),p=Te(s+1,-1,i.length-1),y=i[s],T=i[p],P=i[a].sub(y).unit(),O=T.sub(y).unit(),j=O.angleWithSep(P.x,P.y),G=P.add(O).unit().mult(-1*e/Math.sin(j/2));n.push(y.add(G))}return n},t.cacheEntryPossiblyAdded=function(i){Ii++,Ii>Li&&(i.getActor().send("enforceCacheSizeLimit",xi),Ii=0)},t.calculateGlobeLabelMatrix=function(i,e){const{x:n,y:s}=i.point,a=Yp(n,s,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Bc(a,a,Hf(vl(e)))},t.calculateGlobeMatrix=function(i){const{x:e,y:n}=i.point,{lng:s,lat:a}=i._center;return Yp(e,n,i.worldSize,s,a)},t.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,n=e/Va(1,i.center.lat),s=ja(new Float64Array(16));return Yh(s,s,[i.point.x,i.point.y,0]),Nc(s,s,[n,n,e]),Float32Array.from(s)},t.circumferenceAtLatitude=Yf,t.clamp=He,t.clearTileCache=function(i){if(!Rt())return;const e=l.caches.delete(mi);i&&e.catch(i).then(()=>i())},t.clipLine=og,t.clone=function(i){var e=new Co(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},t.clone$1=ht,t.collisionCircleLayout=hy,t.config=d,t.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},t.create=function(){var i=new Co(16);return Co!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},t.create$1=Mp,t.createExpression=Xo,t.createLayout=ut,t.createStyleLayer=function(i){return i.type==="custom"?new t1(i):new r1[i.type](i)},t.cross=jf,t.degToRad=pe,t.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},t.div=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},t.dot=ha,t.earthRadius=su,t.ease=xt,t.easeCubicInOut=at,t.ecefToLatLng=function([i,e,n]){const s=Math.hypot(i,e,n),a=Math.atan2(i,n),p=.5*Math.PI-Math.acos(-e/s);return new Nr(ze(a),ze(p))},t.emitValidationErrors=fh,t.endsWith=gt,t.enforceCacheSizeLimit=function(i){si(),Ue&&Ue.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-i;s++)e.delete(n[s])})})},t.evaluateSizeForFeature=of,t.evaluateSizeForZoom=Sh,t.evaluateVariableOffset=ug,t.evented=b,t.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},t.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},t.exported=Gn,t.exported$1=m,t.extend=ce,t.extend$1=Wn,t.fillExtrusionHeightLift=Mm,t.filterObject=Bt,t.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},t.fromQuat=function(i,e){var n=e[0],s=e[1],a=e[2],p=e[3],y=n+n,T=s+s,P=a+a,O=n*y,j=s*y,G=s*T,$=a*y,Z=a*T,Q=a*P,ne=p*y,Ae=p*T,Fe=p*P;return i[0]=1-G-Q,i[1]=j+Fe,i[2]=$-Ae,i[3]=0,i[4]=j-Fe,i[5]=1-O-Q,i[6]=Z+ne,i[7]=0,i[8]=$+Ae,i[9]=Z-ne,i[10]=1-O-G,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},t.fromRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=n,i[2]=0,i[3]=-n,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},t.fromScaling=Ip,t.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return De[e]},t.getAABBPointSquareDist=function(i,e,n){let s=0;for(let a=0;a<2;++a){const p=n?n[a]:0;i[a]>p&&(s+=(i[a]-p)*(i[a]-p)),e[a]<p&&(s+=(p-e[a])*(p-e[a]))}return s},t.getAnchorAlignment=vd,t.getAnchorJustification=wd,t.getBounds=function(i){let e=1/0,n=1/0,s=-1/0,a=-1/0;for(const p of i)e=Math.min(e,p.x),n=Math.min(n,p.y),s=Math.max(s,p.x),a=Math.max(a,p.y);return{min:new ve(e,n),max:new ve(s,a)}},t.getColumn=ri,t.getDefaultExportFromCjs=B,t.getGridMatrix=function(i,e,n,s){const a=e.getNorth(),p=e.getSouth(),y=e.getWest(),T=e.getEast(),P=1<<i.z,O=T-y,j=a-p,G=O/Uc,$=-j/iu[n],Z=[0,G,0,$,0,0,a,y,0];if(i.z>0){const Q=180/s;Lp(Z,Z,[Q/O+1,0,0,0,Q/j+1,0,-.5*Q/G,.5*Q/$,1])}return Z[2]=P,Z[5]=i.x,Z[8]=i.y,Z},t.getImage=Ve,t.getJSON=function(i,e){return Yi(ce(i,{type:"json"}),e)},t.getLatitudinalLod=function(i){const e=xs-5;i=He(i,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(pe(i))),3);return Math.round(n*(iu.length-1))},t.getMapSessionAPI=Or,t.getPerformanceMeasurement=$s,t.getProjection=vg,t.getRTLTextPluginStatus=S,t.getReferrer=Ti,t.getTilePoint=function(i,{x:e,y:n},s=0){return new ve(((e-s)*i.scale-i.x)*Bi,(n*i.scale-i.y)*Bi)},t.getTileVec3=function(i,e,n=0){return ph(((e.x-n)*i.scale-i.x)*Bi,(e.y*i.scale-i.y)*Bi,Qp(e.z,e.y))},t.getVideo=function(i,e){const n=l.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<i.length;s++){const a=l.document.createElement("source");Hi(i[s])||(n.crossOrigin="Anonymous"),a.src=i[s],n.appendChild(a)}return{cancel:()=>{}}},t.globeCenterToScreenPoint=function(i){const e=[0,0,0],n=ja(new Float64Array(16));return Bc(n,i.pixelMatrix,i.globeMatrix),Sn(e,e,n),new ve(e[0],e[1])},t.globeDenormalizeECEF=Hf,t.globeECEFOrigin=function(i,e){const n=[0,0,0];return Sn(n,n,nu(vl(e.canonical))),Sn(n,n,i),n},t.globeMetersToEcef=qu,t.globeNormalizeECEF=nu,t.globePixelsToTileUnits=function(i,e){return Bi/(512*Math.pow(2,i))*Wu(vl(e))},t.globePoleMatrixForTile=function(i,e,n){const s=ja(new Float64Array(16)),a=(e/(1<<i)-.5)*Math.PI*2;return Vu(s,n.globeMatrix,a),Float32Array.from(s)},t.globeTileBounds=vl,t.globeTiltAtLngLat=Zp,t.globeToMercatorTransition=_h,t.globeUseCustomAntiAliasing=function(i,e,n){const s=_h(n.zoom),a=i.style.map._antialias,p=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return s===0&&!a&&!y&&p},t.identity=ja,t.identity$1=Np,t.invert=zf,t.isFullscreen=function(){return!!l.document.fullscreenElement||!!l.document.webkitFullscreenElement},t.isLngLatBehindGlobe=$f,t.isMapAuthenticated=function(i){return Fr.has(i)},t.isMapboxURL=$e,t.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!$t(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=vs,t.latLngToECEF=gh,t.len=J_,t.length=Zh,t.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},t.lngFromMercatorX=Ko,t.loadVectorTile=Vg,t.makeRequest=Yi,t.mapValue=function(i,e,n,s,a){return He((i-e)/(n-e)*(a-s)+s,s,a)},t.mercatorScale=em,t.mercatorXfromLng=xl,t.mercatorYfromLat=bl,t.mercatorZfromAltitude=Va,t.mul=Z_,t.mul$1=K_,t.multiply=Bc,t.multiply$1=Lp,t.multiply$2=Op,t.nextPowerOfTwo=ke,t.normalize=Bs,t.normalize$1=Q_,t.normalize$2=Rp,t.number=Ci,t.ortho=function(i,e,n,s,a,p,y){var T=1/(e-n),P=1/(s-a),O=1/(p-y);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*P,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*O,i[11]=0,i[12]=(e+n)*T,i[13]=(a+s)*P,i[14]=(y+p)*O,i[15]=1,i},t.pbf=Nm,t.perspective=function(i,e,n,s,a){var p,y=1/Math.tan(e/2);return i[0]=y/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+s)*(p=1/(s-a)),i[14]=2*a*s*p):(i[10]=-1,i[14]=-2*s),i},t.pick=function(i,e){const n={};for(let s=0;s<e.length;s++){const a=e[s];a in i&&(n[a]=i[a])}return n},t.plugin=F,t.pointGeometry=he,t.polesInViewport=function(i){const e=ja(new Float64Array(16));Bc(e,i.pixelMatrix,i.globeMatrix);const n=[0,ua,0],s=[0,fa,0];return Sn(n,n,e),Sn(s,s,e),[n[0]>0&&n[0]<=i.width&&n[1]>0&&n[1]<=i.height&&!$f(i,new Nr(i.center.lat,90)),s[0]>0&&s[0]<=i.width&&s[1]>0&&s[1]<=i.height&&!$f(i,new Nr(i.center.lat,-90))]},t.polygonContainsPoint=Gc,t.polygonIntersectsBox=am,t.polygonIntersectsPolygon=rm,t.polygonizeBounds=function(i,e,n=0,s=!0){const a=new ve(n,n),p=i.sub(a),y=e.add(a),T=[p,new ve(y.x,p.y),y,new ve(p.x,y.y)];return s&&T.push(p.clone()),T},t.posAttributes=tu,t.postMapLoadEvent=Pr,t.postPerformanceEvent=Sr,t.postTurnstileEvent=Wi,t.potpack=gd,t.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.radToDeg=ze,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(i){return i({pluginStatus:h,pluginURL:r}),b.on("pluginStateChange",i),i},t.removeAuthState=function(i){Fr.delete(i)},t.renderColorRamp=rd,t.resample=tm,t.rotateX=Rf,t.rotateX$1=jp,t.rotateY=Vu,t.rotateY$1=Up,t.rotateZ=function(i,e,n){var s=Math.sin(n),a=Math.cos(n),p=e[0],y=e[1],T=e[2],P=e[3],O=e[4],j=e[5],G=e[6],$=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*a+O*s,i[1]=y*a+j*s,i[2]=T*a+G*s,i[3]=P*a+$*s,i[4]=O*a-p*s,i[5]=j*a-y*s,i[6]=G*a-T*s,i[7]=$*a-P*s,i},t.rotateZ$1=function(i,e,n){n*=.5;var s=e[0],a=e[1],p=e[2],y=e[3],T=Math.sin(n),P=Math.cos(n);return i[0]=s*P+a*T,i[1]=a*P-s*T,i[2]=p*P+y*T,i[3]=y*P-p*T,i},t.scale=Nc,t.scale$1=zp,t.scale$2=Zo,t.scaleAndAdd=Qh,t.set=function(i,e,n,s){return i[0]=e,i[1]=n,i[2]=s,i},t.setCacheLimits=function(i,e){xi=i,Li=e},t.setColumn=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},t.setRTLTextPlugin=function(i,e,n=!1){if(h===mt||h===Ft||h===zt)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=Gn.resolveURL(i),h=mt,St=e,u(),n||I()},t.smoothstep=ae,t.spec=Ut,t.squaredLength=function(i){var e=i[0],n=i[1],s=i[2];return e*e+n*n+s*s},t.storeAuthState=function(i,e){e?Fr.add(i):Fr.delete(i)},t.sub=Ua,t.subtract=Nf,t.symbolSize=uy,t.tileAABB=function(i,e,n,s,a,p,y,T,P){if(P.name==="globe")return n0(i,e,new nf(n,s,a));const O=Xc({z:n,x:s,y:a},P);return new Ns([(p+O.x/O.scale)*e,e*(O.y/O.scale),y],[(p+O.x2/O.scale)*e,e*(O.y2/O.scale),T])},t.tileCornersToBounds=Gu,t.tileTransform=Xc,t.transformMat3=function(i,e,n){var s=e[0],a=e[1],p=e[2];return i[0]=s*n[0]+a*n[3]+p*n[6],i[1]=s*n[1]+a*n[4]+p*n[7],i[2]=s*n[2]+a*n[5]+p*n[8],i},t.transformMat4=Sn,t.transformMat4$1=jc,t.transformQuat=Fp,t.transitionTileAABBinECEF=Xp,t.translate=Yh,t.transpose=function(i,e){if(i===e){var n=e[1],s=e[2],a=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=s,i[7]=a}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},t.triggerPluginCompletionEvent=o,t.uniqueId=te,t.updateGlobeVertexNormal=function(i,e,n,s,a){const p=5*e+2;i.float32[p+0]=n,i.float32[p+1]=s,i.float32[p+2]=a},t.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=i=>Fs(As(i)),t.validateFog=i=>Fs(ql(i)),t.validateLayer=i=>Fs(ch(i)),t.validateLight=i=>Fs(Ac(i)),t.validateSource=i=>Fs(Cc(i)),t.validateStyle=Mc,t.validateTerrain=i=>Fs(Ec(i)),t.values=Y,t.vectorTile=ef,t.version=v,t.warnOnce=Xe,t.window=l,t.wrap=Te}),z(["./shared"],function(t){function l(je){if(typeof je=="number"||typeof je=="boolean"||typeof je=="string"||je==null)return JSON.stringify(je);if(Array.isArray(je)){let fe="[";for(const Ve of je)fe+=`${l(Ve)},`;return`${fe}]`}let oe="{";for(const fe of Object.keys(je).sort())oe+=`${fe}:${l(je[fe])},`;return`${oe}}`}function v(je){let oe="";for(const fe of t.refProperties)oe+=`/${l(je[fe])}`;return oe}class x{constructor(oe){this.keyCache={},oe&&this.replace(oe)}replace(oe){this._layerConfigs={},this._layers={},this.update(oe,[])}update(oe,fe){for(const Ke of oe)this._layerConfigs[Ke.id]=Ke,(this._layers[Ke.id]=t.createStyleLayer(Ke)).compileFilter(),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id];for(const Ke of fe)delete this.keyCache[Ke],delete this._layerConfigs[Ke],delete this._layers[Ke];this.familiesBySource={};const Ve=function(Ke,$e){const dt={};for(let st=0;st<Ke.length;st++){const Dt=$e&&$e[Ke[st].id]||v(Ke[st]);$e&&($e[Ke[st].id]=Dt);let ti=dt[Dt];ti||(ti=dt[Dt]=[]),ti.push(Ke[st])}const bt=[];for(const st in dt)bt.push(dt[st]);return bt}(t.values(this._layerConfigs),this.keyCache);for(const Ke of Ve){const $e=Ke.map(Vt=>this._layers[Vt.id]),dt=$e[0];if(dt.visibility==="none")continue;const bt=dt.source||"";let st=this.familiesBySource[bt];st||(st=this.familiesBySource[bt]={});const Dt=dt.sourceLayer||"_geojsonTileLayer";let ti=st[Dt];ti||(ti=st[Dt]=[]),ti.push($e)}}}class d{loadTile(oe,fe){const{uid:Ve,encoding:Ke,rawImageData:$e,padding:dt,buildQuadTree:bt}=oe,st=t.window.ImageBitmap&&$e instanceof t.window.ImageBitmap?this.getImageData($e,dt):$e;fe(null,new t.DEMData(Ve,st,Ke,dt<1,bt))}getImageData(oe,fe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Ve=this.offscreenCanvasContext.getImageData(-fe,-fe,oe.width+2*fe,oe.height+2*fe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ve}}function m(je,oe){if(je.length!==0){c(je[0],oe);for(var fe=1;fe<je.length;fe++)c(je[fe],!oe)}}function c(je,oe){for(var fe=0,Ve=0,Ke=0,$e=je.length,dt=$e-1;Ke<$e;dt=Ke++){var bt=(je[Ke][0]-je[dt][0])*(je[dt][1]+je[Ke][1]),st=fe+bt;Ve+=Math.abs(fe)>=Math.abs(bt)?fe-st+bt:bt-st+fe,fe=st}fe+Ve>=0!=!!oe&&je.reverse()}var _=t.getDefaultExportFromCjs(function je(oe,fe){var Ve,Ke=oe&&oe.type;if(Ke==="FeatureCollection")for(Ve=0;Ve<oe.features.length;Ve++)je(oe.features[Ve],fe);else if(Ke==="GeometryCollection")for(Ve=0;Ve<oe.geometries.length;Ve++)je(oe.geometries[Ve],fe);else if(Ke==="Feature")je(oe.geometry,fe);else if(Ke==="Polygon")m(oe.coordinates,fe);else if(Ke==="MultiPolygon")for(Ve=0;Ve<oe.coordinates.length;Ve++)m(oe.coordinates[Ve],fe);return oe});const w=t.VectorTileFeature.prototype.toGeoJSON;var g={exports:{}},C=t.pointGeometry,L=t.vectorTile.VectorTileFeature,B=q;function q(je,oe){this.options=oe||{},this.features=je,this.length=je.length}function K(je,oe){this.id=typeof je.id=="number"?je.id:void 0,this.type=je.type,this.rawGeometry=je.type===1?[je.geometry]:je.geometry,this.properties=je.tags,this.extent=oe||4096}q.prototype.feature=function(je){return new K(this.features[je],this.options.extent)},K.prototype.loadGeometry=function(){var je=this.rawGeometry;this.geometry=[];for(var oe=0;oe<je.length;oe++){for(var fe=je[oe],Ve=[],Ke=0;Ke<fe.length;Ke++)Ve.push(new C(fe[Ke][0],fe[Ke][1]));this.geometry.push(Ve)}return this.geometry},K.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var je=this.geometry,oe=1/0,fe=-1/0,Ve=1/0,Ke=-1/0,$e=0;$e<je.length;$e++)for(var dt=je[$e],bt=0;bt<dt.length;bt++){var st=dt[bt];oe=Math.min(oe,st.x),fe=Math.max(fe,st.x),Ve=Math.min(Ve,st.y),Ke=Math.max(Ke,st.y)}return[oe,Ve,fe,Ke]},K.prototype.toGeoJSON=L.prototype.toGeoJSON;var se=t.pbf,he=B;function le(je){var oe=new se;return function(fe,Ve){for(var Ke in fe.layers)Ve.writeMessage(3,ve,fe.layers[Ke])}(je,oe),oe.finish()}function ve(je,oe){var fe;oe.writeVarintField(15,je.version||1),oe.writeStringField(1,je.name||""),oe.writeVarintField(5,je.extent||4096);var Ve={keys:[],values:[],keycache:{},valuecache:{}};for(fe=0;fe<je.length;fe++)Ve.feature=je.feature(fe),oe.writeMessage(2,ot,Ve);var Ke=Ve.keys;for(fe=0;fe<Ke.length;fe++)oe.writeStringField(3,Ke[fe]);var $e=Ve.values;for(fe=0;fe<$e.length;fe++)oe.writeMessage(4,at,$e[fe])}function ot(je,oe){var fe=je.feature;fe.id!==void 0&&oe.writeVarintField(1,fe.id),oe.writeMessage(2,_e,je),oe.writeVarintField(3,fe.type),oe.writeMessage(4,De,fe)}function _e(je,oe){var fe=je.feature,Ve=je.keys,Ke=je.values,$e=je.keycache,dt=je.valuecache;for(var bt in fe.properties){var st=fe.properties[bt],Dt=$e[bt];if(st!==null){Dt===void 0&&(Ve.push(bt),$e[bt]=Dt=Ve.length-1),oe.writeVarint(Dt);var ti=typeof st;ti!=="string"&&ti!=="boolean"&&ti!=="number"&&(st=JSON.stringify(st));var Vt=ti+":"+st,ni=dt[Vt];ni===void 0&&(Ke.push(st),dt[Vt]=ni=Ke.length-1),oe.writeVarint(ni)}}}function pe(je,oe){return(oe<<3)+(7&je)}function ze(je){return je<<1^je>>31}function De(je,oe){for(var fe=je.loadGeometry(),Ve=je.type,Ke=0,$e=0,dt=fe.length,bt=0;bt<dt;bt++){var st=fe[bt],Dt=1;Ve===1&&(Dt=st.length),oe.writeVarint(pe(1,Dt));for(var ti=Ve===3?st.length-1:st.length,Vt=0;Vt<ti;Vt++){Vt===1&&Ve!==1&&oe.writeVarint(pe(2,ti-1));var ni=st[Vt].x-Ke,Ui=st[Vt].y-$e;oe.writeVarint(ze(ni)),oe.writeVarint(ze(Ui)),Ke+=ni,$e+=Ui}Ve===3&&oe.writeVarint(pe(7,1))}}function at(je,oe){var fe=typeof je;fe==="string"?oe.writeStringField(1,je):fe==="boolean"?oe.writeBooleanField(7,je):fe==="number"&&(je%1!=0?oe.writeDoubleField(3,je):je<0?oe.writeSVarintField(6,je):oe.writeVarintField(5,je))}g.exports=le,g.exports.fromVectorTileJs=le,g.exports.fromGeojsonVt=function(je,oe){oe=oe||{};var fe={};for(var Ve in je)fe[Ve]=new he(je[Ve].features,oe),fe[Ve].name=Ve,fe[Ve].version=oe.version,fe[Ve].extent=oe.extent;return le({layers:fe})},g.exports.GeoJSONWrapper=he;var ft=t.getDefaultExportFromCjs(g.exports);const xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},He=Math.fround||(ae=new Float32Array(1),je=>(ae[0]=+je,ae[0]));var ae;const Te=3,Oe=5,Y=6;class ce{constructor(oe){this.options=Object.assign(Object.create(xt),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:fe,minZoom:Ve,maxZoom:Ke}=this.options;fe&&console.time("total time");const $e=`prepare ${oe.length} points`;fe&&console.time($e),this.points=oe;const dt=[];for(let st=0;st<oe.length;st++){const Dt=oe[st];if(!Dt.geometry)continue;const[ti,Vt]=Dt.geometry.coordinates,ni=He(we(ti)),Ui=He(ke(Vt));dt.push(ni,Ui,1/0,st,-1,1),this.options.reduce&&dt.push(0)}let bt=this.trees[Ke+1]=this._createTree(dt);fe&&console.timeEnd($e);for(let st=Ke;st>=Ve;st--){const Dt=+Date.now();bt=this.trees[st]=this._createTree(this._cluster(bt,st)),fe&&console.log("z%d: %d clusters in %dms",st,bt.numItems,+Date.now()-Dt)}return fe&&console.timeEnd("total time"),this}getClusters(oe,fe){let Ve=((oe[0]+180)%360+360)%360-180;const Ke=Math.max(-90,Math.min(90,oe[1]));let $e=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Ve=-180,$e=180;else if(Ve>$e){const Vt=this.getClusters([Ve,Ke,180,dt],fe),ni=this.getClusters([-180,Ke,$e,dt],fe);return Vt.concat(ni)}const bt=this.trees[this._limitZoom(fe)],st=bt.range(we(Ve),ke(dt),we($e),ke(Ke)),Dt=bt.data,ti=[];for(const Vt of st){const ni=this.stride*Vt;ti.push(Dt[ni+Oe]>1?re(Dt,ni,this.clusterProps):this.points[Dt[ni+Te]])}return ti}getChildren(oe){const fe=this._getOriginId(oe),Ve=this._getOriginZoom(oe),Ke="No cluster with the specified id.",$e=this.trees[Ve];if(!$e)throw new Error(Ke);const dt=$e.data;if(fe*this.stride>=dt.length)throw new Error(Ke);const bt=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),st=$e.within(dt[fe*this.stride],dt[fe*this.stride+1],bt),Dt=[];for(const ti of st){const Vt=ti*this.stride;dt[Vt+4]===oe&&Dt.push(dt[Vt+Oe]>1?re(dt,Vt,this.clusterProps):this.points[dt[Vt+Te]])}if(Dt.length===0)throw new Error(Ke);return Dt}getLeaves(oe,fe,Ve){const Ke=[];return this._appendLeaves(Ke,oe,fe=fe||10,Ve=Ve||0,0),Ke}getTile(oe,fe,Ve){const Ke=this.trees[this._limitZoom(oe)],$e=Math.pow(2,oe),{extent:dt,radius:bt}=this.options,st=bt/dt,Dt=(Ve-st)/$e,ti=(Ve+1+st)/$e,Vt={features:[]};return this._addTileFeatures(Ke.range((fe-st)/$e,Dt,(fe+1+st)/$e,ti),Ke.data,fe,Ve,$e,Vt),fe===0&&this._addTileFeatures(Ke.range(1-st/$e,Dt,1,ti),Ke.data,$e,Ve,$e,Vt),fe===$e-1&&this._addTileFeatures(Ke.range(0,Dt,st/$e,ti),Ke.data,-1,Ve,$e,Vt),Vt.features.length?Vt:null}getClusterExpansionZoom(oe){let fe=this._getOriginZoom(oe)-1;for(;fe<=this.options.maxZoom;){const Ve=this.getChildren(oe);if(fe++,Ve.length!==1)break;oe=Ve[0].properties.cluster_id}return fe}_appendLeaves(oe,fe,Ve,Ke,$e){const dt=this.getChildren(fe);for(const bt of dt){const st=bt.properties;if(st&&st.cluster?$e+st.point_count<=Ke?$e+=st.point_count:$e=this._appendLeaves(oe,st.cluster_id,Ve,Ke,$e):$e<Ke?$e++:oe.push(bt),oe.length===Ve)break}return $e}_createTree(oe){const fe=new t.KDBush(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ve=0;Ve<oe.length;Ve+=this.stride)fe.add(oe[Ve],oe[Ve+1]);return fe.finish(),fe.data=oe,fe}_addTileFeatures(oe,fe,Ve,Ke,$e,dt){for(const bt of oe){const st=bt*this.stride,Dt=fe[st+Oe]>1;let ti,Vt,ni;if(Dt)ti=te(fe,st,this.clusterProps),Vt=fe[st],ni=fe[st+1];else{const ki=this.points[fe[st+Te]];ti=ki.properties;const[Fi,Wi]=ki.geometry.coordinates;Vt=we(Fi),ni=ke(Wi)}const Ui={type:1,geometry:[[Math.round(this.options.extent*(Vt*$e-Ve)),Math.round(this.options.extent*(ni*$e-Ke))]],tags:ti};let Vi;Vi=Dt||this.options.generateId?fe[st+Te]:this.points[fe[st+Te]].id,Vi!==void 0&&(Ui.id=Vi),dt.features.push(Ui)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,fe){const{radius:Ve,extent:Ke,reduce:$e,minPoints:dt}=this.options,bt=Ve/(Ke*Math.pow(2,fe)),st=oe.data,Dt=[],ti=this.stride;for(let Vt=0;Vt<st.length;Vt+=ti){if(st[Vt+2]<=fe)continue;st[Vt+2]=fe;const ni=st[Vt],Ui=st[Vt+1],Vi=oe.within(st[Vt],st[Vt+1],bt),ki=st[Vt+Oe];let Fi=ki;for(const Wi of Vi){const Ar=Wi*ti;st[Ar+2]>fe&&(Fi+=st[Ar+Oe])}if(Fi>ki&&Fi>=dt){let Wi,Ar=ni*ki,Pr=Ui*ki,kr=-1;const Sr=((Vt/ti|0)<<5)+(fe+1)+this.points.length;for(const un of Vi){const Or=un*ti;if(st[Or+2]<=fe)continue;st[Or+2]=fe;const Fr=st[Or+Oe];Ar+=st[Or]*Fr,Pr+=st[Or+1]*Fr,st[Or+4]=Sr,$e&&(Wi||(Wi=this._map(st,Vt,!0),kr=this.clusterProps.length,this.clusterProps.push(Wi)),$e(Wi,this._map(st,Or)))}st[Vt+4]=Sr,Dt.push(Ar/Fi,Pr/Fi,1/0,Sr,-1,Fi),$e&&Dt.push(kr)}else{for(let Wi=0;Wi<ti;Wi++)Dt.push(st[Vt+Wi]);if(Fi>1)for(const Wi of Vi){const Ar=Wi*ti;if(!(st[Ar+2]<=fe)){st[Ar+2]=fe;for(let Pr=0;Pr<ti;Pr++)Dt.push(st[Ar+Pr])}}}}return Dt}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,fe,Ve){if(oe[fe+Oe]>1){const dt=this.clusterProps[oe[fe+Y]];return Ve?Object.assign({},dt):dt}const Ke=this.points[oe[fe+Te]].properties,$e=this.options.map(Ke);return Ve&&$e===Ke?Object.assign({},$e):$e}}function re(je,oe,fe){return{type:"Feature",id:je[oe+Te],properties:te(je,oe,fe),geometry:{type:"Point",coordinates:[(Ve=je[oe],360*(Ve-.5)),We(je[oe+1])]}};var Ve}function te(je,oe,fe){const Ve=je[oe+Oe],Ke=Ve>=1e4?`${Math.round(Ve/1e3)}k`:Ve>=1e3?Math.round(Ve/100)/10+"k":Ve,$e=je[oe+Y],dt=$e===-1?{}:Object.assign({},fe[$e]);return Object.assign(dt,{cluster:!0,cluster_id:je[oe+Te],point_count:Ve,point_count_abbreviated:Ke})}function we(je){return je/360+.5}function ke(je){const oe=Math.sin(je*Math.PI/180),fe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return fe<0?0:fe>1?1:fe}function We(je){const oe=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function qe(je,oe,fe,Ve){for(var Ke,$e=Ve,dt=fe-oe>>1,bt=fe-oe,st=je[oe],Dt=je[oe+1],ti=je[fe],Vt=je[fe+1],ni=oe+3;ni<fe;ni+=3){var Ui=gt(je[ni],je[ni+1],st,Dt,ti,Vt);if(Ui>$e)Ke=ni,$e=Ui;else if(Ui===$e){var Vi=Math.abs(ni-dt);Vi<bt&&(Ke=ni,bt=Vi)}}$e>Ve&&(Ke-oe>3&&qe(je,oe,Ke,Ve),je[Ke+2]=$e,fe-Ke>3&&qe(je,Ke,fe,Ve))}function gt(je,oe,fe,Ve,Ke,$e){var dt=Ke-fe,bt=$e-Ve;if(dt!==0||bt!==0){var st=((je-fe)*dt+(oe-Ve)*bt)/(dt*dt+bt*bt);st>1?(fe=Ke,Ve=$e):st>0&&(fe+=dt*st,Ve+=bt*st)}return(dt=je-fe)*dt+(bt=oe-Ve)*bt}function lt(je,oe,fe,Ve){var Ke={id:je===void 0?null:je,type:oe,geometry:fe,tags:Ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($e){var dt=$e.geometry,bt=$e.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")Bt($e,dt);else if(bt==="Polygon"||bt==="MultiLineString")for(var st=0;st<dt.length;st++)Bt($e,dt[st]);else if(bt==="MultiPolygon")for(st=0;st<dt.length;st++)for(var Dt=0;Dt<dt[st].length;Dt++)Bt($e,dt[st][Dt])}(Ke),Ke}function Bt(je,oe){for(var fe=0;fe<oe.length;fe+=3)je.minX=Math.min(je.minX,oe[fe]),je.minY=Math.min(je.minY,oe[fe+1]),je.maxX=Math.max(je.maxX,oe[fe]),je.maxY=Math.max(je.maxY,oe[fe+1])}function ht(je,oe,fe,Ve){if(oe.geometry){var Ke=oe.geometry.coordinates,$e=oe.geometry.type,dt=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2),bt=[],st=oe.id;if(fe.promoteId?st=oe.properties[fe.promoteId]:fe.generateId&&(st=Ve||0),$e==="Point")ct(Ke,bt);else if($e==="MultiPoint")for(var Dt=0;Dt<Ke.length;Dt++)ct(Ke[Dt],bt);else if($e==="LineString")Xe(Ke,bt,dt,!1);else if($e==="MultiLineString"){if(fe.lineMetrics){for(Dt=0;Dt<Ke.length;Dt++)Xe(Ke[Dt],bt=[],dt,!1),je.push(lt(st,"LineString",bt,oe.properties));return}Se(Ke,bt,dt,!1)}else if($e==="Polygon")Se(Ke,bt,dt,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(Dt=0;Dt<oe.geometry.geometries.length;Dt++)ht(je,{id:st,geometry:oe.geometry.geometries[Dt],properties:oe.properties},fe,Ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Dt=0;Dt<Ke.length;Dt++){var ti=[];Se(Ke[Dt],ti,dt,!0),bt.push(ti)}}je.push(lt(st,$e,bt,oe.properties))}}function ct(je,oe){oe.push(At(je[0])),oe.push(Et(je[1])),oe.push(0)}function Xe(je,oe,fe,Ve){for(var Ke,$e,dt=0,bt=0;bt<je.length;bt++){var st=At(je[bt][0]),Dt=Et(je[bt][1]);oe.push(st),oe.push(Dt),oe.push(0),bt>0&&(dt+=Ve?(Ke*Dt-st*$e)/2:Math.sqrt(Math.pow(st-Ke,2)+Math.pow(Dt-$e,2))),Ke=st,$e=Dt}var ti=oe.length-3;oe[2]=1,qe(oe,0,ti,fe),oe[ti+2]=1,oe.size=Math.abs(dt),oe.start=0,oe.end=oe.size}function Se(je,oe,fe,Ve){for(var Ke=0;Ke<je.length;Ke++){var $e=[];Xe(je[Ke],$e,fe,Ve),oe.push($e)}}function At(je){return je/360+.5}function Et(je){var oe=Math.sin(je*Math.PI/180),fe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return fe<0?0:fe>1?1:fe}function wt(je,oe,fe,Ve,Ke,$e,dt,bt){if(Ve/=oe,$e>=(fe/=oe)&&dt<Ve)return je;if(dt<fe||$e>=Ve)return null;for(var st=[],Dt=0;Dt<je.length;Dt++){var ti=je[Dt],Vt=ti.geometry,ni=ti.type,Ui=Ke===0?ti.minX:ti.minY,Vi=Ke===0?ti.maxX:ti.maxY;if(Ui>=fe&&Vi<Ve)st.push(ti);else if(!(Vi<fe||Ui>=Ve)){var ki=[];if(ni==="Point"||ni==="MultiPoint")Kt(Vt,ki,fe,Ve,Ke);else if(ni==="LineString")$t(Vt,ki,fe,Ve,Ke,!1,bt.lineMetrics);else if(ni==="MultiLineString")ri(Vt,ki,fe,Ve,Ke,!1);else if(ni==="Polygon")ri(Vt,ki,fe,Ve,Ke,!0);else if(ni==="MultiPolygon")for(var Fi=0;Fi<Vt.length;Fi++){var Wi=[];ri(Vt[Fi],Wi,fe,Ve,Ke,!0),Wi.length&&ki.push(Wi)}if(ki.length){if(bt.lineMetrics&&ni==="LineString"){for(Fi=0;Fi<ki.length;Fi++)st.push(lt(ti.id,ni,ki[Fi],ti.tags));continue}ni!=="LineString"&&ni!=="MultiLineString"||(ki.length===1?(ni="LineString",ki=ki[0]):ni="MultiLineString"),ni!=="Point"&&ni!=="MultiPoint"||(ni=ki.length===3?"Point":"MultiPoint"),st.push(lt(ti.id,ni,ki,ti.tags))}}}return st.length?st:null}function Kt(je,oe,fe,Ve,Ke){for(var $e=0;$e<je.length;$e+=3){var dt=je[$e+Ke];dt>=fe&&dt<=Ve&&(oe.push(je[$e]),oe.push(je[$e+1]),oe.push(je[$e+2]))}}function $t(je,oe,fe,Ve,Ke,$e,dt){for(var bt,st,Dt=yt(je),ti=Ke===0?xi:Li,Vt=je.start,ni=0;ni<je.length-3;ni+=3){var Ui=je[ni],Vi=je[ni+1],ki=je[ni+2],Fi=je[ni+3],Wi=je[ni+4],Ar=Ke===0?Ui:Vi,Pr=Ke===0?Fi:Wi,kr=!1;dt&&(bt=Math.sqrt(Math.pow(Ui-Fi,2)+Math.pow(Vi-Wi,2))),Ar<fe?Pr>fe&&(st=ti(Dt,Ui,Vi,Fi,Wi,fe),dt&&(Dt.start=Vt+bt*st)):Ar>Ve?Pr<Ve&&(st=ti(Dt,Ui,Vi,Fi,Wi,Ve),dt&&(Dt.start=Vt+bt*st)):mi(Dt,Ui,Vi,ki),Pr<fe&&Ar>=fe&&(st=ti(Dt,Ui,Vi,Fi,Wi,fe),kr=!0),Pr>Ve&&Ar<=Ve&&(st=ti(Dt,Ui,Vi,Fi,Wi,Ve),kr=!0),!$e&&kr&&(dt&&(Dt.end=Vt+bt*st),oe.push(Dt),Dt=yt(je)),dt&&(Vt+=bt)}var Sr=je.length-3;Ui=je[Sr],Vi=je[Sr+1],ki=je[Sr+2],(Ar=Ke===0?Ui:Vi)>=fe&&Ar<=Ve&&mi(Dt,Ui,Vi,ki),Sr=Dt.length-3,$e&&Sr>=3&&(Dt[Sr]!==Dt[0]||Dt[Sr+1]!==Dt[1])&&mi(Dt,Dt[0],Dt[1],Dt[2]),Dt.length&&oe.push(Dt)}function yt(je){var oe=[];return oe.size=je.size,oe.start=je.start,oe.end=je.end,oe}function ri(je,oe,fe,Ve,Ke,$e){for(var dt=0;dt<je.length;dt++)$t(je[dt],oe,fe,Ve,Ke,$e,!1)}function mi(je,oe,fe,Ve){je.push(oe),je.push(fe),je.push(Ve)}function xi(je,oe,fe,Ve,Ke,$e){var dt=($e-oe)/(Ve-oe);return je.push($e),je.push(fe+(Ke-fe)*dt),je.push(1),dt}function Li(je,oe,fe,Ve,Ke,$e){var dt=($e-fe)/(Ke-fe);return je.push(oe+(Ve-oe)*dt),je.push($e),je.push(1),dt}function Ue(je,oe){for(var fe=[],Ve=0;Ve<je.length;Ve++){var Ke,$e=je[Ve],dt=$e.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")Ke=ge($e.geometry,oe);else if(dt==="MultiLineString"||dt==="Polygon"){Ke=[];for(var bt=0;bt<$e.geometry.length;bt++)Ke.push(ge($e.geometry[bt],oe))}else if(dt==="MultiPolygon")for(Ke=[],bt=0;bt<$e.geometry.length;bt++){for(var st=[],Dt=0;Dt<$e.geometry[bt].length;Dt++)st.push(ge($e.geometry[bt][Dt],oe));Ke.push(st)}fe.push(lt($e.id,dt,Ke,$e.tags))}return fe}function ge(je,oe){var fe=[];fe.size=je.size,je.start!==void 0&&(fe.start=je.start,fe.end=je.end);for(var Ve=0;Ve<je.length;Ve+=3)fe.push(je[Ve]+oe,je[Ve+1],je[Ve+2]);return fe}function Rt(je,oe){if(je.transformed)return je;var fe,Ve,Ke,$e=1<<je.z,dt=je.x,bt=je.y;for(fe=0;fe<je.features.length;fe++){var st=je.features[fe],Dt=st.geometry,ti=st.type;if(st.geometry=[],ti===1)for(Ve=0;Ve<Dt.length;Ve+=2)st.geometry.push(si(Dt[Ve],Dt[Ve+1],oe,$e,dt,bt));else for(Ve=0;Ve<Dt.length;Ve++){var Vt=[];for(Ke=0;Ke<Dt[Ve].length;Ke+=2)Vt.push(si(Dt[Ve][Ke],Dt[Ve][Ke+1],oe,$e,dt,bt));st.geometry.push(Vt)}}return je.transformed=!0,je}function si(je,oe,fe,Ve,Ke,$e){return[Math.round(fe*(je*Ve-Ke)),Math.round(fe*(oe*Ve-$e))]}function jt(je,oe,fe,Ve,Ke){for(var $e=oe===Ke.maxZoom?0:Ke.tolerance/((1<<oe)*Ke.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:fe,y:Ve,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},bt=0;bt<je.length;bt++){dt.numFeatures++,Ii(dt,je[bt],$e,Ke);var st=je[bt].minX,Dt=je[bt].minY,ti=je[bt].maxX,Vt=je[bt].maxY;st<dt.minX&&(dt.minX=st),Dt<dt.minY&&(dt.minY=Dt),ti>dt.maxX&&(dt.maxX=ti),Vt>dt.maxY&&(dt.maxY=Vt)}return dt}function Ii(je,oe,fe,Ve){var Ke=oe.geometry,$e=oe.type,dt=[];if($e==="Point"||$e==="MultiPoint")for(var bt=0;bt<Ke.length;bt+=3)dt.push(Ke[bt]),dt.push(Ke[bt+1]),je.numPoints++,je.numSimplified++;else if($e==="LineString")wi(dt,Ke,je,fe,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(bt=0;bt<Ke.length;bt++)wi(dt,Ke[bt],je,fe,$e==="Polygon",bt===0);else if($e==="MultiPolygon")for(var st=0;st<Ke.length;st++){var Dt=Ke[st];for(bt=0;bt<Dt.length;bt++)wi(dt,Dt[bt],je,fe,!0,bt===0)}if(dt.length){var ti=oe.tags||null;if($e==="LineString"&&Ve.lineMetrics){for(var Vt in ti={},oe.tags)ti[Vt]=oe.tags[Vt];ti.mapbox_clip_start=Ke.start/Ke.size,ti.mapbox_clip_end=Ke.end/Ke.size}var ni={geometry:dt,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:ti};oe.id!==null&&(ni.id=oe.id),je.features.push(ni)}}function wi(je,oe,fe,Ve,Ke,$e){var dt=Ve*Ve;if(Ve>0&&oe.size<(Ke?dt:Ve))fe.numPoints+=oe.length/3;else{for(var bt=[],st=0;st<oe.length;st+=3)(Ve===0||oe[st+2]>dt)&&(fe.numSimplified++,bt.push(oe[st]),bt.push(oe[st+1])),fe.numPoints++;Ke&&function(Dt,ti){for(var Vt=0,ni=0,Ui=Dt.length,Vi=Ui-2;ni<Ui;Vi=ni,ni+=2)Vt+=(Dt[ni]-Dt[Vi])*(Dt[ni+1]+Dt[Vi+1]);if(Vt>0===ti)for(ni=0,Ui=Dt.length;ni<Ui/2;ni+=2){var ki=Dt[ni],Fi=Dt[ni+1];Dt[ni]=Dt[Ui-2-ni],Dt[ni+1]=Dt[Ui-1-ni],Dt[Ui-2-ni]=ki,Dt[Ui-1-ni]=Fi}}(bt,$e),je.push(bt)}}function or(je,oe){var fe=(oe=this.options=function(Ke,$e){for(var dt in $e)Ke[dt]=$e[dt];return Ke}(Object.create(this.options),oe)).debug;if(fe&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ve=function(Ke,$e){var dt=[];if(Ke.type==="FeatureCollection")for(var bt=0;bt<Ke.features.length;bt++)ht(dt,Ke.features[bt],$e,bt);else ht(dt,Ke.type==="Feature"?Ke:{geometry:Ke},$e);return dt}(je,oe);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ve=function(Ke,$e){var dt=$e.buffer/$e.extent,bt=Ke,st=wt(Ke,1,-1-dt,dt,0,-1,2,$e),Dt=wt(Ke,1,1-dt,2+dt,0,-1,2,$e);return(st||Dt)&&(bt=wt(Ke,1,-dt,1+dt,0,-1,2,$e)||[],st&&(bt=Ue(st,1).concat(bt)),Dt&&(bt=bt.concat(Ue(Dt,-1)))),bt}(Ve,oe),Ve.length&&this.splitTile(Ve,0,0,0),fe&&(Ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ti(je,oe,fe){return 32*((1<<je)*fe+oe)+je}function Yi(je,oe){const fe=je.tileID.canonical;if(!this._geoJSONIndex)return oe(null,null);const Ve=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Ve)return oe(null,null);const Ke=new class{constructor(dt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=dt.length,this._features=dt}feature(dt){return new class{constructor(bt){this._feature=bt,this.extent=t.EXTENT,this.type=bt.type,this.properties=bt.tags,"id"in bt&&!isNaN(bt.id)&&(this.id=parseInt(bt.id,10))}loadGeometry(){if(this._feature.type===1){const bt=[];for(const st of this._feature.geometry)bt.push([new t.Point(st[0],st[1])]);return bt}{const bt=[];for(const st of this._feature.geometry){const Dt=[];for(const ti of st)Dt.push(new t.Point(ti[0],ti[1]));bt.push(Dt)}return bt}}toGeoJSON(bt,st,Dt){return w.call(this,bt,st,Dt)}}(this._features[dt])}}(Ve.features);let $e=ft(Ke);$e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),oe(null,{vectorTile:Ke,rawData:$e.buffer})}or.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},or.prototype.splitTile=function(je,oe,fe,Ve,Ke,$e,dt){for(var bt=[je,oe,fe,Ve],st=this.options,Dt=st.debug;bt.length;){Ve=bt.pop(),fe=bt.pop(),oe=bt.pop(),je=bt.pop();var ti=1<<oe,Vt=Ti(oe,fe,Ve),ni=this.tiles[Vt];if(!ni&&(Dt>1&&console.time("creation"),ni=this.tiles[Vt]=jt(je,oe,fe,Ve,st),this.tileCoords.push({z:oe,x:fe,y:Ve}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,fe,Ve,ni.numFeatures,ni.numPoints,ni.numSimplified),console.timeEnd("creation"));var Ui="z"+oe;this.stats[Ui]=(this.stats[Ui]||0)+1,this.total++}if(ni.source=je,Ke){if(oe===st.maxZoom||oe===Ke)continue;var Vi=1<<Ke-oe;if(fe!==Math.floor($e/Vi)||Ve!==Math.floor(dt/Vi))continue}else if(oe===st.indexMaxZoom||ni.numPoints<=st.indexMaxPoints)continue;if(ni.source=null,je.length!==0){Dt>1&&console.time("clipping");var ki,Fi,Wi,Ar,Pr,kr,Sr=.5*st.buffer/st.extent,un=.5-Sr,Or=.5+Sr,Fr=1+Sr;ki=Fi=Wi=Ar=null,Pr=wt(je,ti,fe-Sr,fe+Or,0,ni.minX,ni.maxX,st),kr=wt(je,ti,fe+un,fe+Fr,0,ni.minX,ni.maxX,st),je=null,Pr&&(ki=wt(Pr,ti,Ve-Sr,Ve+Or,1,ni.minY,ni.maxY,st),Fi=wt(Pr,ti,Ve+un,Ve+Fr,1,ni.minY,ni.maxY,st),Pr=null),kr&&(Wi=wt(kr,ti,Ve-Sr,Ve+Or,1,ni.minY,ni.maxY,st),Ar=wt(kr,ti,Ve+un,Ve+Fr,1,ni.minY,ni.maxY,st),kr=null),Dt>1&&console.timeEnd("clipping"),bt.push(ki||[],oe+1,2*fe,2*Ve),bt.push(Fi||[],oe+1,2*fe,2*Ve+1),bt.push(Wi||[],oe+1,2*fe+1,2*Ve),bt.push(Ar||[],oe+1,2*fe+1,2*Ve+1)}}},or.prototype.getTile=function(je,oe,fe){var Ve=this.options,Ke=Ve.extent,$e=Ve.debug;if(je<0||je>24)return null;var dt=1<<je,bt=Ti(je,oe=(oe%dt+dt)%dt,fe);if(this.tiles[bt])return Rt(this.tiles[bt],Ke);$e>1&&console.log("drilling down to z%d-%d-%d",je,oe,fe);for(var st,Dt=je,ti=oe,Vt=fe;!st&&Dt>0;)Dt--,ti=Math.floor(ti/2),Vt=Math.floor(Vt/2),st=this.tiles[Ti(Dt,ti,Vt)];return st&&st.source?($e>1&&console.log("found parent tile z%d-%d-%d",Dt,ti,Vt),$e>1&&console.time("drilling down"),this.splitTile(st.source,Dt,ti,Vt,je,oe,fe),$e>1&&console.timeEnd("drilling down"),this.tiles[bt]?Rt(this.tiles[bt],Ke):null):null};class qr extends t.VectorTileWorkerSource{constructor(oe,fe,Ve,Ke,$e){super(oe,fe,Ve,Ke,Yi),$e&&(this.loadGeoJSON=$e)}loadData(oe,fe){const Ve=oe&&oe.request,Ke=Ve&&Ve.collectResourceTiming;this.loadGeoJSON(oe,($e,dt)=>{if($e||!dt)return fe($e);if(typeof dt!="object")return fe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{_(dt,!0);try{if(oe.filter){const st=t.createExpression(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(st.result==="error")throw new Error(st.value.map(ti=>`${ti.key}: ${ti.message}`).join(", "));dt={type:"FeatureCollection",features:dt.features.filter(ti=>st.value.evaluate({zoom:0},ti))}}this._geoJSONIndex=oe.cluster?new ce(function({superclusterOptions:st,clusterProperties:Dt}){if(!Dt||!st)return st;const ti={},Vt={},ni={accumulated:null,zoom:0},Ui={properties:null},Vi=Object.keys(Dt);for(const ki of Vi){const[Fi,Wi]=Dt[ki],Ar=t.createExpression(Wi),Pr=t.createExpression(typeof Fi=="string"?[Fi,["accumulated"],["get",ki]]:Fi);ti[ki]=Ar.value,Vt[ki]=Pr.value}return st.map=ki=>{Ui.properties=ki;const Fi={};for(const Wi of Vi)Fi[Wi]=ti[Wi].evaluate(ni,Ui);return Fi},st.reduce=(ki,Fi)=>{Ui.properties=Fi;for(const Wi of Vi)ni.accumulated=ki[Wi],ki[Wi]=Vt[Wi].evaluate(ni,Ui)},st}(oe)).load(dt.features):function(st,Dt){return new or(st,Dt)}(dt,oe.geojsonVtOptions)}catch(st){return fe(st)}this.loaded={};const bt={};if(Ke){const st=t.getPerformanceMeasurement(Ve);st&&(bt.resourceTiming={},bt.resourceTiming[oe.source]=JSON.parse(JSON.stringify(st)))}fe(null,bt)}})}reloadTile(oe,fe){const Ve=this.loaded;return Ve&&Ve[oe.uid]?super.reloadTile(oe,fe):this.loadTile(oe,fe)}loadGeoJSON(oe,fe){if(oe.request)t.getJSON(oe.request,fe);else{if(typeof oe.data!="string")return fe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));try{return fe(null,JSON.parse(oe.data))}catch{return fe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(oe,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Ve){fe(Ve)}}getClusterChildren(oe,fe){try{fe(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Ve){fe(Ve)}}getClusterLeaves(oe,fe){try{fe(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Ve){fe(Ve)}}}class Hi{constructor(oe){this.self=oe,this.actor=new t.Actor(oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:qr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(fe,Ve)=>{if(this.workerSourceTypes[fe])throw new Error(`Worker source with name "${fe}" already registered.`);this.workerSourceTypes[fe]=Ve},this.self.registerRTLTextPlugin=fe=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=fe.applyArabicShaping,t.plugin.processBidirectionalText=fe.processBidirectionalText,t.plugin.processStyledBidirectionalText=fe.processStyledBidirectionalText}}clearCaches(oe,fe,Ve){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],delete this.demWorkerSources[oe],Ve()}checkIfReady(oe,fe,Ve){Ve()}setReferrer(oe,fe){this.referrer=fe}spriteLoaded(oe,fe){this.isSpriteLoaded[oe]=fe;for(const Ve in this.workerSources[oe]){const Ke=this.workerSources[oe][Ve];for(const $e in Ke)Ke[$e]instanceof t.VectorTileWorkerSource&&(Ke[$e].isSpriteLoaded=fe,Ke[$e].fire(new t.Event("isSpriteLoaded")))}}setImages(oe,fe,Ve){this.availableImages[oe]=fe;for(const Ke in this.workerSources[oe]){const $e=this.workerSources[oe][Ke];for(const dt in $e)$e[dt].availableImages=fe}Ve()}enableTerrain(oe,fe,Ve){this.terrain=fe,Ve()}setProjection(oe,fe){this.projections[oe]=t.getProjection(fe)}setLayers(oe,fe,Ve){this.getLayerIndex(oe).replace(fe),Ve()}updateLayers(oe,fe,Ve){this.getLayerIndex(oe).update(fe.layers,fe.removedIds),Ve()}loadTile(oe,fe,Ve){const Ke=this.enableTerrain?t.extend({enableTerrain:this.terrain},fe):fe;Ke.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,fe.type,fe.source).loadTile(Ke,Ve)}loadDEMTile(oe,fe,Ve){const Ke=this.enableTerrain?t.extend({buildQuadTree:this.terrain},fe):fe;this.getDEMWorkerSource(oe,fe.source).loadTile(Ke,Ve)}reloadTile(oe,fe,Ve){const Ke=this.enableTerrain?t.extend({enableTerrain:this.terrain},fe):fe;Ke.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,fe.type,fe.source).reloadTile(Ke,Ve)}abortTile(oe,fe,Ve){this.getWorkerSource(oe,fe.type,fe.source).abortTile(fe,Ve)}removeTile(oe,fe,Ve){this.getWorkerSource(oe,fe.type,fe.source).removeTile(fe,Ve)}removeSource(oe,fe,Ve){if(!this.workerSources[oe]||!this.workerSources[oe][fe.type]||!this.workerSources[oe][fe.type][fe.source])return;const Ke=this.workerSources[oe][fe.type][fe.source];delete this.workerSources[oe][fe.type][fe.source],Ke.removeSource!==void 0?Ke.removeSource(fe,Ve):Ve()}loadWorkerSource(oe,fe,Ve){try{this.self.importScripts(fe.url),Ve()}catch(Ke){Ve(Ke.toString())}}syncRTLPluginState(oe,fe,Ve){try{t.plugin.setState(fe);const Ke=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&Ke!=null){this.self.importScripts(Ke);const $e=t.plugin.isParsed();Ve($e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ke}`),$e)}}catch(Ke){Ve(Ke.toString())}}getAvailableImages(oe){let fe=this.availableImages[oe];return fe||(fe=[]),fe}getLayerIndex(oe){let fe=this.layerIndexes[oe];return fe||(fe=this.layerIndexes[oe]=new x),fe}getWorkerSource(oe,fe,Ve){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][fe]||(this.workerSources[oe][fe]={}),!this.workerSources[oe][fe][Ve]){const Ke={send:($e,dt,bt,st,Dt,ti)=>{this.actor.send($e,dt,bt,oe,Dt,ti)},scheduler:this.actor.scheduler};this.workerSources[oe][fe][Ve]=new this.workerSourceTypes[fe](Ke,this.getLayerIndex(oe),this.getAvailableImages(oe),this.isSpriteLoaded[oe])}return this.workerSources[oe][fe][Ve]}getDEMWorkerSource(oe,fe){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][fe]||(this.demWorkerSources[oe][fe]=new d),this.demWorkerSources[oe][fe]}enforceCacheSizeLimit(oe,fe){t.enforceCacheSizeLimit(fe)}getWorkerPerformanceMetrics(oe,fe,Ve){Ve(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Hi(self)),Hi}),z(["./shared"],function(t){function l(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let o=0;o<h.length;o++)if(!l(h[o],r[o]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(const o in h)if(!l(h[o],r[o]))return!1;return!0}return h===r}var v=x;function x(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,b,S=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(S);try{b=new Worker(I),u=!0}catch{u=!1}return b&&b.terminate(),URL.revokeObjectURL(I),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var b=u.getContext("2d");if(!b)return!1;var S=b.getImageData(0,0,1,1);return S&&S.width===u.width}()?(d[o=r&&r.failIfMajorPerformanceCaveat]===void 0&&(d[o]=function(u){var b,S=function(I){var F=document.createElement("canvas"),N=Object.create(x.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=I,F.getContext("webgl",N)||F.getContext("experimental-webgl",N)}(u);if(!S)return!1;try{b=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!b||S.isContextLost())&&(S.shaderSource(b,"void main() {}"),S.compileShader(b),S.getShaderParameter(b,S.COMPILE_STATUS)===!0)}(o)),d[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(h)}var d={};function m(h,r,o){const u=t.window.document.createElement(h);return r!==void 0&&(u.className=r),o&&o.appendChild(u),u}function c(h,r,o){const u=t.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const b of Object.keys(r))u.setAttributeNS(null,b,r[b]);return o&&o.appendChild(u),u}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _=t.window.document&&t.window.document.documentElement.style,w=_&&_.userSelect!==void 0?"userSelect":"WebkitUserSelect";let g;function C(){_&&w&&(g=_[w],_[w]="none")}function L(){_&&w&&(_[w]=g)}function B(h){h.preventDefault(),h.stopPropagation(),t.window.removeEventListener("click",B,!0)}function q(){t.window.addEventListener("click",B,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",B,!0)},0)}function K(h,r){const o=h.getBoundingClientRect();return le(h,o,r)}function se(h,r){const o=h.getBoundingClientRect(),u=[];for(let b=0;b<r.length;b++)u.push(le(h,o,r[b]));return u}function he(h){return t.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function le(h,r,o){const u=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new t.Point((o.clientX-r.left)*u,(o.clientY-r.top)*u)}function ve(h,r){var o=r[0],u=r[1],b=r[2],S=r[3],I=o*S-b*u;return I?(h[0]=S*(I=1/I),h[1]=-u*I,h[2]=-b*I,h[3]=o*I,h):null}function ot(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class _e extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:o,callback:u}of this.requestors)this._notify(o,u);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,o){this._validate(r,o)&&(this.images[r]=o)}_validate(r,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new t.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),u=!1),u}_validateStretch(r,o){if(!r)return!0;let u=0;for(const b of r){if(b[0]<u||b[1]<b[0]||o<b[1])return!1;u=b[1]}return!0}_validateContent(r,o){return!(r&&(r.length!==4||r[0]<0||o.data.width<r[0]||r[1]<0||o.data.height<r[1]||r[2]<0||o.data.width<r[2]||r[3]<0||o.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,o){o.version=this.images[r].version+1,this.images[r]=o,this.updatedImages[r]=!0}removeImage(r){const o=this.images[r];delete this.images[r],delete this.patterns[r],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,o){let u=!0;if(!this.isLoaded())for(const b of r)this.images[b]||(u=!1);this.isLoaded()||u?this._notify(r,o):this.requestors.push({ids:r,callback:o})}_notify(r,o){const u={};for(const b of r){this.images[b]||this.fire(new t.Event("styleimagemissing",{id:b}));const S=this.images[b];S?u[b]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:t.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,u)}getPixelSize(){const{width:r,height:o}=this.atlasImage;return{width:r,height:o}}getPattern(r){const o=this.patterns[r],u=this.getImage(r);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const b={w:u.data.width+2,h:u.data.height+2,x:0,y:0},S=new t.ImagePosition(b,u);this.patterns[r]={bin:b,position:S}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const o=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(r,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const S in this.patterns)r.push(this.patterns[S].bin);const{w:o,h:u}=t.potpack(r),b=this.atlasImage;b.resize({width:o||1,height:u||1});for(const S in this.patterns){const{bin:I}=this.patterns[S],F=I.x+1,N=I.y+1,H=this.images[S].data,X=H.width,ee=H.height;t.RGBAImage.copy(H,b,{x:0,y:0},{x:F,y:N},{width:X,height:ee}),t.RGBAImage.copy(H,b,{x:0,y:ee-1},{x:F,y:N-1},{width:X,height:1}),t.RGBAImage.copy(H,b,{x:0,y:0},{x:F,y:N+ee},{width:X,height:1}),t.RGBAImage.copy(H,b,{x:X-1,y:0},{x:F-1,y:N},{width:1,height:ee}),t.RGBAImage.copy(H,b,{x:0,y:0},{x:F+X,y:N},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const o of r){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.images[o];ot(u)&&this.updateImage(o,u)}}}const pe=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(h,r){return function([o,u,b]){const S=t.degToRad(u+90),I=t.degToRad(b);return{x:o*Math.cos(S)*Math.sin(I),y:o*Math.sin(S)*Math.sin(I),z:o*Math.cos(I),azimuthal:u,polar:b}}(h.expression.evaluate(r))}interpolate(h,r,o){return{x:t.number(h.x,r.x,o),y:t.number(h.y,r.y,o),z:t.number(h.z,r.z,o),azimuthal:t.number(h.azimuthal,r.azimuthal,o),polar:t.number(h.polar,r.polar,o)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)});class ze extends t.Evented{constructor(r){super(),this._transitionable=new t.Transitionable(pe),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,o={}){if(!this._validate(t.validateLight,r,o))for(const u in r){const b=r[u];t.endsWith(u,"-transition")?this._transitionable.setTransition(u.slice(0,-11),b):this._transitionable.setValue(u,b)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,o,u){return(!u||u.validate!==!1)&&t.emitValidationErrors(this,r.call(t.validateStyle,t.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const De=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)});let at=class extends t.Evented{constructor(h,r){super(),this._transitionable=new t.Transitionable(De),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(h){for(const r in h){const o=h[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),o):this._transitionable.setValue(r,o)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function ft(h,r,o,u){const b=t.smoothstep(45,65,o),[S,I]=xt(h,u),F=t.length(r);let N=1-Math.min(1,Math.exp((F-S)/(I-S)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*b*h.alpha}function xt(h,r){const o=.5/Math.tan(.5*r);return[h.range[0]+o,h.range[1]+o]}const He=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"high-color":new t.DataConstantProperty(t.spec.fog["high-color"]),"space-color":new t.DataConstantProperty(t.spec.fog["space-color"]),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"]),"star-intensity":new t.DataConstantProperty(t.spec.fog["star-intensity"])});class ae extends t.Evented{constructor(r,o){super(),this._transitionable=new t.Transitionable(He),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const r=this._transform,o=r.projection.name==="globe",u=t.globeToMercatorTransition(r.zoom),b=this.properties.get("range"),S=[.5,3];return{range:o?[t.number(S[0],b[0],u),t.number(S[1],b[1],u)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,o={}){if(!this._validate(t.validateFog,r,o)){for(const u of Object.keys(t.spec.fog))r&&r[u]===void 0&&(r[u]=t.spec.fog[u].default);for(const u in r){const b=r[u];t.endsWith(u,"-transition")?this._transitionable.setTransition(u.slice(0,-11),b):this._transitionable.setValue(u,b)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.smoothstep(45,65,r))*o.a}getOpacityAtLatLng(r,o){return this._transform.projection.supportsFog?function(u,b,S){const I=t.MercatorCoordinate.fromLngLat(b),F=S.elevation?S.elevation.getAtPointOrZero(I):0,N=[I.x,I.y,F];return t.transformMat4(N,N,S.mercatorFogMatrix),ft(u,N,S.pitch,S._fov)}(this.state,r,o):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?xt(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,o,u){return(!u||u.validate!==!1)&&t.emitValidationErrors(this,r.call(t.validateStyle,t.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class Te{constructor(r,o){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const u=this.workerPool.acquire(this.id);for(let b=0;b<u.length;b++){const S=new Te.Actor(u[b],o,this.id);S.name=`Worker ${b}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,o,u){t.asyncAll(this.actors,(b,S)=>{b.send(r,o,S)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Oe(h,r,o){return r*(t.EXTENT/(h.tileSize*Math.pow(2,o-h.tileID.overscaledZ)))}Te.Actor=t.Actor;class Y{constructor(r,o,u,b){this.screenBounds=r,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(r,o){let u,b;if(r instanceof t.Point||typeof r[0]=="number"){const S=t.Point.convert(r);u=[S],b=o.isPointAboveHorizon(S)}else{const S=t.Point.convert(r[0]),I=t.Point.convert(r[1]);u=[S,I],b=t.polygonizeBounds(S,I).every(F=>o.isPointAboveHorizon(F))}return new Y(u,o.getCameraPoint(),b,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return t.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],b=t.polygonizeBounds(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?b[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(b[3]=this.cameraPoint)),t.bufferConvexPolygon(b,r)}bufferedCameraGeometryGlobe(r){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],b=t.polygonizeBounds(o,u,r),S=this.cameraPoint.clone();switch(3*((S.y>o.y)+(S.y>u.y))+((S.x>o.x)+(S.x>u.x))){case 0:b[0]=S,b[4]=S.clone();break;case 1:b.splice(1,0,S);break;case 2:b[1]=S;break;case 3:b.splice(4,0,S);break;case 5:b.splice(2,0,S);break;case 6:b[3]=S;break;case 7:b.splice(3,0,S);break;case 8:b[2]=S}return b}containsTile(r,o,u,b=0){const S=r.queryPadding/o._pixelsPerMercatorPixel+1,I=u?this._bufferedCameraMercator(S,o):this._bufferedScreenMercator(S,o);let F=r.tileID.wrap+(I.unwrapped?b:0);const N=I.polygon.map(Le=>t.getTilePoint(r.tileTransform,Le,F));if(!t.polygonIntersectsBox(N,0,0,t.EXTENT,t.EXTENT))return;F=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const H=this.screenGeometryMercator.polygon.map(Le=>t.getTileVec3(r.tileTransform,Le,F)),X=H.map(Le=>new t.Point(Le[0],Le[1])),ee=o.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),me=t.getTileVec3(r.tileTransform,ee,F),xe=H.map(Le=>{const ie=t.sub(Le,Le,me);return t.normalize(ie,ie),new t.Ray(me,ie)}),Ee=Oe(r,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:xe,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(Pe=t.getBounds(N),Pe.min.x=t.clamp(Pe.min.x,0,t.EXTENT),Pe.min.y=t.clamp(Pe.min.y,0,t.EXTENT),Pe.max.x=t.clamp(Pe.max.x,0,t.EXTENT),Pe.max.y=t.clamp(Pe.max.y,0,t.EXTENT),Pe),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Ee};var Pe}_bufferedScreenMercator(r,o){const u=te(r);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let b;return b=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),o):{polygon:this.bufferedScreenGeometry(r).map(S=>o.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[u]=b,b}}_bufferedCameraMercator(r,o){const u=te(r);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let b;return b=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),o):{polygon:this.bufferedCameraGeometry(r).map(S=>o.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[u]=b,b}}_projectAndResample(r,o){const u=function(S,I){const F=t.multiply([],I.pixelMatrix,I.globeMatrix),N=[0,-t.GLOBE_RADIUS,0,1],H=[0,t.GLOBE_RADIUS,0,1],X=[0,0,0,1];t.transformMat4$1(N,N,F),t.transformMat4$1(H,H,F),t.transformMat4$1(X,X,F);const ee=new t.Point(N[0]/N[3],N[1]/N[3]),me=new t.Point(H[0]/H[3],H[1]/H[3]),xe=t.polygonContainsPoint(S,ee)&&N[3]<X[3],Ee=t.polygonContainsPoint(S,me)&&H[3]<X[3];if(!xe&&!Ee)return null;const Pe=function(tt,_t,ut){for(let Ct=1;Ct<tt.length;Ct++){const ei=re(_t.pointCoordinate3D(tt[Ct-1]).x),Tt=re(_t.pointCoordinate3D(tt[Ct]).x);if(ut<0){if(ei<Tt)return{idx:Ct,t:-ei/(Tt-1-ei)}}else if(Tt<ei)return{idx:Ct,t:(1-ei)/(Tt+1-ei)}}return null}(S,I,xe?-1:1);if(!Pe)return null;const{idx:Le,t:ie}=Pe;let Ce=Le>1?ce(S.slice(0,Le),I):[],Re=Le<S.length?ce(S.slice(Le),I):[];Ce=Ce.map(tt=>new t.Point(re(tt.x),tt.y)),Re=Re.map(tt=>new t.Point(re(tt.x),tt.y));const Ne=[...Ce];Ne.length===0&&Ne.push(Re[Re.length-1]);const et=t.number(Ne[Ne.length-1].y,(Re.length===0?Ce[0]:Re[0]).y,ie);let Qe;return Qe=xe?[new t.Point(0,et),new t.Point(0,0),new t.Point(1,0),new t.Point(1,et)]:[new t.Point(1,et),new t.Point(1,1),new t.Point(0,1),new t.Point(0,et)],Ne.push(...Qe),Re.length===0?Ne.push(Ce[0]):Ne.push(...Re),{polygon:Ne.map(tt=>new t.MercatorCoordinate(tt.x,tt.y)),unwrapped:!1}}(r,o);if(u)return u;const b=function(S,I){let F=!1,N=-1/0,H=0;for(let ee=0;ee<S.length-1;ee++)S[ee].x>N&&(N=S[ee].x,H=ee);for(let ee=0;ee<S.length-1;ee++){const me=(H+ee)%(S.length-1),xe=S[me],Ee=S[me+1];Math.abs(xe.x-Ee.x)>.5&&(xe.x<Ee.x?(xe.x+=1,me===0&&(S[S.length-1].x+=1)):(Ee.x+=1,me+1===S.length-1&&(S[0].x+=1)),F=!0)}const X=t.mercatorXfromLng(I.center.lng);return F&&X<Math.abs(X-1)&&S.forEach(ee=>{ee.x-=1}),{polygon:S,unwrapped:F}}(ce(r,o).map(S=>new t.Point(re(S.x),S.y)),o);return{polygon:b.polygon.map(S=>new t.MercatorCoordinate(S.x,S.y)),unwrapped:b.unwrapped}}}function ce(h,r){return t.resample(h,o=>{const u=r.pointCoordinate3D(o);o.x=u.x,o.y=u.y},1/256)}function re(h){return h<0?1+h%1:h%1}function te(h){return 100*h|0}function we(h,r,o,u,b){const S=function(I,F){if(I)return b(I);if(F){h.url&&F.tiles&&h.tiles&&delete h.tiles;const N=t.pick(t.extend(F,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(N.vectorLayers=F.vector_layers,N.vectorLayerIds=N.vectorLayers.map(H=>H.id)),N.tiles=r.canonicalizeTileset(N,h.url),b(null,N)}};return h.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,o,u),t.ResourceType.Source),S):t.exported.frame(()=>S(null,h))}class ke{constructor(r,o,u){this.bounds=t.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const o=Math.pow(2,r.z),u=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*o),b=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*o),S=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*o),I=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*o);return r.x>=u&&r.x<S&&r.y>=b&&r.y<I}}class We{constructor(r,o,u){this.context=r;const b=r.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gt{constructor(r,o,u,b){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=b,this.context=r;const S=r.gl;this.buffer=S.createBuffer(),r.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,o){for(let u=0;u<this.attributes.length;u++){const b=o.attributes[this.attributes[u].name];b!==void 0&&r.enableVertexAttribArray(b)}}setVertexAttribPointers(r,o,u){for(let b=0;b<this.attributes.length;b++){const S=this.attributes[b],I=o.attributes[S.name];I!==void 0&&r.vertexAttribPointer(I,S.components,r[qe[S.type]],!1,this.itemSize,S.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bt extends lt{getDefault(){return t.Color.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ht extends lt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ct extends lt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Xe extends lt{getDefault(){return[!0,!0,!0,!0]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Se extends lt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class At extends lt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Et extends lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const o=this.current;(r.func!==o.func||r.ref!==o.ref||r.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class wt extends lt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Kt extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=r,this.dirty=!1}}class $t extends lt{getDefault(){return[0,1]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class yt extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=r,this.dirty=!1}}class ri extends lt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class mi extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.BLEND):o.disable(o.BLEND),this.current=r,this.dirty=!1}}class xi extends lt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Li extends lt{getDefault(){return t.Color.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ue extends lt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ge extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=r,this.dirty=!1}}class Rt extends lt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class si extends lt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let jt,Ii=class extends lt{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class wi extends lt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class or extends lt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ti extends lt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Yi extends lt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class qr extends lt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Hi extends lt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class je extends lt{getDefault(){return null}set(r){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class oe extends lt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class fe extends lt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ve extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ke extends lt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class $e extends lt{constructor(r,o){super(r),this.context=r,this.parent=o}getDefault(){return null}}class dt extends $e{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class bt extends $e{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class st extends bt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Dt{constructor(r,o,u,b){this.context=r,this.width=o,this.height=u;const S=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new dt(r,S),b&&(this.depthAttachment=new bt(r,S))}destroy(){const r=this.context.gl,o=this.colorAttachment.get();if(o&&r.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&r.deleteRenderbuffer(u)}r.deleteFramebuffer(this.framebuffer)}}class ti{constructor(r,o=!1){if(this.gl=r,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const u=r;this.extVertexArrayObject={createVertexArrayOES:u.createVertexArray.bind(r),deleteVertexArrayOES:u.deleteVertexArray.bind(r),bindVertexArrayOES:u.bindVertexArray.bind(r)}}this.clearColor=new Bt(this),this.clearDepth=new ht(this),this.clearStencil=new ct(this),this.colorMask=new Xe(this),this.depthMask=new Se(this),this.stencilMask=new At(this),this.stencilFunc=new Et(this),this.stencilOp=new wt(this),this.stencilTest=new Kt(this),this.depthRange=new $t(this),this.depthTest=new yt(this),this.depthFunc=new ri(this),this.blend=new mi(this),this.blendFunc=new xi(this),this.blendColor=new Li(this),this.blendEquation=new Ue(this),this.cullFace=new ge(this),this.cullFaceSide=new Rt(this),this.frontFace=new si(this),this.program=new Ii(this),this.activeTexture=new wi(this),this.viewport=new or(this),this.bindFramebuffer=new Ti(this),this.bindRenderbuffer=new Yi(this),this.bindTexture=new qr(this),this.bindVertexBuffer=new Hi(this),this.bindElementBuffer=new je(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oe(this),this.pixelStoreUnpack=new fe(this),this.pixelStoreUnpackPremultiplyAlpha=new Ve(this),this.pixelStoreUnpackFlipY=new Ke(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,o){return new We(this,r,o)}createVertexBuffer(r,o,u){return new gt(this,r,o,u)}createRenderbuffer(r,o,u){const b=this.gl,S=b.createRenderbuffer();return this.bindRenderbuffer.set(S),b.renderbufferStorage(b.RENDERBUFFER,r,o,u),this.bindRenderbuffer.set(null),S}createFramebuffer(r,o,u){return new Dt(this,r,o,u)}clear({color:r,depth:o,stencil:u}){const b=this.gl;let S=0;r&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),b.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){l(r.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Vt extends t.Evented{constructor(r,o,u,b){if(super(),this.id=r,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(o,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(r){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=we(this._options,this.map._requestManager,o,u,(b,S)=>{this._tileJSONRequest=null,this._loaded=!0,b?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new t.ErrorEvent(b))):S&&(t.extend(this,S),S.bounds&&(this.tileBounds=new ke(S.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(b)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}loadTile(r,o){const u=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(u,t.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=o:r.request=r.actor.send("reloadTile",b,S.bind(this));else if(r.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",b,S.bind(this),void 0,!0);else{const I=t.loadVectorTile.call({deduped:this._deduped},b,(F,N)=>{F||!N?S.call(this,F):(b.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},r.actor&&r.actor.send("loadTile",b,S.bind(this),void 0,!0))},!0);r.request={cancel:I}}function S(I,F){return delete r.request,r.aborted?o(null):I&&I.status!==404?o(I):(F&&F.resourceTiming&&(r.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&r.setExpiryData(F),r.loadVectorData(F,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ni extends t.Evented{constructor(r,o,u,b){super(),this.id=r,this.dispatcher=u,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},o),t.extend(this,t.pick(o,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=we(this._options,this.map._requestManager,null,null,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new t.ErrorEvent(o)):u&&(t.extend(this,u),u.bounds&&(this.tileBounds=new ke(u.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(u.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(o)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,o){const u=t.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);r.request=t.getImage(this.map._requestManager.transformRequest(b,t.ResourceType.Tile),(S,I,F,N)=>(delete r.request,r.aborted?(r.state="unloaded",o(null)):S?(r.state="errored",o(S)):I?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:F,expires:N}),r.setTexture(I,this.map.painter),r.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(r,o,u){r.setTexture(o,u)}static unloadTileData(r,o){r.texture&&o.saveTileTexture(r.texture)}abortTile(r,o){r.request&&(r.request.cancel(),delete r.request),o()}unloadTile(r,o){r.texture&&this.map.painter.saveTileTexture(r.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ui(h,r,o,u,b,S,I,F){const N=[h,o,b,r,u,S,1,1,1],H=[I,F,1],X=t.adjoint([],N),[ee,me,xe]=t.transformMat3(H,H,t.transpose(X,X));return t.multiply$1(N,[ee,0,0,0,me,0,0,0,xe],N)}class Vi extends t.Evented{constructor(r,o,u,b){super(),this.id=r,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=o,this._dirty=!1}load(r,o){this._loaded=o||!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(u,b)=>{if(this._imageRequest=null,this._loaded=!0,u)this.fire(new t.ErrorEvent(u));else if(b){const{HTMLImageElement:S}=t.window;this.image=b instanceof S?t.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const o=r.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let b=1/0,S=1/0,I=-1/0,F=-1/0;for(const ee of u)b=Math.min(b,ee.x),S=Math.min(S,ee.y),I=Math.max(I,ee.x),F=Math.max(F,ee.y);const N=Math.max(I-b,F-S),H=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),X=Math.pow(2,H);return new t.CanonicalTileID(H,Math.floor((b+I)/2*X),Math.floor((S+F)/2*X))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const N in this.tiles){const H=this.tiles[N];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray)return;const o=t.tileTransform(this.tileID,this.map.transform.projection),[u,b,S,I]=this.coordinates.map(N=>{const H=o.projection.project(N[0],N[1]);return t.getTilePoint(o,H)._round()});this.perspectiveTransform=function(N,H,X,ee,me,xe,Ee,Pe,Le,ie){const Ce=Ui(0,0,N,0,0,H,N,H),Re=Ui(X,ee,me,xe,Ee,Pe,Le,ie);return t.multiply$1(Re,t.adjoint(Ce,Ce),Re),[Re[6]/Re[8]*N/t.EXTENT,Re[7]/Re[8]*H/t.EXTENT]}(this.width,this.height,u.x,u.y,b.x,b.y,I.x,I.y,S.x,S.y);const F=this._boundsArray=new t.StructArrayLayout4i8;F.emplaceBack(u.x,u.y,0,0),F.emplaceBack(b.x,b.y,t.EXTENT,0),F.emplaceBack(I.x,I.y,0,t.EXTENT),F.emplaceBack(S.x,S.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(F,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,o=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new t.Texture(r,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,o){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},o(null)):(r.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ki={vector:Vt,raster:ni,"raster-dem":class extends ni{constructor(h,r,o,u){super(h,r,o,u),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(b,S){b&&(h.state="errored",r(b)),S&&(h.dem=S,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=t.getImage(this.map._requestManager.transformRequest(o,t.ResourceType.Tile),function(b,S,I,F){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(b)h.state="errored",r(b);else if(S){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:I,expires:F});const N=t.window.ImageBitmap&&S instanceof t.window.ImageBitmap&&(jt==null&&(jt=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&typeof t.window.createImageBitmap=="function"),jt),H=1-(S.width-t.prevPowerOfTwo(S.width))/2;H<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const X=N?S:t.exported.getImageData(S,H),ee={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:X,encoding:this.encoding,padding:H};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",ee,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,o=Math.pow(2,r.z),u=(r.x-1+o)%o,b=r.x===0?h.wrap-1:h.wrap,S=(r.x+1+o)%o,I=r.x+1===o?h.wrap+1:h.wrap,F={};return F[new t.OverscaledTileID(h.overscaledZ,b,r.z,u,r.y).key]={backfilled:!1},F[new t.OverscaledTileID(h.overscaledZ,I,r.z,S,r.y).key]={backfilled:!1},r.y>0&&(F[new t.OverscaledTileID(h.overscaledZ,b,r.z,u,r.y-1).key]={backfilled:!1},F[new t.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},F[new t.OverscaledTileID(h.overscaledZ,I,r.z,S,r.y-1).key]={backfilled:!1}),r.y+1<o&&(F[new t.OverscaledTileID(h.overscaledZ,b,r.z,u,r.y+1).key]={backfilled:!1},F[new t.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},F[new t.OverscaledTileID(h.overscaledZ,I,r.z,S,r.y+1).key]={backfilled:!1}),F}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends t.Evented{constructor(h,r,o,u){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const b=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*b,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*b,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*b,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:o},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=t.extend({},this.workerOptions),r=this._data;typeof r=="string"?(h.request=this.map._requestManager.transformRequest(t.exported.resolveURL(r),t.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(o,u)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new t.ErrorEvent(o));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(b.resourceTiming=u.resourceTiming[this.id]),this.fire(new t.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const o=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(o,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,b)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):u?r(u):(h.loadVectorData(b,this.map.painter,o==="reloadTile"),r(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Vi{constructor(h,r,o,u){super(h,r,o,u),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,t.ResourceType.Source).url);t.getVideo(this.urls,(r,o)=>{this._loaded=!0,r?this.fire(new t.ErrorEvent(r)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Vi,canvas:class extends Vi{constructor(h,r,o,u){super(h,r,o,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(S=>typeof S!="number"))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends t.Evented{constructor(h,r,o,u){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=r,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ke(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:o,z:u}=h.canonical;return this._implementation.hasTile({x:r,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:o,y:u,z:b}=h.tileID.canonical,S=new t.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:u,z:b},{signal:S.signal})).then(function(I){return delete h.request,h.aborted?(h.state="unloaded",r(null)):I===void 0?(h.state="errored",r(null)):I===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(F){return F instanceof t.window.ImageData||F instanceof t.window.HTMLCanvasElement||F instanceof t.window.ImageBitmap||F instanceof t.window.HTMLImageElement}(I)?(this.loadTileData(h,I),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(I=>{I.code!==20&&(h.state="errored",r(I))}),h.request.cancel=()=>S.abort()}loadTileData(h,r){ni.loadTileData(h,r,this._map.painter)}unloadTileData(h){ni.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:o,y:u,z:b}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:b})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Fi=function(h,r,o,u){const b=new ki[r.type](h,r,o,u);if(b.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${b.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Wi(h,r){const o=t.identity([]);return t.scale(o,o,[.5*h.width,.5*-h.height,1]),t.translate(o,o,[1,-1,0]),t.multiply(o,o,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(o)}function Ar(h,r,o,u,b,S,I,F=!1){const N=h.tilesIn(u,I,F);N.sort(kr);const H=[];for(const ee of N)H.push({wrappedTileID:ee.tile.tileID.wrapped().key,queryResults:ee.tile.queryRenderedFeatures(r,o,h._state,ee,b,S,Wi(h.transform,ee.tile.tileID),F)});const X=function(ee){const me={},xe={};for(const Ee of ee){const Pe=Ee.queryResults,Le=Ee.wrappedTileID,ie=xe[Le]=xe[Le]||{};for(const Ce in Pe){const Re=Pe[Ce],Ne=ie[Ce]=ie[Ce]||{},et=me[Ce]=me[Ce]||[];for(const Qe of Re)Ne[Qe.featureIndex]||(Ne[Qe.featureIndex]=!0,et.push(Qe))}}return me}(H);for(const ee in X)X[ee].forEach(me=>{const xe=me.feature,Ee=xe.layer;Ee&&Ee.type!=="background"&&Ee.type!=="sky"&&(xe.source=Ee.source,Ee["source-layer"]&&(xe.sourceLayer=Ee["source-layer"]),xe.state=xe.id!==void 0?h.getFeatureState(Ee["source-layer"],xe.id):{})});return X}function Pr(h,r){const o=h.getRenderableIds().map(S=>h.getTileByID(S)),u=[],b={};for(let S=0;S<o.length;S++){const I=o[S],F=I.tileID.canonical.key;b[F]||(b[F]=!0,I.querySourceFeatures(u,r))}return u}function kr(h,r){const o=h.tileID,u=r.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Sr(){return St.workerClass!=null?new St.workerClass:new t.window.Worker(St.workerUrl)}const un="mapboxgl_preloaded_worker_pool";class Or{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Or.workerCount;)this.workers.push(new Sr);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[un]}numActive(){return Object.keys(this.active).length}}let Fr;function Bn(){return Fr||(Fr=new Or),Fr}function Io(h,r){const o={};for(const u in h)u!=="ref"&&(o[u]=h[u]);return t.refProperties.forEach(u=>{u in r&&(o[u]=r[u])}),o}function Hs(h){h=h.slice();const r=Object.create(null);for(let o=0;o<h.length;o++)r[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Io(h[o],r[h[o].ref]));return h}Or.workerCount=2;const hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function $s(h,r,o){o.push({command:hr.addSource,args:[h,r[h]]})}function kn(h,r,o){r.push({command:hr.removeSource,args:[h]}),o[h]=!0}function Qo(h,r,o,u){kn(h,o,u),$s(h,r,o)}function ko(h,r,o){let u;for(u in h[o])if(h[o].hasOwnProperty(u)&&u!=="data"&&!l(h[o][u],r[o][u]))return!1;for(u in r[o])if(r[o].hasOwnProperty(u)&&u!=="data"&&!l(h[o][u],r[o][u]))return!1;return!0}function cs(h,r,o,u,b,S){let I;for(I in r=r||{},h=h||{})h.hasOwnProperty(I)&&(l(h[I],r[I])||o.push({command:S,args:[u,I,r[I],b]}));for(I in r)r.hasOwnProperty(I)&&!h.hasOwnProperty(I)&&(l(h[I],r[I])||o.push({command:S,args:[u,I,r[I],b]}))}function Gn(h){return h.id}function ea(h,r){return h[r.id]=r,h}class Do{constructor(r,o){this.reset(r,o)}reset(r,o){this.points=r||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=t.clamp(r,0,1);let o=1,u=this._distances[o];const b=r*this.paddedLength+this.padding;for(;u<b&&o<this._distances.length;)u=this._distances[++o];const S=o-1,I=this._distances[S],F=u-I,N=F>0?(b-I)/F:0;return this.points[S].mult(1-N).add(this.points[o].mult(N))}}class Qn{constructor(r,o,u){const b=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(r/u),this.yCellCount=Math.ceil(o/u);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=o,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,o,u,b,S){this._forEachCell(o,u,b,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(b),this.bboxes.push(S)}insertCircle(r,o,u,b){this._forEachCell(o-b,u-b,o+b,u+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(o),this.circles.push(u),this.circles.push(b)}_insertBoxCell(r,o,u,b,S,I){this.boxCells[S].push(I)}_insertCircleCell(r,o,u,b,S,I){this.circleCells[S].push(I)}_query(r,o,u,b,S,I){if(u<0||r>this.width||b<0||o>this.height)return!S&&[];const F=[];if(r<=0&&o<=0&&this.width<=u&&this.height<=b){if(S)return!0;for(let N=0;N<this.boxKeys.length;N++)F.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const H=this.circles[3*N],X=this.circles[3*N+1],ee=this.circles[3*N+2];F.push({key:this.circleKeys[N],x1:H-ee,y1:X-ee,x2:H+ee,y2:X+ee})}return I?F.filter(I):F}return this._forEachCell(r,o,u,b,this._queryCell,F,{hitTest:S,seenUids:{box:{},circle:{}}},I),S?F.length>0:F}_queryCircle(r,o,u,b,S){const I=r-u,F=r+u,N=o-u,H=o+u;if(F<0||I>this.width||H<0||N>this.height)return!b&&[];const X=[];return this._forEachCell(I,N,F,H,this._queryCellCircle,X,{hitTest:b,circle:{x:r,y:o,radius:u},seenUids:{box:{},circle:{}}},S),b?X.length>0:X}query(r,o,u,b,S){return this._query(r,o,u,b,!1,S)}hitTest(r,o,u,b,S){return this._query(r,o,u,b,!0,S)}hitTestCircle(r,o,u,b){return this._queryCircle(r,o,u,!0,b)}_queryCell(r,o,u,b,S,I,F,N){const H=F.seenUids,X=this.boxCells[S];if(X!==null){const me=this.bboxes;for(const xe of X)if(!H.box[xe]){H.box[xe]=!0;const Ee=4*xe;if(r<=me[Ee+2]&&o<=me[Ee+3]&&u>=me[Ee+0]&&b>=me[Ee+1]&&(!N||N(this.boxKeys[xe]))){if(F.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[xe],x1:me[Ee],y1:me[Ee+1],x2:me[Ee+2],y2:me[Ee+3]})}}}const ee=this.circleCells[S];if(ee!==null){const me=this.circles;for(const xe of ee)if(!H.circle[xe]){H.circle[xe]=!0;const Ee=3*xe;if(this._circleAndRectCollide(me[Ee],me[Ee+1],me[Ee+2],r,o,u,b)&&(!N||N(this.circleKeys[xe]))){if(F.hitTest)return I.push(!0),!0;{const Pe=me[Ee],Le=me[Ee+1],ie=me[Ee+2];I.push({key:this.circleKeys[xe],x1:Pe-ie,y1:Le-ie,x2:Pe+ie,y2:Le+ie})}}}}}_queryCellCircle(r,o,u,b,S,I,F,N){const H=F.circle,X=F.seenUids,ee=this.boxCells[S];if(ee!==null){const xe=this.bboxes;for(const Ee of ee)if(!X.box[Ee]){X.box[Ee]=!0;const Pe=4*Ee;if(this._circleAndRectCollide(H.x,H.y,H.radius,xe[Pe+0],xe[Pe+1],xe[Pe+2],xe[Pe+3])&&(!N||N(this.boxKeys[Ee])))return I.push(!0),!0}}const me=this.circleCells[S];if(me!==null){const xe=this.circles;for(const Ee of me)if(!X.circle[Ee]){X.circle[Ee]=!0;const Pe=3*Ee;if(this._circlesCollide(xe[Pe],xe[Pe+1],xe[Pe+2],H.x,H.y,H.radius)&&(!N||N(this.circleKeys[Ee])))return I.push(!0),!0}}}_forEachCell(r,o,u,b,S,I,F,N){const H=this._convertToXCellCoord(r),X=this._convertToYCellCoord(o),ee=this._convertToXCellCoord(u),me=this._convertToYCellCoord(b);for(let xe=H;xe<=ee;xe++)for(let Ee=X;Ee<=me;Ee++)if(S.call(this,r,o,u,b,this.xCellCount*Ee+xe,I,F,N))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,o,u,b,S,I){const F=b-r,N=S-o,H=u+I;return H*H>F*F+N*N}_circleAndRectCollide(r,o,u,b,S,I,F){const N=(I-b)/2,H=Math.abs(r-(b+N));if(H>N+u)return!1;const X=(F-S)/2,ee=Math.abs(o-(S+X));if(ee>X+u)return!1;if(H<=N||ee<=X)return!0;const me=H-N,xe=ee-X;return me*me+xe*xe<=u*u}}const bs={unknown:0,flipRequired:1,flipNotRequired:2},fo=Math.tan(85*Math.PI/180);function Ut(h,r,o,u,b,S,I){const F=t.create();if(o)if(S.name==="globe"){const N=t.calculateGlobeLabelMatrix(b,r);t.multiply(F,F,N)}else{const N=ve([],I);F[0]=N[0],F[1]=N[1],F[4]=N[2],F[5]=N[3],u||t.rotateZ(F,F,b.angle)}else t.multiply(F,b.labelPlaneMatrix,h);return F}function Wn(h,r,o,u,b,S,I){const F=Ut(h,r,o,u,b,S,I);return S.name==="globe"&&o||(F[2]=F[6]=F[10]=F[14]=0),F}function Gr(h,r,o,u,b,S,I){if(o){if(S.name==="globe"){const F=Ut(h,r,o,u,b,S,I);return t.invert(F,F),t.multiply(F,h,F),F}{const F=t.clone(h),N=t.identity([]);return N[0]=I[0],N[1]=I[1],N[4]=I[2],N[5]=I[3],t.multiply(F,F,N),u||t.rotateZ(F,F,-b.angle),F}}return b.glCoordMatrix}function ur(h,r,o,u){const b=[h,r,o,1];o?t.transformMat4$1(b,b,u):Ki(b,b,u);const S=b[3];return b[0]/=S,b[1]/=S,b[2]/=S,b}function Ys(h,r){return Math.min(.5+h/r*.5,1.5)}function br(h,r){const o=h[0]/h[3],u=h[1]/h[3];return o>=-r[0]&&o<=r[0]&&u>=-r[1]&&u<=r[1]}function Zs(h,r,o,u,b,S,I,F,N,H){const X=o.transform,ee=u?h.textSizeData:h.iconSizeData,me=t.evaluateSizeForZoom(ee,o.transform.zoom),xe=X.projection.name==="globe",Ee=[256/o.width*2+1,256/o.height*2+1],Pe=u?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Pe.clear();let Le=null;xe&&(Le=u?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ie=h.lineVertexArray,Ce=u?h.text.placedSymbolArray:h.icon.placedSymbolArray,Re=o.transform.width/o.transform.height;let Ne,et=!1;for(let Qe=0;Qe<Ce.length;Qe++){const tt=Ce.get(Qe),{numGlyphs:_t,writingMode:ut}=tt;if(ut!==t.WritingMode.vertical||et||Ne===t.WritingMode.horizontal||(et=!0),Ne=ut,(tt.hidden||ut===t.WritingMode.vertical)&&!et){Nn(_t,Pe);continue}et=!1;const Ct=new t.Point(tt.tileAnchorX,tt.tileAnchorY);let{x:ei,y:Tt,z:Gt}=X.projection.projectTilePoint(Ct.x,Ct.y,H.canonical);if(N){const[$i,Si,zi]=N(Ct);ei+=$i,Tt+=Si,Gt+=zi}const Pt=[ei,Tt,Gt,1];if(t.transformMat4$1(Pt,Pt,r),!br(Pt,Ee)){Nn(_t,Pe);continue}const ii=Ys(o.transform.cameraToCenterDistance,Pt[3]),Mt=t.evaluateSizeForFeature(ee,me,tt),Xt=I?Mt/ii:Mt*ii,oi=ur(ei,Tt,Gt,b);if(oi[3]<=0){Nn(_t,Pe);continue}let qt={};const ci=I?null:N,Oi=di(tt,Xt,!1,F,r,b,S,h.glyphOffsetArray,ie,Pe,Le,oi,Ct,qt,Re,ci,X.projection,H,I);et=Oi.useVertical,ci&&Oi.needsFlipping&&(qt={}),(Oi.notEnoughRoom||et||Oi.needsFlipping&&di(tt,Xt,!0,F,r,b,S,h.glyphOffsetArray,ie,Pe,Le,oi,Ct,qt,Re,ci,X.projection,H,I).notEnoughRoom)&&Nn(_t,Pe)}u?(h.text.dynamicLayoutVertexBuffer.updateData(Pe),Le&&h.text.globeExtVertexBuffer.updateData(Le)):(h.icon.dynamicLayoutVertexBuffer.updateData(Pe),Le&&h.icon.globeExtVertexBuffer.updateData(Le))}function po(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe){const{lineStartIndex:Le,glyphStartIndex:ie,segment:Ce}=F,Re=ie+F.numGlyphs,Ne=Le+F.lineLength,et=r.getoffsetX(ie),Qe=r.getoffsetX(Re-1),tt=tn(h*et,o,u,b,S,I,Ce,Le,Ne,N,H,X,ee,me,!0,xe,Ee,Pe);if(!tt)return null;const _t=tn(h*Qe,o,u,b,S,I,Ce,Le,Ne,N,H,X,ee,me,!0,xe,Ee,Pe);return _t?{first:tt,last:_t}:null}function Ks(h,r,o,u){return h===t.WritingMode.horizontal&&Math.abs(u)>Math.abs(o)?{useVertical:!0}:h===t.WritingMode.vertical?u>0?{needsFlipping:!0}:null:r!==bs.unknown&&function(b,S){return b===0||Math.abs(S/b)>fo}(o,u)?r===bs.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function di(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe,Le,ie,Ce){const Re=r/24,Ne=h.lineOffsetX*Re,et=h.lineOffsetY*Re,{lineStartIndex:Qe,glyphStartIndex:tt,numGlyphs:_t,segment:ut,writingMode:Ct,flipState:ei}=h,Tt=Qe+h.lineLength,Gt=Pt=>{if(X){const[oi,qt,ci]=Pt.up,Oi=H.length;t.updateGlobeVertexNormal(X,Oi+0,oi,qt,ci),t.updateGlobeVertexNormal(X,Oi+1,oi,qt,ci),t.updateGlobeVertexNormal(X,Oi+2,oi,qt,ci),t.updateGlobeVertexNormal(X,Oi+3,oi,qt,ci)}const[ii,Mt,Xt]=Pt.point;t.addDynamicAttributes(H,ii,Mt,Xt,Pt.angle)};if(_t>1){const Pt=po(Re,F,Ne,et,o,ee,me,h,N,S,xe,Pe,!1,Le,ie,Ce);if(!Pt)return{notEnoughRoom:!0};if(u&&!o){let[ii,Mt,Xt]=Pt.first.point,[oi,qt,ci]=Pt.last.point;[ii,Mt]=ur(ii,Mt,Xt,I),[oi,qt]=ur(oi,qt,ci,I);const Oi=Ks(Ct,ei,(oi-ii)*Ee,qt-Mt);if(h.flipState=Oi&&Oi.needsFlipping?bs.flipRequired:bs.flipNotRequired,Oi)return Oi}Gt(Pt.first);for(let ii=tt+1;ii<tt+_t-1;ii++){const Mt=tn(Re*F.getoffsetX(ii),Ne,et,o,ee,me,ut,Qe,Tt,N,S,xe,Pe,!1,!1,Le,ie,Ce);if(!Mt)return H.length-=4*(ii-tt),{notEnoughRoom:!0};Gt(Mt)}Gt(Pt.last)}else{if(u&&!o){const ii=ur(me.x,me.y,0,b),Mt=Qe+ut+1,Xt=new t.Point(N.getx(Mt),N.gety(Mt)),oi=ur(Xt.x,Xt.y,0,b),qt=oi[3]>0?oi:ji(me,Xt,ii,1,b,void 0,Le,ie.canonical),ci=Ks(Ct,ei,(qt[0]-ii[0])*Ee,qt[1]-ii[1]);if(h.flipState=ci&&ci.needsFlipping?bs.flipRequired:bs.flipNotRequired,ci)return ci}const Pt=tn(Re*F.getoffsetX(tt),Ne,et,o,ee,me,ut,Qe,Tt,N,S,xe,Pe,!1,!1,Le,ie,Ce);if(!Pt)return{notEnoughRoom:!0};Gt(Pt)}return{}}function Zi(h,r,o,u,b){const{x:S,y:I,z:F}=u.projectTilePoint(h.x,h.y,r);if(!b)return ur(S,I,F,o);const[N,H,X]=b(h);return ur(S+N,I+H,F+X,o)}function ji(h,r,o,u,b,S,I,F){const N=Zi(h.sub(r)._unit()._add(h),F,b,I,S);return t.sub(N,o,N),t.normalize(N,N),t.scaleAndAdd(N,o,N,u)}function tn(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe,Le,ie){const Ce=u?h-r:h+r;let Re=Ce>0?1:-1,Ne=0;u&&(Re*=-1,Ne=Math.PI),Re<0&&(Ne+=Math.PI);let et=F+I+(Re>0?0:1)|0,Qe=b,tt=b,_t=0,ut=0;const Ct=Math.abs(Ce),ei=[],Tt=[];let Gt=S,Pt=Gt;const ii=()=>ji(Pt,Gt,tt,Ct-_t+1,X,me,Pe,Le.canonical);for(;_t+ut<=Ct;){if(et+=Re,et<F||et>=N)return null;if(tt=Qe,Pt=Gt,ei.push(tt),xe&&Tt.push(Pt),Gt=new t.Point(H.getx(et),H.gety(et)),Qe=ee[et],!Qe){const zi=Zi(Gt,Le.canonical,X,Pe,me);Qe=zi[3]>0?ee[et]=zi:ii()}_t+=ut,ut=t.distance(tt,Qe)}Ee&&me&&(ee[et]&&(Qe=ii(),ut=t.distance(tt,Qe)),ee[et]=Qe);const Mt=(Ct-_t)/ut,Xt=Gt.sub(Pt)._mult(Mt)._add(Pt),oi=t.sub([],Qe,tt),qt=t.scaleAndAdd([],tt,oi,Mt);let ci=[0,0,1],Oi=oi[0],$i=oi[1];if(ie&&(ci=Pe.upVector(Le.canonical,Xt.x,Xt.y),ci[0]!==0||ci[1]!==0||ci[2]!==1)){const zi=[ci[2],0,-ci[0]],rr=t.cross([],ci,zi);t.normalize(zi,zi),t.normalize(rr,rr),Oi=t.dot(oi,zi),$i=t.dot(oi,rr)}if(o){const zi=t.cross([],ci,oi);t.normalize(zi,zi),t.scaleAndAdd(qt,qt,zi,o*Re)}const Si=Ne+Math.atan2($i,Oi);return ei.push(qt),xe&&Tt.push(Xt),{point:qt,angle:Si,path:ei,tilePath:Tt,up:ci}}function Nn(h,r){const o=r.length,u=o+4*h;r.resize(u),r.float32.fill(-1/0,4*o,4*u)}function Ki(h,r,o){const u=r[0],b=r[1];return h[0]=o[0]*u+o[4]*b+o[12],h[1]=o[1]*u+o[5]*b+o[13],h[3]=o[3]*u+o[7]*b+o[15],h}const mn=100;class Oo{constructor(r,o,u=new Qn(r.width+200,r.height+200,25),b=new Qn(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=b,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+mn,this.screenBottomBoundary=r.height+mn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=o}placeCollisionBox(r,o,u,b,S,I,F,N){let H=u.projectedAnchorX,X=u.projectedAnchorY,ee=u.projectedAnchorZ;const me=u.elevation,xe=u.tileID,Ee=r.getProjection();if(me&&xe){const[Qe,tt,_t]=Ee.upVector(xe.canonical,u.tileAnchorX,u.tileAnchorY),ut=Ee.upVectorScale(xe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=Qe*me*ut,X+=tt*me*ut,ee+=_t*me*ut}const Pe=this.projectAndGetPerspectiveRatio(F,H,X,ee,u.tileID,Ee.name==="globe"||!!me||this.transform.pitch>0,Ee),Le=I*Pe.perspectiveRatio,ie=(u.x1*o+b.x-u.padding)*Le+Pe.point.x,Ce=(u.y1*o+b.y-u.padding)*Le+Pe.point.y,Re=(u.x2*o+b.x+u.padding)*Le+Pe.point.x,Ne=(u.y2*o+b.y+u.padding)*Le+Pe.point.y,et=Pe.perspectiveRatio<=.55||Pe.occluded;return!this.isInsideGrid(ie,Ce,Re,Ne)||!S&&this.grid.hitTest(ie,Ce,Re,Ne,N)||et?{box:[],offscreen:!1,occluded:Pe.occluded}:{box:[ie,Ce,Re,Ne],offscreen:this.isOffscreen(ie,Ce,Re,Ne),occluded:!1}}placeCollisionCircles(r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe){const Le=[],ie=this.transform.elevation,Ce=r.getProjection(),Re=ie?ie.getAtTileOffsetFunc(Pe,this.transform.center.lat,this.transform.worldSize,Ce):null,Ne=new t.Point(u.tileAnchorX,u.tileAnchorY);let{x:et,y:Qe,z:tt}=Ce.projectTilePoint(Ne.x,Ne.y,Pe.canonical);if(Re){const[Xt,oi,qt]=Re(Ne);et+=Xt,Qe+=oi,tt+=qt}const _t=Ce.name==="globe",ut=this.projectAndGetPerspectiveRatio(F,et,Qe,tt,Pe,_t||!!ie||this.transform.pitch>0,Ce),{perspectiveRatio:Ct}=ut,ei=(ee?I/Ct:I*Ct)/t.ONE_EM,Tt=ur(et,Qe,tt,N),Gt=ut.signedDistanceFromCamera>0?po(ei,S,u.lineOffsetX*ei,u.lineOffsetY*ei,!1,Tt,Ne,u,b,N,{},ie&&!ee?Re:null,ee&&!!ie,Ce,Pe,ee):null;let Pt=!1,ii=!1,Mt=!0;if(Gt&&!ut.occluded){const Xt=.5*xe*Ct+Ee,oi=new t.Point(-100,-100),qt=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),ci=new Do,{first:Oi,last:$i}=Gt,Si=Oi.path.length;let zi=[];for(let Pi=Si-1;Pi>=1;Pi--)zi.push(Oi.path[Pi]);for(let Pi=1;Pi<$i.path.length;Pi++)zi.push($i.path[Pi]);const rr=2.5*Xt;H&&(zi=zi.map(([Pi,yr,Lr],Tr)=>(Re&&!_t&&(Lr=Re(Tr<Si-1?Oi.tilePath[Si-1-Tr]:$i.tilePath[Tr-Si+2])[2]),ur(Pi,yr,Lr,H))),zi.some(Pi=>Pi[3]<=0)&&(zi=[]));let Xi=[];if(zi.length>0){let Pi=1/0,yr=-1/0,Lr=1/0,Tr=-1/0;for(const Ir of zi)Pi=Math.min(Pi,Ir[0]),Lr=Math.min(Lr,Ir[1]),yr=Math.max(yr,Ir[0]),Tr=Math.max(Tr,Ir[1]);yr>=oi.x&&Pi<=qt.x&&Tr>=oi.y&&Lr<=qt.y&&(Xi=[zi.map(Ir=>new t.Point(Ir[0],Ir[1]))],(Pi<oi.x||yr>qt.x||Lr<oi.y||Tr>qt.y)&&(Xi=t.clipLine(Xi,oi.x,oi.y,qt.x,qt.y)))}for(const Pi of Xi){ci.reset(Pi,.25*Xt);let yr=0;yr=ci.length<=.5*Xt?1:Math.ceil(ci.paddedLength/rr)+1;for(let Lr=0;Lr<yr;Lr++){const Tr=Lr/Math.max(yr-1,1),Ir=ci.lerp(Tr),Cn=Ir.x+mn,wn=Ir.y+mn;Le.push(Cn,wn,Xt,0);const ns=Cn-Xt,gs=wn-Xt,Qr=Cn+Xt,Dr=wn+Xt;if(Mt=Mt&&this.isOffscreen(ns,gs,Qr,Dr),ii=ii||this.isInsideGrid(ns,gs,Qr,Dr),!o&&this.grid.hitTestCircle(Cn,wn,Xt,me)&&(Pt=!0,!X))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!X&&Pt||!ii?[]:Le,offscreen:Mt,collisionDetected:Pt,occluded:ut.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,b=1/0,S=-1/0,I=-1/0;for(const X of r){const ee=new t.Point(X.x+mn,X.y+mn);u=Math.min(u,ee.x),b=Math.min(b,ee.y),S=Math.max(S,ee.x),I=Math.max(I,ee.y),o.push(ee)}const F=this.grid.query(u,b,S,I).concat(this.ignoredGrid.query(u,b,S,I)),N={},H={};for(const X of F){const ee=X.key;if(N[ee.bucketInstanceId]===void 0&&(N[ee.bucketInstanceId]={}),N[ee.bucketInstanceId][ee.featureIndex])continue;const me=[new t.Point(X.x1,X.y1),new t.Point(X.x2,X.y1),new t.Point(X.x2,X.y2),new t.Point(X.x1,X.y2)];t.polygonIntersectsPolygon(o,me)&&(N[ee.bucketInstanceId][ee.featureIndex]=!0,H[ee.bucketInstanceId]===void 0&&(H[ee.bucketInstanceId]=[]),H[ee.bucketInstanceId].push(ee.featureIndex))}return H}insertCollisionBox(r,o,u,b,S){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:b,collisionGroupID:S},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,o,u,b,S){const I=o?this.ignoredGrid:this.grid,F={bucketInstanceId:u,featureIndex:b,collisionGroupID:S};for(let N=0;N<r.length;N+=4)I.insertCircle(F,r[N],r[N+1],r[N+2])}projectAndGetPerspectiveRatio(r,o,u,b,S,I,F){const N=[o,u,b,1];let H=!1;b||this.transform.pitch>0?(t.transformMat4$1(N,N,r),this.fogState&&S&&F.name!=="globe"&&(H=function(me,xe,Ee,Pe,Le,ie){const Ce=ie.calculateFogTileMatrix(Le),Re=[xe,Ee,Pe];return t.transformMat4(Re,Re,Ce),ft(me,Re,ie.pitch,ie._fov)}(this.fogState,o,u,b,S.toUnwrapped(),this.transform)>.9)):Ki(N,N,r);const X=N[3];return{point:new t.Point((N[0]/X+1)/2*this.transform.width+mn,(-N[1]/X+1)/2*this.transform.height+mn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(F)/X*.5,1.5),signedDistanceFromCamera:X,occluded:I&&N[2]>X||H}}isOffscreen(r,o,u,b){return u<mn||r>=this.screenRightBoundary||b<mn||o>this.screenBottomBoundary}isInsideGrid(r,o,u,b){return u>=0&&r<this.gridRightBoundary&&b>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const r=t.identity([]);return t.translate(r,r,[-100,-100,0]),r}}function Es(h,r,o){const u=r.createTileMatrix(h,h.worldSize,o.toUnwrapped());return t.multiply(new Float32Array(16),h.projMatrix,u)}function jn(h,r,o){if(r.projection.name===o.projection.name)return h.projMatrix;const u=o.clone();return u.setProjection(r.projection),Es(u,r.getProjection(),h)}function Er(h,r,o){return r.name===o.projection.name?h.projMatrix:Es(o,r,h)}class ma{constructor(r,o,u,b){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?o:-o))):b&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ws{constructor(r,o,u,b,S,I=!1){this.text=new ma(r?r.text:null,o,u,S),this.icon=new ma(r?r.icon:null,o,b,S),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fo{constructor(r,o,u,b=!1){this.text=r,this.icon=o,this.skipFade=u,this.clipped=b}}class es{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class Ss{constructor(r,o,u,b,S){this.bucketInstanceId=r,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=b,this.tileID=S}}class it{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const o=++this.maxGroupID;this.collisionGroups[r]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[r]}}function vt(h,r,o,u,b){const{horizontalAlign:S,verticalAlign:I}=t.getAnchorAlignment(h),F=-(S-.5)*r,N=-(I-.5)*o,H=t.evaluateVariableOffset(h,u);return new t.Point(F+H[0]*b,N+H[1]*b)}function Lt(h,r,o,u,b){const S=new t.Point(h,r);return o&&S._rotate(u?b:-b),S}class li{constructor(r,o,u,b,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Oo(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new it(u),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,o,u,b){const S=u.getBucket(o),I=u.latestFeatureIndex;if(!S||!I||o.id!==S.layerIds[0])return;const F=S.layers[0].layout,N=u.collisionBoxArray,H=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),X=u.tileSize/t.EXTENT,ee=u.tileID.toUnwrapped();this.transform.setProjection(S.projection);const me=(xe=u.tileID,Ee=S.getProjection(),Pe=this.transform,Ee.name===this.projection?Pe.calculateProjMatrix(xe.toUnwrapped()):Es(Pe,Ee,xe));var xe,Ee,Pe;const Le=F.get("text-pitch-alignment")==="map",ie=F.get("text-rotation-alignment")==="map";o.compileFilter();const Ce=o.dynamicFilter(),Re=o.dynamicFilterNeedsFeature(),Ne=this.transform.calculatePixelsToTileUnitsMatrix(u),et=Wn(me,u.tileID.canonical,Le,ie,this.transform,S.getProjection(),Ne);let Qe=null;if(Le){const ut=Gr(me,u.tileID.canonical,Le,ie,this.transform,S.getProjection(),Ne);Qe=t.multiply([],this.transform.labelPlaneMatrix,ut)}let tt=null;Ce&&u.latestFeatureIndex&&(tt={unwrappedTileID:ee,dynamicFilter:Ce,dynamicFilterNeedsFeature:Re,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Ss(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,u.tileID);const _t={bucket:S,layout:F,posMatrix:me,textLabelPlaneMatrix:et,labelToScreenMatrix:Qe,clippingData:tt,scale:H,textPixelRatio:X,holdingForFade:u.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(b)for(const ut of S.sortKeyRanges){const{sortKey:Ct,symbolInstanceStart:ei,symbolInstanceEnd:Tt}=ut;r.push({sortKey:Ct,symbolInstanceStart:ei,symbolInstanceEnd:Tt,parameters:_t})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:_t})}attemptAnchorPlacement(r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe,Le,ie,Ce){const{textOffset0:Re,textOffset1:Ne,crossTileID:et}=me,Qe=[Re,Ne],tt=vt(r,u,b,Qe,S),_t=this.collisionIndex.placeCollisionBox(Ee,S,o,Lt(tt.x,tt.y,I,F,this.transform.angle),ee,N,H,X.predicate);if(Le){const ut=Ee.getSymbolInstanceIconSize(Ce,this.transform.zoom,me.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ee,ut,Le,Lt(tt.x,tt.y,I,F,this.transform.angle),ee,N,H,X.predicate).box.length===0)return}if(_t.box.length>0){let ut;return this.prevPlacement&&this.prevPlacement.variableOffsets[et]&&this.prevPlacement.placements[et]&&this.prevPlacement.placements[et].text&&(ut=this.prevPlacement.variableOffsets[et].anchor),this.variableOffsets[et]={textOffset:Qe,width:u,height:b,anchor:r,textScale:S,prevAnchor:ut},this.markUsedJustification(Ee,r,me,Pe),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Pe,me),this.placedOrientations[et]=Pe),{shift:tt,placedGlyphBoxes:_t}}}placeLayerBucketPart(r,o,u,b){const{bucket:S,layout:I,posMatrix:F,textLabelPlaneMatrix:N,labelToScreenMatrix:H,clippingData:X,textPixelRatio:ee,holdingForFade:me,collisionBoxArray:xe,partiallyEvaluatedTextSize:Ee,partiallyEvaluatedIconSize:Pe,collisionGroup:Le}=r.parameters,ie=I.get("text-optional"),Ce=I.get("icon-optional"),Re=I.get("text-allow-overlap"),Ne=I.get("icon-allow-overlap"),et=I.get("text-rotation-alignment")==="map",Qe=I.get("text-pitch-alignment")==="map",tt=I.get("icon-text-fit")!=="none",_t=I.get("symbol-z-order")==="viewport-y";this.transform.setProjection(S.projection);let ut=Re&&(Ne||!S.hasIconData()||Ce),Ct=Ne&&(Re||!S.hasTextData()||ie);!S.collisionArrays&&xe&&S.deserializeCollisionBoxes(xe),u&&b&&S.updateCollisionDebugBuffers(this.transform.zoom,xe);const ei=(Tt,Gt,Pt)=>{const{crossTileID:ii,numVerticalGlyphVertices:Mt}=Tt;if(X){const Qr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Dr=null;if(X.dynamicFilterNeedsFeature){const xr=this.retainedQueryData[S.bucketInstanceId];Dr=X.featureIndex.loadFeature({featureIndex:Tt.featureIndex,bucketIndex:xr.bucketIndex,sourceLayerIndex:xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,X.dynamicFilter)(Qr,Dr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new t.Point(Tt.tileAnchorX,Tt.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[ii]=new Fo(!1,!1,!1,!0),void o.add(ii)}if(o.has(ii))return;if(me)return void(this.placements[ii]=new Fo(!1,!1,!1));let Xt=!1,oi=!1,qt=!0,ci=!1,Oi=!1,$i=null,Si={box:null,offscreen:null,occluded:null},zi={box:null,offscreen:null,occluded:null},rr=null,Xi=null,Pi=null,yr=0,Lr=0,Tr=0;Pt.textFeatureIndex?yr=Pt.textFeatureIndex:Tt.useRuntimeCollisionCircles&&(yr=Tt.featureIndex),Pt.verticalTextFeatureIndex&&(Lr=Pt.verticalTextFeatureIndex);const Ir=Qr=>{Qr.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Dr=this.transform.elevation;(Dr||Qr.elevation)&&(Qr.elevation=Dr?Dr.getAtTileOffset(Qr.tileID,Qr.tileAnchorX,Qr.tileAnchorY):0)},Cn=Pt.textBox;if(Cn){Ir(Cn);const Qr=xr=>{let Br=t.WritingMode.horizontal;if(S.allowVerticalPlacement&&!xr&&this.prevPlacement){const ss=this.prevPlacement.placedOrientations[ii];ss&&(this.placedOrientations[ii]=ss,Br=ss,this.markUsedOrientation(S,Br,Tt))}return Br},Dr=(xr,Br)=>{if(S.allowVerticalPlacement&&Mt>0&&Pt.verticalTextBox){for(const ss of S.writingModes)if(ss===t.WritingMode.vertical?(Si=Br(),zi=Si):Si=xr(),Si&&Si.box&&Si.box.length)break}else Si=xr()};if(I.get("text-variable-anchor")){let xr=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ii]){const $r=this.prevPlacement.variableOffsets[ii];xr.indexOf($r.anchor)>0&&(xr=xr.filter(_s=>_s!==$r.anchor),xr.unshift($r.anchor))}const Br=($r,_s,Xl)=>{const So=S.getSymbolInstanceTextSize(Ee,Tt,this.transform.zoom,Gt),pl=($r.x2-$r.x1)*So+2*$r.padding,To=($r.y2-$r.y1)*So+2*$r.padding,ao=tt&&!Ne?_s:null;ao&&Ir(ao);let $o={box:[],offscreen:!1,occluded:!1};const aa=Re?2*xr.length:xr.length;for(let ml=0;ml<aa;++ml){const kc=this.attemptAnchorPlacement(xr[ml%xr.length],$r,pl,To,So,et,Qe,ee,F,Le,ml>=xr.length,Tt,Gt,S,Xl,ao,Ee,Pe);if(kc&&($o=kc.placedGlyphBoxes,$o&&$o.box&&$o.box.length)){Xt=!0,$i=kc.shift;break}}return $o};Dr(()=>Br(Cn,Pt.iconBox,t.WritingMode.horizontal),()=>{const $r=Pt.verticalTextBox;return $r&&Ir($r),S.allowVerticalPlacement&&!(Si&&Si.box&&Si.box.length)&&Mt>0&&$r?Br($r,Pt.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Si&&(Xt=Si.box,qt=Si.offscreen,ci=Si.occluded);const ss=Qr(!(!Si||!Si.box));if(!Xt&&this.prevPlacement){const $r=this.prevPlacement.variableOffsets[ii];$r&&(this.variableOffsets[ii]=$r,this.markUsedJustification(S,$r.anchor,Tt,ss))}}else{const xr=(Br,ss)=>{const $r=S.getSymbolInstanceTextSize(Ee,Tt,this.transform.zoom,Gt),_s=this.collisionIndex.placeCollisionBox(S,$r,Br,new t.Point(0,0),Re,ee,F,Le.predicate);return _s&&_s.box&&_s.box.length&&(this.markUsedOrientation(S,ss,Tt),this.placedOrientations[ii]=ss),_s};Dr(()=>xr(Cn,t.WritingMode.horizontal),()=>{const Br=Pt.verticalTextBox;return S.allowVerticalPlacement&&Mt>0&&Br?(Ir(Br),xr(Br,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Qr(!!(Si&&Si.box&&Si.box.length))}}if(rr=Si,Xt=rr&&rr.box&&rr.box.length>0,qt=rr&&rr.offscreen,ci=rr&&rr.occluded,Tt.useRuntimeCollisionCircles){const Qr=S.text.placedSymbolArray.get(Tt.centerJustifiedTextSymbolIndex>=0?Tt.centerJustifiedTextSymbolIndex:Tt.verticalPlacedTextSymbolIndex),Dr=t.evaluateSizeForFeature(S.textSizeData,Ee,Qr),xr=I.get("text-padding");Xi=this.collisionIndex.placeCollisionCircles(S,Re,Qr,S.lineVertexArray,S.glyphOffsetArray,Dr,F,N,H,u,Qe,Le.predicate,Tt.collisionCircleDiameter*Dr/t.ONE_EM,xr,this.retainedQueryData[S.bucketInstanceId].tileID),Xt=Re||Xi.circles.length>0&&!Xi.collisionDetected,qt=qt&&Xi.offscreen,ci=Xi.occluded}if(Pt.iconFeatureIndex&&(Tr=Pt.iconFeatureIndex),Pt.iconBox){const Qr=Dr=>{Ir(Dr);const xr=tt&&$i?Lt($i.x,$i.y,et,Qe,this.transform.angle):new t.Point(0,0),Br=S.getSymbolInstanceIconSize(Pe,this.transform.zoom,Tt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Br,Dr,xr,Ne,ee,F,Le.predicate)};zi&&zi.box&&zi.box.length&&Pt.verticalIconBox?(Pi=Qr(Pt.verticalIconBox),oi=Pi.box.length>0):(Pi=Qr(Pt.iconBox),oi=Pi.box.length>0),qt=qt&&Pi.offscreen,Oi=Pi.occluded}const wn=ie||Tt.numHorizontalGlyphVertices===0&&Mt===0,ns=Ce||Tt.numIconVertices===0;if(wn||ns?ns?wn||(oi=oi&&Xt):Xt=oi&&Xt:oi=Xt=oi&&Xt,Xt&&rr&&rr.box&&this.collisionIndex.insertCollisionBox(rr.box,I.get("text-ignore-placement"),S.bucketInstanceId,zi&&zi.box&&Lr?Lr:yr,Le.ID),oi&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,I.get("icon-ignore-placement"),S.bucketInstanceId,Tr,Le.ID),Xi&&(Xt&&this.collisionIndex.insertCollisionCircles(Xi.circles,I.get("text-ignore-placement"),S.bucketInstanceId,yr,Le.ID),u)){const Qr=S.bucketInstanceId;let Dr=this.collisionCircleArrays[Qr];Dr===void 0&&(Dr=this.collisionCircleArrays[Qr]=new es);for(let xr=0;xr<Xi.circles.length;xr+=4)Dr.circles.push(Xi.circles[xr+0]),Dr.circles.push(Xi.circles[xr+1]),Dr.circles.push(Xi.circles[xr+2]),Dr.circles.push(Xi.collisionDetected?1:0)}const gs=S.projection.name!=="globe";ut=ut&&(gs||!ci),Ct=Ct&&(gs||!Oi),this.placements[ii]=new Fo(Xt||ut,oi||Ct,qt||S.justReloaded),o.add(ii)};if(_t){const Tt=S.getSortedSymbolIndexes(this.transform.angle);for(let Gt=Tt.length-1;Gt>=0;--Gt){const Pt=Tt[Gt];ei(S.symbolInstances.get(Pt),Pt,S.collisionArrays[Pt])}}else for(let Tt=r.symbolInstanceStart;Tt<r.symbolInstanceEnd;Tt++)ei(S.symbolInstances.get(Tt),Tt,S.collisionArrays[Tt]);if(u&&S.bucketInstanceId in this.collisionCircleArrays){const Tt=this.collisionCircleArrays[S.bucketInstanceId];t.invert(Tt.invProjMatrix,F),Tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(r,o,u,b){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:N,crossTileID:H}=u,X=t.getAnchorJustification(o),ee=b===t.WritingMode.vertical?N:X==="left"?S:X==="center"?I:X==="right"?F:-1;S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=ee>=0&&S!==ee?0:H),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=ee>=0&&I!==ee?0:H),F>=0&&(r.text.placedSymbolArray.get(F).crossTileID=ee>=0&&F!==ee?0:H),N>=0&&(r.text.placedSymbolArray.get(N).crossTileID=ee>=0&&N!==ee?0:H)}markUsedOrientation(r,o,u){const b=o===t.WritingMode.horizontal||o===t.WritingMode.horizontalOnly?o:0,S=o===t.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:F,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:H}=u,X=r.text.placedSymbolArray;I>=0&&(X.get(I).placedOrientation=b),F>=0&&(X.get(F).placedOrientation=b),N>=0&&(X.get(N).placedOrientation=b),H>=0&&(X.get(H).placedOrientation=S)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const b=o?o.symbolFadeChange(r):1,S=o?o.opacities:{},I=o?o.variableOffsets:{},F=o?o.placedOrientations:{};for(const N in this.placements){const H=this.placements[N],X=S[N];X?(this.opacities[N]=new ws(X,b,H.text,H.icon,null,H.clipped),u=u||H.text!==X.text.placed||H.icon!==X.icon.placed):(this.opacities[N]=new ws(null,b,H.text,H.icon,H.skipFade,H.clipped),u=u||H.text||H.icon)}for(const N in S){const H=S[N];if(!this.opacities[N]){const X=new ws(H,b,!1,!1);X.isHidden()||(this.opacities[N]=X,u=u||H.text.placed||H.icon.placed)}}for(const N in I)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=I[N]);for(const N in F)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=F[N]);u?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:r)}updateLayerOpacities(r,o){const u=new Set;for(const b of o){const S=b.getBucket(r);S&&b.latestFeatureIndex&&r.id===S.layerIds[0]&&this.updateBucketOpacities(S,u,b.collisionBoxArray)}}updateBucketOpacities(r,o,u){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const b=r.layers[0].layout,S=!!r.layers[0].dynamicFilter(),I=new ws(null,0,!1,!1,!0),F=b.get("text-allow-overlap"),N=b.get("icon-allow-overlap"),H=b.get("text-variable-anchor"),X=b.get("text-rotation-alignment")==="map",ee=b.get("text-pitch-alignment")==="map",me=b.get("icon-text-fit")!=="none",xe=new ws(null,0,F&&(N||!r.hasIconData()||b.get("icon-optional")),N&&(F||!r.hasTextData()||b.get("text-optional")),!0);!r.collisionArrays&&u&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(u);const Ee=(Le,ie,Ce)=>{for(let Re=0;Re<ie/4;Re++)Le.opacityVertexArray.emplaceBack(Ce)};let Pe=0;for(let Le=0;Le<r.symbolInstances.length;Le++){const ie=r.symbolInstances.get(Le),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Re,crossTileID:Ne,numIconVertices:et}=ie,Qe=o.has(Ne);let tt=this.opacities[Ne];Qe?tt=I:tt||(tt=xe,this.opacities[Ne]=tt),o.add(Ne);const _t=Ce>0||Re>0,ut=et>0,Ct=this.placedOrientations[Ne],ei=Ct===t.WritingMode.vertical,Tt=Ct===t.WritingMode.horizontal||Ct===t.WritingMode.horizontalOnly;if(!_t&&!ut||tt.isHidden()||Pe++,_t){const Gt=fr(tt.text);Ee(r.text,Ce,ei?ir:Gt),Ee(r.text,Re,Tt?ir:Gt);const Pt=tt.text.isHidden(),{leftJustifiedTextSymbolIndex:ii,centerJustifiedTextSymbolIndex:Mt,rightJustifiedTextSymbolIndex:Xt,verticalPlacedTextSymbolIndex:oi}=ie,qt=r.text.placedSymbolArray,ci=Pt||ei?1:0;ii>=0&&(qt.get(ii).hidden=ci),Mt>=0&&(qt.get(Mt).hidden=ci),Xt>=0&&(qt.get(Xt).hidden=ci),oi>=0&&(qt.get(oi).hidden=Pt||Tt?1:0);const Oi=this.variableOffsets[Ne];Oi&&this.markUsedJustification(r,Oi.anchor,ie,Ct);const $i=this.placedOrientations[Ne];$i&&(this.markUsedJustification(r,"left",ie,$i),this.markUsedOrientation(r,$i,ie))}if(ut){const Gt=fr(tt.icon),{placedIconSymbolIndex:Pt,verticalPlacedIconSymbolIndex:ii}=ie,Mt=r.icon.placedSymbolArray,Xt=tt.icon.isHidden()?1:0;Pt>=0&&(Ee(r.icon,et,ei?ir:Gt),Mt.get(Pt).hidden=Xt),ii>=0&&(Ee(r.icon,ie.numVerticalIconVertices,Tt?ir:Gt),Mt.get(ii).hidden=Xt)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Gt=r.collisionArrays[Le];if(Gt){let Pt=new t.Point(0,0),ii=!0;if(Gt.textBox||Gt.verticalTextBox){if(H){const Xt=this.variableOffsets[Ne];Xt?(Pt=vt(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textScale),X&&Pt._rotate(ee?this.transform.angle:-this.transform.angle)):ii=!1}S&&(ii=!tt.clipped),Gt.textBox&&_i(r.textCollisionBox.collisionVertexArray,tt.text.placed,!ii||ei,Pt.x,Pt.y),Gt.verticalTextBox&&_i(r.textCollisionBox.collisionVertexArray,tt.text.placed,!ii||Tt,Pt.x,Pt.y)}const Mt=ii&&!!(!Tt&&Gt.verticalIconBox);Gt.iconBox&&_i(r.iconCollisionBox.collisionVertexArray,tt.icon.placed,Mt,me?Pt.x:0,me?Pt.y:0),Gt.verticalIconBox&&_i(r.iconCollisionBox.collisionVertexArray,tt.icon.placed,!Mt,me?Pt.x:0,me?Pt.y:0)}}}if(r.fullyClipped=Pe===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Le.invProjMatrix,r.placementViewportMatrix=Le.viewportMatrix,r.collisionCircleArray=Le.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>r}setStale(){this.stale=!0}}function _i(h,r,o,u,b){h.emplaceBack(r?1:0,o?1:0,u||0,b||0),h.emplaceBack(r?1:0,o?1:0,u||0,b||0),h.emplaceBack(r?1:0,o?1:0,u||0,b||0),h.emplaceBack(r?1:0,o?1:0,u||0,b||0)}const Yt=Math.pow(2,25),Mi=Math.pow(2,24),Di=Math.pow(2,17),gr=Math.pow(2,16),ar=Math.pow(2,9),pr=Math.pow(2,8),Mr=Math.pow(2,1);function fr(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const r=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Yt+r*Mi+o*Di+r*gr+o*ar+r*pr+o*Mr+r}const ir=0;class nn{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,o,u,b,S){const I=this._bucketParts;for(;this._currentTileIndex<r.length;)if(o.getBucketParts(I,b,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((F,N)=>F.sortKey-N.sortKey));this._currentPartIndex<I.length;){const F=I[this._currentPartIndex];if(o.placeLayerBucketPart(F,this._seenCrossTileIDs,u,F.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class sn{constructor(r,o,u,b,S,I,F,N){this.placement=new li(r,S,I,F,N),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(r,o,u){const b=t.exported.now(),S=()=>{const I=t.exported.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=o[r[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=F)&&(!I.maxzoom||I.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new nn(I)),this._inProgressLayer.continuePlacement(u[I.source],this.placement,this._showCollisionBoxes,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const zr=512/t.EXTENT/2;class Wr{constructor(r,o,u){this.tileID=r,this.bucketInstanceId=u,this.index=new t.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=r.canonical.x*t.EXTENT,S=r.canonical.y*t.EXTENT;for(let I=0;I<o.length;I++){const{key:F,crossTileID:N,tileAnchorX:H,tileAnchorY:X}=o.get(I),ee=Math.floor((b+H)*zr),me=Math.floor((S+X)*zr);this.index.add(ee,me),this.keys.push(F),this.crossTileIDs.push(N)}this.index.finish()}findMatches(r,o,u){const b=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),S=zr/Math.pow(2,o.canonical.z-this.tileID.canonical.z),I=o.canonical.x*t.EXTENT,F=o.canonical.y*t.EXTENT;for(let N=0;N<r.length;N++){const H=r.get(N);if(H.crossTileID)continue;const{key:X,tileAnchorX:ee,tileAnchorY:me}=H,xe=Math.floor((I+ee)*S),Ee=Math.floor((F+me)*S),Pe=this.index.range(xe-b,Ee-b,xe+b,Ee+b);for(const Le of Pe){const ie=this.crossTileIDs[Le];if(this.keys[Le]===X&&!u.has(ie)){u.add(ie),H.crossTileID=ie;break}}}}}class hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const o=Math.round((r-this.lng)/360);if(o!==0)for(const u in this.indexes){const b=this.indexes[u],S={};for(const I in b){const F=b[I];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+o),S[F.tileID.key]=F}this.indexes[u]=S}this.lng=r}addBucket(r,o,u){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let S=0;S<o.symbolInstances.length;S++)o.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const b=this.usedCrossTileIDs[r.overscaledZ];for(const S in this.indexes){const I=this.indexes[S];if(Number(S)>r.overscaledZ)for(const F in I){const N=I[F];N.tileID.isChildOf(r)&&N.findMatches(o.symbolInstances,r,b)}else{const F=I[r.scaledTo(Number(S)).key];F&&F.findMatches(o.symbolInstances,r,b)}}for(let S=0;S<o.symbolInstances.length;S++){const I=o.symbolInstances.get(S);I.crossTileID||(I.crossTileID=u.generate(),b.add(I.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Wr(r,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(r,o){for(const u of o.crossTileIDs)this.usedCrossTileIDs[r].delete(u)}removeStaleBuckets(r){let o=!1;for(const u in this.indexes){const b=this.indexes[u];for(const S in b)r[b[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,b[S]),delete b[S],o=!0)}return o}}class Dn{constructor(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,o,u,b){let S=this.layerIndexes[r.id];S===void 0&&(S=this.layerIndexes[r.id]=new zo);let I=!1;const F={};b.name!=="globe"&&S.handleWrapJump(u);for(const N of o){const H=N.getBucket(r);H&&r.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(N.tileID,H,this.crossTileIDs)&&(I=!0),F[H.bucketInstanceId]=!0)}return S.removeStaleBuckets(F)&&(I=!0),I}pruneUnusedLayers(r){const o={};r.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Xn=(h,r)=>t.emitValidationErrors(h,r&&r.filter(o=>o.identifier!=="source.canvas")),Ps=t.pick(hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ga=t.pick(hr,["setCenter","setZoom","setBearing","setPitch"]),Ka={version:8,layers:[],sources:{}},Ro={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ts extends t.Evented{constructor(r,o={}){super(),this.map=r,this.dispatcher=new Te(Bn(),this),this.imageManager=new _e,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(r._requestManager,o.localFontFamily?t.LocalGlyphMode.all:o.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new Dn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const u=this;this._rtlTextPluginCallback=Ts.registerForPluginStateChange(b=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(S,I)=>{if(t.triggerPluginCompletionEvent(S),I&&I.every(F=>F))for(const F in u._sourceCaches){const N=u._sourceCaches[F],H=N.getSource().type;H!=="vector"&&H!=="geojson"||N.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const S=this.getSource(b.sourceId);if(S&&S.vectorLayerIds)for(const I in this._layers){const F=this._layers[I];F.source===S.id&&this._validateLayer(F)}})}loadURL(r,o={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!t.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,o.accessToken);const b=this.map._requestManager.transformRequest(r,t.ResourceType.Style);this._request=t.getJSON(b,(S,I)=>{this._request=null,S?this.fire(new t.ErrorEvent(S)):I&&this._load(I,u)})}loadJSON(r,o={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(r,o.validate!==!1)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ka,!1)}_updateLayerCount(r,o){const u=o?1:-1;r.is3D()&&(this._num3DLayers+=u),r.type==="circle"&&(this._numCircleLayers+=u),r.type==="symbol"&&(this._numSymbolLayers+=u)}_load(r,o){if(o&&Xn(this,t.validateStyle(r)))return;this._loaded=!0,this.stylesheet=t.clone$1(r),this._updateMapProjection();for(const b in r.sources)this.addSource(b,r.sources[b],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const u=Hs(this.stylesheet.layers);this._order=u.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of u){const S=t.createStyleLayer(b);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ze(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(o,u,b){let S,I,F;const N=t.exported.devicePixelRatio>1?"@2x":"";let H=t.getJSON(u.transformRequest(u.normalizeSpriteURL(o,N,".json"),t.ResourceType.SpriteJSON),(me,xe)=>{H=null,F||(F=me,S=xe,ee())}),X=t.getImage(u.transformRequest(u.normalizeSpriteURL(o,N,".png"),t.ResourceType.SpriteImage),(me,xe)=>{X=null,F||(F=me,I=xe,ee())});function ee(){if(F)b(F);else if(S&&I){const me=t.exported.getImageData(I),xe={};for(const Ee in S){const{width:Pe,height:Le,x:ie,y:Ce,sdf:Re,pixelRatio:Ne,stretchX:et,stretchY:Qe,content:tt}=S[Ee],_t=new t.RGBAImage({width:Pe,height:Le});t.RGBAImage.copy(me,_t,{x:ie,y:Ce},{x:0,y:0},{width:Pe,height:Le}),xe[Ee]={data:_t,pixelRatio:Ne,sdf:Re,stretchX:et,stretchY:Qe,content:tt}}b(null,xe)}}return{cancel(){H&&(H.cancel(),H=null),X&&(X.cancel(),X=null)}}}(r,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new t.ErrorEvent(o));else if(u)for(const b in u)this.imageManager.addImage(b,u[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(r){const o=this.getSource(r.source);if(!o)return;const u=r.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new t.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const o=[];for(const u of r){const b=this._layers[u];b.type!=="custom"&&o.push(b.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():Ro[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const o=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(b.length||S.length)&&this._updateWorkerLayers(b,S);for(const I in this._updatedSources){const F=this._updatedSources[I];F==="reload"?this._reloadSource(I):F==="clear"&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const u={};for(const b in this._sourceCaches){const S=this._sourceCaches[b];u[b]=S.used,S.used=!1}for(const b of this._order){const S=this._layers[b];if(S.recalculate(r,this._availableImages),!S.isHidden(r.zoom)){const F=this._getLayerSourceCache(S);F&&(F.used=!0)}const I=this.map.painter;if(I){const F=S.getProgramIds();if(!F)continue;const N=S.getProgramConfiguration(r.zoom);for(const H of F)I.useProgram(H,N)}}for(const b in u){const S=this._sourceCaches[b];u[b]!==S.used&&S.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Xn(this,t.validateStyle(r)))return!1;(r=t.clone$1(r)).layers=Hs(r.layers);const o=function(b,S){if(!b)return[{command:hr.setStyle,args:[S]}];let I=[];try{if(!l(b.version,S.version))return[{command:hr.setStyle,args:[S]}];l(b.center,S.center)||I.push({command:hr.setCenter,args:[S.center]}),l(b.zoom,S.zoom)||I.push({command:hr.setZoom,args:[S.zoom]}),l(b.bearing,S.bearing)||I.push({command:hr.setBearing,args:[S.bearing]}),l(b.pitch,S.pitch)||I.push({command:hr.setPitch,args:[S.pitch]}),l(b.sprite,S.sprite)||I.push({command:hr.setSprite,args:[S.sprite]}),l(b.glyphs,S.glyphs)||I.push({command:hr.setGlyphs,args:[S.glyphs]}),l(b.transition,S.transition)||I.push({command:hr.setTransition,args:[S.transition]}),l(b.light,S.light)||I.push({command:hr.setLight,args:[S.light]}),l(b.fog,S.fog)||I.push({command:hr.setFog,args:[S.fog]}),l(b.projection,S.projection)||I.push({command:hr.setProjection,args:[S.projection]});const F={},N=[];(function(ee,me,xe,Ee){let Pe;for(Pe in me=me||{},ee=ee||{})ee.hasOwnProperty(Pe)&&(me.hasOwnProperty(Pe)||kn(Pe,xe,Ee));for(Pe in me){if(!me.hasOwnProperty(Pe))continue;const Le=me[Pe];ee.hasOwnProperty(Pe)?l(ee[Pe],Le)||(ee[Pe].type==="geojson"&&Le.type==="geojson"&&ko(ee,me,Pe)?xe.push({command:hr.setGeoJSONSourceData,args:[Pe,Le.data]}):Qo(Pe,me,xe,Ee)):$s(Pe,me,xe)}})(b.sources,S.sources,N,F);const H=[];b.layers&&b.layers.forEach(ee=>{ee.source&&F[ee.source]?I.push({command:hr.removeLayer,args:[ee.id]}):H.push(ee)});let X=b.terrain;X&&F[X.source]&&(I.push({command:hr.setTerrain,args:[void 0]}),X=void 0),I=I.concat(N),l(X,S.terrain)||I.push({command:hr.setTerrain,args:[S.terrain]}),function(ee,me,xe){me=me||[];const Ee=(ee=ee||[]).map(Gn),Pe=me.map(Gn),Le=ee.reduce(ea,{}),ie=me.reduce(ea,{}),Ce=Ee.slice(),Re=Object.create(null);let Ne,et,Qe,tt,_t,ut,Ct;for(Ne=0,et=0;Ne<Ee.length;Ne++)Qe=Ee[Ne],ie.hasOwnProperty(Qe)?et++:(xe.push({command:hr.removeLayer,args:[Qe]}),Ce.splice(Ce.indexOf(Qe,et),1));for(Ne=0,et=0;Ne<Pe.length;Ne++)Qe=Pe[Pe.length-1-Ne],Ce[Ce.length-1-Ne]!==Qe&&(Le.hasOwnProperty(Qe)?(xe.push({command:hr.removeLayer,args:[Qe]}),Ce.splice(Ce.lastIndexOf(Qe,Ce.length-et),1)):et++,ut=Ce[Ce.length-Ne],xe.push({command:hr.addLayer,args:[ie[Qe],ut]}),Ce.splice(Ce.length-Ne,0,Qe),Re[Qe]=!0);for(Ne=0;Ne<Pe.length;Ne++)if(Qe=Pe[Ne],tt=Le[Qe],_t=ie[Qe],!Re[Qe]&&!l(tt,_t))if(l(tt.source,_t.source)&&l(tt["source-layer"],_t["source-layer"])&&l(tt.type,_t.type)){for(Ct in cs(tt.layout,_t.layout,xe,Qe,null,hr.setLayoutProperty),cs(tt.paint,_t.paint,xe,Qe,null,hr.setPaintProperty),l(tt.filter,_t.filter)||xe.push({command:hr.setFilter,args:[Qe,_t.filter]}),l(tt.minzoom,_t.minzoom)&&l(tt.maxzoom,_t.maxzoom)||xe.push({command:hr.setLayerZoomRange,args:[Qe,_t.minzoom,_t.maxzoom]}),tt)tt.hasOwnProperty(Ct)&&Ct!=="layout"&&Ct!=="paint"&&Ct!=="filter"&&Ct!=="metadata"&&Ct!=="minzoom"&&Ct!=="maxzoom"&&(Ct.indexOf("paint.")===0?cs(tt[Ct],_t[Ct],xe,Qe,Ct.slice(6),hr.setPaintProperty):l(tt[Ct],_t[Ct])||xe.push({command:hr.setLayerProperty,args:[Qe,Ct,_t[Ct]]}));for(Ct in _t)_t.hasOwnProperty(Ct)&&!tt.hasOwnProperty(Ct)&&Ct!=="layout"&&Ct!=="paint"&&Ct!=="filter"&&Ct!=="metadata"&&Ct!=="minzoom"&&Ct!=="maxzoom"&&(Ct.indexOf("paint.")===0?cs(tt[Ct],_t[Ct],xe,Qe,Ct.slice(6),hr.setPaintProperty):l(tt[Ct],_t[Ct])||xe.push({command:hr.setLayerProperty,args:[Qe,Ct,_t[Ct]]}))}else xe.push({command:hr.removeLayer,args:[Qe]}),ut=Ce[Ce.lastIndexOf(Qe)+1],xe.push({command:hr.addLayer,args:[_t,ut]})}(H,S.layers,I)}catch(F){console.warn("Unable to compute style diff:",F),I=[{command:hr.setStyle,args:[S]}]}return I}(this.serialize(),r).filter(b=>!(b.command in ga));if(o.length===0)return!1;const u=o.filter(b=>!(b.command in Ps));if(u.length>0)throw new Error(`Unimplemented: ${u.map(b=>b.command).join(", ")}.`);return o.forEach(b=>{b.command!=="setTransition"&&b.command!=="setProjection"&&this[b.command].apply(this,b.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,o){return this.getImage(r)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,o),this._afterImageUpdated(r),this)}updateImage(r,o){this.imageManager.updateImage(r,o)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,o,u={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(t.validateSource,`sources.${r}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const b=Fi(r,o,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:b.serialize(),sourceId:r}));const S=I=>{const F=(I?"symbol:":"other:")+r,N=this._sourceCaches[F]=new t.SourceCache(F,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[r]=N,N.style=this,N.onAdd(this.map)};S(!1),o.type!=="vector"&&o.type!=="geojson"||S(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const o=this.getSource(r);if(!o)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===r)return this.fire(new t.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new t.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(r);for(const b of u)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,o){this._checkLoaded(),this.getSource(r).setData(o),this._changed=!0}getSource(r){const o=this._getSourceCache(r);return o&&o.getSource()}_getSources(){const r=[];for(const o in this._otherSourceCaches){const u=this._getSourceCache(o);u&&r.push(u.getSource())}return r}addLayer(r,o,u={}){this._checkLoaded();const b=r.id;if(this.getLayer(b))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let S;if(r.type==="custom"){if(Xn(this,t.validateCustomStyleLayer(r)))return;S=t.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(b,r.source),r=t.clone$1(r),r=t.extend(r,{source:b})),this._validate(t.validateLayer,`layers.${b}`,r,{arrayIndex:-1},u))return;S=t.createStyleLayer(r),this._validateLayer(S),S.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const I=o?this._order.indexOf(o):this._order.length;if(o&&I===-1)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=S;const F=this._getLayerSourceCache(S);if(this._removedLayers[b]&&S.source&&F&&S.type!=="custom"){const N=this._removedLayers[b];delete this._removedLayers[b],N.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",F.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,o){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===o)return;const u=this._order.indexOf(r);this._order.splice(u,1);const b=o?this._order.indexOf(o):this._order.length;o&&b===-1?this.fire(new t.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(b,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const o=this._layers[r];if(!o)return void this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const u=this._order.indexOf(r);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=o,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const o in this._layers)if(this._layers[o].type===r)return!0;return!1}setLayerZoomRange(r,o,u){this._checkLoaded();const b=this.getLayer(r);b?b.minzoom===o&&b.maxzoom===u||(o!=null&&(b.minzoom=o),u!=null&&(b.maxzoom=u),this._updateLayer(b)):this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,o,u={}){this._checkLoaded();const b=this.getLayer(r);if(b){if(!l(b.filter,o))return o==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(t.validateFilter,`layers.${b.id}.filter`,o,{layerType:b.type},u)||(b.filter=t.clone$1(o),this._updateLayer(b)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const o=this.getLayer(r);return o&&t.clone$1(o.filter)}setLayoutProperty(r,o,u,b={}){this._checkLoaded();const S=this.getLayer(r);S?l(S.getLayoutProperty(o),u)||(S.setLayoutProperty(o,u,b),this._updateLayer(S)):this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,o){const u=this.getLayer(r);if(u)return u.getLayoutProperty(o);this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,o,u,b={}){this._checkLoaded();const S=this.getLayer(r);S?l(S.getPaintProperty(o),u)||(S.setPaintProperty(o,u,b)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,o){const u=this.getLayer(r);return u&&u.getPaintProperty(o)}setFeatureState(r,o){this._checkLoaded();const u=r.source,b=r.sourceLayer,S=this.getSource(u);if(!S)return void this.fire(new t.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const I=S.type;if(I==="geojson"&&b)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!b)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const F=this._getSourceCaches(u);for(const N of F)N.setFeatureState(b,r.id,o)}removeFeatureState(r,o){this._checkLoaded();const u=r.source,b=this.getSource(u);if(!b)return void this.fire(new t.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const S=b.type,I=S==="vector"?r.sourceLayer:void 0;if(S==="vector"&&!I)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const F=this._getSourceCaches(u);for(const N of F)N.removeFeatureState(I,r.id,o)}getFeatureState(r){this._checkLoaded();const o=r.source,u=r.sourceLayer,b=this.getSource(o);if(b){if(b.type!=="vector"||u)return r.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(u,r.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();r[u.id]||(r[u.id]=u.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const o=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",o.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const o=I=>this._layers[I].type==="fill-extrusion",u={},b=[];for(let I=this._order.length-1;I>=0;I--){const F=this._order[I];if(o(F)){u[F]=I;for(const N of r){const H=N[F];if(H)for(const X of H)b.push(X)}}}b.sort((I,F)=>F.intersectionZ-I.intersectionZ);const S=[];for(let I=this._order.length-1;I>=0;I--){const F=this._order[I];if(o(F))for(let N=b.length-1;N>=0;N--){const H=b[N].feature;if(u[H.layer.id]<I)break;S.push(H),b.pop()}else for(const N of r){const H=N[F];if(H)for(const X of H)S.push(X.feature)}}return S}queryRenderedFeatures(r,o,u){o&&o.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const b={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of o.layers){const H=this._layers[N];if(!H)return this.fire(new t.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];b[H.source]=!0}}const S=[];o.availableImages=this._availableImages;const I=o&&o.layers?o.layers.some(N=>{const H=this.getLayer(N);return H&&H.is3D()}):this.has3DLayers(),F=Y.createFromScreenPoints(r,u);for(const N in this._sourceCaches){const H=this._sourceCaches[N].getSource().id;o.layers&&!b[H]||S.push(Ar(this._sourceCaches[N],this._layers,this._serializedLayers,F,o,u,I,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(N,H,X,ee,me,xe,Ee){const Pe={},Le=xe.queryRenderedSymbols(ee),ie=[];for(const Ce of Object.keys(Le).map(Number))ie.push(Ee[Ce]);ie.sort(kr);for(const Ce of ie){const Re=Ce.featureIndex.lookupSymbolFeatures(Le[Ce.bucketInstanceId],H,Ce.bucketIndex,Ce.sourceLayerIndex,me.filter,me.layers,me.availableImages,N);for(const Ne in Re){const et=Pe[Ne]=Pe[Ne]||[],Qe=Re[Ne];Qe.sort((tt,_t)=>{const ut=Ce.featureSortOrder;if(ut){const Ct=ut.indexOf(tt.featureIndex);return ut.indexOf(_t.featureIndex)-Ct}return _t.featureIndex-tt.featureIndex});for(const tt of Qe)et.push(tt)}}for(const Ce in Pe)Pe[Ce].forEach(Re=>{const Ne=Re.feature,et=X(N[Ce]);if(!et)return;const Qe=et.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=Qe});return Pe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),F.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(r,o){o&&o.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const u=this._getSourceCaches(r);let b=[];for(const S of u)b=b.concat(Pr(S,o));return b}addSourceType(r,o,u){return Ts.getSourceType(r)?u(new Error(`A source type called "${r}" already exists.`)):(Ts.setSourceType(r,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:o.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(r,o={}){this._checkLoaded();const u=this.light.getLight();let b=!1;for(const I in r)if(!l(r[I],u[I])){b=!0;break}if(!b)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,o),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,o=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let u=r;if(o===1){if(typeof u.source=="object"){const b="terrain-dem-src";this.addSource(b,u.source),u=t.clone$1(u),u=t.extend(u,{source:b})}if(this._validate(t.validateTerrain,"terrain",u))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,o)}else{const b=this.terrain,S=b.get();for(const I of Object.keys(t.spec.terrain))!u.hasOwnProperty(I)&&t.spec.terrain[I].default&&(u[I]=t.spec.terrain[I].default);for(const I in u)if(!l(u[I],S[I])){b.set(u),this.stylesheet.terrain=u;const F=this._setTransitionParameters({duration:0});b.updateTransitions(F);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const o=this.fog=new ae(r,this.map.transform);this.stylesheet.fog=r;const u=this._setTransitionParameters({duration:0});o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,u=o.get();Object.keys(r).length===0&&o.set(r);for(const b in r)if(!l(r[b],u[b])){o.set(r),this.stylesheet.fog=r;const S=this._setTransitionParameters({duration:0});o.updateTransitions(S);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:t.exported.now(),transition:t.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(u=>this.isLayerDraped(this._layers[u])),o=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...o)}_createTerrain(r,o){const u=this.terrain=new at(r,o);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});u.updateTransitions(b)}_force3DLayerUpdate(){for(const r in this._layers){const o=this._layers[r];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const o=this._layers[r];o.type==="symbol"&&this._updateLayer(o)}}_validate(r,o,u,b,S={}){return(!S||S.validate!==!1)&&Xn(this,r.call(t.validateStyle,t.extend({key:o,style:this.serialize(),value:u,styleSpec:t.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const o=this._getSourceCaches(r);for(const u of o)u.clearTiles()}_reloadSource(r){const o=this._getSourceCaches(r);for(const u of o)u.resume(),u.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const o in this._sourceCaches)this._sourceCaches[o].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const o=this._sourceCaches[r];o.resume(),o.reload()}}_updatePlacement(r,o,u,b,S=!1){let I=!1,F=!1;const N={};for(const H of this._order){const X=this._layers[H];if(X.type!=="symbol")continue;if(!N[X.source]){const me=this._getLayerSourceCache(X);if(!me)continue;N[X.source]=me.getRenderableIds(!0).map(xe=>me.getTileByID(xe)).sort((xe,Ee)=>Ee.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(Ee.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(X,N[X.source],r.center.lng,r.projection);I=I||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),r.zoom))&&(this.pauseablePlacement=new sn(r,this._order,S,o,u,b,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),F=!0),I&&this.pauseablePlacement.placement.setStale()),F||I)for(const H of this._order){const X=this._layers[H];X.type==="symbol"&&this.placement.updateLayerOpacities(X,N[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,o,u){this.imageManager.getImages(o.icons,u),this._updateTilesForChangedImages();const b=S=>{S&&S.setDependencies(o.tileID.key,o.type,o.icons)};b(this._otherSourceCaches[o.source]),b(this._symbolSourceCaches[o.source])}getGlyphs(r,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(r,o,u){return t.makeRequest(o,u)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const o=[];return this._otherSourceCaches[r]&&o.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&o.push(this._symbolSourceCaches[r]),o}_isSourceCacheLoaded(r){const o=this._getSourceCaches(r);return o.length===0?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ts.getSourceType=function(h){return ki[h]},Ts.setSourceType=function(h,r){ki[h]=r},Ts.registerForPluginStateChange=t.registerForPluginStateChange;var Js=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,us="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ms=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Tn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ta={},Ls={};const _a=[];Bo(Js,_a),Bo(Qs,_a),Bo(Ms,_a),Bo(Tn,_a),ta=mr("",Qs),Ls=mr(Tn,Ms);const ya=mr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ja=Js,va=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var xa={background:mr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:mr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:mr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:mr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:mr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:mr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:mr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:mr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:mr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:mr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:mr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:mr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:mr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,us),skyboxGradient:mr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,us),skyboxCapture:mr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Bo(h,r){const o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of o)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=u.split(" ");for(const S of b)r.includes(S)||r.push(S)}}function mr(h,r){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},S=[..._a];return Bo(h,S),Bo(r,S),{fragmentSource:h=h.replace(o,(I,F,N,H,X)=>(b[X]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
varying ${N} ${H} ${X};
#else
uniform ${N} ${H} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${N} ${H} ${X} = u_${X};
#endif
`)),vertexSource:r=r.replace(o,(I,F,N,H,X)=>{const ee=H==="float"?"vec2":"vec4",me=X.match(/color/)?"color":ee;return b[X]?F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${N} ${ee} a_${X};
varying ${N} ${H} ${X};
#else
uniform ${N} ${H} u_${X};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${N} ${H} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${me}(a_${X}, u_${X}_t);
#else
    ${N} ${H} ${X} = u_${X};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${N} ${ee} a_${X};
#else
uniform ${N} ${H} u_${X};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${N} ${H} ${X} = a_${X};
#else
    ${N} ${H} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${N} ${H} ${X} = unpack_mix_${me}(a_${X}, u_${X}_t);
#else
    ${N} ${H} ${X} = u_${X};
#endif
`}),staticAttributes:u,usedDefines:S}}class Il{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,o,u,b,S,I,F){this.context=r;let N=this.boundPaintVertexBuffers.length!==b.length;for(let X=0;!N&&X<b.length;X++)this.boundPaintVertexBuffers[X]!==b[X]&&(N=!0);let H=this.boundDynamicVertexBuffers.length!==F.length;for(let X=0;!H&&X<F.length;X++)this.boundDynamicVertexBuffers[X]!==F[X]&&(H=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||N||H||this.boundIndexBuffer!==S||this.boundVertexOffset!==I)this.freshBind(o,u,b,S,I,F);else{r.bindVertexArrayOES.set(this.vao);for(const X of F)X&&X.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(r,o,u,b,S,I){let F;const N=r.numAttributes,H=this.context,X=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=r,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=b,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=I;else{F=H.currentNumAttributes||0;for(let ee=N;ee<F;ee++)X.disableVertexAttribArray(ee)}o.enableAttributes(X,r),o.bind(),o.setVertexAttribPointers(X,r,S);for(const ee of u)ee.enableAttributes(X,r),ee.bind(),ee.setVertexAttribPointers(X,r,S);for(const ee of I)ee&&(ee.enableAttributes(X,r),ee.bind(),ee.setVertexAttribPointers(X,r,S));b&&b.bind(),H.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ba(h,r){const o=Math.pow(2,r.canonical.z),u=r.canonical.y;return[new t.MercatorCoordinate(0,u/o).toLngLat().lat,new t.MercatorCoordinate(0,(u+1)/o).toLngLat().lat]}function kl(h,r,o,u,b,S,I){const F=h.context,N=F.gl,H=o.fbo;if(!H)return;h.prepareDrawTile();const X=h.useProgram("hillshade");F.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,H.colorAttachment.get());const ee=((Pe,Le,ie,Ce)=>{const Re=ie.paint.get("hillshade-shadow-color"),Ne=ie.paint.get("hillshade-highlight-color"),et=ie.paint.get("hillshade-accent-color");let Qe=ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Qe-=Pe.transform.angle);const tt=!Pe.options.moving;return{u_matrix:Ce||Pe.transform.calculateProjMatrix(Le.tileID.toUnwrapped(),tt),u_image:0,u_latrange:ba(0,Le.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Qe],u_shadow:Re,u_highlight:Ne,u_accent:et}})(h,o,u,h.terrain?r.projMatrix:null);h.prepareDrawProgram(F,X,r.toUnwrapped());const{tileBoundsBuffer:me,tileBoundsIndexBuffer:xe,tileBoundsSegments:Ee}=h.getTileBoundsBuffers(o);X.draw(F,N.TRIANGLES,b,S,I,t.CullFaceMode.disabled,ee,u.id,me,xe,Ee)}function Dl(h,r,o){if(!r.needsDEMTextureUpload)return;const u=h.context,b=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(o.stride);const S=o.getPixels();r.demTexture?r.demTexture.update(S,{premultiply:!1}):r.demTexture=new t.Texture(u,S,b.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function wa(h,r,o,u,b,S){const I=h.context,F=I.gl;if(!r.dem)return;const N=r.dem;if(I.activeTexture.set(F.TEXTURE1),Dl(h,r,N),!r.demTexture)return;r.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);const H=N.dim;I.activeTexture.set(F.TEXTURE0);let X=r.fbo;if(!X){const Ee=new t.Texture(I,{width:H,height:H,data:null},F.RGBA);Ee.bind(F.LINEAR,F.CLAMP_TO_EDGE),X=r.fbo=I.createFramebuffer(H,H,!0),X.colorAttachment.set(Ee.texture)}I.bindFramebuffer.set(X.framebuffer),I.viewport.set([0,0,H,H]);const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:me,tileBoundsSegments:xe}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(I,F.TRIANGLES,u,b,S,t.CullFaceMode.disabled,((Ee,Pe)=>{const Le=Pe.stride,ie=t.create();return t.ortho(ie,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(ie,ie,[0,-t.EXTENT,0]),{u_matrix:ie,u_image:1,u_dimension:[Le,Le],u_zoom:Ee.overscaledZ,u_unpack:Pe.unpackVector}})(r.tileID,N),o.id,ee,me,xe),r.needsHillshadePrepare=!1}const No=h=>({u_matrix:new t.UniformMatrix4f(h),u_image0:new t.Uniform1i(h),u_skirt_height:new t.Uniform1f(h)}),mo=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),eo=(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:o,u_zoom_transition:b,u_merc_center:S,u_image0:0,u_frustum_tl:I,u_frustum_tr:F,u_frustum_br:N,u_frustum_bl:H,u_globe_pos:X,u_globe_radius:ee,u_viewport:me,u_grid_matrix:Ee?Float32Array.from(Ee):new Float32Array(9),u_skirt_height:xe});function go(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}const U=new class{constructor(){this.operations={}}newMorphing(h,r,o,u,b){if(h in this.operations){const S=this.operations[h];S.to.tileID.key!==o.tileID.key&&(S.queued=o)}else this.operations[h]={startTime:u,phase:0,duration:b,from:r,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const o=this.operations[r];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ue={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ye(h){return 6*Math.pow(1.5,22-h)}function pt(h,r){const o=1<<h.z;return!r&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}const It=h=>({u_matrix:h});function Zt(h,r,o,u,b){if(b>0){const S=t.exported.now(),I=(S-h.timeAdded)/b,F=r?(S-r.timeAdded)/b:-1,N=o.getSource(),H=u.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),X=!r||Math.abs(r.tileID.overscaledZ-H)>Math.abs(h.tileID.overscaledZ-H),ee=X&&h.refreshedUponExpiration?1:t.clamp(X?I:1-F,0,1);return h.refreshedUponExpiration&&I>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class pi extends t.SourceCache{constructor(r){const o={type:"raster-dem",maxzoom:r.transform.maxZoom},u=new Te(Bn(),null),b=Fi("mock-dem",o,u,r.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,o){r.state="loaded",o(null)}}class Ei extends t.SourceCache{constructor(r){const o=Fi("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Te(Bn(),null),r.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,o,u){if(r.freezeTileCoverage)return;this.transform=r;const b=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,I)=>{if(S[I.key]="",!this._tiles[I.key]){const F=new t.Tile(I,this._source.tileSize*I.overscaleFactor(),r.tileZoom);F.state="loaded",this._tiles[I.key]=F}return S},{});for(const S in this._tiles)S in b||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(r){const o=this.proxyCachedFBO[r];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qi extends t.OverscaledTileID{constructor(r,o,u){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class lr extends t.Elevation{constructor(r,o){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,b,S]=function(N){const H=new t.StructArrayLayout2i4,X=new t.StructArrayLayout3ui6,ee=131;H.reserve(17161),X.reserve(33800);const me=t.EXTENT/128,xe=t.EXTENT+me/2,Ee=xe+me;for(let Le=-me;Le<Ee;Le+=me)for(let ie=-me;ie<Ee;ie+=me){const Ce=ie<0||ie>xe||Le<0||Le>xe?24575:0,Re=t.clamp(Math.round(ie),0,t.EXTENT),Ne=t.clamp(Math.round(Le),0,t.EXTENT);H.emplaceBack(Re+Ce,Ne)}const Pe=(Le,ie)=>{const Ce=ie*ee+Le;X.emplaceBack(Ce+1,Ce,Ce+ee),X.emplaceBack(Ce+ee,Ce+ee+1,Ce+1)};for(let Le=1;Le<129;Le++)for(let ie=1;ie<129;ie++)Pe(ie,Le);return[0,129].forEach(Le=>{for(let ie=0;ie<130;ie++)Pe(ie,Le),Pe(Le,ie)}),[H,X,32768]}(),I=r.context;this.gridBuffer=I.createVertexBuffer(u,t.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=t.SegmentVector.simpleSegment(0,0,u.length,b.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,u.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ei(o.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.EXTENT,0,t.EXTENT,0,1);const F=I.gl;this._overlapStencilMode=new t.StencilMode({func:F.GEQUAL,mask:255},0,255,F.KEEP,F.KEEP,F.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pi(o.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,o,u){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const b=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const S=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(o,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),o.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&t.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=o.getIds().map(N=>{const H=o.getTileByID(N).tileID;return H.projMatrix=u.calculateProjMatrix(H.toUnwrapped()),H});(function(N,H){const X=H.transform.pointCoordinate(H.transform.getCameraPoint()),ee=new t.Point(X.x,X.y);N.sort((me,xe)=>{if(xe.overscaledZ-me.overscaledZ)return xe.overscaledZ-me.overscaledZ;const Ee=new t.Point(me.canonical.x+(1<<me.canonical.z)*me.wrap,me.canonical.y),Pe=new t.Point(xe.canonical.x+(1<<xe.canonical.z)*xe.wrap,xe.canonical.y),Le=ee.mult(1<<me.canonical.z);return Le.x-=.5,Le.y-=.5,Le.distSqr(Ee)-Le.distSqr(Pe)})})(b,this.painter),this._previousZoom=u.zoom;const S=this.proxyToSource||{};this.proxyToSource={},b.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const N in I){const H=I[N];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,r[N],S),H.usedForTerrain))continue;const X=r[N];H.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[o.id]=b.map(N=>new qi(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const F={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const H=this.terrainTileForTile[N.key];if(!H)continue;const X=H.tileID.key;X in F||(this._visibleDemTiles.push(H),F[X]=X)}}_assignTerrainTiles(r){this._initializing||r.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const r=this.painter.context,o=r.gl;for(const u in this.terrainTileForTile){const b=this.terrainTileForTile[u],S=b.dem;!S||b.demTexture&&!b.needsDEMTextureUpload||(r.activeTexture.set(o.TEXTURE1),Dl(this.painter,b,S))}}_prepareDemTileUniforms(r,o,u,b){if(!o||o.demTexture==null)return!1;const S=r.tileID.canonical,I=Math.pow(2,o.tileID.canonical.z-S.z),F=b||"";return u[`u_dem_tl${F}`]=[S.x*I%1,S.y*I%1],u[`u_dem_scale${F}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,o=r.gl;if(!this._emptyDepthBufferTexture){const u=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(r,u,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const o=this._visibleDemTiles.reduce((u,b)=>{if(!b.dem)return u;const S=b.dem.tree.minimums[0];return S>0&&r++,u+S},0);return r?o/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,o=r.gl;r.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),b=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(b,{premultiply:!1}):S=this._emptyDEMTexture=new t.Texture(r,b,o.RGBA,{premultiply:!1}),S}setupElevationDraw(r,o,u){const b=this.painter.context,S=b.gl,I=(F=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(F),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var F;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let N=null,H=null,X=1;if(u&&u.morphing&&this._useVertexMorphing){const ee=u.morphing.srcDemTile,me=u.morphing.dstDemTile;X=u.morphing.phase,ee&&me&&(this._prepareDemTileUniforms(r,ee,I,"_prev")&&(H=ee),this._prepareDemTileUniforms(r,me,I)&&(N=me))}if(H&&N?(b.activeTexture.set(S.TEXTURE2),N.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),b.activeTexture.set(S.TEXTURE4),H.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),I.u_dem_lerp=X):(N=this.terrainTileForTile[r.tileID.key],b.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(r,N,I)?N.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),b.activeTexture.set(S.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&N){const ee=(1<<N.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=ee}if(u&&u.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(b,I),this.painter.transform.projection.name==="globe"){const ee=this.globeUniformValues(this.painter.transform,r.tileID.canonical,u&&u.useDenormalizedUpVectorScale);o.setGlobeUniformValues(b,ee)}}globeUniformValues(r,o,u){const b=r.projection;return{u_tile_tl_up:b.upVector(o,0,0),u_tile_tr_up:b.upVector(o,t.EXTENT,0),u_tile_br_up:b.upVector(o,t.EXTENT,t.EXTENT),u_tile_bl_up:b.upVector(o,0,t.EXTENT),u_tile_up_scale:u?t.globeMetersToEcef(1):b.upVectorScale(o,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const o=this.painter,u=this.painter.context;r.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,S,I,F,N){if(b.transform.projection.name==="globe")(function(H,X,ee,me,xe){const Ee=H.context,Pe=Ee.gl;let Le,ie;const Ce=H.options.showTerrainWireframe?2:0,Re=H.transform,Ne=t.globeUseCustomAntiAliasing(H,Ee,Re),et=(ii,Mt)=>{if(ie===ii)return;const Xt=[ue[ii],"PROJECTION_GLOBE_VIEW"];Ne&&Xt.push("CUSTOM_ANTIALIASING"),Mt&&Xt.push(ue[Ce]),Le=H.useProgram("globeRaster",null,Xt),ie=ii},Qe=H.colorModeForRenderPass(),tt=new t.DepthMode(Pe.LEQUAL,t.DepthMode.ReadWrite,H.depthRangeFor3D);U.update(xe);const _t=t.calculateGlobeMercatorMatrix(Re),ut=[t.mercatorXfromLng(Re.center.lng),t.mercatorYfromLat(Re.center.lat)],Ct=Ce?[!1,!0]:[!1],ei=H.globeSharedBuffers,Tt=[Re.width*t.exported.devicePixelRatio,Re.height*t.exported.devicePixelRatio],Gt=Float32Array.from(Re.globeMatrix),Pt={useDenormalizedUpVectorScale:!0};if(Ct.forEach(ii=>{const Mt=H.transform,Xt=Ye(Mt.zoom)*X.exaggeration();ie=-1;const oi=ii?Pe.LINES:Pe.TRIANGLES;for(const qt of me){const ci=ee.getTile(qt),Oi=t.StencilMode.disabled,$i=X.prevTerrainTileForTile[qt.key],Si=X.terrainTileForTile[qt.key];go($i,Si)&&U.newMorphing(qt.key,$i,Si,xe,250),Ee.activeTexture.set(Pe.TEXTURE0),ci.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);const zi=U.getMorphValuesForProxy(qt.key),rr=zi?1:0;zi&&t.extend$1(Pt,{morphing:{srcDemTile:zi.from,dstDemTile:zi.to,phase:t.easeCubicInOut(zi.phase)}});const Xi=t.tileCornersToBounds(qt.canonical),Pi=t.getLatitudinalLod(Xi.getCenter().lat),yr=t.getGridMatrix(qt.canonical,Xi,Pi,Mt.worldSize/Mt._pixelsPerMercatorPixel),Lr=t.globeNormalizeECEF(t.globeTileBounds(qt.canonical)),Tr=eo(Mt.projMatrix,Gt,_t,Lr,t.globeToMercatorTransition(Mt.zoom),ut,Mt.frustumCorners.TL,Mt.frustumCorners.TR,Mt.frustumCorners.BR,Mt.frustumCorners.BL,Mt.globeCenterInViewSpace,Mt.globeRadius,Tt,Xt,yr);if(et(rr,ii),X.setupElevationDraw(ci,Le,Pt),H.prepareDrawProgram(Ee,Le,qt.toUnwrapped()),ei){const[Ir,Cn,wn]=ii?ei.getWirefameBuffers(H.context,Pi):ei.getGridBuffers(Pi,Xt!==0);Le.draw(Ee,oi,tt,Oi,Qe,t.CullFaceMode.backCCW,Tr,"globe_raster",Ir,Cn,wn)}}}),ei){const ii=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ne&&ii.push("CUSTOM_ANTIALIASING"),Le=H.useProgram("globeRaster",null,ii);for(const Mt of me){const{x:Xt,y:oi,z:qt}=Mt.canonical,ci=oi===0,Oi=oi===(1<<qt)-1,[$i,Si,zi,rr]=ei.getPoleBuffers(qt);if(rr&&(ci||Oi)){const Xi=ee.getTile(Mt);Ee.activeTexture.set(Pe.TEXTURE0),Xi.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);let Pi=t.globePoleMatrixForTile(qt,Xt,Re);const yr=t.globeNormalizeECEF(t.globeTileBounds(Mt.canonical)),Lr=(Tr,Ir)=>Tr.draw(Ee,Pe.TRIANGLES,tt,t.StencilMode.disabled,Qe,t.CullFaceMode.disabled,eo(Re.projMatrix,Pi,Pi,yr,0,ut,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,Tt,0),"globe_pole_raster",Ir,zi,rr);X.setupElevationDraw(Xi,Le,Pt),H.prepareDrawProgram(Ee,Le,Mt.toUnwrapped()),ci&&Lr(Le,$i),Oi&&(Pi=t.scale(t.create(),Pi,[1,-1,1]),Lr(Le,Si))}}}})(b,S,I,F,N);else{const H=b.context,X=H.gl;let ee,me;const xe=b.options.showTerrainWireframe?2:0,Ee=(Re,Ne)=>{if(me===Re)return;const et=[ue[Re]];Ne&&et.push(ue[xe]),ee=b.useProgram("terrainRaster",null,et),me=Re},Pe=b.colorModeForRenderPass(),Le=new t.DepthMode(X.LEQUAL,t.DepthMode.ReadWrite,b.depthRangeFor3D);U.update(N);const ie=b.transform,Ce=Ye(ie.zoom)*S.exaggeration();(xe?[!1,!0]:[!1]).forEach(Re=>{me=-1;const Ne=Re?X.LINES:X.TRIANGLES,[et,Qe]=Re?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const tt of F){const _t=I.getTile(tt),ut=t.StencilMode.disabled,Ct=S.prevTerrainTileForTile[tt.key],ei=S.terrainTileForTile[tt.key];go(Ct,ei)&&U.newMorphing(tt.key,Ct,ei,N,250),H.activeTexture.set(X.TEXTURE0),_t.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const Tt=U.getMorphValuesForProxy(tt.key),Gt=Tt?1:0;let Pt;Tt&&(Pt={morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:t.easeCubicInOut(Tt.phase)}});const ii=mo(tt.projMatrix,pt(tt.canonical,ie.renderWorldCopies)?Ce/10:Ce);Ee(Gt,Re),S.setupElevationDraw(_t,ee,Pt),b.prepareDrawProgram(H,ee,tt.toUnwrapped()),ee.draw(H,Ne,Le,ut,Pe,t.CullFaceMode.backCCW,ii,"terrain_raster",S.gridBuffer,et,Qe)}})}}(o,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,b=this.proxySourceCache,S=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),F=[],N=o.style.order;let H=0;for(const X of S){const ee=b.getTileByID(X.proxyTileKey),me=b.proxyCachedFBO[X.key]?b.proxyCachedFBO[X.key][r]:void 0,xe=me!==void 0?b.renderCache[me]:this.pool[H++],Ee=me!==void 0;if(ee.texture=xe.tex,Ee&&!xe.dirty){F.push(ee.tileID);continue}let Pe;u.bindFramebuffer.set(xe.fb.framebuffer),this.renderedToTile=!1,xe.dirty&&(u.clear({color:t.Color.transparent,stencil:0}),xe.dirty=!1);for(let Le=I.start;Le<=I.end;++Le){const ie=o.style._layers[N[Le]];if(ie.isHidden(o.transform.zoom))continue;const Ce=o.style._getLayerSourceCache(ie),Re=Ce?this.proxyToSource[X.key][Ce.id]:[X];if(!Re)continue;const Ne=Re;u.viewport.set([0,0,xe.fb.width,xe.fb.height]),Pe!==(Ce?Ce.id:null)&&(this._setupStencil(xe,Re,ie,Ce),Pe=Ce?Ce.id:null),o.renderLayer(o,Ce,ie,Ne)}this.renderedToTile?(xe.dirty=!0,F.push(ee.tileID)):Ee||--H,H===5&&(H=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),I.end+1}postRender(){}renderCacheEfficiency(r){const o=r.order.length;if(o===0)return{efficiency:100};let u,b=0,S=0,I=!1;for(let F=0;F<o;++F){const N=r._layers[r.order[F]];this._style.isLayerDraped(N)?(I&&++b,++S):I||(I=!0,u=N.id)}return S===0?{efficiency:100}:{efficiency:100*(1-b/S),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{r=Math.min(r,o.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,o,u){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const I=S.tileID,F=1<<I.overscaledZ,{x:N,y:H}=I.canonical,X=N/F,ee=(N+1)/F,me=H/F,xe=(H+1)/F;return{minx:X,miny:me,maxx:ee,maxy:xe,t:S.dem.tree.raycastRoot(X,me,ee,xe,r,o,u),tile:S}});b.sort((S,I)=>(S.t!==null?S.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const S of b){if(S.t==null)return null;const I=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,r,o,u);if(I!=null)return I}return null}_createFBO(){const r=this.painter.context,o=r.gl,u=this.drapeBufferSize;r.activeTexture.set(o.TEXTURE0);const b=new t.Texture(r,{width:u[0],height:u[1],data:null},o.RGBA);b.bind(o.LINEAR,o.CLAMP_TO_EDGE);const S=r.createFramebuffer(u[0],u[1],!1);return S.colorAttachment.set(b.texture),S.depthAttachment=new st(r,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:S,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const o=this._style._layers[r],u=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!u&&o.shouldRedrape():!u&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const u of this._style._getSources())if(u instanceof Vt){r=!0;break}if(!r)return;const o={};for(let u=0;u<this._style.order.length;++u){const b=this._style._layers[this._style.order[u]],S=this._style._getLayerSourceCache(b);if(S&&!o[S.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof t.ZoomDependentExpression){o[S.id]=!0;for(const I of this.proxyCoords){const F=this.proxyToSource[I.key][S.id];if(F)for(const N of F)this._clearRenderCacheForTile(S.id,N)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof ni){r=!0;break}if(!r)return;const o={};for(let u=0;u<this._style.order.length;++u){const b=this._style._layers[this._style.order[u]],S=this._style._getLayerSourceCache(b);if(!S||o[S.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const I=b.paint.get("raster-fade-duration");for(const F of this.proxyCoords){const N=this.proxyToSource[F.key][S.id];if(N)for(const H of N){const X=Zt(S.getTile(H),S.findLoadedParent(H,0),S,this.painter.transform,I);(X.opacity!==1||X.mix!==0)&&this._clearRenderCacheForTile(S.id,H)}}}}_setupDrapedRenderBatches(){const r=this._style.order,o=r.length;if(o===0)return;const u=[];let b,S=0,I=this._style._layers[r[S]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++S<o;)I=this._style._layers[r[S]];for(;S<o;++S){const F=this._style._layers[r[S]];F.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(F)?b===void 0&&(b=S):b!==void 0&&(u.push({start:b,end:S-1}),b=void 0))}b!==void 0&&u.push({start:b,end:S-1}),this._drapedRenderBatches=u}_setupRenderCache(r){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const I=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let F=0;F<I.length;++F){const N=Object.values(I[F]);o.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,b=this._tilesDirty;for(let I=u.length-1;I>=0;I--){const F=u[I];if(o.getTileByID(F.key),o.proxyCachedFBO[F.key]!==void 0){const N=r[F.key],H=this.proxyToSource[F.key];let X=0;for(const ee in H){const me=H[ee],xe=N[ee];if(!xe||xe.length!==me.length||me.some((Ee,Pe)=>Ee!==xe[Pe]||b[ee]&&b[ee].hasOwnProperty(Ee.key))){X=-1;break}++X}for(const ee in o.proxyCachedFBO[F.key])o.renderCache[o.proxyCachedFBO[F.key][ee]].dirty=X<0||X!==Object.values(N).length}}const S=[...this._drapedRenderBatches];S.sort((I,F)=>F.end-F.start-(I.end-I.start));for(const I of S)for(const F of u){if(o.proxyCachedFBO[F.key])continue;let N=o.renderCachePool.pop();N===void 0&&o.renderCache.length<50&&(N=o.renderCache.length,o.renderCache.push(this._createFBO())),N!==void 0&&(o.proxyCachedFBO[F.key]={},o.proxyCachedFBO[F.key][I.start]=N,o.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(r,o,u,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,I=S.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let F;if(u.isTileClipped())F=o.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);F=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+F>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=F,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(r,o){const u=this.painter,b=this.painter.context,S=b.gl;u._tileClippingMaskIDs={},b.setColorMode(t.ColorMode.disabled),b.setDepthMode(t.DepthMode.disabled);const I=u.useProgram("clippingMask");for(const F of r){const N=u._tileClippingMaskIDs[F.key]=--o;I.draw(b,S.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:S.ALWAYS,mask:0},N,255,S.KEEP,S.KEEP,S.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,It(F.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(r){const o=this.painter.transform;if(r.x<0||r.x>o.width||r.y<0||r.y>o.height)return null;const u=[r.x,r.y,1,1];t.transformMat4$1(u,u,o.pixelMatrixInverse),t.scale$1(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const b=o._camera.position,S=t.mercatorZfromAltitude(1,o.center.lat),I=[b[0],b[1],b[2]/S,0],F=t.subtract([],u.slice(0,3),I);t.normalize(F,F);const N=this.raycast(I,F,this._exaggeration);return N!==null&&N?(t.scaleAndAdd(I,I,F,N),I[3]=I[2],I[2]*=S,I):null}drawDepth(){const r=this.painter,o=r.context,u=this.proxySourceCache,b=Math.ceil(r.width),S=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=o.gl,F=o.createFramebuffer(b,S,!0);o.activeTexture.set(I.TEXTURE0);const N=new t.Texture(o,{width:b,height:S,data:null},I.RGBA);N.bind(I.NEAREST,I.CLAMP_TO_EDGE),F.colorAttachment.set(N.texture);const H=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,b,S);F.depthAttachment.set(H),this._depthFBO=F,this._depthTexture=N}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,b,S]),function(I,F,N,H){if(I.transform.projection.name==="globe")return;const X=I.context,ee=X.gl;X.clear({depth:1});const me=I.useProgram("terrainDepth"),xe=new t.DepthMode(ee.LESS,t.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Ee of H){const Pe=N.getTile(Ee),Le=mo(Ee.projMatrix,0);F.setupElevationDraw(Pe,me),me.draw(X,ee.TRIANGLES,xe,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,Le,"terrain_depth",F.gridBuffer,F.gridIndexBuffer,F.gridNoSkirtSegments)}}(r,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,o,u){if(r.getSource()instanceof Vi)return this._setupProxiedCoordsForImageSource(r,o,u);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const b=this.proxiedCoords[r.id]=[],S=this.proxyCoords;for(let F=0;F<S.length;F++){const N=S[F],H=this._findTileCoveringTileID(N,r);if(H){const X=this._createProxiedId(N,H,u[N.key]&&u[N.key][r.id]);b.push(X),this.proxyToSource[N.key][r.id]=[X]}}let I=!1;for(let F=0;F<o.length;F++){const N=r.getTile(o[F]);if(!N||!N.hasData())continue;const H=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==N.tileID.canonical.z){const X=this.proxyToSource[H.tileID.key][r.id],ee=this._createProxiedId(H.tileID,N,u[H.tileID.key]&&u[H.tileID.key][r.id]);X?X.splice(X.length-1,0,ee):this.proxyToSource[H.tileID.key][r.id]=[ee],b.push(ee),I=!0}}this._sourceTilesOverlap[r.id]=I}_setupProxiedCoordsForImageSource(r,o,u){if(!r.getSource().loaded())return;const b=this.proxiedCoords[r.id]=[],S=this.proxyCoords,I=r.getSource(),F=new t.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),N=I.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((X,ee)=>(X.min.x=Math.min(X.min.x,ee.x-F.x),X.min.y=Math.min(X.min.y,ee.y-F.y),X.max.x=Math.max(X.max.x,ee.x-F.x),X.max.y=Math.max(X.max.y,ee.y-F.y),X),{min:new t.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(X,ee)=>{const me=X.wrap+X.canonical.x/(1<<X.canonical.z),xe=X.canonical.y/(1<<X.canonical.z),Ee=t.EXTENT/(1<<X.canonical.z),Pe=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Le=ee.canonical.y/(1<<ee.canonical.z);return me+Ee<Pe+N.min.x||me>Pe+N.max.x||xe+Ee<Le+N.min.y||xe>Le+N.max.y};for(let X=0;X<S.length;X++){const ee=S[X];for(let me=0;me<o.length;me++){const xe=r.getTile(o[me]);if(!xe||!xe.hasData()||H(ee,xe.tileID))continue;const Ee=this._createProxiedId(ee,xe,u[ee.key]&&u[ee.key][r.id]),Pe=this.proxyToSource[ee.key][r.id];Pe?Pe.push(Ee):this.proxyToSource[ee.key][r.id]=[Ee],b.push(Ee)}}}_createProxiedId(r,o,u){let b=this.orthoMatrix;if(u){const S=u.find(I=>I.key===o.tileID.key);if(S)return S}if(o.tileID.key!==r.key){const S=r.canonical.z-o.tileID.canonical.z;let I,F,N;b=t.create();const H=o.tileID.wrap-r.wrap<<r.overscaledZ;S>0?(I=t.EXTENT>>S,F=I*((o.tileID.canonical.x<<S)-r.canonical.x+H),N=I*((o.tileID.canonical.y<<S)-r.canonical.y)):(I=t.EXTENT<<-S,F=t.EXTENT*(o.tileID.canonical.x-(r.canonical.x+H<<-S)),N=t.EXTENT*(o.tileID.canonical.y-(r.canonical.y<<-S))),t.ortho(b,0,I,0,I,0,1),t.translate(b,b,[F,N,0])}return new qi(o.tileID,r.key,b)}_findTileCoveringTileID(r,o){let u=o.getTile(r);if(u&&u.hasData())return u;const b=this._findCoveringTileCache[o.id],S=b[r.key];if(u=S?o.getTileByID(S):null,u&&u.hasData()||S===null)return u;let I=u?u.tileID:r,F=I.overscaledZ;const N=o.getSource().minzoom,H=[];if(!S){const ee=o.getSource().maxzoom;if(r.canonical.z>=ee){const me=r.canonical.z-ee;o.getSource().reparseOverscaled?(F=Math.max(r.canonical.z+2,o.transform.tileZoom),I=new t.OverscaledTileID(F,r.wrap,ee,r.canonical.x>>me,r.canonical.y>>me)):me!==0&&(F=ee,I=new t.OverscaledTileID(F,r.wrap,ee,r.canonical.x>>me,r.canonical.y>>me))}I.key!==r.key&&(H.push(I.key),u=o.getTile(I))}const X=ee=>{H.forEach(me=>{b[me]=ee}),H.length=0};for(F-=1;F>=N&&(!u||!u.hasData());F--){u&&X(u.tileID.key);const ee=I.calculateScaledKey(F);if(u=o.getTileByID(ee),u&&u.hasData())break;const me=b[ee];if(me===null)break;me===void 0?H.push(ee):u=o.getTileByID(me)}return X(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,o){let u=this._tilesDirty[r];u||(u=this._tilesDirty[r]={}),u[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(o){let u=0;const b=new t.StructArrayLayout2ui4,S=131;for(let I=1;I<129;I++){for(let F=1;F<129;F++)u=I*S+F,b.emplaceBack(u,u+1),b.emplaceBack(u,u+S),b.emplaceBack(u+1,u+S),I===128&&b.emplaceBack(u+S,u+S+1);b.emplaceBack(u+1,u+1+S)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ci{static cacheKey(r,o,u,b){let S=`${o}${b?b.cacheKey:""}`;for(const I of u)r.usedDefines.includes(I)&&(S+=`/${I}`);return S}constructor(r,o,u,b,S,I){const F=r.gl;this.program=F.createProgram();const N=function(ie){const Ce=[];for(let Re=0;Re<ie.length;Re++){if(ie[Re]===null)continue;const Ne=ie[Re].split(" ");Ce.push(Ne.pop())}return Ce}(u.staticAttributes),H=b?b.getBinderAttributes():[],X=N.concat(H);let ee=b?b.defines():[];ee=ee.concat(I.map(ie=>`#define ${ie}`));const me=r.isWebGL2?`#version 300 es
`:"",xe=me+ee.concat(r.extStandardDerivatives&&me.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(va):va,va,Ja,ya.fragmentSource,Ls.fragmentSource,u.fragmentSource).join(`
`),Ee=me+ee.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ja,ya.vertexSource,Ls.vertexSource,ta.vertexSource,u.vertexSource).join(`
`),Pe=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);F.shaderSource(Pe,xe),F.compileShader(Pe),F.attachShader(this.program,Pe);const Le=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(Le,Ee),F.compileShader(Le),F.attachShader(this.program,Le),this.attributes={},this.numAttributes=X.length;for(let ie=0;ie<this.numAttributes;ie++)X[ie]&&(F.bindAttribLocation(this.program,ie,X[ie]),this.attributes[X[ie]]=ie);F.linkProgram(this.program),F.deleteShader(Le),F.deleteShader(Pe),this.fixedUniforms=S(r),this.binderUniforms=b?b.getUniforms(r):[],I.includes("TERRAIN")&&(this.terrainUniforms=(ie=>({u_dem:new t.Uniform1i(ie),u_dem_prev:new t.Uniform1i(ie),u_dem_unpack:new t.Uniform4f(ie),u_dem_tl:new t.Uniform2f(ie),u_dem_scale:new t.Uniform1f(ie),u_dem_tl_prev:new t.Uniform2f(ie),u_dem_scale_prev:new t.Uniform1f(ie),u_dem_size:new t.Uniform1f(ie),u_dem_lerp:new t.Uniform1f(ie),u_exaggeration:new t.Uniform1f(ie),u_depth:new t.Uniform1i(ie),u_depth_size_inv:new t.Uniform2f(ie),u_meter_to_dem:new t.Uniform1f(ie),u_label_plane_matrix_inv:new t.UniformMatrix4f(ie)}))(r)),I.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new t.Uniform3f(ie),u_tile_tr_up:new t.Uniform3f(ie),u_tile_br_up:new t.Uniform3f(ie),u_tile_bl_up:new t.Uniform3f(ie),u_tile_up_scale:new t.Uniform1f(ie)}))(r)),I.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new t.UniformMatrix4f(ie),u_fog_range:new t.Uniform2f(ie),u_fog_color:new t.Uniform4f(ie),u_fog_horizon_blend:new t.Uniform1f(ie),u_fog_temporal_offset:new t.Uniform1f(ie),u_frustum_tl:new t.Uniform3f(ie),u_frustum_tr:new t.Uniform3f(ie),u_frustum_br:new t.Uniform3f(ie),u_frustum_bl:new t.Uniform3f(ie),u_globe_pos:new t.Uniform3f(ie),u_globe_radius:new t.Uniform1f(ie),u_globe_transition:new t.Uniform1f(ie),u_is_globe:new t.Uniform1i(ie),u_viewport:new t.Uniform2f(ie)}))(r))}}setTerrainUniformValues(r,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in o)u[b]&&u[b].set(this.program,b,o[b])}}setGlobeUniformValues(r,o){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in o)u[b]&&u[b].set(this.program,b,o[b])}}setFogUniformValues(r,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in o)u[b].set(this.program,b,o[b])}}draw(r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe){const Le=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(u),r.setStencilMode(b),r.setColorMode(S),r.setCullFace(I);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,F[Ce]);Ee&&Ee.setUniforms(this.program,r,this.binderUniforms,me,{zoom:xe});const ie={[Le.LINES]:2,[Le.TRIANGLES]:3,[Le.LINE_STRIP]:1}[o];for(const Ce of ee.get()){const Re=Ce.vaos||(Ce.vaos={});(Re[N]||(Re[N]=new Il)).bind(r,this,H,Ee?Ee.getPaintVertexBuffers():[],X,Ce.vertexOffset,Pe||[]),Le.drawElements(o,Ce.primitiveLength*ie,Le.UNSIGNED_SHORT,Ce.primitiveOffset*ie*2)}}}function _r(h,r){const o=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,h.transform.tileZoom)/o,b=u*(r.tileID.canonical.x+r.tileID.wrap*o),S=u*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Oe(r,1,h.transform.tileZoom),u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}const on=t.create(),an=(h,r,o,u,b,S,I,F,N,H,X)=>{const ee=r.style.light,me=ee.properties.get("position"),xe=[me.x,me.y,me.z],Ee=t.create$1();ee.properties.get("anchor")==="viewport"&&(t.fromRotation(Ee,-r.transform.angle),t.transformMat3(xe,xe,Ee));const Pe=ee.properties.get("color"),Le=r.transform,ie={u_matrix:h,u_lightpos:xe,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:on,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:S};return Le.projection.name==="globe"&&(ie.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ie.u_zoom_transition=N,ie.u_inv_rot_matrix=X,ie.u_merc_center=H,ie.u_up_dir=Le.projection.upVector(new t.CanonicalTileID(0,0,0),H[0]*t.EXTENT,H[1]*t.EXTENT),ie.u_height_lift=F),ie},gn=(h,r,o,u,b,S,I,F,N,H,X,ee)=>{const me=an(h,r,o,u,b,S,I,N,H,X,ee),xe={u_height_factor:-Math.pow(2,I.overscaledZ)/F.tileSize/8};return t.extend(me,_r(r,F),xe)},fn=h=>({u_matrix:h}),vn=(h,r,o)=>t.extend(fn(h),_r(r,o)),to=(h,r)=>({u_matrix:h,u_world:r}),Cs=(h,r,o,u)=>t.extend(vn(h,r,o),{u_world:u}),jo=t.create(),Qa=(h,r,o,u,b,S)=>{const I=h.transform,F=I.projection.name==="globe";let N;if(S.paint.get("circle-pitch-alignment")==="map")if(F){const X=t.globePixelsToTileUnits(I.zoom,r.canonical)*I._pixelsPerMercatorPixel;N=Float32Array.from([X,0,0,X])}else N=I.calculatePixelsToTileUnitsMatrix(o);else N=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,o,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:jo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){H.u_inv_rot_matrix=u,H.u_merc_center=b,H.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],H.u_zoom_transition=t.globeToMercatorTransition(I.zoom);const X=b[0]*t.EXTENT,ee=b[1]*t.EXTENT;H.u_up_dir=I.projection.upVector(new t.CanonicalTileID(0,0,0),X,ee)}return H},Sa=h=>{const r=[];return h.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},Ta=(h,r,o,u)=>{const b=t.EXTENT/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(u),u_extrude_scale:[r.pixelsToGLUnits[0]/b,r.pixelsToGLUnits[1]/b]}},Uo=(h,r,o=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:o}),el=t.create(),tl=(h,r,o,u,b,S,I)=>{const F=h.transform,N=F.projection.name==="globe",H=N?t.globePixelsToTileUnits(F.zoom,r.canonical)*F._pixelsPerMercatorPixel:Oe(o,1,S),X={u_matrix:r.projMatrix,u_extrude_scale:H,u_intensity:I,u_inv_rot_matrix:el,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){X.u_inv_rot_matrix=u,X.u_merc_center=b,X.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],X.u_zoom_transition=t.globeToMercatorTransition(F.zoom);const ee=b[0]*t.EXTENT,me=b[1]*t.EXTENT;X.u_up_dir=F.projection.upVector(new t.CanonicalTileID(0,0,0),ee,me)}return X},il=(h,r,o,u,b,S,I)=>{const F=h.transform,N=F.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:ia(h,r,o,u),u_pixels_to_tile_units:N,u_device_pixel_ratio:S,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:_o(o)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:io(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},On=(h,r,o,u,b)=>{const S=h.transform;return{u_matrix:ia(h,r,o,u),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:io(r,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function io(h,r){return 1/Oe(h,1,r.tileZoom)}function ia(h,r,o,u){return h.translatePosMatrix(u||r.tileID.projMatrix,r,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function _o(h){const r=h.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Ca=(h,r,o,u,b,S)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:o,u_fade_t:u.mix,u_opacity:u.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(F=b.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(I=b.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:ln(b.paint.get("raster-hue-rotate")),u_perspective_transform:S};var I,F};function ln(h){h*=Math.PI/180;const r=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*r-o+1)/3,(Math.sqrt(3)*r-o+1)/3]}const rl=t.create(),Aa=(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe)=>{const Le=b.transform,ie={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Le.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:Le.width/Le.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:I,u_coord_matrix:F,u_is_text:+N,u_pitch_with_map:+u,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:rl,u_up_vector:[0,-1,0]};return Pe.name==="globe"&&(ie.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],ie.u_zoom_transition=ee,ie.u_inv_rot_matrix=xe,ie.u_merc_center=me,ie.u_camera_forward=Le._camera.forward(),ie.u_ecef_origin=t.globeECEFOrigin(Le.globeMatrix,X.toUnwrapped()),ie.u_tile_matrix=Float32Array.from(Le.globeMatrix),ie.u_up_vector=Ee),ie},Ea=(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe,Le)=>t.extend(Aa(h,r,o,u,b,S,I,F,N,H,ee,me,xe,Ee,Pe,Le),{u_gamma_scale:u?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+X}),Is=(h,r,o,u,b,S,I,F,N,H,X,ee,me,xe,Ee,Pe)=>t.extend(Ea(h,r,o,u,b,S,I,F,!0,N,!0,X,ee,me,xe,Ee,Pe),{u_texsize_icon:H,u_texture_icon:1}),Pa=(h,r,o)=>({u_matrix:h,u_opacity:r,u_color:o}),yc=(h,r,o,u,b)=>t.extend(function(S,I,F){const N=I.imageManager.getPattern(S.toString()),{width:H,height:X}=I.imageManager.getPixelSize(),ee=Math.pow(2,F.tileID.overscaledZ),me=F.tileSize*Math.pow(2,I.transform.tileZoom)/ee,xe=me*(F.tileID.canonical.x+F.tileID.wrap*ee),Ee=me*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[H,X],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/Oe(F,1,I.transform.tileZoom),u_pixel_coord_upper:[xe>>16,Ee>>16],u_pixel_coord_lower:[65535&xe,65535&Ee]}}(u,o,b),{u_matrix:h,u_opacity:r}),Ol={fillExtrusion:h=>({u_matrix:new t.UniformMatrix4f(h),u_lightpos:new t.Uniform3f(h),u_lightintensity:new t.Uniform1f(h),u_lightcolor:new t.Uniform3f(h),u_vertical_gradient:new t.Uniform1f(h),u_opacity:new t.Uniform1f(h),u_edge_radius:new t.Uniform1f(h),u_ao:new t.Uniform2f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_up_dir:new t.Uniform3f(h),u_height_lift:new t.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new t.UniformMatrix4f(h),u_lightpos:new t.Uniform3f(h),u_lightintensity:new t.Uniform1f(h),u_lightcolor:new t.Uniform3f(h),u_vertical_gradient:new t.Uniform1f(h),u_height_factor:new t.Uniform1f(h),u_edge_radius:new t.Uniform1f(h),u_ao:new t.Uniform2f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_up_dir:new t.Uniform3f(h),u_height_lift:new t.Uniform1f(h),u_image:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_pixel_coord_upper:new t.Uniform2f(h),u_pixel_coord_lower:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h),u_opacity:new t.Uniform1f(h)}),fill:h=>({u_matrix:new t.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new t.UniformMatrix4f(h),u_image:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_pixel_coord_upper:new t.Uniform2f(h),u_pixel_coord_lower:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h)}),fillOutline:h=>({u_matrix:new t.UniformMatrix4f(h),u_world:new t.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new t.UniformMatrix4f(h),u_world:new t.Uniform2f(h),u_image:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_pixel_coord_upper:new t.Uniform2f(h),u_pixel_coord_lower:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new t.Uniform1f(h),u_extrude_scale:new t.UniformMatrix2f(h),u_device_pixel_ratio:new t.Uniform1f(h),u_matrix:new t.UniformMatrix4f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_up_dir:new t.Uniform3f(h)}),collisionBox:h=>({u_matrix:new t.UniformMatrix4f(h),u_camera_to_center_distance:new t.Uniform1f(h),u_extrude_scale:new t.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new t.UniformMatrix4f(h),u_inv_matrix:new t.UniformMatrix4f(h),u_camera_to_center_distance:new t.Uniform1f(h),u_viewport_size:new t.Uniform2f(h)}),debug:h=>({u_color:new t.UniformColor(h),u_matrix:new t.UniformMatrix4f(h),u_overlay:new t.Uniform1i(h),u_overlay_scale:new t.Uniform1f(h)}),clippingMask:h=>({u_matrix:new t.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new t.Uniform1f(h),u_intensity:new t.Uniform1f(h),u_matrix:new t.UniformMatrix4f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_up_dir:new t.Uniform3f(h)}),heatmapTexture:h=>({u_image:new t.Uniform1i(h),u_color_ramp:new t.Uniform1i(h),u_opacity:new t.Uniform1f(h)}),hillshade:h=>({u_matrix:new t.UniformMatrix4f(h),u_image:new t.Uniform1i(h),u_latrange:new t.Uniform2f(h),u_light:new t.Uniform2f(h),u_shadow:new t.UniformColor(h),u_highlight:new t.UniformColor(h),u_accent:new t.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new t.UniformMatrix4f(h),u_image:new t.Uniform1i(h),u_dimension:new t.Uniform2f(h),u_zoom:new t.Uniform1f(h),u_unpack:new t.Uniform4f(h)}),line:h=>({u_matrix:new t.UniformMatrix4f(h),u_pixels_to_tile_units:new t.UniformMatrix2f(h),u_device_pixel_ratio:new t.Uniform1f(h),u_units_to_pixels:new t.Uniform2f(h),u_dash_image:new t.Uniform1i(h),u_gradient_image:new t.Uniform1i(h),u_image_height:new t.Uniform1f(h),u_texsize:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h),u_alpha_discard_threshold:new t.Uniform1f(h),u_trim_offset:new t.Uniform2f(h)}),linePattern:h=>({u_matrix:new t.UniformMatrix4f(h),u_texsize:new t.Uniform2f(h),u_pixels_to_tile_units:new t.UniformMatrix2f(h),u_device_pixel_ratio:new t.Uniform1f(h),u_image:new t.Uniform1i(h),u_units_to_pixels:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h),u_alpha_discard_threshold:new t.Uniform1f(h)}),raster:h=>({u_matrix:new t.UniformMatrix4f(h),u_tl_parent:new t.Uniform2f(h),u_scale_parent:new t.Uniform1f(h),u_fade_t:new t.Uniform1f(h),u_opacity:new t.Uniform1f(h),u_image0:new t.Uniform1i(h),u_image1:new t.Uniform1i(h),u_brightness_low:new t.Uniform1f(h),u_brightness_high:new t.Uniform1f(h),u_saturation_factor:new t.Uniform1f(h),u_contrast_factor:new t.Uniform1f(h),u_spin_weights:new t.Uniform3f(h),u_perspective_transform:new t.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new t.Uniform1i(h),u_is_size_feature_constant:new t.Uniform1i(h),u_size_t:new t.Uniform1f(h),u_size:new t.Uniform1f(h),u_camera_to_center_distance:new t.Uniform1f(h),u_rotate_symbol:new t.Uniform1i(h),u_aspect_ratio:new t.Uniform1f(h),u_fade_change:new t.Uniform1f(h),u_matrix:new t.UniformMatrix4f(h),u_label_plane_matrix:new t.UniformMatrix4f(h),u_coord_matrix:new t.UniformMatrix4f(h),u_is_text:new t.Uniform1i(h),u_pitch_with_map:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_camera_forward:new t.Uniform3f(h),u_tile_matrix:new t.UniformMatrix4f(h),u_up_vector:new t.Uniform3f(h),u_ecef_origin:new t.Uniform3f(h),u_texture:new t.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new t.Uniform1i(h),u_is_size_feature_constant:new t.Uniform1i(h),u_size_t:new t.Uniform1f(h),u_size:new t.Uniform1f(h),u_camera_to_center_distance:new t.Uniform1f(h),u_rotate_symbol:new t.Uniform1i(h),u_aspect_ratio:new t.Uniform1f(h),u_fade_change:new t.Uniform1f(h),u_matrix:new t.UniformMatrix4f(h),u_label_plane_matrix:new t.UniformMatrix4f(h),u_coord_matrix:new t.UniformMatrix4f(h),u_is_text:new t.Uniform1i(h),u_pitch_with_map:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_texture:new t.Uniform1i(h),u_gamma_scale:new t.Uniform1f(h),u_device_pixel_ratio:new t.Uniform1f(h),u_tile_id:new t.Uniform3f(h),u_zoom_transition:new t.Uniform1f(h),u_inv_rot_matrix:new t.UniformMatrix4f(h),u_merc_center:new t.Uniform2f(h),u_camera_forward:new t.Uniform3f(h),u_tile_matrix:new t.UniformMatrix4f(h),u_up_vector:new t.Uniform3f(h),u_ecef_origin:new t.Uniform3f(h),u_is_halo:new t.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new t.Uniform1i(h),u_is_size_feature_constant:new t.Uniform1i(h),u_size_t:new t.Uniform1f(h),u_size:new t.Uniform1f(h),u_camera_to_center_distance:new t.Uniform1f(h),u_rotate_symbol:new t.Uniform1i(h),u_aspect_ratio:new t.Uniform1f(h),u_fade_change:new t.Uniform1f(h),u_matrix:new t.UniformMatrix4f(h),u_label_plane_matrix:new t.UniformMatrix4f(h),u_coord_matrix:new t.UniformMatrix4f(h),u_is_text:new t.Uniform1i(h),u_pitch_with_map:new t.Uniform1i(h),u_texsize:new t.Uniform2f(h),u_texsize_icon:new t.Uniform2f(h),u_texture:new t.Uniform1i(h),u_texture_icon:new t.Uniform1i(h),u_gamma_scale:new t.Uniform1f(h),u_device_pixel_ratio:new t.Uniform1f(h),u_is_halo:new t.Uniform1i(h)}),background:h=>({u_matrix:new t.UniformMatrix4f(h),u_opacity:new t.Uniform1f(h),u_color:new t.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new t.UniformMatrix4f(h),u_opacity:new t.Uniform1f(h),u_image:new t.Uniform1i(h),u_pattern_tl:new t.Uniform2f(h),u_pattern_br:new t.Uniform2f(h),u_texsize:new t.Uniform2f(h),u_pattern_size:new t.Uniform2f(h),u_pixel_coord_upper:new t.Uniform2f(h),u_pixel_coord_lower:new t.Uniform2f(h),u_tile_units_to_pixels:new t.Uniform1f(h)}),terrainRaster:No,terrainDepth:No,skybox:h=>({u_matrix:new t.UniformMatrix4f(h),u_sun_direction:new t.Uniform3f(h),u_cubemap:new t.Uniform1i(h),u_opacity:new t.Uniform1f(h),u_temporal_offset:new t.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new t.UniformMatrix4f(h),u_color_ramp:new t.Uniform1i(h),u_center_direction:new t.Uniform3f(h),u_radius:new t.Uniform1f(h),u_opacity:new t.Uniform1f(h),u_temporal_offset:new t.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new t.UniformMatrix3f(h),u_sun_direction:new t.Uniform3f(h),u_sun_intensity:new t.Uniform1f(h),u_color_tint_r:new t.Uniform4f(h),u_color_tint_m:new t.Uniform4f(h),u_luminance:new t.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new t.UniformMatrix4f(h),u_globe_matrix:new t.UniformMatrix4f(h),u_normalize_matrix:new t.UniformMatrix4f(h),u_merc_matrix:new t.UniformMatrix4f(h),u_zoom_transition:new t.Uniform1f(h),u_merc_center:new t.Uniform2f(h),u_image0:new t.Uniform1i(h),u_grid_matrix:new t.UniformMatrix3f(h),u_skirt_height:new t.Uniform1f(h),u_frustum_tl:new t.Uniform3f(h),u_frustum_tr:new t.Uniform3f(h),u_frustum_br:new t.Uniform3f(h),u_frustum_bl:new t.Uniform3f(h),u_globe_pos:new t.Uniform3f(h),u_globe_radius:new t.Uniform1f(h),u_viewport:new t.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new t.Uniform3f(h),u_frustum_tr:new t.Uniform3f(h),u_frustum_br:new t.Uniform3f(h),u_frustum_bl:new t.Uniform3f(h),u_horizon:new t.Uniform1f(h),u_transition:new t.Uniform1f(h),u_fadeout_range:new t.Uniform1f(h),u_color:new t.Uniform4f(h),u_high_color:new t.Uniform4f(h),u_space_color:new t.Uniform4f(h),u_star_intensity:new t.Uniform1f(h),u_star_density:new t.Uniform1f(h),u_star_size:new t.Uniform1f(h),u_temporal_offset:new t.Uniform1f(h),u_horizon_angle:new t.Uniform1f(h),u_rotation_matrix:new t.UniformMatrix4f(h)})};let ro;function Hn(h,r,o,u,b,S,I){const F=h.context,N=F.gl,H=h.transform,X=h.useProgram("collisionBox"),ee=[];let me=0,xe=0;for(let Ne=0;Ne<u.length;Ne++){const et=u[Ne],Qe=r.getTile(et),tt=Qe.getBucket(o);if(!tt)continue;const _t=jn(et,tt,H);let ut=_t;b[0]===0&&b[1]===0||(ut=h.translatePosMatrix(_t,Qe,b,S));const Ct=I?tt.textCollisionBox:tt.iconCollisionBox,ei=tt.collisionCircleArray;if(ei.length>0){const Tt=t.create(),Gt=ut;t.mul(Tt,tt.placementInvProjMatrix,H.glCoordMatrix),t.mul(Tt,Tt,tt.placementViewportMatrix),ee.push({circleArray:ei,circleOffset:xe,transform:Gt,invTransform:Tt,projection:tt.getProjection()}),me+=ei.length/4,xe=me}Ct&&(h.terrain&&h.terrain.setupElevationDraw(Qe,X),X.draw(F,N.LINES,t.DepthMode.disabled,t.StencilMode.disabled,h.colorModeForRenderPass(),t.CullFaceMode.disabled,Ta(ut,H,Qe,tt.getProjection()),o.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,H.zoom,null,[Ct.collisionVertexBuffer,Ct.collisionVertexBufferExt]))}if(!I||!ee.length)return;const Ee=h.useProgram("collisionCircle"),Pe=new t.StructArrayLayout2f1f2i16;Pe.resize(4*me),Pe._trim();let Le=0;for(const Ne of ee)for(let et=0;et<Ne.circleArray.length/4;et++){const Qe=4*et,tt=Ne.circleArray[Qe+0],_t=Ne.circleArray[Qe+1],ut=Ne.circleArray[Qe+2],Ct=Ne.circleArray[Qe+3];Pe.emplace(Le++,tt,_t,ut,Ct,0),Pe.emplace(Le++,tt,_t,ut,Ct,1),Pe.emplace(Le++,tt,_t,ut,Ct,2),Pe.emplace(Le++,tt,_t,ut,Ct,3)}(!ro||ro.length<2*me)&&(ro=function(Ne){const et=2*Ne,Qe=new t.StructArrayLayout3ui6;Qe.resize(et),Qe._trim();for(let tt=0;tt<et;tt++){const _t=6*tt;Qe.uint16[_t+0]=4*tt+0,Qe.uint16[_t+1]=4*tt+1,Qe.uint16[_t+2]=4*tt+2,Qe.uint16[_t+3]=4*tt+2,Qe.uint16[_t+4]=4*tt+3,Qe.uint16[_t+5]=4*tt+0}return Qe}(me));const ie=F.createIndexBuffer(ro,!0),Ce=F.createVertexBuffer(Pe,t.collisionCircleLayout.members,!0);for(const Ne of ee){const et={u_matrix:Ne.transform,u_inv_matrix:Ne.invTransform,u_camera_to_center_distance:(Re=H).getCameraToCenterDistance(Ne.projection),u_viewport_size:[Re.width,Re.height]};Ee.draw(F,N.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,h.colorModeForRenderPass(),t.CullFaceMode.disabled,et,o.id,Ce,ie,t.SegmentVector.simpleSegment(0,2*Ne.circleOffset,Ne.circleArray.length,Ne.circleArray.length/2),null,H.zoom)}var Re;Ce.destroy(),ie.destroy()}const ks=t.create();function yo({width:h,height:r,anchor:o,textOffset:u,textScale:b},S){const{horizontalAlign:I,verticalAlign:F}=t.getAnchorAlignment(o),N=-(I-.5)*h,H=-(F-.5)*r,X=t.evaluateVariableOffset(o,u);return new t.Point((N/b+X[0])*S,(H/b+X[1])*S)}function vo(h,r,o,u,b,S,I,F,N,H,X){const ee=h.text.placedSymbolArray,me=h.text.dynamicLayoutVertexArray,xe=h.icon.dynamicLayoutVertexArray,Ee={},Pe=h.getProjection(),Le=Er(F,Pe,S),ie=S.elevation,Ce=Pe.upVectorScale(F.canonical,S.center.lat,S.worldSize).metersToTile;me.clear();for(let Re=0;Re<ee.length;Re++){const Ne=ee.get(Re),{tileAnchorX:et,tileAnchorY:Qe,numGlyphs:tt}=Ne,_t=Ne.hidden||!Ne.crossTileID||h.allowVerticalPlacement&&!Ne.placedOrientation?null:u[Ne.crossTileID];if(_t){let ut=0,Ct=0,ei=0;if(ie){const ci=ie?ie.getAtTileOffset(F,et,Qe):0,[Oi,$i,Si]=Pe.upVector(F.canonical,et,Qe);ut=ci*Oi*Ce,Ct=ci*$i*Ce,ei=ci*Si*Ce}let[Tt,Gt,Pt,ii]=ur(Ne.projectedAnchorX+ut,Ne.projectedAnchorY+Ct,Ne.projectedAnchorZ+ei,o?Le:I);const Mt=Ys(S.getCameraToCenterDistance(Pe),ii);let Xt=b.evaluateSizeForFeature(h.textSizeData,H,Ne)*Mt/t.ONE_EM;o&&(Xt*=h.tilePixelRatio/N);const oi=yo(_t,Xt);o?({x:Tt,y:Gt,z:Pt}=Pe.projectTilePoint(et+oi.x,Qe+oi.y,F.canonical),[Tt,Gt,Pt]=ur(Tt+ut,Gt+Ct,Pt+ei,I)):(r&&oi._rotate(-S.angle),Tt+=oi.x,Gt+=oi.y,Pt=0);const qt=h.allowVerticalPlacement&&Ne.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let ci=0;ci<tt;ci++)t.addDynamicAttributes(me,Tt,Gt,Pt,qt);X&&Ne.associatedIconIndex>=0&&(Ee[Ne.associatedIconIndex]={x:Tt,y:Gt,z:Pt,angle:qt})}else Nn(tt,me)}if(X){xe.clear();const Re=h.icon.placedSymbolArray;for(let Ne=0;Ne<Re.length;Ne++){const et=Re.get(Ne),{numGlyphs:Qe}=et,tt=Ee[Ne];if(et.hidden||!tt)Nn(Qe,xe);else{const{x:_t,y:ut,z:Ct,angle:ei}=tt;for(let Tt=0;Tt<Qe;Tt++)t.addDynamicAttributes(xe,_t,ut,Ct,ei)}}h.icon.dynamicLayoutVertexBuffer.updateData(xe)}h.text.dynamicLayoutVertexBuffer.updateData(me)}function no(h,r,o){return o.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ma(h,r,o,u,b,S,I,F,N,H,X,ee){const me=h.context,xe=me.gl,Ee=h.transform,Pe=F==="map",Le=N==="map",ie=Pe&&o.layout.get("symbol-placement")!=="point",Ce=Pe&&!Le&&!ie,Re=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ne=!1;const et=h.depthModeForSublayer(0,t.DepthMode.ReadOnly),Qe=[t.mercatorXfromLng(Ee.center.lng),t.mercatorYfromLat(Ee.center.lat)],tt=o.layout.get("text-variable-anchor"),_t=Ee.projection.name==="globe",ut=[],Ct=[0,-1,0];let ei=Ct;!_t&&!Ee.mercatorFromTransition||Pe||(ei=function(Tt){const Gt=Tt._camera.getWorldToCamera(Tt.worldSize,1),Pt=t.multiply([],Gt,Tt.globeMatrix);t.invert(Pt,Pt);const ii=[0,0,0],Mt=[0,1,0,0];return t.transformMat4$1(Mt,Mt,Pt),ii[0]=Mt[0],ii[1]=Mt[1],ii[2]=Mt[2],t.normalize(ii,ii),ii}(Ee));for(const Tt of u){const Gt=r.getTile(Tt),Pt=Gt.getBucket(o);if(!Pt||Pt.projection.name==="mercator"&&_t)continue;const ii=b?Pt.text:Pt.icon;if(!ii||Pt.fullyClipped||!ii.segments.get().length)continue;const Mt=ii.programConfigurations.get(o.id),Xt=b||Pt.sdfIcons,oi=b?Pt.textSizeData:Pt.iconSizeData,qt=Le||Ee.pitch!==0,ci=t.evaluateSizeForZoom(oi,Ee.zoom);let Oi,$i,Si,zi,rr=[0,0],Xi=null;if(b)$i=Gt.glyphAtlasTexture,Si=xe.LINEAR,Oi=Gt.glyphAtlasTexture.size,Pt.iconsInText&&(rr=Gt.imageAtlasTexture.size,Xi=Gt.imageAtlasTexture,zi=qt||h.options.rotating||h.options.zooming||oi.kind==="composite"||oi.kind==="camera"?xe.LINEAR:xe.NEAREST);else{const To=o.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;$i=Gt.imageAtlasTexture,Si=Xt||h.options.rotating||h.options.zooming||To||qt?xe.LINEAR:xe.NEAREST,Oi=Gt.imageAtlasTexture.size}const Pi=Pt.projection.name==="globe",yr=Pi?ei:Ct,Lr=Pi?t.globeToMercatorTransition(Ee.zoom):0,Tr=Er(Tt,Pt.getProjection(),Ee),Ir=Ee.calculatePixelsToTileUnitsMatrix(Gt),Cn=Ut(Tr,Gt.tileID.canonical,Le,Pe,Ee,Pt.getProjection(),Ir),wn=h.terrain&&Le&&ie?t.invert(t.create(),Cn):ks,ns=Gr(Tr,Gt.tileID.canonical,Le,Pe,Ee,Pt.getProjection(),Ir),gs=tt&&Pt.hasTextData(),Qr=o.layout.get("icon-text-fit")!=="none"&&gs&&Pt.hasIconData();if(ie){const To=Ee.elevation,ao=To?To.getAtTileOffsetFunc(Tt,Ee.center.lat,Ee.worldSize,Pt.getProjection()):null,$o=Wn(Tr,Gt.tileID.canonical,Le,Pe,Ee,Pt.getProjection(),Ir);Zs(Pt,Tr,h,b,$o,ns,Le,H,ao,Tt)}const Dr=ie||b&&tt||Qr,xr=h.translatePosMatrix(Tr,Gt,S,I),Br=Dr?ks:Cn,ss=h.translatePosMatrix(ns,Gt,S,I,!0),$r=Pt.getProjection().createInversionMatrix(Ee,Tt.canonical),_s=[];h.terrainRenderModeElevated()&&Le&&_s.push("PITCH_WITH_MAP_TERRAIN"),Pi&&_s.push("PROJECTION_GLOBE_VIEW"),Dr&&_s.push("PROJECTED_POS_ON_VIEWPORT");const Xl=Xt&&o.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let So;So=Xt?Pt.iconsInText?Is(oi.kind,ci,Ce,Le,h,xr,Br,ss,Oi,rr,Tt,Lr,Qe,$r,yr,Pt.getProjection()):Ea(oi.kind,ci,Ce,Le,h,xr,Br,ss,b,Oi,!0,Tt,Lr,Qe,$r,yr,Pt.getProjection()):Aa(oi.kind,ci,Ce,Le,h,xr,Br,ss,b,Oi,Tt,Lr,Qe,$r,yr,Pt.getProjection());const pl={program:h.useProgram(no(Xt,b,Pt),Mt,_s),buffers:ii,uniformValues:So,atlasTexture:$i,atlasTextureIcon:Xi,atlasInterpolation:Si,atlasInterpolationIcon:zi,isSDF:Xt,hasHalo:Xl,tile:Gt,labelPlaneMatrixInv:wn};if(Re&&Pt.canOverlap){Ne=!0;const To=ii.segments.get();for(const ao of To)ut.push({segments:new t.SegmentVector([ao]),sortKey:ao.sortKey,state:pl})}else ut.push({segments:ii.segments,sortKey:0,state:pl})}Ne&&ut.sort((Tt,Gt)=>Tt.sortKey-Gt.sortKey);for(const Tt of ut){const Gt=Tt.state;if(h.terrain&&h.terrain.setupElevationDraw(Gt.tile,Gt.program,{useDepthForOcclusion:!_t,labelPlaneMatrixInv:Gt.labelPlaneMatrixInv}),me.activeTexture.set(xe.TEXTURE0),Gt.atlasTexture.bind(Gt.atlasInterpolation,xe.CLAMP_TO_EDGE),Gt.atlasTextureIcon&&(me.activeTexture.set(xe.TEXTURE1),Gt.atlasTextureIcon&&Gt.atlasTextureIcon.bind(Gt.atlasInterpolationIcon,xe.CLAMP_TO_EDGE)),Gt.isSDF){const Pt=Gt.uniformValues;Gt.hasHalo&&(Pt.u_is_halo=1,ts(Gt.buffers,Tt.segments,o,h,Gt.program,et,X,ee,Pt)),Pt.u_is_halo=0}ts(Gt.buffers,Tt.segments,o,h,Gt.program,et,X,ee,Gt.uniformValues)}}function ts(h,r,o,u,b,S,I,F,N){const H=u.context,X=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];b.draw(H,H.gl.TRIANGLES,S,I,F,t.CullFaceMode.disabled,N,o.id,h.layoutVertexBuffer,h.indexBuffer,r,o.paint,u.transform.zoom,h.programConfigurations.get(o.id),X)}function La(h,r,o,u,b,S,I){const F=h.context.gl,N=o.paint.get("fill-pattern"),H=N&&N.constantOr(1);let X,ee,me,xe,Ee;I?(ee=H&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=F.LINES):(ee=H?"fillPattern":"fill",X=F.TRIANGLES);for(const Pe of u){const Le=r.getTile(Pe);if(H&&!Le.patternsLoaded())continue;const ie=Le.getBucket(o);if(!ie)continue;h.prepareDrawTile();const Ce=ie.programConfigurations.get(o.id),Re=h.useProgram(ee,Ce);H&&(h.context.activeTexture.set(F.TEXTURE0),Le.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const Ne=N.constantOr(null);if(Ne&&Le.imageAtlas){const Qe=Le.imageAtlas.patternPositions[Ne.toString()];Qe&&Ce.setConstantPatternPositions(Qe)}const et=h.translatePosMatrix(Pe.projMatrix,Le,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(I){xe=ie.indexBuffer2,Ee=ie.segments2;const Qe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];me=ee==="fillOutlinePattern"&&H?Cs(et,h,Le,Qe):to(et,Qe)}else xe=ie.indexBuffer,Ee=ie.segments,me=H?vn(et,h,Le):fn(et);h.prepareDrawProgram(h.context,Re,Pe.toUnwrapped()),Re.draw(h.context,X,b,h.stencilModeForClipping(Pe),S,t.CullFaceMode.disabled,me,o.id,ie.layoutVertexBuffer,xe,Ee,o.paint,h.transform.zoom,Ce)}}function ra(h,r,o,u,b,S,I){const F=h.context,N=F.gl,H=h.transform,X=o.paint.get("fill-extrusion-pattern"),ee=X.constantOr(1),me=o.paint.get("fill-extrusion-opacity"),xe=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],Ee=o.layout.get("fill-extrusion-edge-radius"),Pe=Ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),Le=Pe?0:Ee,ie=H.projection.name==="globe"?t.fillExtrusionHeightLift():0,Ce=H.projection.name==="globe",Re=Ce?t.globeToMercatorTransition(H.zoom):0,Ne=[t.mercatorXfromLng(H.center.lng),t.mercatorYfromLat(H.center.lat)],et=[];Ce&&et.push("PROJECTION_GLOBE_VIEW"),xe[0]>0&&et.push("FAUX_AO"),Pe&&et.push("ZERO_ROOF_RADIUS");for(const Qe of u){const tt=r.getTile(Qe),_t=tt.getBucket(o);if(!_t||_t.projection.name!==H.projection.name)continue;const ut=_t.programConfigurations.get(o.id),Ct=h.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",ut,et);if(h.terrain){const Xt=h.terrain;if(h.style.terrainSetForDrapingOnly())Xt.setupElevationDraw(tt,Ct,{useMeterToDem:!0});else{if(!_t.enableTerrain)continue;if(Xt.setupElevationDraw(tt,Ct,{useMeterToDem:!0}),Vo(F,r,Qe,_t,o,Xt),!_t.centroidVertexBuffer){const oi=Ct.attributes.a_centroid_pos;oi!==void 0&&N.vertexAttrib2f(oi,0,0)}}}ee&&(h.context.activeTexture.set(N.TEXTURE0),tt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ut.updatePaintBuffers());const ei=X.constantOr(null);if(ei&&tt.imageAtlas){const Xt=tt.imageAtlas.patternPositions[ei.toString()];Xt&&ut.setConstantPatternPositions(Xt)}const Tt=h.translatePosMatrix(Qe.projMatrix,tt,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Gt=H.projection.createInversionMatrix(H,Qe.canonical),Pt=o.paint.get("fill-extrusion-vertical-gradient"),ii=ee?gn(Tt,h,Pt,me,xe,Le,Qe,tt,ie,Re,Ne,Gt):an(Tt,h,Pt,me,xe,Le,Qe,ie,Re,Ne,Gt);h.prepareDrawProgram(F,Ct,Qe.toUnwrapped());const Mt=[];h.terrain&&Mt.push(_t.centroidVertexBuffer),Ce&&Mt.push(_t.layoutVertexExtBuffer),Ct.draw(F,F.gl.TRIANGLES,b,S,I,t.CullFaceMode.backCCW,ii,o.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,o.paint,h.transform.zoom,ut,Mt)}}function Vo(h,r,o,u,b,S){const I=[ie=>{let Ce=ie.canonical.x-1,Re=ie.wrap;return Ce<0&&(Ce=(1<<ie.canonical.z)-1,Re--),new t.OverscaledTileID(ie.overscaledZ,Re,ie.canonical.z,Ce,ie.canonical.y)},ie=>{let Ce=ie.canonical.x+1,Re=ie.wrap;return Ce===1<<ie.canonical.z&&(Ce=0,Re++),new t.OverscaledTileID(ie.overscaledZ,Re,ie.canonical.z,Ce,ie.canonical.y)},ie=>new t.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,(ie.canonical.y===0?1<<ie.canonical.z:ie.canonical.y)-1),ie=>new t.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,ie.canonical.y===(1<<ie.canonical.z)-1?0:ie.canonical.y+1)],F=ie=>{const Ce=r.getSource().minzoom,Re=et=>{const Qe=r.getTileByID(et);if(Qe&&Qe.hasData())return Qe.getBucket(b)},Ne=[0,-1,1];for(const et of Ne){if(ie.overscaledZ+et<Ce)continue;const Qe=Re(ie.calculateScaledKey(ie.overscaledZ+et));if(Qe)return Qe}},N=[0,0,0],H=(ie,Ce)=>(N[0]=Math.min(ie.min.y,Ce.min.y),N[1]=Math.max(ie.max.y,Ce.max.y),N[2]=t.EXTENT-Ce.min.x>ie.max.x?Ce.min.x-t.EXTENT:ie.max.x,N),X=(ie,Ce)=>(N[0]=Math.min(ie.min.x,Ce.min.x),N[1]=Math.max(ie.max.x,Ce.max.x),N[2]=t.EXTENT-Ce.min.y>ie.max.y?Ce.min.y-t.EXTENT:ie.max.y,N),ee=[(ie,Ce)=>H(ie,Ce),(ie,Ce)=>H(Ce,ie),(ie,Ce)=>X(ie,Ce),(ie,Ce)=>X(Ce,ie)],me=new t.Point(0,0);let xe,Ee,Pe;const Le=(ie,Ce,Re,Ne,et)=>{const Qe=[[Ne?Re:ie,Ne?ie:Re,0],[Ne?Re:Ce,Ne?Ce:Re,0]],tt=et<0?t.EXTENT+et:et,_t=[Ne?tt:(ie+Ce)/2,Ne?(ie+Ce)/2:tt,0];return Re===0&&et<0||Re!==0&&et>0?S.getForTilePoints(Pe,[_t],!0,Ee):Qe.push(_t),S.getForTilePoints(o,Qe,!0,xe),Math.max(Qe[0][2],Qe[1][2],_t[2])/S.exaggeration()};for(let ie=0;ie<4;ie++){const Ce=(ie<2?1:5)-ie,Re=u.borders[ie];if(Re.length===0)continue;const Ne=Pe=I[ie](o),et=F(Ne);if(!(et&&et instanceof t.FillExtrusionBucket&&et.enableTerrain)||u.borderDoneWithNeighborZ[ie]===et.canonical.z&&et.borderDoneWithNeighborZ[Ce]===u.canonical.z||(Ee=S.findDEMTileFor(Ne),!Ee||!Ee.dem))continue;if(!xe){const ut=S.findDEMTileFor(o);if(!ut||!ut.dem)return;xe=ut}const Qe=et.borders[Ce];let tt=0;const _t=et.borderDoneWithNeighborZ[Ce]!==u.canonical.z;if(u.canonical.z===et.canonical.z){for(let ut=0;ut<Re.length;ut++){const Ct=u.featuresOnBorder[Re[ut]],ei=Ct.borders[ie];let Tt;for(;tt<Qe.length&&(Tt=et.featuresOnBorder[Qe[tt]],!(Tt.borders[Ce][1]>ei[0]+3));)_t&&et.encodeCentroid(void 0,Tt,!1),tt++;if(Tt&&tt<Qe.length){const Gt=tt;let Pt=0;for(;!(Tt.borders[Ce][0]>ei[1]-3)&&(Pt++,++tt!==Qe.length);)Tt=et.featuresOnBorder[Qe[tt]];if(Tt=et.featuresOnBorder[Qe[Gt]],Ct.intersectsCount()>1||Tt.intersectsCount()>1||Pt!==1){Pt!==1&&(tt=Gt),u.encodeCentroid(void 0,Ct,!1),_t&&et.encodeCentroid(void 0,Tt,!1);continue}const ii=ee[ie](Ct,Tt),Mt=ie%2?t.EXTENT-1:0;me.x=Le(ii[0],Math.min(t.EXTENT-1,ii[1]),Mt,ie<2,ii[2]),me.y=0,u.encodeCentroid(me,Ct,!1),_t&&et.encodeCentroid(me,Tt,!1)}else u.encodeCentroid(void 0,Ct,!1)}u.borderDoneWithNeighborZ[ie]=et.canonical.z,u.needsCentroidUpdate=!0,_t&&(et.borderDoneWithNeighborZ[Ce]=u.canonical.z,et.needsCentroidUpdate=!0)}else{for(const ut of Re)u.encodeCentroid(void 0,u.featuresOnBorder[ut],!1);if(_t){for(const ut of Qe)et.encodeCentroid(void 0,et.featuresOnBorder[ut],!1);et.borderDoneWithNeighborZ[Ce]=u.canonical.z,et.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[ie]=et.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(h)}const $n=new t.Color(1,0,0,1),qo=new t.Color(0,1,0,1),Ia=new t.Color(0,0,1,1),nl=new t.Color(1,0,1,1),ka=new t.Color(0,1,1,1);function na(h,r,o){const u=h.context,b=h.transform,S=u.gl,I=b.projection.name==="globe",F=I?["PROJECTION_GLOBE_VIEW"]:null;let N=o.projMatrix;if(I&&t.globeToMercatorTransition(b.zoom)>0){const Ct=t.transitionTileAABBinECEF(o.canonical,b),ei=t.globeDenormalizeECEF(Ct);N=t.multiply(new Float32Array(16),b.globeMatrix,ei),t.multiply(N,b.projMatrix,N)}const H=h.useProgram("debug",null,F),X=r.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(X,H);const ee=t.DepthMode.disabled,me=t.StencilMode.disabled,xe=h.colorModeForRenderPass(),Ee="$debug";u.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),I?X._makeGlobeTileDebugBuffers(h.context,b):X._makeDebugTileBoundsBuffers(h.context,b.projection);const Pe=X._tileDebugBuffer||h.debugBuffer,Le=X._tileDebugIndexBuffer||h.debugIndexBuffer,ie=X._tileDebugSegments||h.debugSegments;H.draw(u,S.LINE_STRIP,ee,me,xe,t.CullFaceMode.disabled,Uo(N,t.Color.red),Ee,Pe,Le,ie,null,null,null,[X._globeTileDebugBorderBuffer]);const Ce=X.latestRawTileData,Re=Math.floor((Ce&&Ce.byteLength||0)/1024),Ne=r.getTile(o).tileSize,et=512/Math.min(Ne,512)*(o.overscaledZ/b.zoom)*.5;let Qe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Qe+=` => ${o.overscaledZ}`),Qe+=` ${Re}kb`,function(Ct,ei){Ct.initDebugOverlayCanvas();const Tt=Ct.debugOverlayCanvas,Gt=Ct.context.gl,Pt=Ct.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,Tt.width,Tt.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(ei,5,5),Pt.strokeText(ei,5,5),Ct.debugOverlayTexture.update(Tt),Ct.debugOverlayTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE)}(h,Qe);const tt=X._tileDebugTextBuffer||h.debugBuffer,_t=X._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,ut=X._tileDebugTextSegments||h.debugSegments;H.draw(u,S.TRIANGLES,ee,me,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Uo(N,t.Color.transparent,et),Ee,tt,_t,ut,null,null,null,[X._globeTileDebugTextBuffer])}function sl(h,r,o,u){fs(h,0,r+o/2,h.transform.width,o,u)}function is(h,r,o,u){fs(h,r-o/2,0,o,h.transform.height,u)}function fs(h,r,o,u,b,S){const I=h.context,F=I.gl;F.enable(F.SCISSOR_TEST),F.scissor(r*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio,u*t.exported.devicePixelRatio,b*t.exported.devicePixelRatio),I.clear({color:S}),F.disable(F.SCISSOR_TEST)}const Xr=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Hr}=Xr;function Rr(h,r,o,u){h.emplaceBack(r,o,u)}class dn{constructor(r){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Rr(this.vertexArray,-1,-1,1),Rr(this.vertexArray,1,-1,1),Rr(this.vertexArray,-1,1,1),Rr(this.vertexArray,1,1,1),Rr(this.vertexArray,-1,-1,-1),Rr(this.vertexArray,1,-1,-1),Rr(this.vertexArray,-1,1,-1),Rr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Hr),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function xn(h,r,o,u,b,S){const I=h.gl,F=r.paint.get("sky-atmosphere-color"),N=r.paint.get("sky-atmosphere-halo-color"),H=r.paint.get("sky-atmosphere-sun-intensity"),X=((ee,me,xe,Ee,Pe)=>({u_matrix_3f:ee,u_sun_direction:me,u_sun_intensity:xe,u_color_tint_r:[Ee.r,Ee.g,Ee.b,Ee.a],u_color_tint_m:[Pe.r,Pe.g,Pe.b,Pe.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),u),b,H,F,N);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+S,r.skyboxTexture,0),o.draw(h,I.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,X,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ds=t.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Da{constructor(r){const o=new t.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const u=new t.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(o,Ds.members),this.indexBuffer=r.createIndexBuffer(u),this.segments=t.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xo={symbol:function(h,r,o,u,b){if(h.renderPass!=="translucent")return;const S=t.StencilMode.disabled,I=h.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(F,N,H,X,ee,me,xe){const Ee=N.transform,Pe=ee==="map",Le=me==="map";for(const ie of F){const Ce=X.getTile(ie),Re=Ce.getBucket(H);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Ne=t.evaluateSizeForZoom(Re.textSizeData,Ee.zoom),et=Er(ie,Re.getProjection(),Ee),Qe=Ee.calculatePixelsToTileUnitsMatrix(Ce),tt=Ut(et,Ce.tileID.canonical,Le,Pe,Ee,Re.getProjection(),Qe),_t=H.layout.get("icon-text-fit")!=="none"&&Re.hasIconData();if(Ne){const ut=Math.pow(2,Ee.zoom-Ce.tileID.overscaledZ);vo(Re,Pe,Le,xe,t.symbolSize,Ee,tt,ie,ut,Ne,_t)}}}(u,h,o,r,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),b),o.paint.get("icon-opacity").constantOr(1)!==0&&Ma(h,r,o,u,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),S,I),o.paint.get("text-opacity").constantOr(1)!==0&&Ma(h,r,o,u,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),S,I),r.map.showCollisionBoxes&&(Hn(h,r,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Hn(h,r,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,o,u){if(h.renderPass!=="translucent")return;const b=o.paint.get("circle-opacity"),S=o.paint.get("circle-stroke-width"),I=o.paint.get("circle-stroke-opacity"),F=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)===0&&(S.constantOr(1)===0||I.constantOr(1)===0))return;const N=h.context,H=N.gl,X=h.transform,ee=h.depthModeForSublayer(0,t.DepthMode.ReadOnly),me=t.StencilMode.disabled,xe=h.colorModeForRenderPass(),Ee=X.projection.name==="globe",Pe=[t.mercatorXfromLng(X.center.lng),t.mercatorYfromLat(X.center.lat)],Le=[];for(let Ce=0;Ce<u.length;Ce++){const Re=u[Ce],Ne=r.getTile(Re),et=Ne.getBucket(o);if(!et||et.projection.name!==X.projection.name)continue;const Qe=et.programConfigurations.get(o.id),tt=Sa(o);Ee&&tt.push("PROJECTION_GLOBE_VIEW");const _t=h.useProgram("circle",Qe,tt),ut=et.layoutVertexBuffer,Ct=et.globeExtVertexBuffer,ei=et.indexBuffer,Tt=X.projection.createInversionMatrix(X,Re.canonical),Gt={programConfiguration:Qe,program:_t,layoutVertexBuffer:ut,globeExtVertexBuffer:Ct,indexBuffer:ei,uniformValues:Qa(h,Re,Ne,Tt,Pe,o),tile:Ne};if(F){const Pt=et.segments.get();for(const ii of Pt)Le.push({segments:new t.SegmentVector([ii]),sortKey:ii.sortKey,state:Gt})}else Le.push({segments:et.segments,sortKey:0,state:Gt})}F&&Le.sort((Ce,Re)=>Ce.sortKey-Re.sortKey);const ie={useDepthForOcclusion:!Ee};for(const Ce of Le){const{programConfiguration:Re,program:Ne,layoutVertexBuffer:et,globeExtVertexBuffer:Qe,indexBuffer:tt,uniformValues:_t,tile:ut}=Ce.state,Ct=Ce.segments;h.terrain&&h.terrain.setupElevationDraw(ut,Ne,ie),h.prepareDrawProgram(N,Ne,ut.tileID.toUnwrapped()),Ne.draw(N,H.TRIANGLES,ee,me,xe,t.CullFaceMode.disabled,_t,o.id,et,tt,Ct,o.paint,X.zoom,Re,[Qe])}},heatmap:function(h,r,o,u){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const b=h.context,S=b.gl,I=t.StencilMode.disabled,F=new t.ColorMode([S.ONE,S.ONE],t.Color.transparent,[!0,!0,!0,!0]);(function(xe,Ee,Pe,Le){const ie=xe.gl,Ce=Ee.width*Le,Re=Ee.height*Le;xe.activeTexture.set(ie.TEXTURE1),xe.viewport.set([0,0,Ce,Re]);let Ne=Pe.heatmapFbo;if(!Ne||Ne&&(Ne.width!==Ce||Ne.height!==Re)){Ne&&Ne.destroy();const et=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,et),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),Ne=Pe.heatmapFbo=xe.createFramebuffer(Ce,Re,!1),function(Qe,tt,_t,ut,Ct,ei){const Tt=Qe.gl;Tt.texImage2D(Tt.TEXTURE_2D,0,Qe.isWebGL2&&Qe.extRenderToTextureHalfFloat?Tt.RGBA16F:Tt.RGBA,Ct,ei,0,Tt.RGBA,Qe.extRenderToTextureHalfFloat?Qe.isWebGL2?Tt.HALF_FLOAT:Qe.extTextureHalfFloat.HALF_FLOAT_OES:Tt.UNSIGNED_BYTE,null),ut.colorAttachment.set(_t)}(xe,0,et,Ne,Ce,Re)}else ie.bindTexture(ie.TEXTURE_2D,Ne.colorAttachment.get()),xe.bindFramebuffer.set(Ne.framebuffer)})(b,h,o,h.transform.projection.name==="globe"?.5:.25),b.clear({color:t.Color.transparent});const N=h.transform,H=N.projection.name==="globe",X=H?["PROJECTION_GLOBE_VIEW"]:null,ee=H?t.CullFaceMode.frontCCW:t.CullFaceMode.disabled,me=[t.mercatorXfromLng(N.center.lng),t.mercatorYfromLat(N.center.lat)];for(let xe=0;xe<u.length;xe++){const Ee=u[xe];if(r.hasRenderableParent(Ee))continue;const Pe=r.getTile(Ee),Le=Pe.getBucket(o);if(!Le||Le.projection.name!==N.projection.name)continue;const ie=Le.programConfigurations.get(o.id),Ce=h.useProgram("heatmap",ie,X),{zoom:Re}=h.transform;h.terrain&&h.terrain.setupElevationDraw(Pe,Ce),h.prepareDrawProgram(b,Ce,Ee.toUnwrapped());const Ne=N.projection.createInversionMatrix(N,Ee.canonical);Ce.draw(b,S.TRIANGLES,t.DepthMode.disabled,I,F,ee,tl(h,Ee,Pe,Ne,me,Re,o.paint.get("heatmap-intensity")),o.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,o.paint,h.transform.zoom,ie,H?[Le.globeExtVertexBuffer]:null)}b.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(b,S){const I=b.context,F=I.gl,N=S.heatmapFbo;if(!N)return;I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.colorAttachment.get()),I.activeTexture.set(F.TEXTURE1);let H=S.colorRampTexture;H||(H=S.colorRampTexture=new t.Texture(I,S.colorRamp,F.RGBA)),H.bind(F.LINEAR,F.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,F.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,b.colorModeForRenderPass(),t.CullFaceMode.disabled,((X,ee,me,xe)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,S),S.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,S.paint,b.transform.zoom)}(h,o))},line:function(h,r,o,u){if(h.renderPass!=="translucent")return;const b=o.paint.get("line-opacity"),S=o.paint.get("line-width");if(b.constantOr(1)===0||S.constantOr(1)===0)return;const I=h.depthModeForSublayer(0,t.DepthMode.ReadOnly),F=h.colorModeForRenderPass(),N=h.terrain&&h.terrain.renderingToTexture?1:t.exported.devicePixelRatio,H=o.paint.get("line-dasharray"),X=H.constantOr(1),ee=o.layout.get("line-cap"),me=o.paint.get("line-pattern"),xe=me.constantOr(1),Ee=o.paint.get("line-gradient"),Pe=xe?"linePattern":"line",Le=h.context,ie=Le.gl,Ce=(Ne=>{const et=[];_o(Ne)&&et.push("RENDER_LINE_DASH"),Ne.paint.get("line-gradient")&&et.push("RENDER_LINE_GRADIENT");const Qe=Ne.paint.get("line-trim-offset");Qe[0]===0&&Qe[1]===0||et.push("RENDER_LINE_TRIM_OFFSET");const tt=Ne.paint.get("line-pattern").constantOr(1),_t=Ne.paint.get("line-opacity").constantOr(1)!==1;return!tt&&_t&&et.push("RENDER_LINE_ALPHA_DISCARD"),et})(o);let Re=Ce.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Re=!1);for(const Ne of u){const et=r.getTile(Ne);if(xe&&!et.patternsLoaded())continue;const Qe=et.getBucket(o);if(!Qe)continue;h.prepareDrawTile();const tt=Qe.programConfigurations.get(o.id),_t=h.useProgram(Pe,tt,Ce),ut=me.constantOr(null);if(ut&&et.imageAtlas){const Xt=et.imageAtlas.patternPositions[ut.toString()];Xt&&tt.setConstantPatternPositions(Xt)}const Ct=H.constantOr(null),ei=ee.constantOr(null);if(!xe&&Ct&&ei&&et.lineAtlas){const Xt=et.lineAtlas.getDash(Ct,ei);Xt&&tt.setConstantPatternPositions(Xt)}let[Tt,Gt]=o.paint.get("line-trim-offset");(ei==="round"||ei==="square")&&Tt!==Gt&&(Tt===0&&(Tt-=1),Gt===1&&(Gt+=1));const Pt=h.terrain?Ne.projMatrix:null,ii=xe?On(h,et,o,Pt,N):il(h,et,o,Pt,Qe.lineClipsArray.length,N,[Tt,Gt]);if(Ee){const Xt=Qe.gradients[o.id];let oi=Xt.texture;if(o.gradientVersion!==Xt.version){let qt=256;if(o.stepInterpolant){const ci=r.getSource().maxzoom,Oi=Ne.canonical.z===ci?Math.ceil(1<<h.transform.maxZoom-Ne.canonical.z):1;qt=t.clamp(t.nextPowerOfTwo(Qe.maxLineLength/t.EXTENT*1024*Oi),256,Le.maxTextureSize)}Xt.gradient=t.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:qt,image:Xt.gradient||void 0,clips:Qe.lineClipsArray}),Xt.texture?Xt.texture.update(Xt.gradient):Xt.texture=new t.Texture(Le,Xt.gradient,ie.RGBA),Xt.version=o.gradientVersion,oi=Xt.texture}Le.activeTexture.set(ie.TEXTURE1),oi.bind(o.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}X&&(Le.activeTexture.set(ie.TEXTURE0),et.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),tt.updatePaintBuffers()),xe&&(Le.activeTexture.set(ie.TEXTURE0),et.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),tt.updatePaintBuffers()),h.prepareDrawProgram(Le,_t,Ne.toUnwrapped());const Mt=Xt=>{_t.draw(Le,ie.TRIANGLES,I,Xt,F,t.CullFaceMode.disabled,ii,o.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,o.paint,h.transform.zoom,tt,[Qe.layoutVertexBuffer2])};if(Re){const Xt=h.stencilModeForClipping(Ne).ref;Xt===0&&h.terrain&&Le.clear({stencil:0});const oi={func:ie.EQUAL,mask:255};ii.u_alpha_discard_threshold=.8,Mt(new t.StencilMode(oi,Xt,255,ie.KEEP,ie.KEEP,ie.INVERT)),ii.u_alpha_discard_threshold=0,Mt(new t.StencilMode(oi,Xt,255,ie.KEEP,ie.KEEP,ie.KEEP))}else Mt(h.stencilModeForClipping(Ne))}Re&&(h.resetStencilClippingMasks(),h.terrain&&Le.clear({stencil:0}))},fill:function(h,r,o,u){const b=o.paint.get("fill-color"),S=o.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const I=h.colorModeForRenderPass(),F=o.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!F.constantOr(1)&&b.constantOr(t.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===N){const H=h.depthModeForSublayer(1,h.renderPass==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);La(h,r,o,u,H,I,!1)}if(h.renderPass==="translucent"&&o.paint.get("fill-antialias")){const H=h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);La(h,r,o,u,H,I,!0)}},"fill-extrusion":function(h,r,o,u){const b=o.paint.get("fill-extrusion-opacity");if(b!==0&&h.renderPass==="translucent"){const S=new t.DepthMode(h.context.gl.LEQUAL,t.DepthMode.ReadWrite,h.depthRangeFor3D);if(b!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))ra(h,r,o,u,S,t.StencilMode.disabled,t.ColorMode.disabled),ra(h,r,o,u,S,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const I=h.colorModeForRenderPass();ra(h,r,o,u,S,t.StencilMode.disabled,I)}}},hillshade:function(h,r,o,u){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const b=h.context,S=h.depthModeForSublayer(0,t.DepthMode.ReadOnly),I=h.colorModeForRenderPass(),F=h.terrain&&h.terrain.renderingToTexture,[N,H]=h.renderPass!=="translucent"||F?[{},u]:h.stencilConfigForOverlap(u);for(const X of H){const ee=r.getTile(X);if(ee.needsHillshadePrepare&&h.renderPass==="offscreen")wa(h,ee,o,S,t.StencilMode.disabled,I);else if(h.renderPass==="translucent"){const me=F&&h.terrain?h.terrain.stencilModeForRTTOverlap(X):N[X.overscaledZ];kl(h,X,ee,o,S,me,I)}}b.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,o,u,b,S){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!u.length)return;const I=h.context,F=I.gl,N=r.getSource(),H=h.useProgram("raster"),X=h.colorModeForRenderPass(),ee=h.terrain&&h.terrain.renderingToTexture,[me,xe]=N instanceof Vi||ee?[{},u]:h.stencilConfigForOverlap(u),Ee=xe[xe.length-1].overscaledZ,Pe=!h.options.moving;for(const Le of xe){const ie=ee?t.DepthMode.disabled:h.depthModeForSublayer(Le.overscaledZ-Ee,o.paint.get("raster-opacity")===1?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,F.LESS),Ce=Le.toUnwrapped(),Re=r.getTile(Le);if(ee&&(!Re||!Re.hasData()))continue;const Ne=ee?Le.projMatrix:h.transform.calculateProjMatrix(Ce,Pe),et=h.terrain&&ee?h.terrain.stencilModeForRTTOverlap(Le):me[Le.overscaledZ],Qe=S?0:o.paint.get("raster-fade-duration");Re.registerFadeDuration(Qe);const tt=r.findLoadedParent(Le,0),_t=Zt(Re,tt,r,h.transform,Qe);let ut,Ct;h.terrain&&h.terrain.prepareDrawTile();const ei=o.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;I.activeTexture.set(F.TEXTURE0),Re.texture.bind(ei,F.CLAMP_TO_EDGE),I.activeTexture.set(F.TEXTURE1),tt?(tt.texture.bind(ei,F.CLAMP_TO_EDGE),ut=Math.pow(2,tt.tileID.overscaledZ-Re.tileID.overscaledZ),Ct=[Re.tileID.canonical.x*ut%1,Re.tileID.canonical.y*ut%1]):Re.texture.bind(ei,F.CLAMP_TO_EDGE),Re.texture.useMipmap&&I.extTextureFilterAnisotropic&&h.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Tt=Ca(Ne,Ct||[0,0],ut||1,_t,o,N instanceof Vi?N.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(I,H,Ce),N instanceof Vi)N.boundsBuffer&&N.boundsSegments&&H.draw(I,F.TRIANGLES,ie,t.StencilMode.disabled,X,t.CullFaceMode.disabled,Tt,o.id,N.boundsBuffer,h.quadTriangleIndexBuffer,N.boundsSegments);else{const{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:Pt,tileBoundsSegments:ii}=h.getTileBoundsBuffers(Re);H.draw(I,F.TRIANGLES,ie,et,X,t.CullFaceMode.disabled,Tt,o.id,Gt,Pt,ii)}}h.resetStencilClippingMasks()},background:function(h,r,o,u){const b=o.paint.get("background-color"),S=o.paint.get("background-opacity");if(S===0)return;const I=h.context,F=I.gl,N=h.transform,H=N.tileSize,X=o.paint.get("background-pattern");if(h.isPatternMissing(X))return;const ee=!X&&b.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==ee)return;const me=t.StencilMode.disabled,xe=h.depthModeForSublayer(0,ee==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),Ee=h.colorModeForRenderPass(),Pe=h.useProgram(X?"backgroundPattern":"background");let Le,ie=u;ie||(Le=h.getBackgroundTiles(),ie=Object.values(Le).map(Ce=>Ce.tileID)),X&&(I.activeTexture.set(F.TEXTURE0),h.imageManager.bind(h.context));for(const Ce of ie){const Re=Ce.toUnwrapped(),Ne=u?Ce.projMatrix:h.transform.calculateProjMatrix(Re);h.prepareDrawTile();const et=r?r.getTile(Ce):Le?Le[Ce.key]:new t.Tile(Ce,H,N.zoom,h),Qe=X?yc(Ne,S,h,X,{tileID:Ce,tileSize:H}):Pa(Ne,S,b);h.prepareDrawProgram(I,Pe,Re);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:_t,tileBoundsSegments:ut}=h.getTileBoundsBuffers(et);Pe.draw(I,F.TRIANGLES,xe,me,Ee,t.CullFaceMode.disabled,Qe,o.id,tt,_t,ut)}},sky:function(h,r,o){const u=h.transform,b=u.projection.name==="mercator"||u.projection.name==="globe"?1:t.smoothstep(7,8,u.zoom),S=o.paint.get("sky-opacity")*b;if(S===0)return;const I=h.context,F=o.paint.get("sky-type"),N=new t.DepthMode(I.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),H=h.frameCounter/1e3%1;F==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(X,ee,me,xe){const Ee=X.context,Pe=Ee.gl;let Le=ee.skyboxFbo;if(!Le){Le=ee.skyboxFbo=Ee.createFramebuffer(32,32,!1),ee.skyboxGeometry=new dn(Ee),ee.skyboxTexture=Ee.gl.createTexture(),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,ee.skyboxTexture),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR);for(let Ne=0;Ne<6;++Ne)Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,Pe.RGBA,32,32,0,Pe.RGBA,Pe.UNSIGNED_BYTE,null)}Ee.bindFramebuffer.set(Le.framebuffer),Ee.viewport.set([0,0,32,32]);const ie=ee.getCenter(X,!0),Ce=X.useProgram("skyboxCapture"),Re=new Float64Array(16);t.identity(Re),t.rotateY(Re,Re,.5*-Math.PI),xn(Ee,ee,Ce,Re,ie,0),t.identity(Re),t.rotateY(Re,Re,.5*Math.PI),xn(Ee,ee,Ce,Re,ie,1),t.identity(Re),t.rotateX(Re,Re,.5*-Math.PI),xn(Ee,ee,Ce,Re,ie,2),t.identity(Re),t.rotateX(Re,Re,.5*Math.PI),xn(Ee,ee,Ce,Re,ie,3),t.identity(Re),xn(Ee,ee,Ce,Re,ie,4),t.identity(Re),t.rotateY(Re,Re,Math.PI),xn(Ee,ee,Ce,Re,ie,5),Ee.viewport.set([0,0,X.width,X.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(X,ee,me,xe,Ee){const Pe=X.context,Le=Pe.gl,ie=X.transform,Ce=X.useProgram("skybox");Pe.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_CUBE_MAP,ee.skyboxTexture);const Re=((Ne,et,Qe,tt,_t)=>({u_matrix:Ne,u_sun_direction:et,u_cubemap:0,u_opacity:tt,u_temporal_offset:_t}))(ie.skyboxMatrix,ee.getCenter(X,!1),0,xe,Ee);X.prepareDrawProgram(Pe,Ce),Ce.draw(Pe,Le.TRIANGLES,me,t.StencilMode.disabled,X.colorModeForRenderPass(),t.CullFaceMode.backCW,Re,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(h,o,N,S,H):F==="gradient"&&h.renderPass==="sky"&&function(X,ee,me,xe,Ee){const Pe=X.context,Le=Pe.gl,ie=X.transform,Ce=X.useProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new dn(Pe)),Pe.activeTexture.set(Le.TEXTURE0);let Re=ee.colorRampTexture;Re||(Re=ee.colorRampTexture=new t.Texture(Pe,ee.colorRamp,Le.RGBA)),Re.bind(Le.LINEAR,Le.CLAMP_TO_EDGE);const Ne=((et,Qe,tt,_t,ut)=>({u_matrix:et,u_color_ramp:0,u_center_direction:Qe,u_radius:t.degToRad(tt),u_opacity:_t,u_temporal_offset:ut}))(ie.skyboxMatrix,ee.getCenter(X,!1),ee.paint.get("sky-gradient-radius"),xe,Ee);X.prepareDrawProgram(Pe,Ce),Ce.draw(Pe,Le.TRIANGLES,me,t.StencilMode.disabled,X.colorModeForRenderPass(),t.CullFaceMode.backCW,Ne,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(h,o,N,S,H)},debug:function(h,r,o){for(let u=0;u<o.length;u++)na(h,r,o[u])},custom:function(h,r,o,u){const b=h.context,S=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isLayerDraped()){if(h.renderPass==="offscreen"){const I=S.prerender;if(I){if(h.setCustomLayerDefaults(),b.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const F=h.transform.pointMerc;I.call(S,b.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(h.transform.zoom),[F.x,F.y],h.transform.pixelsPerMeterRatio)}else I.call(S,b.gl,h.transform.customLayerMatrix());b.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const F=S.renderToTile;if(F){const N=u[0].canonical,H=new t.MercatorCoordinate(N.x+u[0].wrap*(1<<N.z),N.y,N.z);b.setDepthMode(t.DepthMode.disabled),b.setStencilMode(t.StencilMode.disabled),b.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),F.call(S,b.gl,H),b.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),b.setColorMode(h.colorModeForRenderPass()),b.setStencilMode(t.StencilMode.disabled);const I=S.renderingMode==="3d"?new t.DepthMode(h.context.gl.LEQUAL,t.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,t.DepthMode.ReadOnly);if(b.setDepthMode(I),h.transform.projection.name==="globe"){const F=h.transform.pointMerc;S.render(b.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(h.transform.zoom),[F.x,F.y],h.transform.pixelsPerMeterRatio)}else S.render(b.gl,h.transform.customLayerMatrix());b.setDirty(),h.setBaseState(),b.bindFramebuffer.set(null)}}else t.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Oa{constructor(r,o,u=!1){this.context=new ti(r,u),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,o){const u=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new lr(this,r));const b=this._terrain;this.transform.elevation=u?b:null,b.update(r,this.transform,o)}_updateFog(r){const o=r.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,b]=o.getFovAdjustedRange(this.transform._fov);if(u>b)return void(this.transform.fogCullDistSq=null);const S=u+.78*(b-u);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,o){if(this.width=r*t.exported.devicePixelRatio,this.height=o*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const r=this.context,o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(t.EXTENT,0),o.emplaceBack(0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(o,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const u=new t.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(t.EXTENT,0),u.emplaceBack(0,t.EXTENT),u.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=r.createVertexBuffer(u,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const b=new t.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const S=new t.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(t.EXTENT,0,t.EXTENT,0),S.emplaceBack(0,t.EXTENT,0,t.EXTENT),S.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(S,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const I=new t.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(I);const F=new t.StructArrayLayout1ui2;for(const H of[0,1,3,2,0])F.emplaceBack(H);this.debugIndexBuffer=r.createIndexBuffer(F),this.emptyTexture=new t.Texture(r,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=t.create();const N=this.context.gl;this.stencilClearMode=new t.StencilMode({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(t.window.performance.now()),this.atmosphereBuffer=new Da(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,o=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,o.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,It(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,o,u){if(!o||this.currentStencilSource===o.id||!r.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let F=!1;for(const N of u)if(this._tileClippingMaskIDs[N.key]===void 0){F=!0;break}if(!F)return}this.currentStencilSource=o.id;const b=this.context,S=b.gl;this.nextStencilID+u.length>256&&this.clearStencil(),b.setColorMode(t.ColorMode.disabled),b.setDepthMode(t.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const F of u){const N=o.getTile(F),H=this._tileClippingMaskIDs[F.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:ee,tileBoundsSegments:me}=this.getTileBoundsBuffers(N);I.draw(b,S.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:S.ALWAYS,mask:0},H,255,S.KEEP,S.KEEP,S.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,It(F.projMatrix),"$clipping",X,ee,me)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,o=this.context.gl;return new t.StencilMode({func:o.NOTEQUAL,mask:255},r,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const o=this.context.gl;return new t.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(r){const o=this.context.gl,u=r.sort((I,F)=>F.overscaledZ-I.overscaledZ),b=u[u.length-1].overscaledZ,S=u[0].overscaledZ-b+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const I={};for(let F=0;F<S;F++)I[F+b]=new t.StencilMode({func:o.GEQUAL,mask:255},F+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=S,[I,u]}return[{[b]:t.StencilMode.disabled},u]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new t.ColorMode([r.CONSTANT_COLOR,r.ONE],new t.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(r,o,u){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new t.DepthMode(u||this.context.gl.LEQUAL,o,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,o){this.style=r,this.options=o,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const u=this.style.order,b=this.style._sourceCaches;for(const H in b){const X=b[H];X.used&&X.prepare(this.context)}const S={},I={},F={};for(const H in b){const X=b[H];S[H]=X.getVisibleCoordinates(),I[H]=S[H].slice().reverse(),F[H]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<u.length;H++)if(this.style._layers[u[H]].is3D()){this.opaquePassCutoff=H;break}if(this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const H of u){const X=this.style._layers[H],ee=r._getLayerSourceCache(X);if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const me=ee?I[ee.id]:void 0;(X.type==="custom"||X.isSky()||me&&me.length)&&this.renderLayer(this,ee,X,me)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const N=this.terrain;if(N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&N.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[u[this.currentLayer]],X=r._getLayerSourceCache(H);if(H.isSky())continue;const ee=X?I[X.id]:void 0;this._renderTileClippingMasks(H,X,ee),this.renderLayer(this,X,H,ee)}if(this.style.fog&&this.transform.projection.supportsFog&&function(H,X){const ee=H.context,me=ee.gl,xe=H.transform,Ee=new t.DepthMode(me.LEQUAL,t.DepthMode.ReadOnly,[0,1]),Pe=H.useProgram("globeAtmosphere",null,xe.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Le=t.globeToMercatorTransition(xe.zoom),ie=X.properties.get("color").toArray01(),Ce=X.properties.get("high-color").toArray01(),Re=X.properties.get("space-color").toArray01PremultipliedAlpha(),Ne=t.identity$1([]);t.rotateY$1(Ne,Ne,-t.degToRad(xe._center.lng)),t.rotateX$1(Ne,Ne,t.degToRad(xe._center.lat)),t.rotateZ$1(Ne,Ne,xe.angle),t.rotateX$1(Ne,Ne,-xe._pitch);const et=t.fromQuat(new Float32Array(16),Ne),Qe=t.mapValue(X.properties.get("star-intensity"),0,1,0,.25),tt=5e-4,_t=t.mapValue(X.properties.get("horizon-blend"),0,1,tt,.25),ut=t.globeUseCustomAntiAliasing(H,ee,xe)&&_t===tt?xe.worldSize/(2*Math.PI*1.025)-1:xe.globeRadius,Ct=H.frameCounter/1e3%1,ei=t.length(xe.globeCenterInViewSpace),Tt=Math.sqrt(Math.pow(ei,2)-Math.pow(ut,2)),Gt=Math.acos(Tt/ei),Pt=((Mt,Xt,oi,qt,ci,Oi,$i,Si,zi,rr,Xi,Pi,yr,Lr)=>({u_frustum_tl:Mt,u_frustum_tr:Xt,u_frustum_br:oi,u_frustum_bl:qt,u_horizon:ci,u_transition:Oi,u_fadeout_range:$i,u_color:Si,u_high_color:zi,u_space_color:rr,u_star_intensity:Xi,u_star_size:5*t.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pi,u_horizon_angle:yr,u_rotation_matrix:Lr}))(xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.frustumCorners.horizon,Le,_t,ie,Ce,Re,Qe,Ct,Gt,et);H.prepareDrawProgram(ee,Pe);const ii=H.atmosphereBuffer;ii&&Pe.draw(ee,me.TRIANGLES,Ee,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,Pt,"skybox",ii.vertexBuffer,ii.indexBuffer,ii.segments)}(this,this.style.fog),this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const H=this.style._layers[u[this.currentLayer]],X=r._getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,X,H,X?I[X.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const H=this.style._layers[u[this.currentLayer]],X=r._getLayerSourceCache(H);if(H.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ee=X?(H.type==="symbol"?F:I)[X.id]:void 0;this._renderTileClippingMasks(H,X,X?S[X.id]:void 0),this.renderLayer(this,X,H,ee),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;t.values(this.style._layers).forEach(X=>{const ee=r._getLayerSourceCache(X);ee&&!X.isHidden(this.transform.zoom)&&(!H||H.getSource().maxzoom<ee.getSource().maxzoom)&&(H=ee)}),H&&this.options.showTileBoundaries&&xo.debug(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const X=H.transform.padding;sl(H,H.transform.height-(X.top||0),3,$n),sl(H,X.bottom||0,3,qo),is(H,X.left||0,3,Ia),is(H,H.transform.width-(X.right||0),3,nl);const ee=H.transform.centerPoint;(function(me,xe,Ee,Pe){fs(me,xe-1,Ee-10,2,20,Pe),fs(me,xe-10,Ee-1,20,2,Pe)})(H,ee.x,H.transform.height-ee.y,ka)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,o,u,b){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||b&&b.length)&&(this.id=u.id,this.gpuTimingStart(u),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(u.type)||r.terrain&&u.type==="custom")&&xo[u.type](r,o,u,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let u=this.gpuTimers[r.id];u||(u=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),u.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,u.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,o=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),r.beginQueryEXT(r.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const o={};for(const u in r){const b=r[u],S=this.context.extTimerQuery,I=S.getQueryObjectEXT(b.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(b.query),o[u]=I}return o}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let u=0;for(const b of r)u+=o.getQueryObjectEXT(b,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(b);return u}translatePosMatrix(r,o,u,b,S){if(!u[0]&&!u[1])return r;const I=S?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(I){const H=Math.sin(I),X=Math.cos(I);u=[u[0]*X-u[1]*H,u[0]*H+u[1]*X]}const F=[S?u[0]:Oe(o,u[0],this.transform.zoom),S?u[1]:Oe(o,u[1],this.transform.zoom),0],N=new Float32Array(16);return t.translate(N,r,F),N}saveTileTexture(r){const o=this._tileTextures[r.size[0]];o?o.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const o=this._tileTextures[r];return o&&o.length>0?o.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,u=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),this.transform.projection.name==="globe"&&b.push("GLOBE"),o&&b.push("ZERO_EXAGGERATION"),u&&!r&&u.getOpacity(this.transform.pitch)!==0&&b.push("FOG"),r&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(r,o,u){this.cache=this.cache||{};const b=u||[],S=this.currentGlobalDefines().concat(b),I=Ci.cacheKey(xa[r],r,S,o);return this.cache[I]||(this.cache[I]=new Ci(this.context,r,xa[r],o,Ol[r],S)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,o,u){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const S=b.getOpacity(this.transform.pitch),I=((F,N,H,X,ee,me,xe,Ee,Pe,Le,ie)=>{const Ce=F.transform,Re=N.properties.get("color").toArray01();Re[3]=X;const Ne=F.frameCounter/1e3%1;return{u_fog_matrix:H?Ce.calculateFogTileMatrix(H):F.identityMat,u_fog_range:N.getFovAdjustedRange(Ce._fov),u_fog_color:Re,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_temporal_offset:Ne,u_frustum_tl:ee,u_frustum_tr:me,u_frustum_br:xe,u_frustum_bl:Ee,u_globe_pos:Pe,u_globe_radius:Le,u_viewport:ie,u_globe_transition:t.globeToMercatorTransition(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,b,u,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.exported.devicePixelRatio,this.transform.height*t.exported.devicePixelRatio]);o.setFogUniformValues(r,I)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const b of u)o[b.key]=r[b.key]||new t.Tile(b,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class Fl{constructor(r=0,o=0,u=0,b=0){if(isNaN(r)||r<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=o,this.left=u,this.right=b}interpolate(r,o,u){return o.top!=null&&r.top!=null&&(this.top=t.number(r.top,o.top,u)),o.bottom!=null&&r.bottom!=null&&(this.bottom=t.number(r.bottom,o.bottom,u)),o.left!=null&&r.left!=null&&(this.left=t.number(r.left,o.left,u)),o.right!=null&&r.right!=null&&(this.right=t.number(r.right,o.right,u)),this}getCenter(r,o){const u=t.clamp((this.left+r-this.right)/2,0,r),b=t.clamp((this.top+o-this.bottom)/2,0,o);return new t.Point(u,b)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Fl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zl(h,r){const o=t.getColumn(h,3);t.fromQuat(h,r),t.setColumn(h,3,o)}function vr(h,r){const o=t.identity$1([]);return t.rotateZ$1(o,o,-r),t.rotateX$1(o,o,-h),o}function ol(h,r){const o=[h[0],h[1],0],u=[r[0],r[1],0];if(t.length(o)>=1e-15){const I=t.normalize([],o);t.scale$2(u,I,t.dot(u,I)),r[0]=u[0],r[1]=u[1]}const b=t.cross([],r,h);if(t.len(b)<1e-15)return null;const S=Math.atan2(-b[1],b[0]);return vr(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),S)}class vc{constructor(r,o){this.position=r,this.orientation=o}get position(){return this._position}set position(r){if(r){const o=r instanceof t.MercatorCoordinate?r:new t.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(o.x=t.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(r,o){if(this.orientation=null,!this.position)return;const u=this.position,b=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(r)):0,S=t.MercatorCoordinate.fromLngLat(r,b),I=[S.x-u.x,S.y-u.y,S.z-u.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=ol(I,o)}setPitchBearing(r,o){this.orientation=vr(t.degToRad(r),t.degToRad(-o))}}class al{constructor(r,o){this._transform=t.identity([]),this.orientation=o,this.position=r}get mercatorPosition(){const r=this.position;return new t.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=t.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var o;r&&t.setColumn(this._transform,3,[(o=r)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||t.identity$1([]),r&&zl(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,o){this._orientation=vr(r,o),zl(this._transform,this._orientation)}forward(){const r=t.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=t.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=t.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,o){const u=new Float64Array(16);return t.invert(u,this.getWorldToCamera(r,o)),u}getWorldToCameraPosition(r,o,u){const b=this.position;t.scale$2(b,b,-r);const S=new Float64Array(16);return t.fromScaling(S,[u,u,u]),t.translate(S,S,b),S[10]*=o,S}getWorldToCamera(r,o){const u=new Float64Array(16),b=new Float64Array(4),S=this.position;return t.conjugate(b,this._orientation),t.scale$2(S,S,-r),t.fromQuat(u,b),t.translate(u,u,S),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(r,o,u,b){const S=new Float64Array(16);return t.perspective(S,r,o,u,b),S}getDistanceToElevation(r,o=!1){const u=r===0?0:t.mercatorZfromAltitude(r,o?t.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(u-this.position[2])/b[2]}clone(){return new al([...this.position],[...this.orientation])}}function Go(h,r){const o=rs(h.projection,h.zoom,h.width,h.height),u=function(S,I,F,N,H){const X=new t.LngLat(F.lng-180*Os,F.lat),ee=new t.LngLat(F.lng+180*Os,F.lat),me=S.project(X.lng,X.lat),xe=S.project(ee.lng,ee.lat),Ee=-Math.atan2(xe.y-me.y,xe.x-me.x),Pe=t.MercatorCoordinate.fromLngLat(F);Pe.y=t.clamp(Pe.y,-1+Os,1-Os);const Le=Pe.toLngLat(),ie=S.project(Le.lng,Le.lat),Ce=t.MercatorCoordinate.fromLngLat(Le);Ce.x+=Os;const Re=Ce.toLngLat(),Ne=S.project(Re.lng,Re.lat),et=Bl(Ne.x-ie.x,Ne.y-ie.y,Ee),Qe=t.MercatorCoordinate.fromLngLat(Le);Qe.y+=Os;const tt=Qe.toLngLat(),_t=S.project(tt.lng,tt.lat),ut=Bl(_t.x-ie.x,_t.y-ie.y,Ee),Ct=Math.abs(et.x)/Math.abs(ut.y),ei=t.identity([]);t.rotateZ(ei,ei,-Ee*(1-(H?0:N)));const Tt=t.identity([]);return t.scale(Tt,Tt,[1,1-(1-Ct)*N,1]),Tt[4]=-ut.x/ut.y*N,t.rotateZ(Tt,Tt,Ee),t.multiply(Tt,ei,Tt),Tt}(h.projection,0,h.center,o,r),b=ds(h);return t.scale(u,u,[b,b,1]),u}function ds(h){const r=h.projection,o=rs(h.projection,h.zoom,h.width,h.height),u=Rl(r,h.center),b=Rl(r,t.LngLat.convert(r.center));return Math.pow(2,u*o+(1-o)*b)}function rs(h,r,o,u,b=1/0){const S=h.range;if(!S)return 0;const I=Math.min(b,Math.max(o,u)),F=Math.log(I/1024)/Math.LN2;return t.smoothstep(S[0]+F,S[1]+F,r)}const Os=1/4e4;function Rl(h,r){const o=t.clamp(r.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),u=new t.LngLat(r.lng-180*Os,o),b=new t.LngLat(r.lng+180*Os,o),S=h.project(u.lng,o),I=h.project(b.lng,o),F=t.MercatorCoordinate.fromLngLat(u),N=t.MercatorCoordinate.fromLngLat(b),H=I.x-S.x,X=I.y-S.y,ee=N.x-F.x,me=N.y-F.y,xe=Math.sqrt((ee*ee+me*me)/(H*H+X*X));return Math.log(xe)/Math.LN2}function Bl(h,r,o){const u=Math.cos(o),b=Math.sin(o);return{x:h*u-r*b,y:h*b+r*u}}class Wo{constructor(r,o,u,b,S,I,F){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=r||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(F),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new al,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Wo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,o=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=t.getProjection(this.projectionOptions);const u=!l(o,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.getProjection({name:"mercator"});const o=r!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.Point(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const o=-r*Math.PI/180;var u;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(u=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(b,S,I){var F=S[0],N=S[1],H=S[2],X=S[3],ee=Math.sin(I),me=Math.cos(I);b[0]=F*me+H*ee,b[1]=N*me+X*ee,b[2]=F*-ee+H*me,b[3]=N*-ee+X*me}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const o=t.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=t.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const o=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let b=0,S=0;for(let I=0;I<o.length;I++){const F=new t.Point(o[I][0]*this.width,u+o[I][1]*(this.height-u)),N=r.pointCoordinate(F);if(!N)continue;const H=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);b+=N[3]*H,S+=H}return S===0?NaN:b/S}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,b=this._mercatorZfromZoom(r),S=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-u,S);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let u;u=r.z<this._camera.position[2]?[o.x,o.y,o.z]:[r.x,r.y,r.z];const b=t.length(t.sub([],this._camera.position,u));return t.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let o=!1;if(r.orientation&&!t.exactEquals(r.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(r.orientation)),r.position){const u=[r.position.x,r.position.y,r.position.z];t.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,o=new vc;return o.position=new t.MercatorCoordinate(r[0],r[1],r[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(r){if(!t.length$1(r))return!1;t.normalize$1(r,r);const o=t.transformQuat([],[0,0,-1],r),u=t.transformQuat([],[0,-1,0],r);if(u[2]<0)return!1;const b=ol(o,u);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(r){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;r[2]=t.clamp(r[2],b/u,b/o),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,o,u){this._unmodified=!1,this._edgeInsets.interpolate(r,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const o=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(r){const o=[new t.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const u=this.pointCoordinate(new t.Point(0,0)),b=this.pointCoordinate(new t.Point(this.width,0)),S=this.pointCoordinate(new t.Point(this.width,this.height)),I=this.pointCoordinate(new t.Point(0,this.height)),F=Math.floor(Math.min(u.x,b.x,S.x,I.x)),N=Math.floor(Math.max(u.x,b.x,S.x,I.x)),H=1;for(let X=F-H;X<=N+H;X++)X!==0&&o.push(new t.UnwrappedTileID(X,r))}return o}coveringTiles(r){let o=this.coveringZoomLevel(r);const u=o,b=this.elevation&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&o<r.minzoom)return[];r.maxzoom!==void 0&&o>r.maxzoom&&(o=r.maxzoom);const I=this.locationCoordinate(this.center),F=this.center.lat,N=1<<o,H=[N*I.x,N*I.y,0],X=this.projection.name==="globe",ee=!X,me=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,ee),xe=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ee=N*t.mercatorZfromAltitude(1,this.center.lat),Pe=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),Le=[N*xe.x,N*xe.y,Pe*(ee?1:Ee)],ie=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Ce=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,Re=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ne=r.isTerrainDEM?-Re:this._elevation?this._elevation.getMinElevationBelowMSL():0,et=this.projection.isReprojectedInTileSpace?ds(this):1,Qe=Mt=>{const oi=new t.MercatorCoordinate(Mt.x+25e-6,Mt.y,Mt.z),qt=new t.MercatorCoordinate(Mt.x,Mt.y+25e-6,Mt.z),ci=Mt.toLngLat(),Oi=oi.toLngLat(),$i=qt.toLngLat(),Si=this.locationCoordinate(ci),zi=this.locationCoordinate(Oi),rr=this.locationCoordinate($i),Xi=Math.hypot(zi.x-Si.x,zi.y-Si.y),Pi=Math.hypot(rr.x-Si.x,rr.y-Si.y);return Math.sqrt(Xi*Pi)*et/25e-6},tt=Mt=>{const Xt=Re,oi=Ne;return{aabb:t.tileAABB(this,N,0,0,0,Mt,oi,Xt,this.projection),zoom:0,x:0,y:0,minZ:oi,maxZ:Xt,wrap:Mt,fullyVisible:!1}},_t=[];let ut=[];const Ct=o,ei=r.reparseOverscaled?u:o,Tt=Mt=>Mt*Mt,Gt=Tt((Pe-this._centerAltitude)*Ee),Pt=Mt=>{if(!this._elevation||!Mt.tileID||!S)return;const Xt=this._elevation.getMinMaxForTile(Mt.tileID),oi=Mt.aabb;Xt?(oi.min[2]=Xt.min,oi.max[2]=Xt.max,oi.center[2]=(oi.min[2]+oi.max[2])/2):(Mt.shouldSplit=ii(Mt),Mt.shouldSplit||(oi.min[2]=oi.max[2]=oi.center[2]=this._centerAltitude))},ii=Mt=>{if(Mt.zoom<Ce)return!0;if(Mt.zoom===Ct)return!1;if(Mt.shouldSplit!=null)return Mt.shouldSplit;const Xt=Mt.aabb.distanceX(Le),oi=Mt.aabb.distanceY(Le);let qt=Gt,ci=1;if(X){qt=Tt(Mt.aabb.distanceZ(Le));const Si=Math.pow(2,Mt.zoom),zi=t.latFromMercatorY((Mt.y+1)/Si),rr=t.latFromMercatorY(Mt.y/Si),Xi=Math.min(Math.max(F,zi),rr),Pi=t.circumferenceAtLatitude(Xi)/t.circumferenceAtLatitude(F);if(ci=Xi===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pi/this._mercatorScaleRatio),this.zoom<=t.GLOBE_ZOOM_THRESHOLD_MIN&&Mt.zoom===Ct-1&&Pi>=.9)return!0}else if(b&&(qt=Tt(Mt.aabb.distanceZ(Le)*Ee)),this.projection.isReprojectedInTileSpace&&u<=5){const Si=Math.pow(2,Mt.zoom),zi=Qe(new t.MercatorCoordinate((Mt.x+.5)/Si,(Mt.y+.5)/Si));ci=zi>.85?1:zi}const Oi=Xt*Xt+oi*oi+qt,$i=Tt((1<<Ct-Mt.zoom)*ie*ci*((Si,zi)=>{if(zi*Tt(.707)<Si)return 1;const rr=Math.sqrt(zi/Si);return rr/(1.4144271570014144+(Math.pow(1.1,rr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(qt,Gt),Oi));return Oi<$i};if(this.renderWorldCopies)for(let Mt=1;Mt<=3;Mt++)_t.push(tt(-Mt)),_t.push(tt(Mt));for(_t.push(tt(0));_t.length>0;){const Mt=_t.pop(),Xt=Mt.x,oi=Mt.y;let qt=Mt.fullyVisible;if(!qt){const ci=Mt.aabb.intersects(me);if(ci===0)continue;qt=ci===2}if(Mt.zoom!==Ct&&ii(Mt))for(let ci=0;ci<4;ci++){const Oi=(Xt<<1)+ci%2,$i=(oi<<1)+(ci>>1),Si={aabb:S?Mt.aabb.quadrant(ci):t.tileAABB(this,N,Mt.zoom+1,Oi,$i,Mt.wrap,Mt.minZ,Mt.maxZ,this.projection),zoom:Mt.zoom+1,x:Oi,y:$i,wrap:Mt.wrap,fullyVisible:qt,tileID:void 0,shouldSplit:void 0,minZ:Mt.minZ,maxZ:Mt.maxZ};b&&!X&&(Si.tileID=new t.OverscaledTileID(Mt.zoom+1===Ct?ei:Mt.zoom+1,Mt.wrap,Mt.zoom+1,Oi,$i),Pt(Si)),_t.push(Si)}else{const ci=Mt.zoom===Ct?ei:Mt.zoom;if(r.minzoom&&r.minzoom>ci)continue;const Oi=H[0]-(.5+Xt+(Mt.wrap<<Mt.zoom))*(1<<o-Mt.zoom),$i=H[1]-.5-oi,Si=Mt.tileID?Mt.tileID:new t.OverscaledTileID(ci,Mt.wrap,Mt.zoom,Xt,oi);ut.push({tileID:Si,distanceSq:Oi*Oi+$i*$i})}}if(this.fogCullDistSq){const Mt=this.fogCullDistSq,Xt=this.horizonLineFromTop();ut=ut.filter(oi=>{const qt=[0,0,0,1],ci=[t.EXTENT,t.EXTENT,0,1],Oi=this.calculateFogTileMatrix(oi.tileID.toUnwrapped());t.transformMat4$1(qt,qt,Oi),t.transformMat4$1(ci,ci,Oi);const $i=t.getAABBPointSquareDist(qt,ci);if($i===0)return!0;let Si=!1;const zi=this._elevation;if(zi&&$i>Mt&&Xt!==0){const rr=this.calculateProjMatrix(oi.tileID.toUnwrapped());let Xi;r.isTerrainDEM||(Xi=zi.getMinMaxForTile(oi.tileID)),Xi||(Xi={min:Ne,max:Re});const Pi=t.furthestTileCorner(this.rotation),yr=[Pi[0]*t.EXTENT,Pi[1]*t.EXTENT,Xi.max];t.transformMat4(yr,yr,rr),Si=(1-yr[1])*this.height*.5<Xt}return $i<Mt||Si})}return ut.sort((Mt,Xt)=>Mt.distanceSq-Xt.distanceSq).map(Mt=>Mt.tileID)}resize(r,o){this.width=r,this.height=o,this.pixelsToGLUnits=[2/r,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const o=t.clamp(r.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),u=this.projection.project(r.lng,o);return new t.Point(u.x*this.worldSize,u.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,o){let u,b;const S=this.centerPoint;if(this.projection.name==="globe"){const F=this.worldSize;u=(o.x-S.x)/F,b=(o.y-S.y)/F}else{const F=this.pointCoordinate(o),N=this.pointCoordinate(S);u=F.x-N.x,b=F.y-N.y}const I=this.locationCoordinate(r);this.setLocation(new t.MercatorCoordinate(I.x-u,I.y-b))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,o){const u=o?t.mercatorZfromAltitude(o,r.lat):void 0,b=this.projection.project(r.lng,r.lat);return new t.MercatorCoordinate(b.x,b.y,u)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,o){const u=o??this._centerAltitude,b=[r.x,r.y,0,1],S=[r.x,r.y,1,1];t.transformMat4$1(b,b,this.pixelMatrixInverse),t.transformMat4$1(S,S,this.pixelMatrixInverse);const I=S[3];t.scale$1(b,b,1/b[3]),t.scale$1(S,S,1/I);const F=b[2],N=S[2];return{p0:b,p1:S,t:F===N?0:(u-F)/(N-F)}}screenPointToMercatorRay(r){const o=[r.x,r.y,0,1],u=[r.x,r.y,1,1];return t.transformMat4$1(o,o,this.pixelMatrixInverse),t.transformMat4$1(u,u,this.pixelMatrixInverse),t.scale$1(o,o,1/o[3]),t.scale$1(u,u,1/u[3]),o[2]=t.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,u[2]=t.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,t.scale$1(o,o,1/this.worldSize),t.scale$1(u,u,1/this.worldSize),new t.Ray([o[0],o[1],o[2]],t.normalize([],t.sub([],u,o)))}rayIntersectionCoordinate(r){const{p0:o,p1:u,t:b}=r,S=t.mercatorZfromAltitude(o[2],this._center.lat),I=t.mercatorZfromAltitude(u[2],this._center.lat);return new t.MercatorCoordinate(t.number(o[0],u[0],b)/this.worldSize,t.number(o[1],u[1],b)/this.worldSize,t.number(S,I,b))}pointCoordinate(r,o=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,o)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let o=this.projection.pointCoordinate3D(this,r.x,r.y);if(o)return new t.MercatorCoordinate(o[0],o[1],o[2]);let u=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r);const S=.02*b,I=r.clone();for(let F=0;F<10&&b-u>S;F++){I.y=t.number(u,b,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(b=I.y,o=N):u=I.y}return o?new t.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const o=this.pointCoordinate(r);return o.y>=0&&o.y<=1}_coordinatePoint(r,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,b=[r.x*this.worldSize,r.y*this.worldSize,u+r.toAltitude(),1];return t.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new t.Point(b[0]/b[3],b[1]/b[3]):new t.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:o}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,S=this.pointLocation3D(new t.Point(o,r)),I=this.pointLocation3D(new t.Point(b,r)),F=this.pointLocation3D(new t.Point(b,u)),N=this.pointLocation3D(new t.Point(o,u));let H=Math.min(S.lng,I.lng,F.lng,N.lng),X=Math.max(S.lng,I.lng,F.lng,N.lng),ee=Math.min(S.lat,I.lat,F.lat,N.lat),me=Math.max(S.lat,I.lat,F.lat,N.lat);const xe=Math.pow(2,-this.zoom)/16*270,Ee=this.projection.name==="globe"?1:4,Pe=(Le,ie,Ce,Re,Ne)=>{const et=(Le+Ce)/2,Qe=(ie+Re)/2,tt=new t.Point(et,Qe),{lng:_t,lat:ut}=this.pointLocation3D(tt),Ct=Math.max(0,H-_t,ee-ut,_t-X,ut-me);H=Math.min(H,_t),X=Math.max(X,_t),ee=Math.min(ee,ut),me=Math.max(me,ut),(Ne<Ee||Ct>xe)&&(Pe(Le,ie,et,Qe,Ne+1),Pe(et,Qe,Ce,Re,Ne+1))};if(Pe(o,r,b,r,1),Pe(b,r,b,u,1),Pe(b,u,o,u,1),Pe(o,u,o,r,1),this.projection.name==="globe"){const[Le,ie]=t.polesInViewport(this);Le?(me=90,X=180,H=-180):ie&&(ee=-90,X=180,H=-180)}return new t.LngLatBounds(new t.LngLat(H,ee),new t.LngLat(X,me))}_getBoundsRectangular(r,o){const{top:u,left:b}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,F=new t.Point(b,u),N=new t.Point(I,u),H=new t.Point(I,S),X=new t.Point(b,S);let ee=this.pointCoordinate(F,r),me=this.pointCoordinate(N,r);const xe=this.pointCoordinate(H,o),Ee=this.pointCoordinate(X,o),Pe=(Le,ie)=>(ie.y-Le.y)/(ie.x-Le.x);return ee.y>1&&me.y>=0?ee=new t.MercatorCoordinate((1-Ee.y)/Pe(Ee,ee)+Ee.x,1):ee.y<0&&me.y<=1&&(ee=new t.MercatorCoordinate(-Ee.y/Pe(Ee,ee)+Ee.x,0)),me.y>1&&ee.y>=0?me=new t.MercatorCoordinate((1-xe.y)/Pe(xe,me)+xe.x,1):me.y<0&&ee.y<=1&&(me=new t.MercatorCoordinate(-xe.y/Pe(xe,me)+xe.x,0)),new t.LngLatBounds().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(me)).extend(this.coordinateLocation(Ee)).extend(this.coordinateLocation(xe))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=r.visibleDemTiles.reduce((u,b)=>{if(b.dem){const S=b.dem.tree;u.min=Math.min(u.min,S.minimums[0]),u.max=Math.max(u.max,S.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*r.exaggeration(),o.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return r?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,o){return this.projection.createTileMatrix(this,o,r)}calculateDistanceTileData(r){const o=r.key,u=this._distanceTileDataCache;if(u[o])return u[o];const b=r.canonical,S=1/this.height,I=this.cameraWorldSize,F=I/this.zoomScale(b.z),N=(b.x+Math.pow(2,b.z)*r.wrap)*F,H=b.y*F,X=this.point;X.x*=I/this.worldSize,X.y*=I/this.worldSize;const ee=this.angle,me=Math.sin(-ee),xe=-Math.cos(-ee);return u[o]={bearing:[me,xe],center:[(X.x-N)*S,(X.y-H)*S],scale:F/t.EXTENT*S},u[o]}calculateFogTileMatrix(r){const o=r.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return t.multiply(b,this.worldToFogMatrix,b),u[o]=new Float32Array(b),u[o]}calculateProjMatrix(r,o=!1){const u=r.key,b=o?this._alignedProjMatrixCache:this._projMatrixCache;if(b[u])return b[u];const S=this.calculatePosMatrix(r,this.worldSize);return t.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,S),b[u]=new Float32Array(S),b[u]}calculatePixelsToTileUnitsMatrix(r){const o=r.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const b=function(S,I){const{scale:F}=S.tileTransform,N=F*t.EXTENT/(S.tileSize*Math.pow(2,I.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return H=new Float32Array(4),me=(X=I.inverseAdjustmentMatrix)[1],xe=X[2],Ee=X[3],Le=(ee=[N,N])[1],H[0]=X[0]*(Pe=ee[0]),H[1]=me*Pe,H[2]=xe*Le,H[3]=Ee*Le,H;var H,X,ee,me,xe,Ee,Pe,Le}(r,this);return u[o]=b,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,o=t.fromScaling([],[r,r,r]);return t.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const o=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),b=this._camera.forward(),S=t.mercatorZfromAltitude(1,this._center.lat);u[2]/=S,b[2]/=S,t.normalize(b,b);const I=r.raycast(u,b,r.exaggeration());if(I){const F=t.scaleAndAdd([],u,b,I),N=new t.MercatorCoordinate(F[0],F[1],t.mercatorZfromAltitude(F[2],t.latFromMercatorY(F[1]))),H=(N.z+t.length([N.x-u[0],N.y-u[1],N.z-u[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const o=this._elevation,u=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(u),S=o.getAtPointOrZero(new t.MercatorCoordinate(...b)),I=this.pixelsPerMeter/this.worldSize*S,F=this._minimumHeightOverTerrain(),N=b[2]-I;if(N<=F)if(N<0||r){const H=this.locationCoordinate(this._center,this._centerAltitude),X=[b[0],b[1],H.z-b[2]],ee=t.length(X);X[2]-=(F-N)/this._pixelsPerMercatorPixel;const me=t.length(X);if(me===0)return;t.scale$2(X,X,ee/me*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],H.z*this._pixelsPerMercatorPixel-X[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const me=this.center;return me.lat=t.clamp(me.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(me.lng=t.clamp(me.lng,this.minLng,this.maxLng)),this.center=me,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:b}=this.point;let S=0,I=u,F=b;const N=this.width/2,H=this.height/2,X=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(b-H<X&&(F=X+H),b+H>ee&&(F=ee-H),ee-X<this.height&&(S=Math.max(S,this.height/(ee-X)),F=(ee+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const me=this.worldMinX*this.scale,xe=this.worldMaxX*this.scale,Ee=this.worldSize/2-(me+xe)/2;I=(u+Ee+this.worldSize)%this.worldSize-Ee,I-N<me&&(I=me+N),I+N>xe&&(I=xe-N),xe-me<this.width&&(S=Math.max(S,this.width/(xe-me)),I=(xe+me)/2)}I===u&&F===b||(this.center=this.unproject(new t.Point(I,F))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.mercatorZfromAltitude(1,this.center.lat)/t.mercatorZfromAltitude(1,t.GLOBE_SCALE_MATCH_LATITUDE));const u=rs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,u),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?o:1,S=this._camera.getWorldToCamera(this.worldSize,b),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-r.x/this.width,I[9]=2*r.y/this.height;let F=t.mul([],I,S);if(this.projection.isReprojectedInTileSpace){const Qe=this.locationCoordinate(this.center),tt=t.identity([]);t.translate(tt,tt,[Qe.x*this.worldSize,Qe.y*this.worldSize,0]),t.multiply(tt,tt,Go(this)),t.translate(tt,tt,[-Qe.x*this.worldSize,-Qe.y*this.worldSize,0]),t.multiply(F,F,tt),this.inverseAdjustmentMatrix=function(_t){const ut=Go(_t,!0);return ve([],[ut[0],ut[1],ut[4],ut[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const N=t.invert([],I);this.frustumCorners=t.FrustumCorners.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height);const H=new Float32Array(16);t.identity(H),t.scale(H,H,[1,-1,1]),t.rotateX(H,H,this._pitch),t.rotateZ(H,H,this.angle);const X=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-r.x/this.width,X[9]=2*(r.y+ee)/this.height,this.skyboxMatrix=t.multiply(H,X,H);const me=this.point,xe=me.x,Ee=me.y,Pe=this.width%2/2,Le=this.height%2/2,ie=Math.cos(this.angle),Ce=Math.sin(this.angle),Re=xe-Math.round(xe)+ie*Pe+Ce*Le,Ne=Ee-Math.round(Ee)+ie*Le+Ce*Pe,et=new Float64Array(F);if(t.translate(et,et,[Re>.5?Re-1:Re,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=et,F=t.create(),t.scale(F,F,[this.width/2,-this.height/2,1]),t.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=t.create(),t.scale(F,F,[1,-1,1]),t.translate(F,F,[-1,-1,0]),t.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},F=t.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.calculateGlobeMatrix(this);const Qe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.transformMat4(Qe,Qe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,u=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,S=[r,r,o];t.scale$2(S,S,b),t.scale$2(u,u,-1),t.multiply$2(u,u,S);const I=t.create();t.translate(I,I,u),t.scale(I,I,S),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,o,b)}_computeCameraPosition(r){const o=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),b=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-r/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-u[0]*S,b.y/this.worldSize-u[1]*S,r/this.worldSize*this._centerAltitude-u[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],b=r[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(S=Math.min((o-u)/b,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,r,S),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:b}=this._camera.getPitchBearing(),S=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),F=Math.max((r[2]-S)/Math.cos(u),I),N=this._zoomFromMercatorZ(F);t.scaleAndAdd(r,r,o,F),this._pitch=t.clamp(u,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(b,-Math.PI,Math.PI),this._setZoom(t.clamp(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let o=0,u=t.GLOBE_ZOOM_THRESHOLD_MAX,b=0,S=1/0;for(;u-o>1e-6&&u>o;){const I=o+.5*(u-o),F=this.tileSize*Math.pow(2,I),N=this.getCameraToCenterDistance(this.projection,I,F),H=this.scaleZoom(N/(r*this.tileSize)),X=Math.abs(I-H);X<S&&(S=X,b=I),I<H?o=I:u=I}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,o){const u=Math.min(r.x,o.x),b=Math.max(r.x,o.x),S=Math.min(r.y,o.y),I=Math.max(r.y,o.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const F=[new t.Point(u,S),new t.Point(b,I),new t.Point(u,I),new t.Point(b,S)],N=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const X of F){const ee=this.pointRayIntersection(X);if(ee.t<0)return!0;const me=this.rayIntersectionCoordinate(ee);if(me.x<N||me.y<0||me.x>H||me.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.Point(0,0),new t.Point(this.width,this.height))}zoomDeltaToMovement(r,o){const u=t.length(t.sub([],this._camera.position,r)),b=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([o,u,b],S){const I=[o,u,b,1];t.transformMat4$1(I,I,S);const F=I[3]=Math.max(I[3],1e-6);return I[0]/=F,I[1]/=F,I[2]/=F,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,r))}}getCameraToCenterDistance(r,o=this.zoom,u=this.worldSize){const b=rs(r,o,this.width,this.height,1024),S=r.pixelSpaceConversion(this.center.lat,u,b);return .5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.multiply(r,r,this.globeMatrix),r}}function Xo(h,r){let o=!1,u=null;const b=()=>{u=null,o&&(h(),u=setTimeout(b,r),o=!1)};return()=>(o=!0,u||b(),u)}class Nl{constructor(r){this._hashName=r&&encodeURIComponent(r),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xo(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,t.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const o=ll(r);if(this._hashName){const u=this._hashName;let b=!1;const S=t.window.location.hash.slice(1).split("&").map(I=>{const F=I.split("=")[0];return F===u?(b=!0,`${F}=${o}`):I}).filter(I=>I);return b||S.push(`${u}=${o}`),`#${S.join("&")}`}return`#${o}`}_getCurrentHash(){const r=t.window.location.hash.replace("#","");if(this._hashName){let o;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(o[3]||0):r.getBearing();return r.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,r)}}function ll(h,r){const o=h.getCenter(),u=Math.round(100*h.getZoom())/100,b=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),I=Math.round(o.lng*S)/S,F=Math.round(o.lat*S)/S,N=h.getBearing(),H=h.getPitch();let X=r?`/${I}/${F}/${u}`:`${u}/${F}/${I}`;return(N||H)&&(X+="/"+Math.round(10*N)/10),H&&(X+=`/${Math.round(H)}`),X}const Fa={linearity:.3,easing:t.bezier(0,0,.3,1)},cl=t.extend({deceleration:2500,maxSpeed:1400},Fa),za=t.extend({deceleration:20,maxSpeed:1400},Fa),yi=t.extend({deceleration:1e3,maxSpeed:360},Fa),so=t.extend({deceleration:1e3,maxSpeed:90},Fa);class oh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,o=t.exported.now();for(;r.length>0&&o-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)o.zoom+=S.zoomDelta||0,o.bearing+=S.bearingDelta||0,o.pitch+=S.pitchDelta||0,S.panDelta&&o.pan._add(S.panDelta),S.around&&(o.around=S.around),S.pinchAround&&(o.pinchAround=S.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(o.pan.mag()){const S=jl(o.pan.mag(),u,t.extend({},cl,r||{}));b.offset=o.pan.mult(S.amount/o.pan.mag()),b.center=this._map.transform.center,hl(b,S)}if(o.zoom){const S=jl(o.zoom,u,za);b.zoom=this._map.transform.zoom+S.amount,hl(b,S)}if(o.bearing){const S=jl(o.bearing,u,yi);b.bearing=this._map.transform.bearing+t.clamp(S.amount,-179,179),hl(b,S)}if(o.pitch){const S=jl(o.pitch,u,so);b.pitch=this._map.transform.pitch+S.amount,hl(b,S)}if(b.zoom||b.bearing){const S=o.pinchAround===void 0?o.around:o.pinchAround;b.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function hl(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function jl(h,r,o){const{maxSpeed:u,linearity:b,deceleration:S}=o,I=t.clamp(h*b/(r/1e3),-u,u),F=Math.abs(I)/(S*b);return{easing:o.easing,duration:1e3*F,amount:I*(F/2)}}class Fn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,u,b={}){const S=K(o.getCanvasContainer(),u),I=o.unproject(S);super(r,t.extend({point:S,lngLat:I,originalEvent:u},b)),this._defaultPrevented=!1,this.target=o}}class Ul extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,u){const b=r==="touchend"?u.changedTouches:u.touches,S=se(o.getCanvasContainer(),b),I=S.map(N=>o.unproject(N)),F=S.reduce((N,H,X,ee)=>N.add(H.div(ee.length)),new t.Point(0,0));super(r,{points:S,point:F,lngLats:I,lngLat:o.unproject(F),originalEvent:u}),this._defaultPrevented=!1}}class Ql extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,u){super(r,{originalEvent:u}),this._defaultPrevented=!1}}class xc{constructor(r,o){this._map=r,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Ql(r.type,this._map,r))}mousedown(r,o){return this._mousedownPos=o,this._firePreventable(new Fn(r.type,this._map,r))}mouseup(r){this._map.fire(new Fn(r.type,this._map,r))}preclick(r){const o=t.extend({},r);o.type="preclick",this._map.fire(new Fn(o.type,this._map,o))}click(r,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Fn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Fn(r.type,this._map,r))}mouseover(r){this._map.fire(new Fn(r.type,this._map,r))}mouseout(r){this._map.fire(new Fn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ul(r.type,this._map,r))}touchmove(r){this._map.fire(new Ul(r.type,this._map,r))}touchend(r){this._map.fire(new Ul(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ul(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ul{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Fn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Fn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ec{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,o){this.isEnabled()&&r.shiftKey&&r.button===0&&(C(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(r,o){if(!this._active)return;const u=o,b=this._startPos,S=this._lastPos;if(!b||!S||S.equals(u)||!this._box&&u.dist(b)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=m("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const I=Math.min(b.x,u.x),F=Math.max(b.x,u.x),N=Math.min(b.y,u.y),H=Math.max(b.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${N}px)`,this._box.style.width=F-I+"px",this._box.style.height=H-N+"px")})}mouseupWindow(r,o){if(!this._active)return;const u=this._startPos,b=o;if(u&&r.button===0){if(this.reset(),q(),u.x!==b.x||u.y!==b.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:S=>S.fitScreenCoordinates(u,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),L(),delete this._startPos,delete this._lastPos}_fireEvent(r,o){return this._map.fire(new t.Event(r,{originalEvent:o}))}}function sa(h,r){const o={};for(let u=0;u<h.length;u++)o[h[u].identifier]=r[u];return o}class fl{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),u.length===this.numTouches&&(this.centroid=function(b){const S=new t.Point(0,0);for(const I of b)S._add(I);return S.div(b.length)}(o),this.touches=sa(u,o)))}touchmove(r,o,u){if(this.aborted||!this.centroid)return;const b=sa(u,o);for(const S in this.touches){const I=b[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(r,o,u){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class bc{constructor(r){this.singleTap=new fl(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,o,u){this.singleTap.touchstart(r,o,u)}touchmove(r,o,u){this.singleTap.touchmove(r,o,u)}touchend(r,o,u){const b=this.singleTap.touchend(r,o,u);if(b){const S=r.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(S&&I||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class ah{constructor(){this._zoomIn=new bc({numTouches:1,numTaps:2}),this._zoomOut=new bc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,o,u){this._zoomIn.touchstart(r,o,u),this._zoomOut.touchstart(r,o,u)}touchmove(r,o,u){this._zoomIn.touchmove(r,o,u),this._zoomOut.touchmove(r,o,u)}touchend(r,o,u){const b=this._zoomIn.touchend(r,o,u),S=this._zoomOut.touchend(r,o,u);return b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:r})}):S?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(S)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const lh={0:1,2:2};class dl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,o){return!1}_move(r,o){return{}}mousedown(r,o){if(this._lastPoint)return;const u=he(r);this._correctButton(r,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(r,o){const u=this._lastPoint;if(u){if(r.preventDefault(),this._eventButton!=null&&function(b,S){const I=lh[S];return b.buttons===void 0||(b.buttons&I)!==I}(r,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(r){this._lastPoint&&he(r)===this._eventButton&&(this._moved&&q(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wc extends dl{mousedown(r,o){super.mousedown(r,o),this._lastPoint&&(this._active=!0)}_correctButton(r,o){return o===0&&!r.ctrlKey}_move(r,o){return{around:o,panDelta:o.sub(r)}}}class Sc extends dl{_correctButton(r,o){return o===0&&r.ctrlKey||o===2}_move(r,o){const u=.8*(o.x-r.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(r){r.preventDefault()}}class bo extends dl{_correctButton(r,o){return o===0&&r.ctrlKey||o===2}_move(r,o){const u=-.5*(o.y-r.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(r){r.preventDefault()}}class ps{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)}touchstart(r,o,u){return this._calculateTransform(r,o,u)}touchmove(r,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!t.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,o,u)}}touchend(r,o,u){this._calculateTransform(r,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,o,u){u.length>0&&(this._active=!0);const b=sa(u,o),S=new t.Point(0,0),I=new t.Point(0,0);let F=0;for(const H in b){const X=b[H],ee=this._touches[H];ee&&(S._add(X),I._add(X.sub(ee)),F++,b[H]=X)}if(this._touches=b,F<this._minTouches||!I.mag())return;const N=I.div(F);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(F),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=m("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class As{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,o,u){return{}}touchstart(r,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(r,o,u){const b=this._firstTwoTouches;if(!b)return;r.preventDefault();const[S,I]=b,F=Vl(u,o,S),N=Vl(u,o,I);if(!F||!N)return;const H=this._aroundCenter?null:F.add(N).div(2);return this._move([F,N],H,r)}touchend(r,o,u){if(!this._firstTwoTouches)return;const[b,S]=this._firstTwoTouches,I=Vl(u,o,b),F=Vl(u,o,S);I&&F||(this._active&&q(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vl(h,r,o){for(let u=0;u<h.length;u++)if(h[u].identifier===o)return r[u]}function tc(h,r){return Math.log(h/r)/Math.LN2}class Ho extends As{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,o){const u=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(tc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tc(this._distance,u),pinchAround:o}}}function ms(h,r){return 180*h.angleWith(r)/Math.PI}class ch extends As{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,o){const u=this._vector;if(this._vector=r[0].sub(r[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ms(this._vector,u),pinchAround:o}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const o=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const b=ms(r,u);return Math.abs(b)<o}}function oa(h){return Math.abs(h.y)>Math.abs(h.x)}class Tc extends As{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,oa(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,o,u){const b=this._lastPoints;if(!b)return;const S=r[0].sub(b[0]),I=r[1].sub(b[1]);return this._map._cooperativeGestures&&!t.isFullscreen()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(S,I,u.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(S.y+I.y)/2*-.5})}gestureBeginsVertically(r,o,u){if(this._valid!==void 0)return this._valid;const b=r.mag()>=2,S=o.mag()>=2;if(!b&&!S)return;if(!b||!S)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const I=r.y>0==o.y>0;return oa(r)&&oa(o)&&I}}const Cc={panStep:100,bearingStep:15,pitchStep:10};class hh{constructor(){const r=Cc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let o=0,u=0,b=0,S=0,I=0;switch(r.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:r.shiftKey?u=-1:(r.preventDefault(),S=-1);break;case 39:r.shiftKey?u=1:(r.preventDefault(),S=1);break;case 38:r.shiftKey?b=1:(r.preventDefault(),I=-1);break;case 40:r.shiftKey?b=-1:(r.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(u=0,b=0),{cameraAnimation:F=>{const N=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:Ac,zoom:o?Math.round(N)+o*(r.shiftKey?2:1):N,bearing:F.getBearing()+u*this._bearingStep,pitch:F.getPitch()+b*this._pitchStep,offset:[-S*this._panStep,-I*this._panStep],center:F.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ac(h){return h*(2-h)}const Ec=4.000244140625;class ql{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||t.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=r.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const u=t.exported.now(),b=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ec==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(b*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),r.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=r,this._delta-=o,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=K(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Ec?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&H!==0&&(H=1/H);const X=o(),ee=Math.pow(2,X),me=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):ee;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(me*H))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),b=this._startZoom,S=this._easing;let I,F=!1;if(this._type==="wheel"&&b&&S){const N=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),H=S(N);I=t.number(b,u,H),N<1?this._frameId||(this._frameId=!0):F=!0}else I=u,F=!0;return this._active=!0,F&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!F,zoomDelta:I-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let o=t.ease;if(this._prevEase){const u=this._prevEase,b=(t.exported.now()-u.start)/u.duration,S=u.easing(b+.01)-u.easing(b),I=.27/Math.sqrt(S*S+1e-4)*.01,F=Math.sqrt(.0729-I*I);o=t.bezier(I,F,.25,1)}return this._prevEase={start:t.exported.now(),duration:r,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=m("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Gl{constructor(r,o){this._clickZoom=r,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,o){return r.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(r.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pc{constructor(){this._tap=new bc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,o,u){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(r,o,u))}touchmove(r,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const b=o[0],S=b.y-this._swipePoint.y;return this._swipePoint=b,r.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(r,o,u)}touchend(r,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(r,o,u)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mc{constructor(r,o,u){this._el=r,this._mousePan=o,this._touchPan=u}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(r,o,u){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uh{constructor(r,o,u,b){this._el=r,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fs=h=>h.zoom||h.drag||h.pitch||h.rotate;class fh extends t.Event{}class Uh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,o){const u=t.sub([],o,r);this.radius=t.length(u[2]<0?t.div([],u,this.constants):[u[0],u[1],0])}projectRay(r){t.div(r,r,this.constants),t.normalize(r,r),t.mul$1(r,r,this.constants);const o=t.scale$2([],r,this.radius);if(o[2]>0){const u=t.scale$2([],[0,0,1],t.dot(o,[0,0,1])),b=t.scale$2([],t.normalize([],[o[0],o[1],0]),this.radius),S=t.add([],o,t.scale$2([],t.sub([],t.add([],b,u),o),2));o[0]=S[0],o[1]=S[1]}return o}}function oo(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class wo{constructor(r,o){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new oh(r),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Uh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),t.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[b,S,I]of this._listeners)b.addEventListener(S,b===t.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[r,o,u]of this._listeners)r.removeEventListener(o,r===t.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(r){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new xc(o,r));const b=o.boxZoom=new ec(o,r);this._add("boxZoom",b);const S=new ah,I=new bn;o.doubleClickZoom=new Gl(I,S),this._add("tapZoom",S),this._add("clickZoom",I);const F=new Pc;this._add("tapDragZoom",F);const N=o.touchPitch=new Tc(o);this._add("touchPitch",N);const H=new Sc(r),X=new bo(r);o.dragRotate=new jh(r,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const ee=new wc(r),me=new ps(o,r);o.dragPan=new Mc(u,ee,me),this._add("mousePan",ee),this._add("touchPan",me,["touchZoom","touchRotate"]);const xe=new ch,Ee=new Ho;o.touchZoomRotate=new uh(u,Ee,xe,F),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ul(o));const Pe=o.scrollZoom=new ql(o,this);this._add("scrollZoom",Pe,["mousePan"]);const Le=o.keyboard=new hh;this._add("keyboard",Le);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ie]&&o[ie].enable(r[ie])}_add(r,o,u){this._handlers.push({handlerName:r,handler:o,allowed:u}),this._handlersById[r]=o}stop(r){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,o,u){for(const b in r)if(b!==u&&(!o||o.indexOf(b)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const o=[];for(const u of r)this._el.contains(u.target)&&o.push(u);return o}handleEvent(r,o){this._updatingCamera=!0;const u=r.type==="renderFrame",b=u?void 0:r,S={needsRenderFrame:!1},I={},F={},N=r.touches?this._getMapTouches(r.touches):void 0,H=N?se(this._el,N):u?void 0:K(this._el,r);for(const{handlerName:me,handler:xe,allowed:Ee}of this._handlers){if(!xe.isEnabled())continue;let Pe;this._blockedByActive(F,Ee,me)?xe.reset():xe[o||r.type]&&(Pe=xe[o||r.type](r,H,N),this.mergeHandlerResult(S,I,Pe,me,b),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||xe.isActive())&&(F[me]=xe)}const X={};for(const me in this._previousActiveHandlers)F[me]||(X[me]=b);this._previousActiveHandlers=F,(Object.keys(X).length||oo(S))&&(this._changes.push([S,I,X]),this._triggerRenderFrame()),(Object.keys(F).length||oo(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=S;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(r,o,u,b,S){if(!u)return;t.extend(r,u);const I={handlerName:b,originalEvent:u.originalEvent||S};u.zoomDelta!==void 0&&(o.zoom=I),u.panDelta!==void 0&&(o.drag=I),u.pitchDelta!==void 0&&(o.pitch=I),u.bearingDelta!==void 0&&(o.rotate=I)}_applyChanges(){const r={},o={},u={};for(const[b,S,I]of this._changes)b.panDelta&&(r.panDelta=(r.panDelta||new t.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(r.around=b.around),b.aroundCoord!==void 0&&(r.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(r.pinchAround=b.pinchAround),b.noInertia&&(r.noInertia=b.noInertia),t.extend(o,S),t.extend(u,I);this._updateMapTransform(r,o,u),this._changes=[]}_updateMapTransform(r,o,u){const b=this._map,S=b.transform,I=Ce=>[Ce.x,Ce.y,Ce.z];if((Ce=>{const Re=this._eventsInProgress.drag;return Re&&!this._handlersById[Re.handlerName].isActive()})()&&!oo(r)){const Ce=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",Ce!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&b._stop(!0),!oo(r))return void this._fireEvents(o,u,!0);let{panDelta:F,zoomDelta:N,bearingDelta:H,pitchDelta:X,around:ee,aroundCoord:me,pinchAround:xe}=r;S._isCameraConstrained&&(N>0&&(N=0),S._isCameraConstrained=!1),xe!==void 0&&(ee=xe),(N||(Ce=>o[Ce]&&!this._eventsInProgress[Ce])("drag"))&&ee&&(this._dragOrigin=I(S.pointCoordinate3D(ee)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",b._stop(!0),ee=ee||b.transform.centerPoint,H&&(S.bearing+=H),X&&(S.pitch+=X),S._updateCameraState();const Ee=[0,0,0];if(F)if(S.projection.name==="mercator"){const Ce=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(ee).dir),Re=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(ee.sub(F)).dir);Ee[0]=Re[0]-Ce[0],Ee[1]=Re[1]-Ce[1]}else{const Ce=S.pointCoordinate(ee);if(S.projection.name==="globe"){F=F.rotate(-S.angle);const Re=S._pixelsPerMercatorPixel/S.worldSize;Ee[0]=-F.x*t.mercatorScale(t.latFromMercatorY(Ce.y))*Re,Ee[1]=-F.y*t.mercatorScale(S.center.lat)*Re}else{const Re=S.pointCoordinate(ee.sub(F));Ce&&Re&&(Ee[0]=Re.x-Ce.x,Ee[1]=Re.y-Ce.y)}}const Pe=S.zoom,Le=[0,0,0];if(N){const Ce=I(me||S.pointCoordinate3D(ee)),Re={dir:t.normalize([],t.sub([],Ce,S._camera.position))};if(Re.dir[2]<0){const Ne=S.zoomDeltaToMovement(Ce,N);t.scale$2(Le,Re.dir,Ne)}}const ie=t.add(Ee,Ee,Le);S._translateCameraConstrained(ie),N&&Math.abs(S.zoom-Pe)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(o,u,!0)}_fireEvents(r,o,u){const b=Fs(this._eventsInProgress),S=Fs(r),I={};for(const X in r){const{originalEvent:ee}=r[X];this._eventsInProgress[X]||(I[`${X}start`]=ee),this._eventsInProgress[X]=r[X]}!b&&S&&this._fireEvent("movestart",S.originalEvent);for(const X in I)this._fireEvent(X,I[X]);S&&this._fireEvent("move",S.originalEvent);for(const X in r){const{originalEvent:ee}=r[X];this._fireEvent(X,ee)}const F={};let N;for(const X in this._eventsInProgress){const{handlerName:ee,originalEvent:me}=this._eventsInProgress[X];this._handlersById[ee].isActive()||(delete this._eventsInProgress[X],N=o[ee]||me,F[`${X}end`]=N)}for(const X in F)this._fireEvent(X,F[X]);const H=Fs(this._eventsInProgress);if(u&&(b||S)&&!H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;X?(ee(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:N})):(this._map.fire(new t.Event("moveend",{originalEvent:N})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,o){this._map.fire(new t.Event(r,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new fh("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ra="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Wl extends t.Evented{constructor(r,o){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,o){return this.jumpTo({center:r},o)}panBy(r,o,u){return r=t.Point.convert(r).mult(-1),this.panTo(this.transform.center,t.extend({offset:r},o),u)}panTo(r,o,u){return this.easeTo(t.extend({center:r},o),u)}getZoom(){return this.transform.zoom}setZoom(r,o){return this.jumpTo({zoom:r},o),this}zoomTo(r,o,u){return this.easeTo(t.extend({zoom:r},o),u)}zoomIn(r,o){return this.zoomTo(this.getZoom()+1,r,o),this}zoomOut(r,o){return this.zoomTo(this.getZoom()-1,r,o),this}getBearing(){return this.transform.bearing}setBearing(r,o){return this.jumpTo({bearing:r},o),this}getPadding(){return this.transform.padding}setPadding(r,o){return this.jumpTo({padding:r},o),this}rotateTo(r,o,u){return this.easeTo(t.extend({bearing:r},o),u)}resetNorth(r,o){return this.rotateTo(0,t.extend({duration:1e3},r),o),this}resetNorthPitch(r,o){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},r),o),this}snapToNorth(r,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,o):this}getPitch(){return this.transform.pitch}setPitch(r,o){return this.jumpTo({pitch:r},o),this}cameraForBounds(r,o){r=t.LngLatBounds.convert(r);const u=o&&o.bearing||0,b=o&&o.pitch||0,S=r.getNorthWest(),I=r.getSouthEast();return this._cameraForBounds(this.transform,S,I,u,b,o)}_extendCameraOptions(r){const o={top:0,bottom:0,right:0,left:0};if(typeof(r=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const u=r.padding;r.padding={top:u,bottom:u,right:u,left:u}}return r.padding=t.extend(o,r.padding),r}_minimumAABBFrustumDistance(r,o){const u=o.max[0]-o.min[0],b=o.max[1]-o.min[1];return u/b>r.aspect?u/(2*Math.tan(.5*r.fovX)*r.aspect):b/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,o,u,b,S,I){const F=r.clone(),N=this._extendCameraOptions(I);F.bearing=b,F.pitch=S;const H=t.LngLat.convert(o),X=t.LngLat.convert(u),ee=.5*(H.lat+X.lat),me=.5*(H.lng+X.lng),xe=t.latLngToECEF(ee,me),Ee=t.normalize([],xe),Pe=t.normalize([],t.cross([],Ee,[0,1,0])),Le=t.cross([],Pe,Ee),ie=[Pe[0],Pe[1],Pe[2],0,Le[0],Le[1],Le[2],0,Ee[0],Ee[1],Ee[2],0,0,0,0,1],Ce=[xe,t.latLngToECEF(H.lat,H.lng),t.latLngToECEF(X.lat,H.lng),t.latLngToECEF(X.lat,X.lng),t.latLngToECEF(H.lat,X.lng),t.latLngToECEF(ee,H.lng),t.latLngToECEF(ee,X.lng),t.latLngToECEF(H.lat,me),t.latLngToECEF(X.lat,me)];let Re=t.Aabb.fromPoints(Ce.map(qt=>[t.dot(Pe,qt),t.dot(Le,qt),t.dot(Ee,qt)]));const Ne=t.transformMat4([],Re.center,ie);t.squaredLength(Ne)===0&&t.set(Ne,0,0,1),t.normalize(Ne,Ne),t.scale$2(Ne,Ne,t.GLOBE_RADIUS),F.center=t.ecefToLatLng(Ne);const et=F.getWorldToCameraMatrix(),Qe=t.invert(new Float64Array(16),et);Re=t.Aabb.applyTransform(Re,t.multiply([],et,ie)),t.transformMat4(Ne,Ne,et);const tt=.5*(Re.max[2]-Re.min[2]),_t=this._minimumAABBFrustumDistance(F,Re),ut=t.scale$2([],[0,0,1],tt),Ct=t.add(ut,Ne,ut),ei=_t+(F.pitch===0?0:t.distance(Ne,Ct)),Tt=F.globeCenterInViewSpace,Gt=t.sub([],Ne,[Tt[0],Tt[1],Tt[2]]);t.normalize(Gt,Gt),t.scale$2(Gt,Gt,ei);const Pt=t.add([],Ne,Gt);t.transformMat4(Pt,Pt,Qe);const ii=t.earthRadius/t.GLOBE_RADIUS,Mt=t.length(Pt),Xt=t.mercatorZfromAltitude(Math.max(Mt*ii-t.earthRadius,Number.EPSILON),0),oi=Math.min(F.zoomFromMercatorZAdjusted(Xt),N.maxZoom);return oi>.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"mercator"}),F.zoom=oi,this._cameraForBounds(F,o,u,b,S,I)):{center:F.center,zoom:oi,bearing:b,pitch:S}}queryTerrainElevation(r,o){const u=this.transform.elevation;return u?(o=t.extend({},{exaggerated:!0},o),u.getAtPoint(t.MercatorCoordinate.fromLngLat(r),null,o.exaggerated)):null}_cameraForBounds(r,o,u,b,S,I){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,o,u,b,S,I);const F=r.clone(),N=this._extendCameraOptions(I),H=F.padding;F.bearing=b,F.pitch=S;const X=t.LngLat.convert(o),ee=t.LngLat.convert(u),me=new t.LngLat(X.lng,ee.lat),xe=new t.LngLat(ee.lng,X.lat),Ee=F.project(X),Pe=F.project(ee),Le=this.queryTerrainElevation(X),ie=this.queryTerrainElevation(ee),Ce=this.queryTerrainElevation(me),Re=this.queryTerrainElevation(xe),Ne=[[Ee.x,Ee.y,Math.min(Le||0,ie||0,Ce||0,Re||0)],[Pe.x,Pe.y,Math.max(Le||0,ie||0,Ce||0,Re||0)]];let et=t.Aabb.fromPoints(Ne);const Qe=F.getWorldToCameraMatrix(),tt=t.invert(new Float64Array(16),Qe);et=t.Aabb.applyTransform(et,Qe);const _t=t.sub([],et.max,et.min),ut=H.left||0,Ct=H.right||0,ei=H.bottom||0,Tt=H.top||0,{left:Gt,right:Pt,top:ii,bottom:Mt}=N.padding,Xt=.5*(ut+Ct),oi=.5*(Tt+ei),qt=Math.min(F.scaleZoom(F.scale*Math.min((F.width-(ut+Ct+Gt+Pt))/_t[0],(F.height-(ei+Tt+Mt+ii))/_t[1])),N.maxZoom),ci=F.scale/F.zoomScale(qt);et=new t.Aabb([et.min[0]-(Gt+Xt)*ci,et.min[1]-(Mt+oi)*ci,et.min[2]],[et.max[0]+(Pt+Xt)*ci,et.max[1]+(ii+oi)*ci,et.max[2]]);const Oi=.5*_t[2],$i=this._minimumAABBFrustumDistance(F,et),Si=[0,0,1,0];t.transformMat4$1(Si,Si,Qe),t.normalize$2(Si,Si);const zi=t.scale$2([],Si,$i+Oi),rr=t.add([],et.center,zi),Xi=(typeof N.offset.x=="number"&&typeof N.offset.y=="number"?new t.Point(N.offset.x,N.offset.y):t.Point.convert(N.offset)).rotate(-t.degToRad(b));et.center[0]-=Xi.x*ci,et.center[1]+=Xi.y*ci,t.transformMat4(et.center,et.center,tt),t.transformMat4(rr,rr,tt);const Pi=[et.center[0],et.center[1],rr[2]*F.pixelsPerMeter];t.scale$2(Pi,Pi,1/F.worldSize);const yr=t.lngFromMercatorX(Pi[0]),Lr=t.latFromMercatorY(Pi[1]),Tr=Math.min(F._zoomFromMercatorZ(Pi[2]),N.maxZoom),Ir=new t.LngLat(yr,Lr);return F.mercatorFromTransition&&Tr<.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"globe"}),F.zoom=Tr,this._cameraForBounds(F,o,u,b,S,I)):{center:Ir,zoom:Tr,bearing:b,pitch:S}}fitBounds(r,o,u){const b=this.cameraForBounds(r,o);return this._fitInternal(b,o,u)}fitScreenCoordinates(r,o,u,b,S){const I=t.Point.convert(r),F=t.Point.convert(o),N=new t.Point(Math.min(I.x,F.x),Math.min(I.y,F.y)),H=new t.Point(Math.max(I.x,F.x),Math.max(I.y,F.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,F))return this;const X=this.transform.pointLocation3D(N),ee=this.transform.pointLocation3D(H),me=this.transform.pointLocation3D(new t.Point(N.x,H.y)),xe=this.transform.pointLocation3D(new t.Point(H.x,N.y)),Ee=[Math.min(X.lng,ee.lng,me.lng,xe.lng),Math.min(X.lat,ee.lat,me.lat,xe.lat)],Pe=[Math.max(X.lng,ee.lng,me.lng,xe.lng),Math.max(X.lat,ee.lat,me.lat,xe.lat)],Le=b&&b.pitch?b.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,Ee,Pe,u,Le,b);return this._fitInternal(ie,b,S)}_fitInternal(r,o,u){return r?(delete(o=t.extend(r,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(r,o){this.stop();const u=r.preloadOnly?this.transform.clone():this.transform;let b=!1,S=!1,I=!1;return"zoom"in r&&u.zoom!==+r.zoom&&(b=!0,u.zoom=+r.zoom),r.center!==void 0&&(u.center=t.LngLat.convert(r.center)),"bearing"in r&&u.bearing!==+r.bearing&&(S=!0,u.bearing=+r.bearing),"pitch"in r&&u.pitch!==+r.pitch&&(I=!0,u.pitch=+r.pitch),r.padding==null||u.isPaddingEqual(r.padding)||(u.padding=r.padding),r.preloadOnly?(this._preloadTiles(u),this):(this.fire(new t.Event("movestart",o)).fire(new t.Event("move",o)),b&&this.fire(new t.Event("zoomstart",o)).fire(new t.Event("zoom",o)).fire(new t.Event("zoomend",o)),S&&this.fire(new t.Event("rotatestart",o)).fire(new t.Event("rotate",o)).fire(new t.Event("rotateend",o)),I&&this.fire(new t.Event("pitchstart",o)).fire(new t.Event("pitch",o)).fire(new t.Event("pitchend",o)),this.fire(new t.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(Ra),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return t.warnOnce(Ra),this;this.stop();const b=u.zoom,S=u.pitch,I=u.bearing;u.setFreeCameraOptions(r);const F=b!==u.zoom,N=S!==u.pitch,H=I!==u.bearing;return this.fire(new t.Event("movestart",o)).fire(new t.Event("move",o)),F&&this.fire(new t.Event("zoomstart",o)).fire(new t.Event("zoom",o)).fire(new t.Event("zoomend",o)),H&&this.fire(new t.Event("rotatestart",o)).fire(new t.Event("rotate",o)).fire(new t.Event("rotateend",o)),N&&this.fire(new t.Event("pitchstart",o)).fire(new t.Event("pitch",o)).fire(new t.Event("pitchend",o)),this.fire(new t.Event("moveend",o)),this}easeTo(r,o){this._stop(!1,r.easeId),((r=t.extend({offset:[0,0],duration:500,easing:t.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const u=this.transform,b=this.getZoom(),S=this.getBearing(),I=this.getPitch(),F=this.getPadding(),N="zoom"in r?+r.zoom:b,H="bearing"in r?this._normalizeBearing(r.bearing,S):S,X="pitch"in r?+r.pitch:I,ee="padding"in r?r.padding:u.padding,me=t.Point.convert(r.offset);let xe,Ee,Pe;if(u.projection.name==="globe"){const ut=t.MercatorCoordinate.fromLngLat(u.center),Ct=me.rotate(-u.angle);ut.x+=Ct.x/u.worldSize,ut.y+=Ct.y/u.worldSize;const ei=ut.toLngLat(),Tt=t.LngLat.convert(r.center||ei);this._normalizeCenter(Tt),xe=u.centerPoint.add(Ct),Ee=new t.Point(ut.x,ut.y).mult(u.worldSize),Pe=new t.Point(t.mercatorXfromLng(Tt.lng),t.mercatorYfromLat(Tt.lat)).mult(u.worldSize).sub(Ee)}else{xe=u.centerPoint.add(me);const ut=u.pointLocation(xe),Ct=t.LngLat.convert(r.center||ut);this._normalizeCenter(Ct),Ee=u.project(ut),Pe=u.project(Ct).sub(Ee)}const Le=u.zoomScale(N-b);let ie,Ce;r.around&&(ie=t.LngLat.convert(r.around),Ce=u.locationPoint(ie));const Re=this._zooming||N!==b,Ne=this._rotating||S!==H,et=this._pitching||X!==I,Qe=!u.isPaddingEqual(ee),tt=ut=>Ct=>{if(Re&&(ut.zoom=t.number(b,N,Ct)),Ne&&(ut.bearing=t.number(S,H,Ct)),et&&(ut.pitch=t.number(I,X,Ct)),Qe&&(ut.interpolatePadding(F,ee,Ct),xe=ut.centerPoint.add(me)),ie)ut.setLocationAtPoint(ie,Ce);else{const ei=ut.zoomScale(ut.zoom-b),Tt=N>b?Math.min(2,Le):Math.max(.5,Le),Gt=Math.pow(Tt,1-Ct),Pt=ut.unproject(Ee.add(Pe.mult(Ct*Gt)).mult(ei));ut.setLocationAtPoint(ut.renderWorldCopies?Pt.wrap():Pt,xe)}return r.preloadOnly||this._fireMoveEvents(o),ut};if(r.preloadOnly){const ut=this._emulate(tt,r.duration,u);return this._preloadTiles(ut),this}const _t={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Re,this._rotating=Ne,this._pitching=et,this._padding=Qe,this._easeId=r.easeId,this._prepareEase(o,r.noMoveStart,_t),this._ease(tt(u),ut=>{u.recenterOnTerrain(),this._afterEase(o,ut)},r),this}_prepareEase(r,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||u.moving||this.fire(new t.Event("movestart",r)),this._zooming&&!u.zooming&&this.fire(new t.Event("zoomstart",r)),this._rotating&&!u.rotating&&this.fire(new t.Event("rotatestart",r)),this._pitching&&!u.pitching&&this.fire(new t.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new t.Event("move",r)),this._zooming&&this.fire(new t.Event("zoom",r)),this._rotating&&this.fire(new t.Event("rotate",r)),this._pitching&&this.fire(new t.Event("pitch",r))}_afterEase(r,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,b=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new t.Event("zoomend",r)),b&&this.fire(new t.Event("rotateend",r)),S&&this.fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))}flyTo(r,o){if(this._prefersReducedMotion(r)){const qt=t.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qt,o)}this.stop(),r=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},r);const u=this.transform,b=this.getZoom(),S=this.getBearing(),I=this.getPitch(),F=this.getPadding(),N="zoom"in r?t.clamp(+r.zoom,u.minZoom,u.maxZoom):b,H="bearing"in r?this._normalizeBearing(r.bearing,S):S,X="pitch"in r?+r.pitch:I,ee="padding"in r?r.padding:u.padding,me=u.zoomScale(N-b),xe=t.Point.convert(r.offset);let Ee=u.centerPoint.add(xe);const Pe=u.pointLocation(Ee),Le=t.LngLat.convert(r.center||Pe);this._normalizeCenter(Le);const ie=u.project(Pe),Ce=u.project(Le).sub(ie);let Re=r.curve;const Ne=Math.max(u.width,u.height),et=Ne/me,Qe=Ce.mag();if("minZoom"in r){const qt=t.clamp(Math.min(r.minZoom,b,N),u.minZoom,u.maxZoom),ci=Ne/u.zoomScale(qt-b);Re=Math.sqrt(ci/Qe*2)}const tt=Re*Re;function _t(qt){const ci=(et*et-Ne*Ne+(qt?-1:1)*tt*tt*Qe*Qe)/(2*(qt?et:Ne)*tt*Qe);return Math.log(Math.sqrt(ci*ci+1)-ci)}function ut(qt){return(Math.exp(qt)-Math.exp(-qt))/2}function Ct(qt){return(Math.exp(qt)+Math.exp(-qt))/2}const ei=_t(0);let Tt=function(qt){return Ct(ei)/Ct(ei+Re*qt)},Gt=function(qt){return Ne*((Ct(ei)*(ut(ci=ei+Re*qt)/Ct(ci))-ut(ei))/tt)/Qe;var ci},Pt=(_t(1)-ei)/Re;if(Math.abs(Qe)<1e-6||!isFinite(Pt)){if(Math.abs(Ne-et)<1e-6)return this.easeTo(r,o);const qt=et<Ne?-1:1;Pt=Math.abs(Math.log(et/Ne))/Re,Gt=function(){return 0},Tt=function(ci){return Math.exp(qt*Re*ci)}}r.duration="duration"in r?+r.duration:1e3*Pt/("screenSpeed"in r?+r.screenSpeed/Re:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const ii=S!==H,Mt=X!==I,Xt=!u.isPaddingEqual(ee),oi=qt=>ci=>{const Oi=ci*Pt,$i=1/Tt(Oi);qt.zoom=ci===1?N:b+qt.scaleZoom($i),ii&&(qt.bearing=t.number(S,H,ci)),Mt&&(qt.pitch=t.number(I,X,ci)),Xt&&(qt.interpolatePadding(F,ee,ci),Ee=qt.centerPoint.add(xe));const Si=ci===1?Le:qt.unproject(ie.add(Ce.mult(Gt(Oi))).mult($i));return qt.setLocationAtPoint(qt.renderWorldCopies?Si.wrap():Si,Ee),qt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(o),qt};if(r.preloadOnly){const qt=this._emulate(oi,r.duration,u);return this._preloadTiles(qt),this}return this._zooming=!0,this._rotating=ii,this._pitching=Mt,this._padding=Xt,this._prepareEase(o,!1),this._ease(oi(u),()=>this._afterEase(o),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!r){const u=this.handlers;u&&u.stop(!1)}return this}_ease(r,o,u){u.animate===!1||u.duration===0?(r(1),o()):(this._easeStart=t.exported.now(),this._easeOptions=u,this._onEaseFrame=r,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,o){r=t.wrap(r,-180,180);const u=Math.abs(r-o);return Math.abs(r-360-o)<u&&(r-=360),Math.abs(r+360-o)<u&&(r+=360),r}_normalizeCenter(r){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const u=r.lng-o.center.lng;r.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&t.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,o,u){const b=Math.ceil(15*o/1e3),S=[],I=r(u.clone());for(let F=0;F<=b;F++){const N=I(F/b);S.push(N.clone())}return S}}class bi{constructor(r={}){this.options=r,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const o=this.options&&this.options.compact;return this._map=r,this._container=m("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=m("button","mapboxgl-ctrl-attrib-button",this._container),m("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=m("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,o){const u=this._map._getUIString(`AttributionControl.${o}`);r.setAttribute("aria-label",u),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(r){const u=o.reduce((b,S,I)=>(S.value&&(b+=`${S.key}=${S.value}${I<o.length-1?"&":""}`),b),"?");r.href=`${t.config.FEEDBACK_URL}/${u}#${ll(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const o=this._map.style._sourceCaches;for(const b in o){const S=o[b];if(S.used){const I=S.getSource();I.attribution&&r.indexOf(I.attribution)<0&&r.push(I.attribution)}}r.sort((b,S)=>b.length-S.length),r=r.filter((b,S)=>{for(let I=S+1;I<r.length;I++)if(r[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const u=r.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,r.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lc{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=m("div","mapboxgl-ctrl");const o=m("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const o in r){const u=r[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const o=r[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Ic{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const o=++this._id;return this._queue.push({callback:r,id:o,cancelled:!1}),o}remove(r){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const b of u)if(b.id===r)return void(b.cancelled=!0)}run(r=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ba(h,r,o){if(h=new t.LngLat(h.lng,h.lat),r){const u=new t.LngLat(h.lng-360,h.lat),b=new t.LngLat(h.lng+360,h.lat),S=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),I=o.locationPoint(h).distSqr(r),F=r.x<0||r.y<0||r.x>o.width||r.y>o.height;o.locationPoint(u).distSqr(r)<I&&(F||Math.abs(u.lng-o.center.lng)<S)?h=u:o.locationPoint(b).distSqr(r)<I&&(F||Math.abs(b.lng-o.center.lng)<S)&&(h=b)}for(;Math.abs(h.lng-o.center.lng)>180;){const u=o.locationPoint(h);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}const E={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class k extends t.Evented{constructor(r,o){if(super(),(r instanceof t.window.HTMLElement||o)&&(r=t.extend({element:r},o)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=m("div");const b=41,S=27,I=c("svg",{display:"block",height:b*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${b}`},this._element),F=c("radialGradient",{id:"shadowGradient"},c("defs",{},I));c("stop",{offset:"10%","stop-opacity":.4},F),c("stop",{offset:"100%","stop-opacity":.05},F),c("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),c("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),c("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),c("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const u=this._element.classList;for(const b in E)u.remove(`mapboxgl-marker-anchor-${b}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=t.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const o=r.code,u=r.charCode||r.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(r){const o=r.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,o=this._pos;if(!r||!o)return!1;const u=r.unproject(o),b=r.getFreeCameraOptions();if(!b.position)return!1;const S=b.position.toLngLat();return S.distanceTo(u)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const o=this._pos;if(!o||o.x<0||o.x>r.transform.width||o.y<0||o.y>r.transform.height)return void this._clearFadeTimer();const u=r.unproject(o);let b;r._showingGlobe()&&t.isLngLatBehindGlobe(r.transform,this._lngLat)?b=0:(b=1-r._queryFogOpacity(u),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${E[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const r=this._pos,o=this._map,u=this.getPitchAlignment();if(!o||!r||u!=="map")return"";if(!o._showingGlobe()){const N=o.getPitch();return N?`rotateX(${N}deg)`:""}const b=t.radToDeg(t.globeTiltAtLngLat(o.transform,this._lngLat)),S=r.sub(t.globeCenterToScreenPoint(o.transform)),I=Math.abs(S.x)+Math.abs(S.y);if(I===0)return"";const F=b/I;return`rotateX(${-S.y*F}deg) rotateY(${S.x*F}deg)`}_calculateZTransform(){const r=this._pos,o=this._map;if(!o||!r)return"";let u=0;const b=this.getRotationAlignment();if(b==="map")if(o._showingGlobe()){const S=o.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=o.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);u=t.radToDeg(Math.atan2(I.y,I.x))-90}else u=-o.getBearing();else if(b==="horizon"){const S=t.smoothstep(4,6,o.getZoom()),I=t.globeCenterToScreenPoint(o.transform);I.y+=S*o.transform.height;const F=r.sub(I),N=t.radToDeg(Math.atan2(F.y,F.x));u=(N>90?N-270:N+90)*(1-S)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(r){t.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ba(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),r===!0?this._updateFrameId=t.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=t.Point.convert(r),this._update(),this}_onMove(r){const o=this._map;if(!o)return;const u=this._pointerdownPos,b=this._positionDelta;if(u&&b){if(!this._isDragging){const S=this._clickTolerance||o._clickTolerance;if(r.point.dist(u)<S)return;this._isDragging=!0}this._pos=r.point.sub(b),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(r){const o=this._map,u=this._pos;o&&u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(u),this._pointerdownPos=r.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const o=this._map;return o&&(r?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const W={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},J=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function de(h=new t.Point(0,0),r="bottom"){if(typeof h=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new t.Point(0,h);case"top-left":return new t.Point(o,o);case"top-right":return new t.Point(-o,o);case"bottom":return new t.Point(0,-h);case"bottom-left":return new t.Point(o,-o);case"bottom-right":return new t.Point(-o,-o);case"left":return new t.Point(h,0);case"right":return new t.Point(-h,0)}return new t.Point(0,0)}return h instanceof t.Point||Array.isArray(h)?t.Point.convert(h):t.Point.convert(h[r]||[0,0])}class ye{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const o=t.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,o,u){this._start=this.getValue(o),this._end=r,this._startTime=o,this._endTime=o+u}}const be={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Me={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Ie={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ge{constructor(r,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Sc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,u&&(this.mousePitch=new bo({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(r,o){this.mouseRotate.mousedown(r,o),this.mousePitch&&this.mousePitch.mousedown(r,o),C()}move(r,o){const u=this.map,b=this.mouseRotate.mousemoveWindow(r,o),S=b&&b.bearingDelta;if(S&&u.setBearing(u.getBearing()+S),this.mousePitch){const I=this.mousePitch.mousemoveWindow(r,o),F=I&&I.pitchDelta;F&&u.setPitch(u.getPitch()+F)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){L(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(t.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),K(this.element,r)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,K(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=se(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const mt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ft={maxWidth:100,unit:"metric"},zt={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},St={version:t.version,supported:v,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends Wl{constructor(h){if(t.LivePerformanceUtils.mark(t.PerformanceMarkers.create),(h=t.extend({},Me,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(h.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wo(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Ic,this._domRenderTaskQueue=new Ic,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.uniqueId(),this._locale=t.extend({},be,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ye(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new t.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=t.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),t.window!==void 0&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new wo(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Nl(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,t.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new bi({customAttribution:h.customAttribution})),this._logoControl=new Lc,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new t.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new t.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=h.onAdd(this);this._controls.push(h);const u=this._controlPositions[r];return r.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new t.Event("movestart",h)).fire(new t.Event("move",h)),this.fire(new t.Event("resize",h)),r&&this.fire(new t.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(t.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?t.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?t.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,r=h.projection.name;let o;r==="globe"&&h.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),o=!0):r==="mercator"&&h.zoom<t.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r=h.name==="globe"&&this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(t.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(t.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,o){if(h==="mouseenter"||h==="mouseover"){let u=!1;const b=I=>{const F=r.filter(H=>this.getLayer(H)),N=F.length?this.queryRenderedFeatures(I.point,{layers:F}):[];N.length?u||(u=!0,o.call(this,new Fn(h,this,I.originalEvent,{features:N}))):u=!1},S=()=>{u=!1};return{layers:new Set(r),listener:o,delegates:{mousemove:b,mouseout:S}}}if(h==="mouseleave"||h==="mouseout"){let u=!1;const b=I=>{const F=r.filter(N=>this.getLayer(N));(F.length?this.queryRenderedFeatures(I.point,{layers:F}):[]).length?u=!0:u&&(u=!1,o.call(this,new Fn(h,this,I.originalEvent)))},S=I=>{u&&(u=!1,o.call(this,new Fn(h,this,I.originalEvent)))};return{layers:new Set(r),listener:o,delegates:{mousemove:b,mouseout:S}}}{const u=b=>{const S=r.filter(F=>this.getLayer(F)),I=S.length?this.queryRenderedFeatures(b.point,{layers:S}):[];I.length&&(b.features=I,o.call(this,b),delete b.features)};return{layers:new Set(r),listener:o,delegates:{[h]:u}}}}on(h,r,o){if(o===void 0)return super.on(h,r);Array.isArray(r)||(r=[r]);const u=this._createDelegatedListener(h,r,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(u);for(const b in u.delegates)this.on(b,u.delegates[b]);return this}once(h,r,o){if(o===void 0)return super.once(h,r);Array.isArray(r)||(r=[r]);const u=this._createDelegatedListener(h,r,o);for(const b in u.delegates)this.once(b,u.delegates[b]);return this}off(h,r,o){if(o===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const u=(S,I)=>{if(S.size!==I.size)return!1;for(const F of S)if(!I.has(F))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[h]:void 0;return b&&(S=>{for(let I=0;I<S.length;I++){const F=S[I];if(F.listener===o&&u(F.layers,r)){for(const N in F.delegates)this.off(N,F.delegates[N]);return S.splice(I,1),this}}})(b),this}queryRenderedFeatures(h,r){return this.style?(r!==void 0||h===void 0||h instanceof t.Point||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}isPointOnSurface(h){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&t.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.Point.convert(h))}setStyle(h,r){return(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Ts(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if(typeof h=="string"){const o=this._requestManager.normalizeStyleURL(h),u=this._requestManager.transformRequest(o,t.ResourceType.Style);t.getJSON(u,(b,S)=>{b?this.fire(new t.ErrorEvent(b)):S&&this._updateDiff(S,r)})}else typeof h=="object"&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(o){t.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const o=h[r]._tiles;for(const u in o){const b=o[u];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}addSourceType(h,r,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,o)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:o=1,sdf:u=!1,stretchX:b,stretchY:S,content:I}={}){if(this._lazyInitEmptyStyle(),r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap){const{width:F,height:N,data:H}=t.exported.getImageData(r);this.style.addImage(h,{data:new t.RGBAImage({width:F,height:N},H),pixelRatio:o,stretchX:b,stretchY:S,content:I,sdf:u,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:F,height:N}=r,H=r;this.style.addImage(h,{data:new t.RGBAImage({width:F,height:N},new Uint8Array(H.data)),pixelRatio:o,stretchX:b,stretchY:S,content:I,sdf:u,version:0,userImage:H}),H.onAdd&&H.onAdd(this,h)}}updateImage(h,r){const o=this.style.getImage(h);if(!o)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap?t.exported.getImageData(r):r,{width:b,height:S}=u;b!==void 0&&S!==void 0?b===o.data.width&&S===o.data.height?(o.data.replace(u.data,!(r instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&r instanceof t.window.ImageBitmap)),this.style.updateImage(h,o)):this.fire(new t.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${S})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){t.getImage(this._requestManager.transformRequest(h,t.ResourceType.Image),(o,u)=>{r(o,u instanceof t.window.HTMLImageElement?t.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,o){return this.style.setLayerZoomRange(h,r,o),this._update(!0)}setFilter(h,r,o={}){return this.style.setFilter(h,r,o),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,o,u={}){return this.style.setPaintProperty(h,r,o,u),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,o,u={}){return this.style.setLayoutProperty(h,r,o,u),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let o,u,b,S=this._container;for(;S&&(!u||!b);){const I=t.window.getComputedStyle(S).transform;I&&I!=="none"&&(o=I.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(u=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(b=o[3])),S=S.parentElement}this._containerWidth=u?Math.abs(h/u):h,this._containerHeight=b?Math.abs(r/b):r}_detectMissingCSS(){t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=m("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=m("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=m("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=m("div","mapboxgl-control-container",h),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{u[b]=m("div",`mapboxgl-ctrl-${b}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const o=t.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const h=t.extend({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",h),o=r||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);o?(this._useWebGL2&&!r&&t.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),t.storeAuthState(o,!0),this.painter=new Oa(o,this.transform,!!r),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(o)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const o=this.painter.context.extTimerQuery,u=t.exported.now();if(this.listens("gpu-timing-frame")&&(r=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,N=this.transform.pitch,H=t.exported.now(),X=new t.EvaluationParameters(F,{now:H,fadeDuration:b,pitch:N,transition:this.style.getTransition()});this.style.update(X)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const F=t.exported.now()-u;o.endQueryEXT(o.TIME_ELAPSED_EXT,r),setTimeout(()=>{const N=o.getQueryObjectEXT(r,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(r),this.fire(new t.Event("gpu-timing-frame",{cpuTime:F,gpuTime:N})),t.window.performance.mark("frame-gpu",{startTime:u,detail:{gpuTime:N}})},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(F);this.fire(new t.Event("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(F);this.fire(new t.Event("gpu-timing-deferred-render",{gpuTime:N}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(I||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(S=this._updateAverageElevation(u,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,t.LivePerformanceUtils.mark(t.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&t.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const o=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const u=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=h;const I=Math.abs(u-b);if(I>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(b),o(b);this._averageElevation.easeTo(b,h,300)}else if(I>1e-4)return this._averageElevation.jumpTo(b),o(b)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===t.AUTH_ERR_MSG||h.status===401)){const r=this.painter.context.gl;t.storeAuthState(r,!1),this._logoControl instanceof Lc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function b(S){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,S,0);const I=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,I),I}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(b(h),r.canvasCopies.map(b),r.timeStamps)}_canvasPixelComparison(h,r,o){let u=o[1]-o[0];const b=h.length/4;for(let S=0;S<r.length;S++){const I=r[S];let F=0;for(let N=0;N<I.length;N+=4)I[N]===h[N]&&I[N+1]===h[N+1]&&I[N+2]===h[N+2]&&I[N+3]===h[N+3]&&(F+=1);u+=(o[S+2]-o[S+1])*(1-F/b)}return u}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),t.window!==void 0&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1),t.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=t.exported.frame(r=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(r,(o,u)=>o._preloadTiles(h,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){t.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){t.setCacheLimits(h,r)}get version(){return t.version}},NavigationControl:class{constructor(h){this.options=t.extend({},Ie,h),this._container=m("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),m("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),m("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:r}):o.resetNorth({},{originalEvent:r}))}),this._compassIcon=m("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),o=r===h.getMaxZoom(),u=r===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ge(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const o=m("button",h,this._container);return o.type="button",o.addEventListener("click",r),o}_setButtonTitle(h,r){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends t.Evented{constructor(h){super(),this.options=t.extend({geolocation:t.window.navigator.geolocation},mt,h),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=m("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):t.window.navigator.permissions!==void 0?t.window.navigator.permissions.query({name:"geolocation"}).then(o=>r(o.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),o=h.coords;return!!r&&(o.longitude<r.getWest()||o.longitude>r.getEast()||o.latitude<r.getSouth()||o.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new t.LngLat(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,u=this._map.getBearing(),b=t.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(o),b,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new t.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=t.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=m("button","mapboxgl-ctrl-geolocate",this._container),m("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=m("div","mapboxgl-user-location"),this._dotElement.appendChild(m("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(m("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new k({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=m("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new k({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};t.window.DeviceMotionEvent!==void 0&&typeof t.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bi,ScaleControl:class{constructor(h){this.options=t.extend({},Ft,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,o=r._containerHeight/2,u=r._containerWidth/2-h/2,b=r.unproject([u,o]),S=r.unproject([u+h,o]),I=b.distanceTo(S);if(this.options.unit==="imperial"){const F=3.2808*I;F>5280?this._setScale(h,F/5280,"mile"):this._setScale(h,F,"foot")}else this.options.unit==="nautical"?this._setScale(h,I/1852,"nautical-mile"):I>=1e3?this._setScale(h,I/1e3,"kilometer"):this._setScale(h,I,"meter")}_setScale(h,r,o){this._map._requestDomTask(()=>{const u=function(S){const I=Math.pow(10,`${Math.floor(S)}`.length-1);let F=S/I;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(N){const H=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*H)/H}(F),I*F}(r),b=u/r;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(u):`${u}&nbsp;${zt[o]}`,this._container.style.width=h*b+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=m("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof t.window.HTMLElement?this._container=h.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=m("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=m("button","mapboxgl-ctrl-fullscreen",this._controlContainer);m("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(h){super(),this.options=t.extend(Object.create(W),h),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=t.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(t.window.document.createTextNode(h))}setHTML(h){const r=t.window.document.createDocumentFragment(),o=t.window.document.createElement("body");let u;for(o.innerHTML=h;u=o.firstChild,u;)r.appendChild(u);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=m("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const o=this._closeButton=m("button","mapboxgl-popup-close-button",r);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,o=this._container,u=this._pos;if(!r||!o||!u)return"bottom";const b=o.offsetWidth,S=o.offsetHeight,I=u.x<b/2,F=u.x>r.transform.width-b/2;if(u.y+h<S)return I?"top-left":F?"top-right":"top";if(u.y>r.transform.height-S){if(I)return"bottom-left";if(F)return"bottom-right"}return I?"left":F?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,o=this._content;if(!r||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=m("div","mapboxgl-popup",r.getContainer()),this._tip=m("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ba(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const b=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),S=de(this.options.offset),I=this._anchor=this._getAnchor(S.y),F=de(this.options.offset,I),N=b.add(F).round();r._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${E[I]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&r._showingGlobe()){const b=t.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(J);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:k,Style:Ts,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:vc,Evented:t.Evented,config:t.config,prewarm:function(){Bn().acquire(un)},clearPrewarmedResources:function(){const h=Fr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(un),Fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(h){t.config.ACCESS_TOKEN=h},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(h){t.config.API_URL=h},get workerCount(){return Or.workerCount},set workerCount(h){Or.workerCount=h},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){t.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){t.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return St});var V=R;return V})})(b_);var Nh=b_.exports;const S_=mp(Nh);var zh={},gp={},_p={};Object.defineProperty(_p,"__esModule",{value:!0});class g1{constructor(f){this.color="#535353",this.map=f,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var f,A;this.width=(f=this.map)===null||f===void 0?void 0:f.getCanvas().clientWidth,this.height=(A=this.map)===null||A===void 0?void 0:A.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const f=this.width/2,A=this.height/2;this.yLine.setAttribute("x1",`${f}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${f}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${A}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${A}px`)}else console.error("element value is null")}createCanvas(f){if(this.width!==void 0&&this.height!==void 0){const A=document.createElementNS("http://www.w3.org/2000/svg","svg");A.style.position="relative",A.setAttribute("width",`${this.width}px`),A.setAttribute("height",`${this.height}px`);const D=this.width/2,R=this.height/2;this.yLine=A.appendChild(this.createLine(D,0,D,this.height,this.color,"2px")),this.xLine=A.appendChild(this.createLine(0,R,this.width,R,this.color,"2px")),f==null||f.appendChild(A),this.svgCanvas=A}}createLine(f,A,D,R,z,V){const t=document.createElementNS("http://www.w3.org/2000/svg","line");return t.setAttribute("x1",f),t.setAttribute("y1",A),t.setAttribute("x2",D),t.setAttribute("y2",R),t.setAttribute("stroke-dasharray","5,5"),t.setAttribute("stroke",z),t.setAttribute("stroke-width",V),t}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}_p.default=g1;var yp={},Lf={};const _1="modulepreload",y1=function(M,f){return new URL(M,f).href},Jg={},ep=function(f,A,D){if(!A||A.length===0)return f();const R=document.getElementsByTagName("link");return Promise.all(A.map(z=>{if(z=y1(z,D),z in Jg)return;Jg[z]=!0;const V=z.endsWith(".css"),t=V?'[rel="stylesheet"]':"";if(!!D)for(let x=R.length-1;x>=0;x--){const d=R[x];if(d.href===z&&(!V||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${z}"]${t}`))return;const v=document.createElement("link");if(v.rel=V?"stylesheet":_1,V||(v.as="script",v.crossOrigin=""),v.href=z,document.head.appendChild(v),V)return new Promise((x,d)=>{v.addEventListener("load",x),v.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${z}`)))})})).then(()=>f())};function rn(M){"@babel/helpers - typeof";return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},rn(M)}var ho=Uint8Array,uo=Uint16Array,zu=Uint32Array,If=new ho([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kf=new ho([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tp=new ho([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T_=function(M,f){for(var A=new uo(31),D=0;D<31;++D)A[D]=f+=1<<M[D-1];for(var R=new zu(A[30]),D=1;D<30;++D)for(var z=A[D];z<A[D+1];++z)R[z]=z-A[D]<<5|D;return[A,R]},C_=T_(If,2),A_=C_[0],ip=C_[1];A_[28]=258,ip[258]=28;var E_=T_(kf,0),v1=E_[0],Qg=E_[1],rp=new uo(32768);for(var yn=0;yn<32768;++yn){var uc=(yn&43690)>>>1|(yn&21845)<<1;uc=(uc&52428)>>>2|(uc&13107)<<2,uc=(uc&61680)>>>4|(uc&3855)<<4,rp[yn]=((uc&65280)>>>8|(uc&255)<<8)>>>1}var Ml=function(M,f,A){for(var D=M.length,R=0,z=new uo(f);R<D;++R)++z[M[R]-1];var V=new uo(f);for(R=0;R<f;++R)V[R]=V[R-1]+z[R-1]<<1;var t;if(A){t=new uo(1<<f);var l=15-f;for(R=0;R<D;++R)if(M[R])for(var v=R<<4|M[R],x=f-M[R],d=V[M[R]-1]++<<x,m=d|(1<<x)-1;d<=m;++d)t[rp[d]>>>l]=v}else for(t=new uo(D),R=0;R<D;++R)t[R]=rp[V[M[R]-1]++]>>>15-M[R];return t},gc=new ho(288);for(var yn=0;yn<144;++yn)gc[yn]=8;for(var yn=144;yn<256;++yn)gc[yn]=9;for(var yn=256;yn<280;++yn)gc[yn]=7;for(var yn=280;yn<288;++yn)gc[yn]=8;var Ru=new ho(32);for(var yn=0;yn<32;++yn)Ru[yn]=5;var x1=Ml(gc,9,0),b1=Ml(gc,9,1),w1=Ml(Ru,5,0),S1=Ml(Ru,5,1),qd=function(M){for(var f=M[0],A=1;A<M.length;++A)M[A]>f&&(f=M[A]);return f},Ha=function(M,f,A){var D=f/8>>0;return(M[D]|M[D+1]<<8)>>>(f&7)&A},Gd=function(M,f){var A=f/8>>0;return(M[A]|M[A+1]<<8|M[A+2]<<16)>>>(f&7)},vp=function(M){return(M/8>>0)+(M&7&&1)},P_=function(M,f,A){(f==null||f<0)&&(f=0),(A==null||A>M.length)&&(A=M.length);var D=new(M instanceof uo?uo:M instanceof zu?zu:ho)(A-f);return D.set(M.subarray(f,A)),D},T1=function(M,f,A){var D=M.length,R=!f||A,z=!A||A.i;A||(A={}),f||(f=new ho(D*3));var V=function(we){var ke=f.length;if(we>ke){var We=new ho(Math.max(ke*2,we));We.set(f),f=We}},t=A.f||0,l=A.p||0,v=A.b||0,x=A.l,d=A.d,m=A.m,c=A.n,_=D*8;do{if(!x){A.f=t=Ha(M,l,1);var w=Ha(M,l+1,3);if(l+=3,w)if(w==1)x=b1,d=S1,m=9,c=5;else if(w==2){var B=Ha(M,l,31)+257,q=Ha(M,l+10,15)+4,K=B+Ha(M,l+5,31)+1;l+=14;for(var se=new ho(K),he=new ho(19),le=0;le<q;++le)he[tp[le]]=Ha(M,l+le*3,7);l+=q*3;var ve=qd(he),ot=(1<<ve)-1;if(!z&&l+K*(ve+7)>_)break;for(var _e=Ml(he,ve,1),le=0;le<K;){var pe=_e[Ha(M,l,ot)];l+=pe&15;var g=pe>>>4;if(g<16)se[le++]=g;else{var ze=0,De=0;for(g==16?(De=3+Ha(M,l,3),l+=2,ze=se[le-1]):g==17?(De=3+Ha(M,l,7),l+=3):g==18&&(De=11+Ha(M,l,127),l+=7);De--;)se[le++]=ze}}var at=se.subarray(0,B),ft=se.subarray(B);m=qd(at),c=qd(ft),x=Ml(at,m,1),d=Ml(ft,c,1)}else throw"invalid block type";else{var g=vp(l)+4,C=M[g-4]|M[g-3]<<8,L=g+C;if(L>D){if(z)throw"unexpected EOF";break}R&&V(v+C),f.set(M.subarray(g,L),v),A.b=v+=C,A.p=l=L*8;continue}if(l>_)throw"unexpected EOF"}R&&V(v+131072);for(var xt=(1<<m)-1,He=(1<<c)-1,ae=m+c+18;z||l+ae<_;){var ze=x[Gd(M,l)&xt],Te=ze>>>4;if(l+=ze&15,l>_)throw"unexpected EOF";if(!ze)throw"invalid length/literal";if(Te<256)f[v++]=Te;else if(Te==256){x=null;break}else{var Oe=Te-254;if(Te>264){var le=Te-257,Y=If[le];Oe=Ha(M,l,(1<<Y)-1)+A_[le],l+=Y}var ce=d[Gd(M,l)&He],re=ce>>>4;if(!ce)throw"invalid distance";l+=ce&15;var ft=v1[re];if(re>3){var Y=kf[re];ft+=Gd(M,l)&(1<<Y)-1,l+=Y}if(l>_)throw"unexpected EOF";R&&V(v+131072);for(var te=v+Oe;v<te;v+=4)f[v]=f[v-ft],f[v+1]=f[v+1-ft],f[v+2]=f[v+2-ft],f[v+3]=f[v+3-ft];v=te}}A.l=x,A.p=l,A.b=v,x&&(t=1,A.m=m,A.d=d,A.n=c)}while(!t);return v==f.length?f:P_(f,0,v)},Jl=function(M,f,A){A<<=f&7;var D=f/8>>0;M[D]|=A,M[D+1]|=A>>>8},Mu=function(M,f,A){A<<=f&7;var D=f/8>>0;M[D]|=A,M[D+1]|=A>>>8,M[D+2]|=A>>>16},Wd=function(M,f){for(var A=[],D=0;D<M.length;++D)M[D]&&A.push({s:D,f:M[D]});var R=A.length,z=A.slice();if(!R)return[new ho(0),0];if(R==1){var V=new ho(A[0].s+1);return V[A[0].s]=1,[V,1]}A.sort(function(K,se){return K.f-se.f}),A.push({s:-1,f:25001});var t=A[0],l=A[1],v=0,x=1,d=2;for(A[0]={s:-1,f:t.f+l.f,l:t,r:l};x!=R-1;)t=A[A[v].f<A[d].f?v++:d++],l=A[v!=x&&A[v].f<A[d].f?v++:d++],A[x++]={s:-1,f:t.f+l.f,l:t,r:l};for(var m=z[0].s,D=1;D<R;++D)z[D].s>m&&(m=z[D].s);var c=new uo(m+1),_=np(A[x-1],c,0);if(_>f){var D=0,w=0,g=_-f,C=1<<g;for(z.sort(function(se,he){return c[he.s]-c[se.s]||se.f-he.f});D<R;++D){var L=z[D].s;if(c[L]>f)w+=C-(1<<_-c[L]),c[L]=f;else break}for(w>>>=g;w>0;){var B=z[D].s;c[B]<f?w-=1<<f-c[B]++-1:++D}for(;D>=0&&w;--D){var q=z[D].s;c[q]==f&&(--c[q],++w)}_=f}return[new ho(c),_]},np=function(M,f,A){return M.s==-1?Math.max(np(M.l,f,A+1),np(M.r,f,A+1)):f[M.s]=A},e_=function(M){for(var f=M.length;f&&!M[--f];);for(var A=new uo(++f),D=0,R=M[0],z=1,V=function(l){A[D++]=l},t=1;t<=f;++t)if(M[t]==R&&t!=f)++z;else{if(!R&&z>2){for(;z>138;z-=138)V(32754);z>2&&(V(z>10?z-11<<5|28690:z-3<<5|12305),z=0)}else if(z>3){for(V(R),--z;z>6;z-=6)V(8304);z>2&&(V(z-3<<5|8208),z=0)}for(;z--;)V(R);z=1,R=M[t]}return[A.subarray(0,D),f]},Lu=function(M,f){for(var A=0,D=0;D<f.length;++D)A+=M[D]*f[D];return A},Ef=function(M,f,A){var D=A.length,R=vp(f+2);M[R]=D&255,M[R+1]=D>>>8,M[R+2]=M[R]^255,M[R+3]=M[R+1]^255;for(var z=0;z<D;++z)M[R+z+4]=A[z];return(R+4+D)*8},t_=function(M,f,A,D,R,z,V,t,l,v,x){Jl(f,x++,A),++R[256];for(var d=Wd(R,15),m=d[0],c=d[1],_=Wd(z,15),w=_[0],g=_[1],C=e_(m),L=C[0],B=C[1],q=e_(w),K=q[0],se=q[1],he=new uo(19),le=0;le<L.length;++le)he[L[le]&31]++;for(var le=0;le<K.length;++le)he[K[le]&31]++;for(var ve=Wd(he,7),ot=ve[0],_e=ve[1],pe=19;pe>4&&!ot[tp[pe-1]];--pe);var ze=v+5<<3,De=Lu(R,gc)+Lu(z,Ru)+V,at=Lu(R,m)+Lu(z,w)+V+14+3*pe+Lu(he,ot)+(2*he[16]+3*he[17]+7*he[18]);if(ze<=De&&ze<=at)return Ef(f,x,M.subarray(l,l+v));var ft,xt,He,ae;if(Jl(f,x,1+(at<De)),x+=2,at<De){ft=Ml(m,c,0),xt=m,He=Ml(w,g,0),ae=w;var Te=Ml(ot,_e,0);Jl(f,x,B-257),Jl(f,x+5,se-1),Jl(f,x+10,pe-4),x+=14;for(var le=0;le<pe;++le)Jl(f,x+3*le,ot[tp[le]]);x+=3*pe;for(var Oe=[L,K],Y=0;Y<2;++Y)for(var ce=Oe[Y],le=0;le<ce.length;++le){var re=ce[le]&31;Jl(f,x,Te[re]),x+=ot[re],re>15&&(Jl(f,x,ce[le]>>>5&127),x+=ce[le]>>>12)}}else ft=x1,xt=gc,He=w1,ae=Ru;for(var le=0;le<t;++le)if(D[le]>255){var re=D[le]>>>18&31;Mu(f,x,ft[re+257]),x+=xt[re+257],re>7&&(Jl(f,x,D[le]>>>23&31),x+=If[re]);var te=D[le]&31;Mu(f,x,He[te]),x+=ae[te],te>3&&(Mu(f,x,D[le]>>>5&8191),x+=kf[te])}else Mu(f,x,ft[D[le]]),x+=xt[D[le]];return Mu(f,x,ft[256]),x+xt[256]},C1=new zu([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),A1=new ho(0),E1=function(M,f,A,D,R,z){var V=M.length,t=new ho(D+V+5*(1+Math.floor(V/7e3))+R),l=t.subarray(D,t.length-R),v=0;if(!f||V<8)for(var x=0;x<=V;x+=65535){var d=x+65535;d<V?v=Ef(l,v,M.subarray(x,d)):(l[x]=z,v=Ef(l,v,M.subarray(x,V)))}else{for(var m=C1[f-1],c=m>>>13,_=m&8191,w=(1<<A)-1,g=new uo(32768),C=new uo(w+1),L=Math.ceil(A/3),B=2*L,q=function(ct){return(M[ct]^M[ct+1]<<L^M[ct+2]<<B)&w},K=new zu(25e3),se=new uo(288),he=new uo(32),le=0,ve=0,x=0,ot=0,_e=0,pe=0;x<V;++x){var ze=q(x),De=x&32767,at=C[ze];if(g[De]=at,C[ze]=De,_e<=x){var ft=V-x;if((le>7e3||ot>24576)&&ft>423){v=t_(M,l,0,K,se,he,ve,ot,pe,x-pe,v),ot=le=ve=0,pe=x;for(var xt=0;xt<286;++xt)se[xt]=0;for(var xt=0;xt<30;++xt)he[xt]=0}var He=2,ae=0,Te=_,Oe=De-at&32767;if(ft>2&&ze==q(x-Oe))for(var Y=Math.min(c,ft)-1,ce=Math.min(32767,x),re=Math.min(258,ft);Oe<=ce&&--Te&&De!=at;){if(M[x+He]==M[x+He-Oe]){for(var te=0;te<re&&M[x+te]==M[x+te-Oe];++te);if(te>He){if(He=te,ae=Oe,te>Y)break;for(var we=Math.min(Oe,te-2),ke=0,xt=0;xt<we;++xt){var We=x-Oe+xt+32768&32767,qe=g[We],gt=We-qe+32768&32767;gt>ke&&(ke=gt,at=We)}}}De=at,at=g[De],Oe+=De-at+32768&32767}if(ae){K[ot++]=268435456|ip[He]<<18|Qg[ae];var lt=ip[He]&31,Bt=Qg[ae]&31;ve+=If[lt]+kf[Bt],++se[257+lt],++he[Bt],_e=x+He,++le}else K[ot++]=M[x],++se[M[x]]}}v=t_(M,l,z,K,se,he,ve,ot,pe,x-pe,v),z||(v=Ef(l,v,A1))}return P_(t,0,D+vp(v)+R)},P1=function(){var M=1,f=0;return{p:function(A){for(var D=M,R=f,z=A.length,V=0;V!=z;){for(var t=Math.min(V+5552,z);V<t;++V)D+=A[V],R+=D;D%=65521,R%=65521}M=D,f=R},d:function(){return(M>>>8<<16|(f&255)<<8|f>>>8)+((M&255)<<23)*2}}},M1=function(M,f,A,D,R){return E1(M,f.level==null?6:f.level,f.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(M.length)))*1.5):12+f.mem,A,D,!R)},L1=function(M,f,A){for(;A;++f)M[f]=A,A>>>=8},I1=function(M,f){var A=f.level,D=A==0?0:A<6?1:A==9?3:2;M[0]=120,M[1]=D<<6|(D?32-2*D:1)},k1=function(M){if((M[0]&15)!=8||M[0]>>>4>7||(M[0]<<8|M[1])%31)throw"invalid zlib data";if(M[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sp(M,f){f===void 0&&(f={});var A=P1();A.p(M);var D=M1(M,f,2,4);return I1(D,f),L1(D,D.length-4,A.d()),D}function D1(M,f){return T1((k1(M),M.subarray(2,-4)),f)}var cr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Xd(){cr.console&&typeof cr.console.log=="function"&&cr.console.log.apply(cr.console,arguments)}var hn={log:Xd,warn:function(M){cr.console&&(typeof cr.console.warn=="function"?cr.console.warn.apply(cr.console,arguments):Xd.call(null,arguments))},error:function(M){cr.console&&(typeof cr.console.error=="function"?cr.console.error.apply(cr.console,arguments):Xd(M))}};function Hd(M,f,A){var D=new XMLHttpRequest;D.open("GET",M),D.responseType="blob",D.onload=function(){Kc(D.response,f,A)},D.onerror=function(){hn.error("could not download file")},D.send()}function i_(M){var f=new XMLHttpRequest;f.open("HEAD",M,!1);try{f.send()}catch{}return f.status>=200&&f.status<=299}function Sf(M){try{M.dispatchEvent(new MouseEvent("click"))}catch{var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),M.dispatchEvent(f)}}var Iu,op,Kc=cr.saveAs||((typeof window>"u"?"undefined":rn(window))!=="object"||window!==cr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(M,f,A){var D=cr.URL||cr.webkitURL,R=document.createElement("a");f=f||M.name||"download",R.download=f,R.rel="noopener",typeof M=="string"?(R.href=M,R.origin!==location.origin?i_(R.href)?Hd(M,f,A):Sf(R,R.target="_blank"):Sf(R)):(R.href=D.createObjectURL(M),setTimeout(function(){D.revokeObjectURL(R.href)},4e4),setTimeout(function(){Sf(R)},0))}:"msSaveOrOpenBlob"in navigator?function(M,f,A){if(f=f||M.name||"download",typeof M=="string")if(i_(M))Hd(M,f,A);else{var D=document.createElement("a");D.href=M,D.target="_blank",setTimeout(function(){Sf(D)})}else navigator.msSaveOrOpenBlob(function(R,z){return z===void 0?z={autoBom:!1}:rn(z)!=="object"&&(hn.warn("Deprecated: Expected third argument to be a object"),z={autoBom:!z}),z.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(R.type)?new Blob([String.fromCharCode(65279),R],{type:R.type}):R}(M,A),f)}:function(M,f,A,D){if((D=D||open("","_blank"))&&(D.document.title=D.document.body.innerText="downloading..."),typeof M=="string")return Hd(M,f,A);var R=M.type==="application/octet-stream",z=/constructor/i.test(cr.HTMLElement)||cr.safari,V=/CriOS\/[\d]+/.test(navigator.userAgent);if((V||R&&z)&&(typeof FileReader>"u"?"undefined":rn(FileReader))==="object"){var t=new FileReader;t.onloadend=function(){var x=t.result;x=V?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),D?D.location.href=x:location=x,D=null},t.readAsDataURL(M)}else{var l=cr.URL||cr.webkitURL,v=l.createObjectURL(M);D?D.location=v:location.href=v,D=null,setTimeout(function(){l.revokeObjectURL(v)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function M_(M){var f;M=M||"",this.ok=!1,M.charAt(0)=="#"&&(M=M.substr(1,6)),M={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[M=(M=M.replace(/ /g,"")).toLowerCase()]||M;for(var A=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],D=0;D<A.length;D++){var R=A[D].re,z=A[D].process,V=R.exec(M);V&&(f=z(V),this.r=f[0],this.g=f[1],this.b=f[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),l=this.g.toString(16),v=this.b.toString(16);return t.length==1&&(t="0"+t),l.length==1&&(l="0"+l),v.length==1&&(v="0"+v),"#"+t+l+v}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function $d(M,f){var A=M[0],D=M[1],R=M[2],z=M[3];A=qs(A,D,R,z,f[0],7,-680876936),z=qs(z,A,D,R,f[1],12,-389564586),R=qs(R,z,A,D,f[2],17,606105819),D=qs(D,R,z,A,f[3],22,-1044525330),A=qs(A,D,R,z,f[4],7,-176418897),z=qs(z,A,D,R,f[5],12,1200080426),R=qs(R,z,A,D,f[6],17,-1473231341),D=qs(D,R,z,A,f[7],22,-45705983),A=qs(A,D,R,z,f[8],7,1770035416),z=qs(z,A,D,R,f[9],12,-1958414417),R=qs(R,z,A,D,f[10],17,-42063),D=qs(D,R,z,A,f[11],22,-1990404162),A=qs(A,D,R,z,f[12],7,1804603682),z=qs(z,A,D,R,f[13],12,-40341101),R=qs(R,z,A,D,f[14],17,-1502002290),A=Gs(A,D=qs(D,R,z,A,f[15],22,1236535329),R,z,f[1],5,-165796510),z=Gs(z,A,D,R,f[6],9,-1069501632),R=Gs(R,z,A,D,f[11],14,643717713),D=Gs(D,R,z,A,f[0],20,-373897302),A=Gs(A,D,R,z,f[5],5,-701558691),z=Gs(z,A,D,R,f[10],9,38016083),R=Gs(R,z,A,D,f[15],14,-660478335),D=Gs(D,R,z,A,f[4],20,-405537848),A=Gs(A,D,R,z,f[9],5,568446438),z=Gs(z,A,D,R,f[14],9,-1019803690),R=Gs(R,z,A,D,f[3],14,-187363961),D=Gs(D,R,z,A,f[8],20,1163531501),A=Gs(A,D,R,z,f[13],5,-1444681467),z=Gs(z,A,D,R,f[2],9,-51403784),R=Gs(R,z,A,D,f[7],14,1735328473),A=Ws(A,D=Gs(D,R,z,A,f[12],20,-1926607734),R,z,f[5],4,-378558),z=Ws(z,A,D,R,f[8],11,-2022574463),R=Ws(R,z,A,D,f[11],16,1839030562),D=Ws(D,R,z,A,f[14],23,-35309556),A=Ws(A,D,R,z,f[1],4,-1530992060),z=Ws(z,A,D,R,f[4],11,1272893353),R=Ws(R,z,A,D,f[7],16,-155497632),D=Ws(D,R,z,A,f[10],23,-1094730640),A=Ws(A,D,R,z,f[13],4,681279174),z=Ws(z,A,D,R,f[0],11,-358537222),R=Ws(R,z,A,D,f[3],16,-722521979),D=Ws(D,R,z,A,f[6],23,76029189),A=Ws(A,D,R,z,f[9],4,-640364487),z=Ws(z,A,D,R,f[12],11,-421815835),R=Ws(R,z,A,D,f[15],16,530742520),A=Xs(A,D=Ws(D,R,z,A,f[2],23,-995338651),R,z,f[0],6,-198630844),z=Xs(z,A,D,R,f[7],10,1126891415),R=Xs(R,z,A,D,f[14],15,-1416354905),D=Xs(D,R,z,A,f[5],21,-57434055),A=Xs(A,D,R,z,f[12],6,1700485571),z=Xs(z,A,D,R,f[3],10,-1894986606),R=Xs(R,z,A,D,f[10],15,-1051523),D=Xs(D,R,z,A,f[1],21,-2054922799),A=Xs(A,D,R,z,f[8],6,1873313359),z=Xs(z,A,D,R,f[15],10,-30611744),R=Xs(R,z,A,D,f[6],15,-1560198380),D=Xs(D,R,z,A,f[13],21,1309151649),A=Xs(A,D,R,z,f[4],6,-145523070),z=Xs(z,A,D,R,f[11],10,-1120210379),R=Xs(R,z,A,D,f[2],15,718787259),D=Xs(D,R,z,A,f[9],21,-343485551),M[0]=pc(A,M[0]),M[1]=pc(D,M[1]),M[2]=pc(R,M[2]),M[3]=pc(z,M[3])}function Df(M,f,A,D,R,z){return f=pc(pc(f,M),pc(D,z)),pc(f<<R|f>>>32-R,A)}function qs(M,f,A,D,R,z,V){return Df(f&A|~f&D,M,f,R,z,V)}function Gs(M,f,A,D,R,z,V){return Df(f&D|A&~D,M,f,R,z,V)}function Ws(M,f,A,D,R,z,V){return Df(f^A^D,M,f,R,z,V)}function Xs(M,f,A,D,R,z,V){return Df(A^(f|~D),M,f,R,z,V)}function L_(M){var f,A=M.length,D=[1732584193,-271733879,-1732584194,271733878];for(f=64;f<=M.length;f+=64)$d(D,O1(M.substring(f-64,f)));M=M.substring(f-64);var R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(f=0;f<M.length;f++)R[f>>2]|=M.charCodeAt(f)<<(f%4<<3);if(R[f>>2]|=128<<(f%4<<3),f>55)for($d(D,R),f=0;f<16;f++)R[f]=0;return R[14]=8*A,$d(D,R),D}function O1(M){var f,A=[];for(f=0;f<64;f+=4)A[f>>2]=M.charCodeAt(f)+(M.charCodeAt(f+1)<<8)+(M.charCodeAt(f+2)<<16)+(M.charCodeAt(f+3)<<24);return A}Iu=cr.atob.bind(cr),op=cr.btoa.bind(cr);var r_="0123456789abcdef".split("");function F1(M){for(var f="",A=0;A<4;A++)f+=r_[M>>8*A+4&15]+r_[M>>8*A&15];return f}function z1(M){return String.fromCharCode((255&M)>>0,(65280&M)>>8,(16711680&M)>>16,(4278190080&M)>>24)}function ap(M){return L_(M).map(z1).join("")}var R1=function(M){for(var f=0;f<M.length;f++)M[f]=F1(M[f]);return M.join("")}(L_("hello"))!="5d41402abc4b2a76b9719d911017c592";function pc(M,f){if(R1){var A=(65535&M)+(65535&f);return(M>>16)+(f>>16)+(A>>16)<<16|65535&A}return M+f&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function lp(M,f){var A,D,R,z;if(M!==A){for(var V=(R=M,z=1+(256/M.length>>0),new Array(z+1).join(R)),t=[],l=0;l<256;l++)t[l]=l;var v=0;for(l=0;l<256;l++){var x=t[l];v=(v+x+V.charCodeAt(l))%256,t[l]=t[v],t[v]=x}A=M,D=t}else t=D;var d=f.length,m=0,c=0,_="";for(l=0;l<d;l++)c=(c+(x=t[m=(m+1)%256]))%256,t[m]=t[c],t[c]=x,V=t[(t[m]+t[c])%256],_+=String.fromCharCode(f.charCodeAt(l)^V);return _}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var n_={print:4,modify:8,copy:16,"annot-forms":32};function Rh(M,f,A,D){this.v=1,this.r=2;var R=192;M.forEach(function(t){if(n_.perm!==void 0)throw new Error("Invalid permission: "+t);R+=n_[t]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var z=(f+this.padding).substr(0,32),V=(A+this.padding).substr(0,32);this.O=this.processOwnerPassword(z,V),this.P=-(1+(255^R)),this.encryptionKey=ap(z+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(D)).substr(0,5),this.U=lp(this.encryptionKey,this.padding)}function Bh(M){if(/[^\u0000-\u00ff]/.test(M))throw new Error("Invalid PDF Name Object: "+M+", Only accept ASCII characters.");for(var f="",A=M.length,D=0;D<A;D++){var R=M.charCodeAt(D);R<33||R===35||R===37||R===40||R===41||R===47||R===60||R===62||R===91||R===93||R===123||R===125||R>126?f+="#"+("0"+R.toString(16)).slice(-2):f+=M[D]}return f}function s_(M){if(rn(M)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var f={};this.subscribe=function(A,D,R){if(R=R||!1,typeof A!="string"||typeof D!="function"||typeof R!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");f.hasOwnProperty(A)||(f[A]={});var z=Math.random().toString(35);return f[A][z]=[D,!!R],z},this.unsubscribe=function(A){for(var D in f)if(f[D][A])return delete f[D][A],Object.keys(f[D]).length===0&&delete f[D],!0;return!1},this.publish=function(A){if(f.hasOwnProperty(A)){var D=Array.prototype.slice.call(arguments,1),R=[];for(var z in f[A]){var V=f[A][z];try{V[0].apply(M,D)}catch(t){cr.console&&hn.error("jsPDF PubSub Error",t.message,t)}V[1]&&R.push(z)}R.length&&R.forEach(this.unsubscribe)}},this.getTopics=function(){return f}}function Bu(M){if(!(this instanceof Bu))return new Bu(M);var f="opacity,stroke-opacity".split(",");for(var A in M)M.hasOwnProperty(A)&&f.indexOf(A)>=0&&(this[A]=M[A]);this.id="",this.objectNumber=-1}function I_(M,f){this.gState=M,this.matrix=f,this.id="",this.objectNumber=-1}function dc(M,f,A,D,R){if(!(this instanceof dc))return new dc(M,f,A,D,R);this.type=M==="axial"?2:3,this.coords=f,this.colors=A,I_.call(this,D,R)}function Qc(M,f,A,D,R){if(!(this instanceof Qc))return new Qc(M,f,A,D,R);this.boundingBox=M,this.xStep=f,this.yStep=A,this.stream="",this.cloneIndex=0,I_.call(this,D,R)}function tr(M){var f,A=typeof arguments[0]=="string"?arguments[0]:"p",D=arguments[1],R=arguments[2],z=arguments[3],V=[],t=1,l=16,v="S",x=null;rn(M=M||{})==="object"&&(A=M.orientation,D=M.unit||D,R=M.format||R,z=M.compress||M.compressPdf||z,(x=M.encryption||null)!==null&&(x.userPassword=x.userPassword||"",x.ownerPassword=x.ownerPassword||"",x.userPermissions=x.userPermissions||[]),t=typeof M.userUnit=="number"?Math.abs(M.userUnit):1,M.precision!==void 0&&(f=M.precision),M.floatPrecision!==void 0&&(l=M.floatPrecision),v=M.defaultPathOperation||"S"),V=M.filters||(z===!0?["FlateEncode"]:V),D=D||"mm",A=(""+(A||"P")).toLowerCase();var d=M.putOnlyUsedFonts||!1,m={},c={internal:{},__private__:{}};c.__private__.PubSub=s_;var _="1.3",w=c.__private__.getPdfVersion=function(){return _};c.__private__.setPdfVersion=function(U){_=U};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};c.__private__.getPageFormats=function(){return g};var C=c.__private__.getPageFormat=function(U){return g[U]};R=R||"a4";var L={COMPAT:"compat",ADVANCED:"advanced"},B=L.COMPAT;function q(){this.saveGraphicsState(),Se(new Vt(jt,0,0,-jt,0,eo()*jt).toString()+" cm"),this.setFontSize(this.getFontSize()/jt),v="n",B=L.ADVANCED}function K(){this.restoreGraphicsState(),v="S",B=L.COMPAT}var se=c.__private__.combineFontStyleAndFontWeight=function(U,ue){if(U=="bold"&&ue=="normal"||U=="bold"&&ue==400||U=="normal"&&ue=="italic"||U=="bold"&&ue=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ue&&(U=ue==400||ue==="normal"?U==="italic"?"italic":"normal":ue!=700&&ue!=="bold"||U!=="normal"?(ue==700?"bold":ue)+""+U:"bold"),U};c.advancedAPI=function(U){var ue=B===L.COMPAT;return ue&&q.call(this),typeof U!="function"||(U(this),ue&&K.call(this)),this},c.compatAPI=function(U){var ue=B===L.ADVANCED;return ue&&K.call(this),typeof U!="function"||(U(this),ue&&q.call(this)),this},c.isAdvancedAPI=function(){return B===L.ADVANCED};var he,le=function(U){if(B!==L.ADVANCED)throw new Error(U+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ve=c.roundToPrecision=c.__private__.roundToPrecision=function(U,ue){var Ye=f||ue;if(isNaN(U)||isNaN(Ye))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return U.toFixed(Ye).replace(/0+$/,"")};he=c.hpf=c.__private__.hpf=typeof l=="number"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return ve(U,l)}:l==="smart"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return ve(U,U>-1&&U<1?16:5)}:function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return ve(U,16)};var ot=c.f2=c.__private__.f2=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f2");return ve(U,2)},_e=c.__private__.f3=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f3");return ve(U,3)},pe=c.scale=c.__private__.scale=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.scale");return B===L.COMPAT?U*jt:B===L.ADVANCED?U:void 0},ze=function(U){return B===L.COMPAT?eo()-U:B===L.ADVANCED?U:void 0},De=function(U){return pe(ze(U))};c.__private__.setPrecision=c.setPrecision=function(U){typeof parseInt(U,10)=="number"&&(f=parseInt(U,10))};var at,ft="00000000000000000000000000000000",xt=c.__private__.getFileId=function(){return ft},He=c.__private__.setFileId=function(U){return ft=U!==void 0&&/^[a-fA-F0-9]{32}$/.test(U)?U.toUpperCase():ft.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),x!==null&&(Lt=new Rh(x.userPermissions,x.userPassword,x.ownerPassword,ft)),ft};c.setFileId=function(U){return He(U),this},c.getFileId=function(){return xt()};var ae=c.__private__.convertDateToPDFDate=function(U){var ue=U.getTimezoneOffset(),Ye=ue<0?"+":"-",pt=Math.floor(Math.abs(ue/60)),It=Math.abs(ue%60),Zt=[Ye,re(pt),"'",re(It),"'"].join("");return["D:",U.getFullYear(),re(U.getMonth()+1),re(U.getDate()),re(U.getHours()),re(U.getMinutes()),re(U.getSeconds()),Zt].join("")},Te=c.__private__.convertPDFDateToDate=function(U){var ue=parseInt(U.substr(2,4),10),Ye=parseInt(U.substr(6,2),10)-1,pt=parseInt(U.substr(8,2),10),It=parseInt(U.substr(10,2),10),Zt=parseInt(U.substr(12,2),10),pi=parseInt(U.substr(14,2),10);return new Date(ue,Ye,pt,It,Zt,pi,0)},Oe=c.__private__.setCreationDate=function(U){var ue;if(U===void 0&&(U=new Date),U instanceof Date)ue=ae(U);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(U))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ue=U}return at=ue},Y=c.__private__.getCreationDate=function(U){var ue=at;return U==="jsDate"&&(ue=Te(at)),ue};c.setCreationDate=function(U){return Oe(U),this},c.getCreationDate=function(U){return Y(U)};var ce,re=c.__private__.padd2=function(U){return("0"+parseInt(U)).slice(-2)},te=c.__private__.padd2Hex=function(U){return("00"+(U=U.toString())).substr(U.length)},we=0,ke=[],We=[],qe=0,gt=[],lt=[],Bt=!1,ht=We,ct=function(){we=0,qe=0,We=[],ke=[],gt=[],Pr=Fi(),kr=Fi()};c.__private__.setCustomOutputDestination=function(U){Bt=!0,ht=U};var Xe=function(U){Bt||(ht=U)};c.__private__.resetCustomOutputDestination=function(){Bt=!1,ht=We};var Se=c.__private__.out=function(U){return U=U.toString(),qe+=U.length+1,ht.push(U),ht},At=c.__private__.write=function(U){return Se(arguments.length===1?U.toString():Array.prototype.join.call(arguments," "))},Et=c.__private__.getArrayBuffer=function(U){for(var ue=U.length,Ye=new ArrayBuffer(ue),pt=new Uint8Array(Ye);ue--;)pt[ue]=U.charCodeAt(ue);return Ye},wt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];c.__private__.getStandardFonts=function(){return wt};var Kt=M.fontSize||16;c.__private__.setFontSize=c.setFontSize=function(U){return Kt=B===L.ADVANCED?U/jt:U,this};var $t,yt=c.__private__.getFontSize=c.getFontSize=function(){return B===L.COMPAT?Kt:Kt*jt},ri=M.R2L||!1;c.__private__.setR2L=c.setR2L=function(U){return ri=U,this},c.__private__.getR2L=c.getR2L=function(){return ri};var mi,xi=c.__private__.setZoomMode=function(U){var ue=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(U))$t=U;else if(isNaN(U)){if(ue.indexOf(U)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+U+'" is not recognized.');$t=U}else $t=parseInt(U,10)};c.__private__.getZoomMode=function(){return $t};var Li,Ue=c.__private__.setPageMode=function(U){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(U)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+U+'" is not recognized.');mi=U};c.__private__.getPageMode=function(){return mi};var ge=c.__private__.setLayoutMode=function(U){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(U)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+U+'" is not recognized.');Li=U};c.__private__.getLayoutMode=function(){return Li},c.__private__.setDisplayMode=c.setDisplayMode=function(U,ue,Ye){return xi(U),ge(ue),Ue(Ye),this};var Rt={title:"",subject:"",author:"",keywords:"",creator:""};c.__private__.getDocumentProperty=function(U){if(Object.keys(Rt).indexOf(U)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Rt[U]},c.__private__.getDocumentProperties=function(){return Rt},c.__private__.setDocumentProperties=c.setProperties=c.setDocumentProperties=function(U){for(var ue in Rt)Rt.hasOwnProperty(ue)&&U[ue]&&(Rt[ue]=U[ue]);return this},c.__private__.setDocumentProperty=function(U,ue){if(Object.keys(Rt).indexOf(U)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Rt[U]=ue};var si,jt,Ii,wi,or,Ti={},Yi={},qr=[],Hi={},je={},oe={},fe={},Ve=null,Ke=0,$e=[],dt=new s_(c),bt=M.hotfixes||[],st={},Dt={},ti=[],Vt=function U(ue,Ye,pt,It,Zt,pi){if(!(this instanceof U))return new U(ue,Ye,pt,It,Zt,pi);isNaN(ue)&&(ue=1),isNaN(Ye)&&(Ye=0),isNaN(pt)&&(pt=0),isNaN(It)&&(It=1),isNaN(Zt)&&(Zt=0),isNaN(pi)&&(pi=0),this._matrix=[ue,Ye,pt,It,Zt,pi]};Object.defineProperty(Vt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(Vt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(Vt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(Vt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(Vt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(Vt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(Vt.prototype,"a",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(Vt.prototype,"b",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(Vt.prototype,"c",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(Vt.prototype,"d",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(Vt.prototype,"e",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(Vt.prototype,"f",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(Vt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Vt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Vt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Vt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Vt.prototype.join=function(U){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(he).join(U)},Vt.prototype.multiply=function(U){var ue=U.sx*this.sx+U.shy*this.shx,Ye=U.sx*this.shy+U.shy*this.sy,pt=U.shx*this.sx+U.sy*this.shx,It=U.shx*this.shy+U.sy*this.sy,Zt=U.tx*this.sx+U.ty*this.shx+this.tx,pi=U.tx*this.shy+U.ty*this.sy+this.ty;return new Vt(ue,Ye,pt,It,Zt,pi)},Vt.prototype.decompose=function(){var U=this.sx,ue=this.shy,Ye=this.shx,pt=this.sy,It=this.tx,Zt=this.ty,pi=Math.sqrt(U*U+ue*ue),Ei=(U/=pi)*Ye+(ue/=pi)*pt;Ye-=U*Ei,pt-=ue*Ei;var qi=Math.sqrt(Ye*Ye+pt*pt);return Ei/=qi,U*(pt/=qi)<ue*(Ye/=qi)&&(U=-U,ue=-ue,Ei=-Ei,pi=-pi),{scale:new Vt(pi,0,0,qi,0,0),translate:new Vt(1,0,0,1,It,Zt),rotate:new Vt(U,ue,-ue,U,0,0),skew:new Vt(1,0,Ei,1,0,0)}},Vt.prototype.toString=function(U){return this.join(" ")},Vt.prototype.inversed=function(){var U=this.sx,ue=this.shy,Ye=this.shx,pt=this.sy,It=this.tx,Zt=this.ty,pi=1/(U*pt-ue*Ye),Ei=pt*pi,qi=-ue*pi,lr=-Ye*pi,Ci=U*pi;return new Vt(Ei,qi,lr,Ci,-Ei*It-lr*Zt,-qi*It-Ci*Zt)},Vt.prototype.applyToPoint=function(U){var ue=U.x*this.sx+U.y*this.shx+this.tx,Ye=U.x*this.shy+U.y*this.sy+this.ty;return new mr(ue,Ye)},Vt.prototype.applyToRectangle=function(U){var ue=this.applyToPoint(U),Ye=this.applyToPoint(new mr(U.x+U.w,U.y+U.h));return new Il(ue.x,ue.y,Ye.x-ue.x,Ye.y-ue.y)},Vt.prototype.clone=function(){var U=this.sx,ue=this.shy,Ye=this.shx,pt=this.sy,It=this.tx,Zt=this.ty;return new Vt(U,ue,Ye,pt,It,Zt)},c.Matrix=Vt;var ni=c.matrixMult=function(U,ue){return ue.multiply(U)},Ui=new Vt(1,0,0,1,0,0);c.unitMatrix=c.identityMatrix=Ui;var Vi=function(U,ue){if(!je[U]){var Ye=(ue instanceof dc?"Sh":"P")+(Object.keys(Hi).length+1).toString(10);ue.id=Ye,je[U]=Ye,Hi[Ye]=ue,dt.publish("addPattern",ue)}};c.ShadingPattern=dc,c.TilingPattern=Qc,c.addShadingPattern=function(U,ue){return le("addShadingPattern()"),Vi(U,ue),this},c.beginTilingPattern=function(U){le("beginTilingPattern()"),kl(U.boundingBox[0],U.boundingBox[1],U.boundingBox[2]-U.boundingBox[0],U.boundingBox[3]-U.boundingBox[1],U.matrix)},c.endTilingPattern=function(U,ue){le("endTilingPattern()"),ue.stream=lt[ce].join(`
`),Vi(U,ue),dt.publish("endTilingPattern",ue),ti.pop().restore()};var ki=c.__private__.newObject=function(){var U=Fi();return Wi(U,!0),U},Fi=c.__private__.newObjectDeferred=function(){return we++,ke[we]=function(){return qe},we},Wi=function(U,ue){return ue=typeof ue=="boolean"&&ue,ke[U]=qe,ue&&Se(U+" 0 obj"),U},Ar=c.__private__.newAdditionalObject=function(){var U={objId:Fi(),content:""};return gt.push(U),U},Pr=Fi(),kr=Fi(),Sr=c.__private__.decodeColorString=function(U){var ue=U.split(" ");if(ue.length!==2||ue[1]!=="g"&&ue[1]!=="G")ue.length===5&&(ue[4]==="k"||ue[4]==="K")&&(ue=[(1-ue[0])*(1-ue[3]),(1-ue[1])*(1-ue[3]),(1-ue[2])*(1-ue[3]),"r"]);else{var Ye=parseFloat(ue[0]);ue=[Ye,Ye,Ye,"r"]}for(var pt="#",It=0;It<3;It++)pt+=("0"+Math.floor(255*parseFloat(ue[It])).toString(16)).slice(-2);return pt},un=c.__private__.encodeColorString=function(U){var ue;typeof U=="string"&&(U={ch1:U});var Ye=U.ch1,pt=U.ch2,It=U.ch3,Zt=U.ch4,pi=U.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ye=="string"&&Ye.charAt(0)!=="#"){var Ei=new M_(Ye);if(Ei.ok)Ye=Ei.toHex();else if(!/^\d*\.?\d*$/.test(Ye))throw new Error('Invalid color "'+Ye+'" passed to jsPDF.encodeColorString.')}if(typeof Ye=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ye)&&(Ye="#"+Ye[1]+Ye[1]+Ye[2]+Ye[2]+Ye[3]+Ye[3]),typeof Ye=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ye)){var qi=parseInt(Ye.substr(1),16);Ye=qi>>16&255,pt=qi>>8&255,It=255&qi}if(pt===void 0||Zt===void 0&&Ye===pt&&pt===It)if(typeof Ye=="string")ue=Ye+" "+pi[0];else switch(U.precision){case 2:ue=ot(Ye/255)+" "+pi[0];break;case 3:default:ue=_e(Ye/255)+" "+pi[0]}else if(Zt===void 0||rn(Zt)==="object"){if(Zt&&!isNaN(Zt.a)&&Zt.a===0)return ue=["1.","1.","1.",pi[1]].join(" ");if(typeof Ye=="string")ue=[Ye,pt,It,pi[1]].join(" ");else switch(U.precision){case 2:ue=[ot(Ye/255),ot(pt/255),ot(It/255),pi[1]].join(" ");break;default:case 3:ue=[_e(Ye/255),_e(pt/255),_e(It/255),pi[1]].join(" ")}}else if(typeof Ye=="string")ue=[Ye,pt,It,Zt,pi[2]].join(" ");else switch(U.precision){case 2:ue=[ot(Ye),ot(pt),ot(It),ot(Zt),pi[2]].join(" ");break;case 3:default:ue=[_e(Ye),_e(pt),_e(It),_e(Zt),pi[2]].join(" ")}return ue},Or=c.__private__.getFilters=function(){return V},Fr=c.__private__.putStream=function(U){var ue=(U=U||{}).data||"",Ye=U.filters||Or(),pt=U.alreadyAppliedFilters||[],It=U.addLength1||!1,Zt=ue.length,pi=U.objectId,Ei=function(fn){return fn};if(x!==null&&pi===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");x!==null&&(Ei=Lt.encryptor(pi,0));var qi={};Ye===!0&&(Ye=["FlateEncode"]);var lr=U.additionalKeyValues||[],Ci=(qi=tr.API.processDataByFilters!==void 0?tr.API.processDataByFilters(ue,Ye):{data:ue,reverseChain:[]}).reverseChain+(Array.isArray(pt)?pt.join(" "):pt.toString());if(qi.data.length!==0&&(lr.push({key:"Length",value:qi.data.length}),It===!0&&lr.push({key:"Length1",value:Zt})),Ci.length!=0)if(Ci.split("/").length-1==1)lr.push({key:"Filter",value:Ci});else{lr.push({key:"Filter",value:"["+Ci+"]"});for(var _r=0;_r<lr.length;_r+=1)if(lr[_r].key==="DecodeParms"){for(var on=[],an=0;an<qi.reverseChain.split("/").length-1;an+=1)on.push("null");on.push(lr[_r].value),lr[_r].value="["+on.join(" ")+"]"}}Se("<<");for(var gn=0;gn<lr.length;gn++)Se("/"+lr[gn].key+" "+lr[gn].value);Se(">>"),qi.data.length!==0&&(Se("stream"),Se(Ei(qi.data)),Se("endstream"))},Bn=c.__private__.putPage=function(U){var ue=U.number,Ye=U.data,pt=U.objId,It=U.contentsObjId;Wi(pt,!0),Se("<</Type /Page"),Se("/Parent "+U.rootDictionaryObjId+" 0 R"),Se("/Resources "+U.resourceDictionaryObjId+" 0 R"),Se("/MediaBox ["+parseFloat(he(U.mediaBox.bottomLeftX))+" "+parseFloat(he(U.mediaBox.bottomLeftY))+" "+he(U.mediaBox.topRightX)+" "+he(U.mediaBox.topRightY)+"]"),U.cropBox!==null&&Se("/CropBox ["+he(U.cropBox.bottomLeftX)+" "+he(U.cropBox.bottomLeftY)+" "+he(U.cropBox.topRightX)+" "+he(U.cropBox.topRightY)+"]"),U.bleedBox!==null&&Se("/BleedBox ["+he(U.bleedBox.bottomLeftX)+" "+he(U.bleedBox.bottomLeftY)+" "+he(U.bleedBox.topRightX)+" "+he(U.bleedBox.topRightY)+"]"),U.trimBox!==null&&Se("/TrimBox ["+he(U.trimBox.bottomLeftX)+" "+he(U.trimBox.bottomLeftY)+" "+he(U.trimBox.topRightX)+" "+he(U.trimBox.topRightY)+"]"),U.artBox!==null&&Se("/ArtBox ["+he(U.artBox.bottomLeftX)+" "+he(U.artBox.bottomLeftY)+" "+he(U.artBox.topRightX)+" "+he(U.artBox.topRightY)+"]"),typeof U.userUnit=="number"&&U.userUnit!==1&&Se("/UserUnit "+U.userUnit),dt.publish("putPage",{objId:pt,pageContext:$e[ue],pageNumber:ue,page:Ye}),Se("/Contents "+It+" 0 R"),Se(">>"),Se("endobj");var Zt=Ye.join(`
`);return B===L.ADVANCED&&(Zt+=`
Q`),Wi(It,!0),Fr({data:Zt,filters:Or(),objectId:It}),Se("endobj"),pt},Io=c.__private__.putPages=function(){var U,ue,Ye=[];for(U=1;U<=Ke;U++)$e[U].objId=Fi(),$e[U].contentsObjId=Fi();for(U=1;U<=Ke;U++)Ye.push(Bn({number:U,data:lt[U],objId:$e[U].objId,contentsObjId:$e[U].contentsObjId,mediaBox:$e[U].mediaBox,cropBox:$e[U].cropBox,bleedBox:$e[U].bleedBox,trimBox:$e[U].trimBox,artBox:$e[U].artBox,userUnit:$e[U].userUnit,rootDictionaryObjId:Pr,resourceDictionaryObjId:kr}));Wi(Pr,!0),Se("<</Type /Pages");var pt="/Kids [";for(ue=0;ue<Ke;ue++)pt+=Ye[ue]+" 0 R ";Se(pt+"]"),Se("/Count "+Ke),Se(">>"),Se("endobj"),dt.publish("postPutPages")},Hs=function(U){dt.publish("putFont",{font:U,out:Se,newObject:ki,putStream:Fr}),U.isAlreadyPutted!==!0&&(U.objectNumber=ki(),Se("<<"),Se("/Type /Font"),Se("/BaseFont /"+Bh(U.postScriptName)),Se("/Subtype /Type1"),typeof U.encoding=="string"&&Se("/Encoding /"+U.encoding),Se("/FirstChar 32"),Se("/LastChar 255"),Se(">>"),Se("endobj"))},hr=function(){for(var U in Ti)Ti.hasOwnProperty(U)&&(d===!1||d===!0&&m.hasOwnProperty(U))&&Hs(Ti[U])},$s=function(U){U.objectNumber=ki();var ue=[];ue.push({key:"Type",value:"/XObject"}),ue.push({key:"Subtype",value:"/Form"}),ue.push({key:"BBox",value:"["+[he(U.x),he(U.y),he(U.x+U.width),he(U.y+U.height)].join(" ")+"]"}),ue.push({key:"Matrix",value:"["+U.matrix.toString()+"]"});var Ye=U.pages[1].join(`
`);Fr({data:Ye,additionalKeyValues:ue,objectId:U.objectNumber}),Se("endobj")},kn=function(){for(var U in st)st.hasOwnProperty(U)&&$s(st[U])},Qo=function(U,ue){var Ye,pt=[],It=1/(ue-1);for(Ye=0;Ye<1;Ye+=It)pt.push(Ye);if(pt.push(1),U[0].offset!=0){var Zt={offset:0,color:U[0].color};U.unshift(Zt)}if(U[U.length-1].offset!=1){var pi={offset:1,color:U[U.length-1].color};U.push(pi)}for(var Ei="",qi=0,lr=0;lr<pt.length;lr++){for(Ye=pt[lr];Ye>U[qi+1].offset;)qi++;var Ci=U[qi].offset,_r=(Ye-Ci)/(U[qi+1].offset-Ci),on=U[qi].color,an=U[qi+1].color;Ei+=te(Math.round((1-_r)*on[0]+_r*an[0]).toString(16))+te(Math.round((1-_r)*on[1]+_r*an[1]).toString(16))+te(Math.round((1-_r)*on[2]+_r*an[2]).toString(16))}return Ei.trim()},ko=function(U,ue){ue||(ue=21);var Ye=ki(),pt=Qo(U.colors,ue),It=[];It.push({key:"FunctionType",value:"0"}),It.push({key:"Domain",value:"[0.0 1.0]"}),It.push({key:"Size",value:"["+ue+"]"}),It.push({key:"BitsPerSample",value:"8"}),It.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),It.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Fr({data:pt,additionalKeyValues:It,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ye}),Se("endobj"),U.objectNumber=ki(),Se("<< /ShadingType "+U.type),Se("/ColorSpace /DeviceRGB");var Zt="/Coords ["+he(parseFloat(U.coords[0]))+" "+he(parseFloat(U.coords[1]))+" ";U.type===2?Zt+=he(parseFloat(U.coords[2]))+" "+he(parseFloat(U.coords[3])):Zt+=he(parseFloat(U.coords[2]))+" "+he(parseFloat(U.coords[3]))+" "+he(parseFloat(U.coords[4]))+" "+he(parseFloat(U.coords[5])),Se(Zt+="]"),U.matrix&&Se("/Matrix ["+U.matrix.toString()+"]"),Se("/Function "+Ye+" 0 R"),Se("/Extend [true true]"),Se(">>"),Se("endobj")},cs=function(U,ue){var Ye=Fi(),pt=ki();ue.push({resourcesOid:Ye,objectOid:pt}),U.objectNumber=pt;var It=[];It.push({key:"Type",value:"/Pattern"}),It.push({key:"PatternType",value:"1"}),It.push({key:"PaintType",value:"1"}),It.push({key:"TilingType",value:"1"}),It.push({key:"BBox",value:"["+U.boundingBox.map(he).join(" ")+"]"}),It.push({key:"XStep",value:he(U.xStep)}),It.push({key:"YStep",value:he(U.yStep)}),It.push({key:"Resources",value:Ye+" 0 R"}),U.matrix&&It.push({key:"Matrix",value:"["+U.matrix.toString()+"]"}),Fr({data:U.stream,additionalKeyValues:It,objectId:U.objectNumber}),Se("endobj")},Gn=function(U){var ue;for(ue in Hi)Hi.hasOwnProperty(ue)&&(Hi[ue]instanceof dc?ko(Hi[ue]):Hi[ue]instanceof Qc&&cs(Hi[ue],U))},ea=function(U){for(var ue in U.objectNumber=ki(),Se("<<"),U)switch(ue){case"opacity":Se("/ca "+ot(U[ue]));break;case"stroke-opacity":Se("/CA "+ot(U[ue]))}Se(">>"),Se("endobj")},Do=function(){var U;for(U in oe)oe.hasOwnProperty(U)&&ea(oe[U])},Qn=function(){for(var U in Se("/XObject <<"),st)st.hasOwnProperty(U)&&st[U].objectNumber>=0&&Se("/"+U+" "+st[U].objectNumber+" 0 R");dt.publish("putXobjectDict"),Se(">>")},bs=function(){Lt.oid=ki(),Se("<<"),Se("/Filter /Standard"),Se("/V "+Lt.v),Se("/R "+Lt.r),Se("/U <"+Lt.toHexString(Lt.U)+">"),Se("/O <"+Lt.toHexString(Lt.O)+">"),Se("/P "+Lt.P),Se(">>"),Se("endobj")},fo=function(){for(var U in Se("/Font <<"),Ti)Ti.hasOwnProperty(U)&&(d===!1||d===!0&&m.hasOwnProperty(U))&&Se("/"+U+" "+Ti[U].objectNumber+" 0 R");Se(">>")},Ut=function(){if(Object.keys(Hi).length>0){for(var U in Se("/Shading <<"),Hi)Hi.hasOwnProperty(U)&&Hi[U]instanceof dc&&Hi[U].objectNumber>=0&&Se("/"+U+" "+Hi[U].objectNumber+" 0 R");dt.publish("putShadingPatternDict"),Se(">>")}},Wn=function(U){if(Object.keys(Hi).length>0){for(var ue in Se("/Pattern <<"),Hi)Hi.hasOwnProperty(ue)&&Hi[ue]instanceof c.TilingPattern&&Hi[ue].objectNumber>=0&&Hi[ue].objectNumber<U&&Se("/"+ue+" "+Hi[ue].objectNumber+" 0 R");dt.publish("putTilingPatternDict"),Se(">>")}},Gr=function(){if(Object.keys(oe).length>0){var U;for(U in Se("/ExtGState <<"),oe)oe.hasOwnProperty(U)&&oe[U].objectNumber>=0&&Se("/"+U+" "+oe[U].objectNumber+" 0 R");dt.publish("putGStateDict"),Se(">>")}},ur=function(U){Wi(U.resourcesOid,!0),Se("<<"),Se("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),fo(),Ut(),Wn(U.objectOid),Gr(),Qn(),Se(">>"),Se("endobj")},Ys=function(){var U=[];hr(),Do(),kn(),Gn(U),dt.publish("putResources"),U.forEach(ur),ur({resourcesOid:kr,objectOid:Number.MAX_SAFE_INTEGER}),dt.publish("postPutResources")},br=function(){dt.publish("putAdditionalObjects");for(var U=0;U<gt.length;U++){var ue=gt[U];Wi(ue.objId,!0),Se(ue.content),Se("endobj")}dt.publish("postPutAdditionalObjects")},Zs=function(U){Yi[U.fontName]=Yi[U.fontName]||{},Yi[U.fontName][U.fontStyle]=U.id},po=function(U,ue,Ye,pt,It){var Zt={id:"F"+(Object.keys(Ti).length+1).toString(10),postScriptName:U,fontName:ue,fontStyle:Ye,encoding:pt,isStandardFont:It||!1,metadata:{}};return dt.publish("addFont",{font:Zt,instance:this}),Ti[Zt.id]=Zt,Zs(Zt),Zt.id},Ks=function(U){for(var ue=0,Ye=wt.length;ue<Ye;ue++){var pt=po.call(this,U[ue][0],U[ue][1],U[ue][2],wt[ue][3],!0);d===!1&&(m[pt]=!0);var It=U[ue][0].split("-");Zs({id:pt,fontName:It[0],fontStyle:It[1]||""})}dt.publish("addFonts",{fonts:Ti,dictionary:Yi})},di=function(U){return U.foo=function(){try{return U.apply(this,arguments)}catch(pt){var ue=pt.stack||"";~ue.indexOf(" at ")&&(ue=ue.split(" at ")[1]);var Ye="Error in function "+ue.split(`
`)[0].split("<")[0]+": "+pt.message;if(!cr.console)throw new Error(Ye);cr.console.error(Ye,pt),cr.alert&&alert(Ye)}},U.foo.bar=U,U.foo},Zi=function(U,ue){var Ye,pt,It,Zt,pi,Ei,qi,lr,Ci;if(It=(ue=ue||{}).sourceEncoding||"Unicode",pi=ue.outputEncoding,(ue.autoencode||pi)&&Ti[si].metadata&&Ti[si].metadata[It]&&Ti[si].metadata[It].encoding&&(Zt=Ti[si].metadata[It].encoding,!pi&&Ti[si].encoding&&(pi=Ti[si].encoding),!pi&&Zt.codePages&&(pi=Zt.codePages[0]),typeof pi=="string"&&(pi=Zt[pi]),pi)){for(qi=!1,Ei=[],Ye=0,pt=U.length;Ye<pt;Ye++)(lr=pi[U.charCodeAt(Ye)])?Ei.push(String.fromCharCode(lr)):Ei.push(U[Ye]),Ei[Ye].charCodeAt(0)>>8&&(qi=!0);U=Ei.join("")}for(Ye=U.length;qi===void 0&&Ye!==0;)U.charCodeAt(Ye-1)>>8&&(qi=!0),Ye--;if(!qi)return U;for(Ei=ue.noBOM?[]:[254,255],Ye=0,pt=U.length;Ye<pt;Ye++){if((Ci=(lr=U.charCodeAt(Ye))>>8)>>8)throw new Error("Character at position "+Ye+" of string '"+U+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Ei.push(Ci),Ei.push(lr-(Ci<<8))}return String.fromCharCode.apply(void 0,Ei)},ji=c.__private__.pdfEscape=c.pdfEscape=function(U,ue){return Zi(U,ue).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},tn=c.__private__.beginPage=function(U){lt[++Ke]=[],$e[Ke]={objId:0,contentsObjId:0,userUnit:Number(t),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(U[0]),topRightY:Number(U[1])}},mn(Ke),Xe(lt[ce])},Nn=function(U,ue){var Ye,pt,It;switch(A=ue||A,typeof U=="string"&&(Ye=C(U.toLowerCase()),Array.isArray(Ye)&&(pt=Ye[0],It=Ye[1])),Array.isArray(U)&&(pt=U[0]*jt,It=U[1]*jt),isNaN(pt)&&(pt=R[0],It=R[1]),(pt>14400||It>14400)&&(hn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),pt=Math.min(14400,pt),It=Math.min(14400,It)),R=[pt,It],A.substr(0,1)){case"l":It>pt&&(R=[It,pt]);break;case"p":pt>It&&(R=[It,pt])}tn(R),ga(Xn),Se(Tn),va!==0&&Se(va+" J"),xa!==0&&Se(xa+" j"),dt.publish("addPage",{pageNumber:Ke})},Ki=function(U){U>0&&U<=Ke&&(lt.splice(U,1),$e.splice(U,1),Ke--,ce>Ke&&(ce=Ke),this.setPage(ce))},mn=function(U){U>0&&U<=Ke&&(ce=U)},Oo=c.__private__.getNumberOfPages=c.getNumberOfPages=function(){return lt.length-1},Es=function(U,ue,Ye){var pt,It=void 0;return Ye=Ye||{},U=U!==void 0?U:Ti[si].fontName,ue=ue!==void 0?ue:Ti[si].fontStyle,pt=U.toLowerCase(),Yi[pt]!==void 0&&Yi[pt][ue]!==void 0?It=Yi[pt][ue]:Yi[U]!==void 0&&Yi[U][ue]!==void 0?It=Yi[U][ue]:Ye.disableWarning===!1&&hn.warn("Unable to look up font label for font '"+U+"', '"+ue+"'. Refer to getFontList() for available fonts."),It||Ye.noFallback||(It=Yi.times[ue])==null&&(It=Yi.times.normal),It},jn=c.__private__.putInfo=function(){var U=ki(),ue=function(pt){return pt};for(var Ye in x!==null&&(ue=Lt.encryptor(U,0)),Se("<<"),Se("/Producer ("+ji(ue("jsPDF "+tr.version))+")"),Rt)Rt.hasOwnProperty(Ye)&&Rt[Ye]&&Se("/"+Ye.substr(0,1).toUpperCase()+Ye.substr(1)+" ("+ji(ue(Rt[Ye]))+")");Se("/CreationDate ("+ji(ue(at))+")"),Se(">>"),Se("endobj")},Er=c.__private__.putCatalog=function(U){var ue=(U=U||{}).rootDictionaryObjId||Pr;switch(ki(),Se("<<"),Se("/Type /Catalog"),Se("/Pages "+ue+" 0 R"),$t||($t="fullwidth"),$t){case"fullwidth":Se("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Se("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Se("/OpenAction [3 0 R /Fit]");break;case"original":Se("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ye=""+$t;Ye.substr(Ye.length-1)==="%"&&($t=parseInt($t)/100),typeof $t=="number"&&Se("/OpenAction [3 0 R /XYZ null null "+ot($t)+"]")}switch(Li||(Li="continuous"),Li){case"continuous":Se("/PageLayout /OneColumn");break;case"single":Se("/PageLayout /SinglePage");break;case"two":case"twoleft":Se("/PageLayout /TwoColumnLeft");break;case"tworight":Se("/PageLayout /TwoColumnRight")}mi&&Se("/PageMode /"+mi),dt.publish("putCatalog"),Se(">>"),Se("endobj")},ma=c.__private__.putTrailer=function(){Se("trailer"),Se("<<"),Se("/Size "+(we+1)),Se("/Root "+we+" 0 R"),Se("/Info "+(we-1)+" 0 R"),x!==null&&Se("/Encrypt "+Lt.oid+" 0 R"),Se("/ID [ <"+ft+"> <"+ft+"> ]"),Se(">>")},ws=c.__private__.putHeader=function(){Se("%PDF-"+_),Se("%ºß¬à")},Fo=c.__private__.putXRef=function(){var U="0000000000";Se("xref"),Se("0 "+(we+1)),Se("0000000000 65535 f ");for(var ue=1;ue<=we;ue++)typeof ke[ue]=="function"?Se((U+ke[ue]()).slice(-10)+" 00000 n "):ke[ue]!==void 0?Se((U+ke[ue]).slice(-10)+" 00000 n "):Se("0000000000 00000 n ")},es=c.__private__.buildDocument=function(){ct(),Xe(We),dt.publish("buildDocument"),ws(),Io(),br(),Ys(),x!==null&&bs(),jn(),Er();var U=qe;return Fo(),ma(),Se("startxref"),Se(""+U),Se("%%EOF"),Xe(lt[ce]),We.join(`
`)},Ss=c.__private__.getBlob=function(U){return new Blob([Et(U)],{type:"application/pdf"})},it=c.output=c.__private__.output=di(function(U,ue){switch(typeof(ue=ue||{})=="string"?ue={filename:ue}:ue.filename=ue.filename||"generated.pdf",U){case void 0:return es();case"save":c.save(ue.filename);break;case"arraybuffer":return Et(es());case"blob":return Ss(es());case"bloburi":case"bloburl":if(cr.URL!==void 0&&typeof cr.URL.createObjectURL=="function")return cr.URL&&cr.URL.createObjectURL(Ss(es()))||void 0;hn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ye="",pt=es();try{Ye=op(pt)}catch{Ye=op(unescape(encodeURIComponent(pt)))}return"data:application/pdf;filename="+ue.filename+";base64,"+Ye;case"pdfobjectnewwindow":if(Object.prototype.toString.call(cr)==="[object Window]"){var It="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Zt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ue.pdfObjectUrl&&(It=ue.pdfObjectUrl,Zt="");var pi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+It+'"'+Zt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ue)+");<\/script></body></html>",Ei=cr.open();return Ei!==null&&Ei.document.write(pi),Ei}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(cr)==="[object Window]"){var qi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ue.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ue.filename+'" width="500px" height="400px" /></body></html>',lr=cr.open();if(lr!==null){lr.document.write(qi);var Ci=this;lr.document.documentElement.querySelector("#pdfViewer").onload=function(){lr.document.title=ue.filename,lr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ci.output("bloburl"))}}return lr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(cr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var _r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ue)+'"></iframe></body></html>',on=cr.open();if(on!==null&&(on.document.write(_r),on.document.title=ue.filename),on||typeof safari>"u")return on;break;case"datauri":case"dataurl":return cr.document.location.href=this.output("datauristring",ue);default:return null}}),vt=function(U){return Array.isArray(bt)===!0&&bt.indexOf(U)>-1};switch(D){case"pt":jt=1;break;case"mm":jt=72/25.4;break;case"cm":jt=72/2.54;break;case"in":jt=72;break;case"px":jt=vt("px_scaling")==1?.75:96/72;break;case"pc":case"em":jt=12;break;case"ex":jt=6;break;default:if(typeof D!="number")throw new Error("Invalid unit: "+D);jt=D}var Lt=null;Oe(),He();var li=function(U){return x!==null?Lt.encryptor(U,0):function(ue){return ue}},_i=c.__private__.getPageInfo=c.getPageInfo=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:$e[U].objId,pageNumber:U,pageContext:$e[U]}},Yt=c.__private__.getPageInfoByObjId=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ue in $e)if($e[ue].objId===U)break;return _i(ue)},Mi=c.__private__.getCurrentPageInfo=c.getCurrentPageInfo=function(){return{objId:$e[ce].objId,pageNumber:ce,pageContext:$e[ce]}};c.addPage=function(){return Nn.apply(this,arguments),this},c.setPage=function(){return mn.apply(this,arguments),Xe.call(this,lt[ce]),this},c.insertPage=function(U){return this.addPage(),this.movePage(ce,U),this},c.movePage=function(U,ue){var Ye,pt;if(U>ue){Ye=lt[U],pt=$e[U];for(var It=U;It>ue;It--)lt[It]=lt[It-1],$e[It]=$e[It-1];lt[ue]=Ye,$e[ue]=pt,this.setPage(ue)}else if(U<ue){Ye=lt[U],pt=$e[U];for(var Zt=U;Zt<ue;Zt++)lt[Zt]=lt[Zt+1],$e[Zt]=$e[Zt+1];lt[ue]=Ye,$e[ue]=pt,this.setPage(ue)}return this},c.deletePage=function(){return Ki.apply(this,arguments),this},c.__private__.text=c.text=function(U,ue,Ye,pt,It){var Zt,pi,Ei,qi,lr,Ci,_r,on,an,gn=(pt=pt||{}).scope||this;if(typeof U=="number"&&typeof ue=="number"&&(typeof Ye=="string"||Array.isArray(Ye))){var fn=Ye;Ye=ue,ue=U,U=fn}if(arguments[3]instanceof Vt?(le("The transform parameter of text() with a Matrix value"),an=It):(Ei=arguments[4],qi=arguments[5],rn(_r=arguments[3])==="object"&&_r!==null||(typeof Ei=="string"&&(qi=Ei,Ei=null),typeof _r=="string"&&(qi=_r,_r=null),typeof _r=="number"&&(Ei=_r,_r=null),pt={flags:_r,angle:Ei,align:qi})),isNaN(ue)||isNaN(Ye)||U==null)throw new Error("Invalid arguments passed to jsPDF.text");if(U.length===0)return gn;var vn="",to=!1,Cs=typeof pt.lineHeightFactor=="number"?pt.lineHeightFactor:Dn,jo=gn.internal.scaleFactor;function Qa(Xr){return Xr=Xr.split("	").join(Array(pt.TabLen||9).join(" ")),ji(Xr,_r)}function Sa(Xr){for(var Hr,Rr=Xr.concat(),dn=[],xn=Rr.length;xn--;)typeof(Hr=Rr.shift())=="string"?dn.push(Hr):Array.isArray(Xr)&&(Hr.length===1||Hr[1]===void 0&&Hr[2]===void 0)?dn.push(Hr[0]):dn.push([Hr[0],Hr[1],Hr[2]]);return dn}function Ta(Xr,Hr){var Rr;if(typeof Xr=="string")Rr=Hr(Xr)[0];else if(Array.isArray(Xr)){for(var dn,xn,Ds=Xr.concat(),Da=[],xo=Ds.length;xo--;)typeof(dn=Ds.shift())=="string"?Da.push(Hr(dn)[0]):Array.isArray(dn)&&typeof dn[0]=="string"&&(xn=Hr(dn[0],dn[1],dn[2]),Da.push([xn[0],xn[1],xn[2]]));Rr=Da}return Rr}var Uo=!1,el=!0;if(typeof U=="string")Uo=!0;else if(Array.isArray(U)){var tl=U.concat();pi=[];for(var il,On=tl.length;On--;)(typeof(il=tl.shift())!="string"||Array.isArray(il)&&typeof il[0]!="string")&&(el=!1);Uo=el}if(Uo===!1)throw new Error('Type of text must be string or Array. "'+U+'" is not recognized.');typeof U=="string"&&(U=U.match(/[\r?\n]/)?U.split(/\r\n|\r|\n/g):[U]);var io=Kt/gn.internal.scaleFactor,ia=io*(Cs-1);switch(pt.baseline){case"bottom":Ye-=ia;break;case"top":Ye+=io-ia;break;case"hanging":Ye+=io-2*ia;break;case"middle":Ye+=io/2-ia}if((Ci=pt.maxWidth||0)>0&&(typeof U=="string"?U=gn.splitTextToSize(U,Ci):Object.prototype.toString.call(U)==="[object Array]"&&(U=U.reduce(function(Xr,Hr){return Xr.concat(gn.splitTextToSize(Hr,Ci))},[]))),Zt={text:U,x:ue,y:Ye,options:pt,mutex:{pdfEscape:ji,activeFontKey:si,fonts:Ti,activeFontSize:Kt}},dt.publish("preProcessText",Zt),U=Zt.text,Ei=(pt=Zt.options).angle,!(an instanceof Vt)&&Ei&&typeof Ei=="number"){Ei*=Math.PI/180,pt.rotationDirection===0&&(Ei=-Ei),B===L.ADVANCED&&(Ei=-Ei);var _o=Math.cos(Ei),Ca=Math.sin(Ei);an=new Vt(_o,Ca,-Ca,_o,0,0)}else Ei&&Ei instanceof Vt&&(an=Ei);B!==L.ADVANCED||an||(an=Ui),(lr=pt.charSpace||ya)!==void 0&&(vn+=he(pe(lr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(on=pt.horizontalScale)!==void 0&&(vn+=he(100*on)+` Tz
`),pt.lang;var ln=-1,rl=pt.renderingMode!==void 0?pt.renderingMode:pt.stroke,Aa=gn.internal.getCurrentPageInfo().pageContext;switch(rl){case 0:case!1:case"fill":ln=0;break;case 1:case!0:case"stroke":ln=1;break;case 2:case"fillThenStroke":ln=2;break;case 3:case"invisible":ln=3;break;case 4:case"fillAndAddForClipping":ln=4;break;case 5:case"strokeAndAddPathForClipping":ln=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ln=6;break;case 7:case"addToPathForClipping":ln=7}var Ea=Aa.usedRenderingMode!==void 0?Aa.usedRenderingMode:-1;ln!==-1?vn+=ln+` Tr
`:Ea!==-1&&(vn+=`0 Tr
`),ln!==-1&&(Aa.usedRenderingMode=ln),qi=pt.align||"left";var Is,Pa=Kt*Cs,yc=gn.internal.pageSize.getWidth(),Ol=Ti[si];lr=pt.charSpace||ya,Ci=pt.maxWidth||0,_r=Object.assign({autoencode:!0,noBOM:!0},pt.flags);var ro=[];if(Object.prototype.toString.call(U)==="[object Array]"){var Hn;pi=Sa(U),qi!=="left"&&(Is=pi.map(function(Xr){return gn.getStringUnitWidth(Xr,{font:Ol,charSpace:lr,fontSize:Kt,doKerning:!1})*Kt/jo}));var ks,yo=0;if(qi==="right"){ue-=Is[0],U=[],On=pi.length;for(var vo=0;vo<On;vo++)vo===0?(ks=Js(ue),Hn=us(Ye)):(ks=pe(yo-Is[vo]),Hn=-Pa),U.push([pi[vo],ks,Hn]),yo=Is[vo]}else if(qi==="center"){ue-=Is[0]/2,U=[],On=pi.length;for(var no=0;no<On;no++)no===0?(ks=Js(ue),Hn=us(Ye)):(ks=pe((yo-Is[no])/2),Hn=-Pa),U.push([pi[no],ks,Hn]),yo=Is[no]}else if(qi==="left"){U=[],On=pi.length;for(var Ma=0;Ma<On;Ma++)U.push(pi[Ma])}else{if(qi!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');U=[],On=pi.length,Ci=Ci!==0?Ci:yc;for(var ts=0;ts<On;ts++)Hn=ts===0?us(Ye):-Pa,ks=ts===0?Js(ue):0,ts<On-1?ro.push(he(pe((Ci-Is[ts])/(pi[ts].split(" ").length-1)))):ro.push(0),U.push([pi[ts],ks,Hn])}}var La=typeof pt.R2L=="boolean"?pt.R2L:ri;La===!0&&(U=Ta(U,function(Xr,Hr,Rr){return[Xr.split("").reverse().join(""),Hr,Rr]})),Zt={text:U,x:ue,y:Ye,options:pt,mutex:{pdfEscape:ji,activeFontKey:si,fonts:Ti,activeFontSize:Kt}},dt.publish("postProcessText",Zt),U=Zt.text,to=Zt.mutex.isHex||!1;var ra=Ti[si].encoding;ra!=="WinAnsiEncoding"&&ra!=="StandardEncoding"||(U=Ta(U,function(Xr,Hr,Rr){return[Qa(Xr),Hr,Rr]})),pi=Sa(U),U=[];for(var Vo,$n,qo,Ia=0,nl=1,ka=Array.isArray(pi[0])?nl:Ia,na="",sl=function(Xr,Hr,Rr){var dn="";return Rr instanceof Vt?(Rr=typeof pt.angle=="number"?ni(Rr,new Vt(1,0,0,1,Xr,Hr)):ni(new Vt(1,0,0,1,Xr,Hr),Rr),B===L.ADVANCED&&(Rr=ni(new Vt(1,0,0,-1,0,0),Rr)),dn=Rr.join(" ")+` Tm
`):dn=he(Xr)+" "+he(Hr)+` Td
`,dn},is=0;is<pi.length;is++){switch(na="",ka){case nl:qo=(to?"<":"(")+pi[is][0]+(to?">":")"),Vo=parseFloat(pi[is][1]),$n=parseFloat(pi[is][2]);break;case Ia:qo=(to?"<":"(")+pi[is]+(to?">":")"),Vo=Js(ue),$n=us(Ye)}ro!==void 0&&ro[is]!==void 0&&(na=ro[is]+` Tw
`),is===0?U.push(na+sl(Vo,$n,an)+qo):ka===Ia?U.push(na+qo):ka===nl&&U.push(na+sl(Vo,$n,an)+qo)}U=ka===Ia?U.join(` Tj
T* `):U.join(` Tj
`),U+=` Tj
`;var fs=`BT
/`;return fs+=si+" "+Kt+` Tf
`,fs+=he(Kt*Cs)+` TL
`,fs+=Ls+`
`,fs+=vn,fs+=U,Se(fs+="ET"),m[si]=!0,gn};var Di=c.__private__.clip=c.clip=function(U){return Se(U==="evenodd"?"W*":"W"),this};c.clipEvenOdd=function(){return Di("evenodd")},c.__private__.discardPath=c.discardPath=function(){return Se("n"),this};var gr=c.__private__.isValidStyle=function(U){var ue=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(U)!==-1&&(ue=!0),ue};c.__private__.setDefaultPathOperation=c.setDefaultPathOperation=function(U){return gr(U)&&(v=U),this};var ar=c.__private__.getStyle=c.getStyle=function(U){var ue=v;switch(U){case"D":case"S":ue="S";break;case"F":ue="f";break;case"FD":case"DF":ue="B";break;case"f":case"f*":case"B":case"B*":ue=U}return ue},pr=c.close=function(){return Se("h"),this};c.stroke=function(){return Se("S"),this},c.fill=function(U){return Mr("f",U),this},c.fillEvenOdd=function(U){return Mr("f*",U),this},c.fillStroke=function(U){return Mr("B",U),this},c.fillStrokeEvenOdd=function(U){return Mr("B*",U),this};var Mr=function(U,ue){rn(ue)==="object"?nn(ue,U):Se(U)},fr=function(U){U===null||B===L.ADVANCED&&U===void 0||(U=ar(U),Se(U))};function ir(U,ue,Ye,pt,It){var Zt=new Qc(ue||this.boundingBox,Ye||this.xStep,pt||this.yStep,this.gState,It||this.matrix);Zt.stream=this.stream;var pi=U+"$$"+this.cloneIndex+++"$$";return Vi(pi,Zt),Zt}var nn=function(U,ue){var Ye=je[U.key],pt=Hi[Ye];if(pt instanceof dc)Se("q"),Se(sn(ue)),pt.gState&&c.setGState(pt.gState),Se(U.matrix.toString()+" cm"),Se("/"+Ye+" sh"),Se("Q");else if(pt instanceof Qc){var It=new Vt(1,0,0,-1,0,eo());U.matrix&&(It=It.multiply(U.matrix||Ui),Ye=ir.call(pt,U.key,U.boundingBox,U.xStep,U.yStep,It).id),Se("q"),Se("/Pattern cs"),Se("/"+Ye+" scn"),pt.gState&&c.setGState(pt.gState),Se(ue),Se("Q")}},sn=function(U){switch(U){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},zr=c.moveTo=function(U,ue){return Se(he(pe(U))+" "+he(De(ue))+" m"),this},Wr=c.lineTo=function(U,ue){return Se(he(pe(U))+" "+he(De(ue))+" l"),this},hs=c.curveTo=function(U,ue,Ye,pt,It,Zt){return Se([he(pe(U)),he(De(ue)),he(pe(Ye)),he(De(pt)),he(pe(It)),he(De(Zt)),"c"].join(" ")),this};c.__private__.line=c.line=function(U,ue,Ye,pt,It){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||isNaN(pt)||!gr(It))throw new Error("Invalid arguments passed to jsPDF.line");return B===L.COMPAT?this.lines([[Ye-U,pt-ue]],U,ue,[1,1],It||"S"):this.lines([[Ye-U,pt-ue]],U,ue,[1,1]).stroke()},c.__private__.lines=c.lines=function(U,ue,Ye,pt,It,Zt){var pi,Ei,qi,lr,Ci,_r,on,an,gn,fn,vn,to;if(typeof U=="number"&&(to=Ye,Ye=ue,ue=U,U=to),pt=pt||[1,1],Zt=Zt||!1,isNaN(ue)||isNaN(Ye)||!Array.isArray(U)||!Array.isArray(pt)||!gr(It)||typeof Zt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(zr(ue,Ye),pi=pt[0],Ei=pt[1],lr=U.length,fn=ue,vn=Ye,qi=0;qi<lr;qi++)(Ci=U[qi]).length===2?(fn=Ci[0]*pi+fn,vn=Ci[1]*Ei+vn,Wr(fn,vn)):(_r=Ci[0]*pi+fn,on=Ci[1]*Ei+vn,an=Ci[2]*pi+fn,gn=Ci[3]*Ei+vn,fn=Ci[4]*pi+fn,vn=Ci[5]*Ei+vn,hs(_r,on,an,gn,fn,vn));return Zt&&pr(),fr(It),this},c.path=function(U){for(var ue=0;ue<U.length;ue++){var Ye=U[ue],pt=Ye.c;switch(Ye.op){case"m":zr(pt[0],pt[1]);break;case"l":Wr(pt[0],pt[1]);break;case"c":hs.apply(this,pt);break;case"h":pr()}}return this},c.__private__.rect=c.rect=function(U,ue,Ye,pt,It){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||isNaN(pt)||!gr(It))throw new Error("Invalid arguments passed to jsPDF.rect");return B===L.COMPAT&&(pt=-pt),Se([he(pe(U)),he(De(ue)),he(pe(Ye)),he(pe(pt)),"re"].join(" ")),fr(It),this},c.__private__.triangle=c.triangle=function(U,ue,Ye,pt,It,Zt,pi){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||isNaN(pt)||isNaN(It)||isNaN(Zt)||!gr(pi))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ye-U,pt-ue],[It-Ye,Zt-pt],[U-It,ue-Zt]],U,ue,[1,1],pi,!0),this},c.__private__.roundedRect=c.roundedRect=function(U,ue,Ye,pt,It,Zt,pi){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||isNaN(pt)||isNaN(It)||isNaN(Zt)||!gr(pi))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Ei=4/3*(Math.SQRT2-1);return It=Math.min(It,.5*Ye),Zt=Math.min(Zt,.5*pt),this.lines([[Ye-2*It,0],[It*Ei,0,It,Zt-Zt*Ei,It,Zt],[0,pt-2*Zt],[0,Zt*Ei,-It*Ei,Zt,-It,Zt],[2*It-Ye,0],[-It*Ei,0,-It,-Zt*Ei,-It,-Zt],[0,2*Zt-pt],[0,-Zt*Ei,It*Ei,-Zt,It,-Zt]],U+It,ue,[1,1],pi,!0),this},c.__private__.ellipse=c.ellipse=function(U,ue,Ye,pt,It){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||isNaN(pt)||!gr(It))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Zt=4/3*(Math.SQRT2-1)*Ye,pi=4/3*(Math.SQRT2-1)*pt;return zr(U+Ye,ue),hs(U+Ye,ue-pi,U+Zt,ue-pt,U,ue-pt),hs(U-Zt,ue-pt,U-Ye,ue-pi,U-Ye,ue),hs(U-Ye,ue+pi,U-Zt,ue+pt,U,ue+pt),hs(U+Zt,ue+pt,U+Ye,ue+pi,U+Ye,ue),fr(It),this},c.__private__.circle=c.circle=function(U,ue,Ye,pt){if(isNaN(U)||isNaN(ue)||isNaN(Ye)||!gr(pt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(U,ue,Ye,Ye,pt)},c.setFont=function(U,ue,Ye){return Ye&&(ue=se(ue,Ye)),si=Es(U,ue,{disableWarning:!1}),this};var zo=c.__private__.getFont=c.getFont=function(){return Ti[Es.apply(c,arguments)]};c.__private__.getFontList=c.getFontList=function(){var U,ue,Ye={};for(U in Yi)if(Yi.hasOwnProperty(U))for(ue in Ye[U]=[],Yi[U])Yi[U].hasOwnProperty(ue)&&Ye[U].push(ue);return Ye},c.addFont=function(U,ue,Ye,pt,It){var Zt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Zt.indexOf(arguments[3])!==-1?It=arguments[3]:arguments[3]&&Zt.indexOf(arguments[3])==-1&&(Ye=se(Ye,pt)),It=It||"Identity-H",po.call(this,U,ue,Ye,It)};var Dn,Xn=M.lineWidth||.200025,Ps=c.__private__.getLineWidth=c.getLineWidth=function(){return Xn},ga=c.__private__.setLineWidth=c.setLineWidth=function(U){return Xn=U,Se(he(pe(U))+" w"),this};c.__private__.setLineDash=tr.API.setLineDash=tr.API.setLineDashPattern=function(U,ue){if(U=U||[],ue=ue||0,isNaN(ue)||!Array.isArray(U))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return U=U.map(function(Ye){return he(pe(Ye))}).join(" "),ue=he(pe(ue)),Se("["+U+"] "+ue+" d"),this};var Ka=c.__private__.getLineHeight=c.getLineHeight=function(){return Kt*Dn};c.__private__.getLineHeight=c.getLineHeight=function(){return Kt*Dn};var Ro=c.__private__.setLineHeightFactor=c.setLineHeightFactor=function(U){return typeof(U=U||1.15)=="number"&&(Dn=U),this},Ts=c.__private__.getLineHeightFactor=c.getLineHeightFactor=function(){return Dn};Ro(M.lineHeight);var Js=c.__private__.getHorizontalCoordinate=function(U){return pe(U)},us=c.__private__.getVerticalCoordinate=function(U){return B===L.ADVANCED?U:$e[ce].mediaBox.topRightY-$e[ce].mediaBox.bottomLeftY-pe(U)},Qs=c.__private__.getHorizontalCoordinateString=c.getHorizontalCoordinateString=function(U){return he(Js(U))},Ms=c.__private__.getVerticalCoordinateString=c.getVerticalCoordinateString=function(U){return he(us(U))},Tn=M.strokeColor||"0 G";c.__private__.getStrokeColor=c.getDrawColor=function(){return Sr(Tn)},c.__private__.setStrokeColor=c.setDrawColor=function(U,ue,Ye,pt){return Tn=un({ch1:U,ch2:ue,ch3:Ye,ch4:pt,pdfColorType:"draw",precision:2}),Se(Tn),this};var ta=M.fillColor||"0 g";c.__private__.getFillColor=c.getFillColor=function(){return Sr(ta)},c.__private__.setFillColor=c.setFillColor=function(U,ue,Ye,pt){return ta=un({ch1:U,ch2:ue,ch3:Ye,ch4:pt,pdfColorType:"fill",precision:2}),Se(ta),this};var Ls=M.textColor||"0 g",_a=c.__private__.getTextColor=c.getTextColor=function(){return Sr(Ls)};c.__private__.setTextColor=c.setTextColor=function(U,ue,Ye,pt){return Ls=un({ch1:U,ch2:ue,ch3:Ye,ch4:pt,pdfColorType:"text",precision:3}),this};var ya=M.charSpace,Ja=c.__private__.getCharSpace=c.getCharSpace=function(){return parseFloat(ya||0)};c.__private__.setCharSpace=c.setCharSpace=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ya=U,this};var va=0;c.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},c.__private__.setLineCap=c.setLineCap=function(U){var ue=c.CapJoinStyles[U];if(ue===void 0)throw new Error("Line cap style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return va=ue,Se(ue+" J"),this};var xa=0;c.__private__.setLineJoin=c.setLineJoin=function(U){var ue=c.CapJoinStyles[U];if(ue===void 0)throw new Error("Line join style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return xa=ue,Se(ue+" j"),this},c.__private__.setLineMiterLimit=c.__private__.setMiterLimit=c.setLineMiterLimit=c.setMiterLimit=function(U){if(U=U||0,isNaN(U))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Se(he(pe(U))+" M"),this},c.GState=Bu,c.setGState=function(U){(U=typeof U=="string"?oe[fe[U]]:Bo(null,U)).equals(Ve)||(Se("/"+U.id+" gs"),Ve=U)};var Bo=function(U,ue){if(!U||!fe[U]){var Ye=!1;for(var pt in oe)if(oe.hasOwnProperty(pt)&&oe[pt].equals(ue)){Ye=!0;break}if(Ye)ue=oe[pt];else{var It="GS"+(Object.keys(oe).length+1).toString(10);oe[It]=ue,ue.id=It}return U&&(fe[U]=ue.id),dt.publish("addGState",ue),ue}};c.addGState=function(U,ue){return Bo(U,ue),this},c.saveGraphicsState=function(){return Se("q"),qr.push({key:si,size:Kt,color:Ls}),this},c.restoreGraphicsState=function(){Se("Q");var U=qr.pop();return si=U.key,Kt=U.size,Ls=U.color,Ve=null,this},c.setCurrentTransformationMatrix=function(U){return Se(U.toString()+" cm"),this},c.comment=function(U){return Se("#"+U),this};var mr=function(U,ue){var Ye=U||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ye},set:function(Zt){isNaN(Zt)||(Ye=parseFloat(Zt))}});var pt=ue||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return pt},set:function(Zt){isNaN(Zt)||(pt=parseFloat(Zt))}});var It="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return It},set:function(Zt){It=Zt.toString()}}),this},Il=function(U,ue,Ye,pt){mr.call(this,U,ue),this.type="rect";var It=Ye||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return It},set:function(pi){isNaN(pi)||(It=parseFloat(pi))}});var Zt=pt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Zt},set:function(pi){isNaN(pi)||(Zt=parseFloat(pi))}}),this},ba=function(){this.page=Ke,this.currentPage=ce,this.pages=lt.slice(0),this.pagesContext=$e.slice(0),this.x=Ii,this.y=wi,this.matrix=or,this.width=No(ce),this.height=eo(ce),this.outputDestination=ht,this.id="",this.objectNumber=-1};ba.prototype.restore=function(){Ke=this.page,ce=this.currentPage,$e=this.pagesContext,lt=this.pages,Ii=this.x,wi=this.y,or=this.matrix,mo(ce,this.width),go(ce,this.height),ht=this.outputDestination};var kl=function(U,ue,Ye,pt,It){ti.push(new ba),Ke=ce=0,lt=[],Ii=U,wi=ue,or=It,tn([Ye,pt])},Dl=function(U){if(Dt[U])ti.pop().restore();else{var ue=new ba,Ye="Xo"+(Object.keys(st).length+1).toString(10);ue.id=Ye,Dt[U]=Ye,st[Ye]=ue,dt.publish("addFormObject",ue),ti.pop().restore()}};for(var wa in c.beginFormObject=function(U,ue,Ye,pt,It){return kl(U,ue,Ye,pt,It),this},c.endFormObject=function(U){return Dl(U),this},c.doFormObject=function(U,ue){var Ye=st[Dt[U]];return Se("q"),Se(ue.toString()+" cm"),Se("/"+Ye.id+" Do"),Se("Q"),this},c.getFormObject=function(U){var ue=st[Dt[U]];return{x:ue.x,y:ue.y,width:ue.width,height:ue.height,matrix:ue.matrix}},c.save=function(U,ue){return U=U||"generated.pdf",(ue=ue||{}).returnPromise=ue.returnPromise||!1,ue.returnPromise===!1?(Kc(Ss(es()),U),typeof Kc.unload=="function"&&cr.setTimeout&&setTimeout(Kc.unload,911),this):new Promise(function(Ye,pt){try{var It=Kc(Ss(es()),U);typeof Kc.unload=="function"&&cr.setTimeout&&setTimeout(Kc.unload,911),Ye(It)}catch(Zt){pt(Zt.message)}})},tr.API)tr.API.hasOwnProperty(wa)&&(wa==="events"&&tr.API.events.length?function(U,ue){var Ye,pt,It;for(It=ue.length-1;It!==-1;It--)Ye=ue[It][0],pt=ue[It][1],U.subscribe.apply(U,[Ye].concat(typeof pt=="function"?[pt]:pt))}(dt,tr.API.events):c[wa]=tr.API[wa]);var No=c.getPageWidth=function(U){return($e[U=U||ce].mediaBox.topRightX-$e[U].mediaBox.bottomLeftX)/jt},mo=c.setPageWidth=function(U,ue){$e[U].mediaBox.topRightX=ue*jt+$e[U].mediaBox.bottomLeftX},eo=c.getPageHeight=function(U){return($e[U=U||ce].mediaBox.topRightY-$e[U].mediaBox.bottomLeftY)/jt},go=c.setPageHeight=function(U,ue){$e[U].mediaBox.topRightY=ue*jt+$e[U].mediaBox.bottomLeftY};return c.internal={pdfEscape:ji,getStyle:ar,getFont:zo,getFontSize:yt,getCharSpace:Ja,getTextColor:_a,getLineHeight:Ka,getLineHeightFactor:Ts,getLineWidth:Ps,write:At,getHorizontalCoordinate:Js,getVerticalCoordinate:us,getCoordinateString:Qs,getVerticalCoordinateString:Ms,collections:{},newObject:ki,newAdditionalObject:Ar,newObjectDeferred:Fi,newObjectDeferredBegin:Wi,getFilters:Or,putStream:Fr,events:dt,scaleFactor:jt,pageSize:{getWidth:function(){return No(ce)},setWidth:function(U){mo(ce,U)},getHeight:function(){return eo(ce)},setHeight:function(U){go(ce,U)}},encryptionOptions:x,encryption:Lt,getEncryptor:li,output:it,getNumberOfPages:Oo,pages:lt,out:Se,f2:ot,f3:_e,getPageInfo:_i,getPageInfoByObjId:Yt,getCurrentPageInfo:Mi,getPDFVersion:w,Point:mr,Rectangle:Il,Matrix:Vt,hasHotfix:vt},Object.defineProperty(c.internal.pageSize,"width",{get:function(){return No(ce)},set:function(U){mo(ce,U)},enumerable:!0,configurable:!0}),Object.defineProperty(c.internal.pageSize,"height",{get:function(){return eo(ce)},set:function(U){go(ce,U)},enumerable:!0,configurable:!0}),Ks.call(c,wt),si="F1",Nn(R,A),dt.publish("initialized"),c}Rh.prototype.lsbFirstWord=function(M){return String.fromCharCode(M>>0&255,M>>8&255,M>>16&255,M>>24&255)},Rh.prototype.toHexString=function(M){return M.split("").map(function(f){return("0"+(255&f.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Rh.prototype.hexToBytes=function(M){for(var f=[],A=0;A<M.length;A+=2)f.push(String.fromCharCode(parseInt(M.substr(A,2),16)));return f.join("")},Rh.prototype.processOwnerPassword=function(M,f){return lp(ap(f).substr(0,5),M)},Rh.prototype.encryptor=function(M,f){var A=ap(this.encryptionKey+String.fromCharCode(255&M,M>>8&255,M>>16&255,255&f,f>>8&255)).substr(0,10);return function(D){return lp(A,D)}},Bu.prototype.equals=function(M){var f,A="id,objectNumber,equals";if(!M||rn(M)!==rn(this))return!1;var D=0;for(f in this)if(!(A.indexOf(f)>=0)){if(this.hasOwnProperty(f)&&!M.hasOwnProperty(f)||this[f]!==M[f])return!1;D++}for(f in M)M.hasOwnProperty(f)&&A.indexOf(f)<0&&D--;return D===0},tr.API={events:[]},tr.version="2.5.1";var Rn=tr.API,xp=1,sh=function(M){return M.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Oh=function(M){return M.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},dr=function(M){return M.toFixed(2)},fc=function(M){return M.toFixed(5)};Rn.__acroform__={};var Lo=function(M,f){M.prototype=Object.create(f.prototype),M.prototype.constructor=M},o_=function(M){return M*xp},Al=function(M){var f=new D_,A=Ni.internal.getHeight(M)||0,D=Ni.internal.getWidth(M)||0;return f.BBox=[0,0,Number(dr(D)),Number(dr(A))],f},B1=Rn.__acroform__.setBit=function(M,f){if(M=M||0,f=f||0,isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return M|=1<<f},N1=Rn.__acroform__.clearBit=function(M,f){if(M=M||0,f=f||0,isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return M&=~(1<<f)},j1=Rn.__acroform__.getBit=function(M,f){if(isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return M&1<<f?1:0},Un=Rn.__acroform__.getBitForPdf=function(M,f){if(isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return j1(M,f-1)},Vn=Rn.__acroform__.setBitForPdf=function(M,f){if(isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return B1(M,f-1)},qn=Rn.__acroform__.clearBitForPdf=function(M,f){if(isNaN(M)||isNaN(f))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return N1(M,f-1)},U1=Rn.__acroform__.calculateCoordinates=function(M,f){var A=f.internal.getHorizontalCoordinate,D=f.internal.getVerticalCoordinate,R=M[0],z=M[1],V=M[2],t=M[3],l={};return l.lowerLeft_X=A(R)||0,l.lowerLeft_Y=D(z+t)||0,l.upperRight_X=A(R+V)||0,l.upperRight_Y=D(z)||0,[Number(dr(l.lowerLeft_X)),Number(dr(l.lowerLeft_Y)),Number(dr(l.upperRight_X)),Number(dr(l.upperRight_Y))]},V1=function(M){if(M.appearanceStreamContent)return M.appearanceStreamContent;if(M.V||M.DV){var f=[],A=M._V||M.DV,D=cp(M,A),R=M.scope.internal.getFont(M.fontName,M.fontStyle).id;f.push("/Tx BMC"),f.push("q"),f.push("BT"),f.push(M.scope.__private__.encodeColorString(M.color)),f.push("/"+R+" "+dr(D.fontSize)+" Tf"),f.push("1 0 0 1 0 0 Tm"),f.push(D.text),f.push("ET"),f.push("Q"),f.push("EMC");var z=Al(M);return z.scope=M.scope,z.stream=f.join(`
`),z}},cp=function(M,f){var A=M.fontSize===0?M.maxFontSize:M.fontSize,D={text:"",fontSize:""},R=(f=(f=f.substr(0,1)=="("?f.substr(1):f).substr(f.length-1)==")"?f.substr(0,f.length-1):f).split(" ");R=M.multiline?R.map(function(_e){return _e.split(`
`)}):R.map(function(_e){return[_e]});var z=A,V=Ni.internal.getHeight(M)||0;V=V<0?-V:V;var t=Ni.internal.getWidth(M)||0;t=t<0?-t:t;var l=function(_e,pe,ze){if(_e+1<R.length){var De=pe+" "+R[_e+1][0];return Tf(De,M,ze).width<=t-4}return!1};z++;e:for(;z>0;){f="",z--;var v,x,d=Tf("3",M,z).height,m=M.multiline?V-z:(V-d)/2,c=m+=2,_=0,w=0,g=0;if(z<=0){f=`(...) Tj
`,f+="% Width of Text: "+Tf(f,M,z=12).width+", FieldWidth:"+t+`
`;break}for(var C="",L=0,B=0;B<R.length;B++)if(R.hasOwnProperty(B)){var q=!1;if(R[B].length!==1&&g!==R[B].length-1){if((d+2)*(L+2)+2>V)continue e;C+=R[B][g],q=!0,w=B,B--}else{C=(C+=R[B][g]+" ").substr(C.length-1)==" "?C.substr(0,C.length-1):C;var K=parseInt(B),se=l(K,C,z),he=B>=R.length-1;if(se&&!he){C+=" ",g=0;continue}if(se||he){if(he)w=K;else if(M.multiline&&(d+2)*(L+2)+2>V)continue e}else{if(!M.multiline||(d+2)*(L+2)+2>V)continue e;w=K}}for(var le="",ve=_;ve<=w;ve++){var ot=R[ve];if(M.multiline){if(ve===w){le+=ot[g]+" ",g=(g+1)%ot.length;continue}if(ve===_){le+=ot[ot.length-1]+" ";continue}}le+=ot[0]+" "}switch(le=le.substr(le.length-1)==" "?le.substr(0,le.length-1):le,x=Tf(le,M,z).width,M.textAlign){case"right":v=t-x-2;break;case"center":v=(t-x)/2;break;case"left":default:v=2}f+=dr(v)+" "+dr(c)+` Td
`,f+="("+sh(le)+`) Tj
`,f+=-dr(v)+` 0 Td
`,c=-(z+2),x=0,_=q?w:w+1,L++,C=""}break}return D.text=f,D.fontSize=z,D},Tf=function(M,f,A){var D=f.scope.internal.getFont(f.fontName,f.fontStyle),R=f.scope.getStringUnitWidth(M,{font:D,fontSize:parseFloat(A),charSpace:0})*parseFloat(A);return{height:f.scope.getStringUnitWidth("3",{font:D,fontSize:parseFloat(A),charSpace:0})*parseFloat(A)*1.5,width:R}},q1={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},G1=function(M,f){var A={type:"reference",object:M};f.internal.getPageInfo(M.page).pageContext.annotations.find(function(D){return D.type===A.type&&D.object===A.object})===void 0&&f.internal.getPageInfo(M.page).pageContext.annotations.push(A)},W1=function(M,f){for(var A in M)if(M.hasOwnProperty(A)){var D=A,R=M[A];f.internal.newObjectDeferredBegin(R.objId,!0),rn(R)==="object"&&typeof R.putStream=="function"&&R.putStream(),delete M[D]}},X1=function(M,f){if(f.scope=M,M.internal!==void 0&&(M.internal.acroformPlugin===void 0||M.internal.acroformPlugin.isInitialized===!1)){if(Ya.FieldNum=0,M.internal.acroformPlugin=JSON.parse(JSON.stringify(q1)),M.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");xp=M.internal.scaleFactor,M.internal.acroformPlugin.acroFormDictionaryRoot=new O_,M.internal.acroformPlugin.acroFormDictionaryRoot.scope=M,M.internal.acroformPlugin.acroFormDictionaryRoot._eventID=M.internal.events.subscribe("postPutResources",function(){(function(A){A.internal.events.unsubscribe(A.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete A.internal.acroformPlugin.acroFormDictionaryRoot._eventID,A.internal.acroformPlugin.printedOut=!0})(M)}),M.internal.events.subscribe("buildDocument",function(){(function(A){A.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var D=A.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var R in D)if(D.hasOwnProperty(R)){var z=D[R];z.objId=void 0,z.hasAnnotation&&G1(z,A)}})(M)}),M.internal.events.subscribe("putCatalog",function(){(function(A){if(A.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");A.internal.write("/AcroForm "+A.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(M)}),M.internal.events.subscribe("postPutPages",function(A){(function(D,R){var z=!D;for(var V in D||(R.internal.newObjectDeferredBegin(R.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),R.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),D=D||R.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(D.hasOwnProperty(V)){var t=D[V],l=[],v=t.Rect;if(t.Rect&&(t.Rect=U1(t.Rect,R)),R.internal.newObjectDeferredBegin(t.objId,!0),t.DA=Ni.createDefaultAppearanceStream(t),rn(t)==="object"&&typeof t.getKeyValueListForStream=="function"&&(l=t.getKeyValueListForStream()),t.Rect=v,t.hasAppearanceStream&&!t.appearanceStreamContent){var x=V1(t);l.push({key:"AP",value:"<</N "+x+">>"}),R.internal.acroformPlugin.xForms.push(x)}if(t.appearanceStreamContent){var d="";for(var m in t.appearanceStreamContent)if(t.appearanceStreamContent.hasOwnProperty(m)){var c=t.appearanceStreamContent[m];if(d+="/"+m+" ",d+="<<",Object.keys(c).length>=1||Array.isArray(c)){for(var V in c)if(c.hasOwnProperty(V)){var _=c[V];typeof _=="function"&&(_=_.call(R,t)),d+="/"+V+" "+_+" ",R.internal.acroformPlugin.xForms.indexOf(_)>=0||R.internal.acroformPlugin.xForms.push(_)}}else typeof(_=c)=="function"&&(_=_.call(R,t)),d+="/"+V+" "+_,R.internal.acroformPlugin.xForms.indexOf(_)>=0||R.internal.acroformPlugin.xForms.push(_);d+=">>"}l.push({key:"AP",value:`<<
`+d+">>"})}R.internal.putStream({additionalKeyValues:l,objectId:t.objId}),R.internal.out("endobj")}z&&W1(R.internal.acroformPlugin.xForms,R)})(A,M)}),M.internal.acroformPlugin.isInitialized=!0}},k_=Rn.__acroform__.arrayToPdfArray=function(M,f,A){var D=function(V){return V};if(Array.isArray(M)){for(var R="[",z=0;z<M.length;z++)switch(z!==0&&(R+=" "),rn(M[z])){case"boolean":case"number":case"object":R+=M[z].toString();break;case"string":M[z].substr(0,1)!=="/"?(f!==void 0&&A&&(D=A.internal.getEncryptor(f)),R+="("+sh(D(M[z].toString()))+")"):R+=M[z].toString()}return R+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Yd=function(M,f,A){var D=function(R){return R};return f!==void 0&&A&&(D=A.internal.getEncryptor(f)),(M=M||"").toString(),M="("+sh(D(M))+")"},Pl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(M){this._objId=M}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Pl.prototype.toString=function(){return this.objId+" 0 R"},Pl.prototype.putStream=function(){var M=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:M,objectId:this.objId}),this.scope.internal.out("endobj")},Pl.prototype.getKeyValueListForStream=function(){var M=[],f=Object.getOwnPropertyNames(this).filter(function(z){return z!="content"&&z!="appearanceStreamContent"&&z!="scope"&&z!="objId"&&z.substring(0,1)!="_"});for(var A in f)if(Object.getOwnPropertyDescriptor(this,f[A]).configurable===!1){var D=f[A],R=this[D];R&&(Array.isArray(R)?M.push({key:D,value:k_(R,this.objId,this.scope)}):R instanceof Pl?(R.scope=this.scope,M.push({key:D,value:R.objId+" 0 R"})):typeof R!="function"&&M.push({key:D,value:R}))}return M};var D_=function(){Pl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var M,f=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return f},set:function(A){f=A}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(A){M=A.trim()},get:function(){return M||null}})};Lo(D_,Pl);var O_=function(){Pl.call(this);var M,f=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return f.length>0?f:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return f}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(M){var A=function(D){return D};return this.scope&&(A=this.scope.internal.getEncryptor(this.objId)),"("+sh(A(M))+")"}},set:function(A){M=A}})};Lo(O_,Pl);var Ya=function M(){Pl.call(this);var f=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return f},set:function(C){if(isNaN(C))throw new Error('Invalid value "'+C+'" for attribute F supplied.');f=C}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Un(f,3)},set:function(C){C?this.F=Vn(f,3):this.F=qn(f,3)}});var A=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return A},set:function(C){if(isNaN(C))throw new Error('Invalid value "'+C+'" for attribute Ff supplied.');A=C}});var D=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(D.length!==0)return D},set:function(C){D=C!==void 0?C:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!D||isNaN(D[0])?0:D[0]},set:function(C){D[0]=C}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!D||isNaN(D[1])?0:D[1]},set:function(C){D[1]=C}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!D||isNaN(D[2])?0:D[2]},set:function(C){D[2]=C}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!D||isNaN(D[3])?0:D[3]},set:function(C){D[3]=C}});var R="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return R},set:function(C){switch(C){case"/Btn":case"/Tx":case"/Ch":case"/Sig":R=C;break;default:throw new Error('Invalid value "'+C+'" for attribute FT supplied.')}}});var z=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!z||z.length<1){if(this instanceof Pf)return;z="FieldObject"+M.FieldNum++}var C=function(L){return L};return this.scope&&(C=this.scope.internal.getEncryptor(this.objId)),"("+sh(C(z))+")"},set:function(C){z=C.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return z},set:function(C){z=C}});var V="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return V},set:function(C){V=C}});var t="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return t},set:function(C){t=C}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(C){l=C}});var v=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return v===void 0?50/xp:v},set:function(C){v=C}});var x="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return x},set:function(C){x=C}});var d="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!d||this instanceof Pf||this instanceof mc))return Yd(d,this.objId,this.scope)},set:function(C){C=C.toString(),d=C}});var m=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof ls?m:Yd(m,this.objId,this.scope)},set:function(C){C=C.toString(),m=this instanceof ls?C:C.substr(0,1)==="("?Oh(C.substr(1,C.length-2)):Oh(C)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ls?Oh(m.substr(1,m.length-1)):m},set:function(C){C=C.toString(),m=this instanceof ls?"/"+C:C}});var c=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(c)return c},set:function(C){this.V=C}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(c)return this instanceof ls?c:Yd(c,this.objId,this.scope)},set:function(C){C=C.toString(),c=this instanceof ls?C:C.substr(0,1)==="("?Oh(C.substr(1,C.length-2)):Oh(C)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ls?Oh(c.substr(1,c.length-1)):c},set:function(C){C=C.toString(),c=this instanceof ls?"/"+C:C}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var _,w=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return w},set:function(C){C=!!C,w=C}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(_)return _},set:function(C){_=C}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,1)},set:function(C){C?this.Ff=Vn(this.Ff,1):this.Ff=qn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,2)},set:function(C){C?this.Ff=Vn(this.Ff,2):this.Ff=qn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,3)},set:function(C){C?this.Ff=Vn(this.Ff,3):this.Ff=qn(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(g!==null)return g},set:function(C){if([0,1,2].indexOf(C)===-1)throw new Error('Invalid value "'+C+'" for attribute Q supplied.');g=C}}),Object.defineProperty(this,"textAlign",{get:function(){var C;switch(g){case 0:default:C="left";break;case 1:C="center";break;case 2:C="right"}return C},configurable:!0,enumerable:!0,set:function(C){switch(C){case"right":case 2:g=2;break;case"center":case 1:g=1;break;case"left":case 0:default:g=0}}})};Lo(Ya,Pl);var th=function(){Ya.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var M=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return M},set:function(A){M=A}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return M},set:function(A){M=A}});var f=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return k_(f,this.objId,this.scope)},set:function(A){var D,R;R=[],typeof(D=A)=="string"&&(R=function(z,V,t){t||(t=1);for(var l,v=[];l=V.exec(z);)v.push(l[t]);return v}(D,/\((.*?)\)/g)),f=R}}),this.getOptions=function(){return f},this.setOptions=function(A){f=A,this.sort&&f.sort()},this.addOption=function(A){A=(A=A||"").toString(),f.push(A),this.sort&&f.sort()},this.removeOption=function(A,D){for(D=D||!1,A=(A=A||"").toString();f.indexOf(A)!==-1&&(f.splice(f.indexOf(A),1),D!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,18)},set:function(A){A?this.Ff=Vn(this.Ff,18):this.Ff=qn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,19)},set:function(A){this.combo===!0&&(A?this.Ff=Vn(this.Ff,19):this.Ff=qn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,20)},set:function(A){A?(this.Ff=Vn(this.Ff,20),f.sort()):this.Ff=qn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,22)},set:function(A){A?this.Ff=Vn(this.Ff,22):this.Ff=qn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,23)},set:function(A){A?this.Ff=Vn(this.Ff,23):this.Ff=qn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,27)},set:function(A){A?this.Ff=Vn(this.Ff,27):this.Ff=qn(this.Ff,27)}}),this.hasAppearanceStream=!1};Lo(th,Ya);var ih=function(){th.call(this),this.fontName="helvetica",this.combo=!1};Lo(ih,th);var rh=function(){ih.call(this),this.combo=!0};Lo(rh,ih);var ku=function(){rh.call(this),this.edit=!0};Lo(ku,rh);var ls=function(){Ya.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,15)},set:function(A){A?this.Ff=Vn(this.Ff,15):this.Ff=qn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,16)},set:function(A){A?this.Ff=Vn(this.Ff,16):this.Ff=qn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,17)},set:function(A){A?this.Ff=Vn(this.Ff,17):this.Ff=qn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,26)},set:function(A){A?this.Ff=Vn(this.Ff,26):this.Ff=qn(this.Ff,26)}});var M,f={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var A=function(z){return z};if(this.scope&&(A=this.scope.internal.getEncryptor(this.objId)),Object.keys(f).length!==0){var D,R=[];for(D in R.push("<<"),f)R.push("/"+D+" ("+sh(A(f[D]))+")");return R.push(">>"),R.join(`
`)}},set:function(A){rn(A)==="object"&&(f=A)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return f.CA||""},set:function(A){typeof A=="string"&&(f.CA=A)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return M},set:function(A){M=A}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return M.substr(1,M.length-1)},set:function(A){M="/"+A}})};Lo(ls,Ya);var Du=function(){ls.call(this),this.pushButton=!0};Lo(Du,ls);var nh=function(){ls.call(this),this.radio=!0,this.pushButton=!1;var M=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return M},set:function(f){M=f!==void 0?f:[]}})};Lo(nh,ls);var Pf=function(){var M,f;Ya.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return M},set:function(R){M=R}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return f},set:function(R){f=R}});var A,D={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var R=function(t){return t};this.scope&&(R=this.scope.internal.getEncryptor(this.objId));var z,V=[];for(z in V.push("<<"),D)V.push("/"+z+" ("+sh(R(D[z]))+")");return V.push(">>"),V.join(`
`)},set:function(R){rn(R)==="object"&&(D=R)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return D.CA||""},set:function(R){typeof R=="string"&&(D.CA=R)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return A},set:function(R){A=R}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return A.substr(1,A.length-1)},set:function(R){A="/"+R}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ni.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Lo(Pf,Ya),nh.prototype.setAppearance=function(M){if(!("createAppearanceStream"in M)||!("getCA"in M))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var f in this.Kids)if(this.Kids.hasOwnProperty(f)){var A=this.Kids[f];A.appearanceStreamContent=M.createAppearanceStream(A.optionName),A.caption=M.getCA()}},nh.prototype.createOption=function(M){var f=new Pf;return f.Parent=this,f.optionName=M,this.Kids.push(f),H1.call(this.scope,f),f};var Ou=function(){ls.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ni.CheckBox.createAppearanceStream()};Lo(Ou,ls);var mc=function(){Ya.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,13)},set:function(f){f?this.Ff=Vn(this.Ff,13):this.Ff=qn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,21)},set:function(f){f?this.Ff=Vn(this.Ff,21):this.Ff=qn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,23)},set:function(f){f?this.Ff=Vn(this.Ff,23):this.Ff=qn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,24)},set:function(f){f?this.Ff=Vn(this.Ff,24):this.Ff=qn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,25)},set:function(f){f?this.Ff=Vn(this.Ff,25):this.Ff=qn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,26)},set:function(f){f?this.Ff=Vn(this.Ff,26):this.Ff=qn(this.Ff,26)}});var M=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return M},set:function(f){M=f}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return M},set:function(f){Number.isInteger(f)&&(M=f)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Lo(mc,Ya);var Fu=function(){mc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Un(this.Ff,14)},set:function(M){M?this.Ff=Vn(this.Ff,14):this.Ff=qn(this.Ff,14)}}),this.password=!0};Lo(Fu,mc);var Ni={CheckBox:{createAppearanceStream:function(){return{N:{On:Ni.CheckBox.YesNormal},D:{On:Ni.CheckBox.YesPushDown,Off:Ni.CheckBox.OffPushDown}}},YesPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=[],D=M.scope.internal.getFont(M.fontName,M.fontStyle).id,R=M.scope.__private__.encodeColorString(M.color),z=cp(M,M.caption);return A.push("0.749023 g"),A.push("0 0 "+dr(Ni.internal.getWidth(M))+" "+dr(Ni.internal.getHeight(M))+" re"),A.push("f"),A.push("BMC"),A.push("q"),A.push("0 0 1 rg"),A.push("/"+D+" "+dr(z.fontSize)+" Tf "+R),A.push("BT"),A.push(z.text),A.push("ET"),A.push("Q"),A.push("EMC"),f.stream=A.join(`
`),f},YesNormal:function(M){var f=Al(M);f.scope=M.scope;var A=M.scope.internal.getFont(M.fontName,M.fontStyle).id,D=M.scope.__private__.encodeColorString(M.color),R=[],z=Ni.internal.getHeight(M),V=Ni.internal.getWidth(M),t=cp(M,M.caption);return R.push("1 g"),R.push("0 0 "+dr(V)+" "+dr(z)+" re"),R.push("f"),R.push("q"),R.push("0 0 1 rg"),R.push("0 0 "+dr(V-1)+" "+dr(z-1)+" re"),R.push("W"),R.push("n"),R.push("0 g"),R.push("BT"),R.push("/"+A+" "+dr(t.fontSize)+" Tf "+D),R.push(t.text),R.push("ET"),R.push("Q"),f.stream=R.join(`
`),f},OffPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=[];return A.push("0.749023 g"),A.push("0 0 "+dr(Ni.internal.getWidth(M))+" "+dr(Ni.internal.getHeight(M))+" re"),A.push("f"),f.stream=A.join(`
`),f}},RadioButton:{Circle:{createAppearanceStream:function(M){var f={D:{Off:Ni.RadioButton.Circle.OffPushDown},N:{}};return f.N[M]=Ni.RadioButton.Circle.YesNormal,f.D[M]=Ni.RadioButton.Circle.YesPushDown,f},getCA:function(){return"l"},YesNormal:function(M){var f=Al(M);f.scope=M.scope;var A=[],D=Ni.internal.getWidth(M)<=Ni.internal.getHeight(M)?Ni.internal.getWidth(M)/4:Ni.internal.getHeight(M)/4;D=Number((.9*D).toFixed(5));var R=Ni.internal.Bezier_C,z=Number((D*R).toFixed(5));return A.push("q"),A.push("1 0 0 1 "+fc(Ni.internal.getWidth(M)/2)+" "+fc(Ni.internal.getHeight(M)/2)+" cm"),A.push(D+" 0 m"),A.push(D+" "+z+" "+z+" "+D+" 0 "+D+" c"),A.push("-"+z+" "+D+" -"+D+" "+z+" -"+D+" 0 c"),A.push("-"+D+" -"+z+" -"+z+" -"+D+" 0 -"+D+" c"),A.push(z+" -"+D+" "+D+" -"+z+" "+D+" 0 c"),A.push("f"),A.push("Q"),f.stream=A.join(`
`),f},YesPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=[],D=Ni.internal.getWidth(M)<=Ni.internal.getHeight(M)?Ni.internal.getWidth(M)/4:Ni.internal.getHeight(M)/4;D=Number((.9*D).toFixed(5));var R=Number((2*D).toFixed(5)),z=Number((R*Ni.internal.Bezier_C).toFixed(5)),V=Number((D*Ni.internal.Bezier_C).toFixed(5));return A.push("0.749023 g"),A.push("q"),A.push("1 0 0 1 "+fc(Ni.internal.getWidth(M)/2)+" "+fc(Ni.internal.getHeight(M)/2)+" cm"),A.push(R+" 0 m"),A.push(R+" "+z+" "+z+" "+R+" 0 "+R+" c"),A.push("-"+z+" "+R+" -"+R+" "+z+" -"+R+" 0 c"),A.push("-"+R+" -"+z+" -"+z+" -"+R+" 0 -"+R+" c"),A.push(z+" -"+R+" "+R+" -"+z+" "+R+" 0 c"),A.push("f"),A.push("Q"),A.push("0 g"),A.push("q"),A.push("1 0 0 1 "+fc(Ni.internal.getWidth(M)/2)+" "+fc(Ni.internal.getHeight(M)/2)+" cm"),A.push(D+" 0 m"),A.push(D+" "+V+" "+V+" "+D+" 0 "+D+" c"),A.push("-"+V+" "+D+" -"+D+" "+V+" -"+D+" 0 c"),A.push("-"+D+" -"+V+" -"+V+" -"+D+" 0 -"+D+" c"),A.push(V+" -"+D+" "+D+" -"+V+" "+D+" 0 c"),A.push("f"),A.push("Q"),f.stream=A.join(`
`),f},OffPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=[],D=Ni.internal.getWidth(M)<=Ni.internal.getHeight(M)?Ni.internal.getWidth(M)/4:Ni.internal.getHeight(M)/4;D=Number((.9*D).toFixed(5));var R=Number((2*D).toFixed(5)),z=Number((R*Ni.internal.Bezier_C).toFixed(5));return A.push("0.749023 g"),A.push("q"),A.push("1 0 0 1 "+fc(Ni.internal.getWidth(M)/2)+" "+fc(Ni.internal.getHeight(M)/2)+" cm"),A.push(R+" 0 m"),A.push(R+" "+z+" "+z+" "+R+" 0 "+R+" c"),A.push("-"+z+" "+R+" -"+R+" "+z+" -"+R+" 0 c"),A.push("-"+R+" -"+z+" -"+z+" -"+R+" 0 -"+R+" c"),A.push(z+" -"+R+" "+R+" -"+z+" "+R+" 0 c"),A.push("f"),A.push("Q"),f.stream=A.join(`
`),f}},Cross:{createAppearanceStream:function(M){var f={D:{Off:Ni.RadioButton.Cross.OffPushDown},N:{}};return f.N[M]=Ni.RadioButton.Cross.YesNormal,f.D[M]=Ni.RadioButton.Cross.YesPushDown,f},getCA:function(){return"8"},YesNormal:function(M){var f=Al(M);f.scope=M.scope;var A=[],D=Ni.internal.calculateCross(M);return A.push("q"),A.push("1 1 "+dr(Ni.internal.getWidth(M)-2)+" "+dr(Ni.internal.getHeight(M)-2)+" re"),A.push("W"),A.push("n"),A.push(dr(D.x1.x)+" "+dr(D.x1.y)+" m"),A.push(dr(D.x2.x)+" "+dr(D.x2.y)+" l"),A.push(dr(D.x4.x)+" "+dr(D.x4.y)+" m"),A.push(dr(D.x3.x)+" "+dr(D.x3.y)+" l"),A.push("s"),A.push("Q"),f.stream=A.join(`
`),f},YesPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=Ni.internal.calculateCross(M),D=[];return D.push("0.749023 g"),D.push("0 0 "+dr(Ni.internal.getWidth(M))+" "+dr(Ni.internal.getHeight(M))+" re"),D.push("f"),D.push("q"),D.push("1 1 "+dr(Ni.internal.getWidth(M)-2)+" "+dr(Ni.internal.getHeight(M)-2)+" re"),D.push("W"),D.push("n"),D.push(dr(A.x1.x)+" "+dr(A.x1.y)+" m"),D.push(dr(A.x2.x)+" "+dr(A.x2.y)+" l"),D.push(dr(A.x4.x)+" "+dr(A.x4.y)+" m"),D.push(dr(A.x3.x)+" "+dr(A.x3.y)+" l"),D.push("s"),D.push("Q"),f.stream=D.join(`
`),f},OffPushDown:function(M){var f=Al(M);f.scope=M.scope;var A=[];return A.push("0.749023 g"),A.push("0 0 "+dr(Ni.internal.getWidth(M))+" "+dr(Ni.internal.getHeight(M))+" re"),A.push("f"),f.stream=A.join(`
`),f}}},createDefaultAppearanceStream:function(M){var f=M.scope.internal.getFont(M.fontName,M.fontStyle).id,A=M.scope.__private__.encodeColorString(M.color);return"/"+f+" "+M.fontSize+" Tf "+A}};Ni.internal={Bezier_C:.551915024494,calculateCross:function(M){var f=Ni.internal.getWidth(M),A=Ni.internal.getHeight(M),D=Math.min(f,A);return{x1:{x:(f-D)/2,y:(A-D)/2+D},x2:{x:(f-D)/2+D,y:(A-D)/2},x3:{x:(f-D)/2,y:(A-D)/2},x4:{x:(f-D)/2+D,y:(A-D)/2+D}}}},Ni.internal.getWidth=function(M){var f=0;return rn(M)==="object"&&(f=o_(M.Rect[2])),f},Ni.internal.getHeight=function(M){var f=0;return rn(M)==="object"&&(f=o_(M.Rect[3])),f};var H1=Rn.addField=function(M){if(X1(this,M),!(M instanceof Ya))throw new Error("Invalid argument passed to jsPDF.addField.");var f;return(f=M).scope.internal.acroformPlugin.printedOut&&(f.scope.internal.acroformPlugin.printedOut=!1,f.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),f.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(f),M.page=M.scope.internal.getCurrentPageInfo().pageNumber,this};Rn.AcroFormChoiceField=th,Rn.AcroFormListBox=ih,Rn.AcroFormComboBox=rh,Rn.AcroFormEditBox=ku,Rn.AcroFormButton=ls,Rn.AcroFormPushButton=Du,Rn.AcroFormRadioButton=nh,Rn.AcroFormCheckBox=Ou,Rn.AcroFormTextField=mc,Rn.AcroFormPasswordField=Fu,Rn.AcroFormAppearance=Ni,Rn.AcroForm={ChoiceField:th,ListBox:ih,ComboBox:rh,EditBox:ku,Button:ls,PushButton:Du,RadioButton:nh,CheckBox:Ou,TextField:mc,PasswordField:Fu,Appearance:Ni},tr.AcroForm={ChoiceField:th,ListBox:ih,ComboBox:rh,EditBox:ku,Button:ls,PushButton:Du,RadioButton:nh,CheckBox:Ou,TextField:mc,PasswordField:Fu,Appearance:Ni};var $1=tr.AcroForm;function F_(M){return M.reduce(function(f,A,D){return f[A]=D,f},{})}(function(M){M.__addimage__={};var f="UNKNOWN",A={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},D=M.__addimage__.getImageFileTypeByImageData=function(_e,pe){var ze,De,at,ft,xt,He=f;if((pe=pe||f)==="RGBA"||_e.data!==void 0&&_e.data instanceof Uint8ClampedArray&&"height"in _e&&"width"in _e)return"RGBA";if(se(_e))for(xt in A)for(at=A[xt],ze=0;ze<at.length;ze+=1){for(ft=!0,De=0;De<at[ze].length;De+=1)if(at[ze][De]!==void 0&&at[ze][De]!==_e[De]){ft=!1;break}if(ft===!0){He=xt;break}}else for(xt in A)for(at=A[xt],ze=0;ze<at.length;ze+=1){for(ft=!0,De=0;De<at[ze].length;De+=1)if(at[ze][De]!==void 0&&at[ze][De]!==_e.charCodeAt(De)){ft=!1;break}if(ft===!0){He=xt;break}}return He===f&&pe!==f&&(He=pe),He},R=function _e(pe){for(var ze=this.internal.write,De=this.internal.putStream,at=(0,this.internal.getFilters)();at.indexOf("FlateEncode")!==-1;)at.splice(at.indexOf("FlateEncode"),1);pe.objectId=this.internal.newObject();var ft=[];if(ft.push({key:"Type",value:"/XObject"}),ft.push({key:"Subtype",value:"/Image"}),ft.push({key:"Width",value:pe.width}),ft.push({key:"Height",value:pe.height}),pe.colorSpace===g.INDEXED?ft.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(pe.palette.length/3-1)+" "+("sMask"in pe&&pe.sMask!==void 0?pe.objectId+2:pe.objectId+1)+" 0 R]"}):(ft.push({key:"ColorSpace",value:"/"+pe.colorSpace}),pe.colorSpace===g.DEVICE_CMYK&&ft.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ft.push({key:"BitsPerComponent",value:pe.bitsPerComponent}),"decodeParameters"in pe&&pe.decodeParameters!==void 0&&ft.push({key:"DecodeParms",value:"<<"+pe.decodeParameters+">>"}),"transparency"in pe&&Array.isArray(pe.transparency)){for(var xt="",He=0,ae=pe.transparency.length;He<ae;He++)xt+=pe.transparency[He]+" "+pe.transparency[He]+" ";ft.push({key:"Mask",value:"["+xt+"]"})}pe.sMask!==void 0&&ft.push({key:"SMask",value:pe.objectId+1+" 0 R"});var Te=pe.filter!==void 0?["/"+pe.filter]:void 0;if(De({data:pe.data,additionalKeyValues:ft,alreadyAppliedFilters:Te,objectId:pe.objectId}),ze("endobj"),"sMask"in pe&&pe.sMask!==void 0){var Oe="/Predictor "+pe.predictor+" /Colors 1 /BitsPerComponent "+pe.bitsPerComponent+" /Columns "+pe.width,Y={width:pe.width,height:pe.height,colorSpace:"DeviceGray",bitsPerComponent:pe.bitsPerComponent,decodeParameters:Oe,data:pe.sMask};"filter"in pe&&(Y.filter=pe.filter),_e.call(this,Y)}if(pe.colorSpace===g.INDEXED){var ce=this.internal.newObject();De({data:le(new Uint8Array(pe.palette)),objectId:ce}),ze("endobj")}},z=function(){var _e=this.internal.collections.addImage_images;for(var pe in _e)R.call(this,_e[pe])},V=function(){var _e,pe=this.internal.collections.addImage_images,ze=this.internal.write;for(var De in pe)ze("/I"+(_e=pe[De]).index,_e.objectId,"0","R")},t=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",z),this.internal.events.subscribe("putXobjectDict",V))},l=function(){var _e=this.internal.collections.addImage_images;return t.call(this),_e},v=function(){return Object.keys(this.internal.collections.addImage_images).length},x=function(_e){return typeof M["process"+_e.toUpperCase()]=="function"},d=function(_e){return rn(_e)==="object"&&_e.nodeType===1},m=function(_e,pe){if(_e.nodeName==="IMG"&&_e.hasAttribute("src")){var ze=""+_e.getAttribute("src");if(ze.indexOf("data:image/")===0)return Iu(unescape(ze).split("base64,").pop());var De=M.loadFile(ze,!0);if(De!==void 0)return De}if(_e.nodeName==="CANVAS"){if(_e.width===0||_e.height===0)throw new Error("Given canvas must have data. Canvas width: "+_e.width+", height: "+_e.height);var at;switch(pe){case"PNG":at="image/png";break;case"WEBP":at="image/webp";break;case"JPEG":case"JPG":default:at="image/jpeg"}return Iu(_e.toDataURL(at,1).split("base64,").pop())}},c=function(_e){var pe=this.internal.collections.addImage_images;if(pe){for(var ze in pe)if(_e===pe[ze].alias)return pe[ze]}},_=function(_e,pe,ze){return _e||pe||(_e=-96,pe=-96),_e<0&&(_e=-1*ze.width*72/_e/this.internal.scaleFactor),pe<0&&(pe=-1*ze.height*72/pe/this.internal.scaleFactor),_e===0&&(_e=pe*ze.width/ze.height),pe===0&&(pe=_e*ze.height/ze.width),[_e,pe]},w=function(_e,pe,ze,De,at,ft){var xt=_.call(this,ze,De,at),He=this.internal.getCoordinateString,ae=this.internal.getVerticalCoordinateString,Te=l.call(this);if(ze=xt[0],De=xt[1],Te[at.index]=at,ft){ft*=Math.PI/180;var Oe=Math.cos(ft),Y=Math.sin(ft),ce=function(te){return te.toFixed(4)},re=[ce(Oe),ce(Y),ce(-1*Y),ce(Oe),0,0,"cm"]}this.internal.write("q"),ft?(this.internal.write([1,"0","0",1,He(_e),ae(pe+De),"cm"].join(" ")),this.internal.write(re.join(" ")),this.internal.write([He(ze),"0","0",He(De),"0","0","cm"].join(" "))):this.internal.write([He(ze),"0","0",He(De),He(_e),ae(pe+De),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+at.index+" Do"),this.internal.write("Q")},g=M.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};M.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var C=M.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},L=M.__addimage__.sHashCode=function(_e){var pe,ze,De=0;if(typeof _e=="string")for(ze=_e.length,pe=0;pe<ze;pe++)De=(De<<5)-De+_e.charCodeAt(pe),De|=0;else if(se(_e))for(ze=_e.byteLength/2,pe=0;pe<ze;pe++)De=(De<<5)-De+_e[pe],De|=0;return De},B=M.__addimage__.validateStringAsBase64=function(_e){(_e=_e||"").toString().trim();var pe=!0;return _e.length===0&&(pe=!1),_e.length%4!=0&&(pe=!1),/^[A-Za-z0-9+/]+$/.test(_e.substr(0,_e.length-2))===!1&&(pe=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(_e.substr(-2))===!1&&(pe=!1),pe},q=M.__addimage__.extractImageFromDataUrl=function(_e){var pe=(_e=_e||"").split("base64,"),ze=null;if(pe.length===2){var De=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(pe[0]);Array.isArray(De)&&(ze={mimeType:De[1],charset:De[2],data:pe[1]})}return ze},K=M.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};M.__addimage__.isArrayBuffer=function(_e){return K()&&_e instanceof ArrayBuffer};var se=M.__addimage__.isArrayBufferView=function(_e){return K()&&typeof Uint32Array<"u"&&(_e instanceof Int8Array||_e instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&_e instanceof Uint8ClampedArray||_e instanceof Int16Array||_e instanceof Uint16Array||_e instanceof Int32Array||_e instanceof Uint32Array||_e instanceof Float32Array||_e instanceof Float64Array)},he=M.__addimage__.binaryStringToUint8Array=function(_e){for(var pe=_e.length,ze=new Uint8Array(pe),De=0;De<pe;De++)ze[De]=_e.charCodeAt(De);return ze},le=M.__addimage__.arrayBufferToBinaryString=function(_e){for(var pe="",ze=se(_e)?_e:new Uint8Array(_e),De=0;De<ze.length;De+=8192)pe+=String.fromCharCode.apply(null,ze.subarray(De,De+8192));return pe};M.addImage=function(){var _e,pe,ze,De,at,ft,xt,He,ae;if(typeof arguments[1]=="number"?(pe=f,ze=arguments[1],De=arguments[2],at=arguments[3],ft=arguments[4],xt=arguments[5],He=arguments[6],ae=arguments[7]):(pe=arguments[1],ze=arguments[2],De=arguments[3],at=arguments[4],ft=arguments[5],xt=arguments[6],He=arguments[7],ae=arguments[8]),rn(_e=arguments[0])==="object"&&!d(_e)&&"imageData"in _e){var Te=_e;_e=Te.imageData,pe=Te.format||pe||f,ze=Te.x||ze||0,De=Te.y||De||0,at=Te.w||Te.width||at,ft=Te.h||Te.height||ft,xt=Te.alias||xt,He=Te.compression||He,ae=Te.rotation||Te.angle||ae}var Oe=this.internal.getFilters();if(He===void 0&&Oe.indexOf("FlateEncode")!==-1&&(He="SLOW"),isNaN(ze)||isNaN(De))throw new Error("Invalid coordinates passed to jsPDF.addImage");t.call(this);var Y=ve.call(this,_e,pe,xt,He);return w.call(this,ze,De,at,ft,Y,ae),this};var ve=function(_e,pe,ze,De){var at,ft,xt;if(typeof _e=="string"&&D(_e)===f){_e=unescape(_e);var He=ot(_e,!1);(He!==""||(He=M.loadFile(_e,!0))!==void 0)&&(_e=He)}if(d(_e)&&(_e=m(_e,pe)),pe=D(_e,pe),!x(pe))throw new Error("addImage does not support files of type '"+pe+"', please ensure that a plugin for '"+pe+"' support is added.");if(((xt=ze)==null||xt.length===0)&&(ze=function(ae){return typeof ae=="string"||se(ae)?L(ae):se(ae.data)?L(ae.data):null}(_e)),(at=c.call(this,ze))||(K()&&(_e instanceof Uint8Array||pe==="RGBA"||(ft=_e,_e=he(_e))),at=this["process"+pe.toUpperCase()](_e,v.call(this),ze,function(ae){return ae&&typeof ae=="string"&&(ae=ae.toUpperCase()),ae in M.image_compression?ae:C.NONE}(De),ft)),!at)throw new Error("An unknown error occurred whilst processing the image.");return at},ot=M.__addimage__.convertBase64ToBinaryString=function(_e,pe){var ze;pe=typeof pe!="boolean"||pe;var De,at="";if(typeof _e=="string"){De=(ze=q(_e))!==null?ze.data:_e;try{at=Iu(De)}catch(ft){if(pe)throw B(De)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ft.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return at};M.getImageProperties=function(_e){var pe,ze,De="";if(d(_e)&&(_e=m(_e)),typeof _e=="string"&&D(_e)===f&&((De=ot(_e,!1))===""&&(De=M.loadFile(_e)||""),_e=De),ze=D(_e),!x(ze))throw new Error("addImage does not support files of type '"+ze+"', please ensure that a plugin for '"+ze+"' support is added.");if(!K()||_e instanceof Uint8Array||(_e=he(_e)),!(pe=this["process"+ze.toUpperCase()](_e)))throw new Error("An unknown error occurred whilst processing the image");return pe.fileType=ze,pe}})(tr.API),function(M){var f=function(A){if(A!==void 0&&A!="")return!0};tr.API.events.push(["addPage",function(A){this.internal.getPageInfo(A.pageNumber).pageContext.annotations=[]}]),M.events.push(["putPage",function(A){for(var D,R,z,V=this.internal.getCoordinateString,t=this.internal.getVerticalCoordinateString,l=this.internal.getPageInfoByObjId(A.objId),v=A.pageContext.annotations,x=!1,d=0;d<v.length&&!x;d++)switch((D=v[d]).type){case"link":(f(D.options.url)||f(D.options.pageNumber))&&(x=!0);break;case"reference":case"text":case"freetext":x=!0}if(x!=0){this.internal.write("/Annots [");for(var m=0;m<v.length;m++){D=v[m];var c=this.internal.pdfEscape,_=this.internal.getEncryptor(A.objId);switch(D.type){case"reference":this.internal.write(" "+D.object.objId+" 0 R ");break;case"text":var w=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject(),C=this.internal.getEncryptor(w.objId),L=D.title||"Note";z="<</Type /Annot /Subtype /Text "+(R="/Rect ["+V(D.bounds.x)+" "+t(D.bounds.y+D.bounds.h)+" "+V(D.bounds.x+D.bounds.w)+" "+t(D.bounds.y)+"] ")+"/Contents ("+c(C(D.contents))+")",z+=" /Popup "+g.objId+" 0 R",z+=" /P "+l.objId+" 0 R",z+=" /T ("+c(C(L))+") >>",w.content=z;var B=w.objId+" 0 R";z="<</Type /Annot /Subtype /Popup "+(R="/Rect ["+V(D.bounds.x+30)+" "+t(D.bounds.y+D.bounds.h)+" "+V(D.bounds.x+D.bounds.w+30)+" "+t(D.bounds.y)+"] ")+" /Parent "+B,D.open&&(z+=" /Open true"),z+=" >>",g.content=z,this.internal.write(w.objId,"0 R",g.objId,"0 R");break;case"freetext":R="/Rect ["+V(D.bounds.x)+" "+t(D.bounds.y)+" "+V(D.bounds.x+D.bounds.w)+" "+t(D.bounds.y+D.bounds.h)+"] ";var q=D.color||"#000000";z="<</Type /Annot /Subtype /FreeText "+R+"/Contents ("+c(_(D.contents))+")",z+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+q+")",z+=" /Border [0 0 0]",z+=" >>",this.internal.write(z);break;case"link":if(D.options.name){var K=this.annotations._nameMap[D.options.name];D.options.pageNumber=K.page,D.options.top=K.y}else D.options.top||(D.options.top=0);if(R="/Rect ["+D.finalBounds.x+" "+D.finalBounds.y+" "+D.finalBounds.w+" "+D.finalBounds.h+"] ",z="",D.options.url)z="<</Type /Annot /Subtype /Link "+R+"/Border [0 0 0] /A <</S /URI /URI ("+c(_(D.options.url))+") >>";else if(D.options.pageNumber)switch(z="<</Type /Annot /Subtype /Link "+R+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(D.options.pageNumber).objId+" 0 R",D.options.magFactor=D.options.magFactor||"XYZ",D.options.magFactor){case"Fit":z+=" /Fit]";break;case"FitH":z+=" /FitH "+D.options.top+"]";break;case"FitV":D.options.left=D.options.left||0,z+=" /FitV "+D.options.left+"]";break;case"XYZ":default:var se=t(D.options.top);D.options.left=D.options.left||0,D.options.zoom===void 0&&(D.options.zoom=0),z+=" /XYZ "+D.options.left+" "+se+" "+D.options.zoom+"]"}z!=""&&(z+=" >>",this.internal.write(z))}}this.internal.write("]")}}]),M.createAnnotation=function(A){var D=this.internal.getCurrentPageInfo();switch(A.type){case"link":this.link(A.bounds.x,A.bounds.y,A.bounds.w,A.bounds.h,A);break;case"text":case"freetext":D.pageContext.annotations.push(A)}},M.link=function(A,D,R,z,V){var t=this.internal.getCurrentPageInfo(),l=this.internal.getCoordinateString,v=this.internal.getVerticalCoordinateString;t.pageContext.annotations.push({finalBounds:{x:l(A),y:v(D),w:l(A+R),h:v(D+z)},options:V,type:"link"})},M.textWithLink=function(A,D,R,z){var V,t,l=this.getTextWidth(A),v=this.internal.getLineHeight()/this.internal.scaleFactor;if(z.maxWidth!==void 0){t=z.maxWidth;var x=this.splitTextToSize(A,t).length;V=Math.ceil(v*x)}else t=l,V=v;return this.text(A,D,R,z),R+=.2*v,z.align==="center"&&(D-=l/2),z.align==="right"&&(D-=l),this.link(D,R-v,t,V,z),l},M.getTextWidth=function(A){var D=this.internal.getFontSize();return this.getStringUnitWidth(A)*D/this.internal.scaleFactor}}(tr.API),function(M){var f={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},A={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},D={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},R=[1570,1571,1573,1575];M.__arabicParser__={};var z=M.__arabicParser__.isInArabicSubstitutionA=function(w){return f[w.charCodeAt(0)]!==void 0},V=M.__arabicParser__.isArabicLetter=function(w){return typeof w=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(w)},t=M.__arabicParser__.isArabicEndLetter=function(w){return V(w)&&z(w)&&f[w.charCodeAt(0)].length<=2},l=M.__arabicParser__.isArabicAlfLetter=function(w){return V(w)&&R.indexOf(w.charCodeAt(0))>=0};M.__arabicParser__.arabicLetterHasIsolatedForm=function(w){return V(w)&&z(w)&&f[w.charCodeAt(0)].length>=1};var v=M.__arabicParser__.arabicLetterHasFinalForm=function(w){return V(w)&&z(w)&&f[w.charCodeAt(0)].length>=2};M.__arabicParser__.arabicLetterHasInitialForm=function(w){return V(w)&&z(w)&&f[w.charCodeAt(0)].length>=3};var x=M.__arabicParser__.arabicLetterHasMedialForm=function(w){return V(w)&&z(w)&&f[w.charCodeAt(0)].length==4},d=M.__arabicParser__.resolveLigatures=function(w){var g=0,C=A,L="",B=0;for(g=0;g<w.length;g+=1)C[w.charCodeAt(g)]!==void 0?(B++,typeof(C=C[w.charCodeAt(g)])=="number"&&(L+=String.fromCharCode(C),C=A,B=0),g===w.length-1&&(C=A,L+=w.charAt(g-(B-1)),g-=B-1,B=0)):(C=A,L+=w.charAt(g-B),g-=B,B=0);return L};M.__arabicParser__.isArabicDiacritic=function(w){return w!==void 0&&D[w.charCodeAt(0)]!==void 0};var m=M.__arabicParser__.getCorrectForm=function(w,g,C){return V(w)?z(w)===!1?-1:!v(w)||!V(g)&&!V(C)||!V(C)&&t(g)||t(w)&&!V(g)||t(w)&&l(g)||t(w)&&t(g)?0:x(w)&&V(g)&&!t(g)&&V(C)&&v(C)?3:t(w)||!V(C)?1:2:-1},c=function(w){var g=0,C=0,L=0,B="",q="",K="",se=(w=w||"").split("\\s+"),he=[];for(g=0;g<se.length;g+=1){for(he.push(""),C=0;C<se[g].length;C+=1)B=se[g][C],q=se[g][C-1],K=se[g][C+1],V(B)?(L=m(B,q,K),he[g]+=L!==-1?String.fromCharCode(f[B.charCodeAt(0)][L]):B):he[g]+=B;he[g]=d(he[g])}return he.join(" ")},_=M.__arabicParser__.processArabic=M.processArabic=function(){var w,g=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,C=[];if(Array.isArray(g)){var L=0;for(C=[],L=0;L<g.length;L+=1)Array.isArray(g[L])?C.push([c(g[L][0]),g[L][1],g[L][2]]):C.push([c(g[L])]);w=C}else w=c(g);return typeof arguments[0]=="string"?w:(arguments[0].text=w,arguments[0])};M.events.push(["preProcessText",_])}(tr.API),tr.API.autoPrint=function(M){var f;switch((M=M||{}).variant=M.variant||"non-conform",M.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){f=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+f+" 0 R")})}return this},function(M){var f=function(){var A=void 0;Object.defineProperty(this,"pdf",{get:function(){return A},set:function(t){A=t}});var D=150;Object.defineProperty(this,"width",{get:function(){return D},set:function(t){D=isNaN(t)||Number.isInteger(t)===!1||t<0?150:t,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=D+1)}});var R=300;Object.defineProperty(this,"height",{get:function(){return R},set:function(t){R=isNaN(t)||Number.isInteger(t)===!1||t<0?300:t,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=R+1)}});var z=[];Object.defineProperty(this,"childNodes",{get:function(){return z},set:function(t){z=t}});var V={};Object.defineProperty(this,"style",{get:function(){return V},set:function(t){V=t}}),Object.defineProperty(this,"parentNode",{})};f.prototype.getContext=function(A,D){var R;if((A=A||"2d")!=="2d")return null;for(R in D)this.pdf.context2d.hasOwnProperty(R)&&(this.pdf.context2d[R]=D[R]);return this.pdf.context2d._canvas=this,this.pdf.context2d},f.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},M.events.push(["initialized",function(){this.canvas=new f,this.canvas.pdf=this}])}(tr.API),function(M){var f={left:0,top:0,bottom:0,right:0},A=!1,D=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},f),this.internal.__cell__.margins.width=this.getPageWidth(),R.call(this))},R=function(){this.internal.__cell__.lastCell=new z,this.internal.__cell__.pages=1},z=function(){var l=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return l},set:function(w){l=w}});var v=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return v},set:function(w){v=w}});var x=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return x},set:function(w){x=w}});var d=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return d},set:function(w){d=w}});var m=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return m},set:function(w){m=w}});var c=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return c},set:function(w){c=w}});var _=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return _},set:function(w){_=w}}),this};z.prototype.clone=function(){return new z(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},z.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},M.setHeaderFunction=function(l){return D.call(this),this.internal.__cell__.headerFunction=typeof l=="function"?l:void 0,this},M.getTextDimensions=function(l,v){D.call(this);var x=(v=v||{}).fontSize||this.getFontSize(),d=v.font||this.getFont(),m=v.scaleFactor||this.internal.scaleFactor,c=0,_=0,w=0,g=this;if(!Array.isArray(l)&&typeof l!="string"){if(typeof l!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");l=String(l)}var C=v.maxWidth;C>0?typeof l=="string"?l=this.splitTextToSize(l,C):Object.prototype.toString.call(l)==="[object Array]"&&(l=l.reduce(function(B,q){return B.concat(g.splitTextToSize(q,C))},[])):l=Array.isArray(l)?l:[l];for(var L=0;L<l.length;L++)c<(w=this.getStringUnitWidth(l[L],{font:d})*x)&&(c=w);return c!==0&&(_=l.length),{w:c/=m,h:Math.max((_*x*this.getLineHeightFactor()-x*(this.getLineHeightFactor()-1))/m,0)}},M.cellAddPage=function(){D.call(this),this.addPage();var l=this.internal.__cell__.margins||f;return this.internal.__cell__.lastCell=new z(l.left,l.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var V=M.cell=function(){var l;l=arguments[0]instanceof z?arguments[0]:new z(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),D.call(this);var v=this.internal.__cell__.lastCell,x=this.internal.__cell__.padding,d=this.internal.__cell__.margins||f,m=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return v.lineNumber!==void 0&&(v.lineNumber===l.lineNumber?(l.x=(v.x||0)+(v.width||0),l.y=v.y||0):v.y+v.height+l.height+d.bottom>this.getPageHeight()?(this.cellAddPage(),l.y=d.top,c&&m&&(this.printHeaderRow(l.lineNumber,!0),l.y+=m[0].height)):l.y=v.y+v.height||l.y),l.text[0]!==void 0&&(this.rect(l.x,l.y,l.width,l.height,A===!0?"FD":void 0),l.align==="right"?this.text(l.text,l.x+l.width-x,l.y+x,{align:"right",baseline:"top"}):l.align==="center"?this.text(l.text,l.x+l.width/2,l.y+x,{align:"center",baseline:"top",maxWidth:l.width-x-x}):this.text(l.text,l.x+x,l.y+x,{align:"left",baseline:"top",maxWidth:l.width-x-x})),this.internal.__cell__.lastCell=l,this};M.table=function(l,v,x,d,m){if(D.call(this),!x)throw new Error("No data for PDF table.");var c,_,w,g,C=[],L=[],B=[],q={},K={},se=[],he=[],le=(m=m||{}).autoSize||!1,ve=m.printHeaders!==!1,ot=m.css&&m.css["font-size"]!==void 0?16*m.css["font-size"]:m.fontSize||12,_e=m.margins||Object.assign({width:this.getPageWidth()},f),pe=typeof m.padding=="number"?m.padding:3,ze=m.headerBackgroundColor||"#c8c8c8",De=m.headerTextColor||"#000";if(R.call(this),this.internal.__cell__.printHeaders=ve,this.internal.__cell__.margins=_e,this.internal.__cell__.table_font_size=ot,this.internal.__cell__.padding=pe,this.internal.__cell__.headerBackgroundColor=ze,this.internal.__cell__.headerTextColor=De,this.setFontSize(ot),d==null)L=C=Object.keys(x[0]),B=C.map(function(){return"left"});else if(Array.isArray(d)&&rn(d[0])==="object")for(C=d.map(function(Te){return Te.name}),L=d.map(function(Te){return Te.prompt||Te.name||""}),B=d.map(function(Te){return Te.align||"left"}),c=0;c<d.length;c+=1)K[d[c].name]=d[c].width*(19.049976/25.4);else Array.isArray(d)&&typeof d[0]=="string"&&(L=C=d,B=C.map(function(){return"left"}));if(le||Array.isArray(d)&&typeof d[0]=="string")for(c=0;c<C.length;c+=1){for(q[g=C[c]]=x.map(function(Te){return Te[g]}),this.setFont(void 0,"bold"),se.push(this.getTextDimensions(L[c],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),_=q[g],this.setFont(void 0,"normal"),w=0;w<_.length;w+=1)se.push(this.getTextDimensions(_[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);K[g]=Math.max.apply(null,se)+pe+pe,se=[]}if(ve){var at={};for(c=0;c<C.length;c+=1)at[C[c]]={},at[C[c]].text=L[c],at[C[c]].align=B[c];var ft=t.call(this,at,K);he=C.map(function(Te){return new z(l,v,K[Te],ft,at[Te].text,void 0,at[Te].align)}),this.setTableHeaderRow(he),this.printHeaderRow(1,!1)}var xt=d.reduce(function(Te,Oe){return Te[Oe.name]=Oe.align,Te},{});for(c=0;c<x.length;c+=1){"rowStart"in m&&m.rowStart instanceof Function&&m.rowStart({row:c,data:x[c]},this);var He=t.call(this,x[c],K);for(w=0;w<C.length;w+=1){var ae=x[c][C[w]];"cellStart"in m&&m.cellStart instanceof Function&&m.cellStart({row:c,col:w,data:ae},this),V.call(this,new z(l,v,K[C[w]],He,ae,c+2,xt[C[w]]))}}return this.internal.__cell__.table_x=l,this.internal.__cell__.table_y=v,this};var t=function(l,v){var x=this.internal.__cell__.padding,d=this.internal.__cell__.table_font_size,m=this.internal.scaleFactor;return Object.keys(l).map(function(c){var _=l[c];return this.splitTextToSize(_.hasOwnProperty("text")?_.text:_,v[c]-x-x)},this).map(function(c){return this.getLineHeightFactor()*c.length*d/m+x+x},this).reduce(function(c,_){return Math.max(c,_)},0)};M.setTableHeaderRow=function(l){D.call(this),this.internal.__cell__.tableHeaderRow=l},M.printHeaderRow=function(l,v){if(D.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var x;if(A=!0,typeof this.internal.__cell__.headerFunction=="function"){var d=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new z(d[0],d[1],d[2],d[3],void 0,-1)}this.setFont(void 0,"bold");for(var m=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){x=this.internal.__cell__.tableHeaderRow[c].clone(),v&&(x.y=this.internal.__cell__.margins.top||0,m.push(x)),x.lineNumber=l;var _=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),V.call(this,x),this.setTextColor(_)}m.length>0&&this.setTableHeaderRow(m),this.setFont(void 0,"normal"),A=!1}}(tr.API);var z_={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},R_=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],hp=F_(R_),B_=[100,200,300,400,500,600,700,800,900],Y1=F_(B_);function up(M){var f=M.family.replace(/"|'/g,"").toLowerCase(),A=function(z){return z_[z=z||"normal"]?z:"normal"}(M.style),D=function(z){if(!z)return 400;if(typeof z=="number")return z>=100&&z<=900&&z%100==0?z:400;if(/^\d00$/.test(z))return parseInt(z);switch(z){case"bold":return 700;case"normal":default:return 400}}(M.weight),R=function(z){return typeof hp[z=z||"normal"]=="number"?z:"normal"}(M.stretch);return{family:f,style:A,weight:D,stretch:R,src:M.src||[],ref:M.ref||{name:f,style:[R,A,D].join(" ")}}}function a_(M,f,A,D){var R;for(R=A;R>=0&&R<f.length;R+=D)if(M[f[R]])return M[f[R]];for(R=A;R>=0&&R<f.length;R-=D)if(M[f[R]])return M[f[R]]}var Z1={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},l_={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function c_(M){return[M.stretch,M.style,M.weight,M.family].join(" ")}function K1(M,f,A){for(var D=(A=A||{}).defaultFontFamily||"times",R=Object.assign({},Z1,A.genericFontFamilies||{}),z=null,V=null,t=0;t<f.length;++t)if(R[(z=up(f[t])).family]&&(z.family=R[z.family]),M.hasOwnProperty(z.family)){V=M[z.family];break}if(!(V=V||M[D]))throw new Error("Could not find a font-family for the rule '"+c_(z)+"' and default family '"+D+"'.");if(V=function(l,v){if(v[l])return v[l];var x=hp[l],d=x<=hp.normal?-1:1,m=a_(v,R_,x,d);if(!m)throw new Error("Could not find a matching font-stretch value for "+l);return m}(z.stretch,V),V=function(l,v){if(v[l])return v[l];for(var x=z_[l],d=0;d<x.length;++d)if(v[x[d]])return v[x[d]];throw new Error("Could not find a matching font-style for "+l)}(z.style,V),!(V=function(l,v){if(v[l])return v[l];if(l===400&&v[500])return v[500];if(l===500&&v[400])return v[400];var x=Y1[l],d=a_(v,B_,x,l<400?-1:1);if(!d)throw new Error("Could not find a matching font-weight for value "+l);return d}(z.weight,V)))throw new Error("Failed to resolve a font for the rule '"+c_(z)+"'.");return V}function h_(M){return M.trimLeft()}function J1(M,f){for(var A=0;A<M.length;){if(M.charAt(A)===f)return[M.substring(0,A),M.substring(A+1)];A+=1}return null}function Q1(M){var f=M.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return f===null?null:[f[0],M.substring(f[0].length)]}var Cf,u_,f_,Zd=["times"];(function(M){var f,A,D,R,z,V,t,l,v,x=function(Y){return Y=Y||{},this.isStrokeTransparent=Y.isStrokeTransparent||!1,this.strokeOpacity=Y.strokeOpacity||1,this.strokeStyle=Y.strokeStyle||"#000000",this.fillStyle=Y.fillStyle||"#000000",this.isFillTransparent=Y.isFillTransparent||!1,this.fillOpacity=Y.fillOpacity||1,this.font=Y.font||"10px sans-serif",this.textBaseline=Y.textBaseline||"alphabetic",this.textAlign=Y.textAlign||"left",this.lineWidth=Y.lineWidth||1,this.lineJoin=Y.lineJoin||"miter",this.lineCap=Y.lineCap||"butt",this.path=Y.path||[],this.transform=Y.transform!==void 0?Y.transform.clone():new l,this.globalCompositeOperation=Y.globalCompositeOperation||"normal",this.globalAlpha=Y.globalAlpha||1,this.clip_path=Y.clip_path||[],this.currentPoint=Y.currentPoint||new V,this.miterLimit=Y.miterLimit||10,this.lastPoint=Y.lastPoint||new V,this.lineDashOffset=Y.lineDashOffset||0,this.lineDash=Y.lineDash||[],this.margin=Y.margin||[0,0,0,0],this.prevPageLastElemOffset=Y.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Y.ignoreClearRect!="boolean"||Y.ignoreClearRect,this};M.events.push(["initialized",function(){this.context2d=new d(this),f=this.internal.f2,A=this.internal.getCoordinateString,D=this.internal.getVerticalCoordinateString,R=this.internal.getHorizontalCoordinate,z=this.internal.getVerticalCoordinate,V=this.internal.Point,t=this.internal.Rectangle,l=this.internal.Matrix,v=new x}]);var d=function(Y){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var ce=Y;Object.defineProperty(this,"pdf",{get:function(){return ce}});var re=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return re},set:function(Xe){re=!!Xe}});var te=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return te},set:function(Xe){te=!!Xe}});var we=0;Object.defineProperty(this,"posX",{get:function(){return we},set:function(Xe){isNaN(Xe)||(we=Xe)}});var ke=0;Object.defineProperty(this,"posY",{get:function(){return ke},set:function(Xe){isNaN(Xe)||(ke=Xe)}}),Object.defineProperty(this,"margin",{get:function(){return v.margin},set:function(Xe){var Se;typeof Xe=="number"?Se=[Xe,Xe,Xe,Xe]:((Se=new Array(4))[0]=Xe[0],Se[1]=Xe.length>=2?Xe[1]:Se[0],Se[2]=Xe.length>=3?Xe[2]:Se[0],Se[3]=Xe.length>=4?Xe[3]:Se[1]),v.margin=Se}});var We=!1;Object.defineProperty(this,"autoPaging",{get:function(){return We},set:function(Xe){We=Xe}});var qe=0;Object.defineProperty(this,"lastBreak",{get:function(){return qe},set:function(Xe){qe=Xe}});var gt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return gt},set:function(Xe){gt=Xe}}),Object.defineProperty(this,"ctx",{get:function(){return v},set:function(Xe){Xe instanceof x&&(v=Xe)}}),Object.defineProperty(this,"path",{get:function(){return v.path},set:function(Xe){v.path=Xe}});var lt=[];Object.defineProperty(this,"ctxStack",{get:function(){return lt},set:function(Xe){lt=Xe}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Xe){var Se;Se=m(Xe),this.ctx.fillStyle=Se.style,this.ctx.isFillTransparent=Se.a===0,this.ctx.fillOpacity=Se.a,this.pdf.setFillColor(Se.r,Se.g,Se.b,{a:Se.a}),this.pdf.setTextColor(Se.r,Se.g,Se.b,{a:Se.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Xe){var Se=m(Xe);this.ctx.strokeStyle=Se.style,this.ctx.isStrokeTransparent=Se.a===0,this.ctx.strokeOpacity=Se.a,Se.a===0?this.pdf.setDrawColor(255,255,255):(Se.a,this.pdf.setDrawColor(Se.r,Se.g,Se.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Xe){["butt","round","square"].indexOf(Xe)!==-1&&(this.ctx.lineCap=Xe,this.pdf.setLineCap(Xe))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Xe){isNaN(Xe)||(this.ctx.lineWidth=Xe,this.pdf.setLineWidth(Xe))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Xe){["bevel","round","miter"].indexOf(Xe)!==-1&&(this.ctx.lineJoin=Xe,this.pdf.setLineJoin(Xe))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Xe){isNaN(Xe)||(this.ctx.miterLimit=Xe,this.pdf.setMiterLimit(Xe))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Xe){this.ctx.textBaseline=Xe}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Xe){["right","end","center","left","start"].indexOf(Xe)!==-1&&(this.ctx.textAlign=Xe)}});var Bt=null;function ht(Xe,Se){if(Bt===null){var At=function(Et){var wt=[];return Object.keys(Et).forEach(function(Kt){Et[Kt].forEach(function($t){var yt=null;switch($t){case"bold":yt={family:Kt,weight:"bold"};break;case"italic":yt={family:Kt,style:"italic"};break;case"bolditalic":yt={family:Kt,weight:"bold",style:"italic"};break;case"":case"normal":yt={family:Kt}}yt!==null&&(yt.ref={name:Kt,style:$t},wt.push(yt))})}),wt}(Xe.getFontList());Bt=function(Et){for(var wt={},Kt=0;Kt<Et.length;++Kt){var $t=up(Et[Kt]),yt=$t.family,ri=$t.stretch,mi=$t.style,xi=$t.weight;wt[yt]=wt[yt]||{},wt[yt][ri]=wt[yt][ri]||{},wt[yt][ri][mi]=wt[yt][ri][mi]||{},wt[yt][ri][mi][xi]=$t}return wt}(At.concat(Se))}return Bt}var ct=null;Object.defineProperty(this,"fontFaces",{get:function(){return ct},set:function(Xe){Bt=null,ct=Xe}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Xe){var Se;if(this.ctx.font=Xe,(Se=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Xe))!==null){var At=Se[1],Et=(Se[2],Se[3]),wt=Se[4],Kt=(Se[5],Se[6]),$t=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(wt)[2];wt=Math.floor($t==="px"?parseFloat(wt)*this.pdf.internal.scaleFactor:$t==="em"?parseFloat(wt)*this.pdf.getFontSize():parseFloat(wt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(wt);var yt=function(Rt){var si,jt,Ii=[],wi=Rt.trim();if(wi==="")return Zd;if(wi in l_)return[l_[wi]];for(;wi!=="";){switch(jt=null,si=(wi=h_(wi)).charAt(0)){case'"':case"'":jt=J1(wi.substring(1),si);break;default:jt=Q1(wi)}if(jt===null||(Ii.push(jt[0]),(wi=h_(jt[1]))!==""&&wi.charAt(0)!==","))return Zd;wi=wi.replace(/^,/,"")}return Ii}(Kt);if(this.fontFaces){var ri=K1(ht(this.pdf,this.fontFaces),yt.map(function(Rt){return{family:Rt,stretch:"normal",weight:Et,style:At}}));this.pdf.setFont(ri.ref.name,ri.ref.style)}else{var mi="";(Et==="bold"||parseInt(Et,10)>=700||At==="bold")&&(mi="bold"),At==="italic"&&(mi+="italic"),mi.length===0&&(mi="normal");for(var xi="",Li={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ue=0;Ue<yt.length;Ue++){if(this.pdf.internal.getFont(yt[Ue],mi,{noFallback:!0,disableWarning:!0})!==void 0){xi=yt[Ue];break}if(mi==="bolditalic"&&this.pdf.internal.getFont(yt[Ue],"bold",{noFallback:!0,disableWarning:!0})!==void 0)xi=yt[Ue],mi="bold";else if(this.pdf.internal.getFont(yt[Ue],"normal",{noFallback:!0,disableWarning:!0})!==void 0){xi=yt[Ue],mi="normal";break}}if(xi===""){for(var ge=0;ge<yt.length;ge++)if(Li[yt[ge]]){xi=Li[yt[ge]];break}}xi=xi===""?"Times":xi,this.pdf.setFont(xi,mi)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Xe){this.ctx.globalCompositeOperation=Xe}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Xe){this.ctx.globalAlpha=Xe}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Xe){this.ctx.lineDashOffset=Xe,Oe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Xe){this.ctx.lineDash=Xe,Oe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Xe){this.ctx.ignoreClearRect=!!Xe}})};d.prototype.setLineDash=function(Y){this.lineDash=Y},d.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},d.prototype.fill=function(){q.call(this,"fill",!1)},d.prototype.stroke=function(){q.call(this,"stroke",!1)},d.prototype.beginPath=function(){this.path=[{type:"begin"}]},d.prototype.moveTo=function(Y,ce){if(isNaN(Y)||isNaN(ce))throw hn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var re=this.ctx.transform.applyToPoint(new V(Y,ce));this.path.push({type:"mt",x:re.x,y:re.y}),this.ctx.lastPoint=new V(Y,ce)},d.prototype.closePath=function(){var Y=new V(0,0),ce=0;for(ce=this.path.length-1;ce!==-1;ce--)if(this.path[ce].type==="begin"&&rn(this.path[ce+1])==="object"&&typeof this.path[ce+1].x=="number"){Y=new V(this.path[ce+1].x,this.path[ce+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new V(Y.x,Y.y)},d.prototype.lineTo=function(Y,ce){if(isNaN(Y)||isNaN(ce))throw hn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var re=this.ctx.transform.applyToPoint(new V(Y,ce));this.path.push({type:"lt",x:re.x,y:re.y}),this.ctx.lastPoint=new V(re.x,re.y)},d.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),q.call(this,null,!0)},d.prototype.quadraticCurveTo=function(Y,ce,re,te){if(isNaN(re)||isNaN(te)||isNaN(Y)||isNaN(ce))throw hn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var we=this.ctx.transform.applyToPoint(new V(re,te)),ke=this.ctx.transform.applyToPoint(new V(Y,ce));this.path.push({type:"qct",x1:ke.x,y1:ke.y,x:we.x,y:we.y}),this.ctx.lastPoint=new V(we.x,we.y)},d.prototype.bezierCurveTo=function(Y,ce,re,te,we,ke){if(isNaN(we)||isNaN(ke)||isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te))throw hn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var We=this.ctx.transform.applyToPoint(new V(we,ke)),qe=this.ctx.transform.applyToPoint(new V(Y,ce)),gt=this.ctx.transform.applyToPoint(new V(re,te));this.path.push({type:"bct",x1:qe.x,y1:qe.y,x2:gt.x,y2:gt.y,x:We.x,y:We.y}),this.ctx.lastPoint=new V(We.x,We.y)},d.prototype.arc=function(Y,ce,re,te,we,ke){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te)||isNaN(we))throw hn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ke=!!ke,!this.ctx.transform.isIdentity){var We=this.ctx.transform.applyToPoint(new V(Y,ce));Y=We.x,ce=We.y;var qe=this.ctx.transform.applyToPoint(new V(0,re)),gt=this.ctx.transform.applyToPoint(new V(0,0));re=Math.sqrt(Math.pow(qe.x-gt.x,2)+Math.pow(qe.y-gt.y,2))}Math.abs(we-te)>=2*Math.PI&&(te=0,we=2*Math.PI),this.path.push({type:"arc",x:Y,y:ce,radius:re,startAngle:te,endAngle:we,counterclockwise:ke})},d.prototype.arcTo=function(Y,ce,re,te,we){throw new Error("arcTo not implemented.")},d.prototype.rect=function(Y,ce,re,te){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te))throw hn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Y,ce),this.lineTo(Y+re,ce),this.lineTo(Y+re,ce+te),this.lineTo(Y,ce+te),this.lineTo(Y,ce),this.lineTo(Y+re,ce),this.lineTo(Y,ce)},d.prototype.fillRect=function(Y,ce,re,te){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te))throw hn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!c.call(this)){var we={};this.lineCap!=="butt"&&(we.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(we.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Y,ce,re,te),this.fill(),we.hasOwnProperty("lineCap")&&(this.lineCap=we.lineCap),we.hasOwnProperty("lineJoin")&&(this.lineJoin=we.lineJoin)}},d.prototype.strokeRect=function(Y,ce,re,te){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te))throw hn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");_.call(this)||(this.beginPath(),this.rect(Y,ce,re,te),this.stroke())},d.prototype.clearRect=function(Y,ce,re,te){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te))throw hn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Y,ce,re,te))},d.prototype.save=function(Y){Y=typeof Y!="boolean"||Y;for(var ce=this.pdf.internal.getCurrentPageInfo().pageNumber,re=0;re<this.pdf.internal.getNumberOfPages();re++)this.pdf.setPage(re+1),this.pdf.internal.out("q");if(this.pdf.setPage(ce),Y){this.ctx.fontSize=this.pdf.internal.getFontSize();var te=new x(this.ctx);this.ctxStack.push(this.ctx),this.ctx=te}},d.prototype.restore=function(Y){Y=typeof Y!="boolean"||Y;for(var ce=this.pdf.internal.getCurrentPageInfo().pageNumber,re=0;re<this.pdf.internal.getNumberOfPages();re++)this.pdf.setPage(re+1),this.pdf.internal.out("Q");this.pdf.setPage(ce),Y&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},d.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var m=function(Y){var ce,re,te,we;if(Y.isCanvasGradient===!0&&(Y=Y.getColor()),!Y)return{r:0,g:0,b:0,a:0,style:Y};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Y))ce=0,re=0,te=0,we=0;else{var ke=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Y);if(ke!==null)ce=parseInt(ke[1]),re=parseInt(ke[2]),te=parseInt(ke[3]),we=1;else if((ke=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Y))!==null)ce=parseInt(ke[1]),re=parseInt(ke[2]),te=parseInt(ke[3]),we=parseFloat(ke[4]);else{if(we=1,typeof Y=="string"&&Y.charAt(0)!=="#"){var We=new M_(Y);Y=We.ok?We.toHex():"#000000"}Y.length===4?(ce=Y.substring(1,2),ce+=ce,re=Y.substring(2,3),re+=re,te=Y.substring(3,4),te+=te):(ce=Y.substring(1,3),re=Y.substring(3,5),te=Y.substring(5,7)),ce=parseInt(ce,16),re=parseInt(re,16),te=parseInt(te,16)}}return{r:ce,g:re,b:te,a:we,style:Y}},c=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},_=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};d.prototype.fillText=function(Y,ce,re,te){if(isNaN(ce)||isNaN(re)||typeof Y!="string")throw hn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(te=isNaN(te)?void 0:te,!c.call(this)){var we=He(this.ctx.transform.rotation),ke=this.ctx.transform.scaleX;pe.call(this,{text:Y,x:ce,y:re,scale:ke,angle:we,align:this.textAlign,maxWidth:te})}},d.prototype.strokeText=function(Y,ce,re,te){if(isNaN(ce)||isNaN(re)||typeof Y!="string")throw hn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!_.call(this)){te=isNaN(te)?void 0:te;var we=He(this.ctx.transform.rotation),ke=this.ctx.transform.scaleX;pe.call(this,{text:Y,x:ce,y:re,scale:ke,renderingMode:"stroke",angle:we,align:this.textAlign,maxWidth:te})}},d.prototype.measureText=function(Y){if(typeof Y!="string")throw hn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var ce=this.pdf,re=this.pdf.internal.scaleFactor,te=ce.internal.getFontSize(),we=ce.getStringUnitWidth(Y)*te/ce.internal.scaleFactor,ke=function(We){var qe=(We=We||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return qe}}),this};return new ke({width:we*=Math.round(96*re/72*1e4)/1e4})},d.prototype.scale=function(Y,ce){if(isNaN(Y)||isNaN(ce))throw hn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var re=new l(Y,0,0,ce,0,0);this.ctx.transform=this.ctx.transform.multiply(re)},d.prototype.rotate=function(Y){if(isNaN(Y))throw hn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var ce=new l(Math.cos(Y),Math.sin(Y),-Math.sin(Y),Math.cos(Y),0,0);this.ctx.transform=this.ctx.transform.multiply(ce)},d.prototype.translate=function(Y,ce){if(isNaN(Y)||isNaN(ce))throw hn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var re=new l(1,0,0,1,Y,ce);this.ctx.transform=this.ctx.transform.multiply(re)},d.prototype.transform=function(Y,ce,re,te,we,ke){if(isNaN(Y)||isNaN(ce)||isNaN(re)||isNaN(te)||isNaN(we)||isNaN(ke))throw hn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var We=new l(Y,ce,re,te,we,ke);this.ctx.transform=this.ctx.transform.multiply(We)},d.prototype.setTransform=function(Y,ce,re,te,we,ke){Y=isNaN(Y)?1:Y,ce=isNaN(ce)?0:ce,re=isNaN(re)?0:re,te=isNaN(te)?1:te,we=isNaN(we)?0:we,ke=isNaN(ke)?0:ke,this.ctx.transform=new l(Y,ce,re,te,we,ke)};var w=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};d.prototype.drawImage=function(Y,ce,re,te,we,ke,We,qe,gt){var lt=this.pdf.getImageProperties(Y),Bt=1,ht=1,ct=1,Xe=1;te!==void 0&&qe!==void 0&&(ct=qe/te,Xe=gt/we,Bt=lt.width/te*qe/te,ht=lt.height/we*gt/we),ke===void 0&&(ke=ce,We=re,ce=0,re=0),te!==void 0&&qe===void 0&&(qe=te,gt=we),te===void 0&&qe===void 0&&(qe=lt.width,gt=lt.height);for(var Se,At=this.ctx.transform.decompose(),Et=He(At.rotate.shx),wt=new l,Kt=(wt=(wt=(wt=wt.multiply(At.translate)).multiply(At.skew)).multiply(At.scale)).applyToRectangle(new t(ke-ce*ct,We-re*Xe,te*Bt,we*ht)),$t=g.call(this,Kt),yt=[],ri=0;ri<$t.length;ri+=1)yt.indexOf($t[ri])===-1&&yt.push($t[ri]);if(B(yt),this.autoPaging)for(var mi=yt[0],xi=yt[yt.length-1],Li=mi;Li<xi+1;Li++){this.pdf.setPage(Li);var Ue=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ge=Li===1?this.posY+this.margin[0]:this.margin[0],Rt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],si=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],jt=Li===1?0:Rt+(Li-2)*si;if(this.ctx.clip_path.length!==0){var Ii=this.path;Se=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=L(Se,this.posX+this.margin[3],-jt+ge+this.ctx.prevPageLastElemOffset),K.call(this,"fill",!0),this.path=Ii}var wi=JSON.parse(JSON.stringify(Kt));wi=L([wi],this.posX+this.margin[3],-jt+ge+this.ctx.prevPageLastElemOffset)[0];var or=(Li>mi||Li<xi)&&w.call(this);or&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ue,si,null).clip().discardPath()),this.pdf.addImage(Y,"JPEG",wi.x,wi.y,wi.w,wi.h,null,null,Et),or&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Y,"JPEG",Kt.x,Kt.y,Kt.w,Kt.h,null,null,Et)};var g=function(Y,ce,re){var te=[];ce=ce||this.pdf.internal.pageSize.width,re=re||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var we=this.posY+this.ctx.prevPageLastElemOffset;switch(Y.type){default:case"mt":case"lt":te.push(Math.floor((Y.y+we)/re)+1);break;case"arc":te.push(Math.floor((Y.y+we-Y.radius)/re)+1),te.push(Math.floor((Y.y+we+Y.radius)/re)+1);break;case"qct":var ke=ae(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Y.x1,Y.y1,Y.x,Y.y);te.push(Math.floor((ke.y+we)/re)+1),te.push(Math.floor((ke.y+ke.h+we)/re)+1);break;case"bct":var We=Te(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Y.x1,Y.y1,Y.x2,Y.y2,Y.x,Y.y);te.push(Math.floor((We.y+we)/re)+1),te.push(Math.floor((We.y+We.h+we)/re)+1);break;case"rect":te.push(Math.floor((Y.y+we)/re)+1),te.push(Math.floor((Y.y+Y.h+we)/re)+1)}for(var qe=0;qe<te.length;qe+=1)for(;this.pdf.internal.getNumberOfPages()<te[qe];)C.call(this);return te},C=function(){var Y=this.fillStyle,ce=this.strokeStyle,re=this.font,te=this.lineCap,we=this.lineWidth,ke=this.lineJoin;this.pdf.addPage(),this.fillStyle=Y,this.strokeStyle=ce,this.font=re,this.lineCap=te,this.lineWidth=we,this.lineJoin=ke},L=function(Y,ce,re){for(var te=0;te<Y.length;te++)switch(Y[te].type){case"bct":Y[te].x2+=ce,Y[te].y2+=re;case"qct":Y[te].x1+=ce,Y[te].y1+=re;case"mt":case"lt":case"arc":default:Y[te].x+=ce,Y[te].y+=re}return Y},B=function(Y){return Y.sort(function(ce,re){return ce-re})},q=function(Y,ce){for(var re,te,we=this.fillStyle,ke=this.strokeStyle,We=this.lineCap,qe=this.lineWidth,gt=Math.abs(qe*this.ctx.transform.scaleX),lt=this.lineJoin,Bt=JSON.parse(JSON.stringify(this.path)),ht=JSON.parse(JSON.stringify(this.path)),ct=[],Xe=0;Xe<ht.length;Xe++)if(ht[Xe].x!==void 0)for(var Se=g.call(this,ht[Xe]),At=0;At<Se.length;At+=1)ct.indexOf(Se[At])===-1&&ct.push(Se[At]);for(var Et=0;Et<ct.length;Et++)for(;this.pdf.internal.getNumberOfPages()<ct[Et];)C.call(this);if(B(ct),this.autoPaging)for(var wt=ct[0],Kt=ct[ct.length-1],$t=wt;$t<Kt+1;$t++){this.pdf.setPage($t),this.fillStyle=we,this.strokeStyle=ke,this.lineCap=We,this.lineWidth=gt,this.lineJoin=lt;var yt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ri=$t===1?this.posY+this.margin[0]:this.margin[0],mi=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],xi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Li=$t===1?0:mi+($t-2)*xi;if(this.ctx.clip_path.length!==0){var Ue=this.path;re=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=L(re,this.posX+this.margin[3],-Li+ri+this.ctx.prevPageLastElemOffset),K.call(this,Y,!0),this.path=Ue}if(te=JSON.parse(JSON.stringify(Bt)),this.path=L(te,this.posX+this.margin[3],-Li+ri+this.ctx.prevPageLastElemOffset),ce===!1||$t===0){var ge=($t>wt||$t<Kt)&&w.call(this);ge&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],yt,xi,null).clip().discardPath()),K.call(this,Y,ce),ge&&this.pdf.restoreGraphicsState()}this.lineWidth=qe}else this.lineWidth=gt,K.call(this,Y,ce),this.lineWidth=qe;this.path=Bt},K=function(Y,ce){if((Y!=="stroke"||ce||!_.call(this))&&(Y==="stroke"||ce||!c.call(this))){for(var re,te,we=[],ke=this.path,We=0;We<ke.length;We++){var qe=ke[We];switch(qe.type){case"begin":we.push({begin:!0});break;case"close":we.push({close:!0});break;case"mt":we.push({start:qe,deltas:[],abs:[]});break;case"lt":var gt=we.length;if(ke[We-1]&&!isNaN(ke[We-1].x)&&(re=[qe.x-ke[We-1].x,qe.y-ke[We-1].y],gt>0)){for(;gt>=0;gt--)if(we[gt-1].close!==!0&&we[gt-1].begin!==!0){we[gt-1].deltas.push(re),we[gt-1].abs.push(qe);break}}break;case"bct":re=[qe.x1-ke[We-1].x,qe.y1-ke[We-1].y,qe.x2-ke[We-1].x,qe.y2-ke[We-1].y,qe.x-ke[We-1].x,qe.y-ke[We-1].y],we[we.length-1].deltas.push(re);break;case"qct":var lt=ke[We-1].x+2/3*(qe.x1-ke[We-1].x),Bt=ke[We-1].y+2/3*(qe.y1-ke[We-1].y),ht=qe.x+2/3*(qe.x1-qe.x),ct=qe.y+2/3*(qe.y1-qe.y),Xe=qe.x,Se=qe.y;re=[lt-ke[We-1].x,Bt-ke[We-1].y,ht-ke[We-1].x,ct-ke[We-1].y,Xe-ke[We-1].x,Se-ke[We-1].y],we[we.length-1].deltas.push(re);break;case"arc":we.push({deltas:[],abs:[],arc:!0}),Array.isArray(we[we.length-1].abs)&&we[we.length-1].abs.push(qe)}}te=ce?null:Y==="stroke"?"stroke":"fill";for(var At=!1,Et=0;Et<we.length;Et++)if(we[Et].arc)for(var wt=we[Et].abs,Kt=0;Kt<wt.length;Kt++){var $t=wt[Kt];$t.type==="arc"?le.call(this,$t.x,$t.y,$t.radius,$t.startAngle,$t.endAngle,$t.counterclockwise,void 0,ce,!At):ze.call(this,$t.x,$t.y),At=!0}else if(we[Et].close===!0)this.pdf.internal.out("h"),At=!1;else if(we[Et].begin!==!0){var yt=we[Et].start.x,ri=we[Et].start.y;De.call(this,we[Et].deltas,yt,ri),At=!0}te&&ve.call(this,te),ce&&ot.call(this)}},se=function(Y){var ce=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,re=ce*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Y-re;case"top":return Y+ce-re;case"hanging":return Y+ce-2*re;case"middle":return Y+ce/2-re;case"ideographic":return Y;case"alphabetic":default:return Y}},he=function(Y){return Y+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};d.prototype.createLinearGradient=function(){var Y=function(){};return Y.colorStops=[],Y.addColorStop=function(ce,re){this.colorStops.push([ce,re])},Y.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Y.isCanvasGradient=!0,Y},d.prototype.createPattern=function(){return this.createLinearGradient()},d.prototype.createRadialGradient=function(){return this.createLinearGradient()};var le=function(Y,ce,re,te,we,ke,We,qe,gt){for(var lt=ft.call(this,re,te,we,ke),Bt=0;Bt<lt.length;Bt++){var ht=lt[Bt];Bt===0&&(gt?_e.call(this,ht.x1+Y,ht.y1+ce):ze.call(this,ht.x1+Y,ht.y1+ce)),at.call(this,Y,ce,ht.x2,ht.y2,ht.x3,ht.y3,ht.x4,ht.y4)}qe?ot.call(this):ve.call(this,We)},ve=function(Y){switch(Y){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ot=function(){this.pdf.clip(),this.pdf.discardPath()},_e=function(Y,ce){this.pdf.internal.out(A(Y)+" "+D(ce)+" m")},pe=function(Y){var ce;switch(Y.align){case"right":case"end":ce="right";break;case"center":ce="center";break;case"left":case"start":default:ce="left"}var re=this.pdf.getTextDimensions(Y.text),te=se.call(this,Y.y),we=he.call(this,te)-re.h,ke=this.ctx.transform.applyToPoint(new V(Y.x,te)),We=this.ctx.transform.decompose(),qe=new l;qe=(qe=(qe=qe.multiply(We.translate)).multiply(We.skew)).multiply(We.scale);for(var gt,lt,Bt,ht=this.ctx.transform.applyToRectangle(new t(Y.x,te,re.w,re.h)),ct=qe.applyToRectangle(new t(Y.x,we,re.w,re.h)),Xe=g.call(this,ct),Se=[],At=0;At<Xe.length;At+=1)Se.indexOf(Xe[At])===-1&&Se.push(Xe[At]);if(B(Se),this.autoPaging)for(var Et=Se[0],wt=Se[Se.length-1],Kt=Et;Kt<wt+1;Kt++){this.pdf.setPage(Kt);var $t=Kt===1?this.posY+this.margin[0]:this.margin[0],yt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ri=this.pdf.internal.pageSize.height-this.margin[2],mi=ri-this.margin[0],xi=this.pdf.internal.pageSize.width-this.margin[1],Li=xi-this.margin[3],Ue=Kt===1?0:yt+(Kt-2)*mi;if(this.ctx.clip_path.length!==0){var ge=this.path;gt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=L(gt,this.posX+this.margin[3],-1*Ue+$t),K.call(this,"fill",!0),this.path=ge}var Rt=L([JSON.parse(JSON.stringify(ct))],this.posX+this.margin[3],-Ue+$t+this.ctx.prevPageLastElemOffset)[0];Y.scale>=.01&&(lt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(lt*Y.scale),Bt=this.lineWidth,this.lineWidth=Bt*Y.scale);var si=this.autoPaging!=="text";if(si||Rt.y+Rt.h<=ri){if(si||Rt.y>=$t&&Rt.x<=xi){var jt=si?Y.text:this.pdf.splitTextToSize(Y.text,Y.maxWidth||xi-Rt.x)[0],Ii=L([JSON.parse(JSON.stringify(ht))],this.posX+this.margin[3],-Ue+$t+this.ctx.prevPageLastElemOffset)[0],wi=si&&(Kt>Et||Kt<wt)&&w.call(this);wi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Li,mi,null).clip().discardPath()),this.pdf.text(jt,Ii.x,Ii.y,{angle:Y.angle,align:ce,renderingMode:Y.renderingMode}),wi&&this.pdf.restoreGraphicsState()}}else Rt.y<ri&&(this.ctx.prevPageLastElemOffset+=ri-Rt.y);Y.scale>=.01&&(this.pdf.setFontSize(lt),this.lineWidth=Bt)}else Y.scale>=.01&&(lt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(lt*Y.scale),Bt=this.lineWidth,this.lineWidth=Bt*Y.scale),this.pdf.text(Y.text,ke.x+this.posX,ke.y+this.posY,{angle:Y.angle,align:ce,renderingMode:Y.renderingMode,maxWidth:Y.maxWidth}),Y.scale>=.01&&(this.pdf.setFontSize(lt),this.lineWidth=Bt)},ze=function(Y,ce,re,te){re=re||0,te=te||0,this.pdf.internal.out(A(Y+re)+" "+D(ce+te)+" l")},De=function(Y,ce,re){return this.pdf.lines(Y,ce,re,null,null)},at=function(Y,ce,re,te,we,ke,We,qe){this.pdf.internal.out([f(R(re+Y)),f(z(te+ce)),f(R(we+Y)),f(z(ke+ce)),f(R(We+Y)),f(z(qe+ce)),"c"].join(" "))},ft=function(Y,ce,re,te){for(var we=2*Math.PI,ke=Math.PI/2;ce>re;)ce-=we;var We=Math.abs(re-ce);We<we&&te&&(We=we-We);for(var qe=[],gt=te?-1:1,lt=ce;We>1e-5;){var Bt=lt+gt*Math.min(We,ke);qe.push(xt.call(this,Y,lt,Bt)),We-=Math.abs(Bt-lt),lt=Bt}return qe},xt=function(Y,ce,re){var te=(re-ce)/2,we=Y*Math.cos(te),ke=Y*Math.sin(te),We=we,qe=-ke,gt=We*We+qe*qe,lt=gt+We*we+qe*ke,Bt=4/3*(Math.sqrt(2*gt*lt)-lt)/(We*ke-qe*we),ht=We-Bt*qe,ct=qe+Bt*We,Xe=ht,Se=-ct,At=te+ce,Et=Math.cos(At),wt=Math.sin(At);return{x1:Y*Math.cos(ce),y1:Y*Math.sin(ce),x2:ht*Et-ct*wt,y2:ht*wt+ct*Et,x3:Xe*Et-Se*wt,y3:Xe*wt+Se*Et,x4:Y*Math.cos(re),y4:Y*Math.sin(re)}},He=function(Y){return 180*Y/Math.PI},ae=function(Y,ce,re,te,we,ke){var We=Y+.5*(re-Y),qe=ce+.5*(te-ce),gt=we+.5*(re-we),lt=ke+.5*(te-ke),Bt=Math.min(Y,we,We,gt),ht=Math.max(Y,we,We,gt),ct=Math.min(ce,ke,qe,lt),Xe=Math.max(ce,ke,qe,lt);return new t(Bt,ct,ht-Bt,Xe-ct)},Te=function(Y,ce,re,te,we,ke,We,qe){var gt,lt,Bt,ht,ct,Xe,Se,At,Et,wt,Kt,$t,yt,ri,mi=re-Y,xi=te-ce,Li=we-re,Ue=ke-te,ge=We-we,Rt=qe-ke;for(lt=0;lt<41;lt++)Et=(Se=(Bt=Y+(gt=lt/40)*mi)+gt*((ct=re+gt*Li)-Bt))+gt*(ct+gt*(we+gt*ge-ct)-Se),wt=(At=(ht=ce+gt*xi)+gt*((Xe=te+gt*Ue)-ht))+gt*(Xe+gt*(ke+gt*Rt-Xe)-At),lt==0?(Kt=Et,$t=wt,yt=Et,ri=wt):(Kt=Math.min(Kt,Et),$t=Math.min($t,wt),yt=Math.max(yt,Et),ri=Math.max(ri,wt));return new t(Math.round(Kt),Math.round($t),Math.round(yt-Kt),Math.round(ri-$t))},Oe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Y,ce,re=(Y=this.ctx.lineDash,ce=this.ctx.lineDashOffset,JSON.stringify({lineDash:Y,lineDashOffset:ce}));this.prevLineDash!==re&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=re)}}})(tr.API),function(M){var f=function(z){var V,t,l,v,x,d,m,c,_,w;for(t=[],l=0,v=(z+=V="\0\0\0\0".slice(z.length%4||4)).length;v>l;l+=4)(x=(z.charCodeAt(l)<<24)+(z.charCodeAt(l+1)<<16)+(z.charCodeAt(l+2)<<8)+z.charCodeAt(l+3))!==0?(d=(x=((x=((x=((x=(x-(w=x%85))/85)-(_=x%85))/85)-(c=x%85))/85)-(m=x%85))/85)%85,t.push(d+33,m+33,c+33,_+33,w+33)):t.push(122);return function(g,C){for(var L=C;L>0;L--)g.pop()}(t,V.length),String.fromCharCode.apply(String,t)+"~>"},A=function(z){var V,t,l,v,x,d=String,m="length",c=255,_="charCodeAt",w="slice",g="replace";for(z[w](-2),z=z[w](0,-2)[g](/\s/g,"")[g]("z","!!!!!"),l=[],v=0,x=(z+=V="uuuuu"[w](z[m]%5||5))[m];x>v;v+=5)t=52200625*(z[_](v)-33)+614125*(z[_](v+1)-33)+7225*(z[_](v+2)-33)+85*(z[_](v+3)-33)+(z[_](v+4)-33),l.push(c&t>>24,c&t>>16,c&t>>8,c&t);return function(C,L){for(var B=L;B>0;B--)C.pop()}(l,V[m]),d.fromCharCode.apply(d,l)},D=function(z){var V=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((z=z.replace(/\s/g,"")).indexOf(">")!==-1&&(z=z.substr(0,z.indexOf(">"))),z.length%2&&(z+="0"),V.test(z)===!1)return"";for(var t="",l=0;l<z.length;l+=2)t+=String.fromCharCode("0x"+(z[l]+z[l+1]));return t},R=function(z){for(var V=new Uint8Array(z.length),t=z.length;t--;)V[t]=z.charCodeAt(t);return z=(V=sp(V)).reduce(function(l,v){return l+String.fromCharCode(v)},"")};M.processDataByFilters=function(z,V){var t=0,l=z||"",v=[];for(typeof(V=V||[])=="string"&&(V=[V]),t=0;t<V.length;t+=1)switch(V[t]){case"ASCII85Decode":case"/ASCII85Decode":l=A(l),v.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=f(l),v.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=D(l),v.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=l.split("").map(function(x){return("0"+x.charCodeAt().toString(16)).slice(-2)}).join("")+">",v.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=R(l),v.push("/FlateDecode");break;default:throw new Error('The filter: "'+V[t]+'" is not implemented')}return{data:l,reverseChain:v.reverse().join(" ")}}}(tr.API),function(M){M.loadFile=function(f,A,D){return function(R,z,V){z=z!==!1,V=typeof V=="function"?V:function(){};var t=void 0;try{t=function(l,v,x){var d=new XMLHttpRequest,m=0,c=function(_){var w=_.length,g=[],C=String.fromCharCode;for(m=0;m<w;m+=1)g.push(C(255&_.charCodeAt(m)));return g.join("")};if(d.open("GET",l,!v),d.overrideMimeType("text/plain; charset=x-user-defined"),v===!1&&(d.onload=function(){d.status===200?x(c(this.responseText)):x(void 0)}),d.send(null),v&&d.status===200)return c(d.responseText)}(R,z,V)}catch{}return t}(f,A,D)},M.loadImageFile=M.loadFile}(tr.API),function(M){function f(){return(cr.html2canvas?Promise.resolve(cr.html2canvas):ep(()=>import("./html2canvas.esm-e0a7d97b.js"),[],import.meta.url)).catch(function(V){return Promise.reject(new Error("Could not load html2canvas: "+V))}).then(function(V){return V.default?V.default:V})}function A(){return(cr.DOMPurify?Promise.resolve(cr.DOMPurify):ep(()=>import("./purify.es-cf254a40.js"),[],import.meta.url)).catch(function(V){return Promise.reject(new Error("Could not load dompurify: "+V))}).then(function(V){return V.default?V.default:V})}var D=function(V){var t=rn(V);return t==="undefined"?"undefined":t==="string"||V instanceof String?"string":t==="number"||V instanceof Number?"number":t==="function"||V instanceof Function?"function":V&&V.constructor===Array?"array":V&&V.nodeType===1?"element":t==="object"?"object":"unknown"},R=function(V,t){var l=document.createElement(V);for(var v in t.className&&(l.className=t.className),t.innerHTML&&t.dompurify&&(l.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)l.style[v]=t.style[v];return l},z=function V(t){var l=Object.assign(V.convert(Promise.resolve()),JSON.parse(JSON.stringify(V.template))),v=V.convert(Promise.resolve(),l);return v=(v=v.setProgress(1,V,1,[V])).set(t)};(z.prototype=Object.create(Promise.prototype)).constructor=z,z.convert=function(V,t){return V.__proto__=t||z.prototype,V},z.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},z.prototype.from=function(V,t){return this.then(function(){switch(t=t||function(l){switch(D(l)){case"string":return"string";case"element":return l.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(V)){case"string":return this.then(A).then(function(l){return this.set({src:R("div",{innerHTML:V,dompurify:l})})});case"element":return this.set({src:V});case"canvas":return this.set({canvas:V});case"img":return this.set({img:V});default:return this.error("Unknown source type.")}})},z.prototype.to=function(V){switch(V){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},z.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var V={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=function l(v,x){for(var d=v.nodeType===3?document.createTextNode(v.nodeValue):v.cloneNode(!1),m=v.firstChild;m;m=m.nextSibling)x!==!0&&m.nodeType===1&&m.nodeName==="SCRIPT"||d.appendChild(l(m,x));return v.nodeType===1&&(v.nodeName==="CANVAS"?(d.width=v.width,d.height=v.height,d.getContext("2d").drawImage(v,0,0)):v.nodeName!=="TEXTAREA"&&v.nodeName!=="SELECT"||(d.value=v.value),d.addEventListener("load",function(){d.scrollTop=v.scrollTop,d.scrollLeft=v.scrollLeft},!0)),d}(this.prop.src,this.opt.html2canvas.javascriptEnabled);t.tagName==="BODY"&&(V.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=R("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=R("div",{className:"html2pdf__container",style:V}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(R("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},z.prototype.toCanvas=function(){var V=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(V).then(f).then(function(t){var l=Object.assign({},this.opt.html2canvas);return delete l.onrendered,t(this.prop.container,l)}).then(function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},z.prototype.toContext2d=function(){var V=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(V).then(f).then(function(t){var l=this.opt.jsPDF,v=this.opt.fontFaces,x=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,d=Object.assign({async:!0,allowTaint:!0,scale:x,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete d.onrendered,l.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,l.context2d.posX=this.opt.x,l.context2d.posY=this.opt.y,l.context2d.margin=this.opt.margin,l.context2d.fontFaces=v,v)for(var m=0;m<v.length;++m){var c=v[m],_=c.src.find(function(w){return w.format==="truetype"});_&&l.addFont(_.url,c.ref.name,c.ref.style)}return d.windowHeight=d.windowHeight||0,d.windowHeight=d.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):d.windowHeight,l.context2d.save(!0),t(this.prop.container,d)}).then(function(t){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},z.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var V=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=V})},z.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},z.prototype.output=function(V,t,l){return(l=l||"pdf").toLowerCase()==="img"||l.toLowerCase()==="image"?this.outputImg(V,t):this.outputPdf(V,t)},z.prototype.outputPdf=function(V,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(V,t)})},z.prototype.outputImg=function(V){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(V){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+V+'" is not supported.'}})},z.prototype.save=function(V){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(V?{filename:V}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},z.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},z.prototype.set=function(V){if(D(V)!=="object")return this;var t=Object.keys(V||{}).map(function(l){if(l in z.template.prop)return function(){this.prop[l]=V[l]};switch(l){case"margin":return this.setMargin.bind(this,V.margin);case"jsPDF":return function(){return this.opt.jsPDF=V.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,V.pageSize);default:return function(){this.opt[l]=V[l]}}},this);return this.then(function(){return this.thenList(t)})},z.prototype.get=function(V,t){return this.then(function(){var l=V in z.template.prop?this.prop[V]:this.opt[V];return t?t(l):l})},z.prototype.setMargin=function(V){return this.then(function(){switch(D(V)){case"number":V=[V,V,V,V];case"array":if(V.length===2&&(V=[V[0],V[1],V[0],V[1]]),V.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=V}).then(this.setPageSize)},z.prototype.setPageSize=function(V){function t(l,v){return Math.floor(l*v/72*96)}return this.then(function(){(V=V||tr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(V.inner={width:V.width-this.opt.margin[1]-this.opt.margin[3],height:V.height-this.opt.margin[0]-this.opt.margin[2]},V.inner.px={width:t(V.inner.width,V.k),height:t(V.inner.height,V.k)},V.inner.ratio=V.inner.height/V.inner.width),this.prop.pageSize=V})},z.prototype.setProgress=function(V,t,l,v){return V!=null&&(this.progress.val=V),t!=null&&(this.progress.state=t),l!=null&&(this.progress.n=l),v!=null&&(this.progress.stack=v),this.progress.ratio=this.progress.val/this.progress.state,this},z.prototype.updateProgress=function(V,t,l,v){return this.setProgress(V?this.progress.val+V:null,t||null,l?this.progress.n+l:null,v?this.progress.stack.concat(v):null)},z.prototype.then=function(V,t){var l=this;return this.thenCore(V,t,function(v,x){return l.updateProgress(null,null,1,[v]),Promise.prototype.then.call(this,function(d){return l.updateProgress(null,v),d}).then(v,x).then(function(d){return l.updateProgress(1),d})})},z.prototype.thenCore=function(V,t,l){l=l||Promise.prototype.then,V&&(V=V.bind(this)),t&&(t=t.bind(this));var v=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:z.convert(Object.assign({},this),Promise.prototype),x=l.call(v,V,t);return z.convert(x,this.__proto__)},z.prototype.thenExternal=function(V,t){return Promise.prototype.then.call(this,V,t)},z.prototype.thenList=function(V){var t=this;return V.forEach(function(l){t=t.thenCore(l)}),t},z.prototype.catch=function(V){V&&(V=V.bind(this));var t=Promise.prototype.catch.call(this,V);return z.convert(t,this)},z.prototype.catchExternal=function(V){return Promise.prototype.catch.call(this,V)},z.prototype.error=function(V){return this.then(function(){throw new Error(V)})},z.prototype.using=z.prototype.set,z.prototype.saveAs=z.prototype.save,z.prototype.export=z.prototype.output,z.prototype.run=z.prototype.then,tr.getPageSize=function(V,t,l){if(rn(V)==="object"){var v=V;V=v.orientation,t=v.unit||t,l=v.format||l}t=t||"mm",l=l||"a4",V=(""+(V||"P")).toLowerCase();var x,d=(""+l).toLowerCase(),m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":x=1;break;case"mm":x=72/25.4;break;case"cm":x=72/2.54;break;case"in":x=72;break;case"px":x=.75;break;case"pc":case"em":x=12;break;case"ex":x=6;break;default:throw"Invalid unit: "+t}var c,_=0,w=0;if(m.hasOwnProperty(d))_=m[d][1]/x,w=m[d][0]/x;else try{_=l[1],w=l[0]}catch{throw new Error("Invalid format: "+l)}if(V==="p"||V==="portrait")V="p",w>_&&(c=w,w=_,_=c);else{if(V!=="l"&&V!=="landscape")throw"Invalid orientation: "+V;V="l",_>w&&(c=w,w=_,_=c)}return{width:w,height:_,unit:t,k:x,orientation:V}},M.html=function(V,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(up):null;var l=new z(t);return t.worker?l:l.from(V).doCallback()}}(tr.API),tr.API.addJS=function(M){return f_=M,this.internal.events.subscribe("postPutResources",function(){Cf=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Cf+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),u_=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+f_+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Cf!==void 0&&u_!==void 0&&this.internal.out("/Names <</JavaScript "+Cf+" 0 R>>")}),this},function(M){var f;M.events.push(["postPutResources",function(){var A=this,D=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var R=A.outline.render().split(/\r\n/),z=0;z<R.length;z++){var V=R[z],t=D.exec(V);if(t!=null){var l=t[1];A.internal.newObjectDeferredBegin(l,!1)}A.internal.write(V)}if(this.outline.createNamedDestinations){var v=this.internal.pages.length,x=[];for(z=0;z<v;z++){var d=A.internal.newObject();x.push(d);var m=A.internal.getPageInfo(z+1);A.internal.write("<< /D["+m.objId+" 0 R /XYZ null null null]>> endobj")}var c=A.internal.newObject();for(A.internal.write("<< /Names [ "),z=0;z<x.length;z++)A.internal.write("(page_"+(z+1)+")"+x[z]+" 0 R");A.internal.write(" ] >>","endobj"),f=A.internal.newObject(),A.internal.write("<< /Dests "+c+" 0 R"),A.internal.write(">>","endobj")}}]),M.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+f+" 0 R"))}]),M.events.push(["initialized",function(){var A=this;A.outline={createNamedDestinations:!1,root:{children:[]}},A.outline.add=function(D,R,z){var V={title:R,options:z,children:[]};return D==null&&(D=this.root),D.children.push(V),V},A.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=A,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},A.outline.genIds_r=function(D){D.id=A.internal.newObjectDeferred();for(var R=0;R<D.children.length;R++)this.genIds_r(D.children[R])},A.outline.renderRoot=function(D){this.objStart(D),this.line("/Type /Outlines"),D.children.length>0&&(this.line("/First "+this.makeRef(D.children[0])),this.line("/Last "+this.makeRef(D.children[D.children.length-1]))),this.line("/Count "+this.count_r({count:0},D)),this.objEnd()},A.outline.renderItems=function(D){for(var R=this.ctx.pdf.internal.getVerticalCoordinateString,z=0;z<D.children.length;z++){var V=D.children[z];this.objStart(V),this.line("/Title "+this.makeString(V.title)),this.line("/Parent "+this.makeRef(D)),z>0&&this.line("/Prev "+this.makeRef(D.children[z-1])),z<D.children.length-1&&this.line("/Next "+this.makeRef(D.children[z+1])),V.children.length>0&&(this.line("/First "+this.makeRef(V.children[0])),this.line("/Last "+this.makeRef(V.children[V.children.length-1])));var t=this.count=this.count_r({count:0},V);if(t>0&&this.line("/Count "+t),V.options&&V.options.pageNumber){var l=A.internal.getPageInfo(V.options.pageNumber);this.line("/Dest ["+l.objId+" 0 R /XYZ 0 "+R(0)+" 0]")}this.objEnd()}for(var v=0;v<D.children.length;v++)this.renderItems(D.children[v])},A.outline.line=function(D){this.ctx.val+=D+`\r
`},A.outline.makeRef=function(D){return D.id+" 0 R"},A.outline.makeString=function(D){return"("+A.internal.pdfEscape(D)+")"},A.outline.objStart=function(D){this.ctx.val+=`\r
`+D.id+` 0 obj\r
<<\r
`},A.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},A.outline.count_r=function(D,R){for(var z=0;z<R.children.length;z++)D.count++,this.count_r(D,R.children[z]);return D.count}}])}(tr.API),function(M){var f=[192,193,194,195,196,197,198,199];M.processJPEG=function(A,D,R,z,V,t){var l,v=this.decode.DCT_DECODE,x=null;if(typeof A=="string"||this.__addimage__.isArrayBuffer(A)||this.__addimage__.isArrayBufferView(A)){switch(A=V||A,A=this.__addimage__.isArrayBuffer(A)?new Uint8Array(A):A,(l=function(d){for(var m,c=256*d.charCodeAt(4)+d.charCodeAt(5),_=d.length,w={width:0,height:0,numcomponents:1},g=4;g<_;g+=2){if(g+=c,f.indexOf(d.charCodeAt(g+1))!==-1){m=256*d.charCodeAt(g+5)+d.charCodeAt(g+6),w={width:256*d.charCodeAt(g+7)+d.charCodeAt(g+8),height:m,numcomponents:d.charCodeAt(g+9)};break}c=256*d.charCodeAt(g+2)+d.charCodeAt(g+3)}return w}(A=this.__addimage__.isArrayBufferView(A)?this.__addimage__.arrayBufferToBinaryString(A):A)).numcomponents){case 1:t=this.color_spaces.DEVICE_GRAY;break;case 4:t=this.color_spaces.DEVICE_CMYK;break;case 3:t=this.color_spaces.DEVICE_RGB}x={data:A,width:l.width,height:l.height,colorSpace:t,bitsPerComponent:8,filter:v,index:D,alias:R}}return x}}(tr.API);var Fh,Af,d_,p_,m_,ev=function(){var M,f,A;function D(z){var V,t,l,v,x,d,m,c,_,w,g,C,L,B;for(this.data=z,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(V=this.readUInt32(),_=function(){var q,K;for(K=[],q=0;q<4;++q)K.push(String.fromCharCode(this.data[this.pos++]));return K}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(V);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},x=this.readUInt16(),v=this.readUInt16()||100,d.delay=1e3*x/v,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(_==="fdAT"&&(this.pos+=4,V-=4),z=(d!=null?d.data:void 0)||this.imgData,C=0;0<=V?C<V:C>V;0<=V?++C:--C)z.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(l=this.palette.length/3,this.transparency.indexed=this.read(V),this.transparency.indexed.length>l)throw new Error("More transparent colors than palette size");if((w=l-this.transparency.indexed.length)>0)for(L=0;0<=w?L<w:L>w;0<=w?++L:--L)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(V)[0];break;case 2:this.transparency.rgb=this.read(V)}break;case"tEXt":m=(g=this.read(V)).indexOf(0),c=String.fromCharCode.apply(String,g.slice(0,m)),this.text[c]=String.fromCharCode.apply(String,g.slice(m+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(B=this.colorType)===4||B===6,t=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*t,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=V}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}D.prototype.read=function(z){var V,t;for(t=[],V=0;0<=z?V<z:V>z;0<=z?++V:--V)t.push(this.data[this.pos++]);return t},D.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},D.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},D.prototype.decodePixels=function(z){var V=this.pixelBitlength/8,t=new Uint8Array(this.width*this.height*V),l=0,v=this;if(z==null&&(z=this.imgData),z.length===0)return new Uint8Array(0);function x(d,m,c,_){var w,g,C,L,B,q,K,se,he,le,ve,ot,_e,pe,ze,De,at,ft,xt,He,ae,Te=Math.ceil((v.width-d)/c),Oe=Math.ceil((v.height-m)/_),Y=v.width==Te&&v.height==Oe;for(pe=V*Te,ot=Y?t:new Uint8Array(pe*Oe),q=z.length,_e=0,g=0;_e<Oe&&l<q;){switch(z[l++]){case 0:for(L=at=0;at<pe;L=at+=1)ot[g++]=z[l++];break;case 1:for(L=ft=0;ft<pe;L=ft+=1)w=z[l++],B=L<V?0:ot[g-V],ot[g++]=(w+B)%256;break;case 2:for(L=xt=0;xt<pe;L=xt+=1)w=z[l++],C=(L-L%V)/V,ze=_e&&ot[(_e-1)*pe+C*V+L%V],ot[g++]=(ze+w)%256;break;case 3:for(L=He=0;He<pe;L=He+=1)w=z[l++],C=(L-L%V)/V,B=L<V?0:ot[g-V],ze=_e&&ot[(_e-1)*pe+C*V+L%V],ot[g++]=(w+Math.floor((B+ze)/2))%256;break;case 4:for(L=ae=0;ae<pe;L=ae+=1)w=z[l++],C=(L-L%V)/V,B=L<V?0:ot[g-V],_e===0?ze=De=0:(ze=ot[(_e-1)*pe+C*V+L%V],De=C&&ot[(_e-1)*pe+(C-1)*V+L%V]),K=B+ze-De,se=Math.abs(K-B),le=Math.abs(K-ze),ve=Math.abs(K-De),he=se<=le&&se<=ve?B:le<=ve?ze:De,ot[g++]=(w+he)%256;break;default:throw new Error("Invalid filter algorithm: "+z[l-1])}if(!Y){var ce=((m+_e*_)*v.width+d)*V,re=_e*pe;for(L=0;L<Te;L+=1){for(var te=0;te<V;te+=1)t[ce++]=ot[re++];ce+=(c-1)*V}}_e++}}return z=D1(z),v.interlaceMethod==1?(x(0,0,8,8),x(4,0,8,8),x(0,4,4,8),x(2,0,4,4),x(0,2,2,4),x(1,0,2,2),x(0,1,1,2)):x(0,0,1,1),t},D.prototype.decodePalette=function(){var z,V,t,l,v,x,d,m,c;for(t=this.palette,x=this.transparency.indexed||[],v=new Uint8Array((x.length||0)+t.length),l=0,z=0,V=d=0,m=t.length;d<m;V=d+=3)v[l++]=t[V],v[l++]=t[V+1],v[l++]=t[V+2],v[l++]=(c=x[z++])!=null?c:255;return v},D.prototype.copyToImageData=function(z,V){var t,l,v,x,d,m,c,_,w,g,C;if(l=this.colors,w=null,t=this.hasAlphaChannel,this.palette.length&&(w=(C=this._decodedPalette)!=null?C:this._decodedPalette=this.decodePalette(),l=4,t=!0),_=(v=z.data||z).length,d=w||V,x=m=0,l===1)for(;x<_;)c=w?4*V[x/4]:m,g=d[c++],v[x++]=g,v[x++]=g,v[x++]=g,v[x++]=t?d[c++]:255,m=c;else for(;x<_;)c=w?4*V[x/4]:m,v[x++]=d[c++],v[x++]=d[c++],v[x++]=d[c++],v[x++]=t?d[c++]:255,m=c},D.prototype.decode=function(){var z;return z=new Uint8Array(this.width*this.height*4),this.copyToImageData(z,this.decodePixels()),z};var R=function(){if(Object.prototype.toString.call(cr)==="[object Window]"){try{f=cr.document.createElement("canvas"),A=f.getContext("2d")}catch{return!1}return!0}return!1};return R(),M=function(z){var V;if(R()===!0)return A.width=z.width,A.height=z.height,A.clearRect(0,0,z.width,z.height),A.putImageData(z,0,0),(V=new Image).src=f.toDataURL(),V;throw new Error("This method requires a Browser with Canvas-capability.")},D.prototype.decodeFrames=function(z){var V,t,l,v,x,d,m,c;if(this.animation){for(c=[],t=x=0,d=(m=this.animation.frames).length;x<d;t=++x)V=m[t],l=z.createImageData(V.width,V.height),v=this.decodePixels(new Uint8Array(V.data)),this.copyToImageData(l,v),V.imageData=l,c.push(V.image=M(l));return c}},D.prototype.renderFrame=function(z,V){var t,l,v;return t=(l=this.animation.frames)[V],v=l[V-1],V===0&&z.clearRect(0,0,this.width,this.height),(v!=null?v.disposeOp:void 0)===1?z.clearRect(v.xOffset,v.yOffset,v.width,v.height):(v!=null?v.disposeOp:void 0)===2&&z.putImageData(v.imageData,v.xOffset,v.yOffset),t.blendOp===0&&z.clearRect(t.xOffset,t.yOffset,t.width,t.height),z.drawImage(t.image,t.xOffset,t.yOffset)},D.prototype.animate=function(z){var V,t,l,v,x,d,m=this;return t=0,d=this.animation,v=d.numFrames,l=d.frames,x=d.numPlays,(V=function(){var c,_;if(c=t++%v,_=l[c],m.renderFrame(z,c),v>1&&t/v<x)return m.animation._timeout=setTimeout(V,_.delay)})()},D.prototype.stopAnimation=function(){var z;return clearTimeout((z=this.animation)!=null?z._timeout:void 0)},D.prototype.render=function(z){var V,t;return z._png&&z._png.stopAnimation(),z._png=this,z.width=this.width,z.height=this.height,V=z.getContext("2d"),this.animation?(this.decodeFrames(V),this.animate(V)):(t=V.createImageData(this.width,this.height),this.copyToImageData(t,this.decodePixels()),V.putImageData(t,0,0))},D}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function tv(M){var f=0;if(M[f++]!==71||M[f++]!==73||M[f++]!==70||M[f++]!==56||(M[f++]+1&253)!=56||M[f++]!==97)throw new Error("Invalid GIF 87a/89a header.");var A=M[f++]|M[f++]<<8,D=M[f++]|M[f++]<<8,R=M[f++],z=R>>7,V=1<<(7&R)+1;M[f++],M[f++];var t=null,l=null;z&&(t=f,l=V,f+=3*V);var v=!0,x=[],d=0,m=null,c=0,_=null;for(this.width=A,this.height=D;v&&f<M.length;)switch(M[f++]){case 33:switch(M[f++]){case 255:if(M[f]!==11||M[f+1]==78&&M[f+2]==69&&M[f+3]==84&&M[f+4]==83&&M[f+5]==67&&M[f+6]==65&&M[f+7]==80&&M[f+8]==69&&M[f+9]==50&&M[f+10]==46&&M[f+11]==48&&M[f+12]==3&&M[f+13]==1&&M[f+16]==0)f+=14,_=M[f++]|M[f++]<<8,f++;else for(f+=12;;){if(!((_e=M[f++])>=0))throw Error("Invalid block size");if(_e===0)break;f+=_e}break;case 249:if(M[f++]!==4||M[f+4]!==0)throw new Error("Invalid graphics extension block.");var w=M[f++];d=M[f++]|M[f++]<<8,m=M[f++],!(1&w)&&(m=null),c=w>>2&7,f++;break;case 254:for(;;){if(!((_e=M[f++])>=0))throw Error("Invalid block size");if(_e===0)break;f+=_e}break;default:throw new Error("Unknown graphic control label: 0x"+M[f-1].toString(16))}break;case 44:var g=M[f++]|M[f++]<<8,C=M[f++]|M[f++]<<8,L=M[f++]|M[f++]<<8,B=M[f++]|M[f++]<<8,q=M[f++],K=q>>6&1,se=1<<(7&q)+1,he=t,le=l,ve=!1;q>>7&&(ve=!0,he=f,le=se,f+=3*se);var ot=f;for(f++;;){var _e;if(!((_e=M[f++])>=0))throw Error("Invalid block size");if(_e===0)break;f+=_e}x.push({x:g,y:C,width:L,height:B,has_local_palette:ve,palette_offset:he,palette_size:le,data_offset:ot,data_length:f-ot,transparent_index:m,interlaced:!!K,delay:d,disposal:c});break;case 59:v=!1;break;default:throw new Error("Unknown gif block: 0x"+M[f-1].toString(16))}this.numFrames=function(){return x.length},this.loopCount=function(){return _},this.frameInfo=function(pe){if(pe<0||pe>=x.length)throw new Error("Frame index out of range.");return x[pe]},this.decodeAndBlitFrameBGRA=function(pe,ze){var De=this.frameInfo(pe),at=De.width*De.height,ft=new Uint8Array(at);g_(M,De.data_offset,ft,at);var xt=De.palette_offset,He=De.transparent_index;He===null&&(He=256);var ae=De.width,Te=A-ae,Oe=ae,Y=4*(De.y*A+De.x),ce=4*((De.y+De.height)*A+De.x),re=Y,te=4*Te;De.interlaced===!0&&(te+=4*A*7);for(var we=8,ke=0,We=ft.length;ke<We;++ke){var qe=ft[ke];if(Oe===0&&(Oe=ae,(re+=te)>=ce&&(te=4*Te+4*A*(we-1),re=Y+(ae+Te)*(we<<1),we>>=1)),qe===He)re+=4;else{var gt=M[xt+3*qe],lt=M[xt+3*qe+1],Bt=M[xt+3*qe+2];ze[re++]=Bt,ze[re++]=lt,ze[re++]=gt,ze[re++]=255}--Oe}},this.decodeAndBlitFrameRGBA=function(pe,ze){var De=this.frameInfo(pe),at=De.width*De.height,ft=new Uint8Array(at);g_(M,De.data_offset,ft,at);var xt=De.palette_offset,He=De.transparent_index;He===null&&(He=256);var ae=De.width,Te=A-ae,Oe=ae,Y=4*(De.y*A+De.x),ce=4*((De.y+De.height)*A+De.x),re=Y,te=4*Te;De.interlaced===!0&&(te+=4*A*7);for(var we=8,ke=0,We=ft.length;ke<We;++ke){var qe=ft[ke];if(Oe===0&&(Oe=ae,(re+=te)>=ce&&(te=4*Te+4*A*(we-1),re=Y+(ae+Te)*(we<<1),we>>=1)),qe===He)re+=4;else{var gt=M[xt+3*qe],lt=M[xt+3*qe+1],Bt=M[xt+3*qe+2];ze[re++]=gt,ze[re++]=lt,ze[re++]=Bt,ze[re++]=255}--Oe}}}function g_(M,f,A,D){for(var R=M[f++],z=1<<R,V=z+1,t=V+1,l=R+1,v=(1<<l)-1,x=0,d=0,m=0,c=M[f++],_=new Int32Array(4096),w=null;;){for(;x<16&&c!==0;)d|=M[f++]<<x,x+=8,c===1?c=M[f++]:--c;if(x<l)break;var g=d&v;if(d>>=l,x-=l,g!==z){if(g===V)break;for(var C=g<t?g:w,L=0,B=C;B>z;)B=_[B]>>8,++L;var q=B;if(m+L+(C!==g?1:0)>D)return void hn.log("Warning, gif stream longer than expected.");A[m++]=q;var K=m+=L;for(C!==g&&(A[m++]=q),B=C;L--;)B=_[B],A[--K]=255&B,B>>=8;w!==null&&t<4096&&(_[t++]=w<<8|q,t>=v+1&&l<12&&(++l,v=v<<1|1)),w=g}else t=V+1,v=(1<<(l=R+1))-1,w=null}return m!==D&&hn.log("Warning, gif stream shorter than expected."),A}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Kd(M){var f,A,D,R,z,V=Math.floor,t=new Array(64),l=new Array(64),v=new Array(64),x=new Array(64),d=new Array(65535),m=new Array(65535),c=new Array(64),_=new Array(64),w=[],g=0,C=7,L=new Array(64),B=new Array(64),q=new Array(64),K=new Array(256),se=new Array(2048),he=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],le=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ve=[0,1,2,3,4,5,6,7,8,9,10,11],ot=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],_e=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],pe=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ze=[0,1,2,3,4,5,6,7,8,9,10,11],De=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],at=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ft(Y,ce){for(var re=0,te=0,we=new Array,ke=1;ke<=16;ke++){for(var We=1;We<=Y[ke];We++)we[ce[te]]=[],we[ce[te]][0]=re,we[ce[te]][1]=ke,te++,re++;re*=2}return we}function xt(Y){for(var ce=Y[0],re=Y[1]-1;re>=0;)ce&1<<re&&(g|=1<<C),re--,--C<0&&(g==255?(He(255),He(0)):He(g),C=7,g=0)}function He(Y){w.push(Y)}function ae(Y){He(Y>>8&255),He(255&Y)}function Te(Y,ce,re,te,we){for(var ke,We=we[0],qe=we[240],gt=function(wt,Kt){var $t,yt,ri,mi,xi,Li,Ue,ge,Rt,si,jt=0;for(Rt=0;Rt<8;++Rt){$t=wt[jt],yt=wt[jt+1],ri=wt[jt+2],mi=wt[jt+3],xi=wt[jt+4],Li=wt[jt+5],Ue=wt[jt+6];var Ii=$t+(ge=wt[jt+7]),wi=$t-ge,or=yt+Ue,Ti=yt-Ue,Yi=ri+Li,qr=ri-Li,Hi=mi+xi,je=mi-xi,oe=Ii+Hi,fe=Ii-Hi,Ve=or+Yi,Ke=or-Yi;wt[jt]=oe+Ve,wt[jt+4]=oe-Ve;var $e=.707106781*(Ke+fe);wt[jt+2]=fe+$e,wt[jt+6]=fe-$e;var dt=.382683433*((oe=je+qr)-(Ke=Ti+wi)),bt=.5411961*oe+dt,st=1.306562965*Ke+dt,Dt=.707106781*(Ve=qr+Ti),ti=wi+Dt,Vt=wi-Dt;wt[jt+5]=Vt+bt,wt[jt+3]=Vt-bt,wt[jt+1]=ti+st,wt[jt+7]=ti-st,jt+=8}for(jt=0,Rt=0;Rt<8;++Rt){$t=wt[jt],yt=wt[jt+8],ri=wt[jt+16],mi=wt[jt+24],xi=wt[jt+32],Li=wt[jt+40],Ue=wt[jt+48];var ni=$t+(ge=wt[jt+56]),Ui=$t-ge,Vi=yt+Ue,ki=yt-Ue,Fi=ri+Li,Wi=ri-Li,Ar=mi+xi,Pr=mi-xi,kr=ni+Ar,Sr=ni-Ar,un=Vi+Fi,Or=Vi-Fi;wt[jt]=kr+un,wt[jt+32]=kr-un;var Fr=.707106781*(Or+Sr);wt[jt+16]=Sr+Fr,wt[jt+48]=Sr-Fr;var Bn=.382683433*((kr=Pr+Wi)-(Or=ki+Ui)),Io=.5411961*kr+Bn,Hs=1.306562965*Or+Bn,hr=.707106781*(un=Wi+ki),$s=Ui+hr,kn=Ui-hr;wt[jt+40]=kn+Io,wt[jt+24]=kn-Io,wt[jt+8]=$s+Hs,wt[jt+56]=$s-Hs,jt++}for(Rt=0;Rt<64;++Rt)si=wt[Rt]*Kt[Rt],c[Rt]=si>0?si+.5|0:si-.5|0;return c}(Y,ce),lt=0;lt<64;++lt)_[he[lt]]=gt[lt];var Bt=_[0]-re;re=_[0],Bt==0?xt(te[0]):(xt(te[m[ke=32767+Bt]]),xt(d[ke]));for(var ht=63;ht>0&&_[ht]==0;)ht--;if(ht==0)return xt(We),re;for(var ct,Xe=1;Xe<=ht;){for(var Se=Xe;_[Xe]==0&&Xe<=ht;)++Xe;var At=Xe-Se;if(At>=16){ct=At>>4;for(var Et=1;Et<=ct;++Et)xt(qe);At&=15}ke=32767+_[Xe],xt(we[(At<<4)+m[ke]]),xt(d[ke]),Xe++}return ht!=63&&xt(We),re}function Oe(Y){Y=Math.min(Math.max(Y,1),100),z!=Y&&(function(ce){for(var re=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],te=0;te<64;te++){var we=V((re[te]*ce+50)/100);we=Math.min(Math.max(we,1),255),t[he[te]]=we}for(var ke=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],We=0;We<64;We++){var qe=V((ke[We]*ce+50)/100);qe=Math.min(Math.max(qe,1),255),l[he[We]]=qe}for(var gt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],lt=0,Bt=0;Bt<8;Bt++)for(var ht=0;ht<8;ht++)v[lt]=1/(t[he[lt]]*gt[Bt]*gt[ht]*8),x[lt]=1/(l[he[lt]]*gt[Bt]*gt[ht]*8),lt++}(Y<50?Math.floor(5e3/Y):Math.floor(200-2*Y)),z=Y)}this.encode=function(Y,ce){ce&&Oe(ce),w=new Array,g=0,C=7,ae(65496),ae(65504),ae(16),He(74),He(70),He(73),He(70),He(0),He(1),He(1),He(0),ae(1),ae(1),He(0),He(0),function(){ae(65499),ae(132),He(0);for(var yt=0;yt<64;yt++)He(t[yt]);He(1);for(var ri=0;ri<64;ri++)He(l[ri])}(),function(yt,ri){ae(65472),ae(17),He(8),ae(ri),ae(yt),He(3),He(1),He(17),He(0),He(2),He(17),He(1),He(3),He(17),He(1)}(Y.width,Y.height),function(){ae(65476),ae(418),He(0);for(var yt=0;yt<16;yt++)He(le[yt+1]);for(var ri=0;ri<=11;ri++)He(ve[ri]);He(16);for(var mi=0;mi<16;mi++)He(ot[mi+1]);for(var xi=0;xi<=161;xi++)He(_e[xi]);He(1);for(var Li=0;Li<16;Li++)He(pe[Li+1]);for(var Ue=0;Ue<=11;Ue++)He(ze[Ue]);He(17);for(var ge=0;ge<16;ge++)He(De[ge+1]);for(var Rt=0;Rt<=161;Rt++)He(at[Rt])}(),ae(65498),ae(12),He(3),He(1),He(0),He(2),He(17),He(3),He(17),He(0),He(63),He(0);var re=0,te=0,we=0;g=0,C=7,this.encode.displayName="_encode_";for(var ke,We,qe,gt,lt,Bt,ht,ct,Xe,Se=Y.data,At=Y.width,Et=Y.height,wt=4*At,Kt=0;Kt<Et;){for(ke=0;ke<wt;){for(lt=wt*Kt+ke,ht=-1,ct=0,Xe=0;Xe<64;Xe++)Bt=lt+(ct=Xe>>3)*wt+(ht=4*(7&Xe)),Kt+ct>=Et&&(Bt-=wt*(Kt+1+ct-Et)),ke+ht>=wt&&(Bt-=ke+ht-wt+4),We=Se[Bt++],qe=Se[Bt++],gt=Se[Bt++],L[Xe]=(se[We]+se[qe+256>>0]+se[gt+512>>0]>>16)-128,B[Xe]=(se[We+768>>0]+se[qe+1024>>0]+se[gt+1280>>0]>>16)-128,q[Xe]=(se[We+1280>>0]+se[qe+1536>>0]+se[gt+1792>>0]>>16)-128;re=Te(L,v,re,f,D),te=Te(B,x,te,A,R),we=Te(q,x,we,A,R),ke+=32}Kt+=8}if(C>=0){var $t=[];$t[1]=C+1,$t[0]=(1<<C+1)-1,xt($t)}return ae(65497),new Uint8Array(w)},M=M||50,function(){for(var Y=String.fromCharCode,ce=0;ce<256;ce++)K[ce]=Y(ce)}(),f=ft(le,ve),A=ft(pe,ze),D=ft(ot,_e),R=ft(De,at),function(){for(var Y=1,ce=2,re=1;re<=15;re++){for(var te=Y;te<ce;te++)m[32767+te]=re,d[32767+te]=[],d[32767+te][1]=re,d[32767+te][0]=te;for(var we=-(ce-1);we<=-Y;we++)m[32767+we]=re,d[32767+we]=[],d[32767+we][1]=re,d[32767+we][0]=ce-1+we;Y<<=1,ce<<=1}}(),function(){for(var Y=0;Y<256;Y++)se[Y]=19595*Y,se[Y+256>>0]=38470*Y,se[Y+512>>0]=7471*Y+32768,se[Y+768>>0]=-11059*Y,se[Y+1024>>0]=-21709*Y,se[Y+1280>>0]=32768*Y+8421375,se[Y+1536>>0]=-27439*Y,se[Y+1792>>0]=-5329*Y}(),Oe(M)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function $a(M,f){if(this.pos=0,this.buffer=M,this.datav=new DataView(M.buffer),this.is_with_alpha=!!f,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function __(M){function f(le){if(!le)throw Error("assert :P")}function A(le,ve,ot){for(var _e=0;4>_e;_e++)if(le[ve+_e]!=ot.charCodeAt(_e))return!0;return!1}function D(le,ve,ot,_e,pe){for(var ze=0;ze<pe;ze++)le[ve+ze]=ot[_e+ze]}function R(le,ve,ot,_e){for(var pe=0;pe<_e;pe++)le[ve+pe]=ot}function z(le){return new Int32Array(le)}function V(le,ve){for(var ot=[],_e=0;_e<le;_e++)ot.push(new ve);return ot}function t(le,ve){var ot=[];return function _e(pe,ze,De){for(var at=De[ze],ft=0;ft<at&&(pe.push(De.length>ze+1?[]:new ve),!(De.length<ze+1));ft++)_e(pe[ft],ze+1,De)}(ot,0,le),ot}var l=function(){var le=this;function ve(E,k){for(var W=1<<k-1>>>0;E&W;)W>>>=1;return W?(E&W-1)+W:E}function ot(E,k,W,J,de){f(!(J%W));do E[k+(J-=W)]=de;while(0<J)}function _e(E,k,W,J,de){if(f(2328>=de),512>=de)var ye=z(512);else if((ye=z(de))==null)return 0;return function(be,Me,Ie,Ge,mt,Ft){var zt,St,h=Me,r=1<<Ie,o=z(16),u=z(16);for(f(mt!=0),f(Ge!=null),f(be!=null),f(0<Ie),St=0;St<mt;++St){if(15<Ge[St])return 0;++o[Ge[St]]}if(o[0]==mt)return 0;for(u[1]=0,zt=1;15>zt;++zt){if(o[zt]>1<<zt)return 0;u[zt+1]=u[zt]+o[zt]}for(St=0;St<mt;++St)zt=Ge[St],0<Ge[St]&&(Ft[u[zt]++]=St);if(u[15]==1)return(Ge=new pe).g=0,Ge.value=Ft[0],ot(be,h,1,r,Ge),r;var b,S=-1,I=r-1,F=0,N=1,H=1,X=1<<Ie;for(St=0,zt=1,mt=2;zt<=Ie;++zt,mt<<=1){if(N+=H<<=1,0>(H-=o[zt]))return 0;for(;0<o[zt];--o[zt])(Ge=new pe).g=zt,Ge.value=Ft[St++],ot(be,h+F,mt,X,Ge),F=ve(F,zt)}for(zt=Ie+1,mt=2;15>=zt;++zt,mt<<=1){if(N+=H<<=1,0>(H-=o[zt]))return 0;for(;0<o[zt];--o[zt]){if(Ge=new pe,(F&I)!=S){for(h+=X,b=1<<(S=zt)-Ie;15>S&&!(0>=(b-=o[S]));)++S,b<<=1;r+=X=1<<(b=S-Ie),be[Me+(S=F&I)].g=b+Ie,be[Me+S].value=h-Me-S}Ge.g=zt-Ie,Ge.value=Ft[St++],ot(be,h+(F>>Ie),mt,X,Ge),F=ve(F,zt)}}return N!=2*u[15]-1?0:r}(E,k,W,J,de,ye)}function pe(){this.value=this.g=0}function ze(){this.value=this.g=0}function De(){this.G=V(5,pe),this.H=z(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=V(On,ze)}function at(E,k,W,J){f(E!=null),f(k!=null),f(2147483648>J),E.Ca=254,E.I=0,E.b=-8,E.Ka=0,E.oa=k,E.pa=W,E.Jd=k,E.Yc=W+J,E.Zc=4<=J?W+J-4+1:W,ke(E)}function ft(E,k){for(var W=0;0<k--;)W|=qe(E,128)<<k;return W}function xt(E,k){var W=ft(E,k);return We(E)?-W:W}function He(E,k,W,J){var de,ye=0;for(f(E!=null),f(k!=null),f(4294967288>J),E.Sb=J,E.Ra=0,E.u=0,E.h=0,4<J&&(J=4),de=0;de<J;++de)ye+=k[W+de]<<8*de;E.Ra=ye,E.bb=J,E.oa=k,E.pa=W}function ae(E){for(;8<=E.u&&E.bb<E.Sb;)E.Ra>>>=8,E.Ra+=E.oa[E.pa+E.bb]<<_o-8>>>0,++E.bb,E.u-=8;re(E)&&(E.h=1,E.u=0)}function Te(E,k){if(f(0<=k),!E.h&&k<=ia){var W=ce(E)&io[k];return E.u+=k,ae(E),W}return E.h=1,E.u=0}function Oe(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Y(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function ce(E){return E.Ra>>>(E.u&_o-1)>>>0}function re(E){return f(E.bb<=E.Sb),E.h||E.bb==E.Sb&&E.u>_o}function te(E,k){E.u=k,E.h=re(E)}function we(E){E.u>=Ca&&(f(E.u>=Ca),ae(E))}function ke(E){f(E!=null&&E.oa!=null),E.pa<E.Zc?(E.I=(E.oa[E.pa++]|E.I<<8)>>>0,E.b+=8):(f(E!=null&&E.oa!=null),E.pa<E.Yc?(E.b+=8,E.I=E.oa[E.pa++]|E.I<<8):E.Ka?E.b=0:(E.I<<=8,E.b+=8,E.Ka=1))}function We(E){return ft(E,1)}function qe(E,k){var W=E.Ca;0>E.b&&ke(E);var J=E.b,de=W*k>>>8,ye=(E.I>>>J>de)+0;for(ye?(W-=de,E.I-=de+1<<J>>>0):W=de+1,J=W,de=0;256<=J;)de+=8,J>>=8;return J=7^de+ln[J],E.b-=J,E.Ca=(W<<J)-1,ye}function gt(E,k,W){E[k+0]=W>>24&255,E[k+1]=W>>16&255,E[k+2]=W>>8&255,E[k+3]=W>>0&255}function lt(E,k){return E[k+0]<<0|E[k+1]<<8}function Bt(E,k){return lt(E,k)|E[k+2]<<16}function ht(E,k){return lt(E,k)|lt(E,k+2)<<16}function ct(E,k){var W=1<<k;return f(E!=null),f(0<k),E.X=z(W),E.X==null?0:(E.Mb=32-k,E.Xa=k,1)}function Xe(E,k){f(E!=null),f(k!=null),f(E.Xa==k.Xa),D(k.X,0,E.X,0,1<<k.Xa)}function Se(){this.X=[],this.Xa=this.Mb=0}function At(E,k,W,J){f(W!=null),f(J!=null);var de=W[0],ye=J[0];return de==0&&(de=(E*ye+k/2)/k),ye==0&&(ye=(k*de+E/2)/E),0>=de||0>=ye?0:(W[0]=de,J[0]=ye,1)}function Et(E,k){return E+(1<<k)-1>>>k}function wt(E,k){return((4278255360&E)+(4278255360&k)>>>0&4278255360)+((16711935&E)+(16711935&k)>>>0&16711935)>>>0}function Kt(E,k){le[k]=function(W,J,de,ye,be,Me,Ie){var Ge;for(Ge=0;Ge<be;++Ge){var mt=le[E](Me[Ie+Ge-1],de,ye+Ge);Me[Ie+Ge]=wt(W[J+Ge],mt)}}}function $t(){this.ud=this.hd=this.jd=0}function yt(E,k){return((4278124286&(E^k))>>>1)+(E&k)>>>0}function ri(E){return 0<=E&&256>E?E:0>E?0:255<E?255:void 0}function mi(E,k){return ri(E+(E-k+.5>>1))}function xi(E,k,W){return Math.abs(k-W)-Math.abs(E-W)}function Li(E,k,W,J,de,ye,be){for(J=ye[be-1],W=0;W<de;++W)ye[be+W]=J=wt(E[k+W],J)}function Ue(E,k,W,J,de){var ye;for(ye=0;ye<W;++ye){var be=E[k+ye],Me=be>>8&255,Ie=16711935&(Ie=(Ie=16711935&be)+((Me<<16)+Me));J[de+ye]=(4278255360&be)+Ie>>>0}}function ge(E,k){k.jd=E>>0&255,k.hd=E>>8&255,k.ud=E>>16&255}function Rt(E,k,W,J,de,ye){var be;for(be=0;be<J;++be){var Me=k[W+be],Ie=Me>>>8,Ge=Me,mt=255&(mt=(mt=Me>>>16)+((E.jd<<24>>24)*(Ie<<24>>24)>>>5));Ge=255&(Ge=(Ge=Ge+((E.hd<<24>>24)*(Ie<<24>>24)>>>5))+((E.ud<<24>>24)*(mt<<24>>24)>>>5)),de[ye+be]=(4278255360&Me)+(mt<<16)+Ge}}function si(E,k,W,J,de){le[k]=function(ye,be,Me,Ie,Ge,mt,Ft,zt,St){for(Ie=Ft;Ie<zt;++Ie)for(Ft=0;Ft<St;++Ft)Ge[mt++]=de(Me[J(ye[be++])])},le[E]=function(ye,be,Me,Ie,Ge,mt,Ft){var zt=8>>ye.b,St=ye.Ea,h=ye.K[0],r=ye.w;if(8>zt)for(ye=(1<<ye.b)-1,r=(1<<zt)-1;be<Me;++be){var o,u=0;for(o=0;o<St;++o)o&ye||(u=J(Ie[Ge++])),mt[Ft++]=de(h[u&r]),u>>=zt}else le["VP8LMapColor"+W](Ie,Ge,h,r,mt,Ft,be,Me,St)}}function jt(E,k,W,J,de){for(W=k+W;k<W;){var ye=E[k++];J[de++]=ye>>16&255,J[de++]=ye>>8&255,J[de++]=ye>>0&255}}function Ii(E,k,W,J,de){for(W=k+W;k<W;){var ye=E[k++];J[de++]=ye>>16&255,J[de++]=ye>>8&255,J[de++]=ye>>0&255,J[de++]=ye>>24&255}}function wi(E,k,W,J,de){for(W=k+W;k<W;){var ye=(be=E[k++])>>16&240|be>>12&15,be=be>>0&240|be>>28&15;J[de++]=ye,J[de++]=be}}function or(E,k,W,J,de){for(W=k+W;k<W;){var ye=(be=E[k++])>>16&248|be>>13&7,be=be>>5&224|be>>3&31;J[de++]=ye,J[de++]=be}}function Ti(E,k,W,J,de){for(W=k+W;k<W;){var ye=E[k++];J[de++]=ye>>0&255,J[de++]=ye>>8&255,J[de++]=ye>>16&255}}function Yi(E,k,W,J,de,ye){if(ye==0)for(W=k+W;k<W;)gt(J,((ye=E[k++])[0]>>24|ye[1]>>8&65280|ye[2]<<8&16711680|ye[3]<<24)>>>0),de+=32;else D(J,de,E,k,W)}function qr(E,k){le[k][0]=le[E+"0"],le[k][1]=le[E+"1"],le[k][2]=le[E+"2"],le[k][3]=le[E+"3"],le[k][4]=le[E+"4"],le[k][5]=le[E+"5"],le[k][6]=le[E+"6"],le[k][7]=le[E+"7"],le[k][8]=le[E+"8"],le[k][9]=le[E+"9"],le[k][10]=le[E+"10"],le[k][11]=le[E+"11"],le[k][12]=le[E+"12"],le[k][13]=le[E+"13"],le[k][14]=le[E+"0"],le[k][15]=le[E+"0"]}function Hi(E){return E==Fa||E==cl||E==za||E==yi}function je(){this.eb=[],this.size=this.A=this.fb=0}function oe(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function fe(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new je,this.f.kb=new oe,this.sd=null}function Ve(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ke(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function $e(E){return alert("todo:WebPSamplerProcessPlane"),E.T}function dt(E,k){var W=E.T,J=k.ba.f.RGBA,de=J.eb,ye=J.fb+E.ka*J.A,be=ms[k.ba.S],Me=E.y,Ie=E.O,Ge=E.f,mt=E.N,Ft=E.ea,zt=E.W,St=k.cc,h=k.dc,r=k.Mc,o=k.Nc,u=E.ka,b=E.ka+E.T,S=E.U,I=S+1>>1;for(u==0?be(Me,Ie,null,null,Ge,mt,Ft,zt,Ge,mt,Ft,zt,de,ye,null,null,S):(be(k.ec,k.fc,Me,Ie,St,h,r,o,Ge,mt,Ft,zt,de,ye-J.A,de,ye,S),++W);u+2<b;u+=2)St=Ge,h=mt,r=Ft,o=zt,mt+=E.Rc,zt+=E.Rc,ye+=2*J.A,be(Me,(Ie+=2*E.fa)-E.fa,Me,Ie,St,h,r,o,Ge,mt,Ft,zt,de,ye-J.A,de,ye,S);return Ie+=E.fa,E.j+b<E.o?(D(k.ec,k.fc,Me,Ie,S),D(k.cc,k.dc,Ge,mt,I),D(k.Mc,k.Nc,Ft,zt,I),W--):1&b||be(Me,Ie,null,null,Ge,mt,Ft,zt,Ge,mt,Ft,zt,de,ye+J.A,null,null,S),W}function bt(E,k,W){var J=E.F,de=[E.J];if(J!=null){var ye=E.U,be=k.ba.S,Me=be==Xo||be==za;k=k.ba.f.RGBA;var Ie=[0],Ge=E.ka;Ie[0]=E.T,E.Kb&&(Ge==0?--Ie[0]:(--Ge,de[0]-=E.width),E.j+E.ka+E.T==E.o&&(Ie[0]=E.o-E.j-Ge));var mt=k.eb;Ge=k.fb+Ge*k.A,E=xo(J,de[0],E.width,ye,Ie,mt,Ge+(Me?0:3),k.A),f(W==Ie),E&&Hi(be)&&Ds(mt,Ge,Me,ye,Ie,k.A)}return 0}function st(E){var k=E.ma,W=k.ba.S,J=11>W,de=W==Rl||W==Wo||W==Xo||W==Nl||W==12||Hi(W);if(k.memory=null,k.Ib=null,k.Jb=null,k.Nd=null,!el(k.Oa,E,de?11:12))return 0;if(de&&Hi(W)&&pi(),E.da)alert("todo:use_scaling");else{if(J){if(k.Ib=$e,E.Kb){if(W=E.U+1>>1,k.memory=z(E.U+2*W),k.memory==null)return 0;k.ec=k.memory,k.fc=0,k.cc=k.ec,k.dc=k.fc+E.U,k.Mc=k.cc,k.Nc=k.dc+W,k.Ib=dt,pi()}}else alert("todo:EmitYUV");de&&(k.Jb=bt,J&&It())}if(J&&!uh){for(E=0;256>E;++E)Fs[E]=89858*(E-128)+Gl>>ql,oo[E]=-22014*(E-128)+Gl,Uh[E]=-45773*(E-128),fh[E]=113618*(E-128)+Gl>>ql;for(E=bn;E<Pc;++E)k=76283*(E-16)+Gl>>ql,wo[E-bn]=Cs(k,255),Ra[E-bn]=Cs(k+8>>4,15);uh=1}return 1}function Dt(E){var k=E.ma,W=E.U,J=E.T;return f(!(1&E.ka)),0>=W||0>=J?0:(W=k.Ib(E,k),k.Jb!=null&&k.Jb(E,k,W),k.Dc+=W,1)}function ti(E){E.ma.memory=null}function Vt(E,k,W,J){return Te(E,8)!=47?0:(k[0]=Te(E,14)+1,W[0]=Te(E,14)+1,J[0]=Te(E,1),Te(E,3)!=0?0:!E.h)}function ni(E,k){if(4>E)return E+1;var W=E-2>>1;return(2+(1&E)<<W)+Te(k,W)+1}function Ui(E,k){return 120<k?k-120:1<=(W=((W=Ul[k-1])>>4)*E+(8-(15&W)))?W:1;var W}function Vi(E,k,W){var J=ce(W),de=E[k+=255&J].g-8;return 0<de&&(te(W,W.u+8),J=ce(W),k+=E[k].value,k+=J&(1<<de)-1),te(W,W.u+E[k].g),E[k].value}function ki(E,k,W){return W.g+=E.g,W.value+=E.value<<k>>>0,f(8>=W.g),E.g}function Fi(E,k,W){var J=E.xc;return f((k=J==0?0:E.vc[E.md*(W>>J)+(k>>J)])<E.Wb),E.Ya[k]}function Wi(E,k,W,J){var de=E.ab,ye=E.c*k,be=E.C;k=be+k;var Me=W,Ie=J;for(J=E.Ta,W=E.Ua;0<de--;){var Ge=E.gc[de],mt=be,Ft=k,zt=Me,St=Ie,h=(Ie=J,Me=W,Ge.Ea);switch(f(mt<Ft),f(Ft<=Ge.nc),Ge.hc){case 2:Ea(zt,St,(Ft-mt)*h,Ie,Me);break;case 0:var r=mt,o=Ft,u=Ie,b=Me,S=(X=Ge).Ea;r==0&&(rl(zt,St,null,null,1,u,b),Li(zt,St+1,0,0,S-1,u,b+1),St+=S,b+=S,++r);for(var I=1<<X.b,F=I-1,N=Et(S,X.b),H=X.K,X=X.w+(r>>X.b)*N;r<o;){var ee=H,me=X,xe=1;for(Aa(zt,St,u,b-S,1,u,b);xe<S;){var Ee=(xe&~F)+I;Ee>S&&(Ee=S),(0,ro[ee[me++]>>8&15])(zt,St+ +xe,u,b+xe-S,Ee-xe,u,b+xe),xe=Ee}St+=S,b+=S,++r&F||(X+=N)}Ft!=Ge.nc&&D(Ie,Me-h,Ie,Me+(Ft-mt-1)*h,h);break;case 1:for(h=zt,o=St,S=(zt=Ge.Ea)-(b=zt&~(u=(St=1<<Ge.b)-1)),r=Et(zt,Ge.b),I=Ge.K,Ge=Ge.w+(mt>>Ge.b)*r;mt<Ft;){for(F=I,N=Ge,H=new $t,X=o+b,ee=o+zt;o<X;)ge(F[N++],H),Hn(H,h,o,St,Ie,Me),o+=St,Me+=St;o<ee&&(ge(F[N++],H),Hn(H,h,o,S,Ie,Me),o+=S,Me+=S),++mt&u||(Ge+=r)}break;case 3:if(zt==Ie&&St==Me&&0<Ge.b){for(o=Ie,zt=h=Me+(Ft-mt)*h-(b=(Ft-mt)*Et(Ge.Ea,Ge.b)),St=Ie,u=Me,r=[],b=(S=b)-1;0<=b;--b)r[b]=St[u+b];for(b=S-1;0<=b;--b)o[zt+b]=r[b];Is(Ge,mt,Ft,Ie,h,Ie,Me)}else Is(Ge,mt,Ft,zt,St,Ie,Me)}Me=J,Ie=W}Ie!=W&&D(J,W,Me,Ie,ye)}function Ar(E,k){var W=E.V,J=E.Ba+E.c*E.C,de=k-E.C;if(f(k<=E.l.o),f(16>=de),0<de){var ye=E.l,be=E.Ta,Me=E.Ua,Ie=ye.width;if(Wi(E,de,W,J),de=Me=[Me],f((W=E.C)<(J=k)),f(ye.v<ye.va),J>ye.o&&(J=ye.o),W<ye.j){var Ge=ye.j-W;W=ye.j,de[0]+=Ge*Ie}if(W>=J?W=0:(de[0]+=4*ye.v,ye.ka=W-ye.j,ye.U=ye.va-ye.v,ye.T=J-W,W=1),W){if(Me=Me[0],11>(W=E.ca).S){var mt=W.f.RGBA,Ft=(J=W.S,de=ye.U,ye=ye.T,Ge=mt.eb,mt.A),zt=ye;for(mt=mt.fb+E.Ma*mt.A;0<zt--;){var St=be,h=Me,r=de,o=Ge,u=mt;switch(J){case Os:ks(St,h,r,o,u);break;case Rl:yo(St,h,r,o,u);break;case Fa:yo(St,h,r,o,u),Ds(o,u,0,r,1,0);break;case Bl:Ma(St,h,r,o,u);break;case Wo:Yi(St,h,r,o,u,1);break;case cl:Yi(St,h,r,o,u,1),Ds(o,u,0,r,1,0);break;case Xo:Yi(St,h,r,o,u,0);break;case za:Yi(St,h,r,o,u,0),Ds(o,u,1,r,1,0);break;case Nl:vo(St,h,r,o,u);break;case yi:vo(St,h,r,o,u),Da(o,u,r,1,0);break;case ll:no(St,h,r,o,u);break;default:f(0)}Me+=Ie,mt+=Ft}E.Ma+=ye}else alert("todo:EmitRescaledRowsYUVA");f(E.Ma<=W.height)}}E.C=k,f(E.C<=E.i)}function Pr(E){var k;if(0<E.ua)return 0;for(k=0;k<E.Wb;++k){var W=E.Ya[k].G,J=E.Ya[k].H;if(0<W[1][J[1]+0].g||0<W[2][J[2]+0].g||0<W[3][J[3]+0].g)return 0}return 1}function kr(E,k,W,J,de,ye){if(E.Z!=0){var be=E.qd,Me=E.rd;for(f(Ho[E.Z]!=null);k<W;++k)Ho[E.Z](be,Me,J,de,J,de,ye),be=J,Me=de,de+=ye;E.qd=be,E.rd=Me}}function Sr(E,k){var W=E.l.ma,J=W.Z==0||W.Z==1?E.l.j:E.C;if(J=E.C<J?J:E.C,f(k<=E.l.o),k>J){var de=E.l.width,ye=W.ca,be=W.tb+de*J,Me=E.V,Ie=E.Ba+E.c*J,Ge=E.gc;f(E.ab==1),f(Ge[0].hc==3),yc(Ge[0],J,k,Me,Ie,ye,be),kr(W,J,k,ye,be,de)}E.C=E.Ma=k}function un(E,k,W,J,de,ye,be){var Me=E.$/J,Ie=E.$%J,Ge=E.m,mt=E.s,Ft=W+E.$,zt=Ft;de=W+J*de;var St=W+J*ye,h=280+mt.ua,r=E.Pb?Me:16777216,o=0<mt.ua?mt.Wa:null,u=mt.wc,b=Ft<St?Fi(mt,Ie,Me):null;f(E.C<ye),f(St<=de);var S=!1;e:for(;;){for(;S||Ft<St;){var I=0;if(Me>=r){var F=Ft-W;f((r=E).Pb),r.wd=r.m,r.xd=F,0<r.s.ua&&Xe(r.s.Wa,r.s.vb),r=Me+xc}if(Ie&u||(b=Fi(mt,Ie,Me)),f(b!=null),b.Qb&&(k[Ft]=b.qb,S=!0),!S)if(we(Ge),b.jc){I=Ge,F=k;var N=Ft,H=b.pd[ce(I)&On-1];f(b.jc),256>H.g?(te(I,I.u+H.g),F[N]=H.value,I=0):(te(I,I.u+H.g-256),f(256<=H.value),I=H.value),I==0&&(S=!0)}else I=Vi(b.G[0],b.H[0],Ge);if(Ge.h)break;if(S||256>I){if(!S)if(b.nd)k[Ft]=(b.qb|I<<8)>>>0;else{if(we(Ge),S=Vi(b.G[1],b.H[1],Ge),we(Ge),F=Vi(b.G[2],b.H[2],Ge),N=Vi(b.G[3],b.H[3],Ge),Ge.h)break;k[Ft]=(N<<24|S<<16|I<<8|F)>>>0}if(S=!1,++Ft,++Ie>=J&&(Ie=0,++Me,be!=null&&Me<=ye&&!(Me%16)&&be(E,Me),o!=null))for(;zt<Ft;)I=k[zt++],o.X[(506832829*I&4294967295)>>>o.Mb]=I}else if(280>I){if(I=ni(I-256,Ge),F=Vi(b.G[4],b.H[4],Ge),we(Ge),F=Ui(J,F=ni(F,Ge)),Ge.h)break;if(Ft-W<F||de-Ft<I)break e;for(N=0;N<I;++N)k[Ft+N]=k[Ft+N-F];for(Ft+=I,Ie+=I;Ie>=J;)Ie-=J,++Me,be!=null&&Me<=ye&&!(Me%16)&&be(E,Me);if(f(Ft<=de),Ie&u&&(b=Fi(mt,Ie,Me)),o!=null)for(;zt<Ft;)I=k[zt++],o.X[(506832829*I&4294967295)>>>o.Mb]=I}else{if(!(I<h))break e;for(S=I-280,f(o!=null);zt<Ft;)I=k[zt++],o.X[(506832829*I&4294967295)>>>o.Mb]=I;I=Ft,f(!(S>>>(F=o).Xa)),k[I]=F.X[S],S=!0}S||f(Ge.h==re(Ge))}if(E.Pb&&Ge.h&&Ft<de)f(E.m.h),E.a=5,E.m=E.wd,E.$=E.xd,0<E.s.ua&&Xe(E.s.vb,E.s.Wa);else{if(Ge.h)break e;be!=null&&be(E,Me>ye?ye:Me),E.a=0,E.$=Ft-W}return 1}return E.a=3,0}function Or(E){f(E!=null),E.vc=null,E.yc=null,E.Ya=null;var k=E.Wa;k!=null&&(k.X=null),E.vb=null,f(E!=null)}function Fr(){var E=new Dl;return E==null?null:(E.a=0,E.xb=tc,qr("Predictor","VP8LPredictors"),qr("Predictor","VP8LPredictors_C"),qr("PredictorAdd","VP8LPredictorsAdd"),qr("PredictorAdd","VP8LPredictorsAdd_C"),Ea=Ue,Hn=Rt,ks=jt,yo=Ii,vo=wi,no=or,Ma=Ti,le.VP8LMapColor32b=Pa,le.VP8LMapColor8b=Ol,E)}function Bn(E,k,W,J,de){var ye=1,be=[E],Me=[k],Ie=J.m,Ge=J.s,mt=null,Ft=0;e:for(;;){if(W)for(;ye&&Te(Ie,1);){var zt=be,St=Me,h=J,r=1,o=h.m,u=h.gc[h.ab],b=Te(o,2);if(h.Oc&1<<b)ye=0;else{switch(h.Oc|=1<<b,u.hc=b,u.Ea=zt[0],u.nc=St[0],u.K=[null],++h.ab,f(4>=h.ab),b){case 0:case 1:u.b=Te(o,3)+2,r=Bn(Et(u.Ea,u.b),Et(u.nc,u.b),0,h,u.K),u.K=u.K[0];break;case 3:var S,I=Te(o,8)+1,F=16<I?0:4<I?1:2<I?2:3;if(zt[0]=Et(u.Ea,F),u.b=F,S=r=Bn(I,1,0,h,u.K)){var N,H=I,X=u,ee=1<<(8>>X.b),me=z(ee);if(me==null)S=0;else{var xe=X.K[0],Ee=X.w;for(me[0]=X.K[0][0],N=1;N<1*H;++N)me[N]=wt(xe[Ee+N],me[N-1]);for(;N<4*ee;++N)me[N]=0;X.K[0]=null,X.K[0]=me,S=1}}r=S;break;case 2:break;default:f(0)}ye=r}}if(be=be[0],Me=Me[0],ye&&Te(Ie,1)&&!(ye=1<=(Ft=Te(Ie,4))&&11>=Ft)){J.a=3;break e}var Pe;if(Pe=ye)t:{var Le,ie,Ce,Re=J,Ne=be,et=Me,Qe=Ft,tt=W,_t=Re.m,ut=Re.s,Ct=[null],ei=1,Tt=0,Gt=Ql[Qe];i:for(;;){if(tt&&Te(_t,1)){var Pt=Te(_t,3)+2,ii=Et(Ne,Pt),Mt=Et(et,Pt),Xt=ii*Mt;if(!Bn(ii,Mt,0,Re,Ct))break i;for(Ct=Ct[0],ut.xc=Pt,Le=0;Le<Xt;++Le){var oi=Ct[Le]>>8&65535;Ct[Le]=oi,oi>=ei&&(ei=oi+1)}}if(_t.h)break i;for(ie=0;5>ie;++ie){var qt=hl[ie];!ie&&0<Qe&&(qt+=1<<Qe),Tt<qt&&(Tt=qt)}var ci=V(ei*Gt,pe),Oi=ei,$i=V(Oi,De);if($i==null)var Si=null;else f(65536>=Oi),Si=$i;var zi=z(Tt);if(Si==null||zi==null||ci==null){Re.a=1;break i}var rr=ci;for(Le=Ce=0;Le<ei;++Le){var Xi=Si[Le],Pi=Xi.G,yr=Xi.H,Lr=0,Tr=1,Ir=0;for(ie=0;5>ie;++ie){qt=hl[ie],Pi[ie]=rr,yr[ie]=Ce,!ie&&0<Qe&&(qt+=1<<Qe);n:{var Cn,wn=qt,ns=Re,gs=zi,Qr=rr,Dr=Ce,xr=0,Br=ns.m,ss=Te(Br,1);if(R(gs,0,0,wn),ss){var $r=Te(Br,1)+1,_s=Te(Br,1),Xl=Te(Br,_s==0?1:8);gs[Xl]=1,$r==2&&(gs[Xl=Te(Br,8)]=1);var So=1}else{var pl=z(19),To=Te(Br,4)+4;if(19<To){ns.a=3;var ao=0;break n}for(Cn=0;Cn<To;++Cn)pl[Fn[Cn]]=Te(Br,3);var $o=void 0,aa=void 0,ml=ns,kc=pl,Dc=wn,Vh=gs,qh=0,la=ml.m,Oc=8,Gh=V(128,pe);r:for(;_e(Gh,0,7,kc,19);){if(Te(la,1)){var Wh=2+2*Te(la,3);if(($o=2+Te(la,Wh))>Dc)break r}else $o=Dc;for(aa=0;aa<Dc&&$o--;){we(la);var Fc=Gh[0+(127&ce(la))];te(la,la.u+Fc.g);var zs=Fc.value;if(16>zs)Vh[aa++]=zs,zs!=0&&(Oc=zs);else{var dh=zs==16,Xh=zs-16,Nu=oh[Xh],ju=Te(la,so[Xh])+Nu;if(aa+ju>Dc)break r;for(var Of=dh?Oc:0;0<ju--;)Vh[aa++]=Of}}qh=1;break r}qh||(ml.a=3),So=qh}(So=So&&!Br.h)&&(xr=_e(Qr,Dr,8,gs,wn)),So&&xr!=0?ao=xr:(ns.a=3,ao=0)}if(ao==0)break i;if(Tr&&jl[ie]==1&&(Tr=rr[Ce].g==0),Lr+=rr[Ce].g,Ce+=ao,3>=ie){var zc,Rc=zi[0];for(zc=1;zc<qt;++zc)zi[zc]>Rc&&(Rc=zi[zc]);Ir+=Rc}}if(Xi.nd=Tr,Xi.Qb=0,Tr&&(Xi.qb=(Pi[3][yr[3]+0].value<<24|Pi[1][yr[1]+0].value<<16|Pi[2][yr[2]+0].value)>>>0,Lr==0&&256>Pi[0][yr[0]+0].value&&(Xi.Qb=1,Xi.qb+=Pi[0][yr[0]+0].value<<8)),Xi.jc=!Xi.Qb&&6>Ir,Xi.jc){var gl,Rs=Xi;for(gl=0;gl<On;++gl){var ys=gl,Yn=Rs.pd[ys],Yo=Rs.G[0][Rs.H[0]+ys];256<=Yo.value?(Yn.g=Yo.g+256,Yn.value=Yo.value):(Yn.g=0,Yn.value=0,ys>>=ki(Yo,8,Yn),ys>>=ki(Rs.G[1][Rs.H[1]+ys],16,Yn),ys>>=ki(Rs.G[2][Rs.H[2]+ys],0,Yn),ki(Rs.G[3][Rs.H[3]+ys],24,Yn))}}}ut.vc=Ct,ut.Wb=ei,ut.Ya=Si,ut.yc=ci,Pe=1;break t}Pe=0}if(!(ye=Pe)){J.a=3;break e}if(0<Ft){if(Ge.ua=1<<Ft,!ct(Ge.Wa,Ft)){J.a=1,ye=0;break e}}else Ge.ua=0;var ca=J,_l=be,Ff=Me,Hh=ca.s,$h=Hh.xc;if(ca.c=_l,ca.i=Ff,Hh.md=Et(_l,$h),Hh.wc=$h==0?-1:(1<<$h)-1,W){J.xb=Vl;break e}if((mt=z(be*Me))==null){J.a=1,ye=0;break e}ye=(ye=un(J,mt,0,be,Me,Me,null))&&!Ie.h;break e}return ye?(de!=null?de[0]=mt:(f(mt==null),f(W)),J.$=0,W||Or(Ge)):Or(Ge),ye}function Io(E,k){var W=E.c*E.i,J=W+k+16*k;return f(E.c<=k),E.V=z(J),E.V==null?(E.Ta=null,E.Ua=0,E.a=1,0):(E.Ta=E.V,E.Ua=E.Ba+W+k,1)}function Hs(E,k){var W=E.C,J=k-W,de=E.V,ye=E.Ba+E.c*W;for(f(k<=E.l.o);0<J;){var be=16<J?16:J,Me=E.l.ma,Ie=E.l.width,Ge=Ie*be,mt=Me.ca,Ft=Me.tb+Ie*W,zt=E.Ta,St=E.Ua;Wi(E,be,de,ye),Oa(zt,St,mt,Ft,Ge),kr(Me,W,W+be,mt,Ft,Ie),J-=be,de+=be*E.c,W+=be}f(W==k),E.C=E.Ma=k}function hr(){this.ub=this.yd=this.td=this.Rb=0}function $s(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function kn(){this.Fb=this.Bb=this.Cb=0,this.Zb=z(4),this.Lb=z(4)}function Qo(){this.Yb=function(){var E=[];return function k(W,J,de){for(var ye=de[J],be=0;be<ye&&(W.push(de.length>J+1?[]:0),!(de.length<J+1));be++)k(W[be],J+1,de)}(E,0,[3,11]),E}()}function ko(){this.jb=z(3),this.Wc=t([4,8],Qo),this.Xc=t([4,17],Qo)}function cs(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new z(4),this.od=new z(4)}function Gn(){this.ld=this.La=this.dd=this.tc=0}function ea(){this.Na=this.la=0}function Do(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Qn(){this.ad=z(384),this.Za=0,this.Ob=z(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function bs(){this.uc=this.M=this.Nb=0,this.wa=Array(new Gn),this.Y=0,this.ya=Array(new Qn),this.aa=0,this.l=new Wn}function fo(){this.y=z(16),this.f=z(8),this.ea=z(8)}function Ut(){this.cb=this.a=0,this.sc="",this.m=new Oe,this.Od=new hr,this.Kc=new $s,this.ed=new cs,this.Qa=new kn,this.Ic=this.$c=this.Aa=0,this.D=new bs,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=V(8,Oe),this.ia=0,this.pb=V(4,Do),this.Pa=new ko,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new fo),this.Hd=0,this.rb=Array(new ea),this.sb=0,this.wa=Array(new Gn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Qn),this.L=this.aa=0,this.gd=t([4,2],Gn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Wn(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Gr(){var E=new Ut;return E!=null&&(E.a=0,E.sc="OK",E.cb=0,E.Xb=0,sa||(sa=Zs)),E}function ur(E,k,W){return E.a==0&&(E.a=k,E.sc=W,E.cb=0),0}function Ys(E,k,W){return 3<=W&&E[k+0]==157&&E[k+1]==1&&E[k+2]==42}function br(E,k){if(E==null)return 0;if(E.a=0,E.sc="OK",k==null)return ur(E,2,"null VP8Io passed to VP8GetHeaders()");var W=k.data,J=k.w,de=k.ha;if(4>de)return ur(E,7,"Truncated header.");var ye=W[J+0]|W[J+1]<<8|W[J+2]<<16,be=E.Od;if(be.Rb=!(1&ye),be.td=ye>>1&7,be.yd=ye>>4&1,be.ub=ye>>5,3<be.td)return ur(E,3,"Incorrect keyframe parameters.");if(!be.yd)return ur(E,4,"Frame not displayable.");J+=3,de-=3;var Me=E.Kc;if(be.Rb){if(7>de)return ur(E,7,"cannot parse picture header");if(!Ys(W,J,de))return ur(E,3,"Bad code word");Me.c=16383&(W[J+4]<<8|W[J+3]),Me.Td=W[J+4]>>6,Me.i=16383&(W[J+6]<<8|W[J+5]),Me.Ud=W[J+6]>>6,J+=7,de-=7,E.za=Me.c+15>>4,E.Ub=Me.i+15>>4,k.width=Me.c,k.height=Me.i,k.Da=0,k.j=0,k.v=0,k.va=k.width,k.o=k.height,k.da=0,k.ib=k.width,k.hb=k.height,k.U=k.width,k.T=k.height,R((ye=E.Pa).jb,0,255,ye.jb.length),f((ye=E.Qa)!=null),ye.Cb=0,ye.Bb=0,ye.Fb=1,R(ye.Zb,0,0,ye.Zb.length),R(ye.Lb,0,0,ye.Lb)}if(be.ub>de)return ur(E,7,"bad partition length");at(ye=E.m,W,J,be.ub),J+=be.ub,de-=be.ub,be.Rb&&(Me.Ld=We(ye),Me.Kd=We(ye)),Me=E.Qa;var Ie,Ge=E.Pa;if(f(ye!=null),f(Me!=null),Me.Cb=We(ye),Me.Cb){if(Me.Bb=We(ye),We(ye)){for(Me.Fb=We(ye),Ie=0;4>Ie;++Ie)Me.Zb[Ie]=We(ye)?xt(ye,7):0;for(Ie=0;4>Ie;++Ie)Me.Lb[Ie]=We(ye)?xt(ye,6):0}if(Me.Bb)for(Ie=0;3>Ie;++Ie)Ge.jb[Ie]=We(ye)?ft(ye,8):255}else Me.Bb=0;if(ye.Ka)return ur(E,3,"cannot parse segment header");if((Me=E.ed).zd=We(ye),Me.Tb=ft(ye,6),Me.wb=ft(ye,3),Me.Pc=We(ye),Me.Pc&&We(ye)){for(Ge=0;4>Ge;++Ge)We(ye)&&(Me.vd[Ge]=xt(ye,6));for(Ge=0;4>Ge;++Ge)We(ye)&&(Me.od[Ge]=xt(ye,6))}if(E.L=Me.Tb==0?0:Me.zd?1:2,ye.Ka)return ur(E,3,"cannot parse filter header");var mt=de;if(de=Ie=J,J=Ie+mt,Me=mt,E.Xb=(1<<ft(E.m,2))-1,mt<3*(Ge=E.Xb))W=7;else{for(Ie+=3*Ge,Me-=3*Ge,mt=0;mt<Ge;++mt){var Ft=W[de+0]|W[de+1]<<8|W[de+2]<<16;Ft>Me&&(Ft=Me),at(E.Jc[+mt],W,Ie,Ft),Ie+=Ft,Me-=Ft,de+=3}at(E.Jc[+Ge],W,Ie,Me),W=Ie<J?0:5}if(W!=0)return ur(E,W,"cannot parse partitions");for(W=ft(Ie=E.m,7),de=We(Ie)?xt(Ie,4):0,J=We(Ie)?xt(Ie,4):0,Me=We(Ie)?xt(Ie,4):0,Ge=We(Ie)?xt(Ie,4):0,Ie=We(Ie)?xt(Ie,4):0,mt=E.Qa,Ft=0;4>Ft;++Ft){if(mt.Cb){var zt=mt.Zb[Ft];mt.Fb||(zt+=W)}else{if(0<Ft){E.pb[Ft]=E.pb[0];continue}zt=W}var St=E.pb[Ft];St.Sc[0]=ul[Cs(zt+de,127)],St.Sc[1]=ec[Cs(zt+0,127)],St.Eb[0]=2*ul[Cs(zt+J,127)],St.Eb[1]=101581*ec[Cs(zt+Me,127)]>>16,8>St.Eb[1]&&(St.Eb[1]=8),St.Qc[0]=ul[Cs(zt+Ge,117)],St.Qc[1]=ec[Cs(zt+Ie,127)],St.lc=zt+Ie}if(!be.Rb)return ur(E,4,"Not a key frame.");for(We(ye),be=E.Pa,W=0;4>W;++W){for(de=0;8>de;++de)for(J=0;3>J;++J)for(Me=0;11>Me;++Me)Ge=qe(ye,wc[W][de][J][Me])?ft(ye,8):lh[W][de][J][Me],be.Wc[W][de].Yb[J][Me]=Ge;for(de=0;17>de;++de)be.Xc[W][de]=be.Wc[W][Sc[de]]}return E.kc=We(ye),E.kc&&(E.Bd=ft(ye,8)),E.cb=1}function Zs(E,k,W,J,de,ye,be){var Me=k[de].Yb[W];for(W=0;16>de;++de){if(!qe(E,Me[W+0]))return de;for(;!qe(E,Me[W+1]);)if(Me=k[++de].Yb[0],W=0,de==16)return 16;var Ie=k[de+1].Yb;if(qe(E,Me[W+2])){var Ge=E,mt=0;if(qe(Ge,(zt=Me)[(Ft=W)+3]))if(qe(Ge,zt[Ft+6])){for(Me=0,Ft=2*(mt=qe(Ge,zt[Ft+8]))+(zt=qe(Ge,zt[Ft+9+mt])),mt=0,zt=fl[Ft];zt[Me];++Me)mt+=mt+qe(Ge,zt[Me]);mt+=3+(8<<Ft)}else qe(Ge,zt[Ft+7])?(mt=7+2*qe(Ge,165),mt+=qe(Ge,145)):mt=5+qe(Ge,159);else mt=qe(Ge,zt[Ft+4])?3+qe(Ge,zt[Ft+5]):2;Me=Ie[2]}else mt=1,Me=Ie[1];Ie=be+bc[de],0>(Ge=E).b&&ke(Ge);var Ft,zt=Ge.b,St=(Ft=Ge.Ca>>1)-(Ge.I>>zt)>>31;--Ge.b,Ge.Ca+=St,Ge.Ca|=1,Ge.I-=(Ft+1&St)<<zt,ye[Ie]=((mt^St)-St)*J[(0<de)+0]}return 16}function po(E){var k=E.rb[E.sb-1];k.la=0,k.Na=0,R(E.zc,0,0,E.zc.length),E.ja=0}function Ks(E,k){if(E==null)return 0;if(k==null)return ur(E,2,"NULL VP8Io parameter in VP8Decode().");if(!E.cb&&!br(E,k))return 0;if(f(E.cb),k.ac==null||k.ac(k)){k.ob&&(E.L=0);var W=bi[E.L];if(E.L==2?(E.yb=0,E.zb=0):(E.yb=k.v-W>>4,E.zb=k.j-W>>4,0>E.yb&&(E.yb=0),0>E.zb&&(E.zb=0)),E.Va=k.o+15+W>>4,E.Hb=k.va+15+W>>4,E.Hb>E.za&&(E.Hb=E.za),E.Va>E.Ub&&(E.Va=E.Ub),0<E.L){var J=E.ed;for(W=0;4>W;++W){var de;if(E.Qa.Cb){var ye=E.Qa.Lb[W];E.Qa.Fb||(ye+=J.Tb)}else ye=J.Tb;for(de=0;1>=de;++de){var be=E.gd[W][de],Me=ye;if(J.Pc&&(Me+=J.vd[0],de&&(Me+=J.od[0])),0<(Me=0>Me?0:63<Me?63:Me)){var Ie=Me;0<J.wb&&(Ie=4<J.wb?Ie>>2:Ie>>1)>9-J.wb&&(Ie=9-J.wb),1>Ie&&(Ie=1),be.dd=Ie,be.tc=2*Me+Ie,be.ld=40<=Me?2:15<=Me?1:0}else be.tc=0;be.La=de}}}W=0}else ur(E,6,"Frame setup failed"),W=E.a;if(W=W==0){if(W){E.$c=0,0<E.Aa||(E.Ic=Ic);e:{W=E.Ic,J=4*(Ie=E.za);var Ge=32*Ie,mt=Ie+1,Ft=0<E.L?Ie*(0<E.Aa?2:1):0,zt=(E.Aa==2?2:1)*Ie;if((be=J+832+(de=3*(16*W+bi[E.L])/2*Ge)+(ye=E.Fa!=null&&0<E.Fa.length?E.Kc.c*E.Kc.i:0))!=be)W=0;else{if(be>E.Vb){if(E.Vb=0,E.Ec=z(be),E.Fc=0,E.Ec==null){W=ur(E,1,"no memory during frame initialization.");break e}E.Vb=be}be=E.Ec,Me=E.Fc,E.Ac=be,E.Bc=Me,Me+=J,E.Gd=V(Ge,fo),E.Hd=0,E.rb=V(mt+1,ea),E.sb=1,E.wa=Ft?V(Ft,Gn):null,E.Y=0,E.D.Nb=0,E.D.wa=E.wa,E.D.Y=E.Y,0<E.Aa&&(E.D.Y+=Ie),f(!0),E.oc=be,E.pc=Me,Me+=832,E.ya=V(zt,Qn),E.aa=0,E.D.ya=E.ya,E.D.aa=E.aa,E.Aa==2&&(E.D.aa+=Ie),E.R=16*Ie,E.B=8*Ie,Ie=(Ge=bi[E.L])*E.R,Ge=Ge/2*E.B,E.sa=be,E.ta=Me+Ie,E.qa=E.sa,E.ra=E.ta+16*W*E.R+Ge,E.Ha=E.qa,E.Ia=E.ra+8*W*E.B+Ge,E.$c=0,Me+=de,E.mb=ye?be:null,E.nb=ye?Me:null,f(Me+ye<=E.Fc+E.Vb),po(E),R(E.Ac,E.Bc,0,J),W=1}}if(W){if(k.ka=0,k.y=E.sa,k.O=E.ta,k.f=E.qa,k.N=E.ra,k.ea=E.Ha,k.Vd=E.Ia,k.fa=E.R,k.Rc=E.B,k.F=null,k.J=0,!vc){for(W=-255;255>=W;++W)Fl[255+W]=0>W?-W:W;for(W=-1020;1020>=W;++W)zl[1020+W]=-128>W?-128:127<W?127:W;for(W=-112;112>=W;++W)vr[112+W]=-16>W?-16:15<W?15:W;for(W=-255;510>=W;++W)ol[255+W]=0>W?0:255<W?255:W;vc=1}ts=jn,La=Ki,Vo=mn,$n=Oo,qo=Es,ra=Nn,Ia=ta,nl=Ls,ka=Ja,na=va,sl=_a,is=ya,fs=xa,Xr=Bo,Hr=Ts,Rr=Js,dn=us,xn=Qs,ps[0]=gr,ps[1]=ma,ps[2]=Mi,ps[3]=Di,ps[4]=ar,ps[5]=Mr,ps[6]=pr,ps[7]=fr,ps[8]=nn,ps[9]=ir,bo[0]=vt,bo[1]=Fo,bo[2]=es,bo[3]=Ss,bo[4]=Lt,bo[5]=li,bo[6]=_i,As[0]=hs,As[1]=ws,As[2]=sn,As[3]=zr,As[4]=Dn,As[5]=zo,As[6]=Xn,W=1}else W=0}W&&(W=function(St,h){for(St.M=0;St.M<St.Va;++St.M){var r,o=St.Jc[St.M&St.Xb],u=St.m,b=St;for(r=0;r<b.za;++r){var S=u,I=b,F=I.Ac,N=I.Bc+4*r,H=I.zc,X=I.ya[I.aa+r];if(I.Qa.Bb?X.$b=qe(S,I.Pa.jb[0])?2+qe(S,I.Pa.jb[2]):qe(S,I.Pa.jb[1]):X.$b=0,I.kc&&(X.Ad=qe(S,I.Bd)),X.Za=!qe(S,145)+0,X.Za){var ee=X.Ob,me=0;for(I=0;4>I;++I){var xe,Ee=H[0+I];for(xe=0;4>xe;++xe){Ee=dl[F[N+xe]][Ee];for(var Pe=ah[qe(S,Ee[0])];0<Pe;)Pe=ah[2*Pe+qe(S,Ee[Pe])];Ee=-Pe,F[N+xe]=Ee}D(ee,me,F,N,4),me+=4,H[0+I]=Ee}}else Ee=qe(S,156)?qe(S,128)?1:3:qe(S,163)?2:0,X.Ob[0]=Ee,R(F,N,Ee,4),R(H,0,Ee,4);X.Dd=qe(S,142)?qe(S,114)?qe(S,183)?1:3:2:0}if(b.m.Ka)return ur(St,7,"Premature end-of-partition0 encountered.");for(;St.ja<St.za;++St.ja){if(b=o,S=(u=St).rb[u.sb-1],F=u.rb[u.sb+u.ja],r=u.ya[u.aa+u.ja],N=u.kc?r.Ad:0)S.la=F.la=0,r.Za||(S.Na=F.Na=0),r.Hc=0,r.Gc=0,r.ia=0;else{var Le,ie;if(S=F,F=b,N=u.Pa.Xc,H=u.ya[u.aa+u.ja],X=u.pb[H.$b],I=H.ad,ee=0,me=u.rb[u.sb-1],Ee=xe=0,R(I,ee,0,384),H.Za)var Ce=0,Re=N[3];else{Pe=z(16);var Ne=S.Na+me.Na;if(Ne=sa(F,N[1],Ne,X.Eb,0,Pe,0),S.Na=me.Na=(0<Ne)+0,1<Ne)ts(Pe,0,I,ee);else{var et=Pe[0]+3>>3;for(Pe=0;256>Pe;Pe+=16)I[ee+Pe]=et}Ce=1,Re=N[0]}var Qe=15&S.la,tt=15&me.la;for(Pe=0;4>Pe;++Pe){var _t=1&tt;for(et=ie=0;4>et;++et)Qe=Qe>>1|(_t=(Ne=sa(F,Re,Ne=_t+(1&Qe),X.Sc,Ce,I,ee))>Ce)<<7,ie=ie<<2|(3<Ne?3:1<Ne?2:I[ee+0]!=0),ee+=16;Qe>>=4,tt=tt>>1|_t<<7,xe=(xe<<8|ie)>>>0}for(Re=Qe,Ce=tt>>4,Le=0;4>Le;Le+=2){for(ie=0,Qe=S.la>>4+Le,tt=me.la>>4+Le,Pe=0;2>Pe;++Pe){for(_t=1&tt,et=0;2>et;++et)Ne=_t+(1&Qe),Qe=Qe>>1|(_t=0<(Ne=sa(F,N[2],Ne,X.Qc,0,I,ee)))<<3,ie=ie<<2|(3<Ne?3:1<Ne?2:I[ee+0]!=0),ee+=16;Qe>>=2,tt=tt>>1|_t<<5}Ee|=ie<<4*Le,Re|=Qe<<4<<Le,Ce|=(240&tt)<<Le}S.la=Re,me.la=Ce,H.Hc=xe,H.Gc=Ee,H.ia=43690&Ee?0:X.ia,N=!(xe|Ee)}if(0<u.L&&(u.wa[u.Y+u.ja]=u.gd[r.$b][r.Za],u.wa[u.Y+u.ja].La|=!N),b.Ka)return ur(St,7,"Premature end-of-file encountered.")}if(po(St),u=h,b=1,r=(o=St).D,S=0<o.L&&o.M>=o.zb&&o.M<=o.Va,o.Aa==0)e:{if(r.M=o.M,r.uc=S,Ta(o,r),b=1,r=(ie=o.D).Nb,S=(Ee=bi[o.L])*o.R,F=Ee/2*o.B,Pe=16*r*o.R,et=8*r*o.B,N=o.sa,H=o.ta-S+Pe,X=o.qa,I=o.ra-F+et,ee=o.Ha,me=o.Ia-F+et,tt=(Qe=ie.M)==0,xe=Qe>=o.Va-1,o.Aa==2&&Ta(o,ie),ie.uc)for(_t=(Ne=o).D.M,f(Ne.D.uc),ie=Ne.yb;ie<Ne.Hb;++ie){Ce=ie,Re=_t;var ut=(Ct=(qt=Ne).D).Nb;Le=qt.R;var Ct=Ct.wa[Ct.Y+Ce],ei=qt.sa,Tt=qt.ta+16*ut*Le+16*Ce,Gt=Ct.dd,Pt=Ct.tc;if(Pt!=0)if(f(3<=Pt),qt.L==1)0<Ce&&Rr(ei,Tt,Le,Pt+4),Ct.La&&xn(ei,Tt,Le,Pt),0<Re&&Hr(ei,Tt,Le,Pt+4),Ct.La&&dn(ei,Tt,Le,Pt);else{var ii=qt.B,Mt=qt.qa,Xt=qt.ra+8*ut*ii+8*Ce,oi=qt.Ha,qt=qt.Ia+8*ut*ii+8*Ce;ut=Ct.ld,0<Ce&&(nl(ei,Tt,Le,Pt+4,Gt,ut),na(Mt,Xt,oi,qt,ii,Pt+4,Gt,ut)),Ct.La&&(is(ei,Tt,Le,Pt,Gt,ut),Xr(Mt,Xt,oi,qt,ii,Pt,Gt,ut)),0<Re&&(Ia(ei,Tt,Le,Pt+4,Gt,ut),ka(Mt,Xt,oi,qt,ii,Pt+4,Gt,ut)),Ct.La&&(sl(ei,Tt,Le,Pt,Gt,ut),fs(Mt,Xt,oi,qt,ii,Pt,Gt,ut))}}if(o.ia&&alert("todo:DitherRow"),u.put!=null){if(ie=16*Qe,Qe=16*(Qe+1),tt?(u.y=o.sa,u.O=o.ta+Pe,u.f=o.qa,u.N=o.ra+et,u.ea=o.Ha,u.W=o.Ia+et):(ie-=Ee,u.y=N,u.O=H,u.f=X,u.N=I,u.ea=ee,u.W=me),xe||(Qe-=Ee),Qe>u.o&&(Qe=u.o),u.F=null,u.J=null,o.Fa!=null&&0<o.Fa.length&&ie<Qe&&(u.J=go(o,u,ie,Qe-ie),u.F=o.mb,u.F==null&&u.F.length==0)){b=ur(o,3,"Could not decode alpha data.");break e}ie<u.j&&(Ee=u.j-ie,ie=u.j,f(!(1&Ee)),u.O+=o.R*Ee,u.N+=o.B*(Ee>>1),u.W+=o.B*(Ee>>1),u.F!=null&&(u.J+=u.width*Ee)),ie<Qe&&(u.O+=u.v,u.N+=u.v>>1,u.W+=u.v>>1,u.F!=null&&(u.J+=u.v),u.ka=ie-u.j,u.U=u.va-u.v,u.T=Qe-ie,b=u.put(u))}r+1!=o.Ic||xe||(D(o.sa,o.ta-S,N,H+16*o.R,S),D(o.qa,o.ra-F,X,I+8*o.B,F),D(o.Ha,o.Ia-F,ee,me+8*o.B,F))}if(!b)return ur(St,6,"Output aborted.")}return 1}(E,k)),k.bc!=null&&k.bc(k),W&=1}return W?(E.cb=0,W):0}function di(E,k,W,J,de){de=E[k+W+32*J]+(de>>3),E[k+W+32*J]=-256&de?0>de?0:255:de}function Zi(E,k,W,J,de,ye){di(E,k,0,W,J+de),di(E,k,1,W,J+ye),di(E,k,2,W,J-ye),di(E,k,3,W,J-de)}function ji(E){return(20091*E>>16)+E}function tn(E,k,W,J){var de,ye=0,be=z(16);for(de=0;4>de;++de){var Me=E[k+0]+E[k+8],Ie=E[k+0]-E[k+8],Ge=(35468*E[k+4]>>16)-ji(E[k+12]),mt=ji(E[k+4])+(35468*E[k+12]>>16);be[ye+0]=Me+mt,be[ye+1]=Ie+Ge,be[ye+2]=Ie-Ge,be[ye+3]=Me-mt,ye+=4,k++}for(de=ye=0;4>de;++de)Me=(E=be[ye+0]+4)+be[ye+8],Ie=E-be[ye+8],Ge=(35468*be[ye+4]>>16)-ji(be[ye+12]),di(W,J,0,0,Me+(mt=ji(be[ye+4])+(35468*be[ye+12]>>16))),di(W,J,1,0,Ie+Ge),di(W,J,2,0,Ie-Ge),di(W,J,3,0,Me-mt),ye++,J+=32}function Nn(E,k,W,J){var de=E[k+0]+4,ye=35468*E[k+4]>>16,be=ji(E[k+4]),Me=35468*E[k+1]>>16;Zi(W,J,0,de+be,E=ji(E[k+1]),Me),Zi(W,J,1,de+ye,E,Me),Zi(W,J,2,de-ye,E,Me),Zi(W,J,3,de-be,E,Me)}function Ki(E,k,W,J,de){tn(E,k,W,J),de&&tn(E,k+16,W,J+4)}function mn(E,k,W,J){La(E,k+0,W,J,1),La(E,k+32,W,J+128,1)}function Oo(E,k,W,J){var de;for(E=E[k+0]+4,de=0;4>de;++de)for(k=0;4>k;++k)di(W,J,k,de,E)}function Es(E,k,W,J){E[k+0]&&$n(E,k+0,W,J),E[k+16]&&$n(E,k+16,W,J+4),E[k+32]&&$n(E,k+32,W,J+128),E[k+48]&&$n(E,k+48,W,J+128+4)}function jn(E,k,W,J){var de,ye=z(16);for(de=0;4>de;++de){var be=E[k+0+de]+E[k+12+de],Me=E[k+4+de]+E[k+8+de],Ie=E[k+4+de]-E[k+8+de],Ge=E[k+0+de]-E[k+12+de];ye[0+de]=be+Me,ye[8+de]=be-Me,ye[4+de]=Ge+Ie,ye[12+de]=Ge-Ie}for(de=0;4>de;++de)be=(E=ye[0+4*de]+3)+ye[3+4*de],Me=ye[1+4*de]+ye[2+4*de],Ie=ye[1+4*de]-ye[2+4*de],Ge=E-ye[3+4*de],W[J+0]=be+Me>>3,W[J+16]=Ge+Ie>>3,W[J+32]=be-Me>>3,W[J+48]=Ge-Ie>>3,J+=64}function Er(E,k,W){var J,de=k-32,ye=ds,be=255-E[de-1];for(J=0;J<W;++J){var Me,Ie=ye,Ge=be+E[k-1];for(Me=0;Me<W;++Me)E[k+Me]=Ie[Ge+E[de+Me]];k+=32}}function ma(E,k){Er(E,k,4)}function ws(E,k){Er(E,k,8)}function Fo(E,k){Er(E,k,16)}function es(E,k){var W;for(W=0;16>W;++W)D(E,k+32*W,E,k-32,16)}function Ss(E,k){var W;for(W=16;0<W;--W)R(E,k,E[k-1],16),k+=32}function it(E,k,W){var J;for(J=0;16>J;++J)R(k,W+32*J,E,16)}function vt(E,k){var W,J=16;for(W=0;16>W;++W)J+=E[k-1+32*W]+E[k+W-32];it(J>>5,E,k)}function Lt(E,k){var W,J=8;for(W=0;16>W;++W)J+=E[k-1+32*W];it(J>>4,E,k)}function li(E,k){var W,J=8;for(W=0;16>W;++W)J+=E[k+W-32];it(J>>4,E,k)}function _i(E,k){it(128,E,k)}function Yt(E,k,W){return E+2*k+W+2>>2}function Mi(E,k){var W,J=k-32;for(J=new Uint8Array([Yt(E[J-1],E[J+0],E[J+1]),Yt(E[J+0],E[J+1],E[J+2]),Yt(E[J+1],E[J+2],E[J+3]),Yt(E[J+2],E[J+3],E[J+4])]),W=0;4>W;++W)D(E,k+32*W,J,0,J.length)}function Di(E,k){var W=E[k-1],J=E[k-1+32],de=E[k-1+64],ye=E[k-1+96];gt(E,k+0,16843009*Yt(E[k-1-32],W,J)),gt(E,k+32,16843009*Yt(W,J,de)),gt(E,k+64,16843009*Yt(J,de,ye)),gt(E,k+96,16843009*Yt(de,ye,ye))}function gr(E,k){var W,J=4;for(W=0;4>W;++W)J+=E[k+W-32]+E[k-1+32*W];for(J>>=3,W=0;4>W;++W)R(E,k+32*W,J,4)}function ar(E,k){var W=E[k-1+0],J=E[k-1+32],de=E[k-1+64],ye=E[k-1-32],be=E[k+0-32],Me=E[k+1-32],Ie=E[k+2-32],Ge=E[k+3-32];E[k+0+96]=Yt(J,de,E[k-1+96]),E[k+1+96]=E[k+0+64]=Yt(W,J,de),E[k+2+96]=E[k+1+64]=E[k+0+32]=Yt(ye,W,J),E[k+3+96]=E[k+2+64]=E[k+1+32]=E[k+0+0]=Yt(be,ye,W),E[k+3+64]=E[k+2+32]=E[k+1+0]=Yt(Me,be,ye),E[k+3+32]=E[k+2+0]=Yt(Ie,Me,be),E[k+3+0]=Yt(Ge,Ie,Me)}function pr(E,k){var W=E[k+1-32],J=E[k+2-32],de=E[k+3-32],ye=E[k+4-32],be=E[k+5-32],Me=E[k+6-32],Ie=E[k+7-32];E[k+0+0]=Yt(E[k+0-32],W,J),E[k+1+0]=E[k+0+32]=Yt(W,J,de),E[k+2+0]=E[k+1+32]=E[k+0+64]=Yt(J,de,ye),E[k+3+0]=E[k+2+32]=E[k+1+64]=E[k+0+96]=Yt(de,ye,be),E[k+3+32]=E[k+2+64]=E[k+1+96]=Yt(ye,be,Me),E[k+3+64]=E[k+2+96]=Yt(be,Me,Ie),E[k+3+96]=Yt(Me,Ie,Ie)}function Mr(E,k){var W=E[k-1+0],J=E[k-1+32],de=E[k-1+64],ye=E[k-1-32],be=E[k+0-32],Me=E[k+1-32],Ie=E[k+2-32],Ge=E[k+3-32];E[k+0+0]=E[k+1+64]=ye+be+1>>1,E[k+1+0]=E[k+2+64]=be+Me+1>>1,E[k+2+0]=E[k+3+64]=Me+Ie+1>>1,E[k+3+0]=Ie+Ge+1>>1,E[k+0+96]=Yt(de,J,W),E[k+0+64]=Yt(J,W,ye),E[k+0+32]=E[k+1+96]=Yt(W,ye,be),E[k+1+32]=E[k+2+96]=Yt(ye,be,Me),E[k+2+32]=E[k+3+96]=Yt(be,Me,Ie),E[k+3+32]=Yt(Me,Ie,Ge)}function fr(E,k){var W=E[k+0-32],J=E[k+1-32],de=E[k+2-32],ye=E[k+3-32],be=E[k+4-32],Me=E[k+5-32],Ie=E[k+6-32],Ge=E[k+7-32];E[k+0+0]=W+J+1>>1,E[k+1+0]=E[k+0+64]=J+de+1>>1,E[k+2+0]=E[k+1+64]=de+ye+1>>1,E[k+3+0]=E[k+2+64]=ye+be+1>>1,E[k+0+32]=Yt(W,J,de),E[k+1+32]=E[k+0+96]=Yt(J,de,ye),E[k+2+32]=E[k+1+96]=Yt(de,ye,be),E[k+3+32]=E[k+2+96]=Yt(ye,be,Me),E[k+3+64]=Yt(be,Me,Ie),E[k+3+96]=Yt(Me,Ie,Ge)}function ir(E,k){var W=E[k-1+0],J=E[k-1+32],de=E[k-1+64],ye=E[k-1+96];E[k+0+0]=W+J+1>>1,E[k+2+0]=E[k+0+32]=J+de+1>>1,E[k+2+32]=E[k+0+64]=de+ye+1>>1,E[k+1+0]=Yt(W,J,de),E[k+3+0]=E[k+1+32]=Yt(J,de,ye),E[k+3+32]=E[k+1+64]=Yt(de,ye,ye),E[k+3+64]=E[k+2+64]=E[k+0+96]=E[k+1+96]=E[k+2+96]=E[k+3+96]=ye}function nn(E,k){var W=E[k-1+0],J=E[k-1+32],de=E[k-1+64],ye=E[k-1+96],be=E[k-1-32],Me=E[k+0-32],Ie=E[k+1-32],Ge=E[k+2-32];E[k+0+0]=E[k+2+32]=W+be+1>>1,E[k+0+32]=E[k+2+64]=J+W+1>>1,E[k+0+64]=E[k+2+96]=de+J+1>>1,E[k+0+96]=ye+de+1>>1,E[k+3+0]=Yt(Me,Ie,Ge),E[k+2+0]=Yt(be,Me,Ie),E[k+1+0]=E[k+3+32]=Yt(W,be,Me),E[k+1+32]=E[k+3+64]=Yt(J,W,be),E[k+1+64]=E[k+3+96]=Yt(de,J,W),E[k+1+96]=Yt(ye,de,J)}function sn(E,k){var W;for(W=0;8>W;++W)D(E,k+32*W,E,k-32,8)}function zr(E,k){var W;for(W=0;8>W;++W)R(E,k,E[k-1],8),k+=32}function Wr(E,k,W){var J;for(J=0;8>J;++J)R(k,W+32*J,E,8)}function hs(E,k){var W,J=8;for(W=0;8>W;++W)J+=E[k+W-32]+E[k-1+32*W];Wr(J>>4,E,k)}function zo(E,k){var W,J=4;for(W=0;8>W;++W)J+=E[k+W-32];Wr(J>>3,E,k)}function Dn(E,k){var W,J=4;for(W=0;8>W;++W)J+=E[k-1+32*W];Wr(J>>3,E,k)}function Xn(E,k){Wr(128,E,k)}function Ps(E,k,W){var J=E[k-W],de=E[k+0],ye=3*(de-J)+al[1020+E[k-2*W]-E[k+W]],be=Go[112+(ye+4>>3)];E[k-W]=ds[255+J+Go[112+(ye+3>>3)]],E[k+0]=ds[255+de-be]}function ga(E,k,W,J){var de=E[k+0],ye=E[k+W];return rs[255+E[k-2*W]-E[k-W]]>J||rs[255+ye-de]>J}function Ka(E,k,W,J){return 4*rs[255+E[k-W]-E[k+0]]+rs[255+E[k-2*W]-E[k+W]]<=J}function Ro(E,k,W,J,de){var ye=E[k-3*W],be=E[k-2*W],Me=E[k-W],Ie=E[k+0],Ge=E[k+W],mt=E[k+2*W],Ft=E[k+3*W];return 4*rs[255+Me-Ie]+rs[255+be-Ge]>J?0:rs[255+E[k-4*W]-ye]<=de&&rs[255+ye-be]<=de&&rs[255+be-Me]<=de&&rs[255+Ft-mt]<=de&&rs[255+mt-Ge]<=de&&rs[255+Ge-Ie]<=de}function Ts(E,k,W,J){var de=2*J+1;for(J=0;16>J;++J)Ka(E,k+J,W,de)&&Ps(E,k+J,W)}function Js(E,k,W,J){var de=2*J+1;for(J=0;16>J;++J)Ka(E,k+J*W,1,de)&&Ps(E,k+J*W,1)}function us(E,k,W,J){var de;for(de=3;0<de;--de)Ts(E,k+=4*W,W,J)}function Qs(E,k,W,J){var de;for(de=3;0<de;--de)Js(E,k+=4,W,J)}function Ms(E,k,W,J,de,ye,be,Me){for(ye=2*ye+1;0<de--;){if(Ro(E,k,W,ye,be))if(ga(E,k,W,Me))Ps(E,k,W);else{var Ie=E,Ge=k,mt=W,Ft=Ie[Ge-2*mt],zt=Ie[Ge-mt],St=Ie[Ge+0],h=Ie[Ge+mt],r=Ie[Ge+2*mt],o=27*(b=al[1020+3*(St-zt)+al[1020+Ft-h]])+63>>7,u=18*b+63>>7,b=9*b+63>>7;Ie[Ge-3*mt]=ds[255+Ie[Ge-3*mt]+b],Ie[Ge-2*mt]=ds[255+Ft+u],Ie[Ge-mt]=ds[255+zt+o],Ie[Ge+0]=ds[255+St-o],Ie[Ge+mt]=ds[255+h-u],Ie[Ge+2*mt]=ds[255+r-b]}k+=J}}function Tn(E,k,W,J,de,ye,be,Me){for(ye=2*ye+1;0<de--;){if(Ro(E,k,W,ye,be))if(ga(E,k,W,Me))Ps(E,k,W);else{var Ie=E,Ge=k,mt=W,Ft=Ie[Ge-mt],zt=Ie[Ge+0],St=Ie[Ge+mt],h=Go[112+((r=3*(zt-Ft))+4>>3)],r=Go[112+(r+3>>3)],o=h+1>>1;Ie[Ge-2*mt]=ds[255+Ie[Ge-2*mt]+o],Ie[Ge-mt]=ds[255+Ft+r],Ie[Ge+0]=ds[255+zt-h],Ie[Ge+mt]=ds[255+St-o]}k+=J}}function ta(E,k,W,J,de,ye){Ms(E,k,W,1,16,J,de,ye)}function Ls(E,k,W,J,de,ye){Ms(E,k,1,W,16,J,de,ye)}function _a(E,k,W,J,de,ye){var be;for(be=3;0<be;--be)Tn(E,k+=4*W,W,1,16,J,de,ye)}function ya(E,k,W,J,de,ye){var be;for(be=3;0<be;--be)Tn(E,k+=4,1,W,16,J,de,ye)}function Ja(E,k,W,J,de,ye,be,Me){Ms(E,k,de,1,8,ye,be,Me),Ms(W,J,de,1,8,ye,be,Me)}function va(E,k,W,J,de,ye,be,Me){Ms(E,k,1,de,8,ye,be,Me),Ms(W,J,1,de,8,ye,be,Me)}function xa(E,k,W,J,de,ye,be,Me){Tn(E,k+4*de,de,1,8,ye,be,Me),Tn(W,J+4*de,de,1,8,ye,be,Me)}function Bo(E,k,W,J,de,ye,be,Me){Tn(E,k+4,1,de,8,ye,be,Me),Tn(W,J+4,1,de,8,ye,be,Me)}function mr(){this.ba=new fe,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ke,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Il(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ba(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function kl(){this.ua=0,this.Wa=new Se,this.vb=new Se,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new De,this.yc=new pe}function Dl(){this.xb=this.a=0,this.l=new Wn,this.ca=new fe,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Y,this.Pb=0,this.wd=new Y,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new kl,this.ab=0,this.gc=V(4,ba),this.Oc=0}function wa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Wn,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function No(E,k,W,J,de,ye,be){for(E=E==null?0:E[k+0],k=0;k<be;++k)de[ye+k]=E+W[J+k]&255,E=de[ye+k]}function mo(E,k,W,J,de,ye,be){var Me;if(E==null)No(null,null,W,J,de,ye,be);else for(Me=0;Me<be;++Me)de[ye+Me]=E[k+Me]+W[J+Me]&255}function eo(E,k,W,J,de,ye,be){if(E==null)No(null,null,W,J,de,ye,be);else{var Me,Ie=E[k+0],Ge=Ie,mt=Ie;for(Me=0;Me<be;++Me)Ge=mt+(Ie=E[k+Me])-Ge,mt=W[J+Me]+(-256&Ge?0>Ge?0:255:Ge)&255,Ge=Ie,de[ye+Me]=mt}}function go(E,k,W,J){var de=k.width,ye=k.o;if(f(E!=null&&k!=null),0>W||0>=J||W+J>ye)return null;if(!E.Cc){if(E.ga==null){var be;if(E.ga=new wa,(be=E.ga==null)||(be=k.width*k.o,f(E.Gb.length==0),E.Gb=z(be),E.Uc=0,E.Gb==null?be=0:(E.mb=E.Gb,E.nb=E.Uc,E.rc=null,be=1),be=!be),!be){be=E.ga;var Me=E.Fa,Ie=E.P,Ge=E.qc,mt=E.mb,Ft=E.nb,zt=Ie+1,St=Ge-1,h=be.l;if(f(Me!=null&&mt!=null&&k!=null),Ho[0]=null,Ho[1]=No,Ho[2]=mo,Ho[3]=eo,be.ca=mt,be.tb=Ft,be.c=k.width,be.i=k.height,f(0<be.c&&0<be.i),1>=Ge)k=0;else if(be.$a=Me[Ie+0]>>0&3,be.Z=Me[Ie+0]>>2&3,be.Lc=Me[Ie+0]>>4&3,Ie=Me[Ie+0]>>6&3,0>be.$a||1<be.$a||4<=be.Z||1<be.Lc||Ie)k=0;else if(h.put=Dt,h.ac=st,h.bc=ti,h.ma=be,h.width=k.width,h.height=k.height,h.Da=k.Da,h.v=k.v,h.va=k.va,h.j=k.j,h.o=k.o,be.$a)e:{f(be.$a==1),k=Fr();t:for(;;){if(k==null){k=0;break e}if(f(be!=null),be.mc=k,k.c=be.c,k.i=be.i,k.l=be.l,k.l.ma=be,k.l.width=be.c,k.l.height=be.i,k.a=0,He(k.m,Me,zt,St),!Bn(be.c,be.i,1,k,null)||(k.ab==1&&k.gc[0].hc==3&&Pr(k.s)?(be.ic=1,Me=k.c*k.i,k.Ta=null,k.Ua=0,k.V=z(Me),k.Ba=0,k.V==null?(k.a=1,k=0):k=1):(be.ic=0,k=Io(k,be.c)),!k))break t;k=1;break e}be.mc=null,k=0}else k=St>=be.c*be.i;be=!k}if(be)return null;E.ga.Lc!=1?E.Ga=0:J=ye-W}f(E.ga!=null),f(W+J<=ye);e:{if(k=(Me=E.ga).c,ye=Me.l.o,Me.$a==0){if(zt=E.rc,St=E.Vc,h=E.Fa,Ie=E.P+1+W*k,Ge=E.mb,mt=E.nb+W*k,f(Ie<=E.P+E.qc),Me.Z!=0)for(f(Ho[Me.Z]!=null),be=0;be<J;++be)Ho[Me.Z](zt,St,h,Ie,Ge,mt,k),zt=Ge,St=mt,mt+=k,Ie+=k;else for(be=0;be<J;++be)D(Ge,mt,h,Ie,k),zt=Ge,St=mt,mt+=k,Ie+=k;E.rc=zt,E.Vc=St}else{if(f(Me.mc!=null),k=W+J,f((be=Me.mc)!=null),f(k<=be.i),be.C>=k)k=1;else if(Me.ic||It(),Me.ic){Me=be.V,zt=be.Ba,St=be.c;var r=be.i,o=(h=1,Ie=be.$/St,Ge=be.$%St,mt=be.m,Ft=be.s,be.$),u=St*r,b=St*k,S=Ft.wc,I=o<b?Fi(Ft,Ge,Ie):null;f(o<=u),f(k<=r),f(Pr(Ft));t:for(;;){for(;!mt.h&&o<b;){if(Ge&S||(I=Fi(Ft,Ge,Ie)),f(I!=null),we(mt),256>(r=Vi(I.G[0],I.H[0],mt)))Me[zt+o]=r,++o,++Ge>=St&&(Ge=0,++Ie<=k&&!(Ie%16)&&Sr(be,Ie));else{if(!(280>r)){h=0;break t}r=ni(r-256,mt);var F,N=Vi(I.G[4],I.H[4],mt);if(we(mt),!(o>=(N=Ui(St,N=ni(N,mt)))&&u-o>=r)){h=0;break t}for(F=0;F<r;++F)Me[zt+o+F]=Me[zt+o+F-N];for(o+=r,Ge+=r;Ge>=St;)Ge-=St,++Ie<=k&&!(Ie%16)&&Sr(be,Ie);o<b&&Ge&S&&(I=Fi(Ft,Ge,Ie))}f(mt.h==re(mt))}Sr(be,Ie>k?k:Ie);break t}!h||mt.h&&o<u?(h=0,be.a=mt.h?5:3):be.$=o,k=h}else k=un(be,be.V,be.Ba,be.c,be.i,k,Hs);if(!k){J=0;break e}}W+J>=ye&&(E.Cc=1),J=1}if(!J)return null;if(E.Cc&&((J=E.ga)!=null&&(J.mc=null),E.ga=null,0<E.Ga))return alert("todo:WebPDequantizeLevels"),null}return E.nb+W*de}function U(E,k,W,J,de,ye){for(;0<de--;){var be,Me=E,Ie=k+(W?1:0),Ge=E,mt=k+(W?0:3);for(be=0;be<J;++be){var Ft=Ge[mt+4*be];Ft!=255&&(Ft*=32897,Me[Ie+4*be+0]=Me[Ie+4*be+0]*Ft>>23,Me[Ie+4*be+1]=Me[Ie+4*be+1]*Ft>>23,Me[Ie+4*be+2]=Me[Ie+4*be+2]*Ft>>23)}k+=ye}}function ue(E,k,W,J,de){for(;0<J--;){var ye;for(ye=0;ye<W;++ye){var be=E[k+2*ye+0],Me=15&(Ge=E[k+2*ye+1]),Ie=4369*Me,Ge=(240&Ge|Ge>>4)*Ie>>16;E[k+2*ye+0]=(240&be|be>>4)*Ie>>16&240|(15&be|be<<4)*Ie>>16>>4&15,E[k+2*ye+1]=240&Ge|Me}k+=de}}function Ye(E,k,W,J,de,ye,be,Me){var Ie,Ge,mt=255;for(Ge=0;Ge<de;++Ge){for(Ie=0;Ie<J;++Ie){var Ft=E[k+Ie];ye[be+4*Ie]=Ft,mt&=Ft}k+=W,be+=Me}return mt!=255}function pt(E,k,W,J,de){var ye;for(ye=0;ye<de;++ye)W[J+ye]=E[k+ye]>>8}function It(){Ds=U,Da=ue,xo=Ye,Oa=pt}function Zt(E,k,W){le[E]=function(J,de,ye,be,Me,Ie,Ge,mt,Ft,zt,St,h,r,o,u,b,S){var I,F=S-1>>1,N=Me[Ie+0]|Ge[mt+0]<<16,H=Ft[zt+0]|St[h+0]<<16;f(J!=null);var X=3*N+H+131074>>2;for(k(J[de+0],255&X,X>>16,r,o),ye!=null&&(X=3*H+N+131074>>2,k(ye[be+0],255&X,X>>16,u,b)),I=1;I<=F;++I){var ee=Me[Ie+I]|Ge[mt+I]<<16,me=Ft[zt+I]|St[h+I]<<16,xe=N+ee+H+me+524296,Ee=xe+2*(ee+H)>>3;X=Ee+N>>1,N=(xe=xe+2*(N+me)>>3)+ee>>1,k(J[de+2*I-1],255&X,X>>16,r,o+(2*I-1)*W),k(J[de+2*I-0],255&N,N>>16,r,o+(2*I-0)*W),ye!=null&&(X=xe+H>>1,N=Ee+me>>1,k(ye[be+2*I-1],255&X,X>>16,u,b+(2*I-1)*W),k(ye[be+2*I+0],255&N,N>>16,u,b+(2*I+0)*W)),N=ee,H=me}1&S||(X=3*N+H+131074>>2,k(J[de+S-1],255&X,X>>16,r,o+(S-1)*W),ye!=null&&(X=3*H+N+131074>>2,k(ye[be+S-1],255&X,X>>16,u,b+(S-1)*W)))}}function pi(){ms[Os]=ch,ms[Rl]=Tc,ms[Bl]=oa,ms[Wo]=Cc,ms[Xo]=hh,ms[Nl]=Ac,ms[ll]=Ec,ms[Fa]=Tc,ms[cl]=Cc,ms[za]=hh,ms[yi]=Ac}function Ei(E){return E&~jh?0>E?0:255:E>>Mc}function qi(E,k){return Ei((19077*E>>8)+(26149*k>>8)-14234)}function lr(E,k,W){return Ei((19077*E>>8)-(6419*k>>8)-(13320*W>>8)+8708)}function Ci(E,k){return Ei((19077*E>>8)+(33050*k>>8)-17685)}function _r(E,k,W,J,de){J[de+0]=qi(E,W),J[de+1]=lr(E,k,W),J[de+2]=Ci(E,k)}function on(E,k,W,J,de){J[de+0]=Ci(E,k),J[de+1]=lr(E,k,W),J[de+2]=qi(E,W)}function an(E,k,W,J,de){var ye=lr(E,k,W);k=ye<<3&224|Ci(E,k)>>3,J[de+0]=248&qi(E,W)|ye>>5,J[de+1]=k}function gn(E,k,W,J,de){var ye=240&Ci(E,k)|15;J[de+0]=240&qi(E,W)|lr(E,k,W)>>4,J[de+1]=ye}function fn(E,k,W,J,de){J[de+0]=255,_r(E,k,W,J,de+1)}function vn(E,k,W,J,de){on(E,k,W,J,de),J[de+3]=255}function to(E,k,W,J,de){_r(E,k,W,J,de),J[de+3]=255}function Cs(E,k){return 0>E?0:E>k?k:E}function jo(E,k,W){le[E]=function(J,de,ye,be,Me,Ie,Ge,mt,Ft){for(var zt=mt+(-2&Ft)*W;mt!=zt;)k(J[de+0],ye[be+0],Me[Ie+0],Ge,mt),k(J[de+1],ye[be+0],Me[Ie+0],Ge,mt+W),de+=2,++be,++Ie,mt+=2*W;1&Ft&&k(J[de+0],ye[be+0],Me[Ie+0],Ge,mt)}}function Qa(E,k,W){return W==0?E==0?k==0?6:5:k==0?4:0:W}function Sa(E,k,W,J,de){switch(E>>>30){case 3:La(k,W,J,de,0);break;case 2:ra(k,W,J,de);break;case 1:$n(k,W,J,de)}}function Ta(E,k){var W,J,de=k.M,ye=k.Nb,be=E.oc,Me=E.pc+40,Ie=E.oc,Ge=E.pc+584,mt=E.oc,Ft=E.pc+600;for(W=0;16>W;++W)be[Me+32*W-1]=129;for(W=0;8>W;++W)Ie[Ge+32*W-1]=129,mt[Ft+32*W-1]=129;for(0<de?be[Me-1-32]=Ie[Ge-1-32]=mt[Ft-1-32]=129:(R(be,Me-32-1,127,21),R(Ie,Ge-32-1,127,9),R(mt,Ft-32-1,127,9)),J=0;J<E.za;++J){var zt=k.ya[k.aa+J];if(0<J){for(W=-1;16>W;++W)D(be,Me+32*W-4,be,Me+32*W+12,4);for(W=-1;8>W;++W)D(Ie,Ge+32*W-4,Ie,Ge+32*W+4,4),D(mt,Ft+32*W-4,mt,Ft+32*W+4,4)}var St=E.Gd,h=E.Hd+J,r=zt.ad,o=zt.Hc;if(0<de&&(D(be,Me-32,St[h].y,0,16),D(Ie,Ge-32,St[h].f,0,8),D(mt,Ft-32,St[h].ea,0,8)),zt.Za){var u=be,b=Me-32+16;for(0<de&&(J>=E.za-1?R(u,b,St[h].y[15],4):D(u,b,St[h+1].y,0,4)),W=0;4>W;W++)u[b+128+W]=u[b+256+W]=u[b+384+W]=u[b+0+W];for(W=0;16>W;++W,o<<=2)u=be,b=Me+Wl[W],ps[zt.Ob[W]](u,b),Sa(o,r,16*+W,u,b)}else if(u=Qa(J,de,zt.Ob[0]),bo[u](be,Me),o!=0)for(W=0;16>W;++W,o<<=2)Sa(o,r,16*+W,be,Me+Wl[W]);for(W=zt.Gc,u=Qa(J,de,zt.Dd),As[u](Ie,Ge),As[u](mt,Ft),o=r,u=Ie,b=Ge,255&(zt=W>>0)&&(170&zt?Vo(o,256,u,b):qo(o,256,u,b)),zt=mt,o=Ft,255&(W>>=8)&&(170&W?Vo(r,320,zt,o):qo(r,320,zt,o)),de<E.Ub-1&&(D(St[h].y,0,be,Me+480,16),D(St[h].f,0,Ie,Ge+224,8),D(St[h].ea,0,mt,Ft+224,8)),W=8*ye*E.B,St=E.sa,h=E.ta+16*J+16*ye*E.R,r=E.qa,zt=E.ra+8*J+W,o=E.Ha,u=E.Ia+8*J+W,W=0;16>W;++W)D(St,h+W*E.R,be,Me+32*W,16);for(W=0;8>W;++W)D(r,zt+W*E.B,Ie,Ge+32*W,8),D(o,u+W*E.B,mt,Ft+32*W,8)}}function Uo(E,k,W,J,de,ye,be,Me,Ie){var Ge=[0],mt=[0],Ft=0,zt=Ie!=null?Ie.kd:0,St=Ie??new Il;if(E==null||12>W)return 7;St.data=E,St.w=k,St.ha=W,k=[k],W=[W],St.gb=[St.gb];e:{var h=k,r=W,o=St.gb;if(f(E!=null),f(r!=null),f(o!=null),o[0]=0,12<=r[0]&&!A(E,h[0],"RIFF")){if(A(E,h[0]+8,"WEBP")){o=3;break e}var u=ht(E,h[0]+4);if(12>u||4294967286<u){o=3;break e}if(zt&&u>r[0]-8){o=7;break e}o[0]=u,h[0]+=12,r[0]-=12}o=0}if(o!=0)return o;for(u=0<St.gb[0],W=W[0];;){e:{var b=E;r=k,o=W;var S=Ge,I=mt,F=h=[0];if((X=Ft=[Ft])[0]=0,8>o[0])o=7;else{if(!A(b,r[0],"VP8X")){if(ht(b,r[0]+4)!=10){o=3;break e}if(18>o[0]){o=7;break e}var N=ht(b,r[0]+8),H=1+Bt(b,r[0]+12);if(2147483648<=H*(b=1+Bt(b,r[0]+15))){o=3;break e}F!=null&&(F[0]=N),S!=null&&(S[0]=H),I!=null&&(I[0]=b),r[0]+=18,o[0]-=18,X[0]=1}o=0}}if(Ft=Ft[0],h=h[0],o!=0)return o;if(r=!!(2&h),!u&&Ft)return 3;if(ye!=null&&(ye[0]=!!(16&h)),be!=null&&(be[0]=r),Me!=null&&(Me[0]=0),be=Ge[0],h=mt[0],Ft&&r&&Ie==null){o=0;break}if(4>W){o=7;break}if(u&&Ft||!u&&!Ft&&!A(E,k[0],"ALPH")){W=[W],St.na=[St.na],St.P=[St.P],St.Sa=[St.Sa];e:{N=E,o=k,u=W;var X=St.gb;S=St.na,I=St.P,F=St.Sa,H=22,f(N!=null),f(u!=null),b=o[0];var ee=u[0];for(f(S!=null),f(F!=null),S[0]=null,I[0]=null,F[0]=0;;){if(o[0]=b,u[0]=ee,8>ee){o=7;break e}var me=ht(N,b+4);if(4294967286<me){o=3;break e}var xe=8+me+1&-2;if(H+=xe,0<X&&H>X){o=3;break e}if(!A(N,b,"VP8 ")||!A(N,b,"VP8L")){o=0;break e}if(ee[0]<xe){o=7;break e}A(N,b,"ALPH")||(S[0]=N,I[0]=b+8,F[0]=me),b+=xe,ee-=xe}}if(W=W[0],St.na=St.na[0],St.P=St.P[0],St.Sa=St.Sa[0],o!=0)break}W=[W],St.Ja=[St.Ja],St.xa=[St.xa];e:if(X=E,o=k,u=W,S=St.gb[0],I=St.Ja,F=St.xa,N=o[0],b=!A(X,N,"VP8 "),H=!A(X,N,"VP8L"),f(X!=null),f(u!=null),f(I!=null),f(F!=null),8>u[0])o=7;else{if(b||H){if(X=ht(X,N+4),12<=S&&X>S-12){o=3;break e}if(zt&&X>u[0]-8){o=7;break e}I[0]=X,o[0]+=8,u[0]-=8,F[0]=H}else F[0]=5<=u[0]&&X[N+0]==47&&!(X[N+4]>>5),I[0]=u[0];o=0}if(W=W[0],St.Ja=St.Ja[0],St.xa=St.xa[0],k=k[0],o!=0)break;if(4294967286<St.Ja)return 3;if(Me==null||r||(Me[0]=St.xa?2:1),be=[be],h=[h],St.xa){if(5>W){o=7;break}Me=be,zt=h,r=ye,E==null||5>W?E=0:5<=W&&E[k+0]==47&&!(E[k+4]>>5)?(u=[0],X=[0],S=[0],He(I=new Y,E,k,W),Vt(I,u,X,S)?(Me!=null&&(Me[0]=u[0]),zt!=null&&(zt[0]=X[0]),r!=null&&(r[0]=S[0]),E=1):E=0):E=0}else{if(10>W){o=7;break}Me=h,E==null||10>W||!Ys(E,k+3,W-3)?E=0:(zt=E[k+0]|E[k+1]<<8|E[k+2]<<16,r=16383&(E[k+7]<<8|E[k+6]),E=16383&(E[k+9]<<8|E[k+8]),1&zt||3<(zt>>1&7)||!(zt>>4&1)||zt>>5>=St.Ja||!r||!E?E=0:(be&&(be[0]=r),Me&&(Me[0]=E),E=1))}if(!E||(be=be[0],h=h[0],Ft&&(Ge[0]!=be||mt[0]!=h)))return 3;Ie!=null&&(Ie[0]=St,Ie.offset=k-Ie.w,f(4294967286>k-Ie.w),f(Ie.offset==Ie.ha-W));break}return o==0||o==7&&Ft&&Ie==null?(ye!=null&&(ye[0]|=St.na!=null&&0<St.na.length),J!=null&&(J[0]=be),de!=null&&(de[0]=h),0):o}function el(E,k,W){var J=k.width,de=k.height,ye=0,be=0,Me=J,Ie=de;if(k.Da=E!=null&&0<E.Da,k.Da&&(Me=E.cd,Ie=E.bd,ye=E.v,be=E.j,11>W||(ye&=-2,be&=-2),0>ye||0>be||0>=Me||0>=Ie||ye+Me>J||be+Ie>de))return 0;if(k.v=ye,k.j=be,k.va=ye+Me,k.o=be+Ie,k.U=Me,k.T=Ie,k.da=E!=null&&0<E.da,k.da){if(!At(Me,Ie,W=[E.ib],ye=[E.hb]))return 0;k.ib=W[0],k.hb=ye[0]}return k.ob=E!=null&&E.ob,k.Kb=E==null||!E.Sd,k.da&&(k.ob=k.ib<3*J/4&&k.hb<3*de/4,k.Kb=0),1}function tl(E){if(E==null)return 2;if(11>E.S){var k=E.f.RGBA;k.fb+=(E.height-1)*k.A,k.A=-k.A}else k=E.f.kb,E=E.height,k.O+=(E-1)*k.fa,k.fa=-k.fa,k.N+=(E-1>>1)*k.Ab,k.Ab=-k.Ab,k.W+=(E-1>>1)*k.Db,k.Db=-k.Db,k.F!=null&&(k.J+=(E-1)*k.lb,k.lb=-k.lb);return 0}function il(E,k,W,J){if(J==null||0>=E||0>=k)return 2;if(W!=null){if(W.Da){var de=W.cd,ye=W.bd,be=-2&W.v,Me=-2&W.j;if(0>be||0>Me||0>=de||0>=ye||be+de>E||Me+ye>k)return 2;E=de,k=ye}if(W.da){if(!At(E,k,de=[W.ib],ye=[W.hb]))return 2;E=de[0],k=ye[0]}}J.width=E,J.height=k;e:{var Ie=J.width,Ge=J.height;if(E=J.S,0>=Ie||0>=Ge||!(E>=Os&&13>E))E=2;else{if(0>=J.Rd&&J.sd==null){be=ye=de=k=0;var mt=(Me=Ie*Ba[E])*Ge;if(11>E||(ye=(Ge+1)/2*(k=(Ie+1)/2),E==12&&(be=(de=Ie)*Ge)),(Ge=z(mt+2*ye+be))==null){E=1;break e}J.sd=Ge,11>E?((Ie=J.f.RGBA).eb=Ge,Ie.fb=0,Ie.A=Me,Ie.size=mt):((Ie=J.f.kb).y=Ge,Ie.O=0,Ie.fa=Me,Ie.Fd=mt,Ie.f=Ge,Ie.N=0+mt,Ie.Ab=k,Ie.Cd=ye,Ie.ea=Ge,Ie.W=0+mt+ye,Ie.Db=k,Ie.Ed=ye,E==12&&(Ie.F=Ge,Ie.J=0+mt+2*ye),Ie.Tc=be,Ie.lb=de)}if(k=1,de=J.S,ye=J.width,be=J.height,de>=Os&&13>de)if(11>de)E=J.f.RGBA,k&=(Me=Math.abs(E.A))*(be-1)+ye<=E.size,k&=Me>=ye*Ba[de],k&=E.eb!=null;else{E=J.f.kb,Me=(ye+1)/2,mt=(be+1)/2,Ie=Math.abs(E.fa),Ge=Math.abs(E.Ab);var Ft=Math.abs(E.Db),zt=Math.abs(E.lb),St=zt*(be-1)+ye;k&=Ie*(be-1)+ye<=E.Fd,k&=Ge*(mt-1)+Me<=E.Cd,k=(k&=Ft*(mt-1)+Me<=E.Ed)&Ie>=ye&Ge>=Me&Ft>=Me,k&=E.y!=null,k&=E.f!=null,k&=E.ea!=null,de==12&&(k&=zt>=ye,k&=St<=E.Tc,k&=E.F!=null)}else k=0;E=k?0:2}}return E!=0||W!=null&&W.fd&&(E=tl(J)),E}var On=64,io=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ia=24,_o=32,Ca=8,ln=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Kt("Predictor0","PredictorAdd0"),le.Predictor0=function(){return 4278190080},le.Predictor1=function(E){return E},le.Predictor2=function(E,k,W){return k[W+0]},le.Predictor3=function(E,k,W){return k[W+1]},le.Predictor4=function(E,k,W){return k[W-1]},le.Predictor5=function(E,k,W){return yt(yt(E,k[W+1]),k[W+0])},le.Predictor6=function(E,k,W){return yt(E,k[W-1])},le.Predictor7=function(E,k,W){return yt(E,k[W+0])},le.Predictor8=function(E,k,W){return yt(k[W-1],k[W+0])},le.Predictor9=function(E,k,W){return yt(k[W+0],k[W+1])},le.Predictor10=function(E,k,W){return yt(yt(E,k[W-1]),yt(k[W+0],k[W+1]))},le.Predictor11=function(E,k,W){var J=k[W+0];return 0>=xi(J>>24&255,E>>24&255,(k=k[W-1])>>24&255)+xi(J>>16&255,E>>16&255,k>>16&255)+xi(J>>8&255,E>>8&255,k>>8&255)+xi(255&J,255&E,255&k)?J:E},le.Predictor12=function(E,k,W){var J=k[W+0];return(ri((E>>24&255)+(J>>24&255)-((k=k[W-1])>>24&255))<<24|ri((E>>16&255)+(J>>16&255)-(k>>16&255))<<16|ri((E>>8&255)+(J>>8&255)-(k>>8&255))<<8|ri((255&E)+(255&J)-(255&k)))>>>0},le.Predictor13=function(E,k,W){var J=k[W-1];return(mi((E=yt(E,k[W+0]))>>24&255,J>>24&255)<<24|mi(E>>16&255,J>>16&255)<<16|mi(E>>8&255,J>>8&255)<<8|mi(E>>0&255,J>>0&255))>>>0};var rl=le.PredictorAdd0;le.PredictorAdd1=Li,Kt("Predictor2","PredictorAdd2"),Kt("Predictor3","PredictorAdd3"),Kt("Predictor4","PredictorAdd4"),Kt("Predictor5","PredictorAdd5"),Kt("Predictor6","PredictorAdd6"),Kt("Predictor7","PredictorAdd7"),Kt("Predictor8","PredictorAdd8"),Kt("Predictor9","PredictorAdd9"),Kt("Predictor10","PredictorAdd10"),Kt("Predictor11","PredictorAdd11"),Kt("Predictor12","PredictorAdd12"),Kt("Predictor13","PredictorAdd13");var Aa=le.PredictorAdd2;si("ColorIndexInverseTransform","MapARGB","32b",function(E){return E>>8&255},function(E){return E}),si("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(E){return E},function(E){return E>>8&255});var Ea,Is=le.ColorIndexInverseTransform,Pa=le.MapARGB,yc=le.VP8LColorIndexInverseTransformAlpha,Ol=le.MapAlpha,ro=le.VP8LPredictorsAdd=[];ro.length=16,(le.VP8LPredictors=[]).length=16,(le.VP8LPredictorsAdd_C=[]).length=16,(le.VP8LPredictors_C=[]).length=16;var Hn,ks,yo,vo,no,Ma,ts,La,ra,Vo,$n,qo,Ia,nl,ka,na,sl,is,fs,Xr,Hr,Rr,dn,xn,Ds,Da,xo,Oa,Fl=z(511),zl=z(2041),vr=z(225),ol=z(767),vc=0,al=zl,Go=vr,ds=ol,rs=Fl,Os=0,Rl=1,Bl=2,Wo=3,Xo=4,Nl=5,ll=6,Fa=7,cl=8,za=9,yi=10,so=[2,3,7],oh=[3,3,11],hl=[280,256,256,256,40],jl=[0,1,1,1,0],Fn=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ul=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Ql=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],xc=8,ul=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ec=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],sa=null,fl=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],bc=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ah=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],lh=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],dl=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],wc=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Sc=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],bo=[],ps=[],As=[],Vl=1,tc=2,Ho=[],ms=[];Zt("UpsampleRgbLinePair",_r,3),Zt("UpsampleBgrLinePair",on,3),Zt("UpsampleRgbaLinePair",to,4),Zt("UpsampleBgraLinePair",vn,4),Zt("UpsampleArgbLinePair",fn,4),Zt("UpsampleRgba4444LinePair",gn,2),Zt("UpsampleRgb565LinePair",an,2);var ch=le.UpsampleRgbLinePair,oa=le.UpsampleBgrLinePair,Tc=le.UpsampleRgbaLinePair,Cc=le.UpsampleBgraLinePair,hh=le.UpsampleArgbLinePair,Ac=le.UpsampleRgba4444LinePair,Ec=le.UpsampleRgb565LinePair,ql=16,Gl=1<<ql-1,bn=-227,Pc=482,Mc=6,jh=(256<<Mc)-1,uh=0,Fs=z(256),fh=z(256),Uh=z(256),oo=z(256),wo=z(Pc-bn),Ra=z(Pc-bn);jo("YuvToRgbRow",_r,3),jo("YuvToBgrRow",on,3),jo("YuvToRgbaRow",to,4),jo("YuvToBgraRow",vn,4),jo("YuvToArgbRow",fn,4),jo("YuvToRgba4444Row",gn,2),jo("YuvToRgb565Row",an,2);var Wl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],bi=[0,2,8],Lc=[8,7,6,4,4,2,2,2,1,1,1,1],Ic=1;this.WebPDecodeRGBA=function(E,k,W,J,de){var ye=Rl,be=new mr,Me=new fe;be.ba=Me,Me.S=ye,Me.width=[Me.width],Me.height=[Me.height];var Ie=Me.width,Ge=Me.height,mt=new Ve;if(mt==null||E==null)var Ft=2;else f(mt!=null),Ft=Uo(E,k,W,mt.width,mt.height,mt.Pd,mt.Qd,mt.format,null);if(Ft!=0?Ie=0:(Ie!=null&&(Ie[0]=mt.width[0]),Ge!=null&&(Ge[0]=mt.height[0]),Ie=1),Ie){Me.width=Me.width[0],Me.height=Me.height[0],J!=null&&(J[0]=Me.width),de!=null&&(de[0]=Me.height);e:{if(J=new Wn,(de=new Il).data=E,de.w=k,de.ha=W,de.kd=1,k=[0],f(de!=null),((E=Uo(de.data,de.w,de.ha,null,null,null,k,null,de))==0||E==7)&&k[0]&&(E=4),(k=E)==0){if(f(be!=null),J.data=de.data,J.w=de.w+de.offset,J.ha=de.ha-de.offset,J.put=Dt,J.ac=st,J.bc=ti,J.ma=be,de.xa){if((E=Fr())==null){be=1;break e}if(function(zt,St){var h=[0],r=[0],o=[0];t:for(;;){if(zt==null)return 0;if(St==null)return zt.a=2,0;if(zt.l=St,zt.a=0,He(zt.m,St.data,St.w,St.ha),!Vt(zt.m,h,r,o)){zt.a=3;break t}if(zt.xb=tc,St.width=h[0],St.height=r[0],!Bn(h[0],r[0],1,zt,null))break t;return 1}return f(zt.a!=0),0}(E,J)){if(J=(k=il(J.width,J.height,be.Oa,be.ba))==0){t:{J=E;i:for(;;){if(J==null){J=0;break t}if(f(J.s.yc!=null),f(J.s.Ya!=null),f(0<J.s.Wb),f((W=J.l)!=null),f((de=W.ma)!=null),J.xb!=0){if(J.ca=de.ba,J.tb=de.tb,f(J.ca!=null),!el(de.Oa,W,Wo)){J.a=2;break i}if(!Io(J,W.width)||W.da)break i;if((W.da||Hi(J.ca.S))&&It(),11>J.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),J.ca.f.kb.F!=null&&It()),J.Pb&&0<J.s.ua&&J.s.vb.X==null&&!ct(J.s.vb,J.s.Wa.Xa)){J.a=1;break i}J.xb=0}if(!un(J,J.V,J.Ba,J.c,J.i,W.o,Ar))break i;de.Dc=J.Ma,J=1;break t}f(J.a!=0),J=0}J=!J}J&&(k=E.a)}else k=E.a}else{if((E=new Gr)==null){be=1;break e}if(E.Fa=de.na,E.P=de.P,E.qc=de.Sa,br(E,J)){if((k=il(J.width,J.height,be.Oa,be.ba))==0){if(E.Aa=0,W=be.Oa,f((de=E)!=null),W!=null){if(0<(Ie=0>(Ie=W.Md)?0:100<Ie?255:255*Ie/100)){for(Ge=mt=0;4>Ge;++Ge)12>(Ft=de.pb[Ge]).lc&&(Ft.ia=Ie*Lc[0>Ft.lc?0:Ft.lc]>>3),mt|=Ft.ia;mt&&(alert("todo:VP8InitRandom"),de.ia=1)}de.Ga=W.Id,100<de.Ga?de.Ga=100:0>de.Ga&&(de.Ga=0)}Ks(E,J)||(k=E.a)}}else k=E.a}k==0&&be.Oa!=null&&be.Oa.fd&&(k=tl(be.ba))}be=k}ye=be!=0?null:11>ye?Me.f.RGBA.eb:Me.f.kb.y}else ye=null;return ye};var Ba=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function v(le,ve){for(var ot="",_e=0;_e<4;_e++)ot+=String.fromCharCode(le[ve++]);return ot}function x(le,ve){return(le[ve+0]<<0|le[ve+1]<<8|le[ve+2]<<16)>>>0}function d(le,ve){return(le[ve+0]<<0|le[ve+1]<<8|le[ve+2]<<16|le[ve+3]<<24)>>>0}new l;var m=[0],c=[0],_=[],w=new l,g=M,C=function(le,ve){var ot={},_e=0,pe=!1,ze=0,De=0;if(ot.frames=[],!function(ce,re,te,we){for(var ke=0;ke<we;ke++)if(ce[re+ke]!=te.charCodeAt(ke))return!0;return!1}(le,ve,"RIFF",4)){var at,ft;for(d(le,ve+=4),ve+=8;ve<le.length;){var xt=v(le,ve),He=d(le,ve+=4);ve+=4;var ae=He+(1&He);switch(xt){case"VP8 ":case"VP8L":ot.frames[_e]===void 0&&(ot.frames[_e]={}),(Y=ot.frames[_e]).src_off=pe?De:ve-8,Y.src_size=ze+He+8,_e++,pe&&(pe=!1,ze=0,De=0);break;case"VP8X":(Y=ot.header={}).feature_flags=le[ve];var Te=ve+4;Y.canvas_width=1+x(le,Te),Te+=3,Y.canvas_height=1+x(le,Te),Te+=3;break;case"ALPH":pe=!0,ze=ae+8,De=ve-8;break;case"ANIM":(Y=ot.header).bgcolor=d(le,ve),Te=ve+4,Y.loop_count=(at=le)[(ft=Te)+0]<<0|at[ft+1]<<8,Te+=2;break;case"ANMF":var Oe,Y;(Y=ot.frames[_e]={}).offset_x=2*x(le,ve),ve+=3,Y.offset_y=2*x(le,ve),ve+=3,Y.width=1+x(le,ve),ve+=3,Y.height=1+x(le,ve),ve+=3,Y.duration=x(le,ve),ve+=3,Oe=le[ve++],Y.dispose=1&Oe,Y.blend=Oe>>1&1}xt!="ANMF"&&(ve+=ae)}return ot}}(g,0);C.response=g,C.rgbaoutput=!0,C.dataurl=!1;var L=C.header?C.header:null,B=C.frames?C.frames:null;if(L){L.loop_counter=L.loop_count,m=[L.canvas_height],c=[L.canvas_width];for(var q=0;q<B.length&&B[q].blend!=0;q++);}var K=B[0],se=w.WebPDecodeRGBA(g,K.src_off,K.src_size,c,m);K.rgba=se,K.imgwidth=c[0],K.imgheight=m[0];for(var he=0;he<c[0]*m[0]*4;he++)_[he]=se[he];return this.width=c,this.height=m,this.data=_,this}(function(M){var f=function(){return typeof sp=="function"},A=function(m,c,_,w){var g=4,C=V;switch(w){case M.image_compression.FAST:g=1,C=z;break;case M.image_compression.MEDIUM:g=6,C=t;break;case M.image_compression.SLOW:g=9,C=l}m=D(m,c,_,C);var L=sp(m,{level:g});return M.__addimage__.arrayBufferToBinaryString(L)},D=function(m,c,_,w){for(var g,C,L,B=m.length/c,q=new Uint8Array(m.length+B),K=x(),se=0;se<B;se+=1){if(L=se*c,g=m.subarray(L,L+c),w)q.set(w(g,_,C),L+se);else{for(var he,le=K.length,ve=[];he<le;he+=1)ve[he]=K[he](g,_,C);var ot=d(ve.concat());q.set(ve[ot],L+se)}C=g}return q},R=function(m){var c=Array.apply([],m);return c.unshift(0),c},z=function(m,c){var _,w=[],g=m.length;w[0]=1;for(var C=0;C<g;C+=1)_=m[C-c]||0,w[C+1]=m[C]-_+256&255;return w},V=function(m,c,_){var w,g=[],C=m.length;g[0]=2;for(var L=0;L<C;L+=1)w=_&&_[L]||0,g[L+1]=m[L]-w+256&255;return g},t=function(m,c,_){var w,g,C=[],L=m.length;C[0]=3;for(var B=0;B<L;B+=1)w=m[B-c]||0,g=_&&_[B]||0,C[B+1]=m[B]+256-(w+g>>>1)&255;return C},l=function(m,c,_){var w,g,C,L,B=[],q=m.length;B[0]=4;for(var K=0;K<q;K+=1)w=m[K-c]||0,g=_&&_[K]||0,C=_&&_[K-c]||0,L=v(w,g,C),B[K+1]=m[K]-L+256&255;return B},v=function(m,c,_){if(m===c&&c===_)return m;var w=Math.abs(c-_),g=Math.abs(m-_),C=Math.abs(m+c-_-_);return w<=g&&w<=C?m:g<=C?c:_},x=function(){return[R,z,V,t,l]},d=function(m){var c=m.map(function(_){return _.reduce(function(w,g){return w+Math.abs(g)},0)});return c.indexOf(Math.min.apply(null,c))};M.processPNG=function(m,c,_,w){var g,C,L,B,q,K,se,he,le,ve,ot,_e,pe,ze,De,at=this.decode.FLATE_DECODE,ft="";if(this.__addimage__.isArrayBuffer(m)&&(m=new Uint8Array(m)),this.__addimage__.isArrayBufferView(m)){if(m=(L=new ev(m)).imgData,C=L.bits,g=L.colorSpace,q=L.colors,[4,6].indexOf(L.colorType)!==-1){if(L.bits===8){le=(he=L.pixelBitlength==32?new Uint32Array(L.decodePixels().buffer):L.pixelBitlength==16?new Uint16Array(L.decodePixels().buffer):new Uint8Array(L.decodePixels().buffer)).length,ot=new Uint8Array(le*L.colors),ve=new Uint8Array(le);var xt,He=L.pixelBitlength-L.bits;for(ze=0,De=0;ze<le;ze++){for(pe=he[ze],xt=0;xt<He;)ot[De++]=pe>>>xt&255,xt+=L.bits;ve[ze]=pe>>>xt&255}}if(L.bits===16){le=(he=new Uint32Array(L.decodePixels().buffer)).length,ot=new Uint8Array(le*(32/L.pixelBitlength)*L.colors),ve=new Uint8Array(le*(32/L.pixelBitlength)),_e=L.colors>1,ze=0,De=0;for(var ae=0;ze<le;)pe=he[ze++],ot[De++]=pe>>>0&255,_e&&(ot[De++]=pe>>>16&255,pe=he[ze++],ot[De++]=pe>>>0&255),ve[ae++]=pe>>>16&255;C=8}w!==M.image_compression.NONE&&f()?(m=A(ot,L.width*L.colors,L.colors,w),se=A(ve,L.width,1,w)):(m=ot,se=ve,at=void 0)}if(L.colorType===3&&(g=this.color_spaces.INDEXED,K=L.palette,L.transparency.indexed)){var Te=L.transparency.indexed,Oe=0;for(ze=0,le=Te.length;ze<le;++ze)Oe+=Te[ze];if((Oe/=255)===le-1&&Te.indexOf(0)!==-1)B=[Te.indexOf(0)];else if(Oe!==le){for(he=L.decodePixels(),ve=new Uint8Array(he.length),ze=0,le=he.length;ze<le;ze++)ve[ze]=Te[he[ze]];se=A(ve,L.width,1)}}var Y=function(ce){var re;switch(ce){case M.image_compression.FAST:re=11;break;case M.image_compression.MEDIUM:re=13;break;case M.image_compression.SLOW:re=14;break;default:re=12}return re}(w);return at===this.decode.FLATE_DECODE&&(ft="/Predictor "+Y+" "),ft+="/Colors "+q+" /BitsPerComponent "+C+" /Columns "+L.width,(this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),(se&&this.__addimage__.isArrayBuffer(se)||this.__addimage__.isArrayBufferView(se))&&(se=this.__addimage__.arrayBufferToBinaryString(se)),{alias:_,data:m,index:c,filter:at,decodeParameters:ft,transparency:B,palette:K,sMask:se,predictor:Y,width:L.width,height:L.height,bitsPerComponent:C,colorSpace:g}}}})(tr.API),function(M){M.processGIF89A=function(f,A,D,R){var z=new tv(f),V=z.width,t=z.height,l=[];z.decodeAndBlitFrameRGBA(0,l);var v={data:l,width:V,height:t},x=new Kd(100).encode(v,100);return M.processJPEG.call(this,x,A,D,R)},M.processGIF87A=M.processGIF89A}(tr.API),$a.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var M=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(M);for(var f=0;f<M;f++){var A=this.datav.getUint8(this.pos++,!0),D=this.datav.getUint8(this.pos++,!0),R=this.datav.getUint8(this.pos++,!0),z=this.datav.getUint8(this.pos++,!0);this.palette[f]={red:R,green:D,blue:A,quad:z}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},$a.prototype.parseBGR=function(){this.pos=this.offset;try{var M="bit"+this.bitPP,f=this.width*this.height*4;this.data=new Uint8Array(f),this[M]()}catch(A){hn.log("bit decode error:"+A)}},$a.prototype.bit1=function(){var M,f=Math.ceil(this.width/8),A=f%4;for(M=this.height-1;M>=0;M--){for(var D=this.bottom_up?M:this.height-1-M,R=0;R<f;R++)for(var z=this.datav.getUint8(this.pos++,!0),V=D*this.width*4+8*R*4,t=0;t<8&&8*R+t<this.width;t++){var l=this.palette[z>>7-t&1];this.data[V+4*t]=l.blue,this.data[V+4*t+1]=l.green,this.data[V+4*t+2]=l.red,this.data[V+4*t+3]=255}A!==0&&(this.pos+=4-A)}},$a.prototype.bit4=function(){for(var M=Math.ceil(this.width/2),f=M%4,A=this.height-1;A>=0;A--){for(var D=this.bottom_up?A:this.height-1-A,R=0;R<M;R++){var z=this.datav.getUint8(this.pos++,!0),V=D*this.width*4+2*R*4,t=z>>4,l=15&z,v=this.palette[t];if(this.data[V]=v.blue,this.data[V+1]=v.green,this.data[V+2]=v.red,this.data[V+3]=255,2*R+1>=this.width)break;v=this.palette[l],this.data[V+4]=v.blue,this.data[V+4+1]=v.green,this.data[V+4+2]=v.red,this.data[V+4+3]=255}f!==0&&(this.pos+=4-f)}},$a.prototype.bit8=function(){for(var M=this.width%4,f=this.height-1;f>=0;f--){for(var A=this.bottom_up?f:this.height-1-f,D=0;D<this.width;D++){var R=this.datav.getUint8(this.pos++,!0),z=A*this.width*4+4*D;if(R<this.palette.length){var V=this.palette[R];this.data[z]=V.red,this.data[z+1]=V.green,this.data[z+2]=V.blue,this.data[z+3]=255}else this.data[z]=255,this.data[z+1]=255,this.data[z+2]=255,this.data[z+3]=255}M!==0&&(this.pos+=4-M)}},$a.prototype.bit15=function(){for(var M=this.width%3,f=parseInt("11111",2),A=this.height-1;A>=0;A--){for(var D=this.bottom_up?A:this.height-1-A,R=0;R<this.width;R++){var z=this.datav.getUint16(this.pos,!0);this.pos+=2;var V=(z&f)/f*255|0,t=(z>>5&f)/f*255|0,l=(z>>10&f)/f*255|0,v=z>>15?255:0,x=D*this.width*4+4*R;this.data[x]=l,this.data[x+1]=t,this.data[x+2]=V,this.data[x+3]=v}this.pos+=M}},$a.prototype.bit16=function(){for(var M=this.width%3,f=parseInt("11111",2),A=parseInt("111111",2),D=this.height-1;D>=0;D--){for(var R=this.bottom_up?D:this.height-1-D,z=0;z<this.width;z++){var V=this.datav.getUint16(this.pos,!0);this.pos+=2;var t=(V&f)/f*255|0,l=(V>>5&A)/A*255|0,v=(V>>11)/f*255|0,x=R*this.width*4+4*z;this.data[x]=v,this.data[x+1]=l,this.data[x+2]=t,this.data[x+3]=255}this.pos+=M}},$a.prototype.bit24=function(){for(var M=this.height-1;M>=0;M--){for(var f=this.bottom_up?M:this.height-1-M,A=0;A<this.width;A++){var D=this.datav.getUint8(this.pos++,!0),R=this.datav.getUint8(this.pos++,!0),z=this.datav.getUint8(this.pos++,!0),V=f*this.width*4+4*A;this.data[V]=z,this.data[V+1]=R,this.data[V+2]=D,this.data[V+3]=255}this.pos+=this.width%4}},$a.prototype.bit32=function(){for(var M=this.height-1;M>=0;M--)for(var f=this.bottom_up?M:this.height-1-M,A=0;A<this.width;A++){var D=this.datav.getUint8(this.pos++,!0),R=this.datav.getUint8(this.pos++,!0),z=this.datav.getUint8(this.pos++,!0),V=this.datav.getUint8(this.pos++,!0),t=f*this.width*4+4*A;this.data[t]=z,this.data[t+1]=R,this.data[t+2]=D,this.data[t+3]=V}},$a.prototype.getData=function(){return this.data},function(M){M.processBMP=function(f,A,D,R){var z=new $a(f,!1),V=z.width,t=z.height,l={data:z.getData(),width:V,height:t},v=new Kd(100).encode(l,100);return M.processJPEG.call(this,v,A,D,R)}}(tr.API),__.prototype.getData=function(){return this.data},function(M){M.processWEBP=function(f,A,D,R){var z=new __(f),V=z.width,t=z.height,l={data:z.getData(),width:V,height:t},v=new Kd(100).encode(l,100);return M.processJPEG.call(this,v,A,D,R)}}(tr.API),tr.API.processRGBA=function(M,f,A){for(var D=M.data,R=D.length,z=new Uint8Array(R/4*3),V=new Uint8Array(R/4),t=0,l=0,v=0;v<R;v+=4){var x=D[v],d=D[v+1],m=D[v+2],c=D[v+3];z[t++]=x,z[t++]=d,z[t++]=m,V[l++]=c}var _=this.__addimage__.arrayBufferToBinaryString(z);return{alpha:this.__addimage__.arrayBufferToBinaryString(V),data:_,index:f,alias:A,colorSpace:"DeviceRGB",bitsPerComponent:8,width:M.width,height:M.height}},tr.API.setLanguage=function(M){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[M]!==void 0&&(this.internal.languageSettings.languageCode=M,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Fh=tr.API,Af=Fh.getCharWidthsArray=function(M,f){var A,D,R=(f=f||{}).font||this.internal.getFont(),z=f.fontSize||this.internal.getFontSize(),V=f.charSpace||this.internal.getCharSpace(),t=f.widths?f.widths:R.metadata.Unicode.widths,l=t.fof?t.fof:1,v=f.kerning?f.kerning:R.metadata.Unicode.kerning,x=v.fof?v.fof:1,d=f.doKerning!==!1,m=0,c=M.length,_=0,w=t[0]||l,g=[];for(A=0;A<c;A++)D=M.charCodeAt(A),typeof R.metadata.widthOfString=="function"?g.push((R.metadata.widthOfGlyph(R.metadata.characterToGlyph(D))+V*(1e3/z)||0)/1e3):(m=d&&rn(v[D])==="object"&&!isNaN(parseInt(v[D][_],10))?v[D][_]/x:0,g.push((t[D]||w)/l+m)),_=D;return g},d_=Fh.getStringUnitWidth=function(M,f){var A=(f=f||{}).fontSize||this.internal.getFontSize(),D=f.font||this.internal.getFont(),R=f.charSpace||this.internal.getCharSpace();return Fh.processArabic&&(M=Fh.processArabic(M)),typeof D.metadata.widthOfString=="function"?D.metadata.widthOfString(M,A,R)/A:Af.apply(this,arguments).reduce(function(z,V){return z+V},0)},p_=function(M,f,A,D){for(var R=[],z=0,V=M.length,t=0;z!==V&&t+f[z]<A;)t+=f[z],z++;R.push(M.slice(0,z));var l=z;for(t=0;z!==V;)t+f[z]>D&&(R.push(M.slice(l,z)),t=0,l=z),t+=f[z],z++;return l!==z&&R.push(M.slice(l,z)),R},m_=function(M,f,A){A||(A={});var D,R,z,V,t,l,v,x=[],d=[x],m=A.textIndent||0,c=0,_=0,w=M.split(" "),g=Af.apply(this,[" ",A])[0];if(l=A.lineIndent===-1?w[0].length+2:A.lineIndent||0){var C=Array(l).join(" "),L=[];w.map(function(q){(q=q.split(/\s*\n/)).length>1?L=L.concat(q.map(function(K,se){return(se&&K.length?`
`:"")+K})):L.push(q[0])}),w=L,l=d_.apply(this,[C,A])}for(z=0,V=w.length;z<V;z++){var B=0;if(D=w[z],l&&D[0]==`
`&&(D=D.substr(1),B=1),m+c+(_=(R=Af.apply(this,[D,A])).reduce(function(q,K){return q+K},0))>f||B){if(_>f){for(t=p_.apply(this,[D,R,f-(m+c),f]),x.push(t.shift()),x=[t.pop()];t.length;)d.push([t.shift()]);_=R.slice(D.length-(x[0]?x[0].length:0)).reduce(function(q,K){return q+K},0)}else x=[D];d.push(x),m=_+l,c=g}else x.push(D),m+=c+_,c=g}return v=l?function(q,K){return(K?C:"")+q.join(" ")}:function(q){return q.join(" ")},d.map(v)},Fh.splitTextToSize=function(M,f,A){var D,R=(A=A||{}).fontSize||this.internal.getFontSize(),z=function(x){if(x.widths&&x.kerning)return{widths:x.widths,kerning:x.kerning};var d=this.internal.getFont(x.fontName,x.fontStyle);return d.metadata.Unicode?{widths:d.metadata.Unicode.widths||{0:1},kerning:d.metadata.Unicode.kerning||{}}:{font:d.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,A);D=Array.isArray(M)?M:String(M).split(/\r?\n/);var V=1*this.internal.scaleFactor*f/R;z.textIndent=A.textIndent?1*A.textIndent*this.internal.scaleFactor/R:0,z.lineIndent=A.lineIndent;var t,l,v=[];for(t=0,l=D.length;t<l;t++)v=v.concat(m_.apply(this,[D[t],V,z]));return v},function(M){M.__fontmetrics__=M.__fontmetrics__||{};for(var f="klmnopqrstuvwxyz",A={},D={},R=0;R<f.length;R++)A[f[R]]="0123456789abcdef"[R],D["0123456789abcdef"[R]]=f[R];var z=function(d){return"0x"+parseInt(d,10).toString(16)},V=M.__fontmetrics__.compress=function(d){var m,c,_,w,g=["{"];for(var C in d){if(m=d[C],isNaN(parseInt(C,10))?c="'"+C+"'":(C=parseInt(C,10),c=(c=z(C).slice(2)).slice(0,-1)+D[c.slice(-1)]),typeof m=="number")m<0?(_=z(m).slice(3),w="-"):(_=z(m).slice(2),w=""),_=w+_.slice(0,-1)+D[_.slice(-1)];else{if(rn(m)!=="object")throw new Error("Don't know what to do with value type "+rn(m)+".");_=V(m)}g.push(c+_)}return g.push("}"),g.join("")},t=M.__fontmetrics__.uncompress=function(d){if(typeof d!="string")throw new Error("Invalid argument passed to uncompress.");for(var m,c,_,w,g={},C=1,L=g,B=[],q="",K="",se=d.length-1,he=1;he<se;he+=1)(w=d[he])=="'"?m?(_=m.join(""),m=void 0):m=[]:m?m.push(w):w=="{"?(B.push([L,_]),L={},_=void 0):w=="}"?((c=B.pop())[0][c[1]]=L,_=void 0,L=c[0]):w=="-"?C=-1:_===void 0?A.hasOwnProperty(w)?(q+=A[w],_=parseInt(q,16)*C,C=1,q=""):q+=w:A.hasOwnProperty(w)?(K+=A[w],L[_]=parseInt(K,16)*C,C=1,_=void 0,K=""):K+=w;return g},l={codePages:["WinAnsiEncoding"],WinAnsiEncoding:t("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},v={Unicode:{Courier:l,"Courier-Bold":l,"Courier-BoldOblique":l,"Courier-Oblique":l,Helvetica:l,"Helvetica-Bold":l,"Helvetica-BoldOblique":l,"Helvetica-Oblique":l,"Times-Roman":l,"Times-Bold":l,"Times-BoldItalic":l,"Times-Italic":l}},x={Unicode:{"Courier-Oblique":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":t("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":t("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:t("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:t("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":t("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":t("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};M.events.push(["addFont",function(d){var m=d.font,c=x.Unicode[m.postScriptName];c&&(m.metadata.Unicode={},m.metadata.Unicode.widths=c.widths,m.metadata.Unicode.kerning=c.kerning);var _=v.Unicode[m.postScriptName];_&&(m.metadata.Unicode.encoding=_,m.encoding=_.codePages[0])}])}(tr.API),function(M){var f=function(A){for(var D=A.length,R=new Uint8Array(D),z=0;z<D;z++)R[z]=A.charCodeAt(z);return R};M.API.events.push(["addFont",function(A){var D=void 0,R=A.font,z=A.instance;if(!R.isStandardFont){if(z===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+R.postScriptName+"').");if(typeof(D=z.existsFileInVFS(R.postScriptName)===!1?z.loadFile(R.postScriptName):z.getFileFromVFS(R.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+R.postScriptName+"').");(function(V,t){t=/^\x00\x01\x00\x00/.test(t)?f(t):f(Iu(t)),V.metadata=M.API.TTFFont.open(t),V.metadata.Unicode=V.metadata.Unicode||{encoding:{},kerning:{},widths:[]},V.metadata.glyIdsUsed=[0]})(R,D)}}])}(tr),function(M){function f(){return(cr.canvg?Promise.resolve(cr.canvg):ep(()=>import("./index.es-ea6801b1.js"),[],import.meta.url)).catch(function(A){return Promise.reject(new Error("Could not load canvg: "+A))}).then(function(A){return A.default?A.default:A})}tr.API.addSvgAsImage=function(A,D,R,z,V,t,l,v){if(isNaN(D)||isNaN(R))throw hn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(z)||isNaN(V))throw hn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var x=document.createElement("canvas");x.width=z,x.height=V;var d=x.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,x.width,x.height);var m={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},c=this;return f().then(function(_){return _.fromString(d,A,m)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(_){return _.render(m)}).then(function(){c.addImage(x.toDataURL("image/jpeg",1),D,R,z,V,l,v)})}}(),tr.API.putTotalPages=function(M){var f,A=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(f=new RegExp(M,"g"),A=this.internal.getNumberOfPages()):(f=new RegExp(this.pdfEscape16(M,this.internal.getFont()),"g"),A=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var D=1;D<=this.internal.getNumberOfPages();D++)for(var R=0;R<this.internal.pages[D].length;R++)this.internal.pages[D][R]=this.internal.pages[D][R].replace(f,A);return this},tr.API.viewerPreferences=function(M,f){var A;M=M||{},f=f||!1;var D,R,z,V={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},t=Object.keys(V),l=[],v=0,x=0,d=0;function m(_,w){var g,C=!1;for(g=0;g<_.length;g+=1)_[g]===w&&(C=!0);return C}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(V)),this.internal.viewerpreferences.isSubscribed=!1),A=this.internal.viewerpreferences.configuration,M==="reset"||f===!0){var c=t.length;for(d=0;d<c;d+=1)A[t[d]].value=A[t[d]].defaultValue,A[t[d]].explicitSet=!1}if(rn(M)==="object"){for(R in M)if(z=M[R],m(t,R)&&z!==void 0){if(A[R].type==="boolean"&&typeof z=="boolean")A[R].value=z;else if(A[R].type==="name"&&m(A[R].valueSet,z))A[R].value=z;else if(A[R].type==="integer"&&Number.isInteger(z))A[R].value=z;else if(A[R].type==="array"){for(v=0;v<z.length;v+=1)if(D=!0,z[v].length===1&&typeof z[v][0]=="number")l.push(String(z[v]-1));else if(z[v].length>1){for(x=0;x<z[v].length;x+=1)typeof z[v][x]!="number"&&(D=!1);D===!0&&l.push([z[v][0]-1,z[v][1]-1].join(" "))}A[R].value="["+l.join(" ")+"]"}else A[R].value=A[R].defaultValue;A[R].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var _,w=[];for(_ in A)A[_].explicitSet===!0&&(A[_].type==="name"?w.push("/"+_+" /"+A[_].value):w.push("/"+_+" "+A[_].value));w.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+w.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=A,this},function(M){var f=function(){var D='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',R=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),z=unescape(encodeURIComponent(D)),V=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),t=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),l=unescape(encodeURIComponent("</x:xmpmeta>")),v=z.length+V.length+t.length+R.length+l.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+v+" >>"),this.internal.write("stream"),this.internal.write(R+z+V+t+l),this.internal.write("endstream"),this.internal.write("endobj")},A=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};M.addMetadata=function(D,R){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:D,namespaceuri:R||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",A),this.internal.events.subscribe("postPutResources",f)),this}}(tr.API),function(M){var f=M.API,A=f.pdfEscape16=function(z,V){for(var t,l=V.metadata.Unicode.widths,v=["","0","00","000","0000"],x=[""],d=0,m=z.length;d<m;++d){if(t=V.metadata.characterToGlyph(z.charCodeAt(d)),V.metadata.glyIdsUsed.push(t),V.metadata.toUnicode[t]=z.charCodeAt(d),l.indexOf(t)==-1&&(l.push(t),l.push([parseInt(V.metadata.widthOfGlyph(t),10)])),t=="0")return x.join("");t=t.toString(16),x.push(v[4-t.length],t)}return x.join("")},D=function(z){var V,t,l,v,x,d,m;for(x=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,l=[],d=0,m=(t=Object.keys(z).sort(function(c,_){return c-_})).length;d<m;d++)V=t[d],l.length>=100&&(x+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar`,l=[]),z[V]!==void 0&&z[V]!==null&&typeof z[V].toString=="function"&&(v=("0000"+z[V].toString(16)).slice(-4),V=("0000"+(+V).toString(16)).slice(-4),l.push("<"+V+"><"+v+">"));return l.length&&(x+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar
`),x+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};f.events.push(["putFont",function(z){(function(V){var t=V.font,l=V.out,v=V.newObject,x=V.putStream;if(t.metadata instanceof M.API.TTFFont&&t.encoding==="Identity-H"){for(var d=t.metadata.Unicode.widths,m=t.metadata.subset.encode(t.metadata.glyIdsUsed,1),c="",_=0;_<m.length;_++)c+=String.fromCharCode(m[_]);var w=v();x({data:c,addLength1:!0,objectId:w}),l("endobj");var g=v();x({data:D(t.metadata.toUnicode),addLength1:!0,objectId:g}),l("endobj");var C=v();l("<<"),l("/Type /FontDescriptor"),l("/FontName /"+Bh(t.fontName)),l("/FontFile2 "+w+" 0 R"),l("/FontBBox "+M.API.PDFObject.convert(t.metadata.bbox)),l("/Flags "+t.metadata.flags),l("/StemV "+t.metadata.stemV),l("/ItalicAngle "+t.metadata.italicAngle),l("/Ascent "+t.metadata.ascender),l("/Descent "+t.metadata.decender),l("/CapHeight "+t.metadata.capHeight),l(">>"),l("endobj");var L=v();l("<<"),l("/Type /Font"),l("/BaseFont /"+Bh(t.fontName)),l("/FontDescriptor "+C+" 0 R"),l("/W "+M.API.PDFObject.convert(d)),l("/CIDToGIDMap /Identity"),l("/DW 1000"),l("/Subtype /CIDFontType2"),l("/CIDSystemInfo"),l("<<"),l("/Supplement 0"),l("/Registry (Adobe)"),l("/Ordering ("+t.encoding+")"),l(">>"),l(">>"),l("endobj"),t.objectNumber=v(),l("<<"),l("/Type /Font"),l("/Subtype /Type0"),l("/ToUnicode "+g+" 0 R"),l("/BaseFont /"+Bh(t.fontName)),l("/Encoding /"+t.encoding),l("/DescendantFonts ["+L+" 0 R]"),l(">>"),l("endobj"),t.isAlreadyPutted=!0}})(z)}]),f.events.push(["putFont",function(z){(function(V){var t=V.font,l=V.out,v=V.newObject,x=V.putStream;if(t.metadata instanceof M.API.TTFFont&&t.encoding==="WinAnsiEncoding"){for(var d=t.metadata.rawData,m="",c=0;c<d.length;c++)m+=String.fromCharCode(d[c]);var _=v();x({data:m,addLength1:!0,objectId:_}),l("endobj");var w=v();x({data:D(t.metadata.toUnicode),addLength1:!0,objectId:w}),l("endobj");var g=v();l("<<"),l("/Descent "+t.metadata.decender),l("/CapHeight "+t.metadata.capHeight),l("/StemV "+t.metadata.stemV),l("/Type /FontDescriptor"),l("/FontFile2 "+_+" 0 R"),l("/Flags 96"),l("/FontBBox "+M.API.PDFObject.convert(t.metadata.bbox)),l("/FontName /"+Bh(t.fontName)),l("/ItalicAngle "+t.metadata.italicAngle),l("/Ascent "+t.metadata.ascender),l(">>"),l("endobj"),t.objectNumber=v();for(var C=0;C<t.metadata.hmtx.widths.length;C++)t.metadata.hmtx.widths[C]=parseInt(t.metadata.hmtx.widths[C]*(1e3/t.metadata.head.unitsPerEm));l("<</Subtype/TrueType/Type/Font/ToUnicode "+w+" 0 R/BaseFont/"+Bh(t.fontName)+"/FontDescriptor "+g+" 0 R/Encoding/"+t.encoding+" /FirstChar 29 /LastChar 255 /Widths "+M.API.PDFObject.convert(t.metadata.hmtx.widths)+">>"),l("endobj"),t.isAlreadyPutted=!0}})(z)}]);var R=function(z){var V,t=z.text||"",l=z.x,v=z.y,x=z.options||{},d=z.mutex||{},m=d.pdfEscape,c=d.activeFontKey,_=d.fonts,w=c,g="",C=0,L="",B=_[w].encoding;if(_[w].encoding!=="Identity-H")return{text:t,x:l,y:v,options:x,mutex:d};for(L=t,w=c,Array.isArray(t)&&(L=t[0]),C=0;C<L.length;C+=1)_[w].metadata.hasOwnProperty("cmap")&&(V=_[w].metadata.cmap.unicode.codeMap[L[C].charCodeAt(0)]),V||L[C].charCodeAt(0)<256&&_[w].metadata.hasOwnProperty("Unicode")?g+=L[C]:g+="";var q="";return parseInt(w.slice(1))<14||B==="WinAnsiEncoding"?q=m(g,w).split("").map(function(K){return K.charCodeAt(0).toString(16)}).join(""):B==="Identity-H"&&(q=A(g,_[w])),d.isHex=!0,{text:q,x:l,y:v,options:x,mutex:d}};f.events.push(["postProcessText",function(z){var V=z.text||"",t=[],l={text:V,x:z.x,y:z.y,options:z.options,mutex:z.mutex};if(Array.isArray(V)){var v=0;for(v=0;v<V.length;v+=1)Array.isArray(V[v])&&V[v].length===3?t.push([R(Object.assign({},l,{text:V[v][0]})).text,V[v][1],V[v][2]]):t.push(R(Object.assign({},l,{text:V[v]})).text);z.text=t}else z.text=R(Object.assign({},l,{text:V})).text}])}(tr),function(M){var f=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};M.existsFileInVFS=function(A){return f.call(this),this.internal.vFS[A]!==void 0},M.addFileToVFS=function(A,D){return f.call(this),this.internal.vFS[A]=D,this},M.getFileFromVFS=function(A){return f.call(this),this.internal.vFS[A]!==void 0?this.internal.vFS[A]:null}}(tr.API),function(M){M.__bidiEngine__=M.prototype.__bidiEngine__=function(D){var R,z,V,t,l,v,x,d=f,m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],c=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],_={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},w={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},g=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],C=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),L=!1,B=0;this.__bidiEngine__={};var q=function(_e){var pe=_e.charCodeAt(),ze=pe>>8,De=w[ze];return De!==void 0?d[256*De+(255&pe)]:ze===252||ze===253?"AL":C.test(ze)?"L":ze===8?"R":"N"},K=function(_e){for(var pe,ze=0;ze<_e.length;ze++){if((pe=q(_e.charAt(ze)))==="L")return!1;if(pe==="R")return!0}return!1},se=function(_e,pe,ze,De){var at,ft,xt,He,ae=pe[De];switch(ae){case"L":case"R":L=!1;break;case"N":case"AN":break;case"EN":L&&(ae="AN");break;case"AL":L=!0,ae="R";break;case"WS":ae="N";break;case"CS":De<1||De+1>=pe.length||(at=ze[De-1])!=="EN"&&at!=="AN"||(ft=pe[De+1])!=="EN"&&ft!=="AN"?ae="N":L&&(ft="AN"),ae=ft===at?ft:"N";break;case"ES":ae=(at=De>0?ze[De-1]:"B")==="EN"&&De+1<pe.length&&pe[De+1]==="EN"?"EN":"N";break;case"ET":if(De>0&&ze[De-1]==="EN"){ae="EN";break}if(L){ae="N";break}for(xt=De+1,He=pe.length;xt<He&&pe[xt]==="ET";)xt++;ae=xt<He&&pe[xt]==="EN"?"EN":"N";break;case"NSM":if(V&&!t){for(He=pe.length,xt=De+1;xt<He&&pe[xt]==="NSM";)xt++;if(xt<He){var Te=_e[De],Oe=Te>=1425&&Te<=2303||Te===64286;if(at=pe[xt],Oe&&(at==="R"||at==="AL")){ae="R";break}}}ae=De<1||(at=pe[De-1])==="B"?"N":ze[De-1];break;case"B":L=!1,R=!0,ae=B;break;case"S":z=!0,ae="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":L=!1;break;case"BN":ae="N"}return ae},he=function(_e,pe,ze){var De=_e.split("");return ze&&le(De,ze,{hiLevel:B}),De.reverse(),pe&&pe.reverse(),De.join("")},le=function(_e,pe,ze){var De,at,ft,xt,He,ae=-1,Te=_e.length,Oe=0,Y=[],ce=B?c:m,re=[];for(L=!1,R=!1,z=!1,at=0;at<Te;at++)re[at]=q(_e[at]);for(ft=0;ft<Te;ft++){if(He=Oe,Y[ft]=se(_e,re,Y,ft),De=240&(Oe=ce[He][_[Y[ft]]]),Oe&=15,pe[ft]=xt=ce[Oe][5],De>0)if(De===16){for(at=ae;at<ft;at++)pe[at]=1;ae=-1}else ae=-1;if(ce[Oe][6])ae===-1&&(ae=ft);else if(ae>-1){for(at=ae;at<ft;at++)pe[at]=xt;ae=-1}re[ft]==="B"&&(pe[ft]=0),ze.hiLevel|=xt}z&&function(te,we,ke){for(var We=0;We<ke;We++)if(te[We]==="S"){we[We]=B;for(var qe=We-1;qe>=0&&te[qe]==="WS";qe--)we[qe]=B}}(re,pe,Te)},ve=function(_e,pe,ze,De,at){if(!(at.hiLevel<_e)){if(_e===1&&B===1&&!R)return pe.reverse(),void(ze&&ze.reverse());for(var ft,xt,He,ae,Te=pe.length,Oe=0;Oe<Te;){if(De[Oe]>=_e){for(He=Oe+1;He<Te&&De[He]>=_e;)He++;for(ae=Oe,xt=He-1;ae<xt;ae++,xt--)ft=pe[ae],pe[ae]=pe[xt],pe[xt]=ft,ze&&(ft=ze[ae],ze[ae]=ze[xt],ze[xt]=ft);Oe=He}Oe++}}},ot=function(_e,pe,ze){var De=_e.split(""),at={hiLevel:B};return ze||(ze=[]),le(De,ze,at),function(ft,xt,He){if(He.hiLevel!==0&&x)for(var ae,Te=0;Te<ft.length;Te++)xt[Te]===1&&(ae=g.indexOf(ft[Te]))>=0&&(ft[Te]=g[ae+1])}(De,ze,at),ve(2,De,pe,ze,at),ve(1,De,pe,ze,at),De.join("")};return this.__bidiEngine__.doBidiReorder=function(_e,pe,ze){if(function(at,ft){if(ft)for(var xt=0;xt<at.length;xt++)ft[xt]=xt;t===void 0&&(t=K(at)),v===void 0&&(v=K(at))}(_e,pe),V||!l||v)if(V&&l&&t^v)B=t?1:0,_e=he(_e,pe,ze);else if(!V&&l&&v)B=t?1:0,_e=ot(_e,pe,ze),_e=he(_e,pe);else if(!V||t||l||v){if(V&&!l&&t^v)_e=he(_e,pe),t?(B=0,_e=ot(_e,pe,ze)):(B=1,_e=ot(_e,pe,ze),_e=he(_e,pe));else if(V&&t&&!l&&v)B=1,_e=ot(_e,pe,ze),_e=he(_e,pe);else if(!V&&!l&&t^v){var De=x;t?(B=1,_e=ot(_e,pe,ze),B=0,x=!1,_e=ot(_e,pe,ze),x=De):(B=0,_e=ot(_e,pe,ze),_e=he(_e,pe),B=1,x=!1,_e=ot(_e,pe,ze),x=De,_e=he(_e,pe))}}else B=0,_e=ot(_e,pe,ze);else B=t?1:0,_e=ot(_e,pe,ze);return _e},this.__bidiEngine__.setOptions=function(_e){_e&&(V=_e.isInputVisual,l=_e.isOutputVisual,t=_e.isInputRtl,v=_e.isOutputRtl,x=_e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(D),this.__bidiEngine__};var f=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],A=new M.__bidiEngine__({isInputVisual:!0});M.API.events.push(["postProcessText",function(D){var R=D.text,z=(D.x,D.y,D.options||{}),V=(D.mutex,z.lang,[]);if(z.isInputVisual=typeof z.isInputVisual!="boolean"||z.isInputVisual,A.setOptions(z),Object.prototype.toString.call(R)==="[object Array]"){var t=0;for(V=[],t=0;t<R.length;t+=1)Object.prototype.toString.call(R[t])==="[object Array]"?V.push([A.doBidiReorder(R[t][0]),R[t][1],R[t][2]]):V.push([A.doBidiReorder(R[t])]);D.text=V}else D.text=A.doBidiReorder(R);A.setOptions({isInputVisual:!0})}])}(tr),tr.API.TTFFont=function(){function M(f){var A;if(this.rawData=f,A=this.contents=new _c(f),this.contents.pos=4,A.readString(4)==="ttcf")throw new Error("TTCF not supported.");A.pos=0,this.parse(),this.subset=new gv(this),this.registerTTF()}return M.open=function(f){return new M(f)},M.prototype.parse=function(){return this.directory=new iv(this.contents),this.head=new nv(this),this.name=new cv(this),this.cmap=new N_(this),this.toUnicode={},this.hhea=new sv(this),this.maxp=new hv(this),this.hmtx=new uv(this),this.post=new av(this),this.os2=new ov(this),this.loca=new mv(this),this.glyf=new fv(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},M.prototype.registerTTF=function(){var f,A,D,R,z;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var V,t,l,v;for(v=[],V=0,t=(l=this.bbox).length;V<t;V++)f=l[V],v.push(Math.round(f*this.scaleFactor));return v}.call(this),this.stemV=0,this.post.exists?(D=255&(R=this.post.italic_angle),32768&(A=R>>16)&&(A=-(1+(65535^A))),this.italicAngle=+(A+"."+D)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(z=this.familyClass)===1||z===2||z===3||z===4||z===5||z===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},M.prototype.characterToGlyph=function(f){var A;return((A=this.cmap.unicode)!=null?A.codeMap[f]:void 0)||0},M.prototype.widthOfGlyph=function(f){var A;return A=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(f).advance*A},M.prototype.widthOfString=function(f,A,D){var R,z,V,t;for(V=0,z=0,t=(f=""+f).length;0<=t?z<t:z>t;z=0<=t?++z:--z)R=f.charCodeAt(z),V+=this.widthOfGlyph(this.characterToGlyph(R))+D*(1e3/A)||0;return V*(A/1e3)},M.prototype.lineHeight=function(f,A){var D;return A==null&&(A=!1),D=A?this.lineGap:0,(this.ascender+D-this.decender)/1e3*f},M}();var Za,_c=function(){function M(f){this.data=f??[],this.pos=0,this.length=this.data.length}return M.prototype.readByte=function(){return this.data[this.pos++]},M.prototype.writeByte=function(f){return this.data[this.pos++]=f},M.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},M.prototype.writeUInt32=function(f){return this.writeByte(f>>>24&255),this.writeByte(f>>16&255),this.writeByte(f>>8&255),this.writeByte(255&f)},M.prototype.readInt32=function(){var f;return(f=this.readUInt32())>=2147483648?f-4294967296:f},M.prototype.writeInt32=function(f){return f<0&&(f+=4294967296),this.writeUInt32(f)},M.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},M.prototype.writeUInt16=function(f){return this.writeByte(f>>8&255),this.writeByte(255&f)},M.prototype.readInt16=function(){var f;return(f=this.readUInt16())>=32768?f-65536:f},M.prototype.writeInt16=function(f){return f<0&&(f+=65536),this.writeUInt16(f)},M.prototype.readString=function(f){var A,D;for(D=[],A=0;0<=f?A<f:A>f;A=0<=f?++A:--A)D[A]=String.fromCharCode(this.readByte());return D.join("")},M.prototype.writeString=function(f){var A,D,R;for(R=[],A=0,D=f.length;0<=D?A<D:A>D;A=0<=D?++A:--A)R.push(this.writeByte(f.charCodeAt(A)));return R},M.prototype.readShort=function(){return this.readInt16()},M.prototype.writeShort=function(f){return this.writeInt16(f)},M.prototype.readLongLong=function(){var f,A,D,R,z,V,t,l;return f=this.readByte(),A=this.readByte(),D=this.readByte(),R=this.readByte(),z=this.readByte(),V=this.readByte(),t=this.readByte(),l=this.readByte(),128&f?-1*(72057594037927940*(255^f)+281474976710656*(255^A)+1099511627776*(255^D)+4294967296*(255^R)+16777216*(255^z)+65536*(255^V)+256*(255^t)+(255^l)+1):72057594037927940*f+281474976710656*A+1099511627776*D+4294967296*R+16777216*z+65536*V+256*t+l},M.prototype.writeLongLong=function(f){var A,D;return A=Math.floor(f/4294967296),D=4294967295&f,this.writeByte(A>>24&255),this.writeByte(A>>16&255),this.writeByte(A>>8&255),this.writeByte(255&A),this.writeByte(D>>24&255),this.writeByte(D>>16&255),this.writeByte(D>>8&255),this.writeByte(255&D)},M.prototype.readInt=function(){return this.readInt32()},M.prototype.writeInt=function(f){return this.writeInt32(f)},M.prototype.read=function(f){var A,D;for(A=[],D=0;0<=f?D<f:D>f;D=0<=f?++D:--D)A.push(this.readByte());return A},M.prototype.write=function(f){var A,D,R,z;for(z=[],D=0,R=f.length;D<R;D++)A=f[D],z.push(this.writeByte(A));return z},M}(),iv=function(){var M;function f(A){var D,R,z;for(this.scalarType=A.readInt(),this.tableCount=A.readShort(),this.searchRange=A.readShort(),this.entrySelector=A.readShort(),this.rangeShift=A.readShort(),this.tables={},R=0,z=this.tableCount;0<=z?R<z:R>z;R=0<=z?++R:--R)D={tag:A.readString(4),checksum:A.readInt(),offset:A.readInt(),length:A.readInt()},this.tables[D.tag]=D}return f.prototype.encode=function(A){var D,R,z,V,t,l,v,x,d,m,c,_,w;for(w in c=Object.keys(A).length,l=Math.log(2),d=16*Math.floor(Math.log(c)/l),V=Math.floor(d/l),x=16*c-d,(R=new _c).writeInt(this.scalarType),R.writeShort(c),R.writeShort(d),R.writeShort(V),R.writeShort(x),z=16*c,v=R.pos+z,t=null,_=[],A)for(m=A[w],R.writeString(w),R.writeInt(M(m)),R.writeInt(v),R.writeInt(m.length),_=_.concat(m),w==="head"&&(t=v),v+=m.length;v%4;)_.push(0),v++;return R.write(_),D=2981146554-M(R.data),R.pos=t+8,R.writeUInt32(D),R.data},M=function(A){var D,R,z,V;for(A=j_.call(A);A.length%4;)A.push(0);for(z=new _c(A),R=0,D=0,V=A.length;D<V;D=D+=4)R+=z.readUInt32();return 4294967295&R},f}(),rv={}.hasOwnProperty,Ll=function(M,f){for(var A in f)rv.call(f,A)&&(M[A]=f[A]);function D(){this.constructor=M}return D.prototype=f.prototype,M.prototype=new D,M.__super__=f.prototype,M};Za=function(){function M(f){var A;this.file=f,A=this.file.directory.tables[this.tag],this.exists=!!A,A&&(this.offset=A.offset,this.length=A.length,this.parse(this.file.contents))}return M.prototype.parse=function(){},M.prototype.encode=function(){},M.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},M}();var nv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="head",f.prototype.parse=function(A){return A.pos=this.offset,this.version=A.readInt(),this.revision=A.readInt(),this.checkSumAdjustment=A.readInt(),this.magicNumber=A.readInt(),this.flags=A.readShort(),this.unitsPerEm=A.readShort(),this.created=A.readLongLong(),this.modified=A.readLongLong(),this.xMin=A.readShort(),this.yMin=A.readShort(),this.xMax=A.readShort(),this.yMax=A.readShort(),this.macStyle=A.readShort(),this.lowestRecPPEM=A.readShort(),this.fontDirectionHint=A.readShort(),this.indexToLocFormat=A.readShort(),this.glyphDataFormat=A.readShort()},f.prototype.encode=function(A){var D;return(D=new _c).writeInt(this.version),D.writeInt(this.revision),D.writeInt(this.checkSumAdjustment),D.writeInt(this.magicNumber),D.writeShort(this.flags),D.writeShort(this.unitsPerEm),D.writeLongLong(this.created),D.writeLongLong(this.modified),D.writeShort(this.xMin),D.writeShort(this.yMin),D.writeShort(this.xMax),D.writeShort(this.yMax),D.writeShort(this.macStyle),D.writeShort(this.lowestRecPPEM),D.writeShort(this.fontDirectionHint),D.writeShort(A),D.writeShort(this.glyphDataFormat),D.data},f}(),y_=function(){function M(f,A){var D,R,z,V,t,l,v,x,d,m,c,_,w,g,C,L,B;switch(this.platformID=f.readUInt16(),this.encodingID=f.readShort(),this.offset=A+f.readInt(),d=f.pos,f.pos=this.offset,this.format=f.readUInt16(),this.length=f.readUInt16(),this.language=f.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(l=0;l<256;++l)this.codeMap[l]=f.readByte();break;case 4:for(c=f.readUInt16(),m=c/2,f.pos+=6,z=function(){var q,K;for(K=[],l=q=0;0<=m?q<m:q>m;l=0<=m?++q:--q)K.push(f.readUInt16());return K}(),f.pos+=2,w=function(){var q,K;for(K=[],l=q=0;0<=m?q<m:q>m;l=0<=m?++q:--q)K.push(f.readUInt16());return K}(),v=function(){var q,K;for(K=[],l=q=0;0<=m?q<m:q>m;l=0<=m?++q:--q)K.push(f.readUInt16());return K}(),x=function(){var q,K;for(K=[],l=q=0;0<=m?q<m:q>m;l=0<=m?++q:--q)K.push(f.readUInt16());return K}(),R=(this.length-f.pos+this.offset)/2,t=function(){var q,K;for(K=[],l=q=0;0<=R?q<R:q>R;l=0<=R?++q:--q)K.push(f.readUInt16());return K}(),l=C=0,B=z.length;C<B;l=++C)for(g=z[l],D=L=_=w[l];_<=g?L<=g:L>=g;D=_<=g?++L:--L)x[l]===0?V=D+v[l]:(V=t[x[l]/2+(D-_)-(m-l)]||0)!==0&&(V+=v[l]),this.codeMap[D]=65535&V}f.pos=d}return M.encode=function(f,A){var D,R,z,V,t,l,v,x,d,m,c,_,w,g,C,L,B,q,K,se,he,le,ve,ot,_e,pe,ze,De,at,ft,xt,He,ae,Te,Oe,Y,ce,re,te,we,ke,We,qe,gt,lt,Bt;switch(De=new _c,V=Object.keys(f).sort(function(ht,ct){return ht-ct}),A){case"macroman":for(w=0,g=function(){var ht=[];for(_=0;_<256;++_)ht.push(0);return ht}(),L={0:0},z={},at=0,ae=V.length;at<ae;at++)L[qe=f[R=V[at]]]==null&&(L[qe]=++w),z[R]={old:f[R],new:L[f[R]]},g[R]=L[f[R]];return De.writeUInt16(1),De.writeUInt16(0),De.writeUInt32(12),De.writeUInt16(0),De.writeUInt16(262),De.writeUInt16(0),De.write(g),{charMap:z,subtable:De.data,maxGlyphID:w+1};case"unicode":for(pe=[],d=[],B=0,L={},D={},C=v=null,ft=0,Te=V.length;ft<Te;ft++)L[K=f[R=V[ft]]]==null&&(L[K]=++B),D[R]={old:K,new:L[K]},t=L[K]-R,C!=null&&t===v||(C&&d.push(C),pe.push(R),v=t),C=R;for(C&&d.push(C),d.push(65535),pe.push(65535),ot=2*(ve=pe.length),le=2*Math.pow(Math.log(ve)/Math.LN2,2),m=Math.log(le/2)/Math.LN2,he=2*ve-le,l=[],se=[],c=[],_=xt=0,Oe=pe.length;xt<Oe;_=++xt){if(_e=pe[_],x=d[_],_e===65535){l.push(0),se.push(0);break}if(_e-(ze=D[_e].new)>=32768)for(l.push(0),se.push(2*(c.length+ve-_)),R=He=_e;_e<=x?He<=x:He>=x;R=_e<=x?++He:--He)c.push(D[R].new);else l.push(ze-_e),se.push(0)}for(De.writeUInt16(3),De.writeUInt16(1),De.writeUInt32(12),De.writeUInt16(4),De.writeUInt16(16+8*ve+2*c.length),De.writeUInt16(0),De.writeUInt16(ot),De.writeUInt16(le),De.writeUInt16(m),De.writeUInt16(he),ke=0,Y=d.length;ke<Y;ke++)R=d[ke],De.writeUInt16(R);for(De.writeUInt16(0),We=0,ce=pe.length;We<ce;We++)R=pe[We],De.writeUInt16(R);for(gt=0,re=l.length;gt<re;gt++)t=l[gt],De.writeUInt16(t);for(lt=0,te=se.length;lt<te;lt++)q=se[lt],De.writeUInt16(q);for(Bt=0,we=c.length;Bt<we;Bt++)w=c[Bt],De.writeUInt16(w);return{charMap:D,subtable:De.data,maxGlyphID:B+1}}},M}(),N_=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="cmap",f.prototype.parse=function(A){var D,R,z;for(A.pos=this.offset,this.version=A.readUInt16(),z=A.readUInt16(),this.tables=[],this.unicode=null,R=0;0<=z?R<z:R>z;R=0<=z?++R:--R)D=new y_(A,this.offset),this.tables.push(D),D.isUnicode&&this.unicode==null&&(this.unicode=D);return!0},f.encode=function(A,D){var R,z;return D==null&&(D="macroman"),R=y_.encode(A,D),(z=new _c).writeUInt16(0),z.writeUInt16(1),R.table=z.data.concat(R.subtable),R},f}(),sv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="hhea",f.prototype.parse=function(A){return A.pos=this.offset,this.version=A.readInt(),this.ascender=A.readShort(),this.decender=A.readShort(),this.lineGap=A.readShort(),this.advanceWidthMax=A.readShort(),this.minLeftSideBearing=A.readShort(),this.minRightSideBearing=A.readShort(),this.xMaxExtent=A.readShort(),this.caretSlopeRise=A.readShort(),this.caretSlopeRun=A.readShort(),this.caretOffset=A.readShort(),A.pos+=8,this.metricDataFormat=A.readShort(),this.numberOfMetrics=A.readUInt16()},f}(),ov=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="OS/2",f.prototype.parse=function(A){if(A.pos=this.offset,this.version=A.readUInt16(),this.averageCharWidth=A.readShort(),this.weightClass=A.readUInt16(),this.widthClass=A.readUInt16(),this.type=A.readShort(),this.ySubscriptXSize=A.readShort(),this.ySubscriptYSize=A.readShort(),this.ySubscriptXOffset=A.readShort(),this.ySubscriptYOffset=A.readShort(),this.ySuperscriptXSize=A.readShort(),this.ySuperscriptYSize=A.readShort(),this.ySuperscriptXOffset=A.readShort(),this.ySuperscriptYOffset=A.readShort(),this.yStrikeoutSize=A.readShort(),this.yStrikeoutPosition=A.readShort(),this.familyClass=A.readShort(),this.panose=function(){var D,R;for(R=[],D=0;D<10;++D)R.push(A.readByte());return R}(),this.charRange=function(){var D,R;for(R=[],D=0;D<4;++D)R.push(A.readInt());return R}(),this.vendorID=A.readString(4),this.selection=A.readShort(),this.firstCharIndex=A.readShort(),this.lastCharIndex=A.readShort(),this.version>0&&(this.ascent=A.readShort(),this.descent=A.readShort(),this.lineGap=A.readShort(),this.winAscent=A.readShort(),this.winDescent=A.readShort(),this.codePageRange=function(){var D,R;for(R=[],D=0;D<2;D=++D)R.push(A.readInt());return R}(),this.version>1))return this.xHeight=A.readShort(),this.capHeight=A.readShort(),this.defaultChar=A.readShort(),this.breakChar=A.readShort(),this.maxContext=A.readShort()},f}(),av=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="post",f.prototype.parse=function(A){var D,R,z;switch(A.pos=this.offset,this.format=A.readInt(),this.italicAngle=A.readInt(),this.underlinePosition=A.readShort(),this.underlineThickness=A.readShort(),this.isFixedPitch=A.readInt(),this.minMemType42=A.readInt(),this.maxMemType42=A.readInt(),this.minMemType1=A.readInt(),this.maxMemType1=A.readInt(),this.format){case 65536:break;case 131072:var V;for(R=A.readUInt16(),this.glyphNameIndex=[],V=0;0<=R?V<R:V>R;V=0<=R?++V:--V)this.glyphNameIndex.push(A.readUInt16());for(this.names=[],z=[];A.pos<this.offset+this.length;)D=A.readByte(),z.push(this.names.push(A.readString(D)));return z;case 151552:return R=A.readUInt16(),this.offsets=A.read(R);case 196608:break;case 262144:return this.map=function(){var t,l,v;for(v=[],V=t=0,l=this.file.maxp.numGlyphs;0<=l?t<l:t>l;V=0<=l?++t:--t)v.push(A.readUInt32());return v}.call(this)}},f}(),lv=function(M,f){this.raw=M,this.length=M.length,this.platformID=f.platformID,this.encodingID=f.encodingID,this.languageID=f.languageID},cv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="name",f.prototype.parse=function(A){var D,R,z,V,t,l,v,x,d,m,c;for(A.pos=this.offset,A.readShort(),D=A.readShort(),l=A.readShort(),R=[],V=0;0<=D?V<D:V>D;V=0<=D?++V:--V)R.push({platformID:A.readShort(),encodingID:A.readShort(),languageID:A.readShort(),nameID:A.readShort(),length:A.readShort(),offset:this.offset+l+A.readShort()});for(v={},V=d=0,m=R.length;d<m;V=++d)z=R[V],A.pos=z.offset,x=A.readString(z.length),t=new lv(x,z),v[c=z.nameID]==null&&(v[c]=[]),v[z.nameID].push(t);this.strings=v,this.copyright=v[0],this.fontFamily=v[1],this.fontSubfamily=v[2],this.uniqueSubfamily=v[3],this.fontName=v[4],this.version=v[5];try{this.postscriptName=v[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=v[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=v[7],this.manufacturer=v[8],this.designer=v[9],this.description=v[10],this.vendorUrl=v[11],this.designerUrl=v[12],this.license=v[13],this.licenseUrl=v[14],this.preferredFamily=v[15],this.preferredSubfamily=v[17],this.compatibleFull=v[18],this.sampleText=v[19]},f}(),hv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="maxp",f.prototype.parse=function(A){return A.pos=this.offset,this.version=A.readInt(),this.numGlyphs=A.readUInt16(),this.maxPoints=A.readUInt16(),this.maxContours=A.readUInt16(),this.maxCompositePoints=A.readUInt16(),this.maxComponentContours=A.readUInt16(),this.maxZones=A.readUInt16(),this.maxTwilightPoints=A.readUInt16(),this.maxStorage=A.readUInt16(),this.maxFunctionDefs=A.readUInt16(),this.maxInstructionDefs=A.readUInt16(),this.maxStackElements=A.readUInt16(),this.maxSizeOfInstructions=A.readUInt16(),this.maxComponentElements=A.readUInt16(),this.maxComponentDepth=A.readUInt16()},f}(),uv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="hmtx",f.prototype.parse=function(A){var D,R,z,V,t,l,v;for(A.pos=this.offset,this.metrics=[],D=0,l=this.file.hhea.numberOfMetrics;0<=l?D<l:D>l;D=0<=l?++D:--D)this.metrics.push({advance:A.readUInt16(),lsb:A.readInt16()});for(z=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var x,d;for(d=[],D=x=0;0<=z?x<z:x>z;D=0<=z?++x:--x)d.push(A.readInt16());return d}(),this.widths=function(){var x,d,m,c;for(c=[],x=0,d=(m=this.metrics).length;x<d;x++)V=m[x],c.push(V.advance);return c}.call(this),R=this.widths[this.widths.length-1],v=[],D=t=0;0<=z?t<z:t>z;D=0<=z?++t:--t)v.push(this.widths.push(R));return v},f.prototype.forGlyph=function(A){return A in this.metrics?this.metrics[A]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[A-this.metrics.length]}},f}(),j_=[].slice,fv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="glyf",f.prototype.parse=function(){return this.cache={}},f.prototype.glyphFor=function(A){var D,R,z,V,t,l,v,x,d,m;return A in this.cache?this.cache[A]:(V=this.file.loca,D=this.file.contents,R=V.indexOf(A),(z=V.lengthOf(A))===0?this.cache[A]=null:(D.pos=this.offset+R,t=(l=new _c(D.read(z))).readShort(),x=l.readShort(),m=l.readShort(),v=l.readShort(),d=l.readShort(),this.cache[A]=t===-1?new pv(l,x,m,v,d):new dv(l,t,x,m,v,d),this.cache[A]))},f.prototype.encode=function(A,D,R){var z,V,t,l,v;for(t=[],V=[],l=0,v=D.length;l<v;l++)z=A[D[l]],V.push(t.length),z&&(t=t.concat(z.encode(R)));return V.push(t.length),{table:t,offsets:V}},f}(),dv=function(){function M(f,A,D,R,z,V){this.raw=f,this.numberOfContours=A,this.xMin=D,this.yMin=R,this.xMax=z,this.yMax=V,this.compound=!1}return M.prototype.encode=function(){return this.raw.data},M}(),pv=function(){function M(f,A,D,R,z){var V,t;for(this.raw=f,this.xMin=A,this.yMin=D,this.xMax=R,this.yMax=z,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],V=this.raw;t=V.readShort(),this.glyphOffsets.push(V.pos),this.glyphIDs.push(V.readUInt16()),32&t;)V.pos+=1&t?4:2,128&t?V.pos+=8:64&t?V.pos+=4:8&t&&(V.pos+=2)}return M.prototype.encode=function(){var f,A,D;for(A=new _c(j_.call(this.raw.data)),f=0,D=this.glyphIDs.length;f<D;++f)A.pos=this.glyphOffsets[f];return A.data},M}(),mv=function(M){function f(){return f.__super__.constructor.apply(this,arguments)}return Ll(f,Za),f.prototype.tag="loca",f.prototype.parse=function(A){var D,R;return A.pos=this.offset,D=this.file.head.indexToLocFormat,this.offsets=D===0?function(){var z,V;for(V=[],R=0,z=this.length;R<z;R+=2)V.push(2*A.readUInt16());return V}.call(this):function(){var z,V;for(V=[],R=0,z=this.length;R<z;R+=4)V.push(A.readUInt32());return V}.call(this)},f.prototype.indexOf=function(A){return this.offsets[A]},f.prototype.lengthOf=function(A){return this.offsets[A+1]-this.offsets[A]},f.prototype.encode=function(A,D){for(var R=new Uint32Array(this.offsets.length),z=0,V=0,t=0;t<R.length;++t)if(R[t]=z,V<D.length&&D[V]==t){++V,R[t]=z;var l=this.offsets[t],v=this.offsets[t+1]-l;v>0&&(z+=v)}for(var x=new Array(4*R.length),d=0;d<R.length;++d)x[4*d+3]=255&R[d],x[4*d+2]=(65280&R[d])>>8,x[4*d+1]=(16711680&R[d])>>16,x[4*d]=(4278190080&R[d])>>24;return x},f}(),gv=function(){function M(f){this.font=f,this.subset={},this.unicodes={},this.next=33}return M.prototype.generateCmap=function(){var f,A,D,R,z;for(A in R=this.font.cmap.tables[0].codeMap,f={},z=this.subset)D=z[A],f[A]=R[D];return f},M.prototype.glyphsFor=function(f){var A,D,R,z,V,t,l;for(R={},V=0,t=f.length;V<t;V++)R[z=f[V]]=this.font.glyf.glyphFor(z);for(z in A=[],R)(D=R[z])!=null&&D.compound&&A.push.apply(A,D.glyphIDs);if(A.length>0)for(z in l=this.glyphsFor(A))D=l[z],R[z]=D;return R},M.prototype.encode=function(f,A){var D,R,z,V,t,l,v,x,d,m,c,_,w,g,C;for(R in D=N_.encode(this.generateCmap(),"unicode"),V=this.glyphsFor(f),c={0:0},C=D.charMap)c[(l=C[R]).old]=l.new;for(_ in m=D.maxGlyphID,V)_ in c||(c[_]=m++);return x=function(L){var B,q;for(B in q={},L)q[L[B]]=B;return q}(c),d=Object.keys(x).sort(function(L,B){return L-B}),w=function(){var L,B,q;for(q=[],L=0,B=d.length;L<B;L++)t=d[L],q.push(x[t]);return q}(),z=this.font.glyf.encode(V,w,c),v=this.font.loca.encode(z.offsets,w),g={cmap:this.font.cmap.raw(),glyf:z.table,loca:v,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(A)},this.font.os2.exists&&(g["OS/2"]=this.font.os2.raw()),this.font.directory.encode(g)},M}();tr.API.PDFObject=function(){var M;function f(){}return M=function(A,D){return(Array(D+1).join("0")+A).slice(-D)},f.convert=function(A){var D,R,z,V;if(Array.isArray(A))return"["+function(){var t,l,v;for(v=[],t=0,l=A.length;t<l;t++)D=A[t],v.push(f.convert(D));return v}().join(" ")+"]";if(typeof A=="string")return"/"+A;if(A!=null&&A.isString)return"("+A+")";if(A instanceof Date)return"(D:"+M(A.getUTCFullYear(),4)+M(A.getUTCMonth(),2)+M(A.getUTCDate(),2)+M(A.getUTCHours(),2)+M(A.getUTCMinutes(),2)+M(A.getUTCSeconds(),2)+"Z)";if({}.toString.call(A)==="[object Object]"){for(R in z=["<<"],A)V=A[R],z.push("/"+R+" "+f.convert(V));return z.push(">>"),z.join(`
`)}return""+A},f}();const _v=Object.freeze(Object.defineProperty({__proto__:null,AcroForm:$1,AcroFormAppearance:Ni,AcroFormButton:ls,AcroFormCheckBox:Ou,AcroFormChoiceField:th,AcroFormComboBox:rh,AcroFormEditBox:ku,AcroFormListBox:ih,AcroFormPasswordField:Fu,AcroFormPushButton:Du,AcroFormRadioButton:nh,AcroFormTextField:mc,GState:Bu,ShadingPattern:dc,TilingPattern:Qc,default:tr,jsPDF:tr},Symbol.toStringTag,{value:"Module"})),yv=x_(_v);var U_={exports:{}};(function(M,f){(function(A,D){D()})(Jc,function(){function A(v,x){return typeof x>"u"?x={autoBom:!1}:typeof x!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),x={autoBom:!x}),x.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(v.type)?new Blob(["\uFEFF",v],{type:v.type}):v}function D(v,x,d){var m=new XMLHttpRequest;m.open("GET",v),m.responseType="blob",m.onload=function(){l(m.response,x,d)},m.onerror=function(){console.error("could not download file")},m.send()}function R(v){var x=new XMLHttpRequest;x.open("HEAD",v,!1);try{x.send()}catch{}return 200<=x.status&&299>=x.status}function z(v){try{v.dispatchEvent(new MouseEvent("click"))}catch{var x=document.createEvent("MouseEvents");x.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),v.dispatchEvent(x)}}var V=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Jc=="object"&&Jc.global===Jc?Jc:void 0,t=V.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=V.saveAs||(typeof window!="object"||window!==V?function(){}:"download"in HTMLAnchorElement.prototype&&!t?function(v,x,d){var m=V.URL||V.webkitURL,c=document.createElement("a");x=x||v.name||"download",c.download=x,c.rel="noopener",typeof v=="string"?(c.href=v,c.origin===location.origin?z(c):R(c.href)?D(v,x,d):z(c,c.target="_blank")):(c.href=m.createObjectURL(v),setTimeout(function(){m.revokeObjectURL(c.href)},4e4),setTimeout(function(){z(c)},0))}:"msSaveOrOpenBlob"in navigator?function(v,x,d){if(x=x||v.name||"download",typeof v!="string")navigator.msSaveOrOpenBlob(A(v,d),x);else if(R(v))D(v,x,d);else{var m=document.createElement("a");m.href=v,m.target="_blank",setTimeout(function(){z(m)})}}:function(v,x,d,m){if(m=m||open("","_blank"),m&&(m.document.title=m.document.body.innerText="downloading..."),typeof v=="string")return D(v,x,d);var c=v.type==="application/octet-stream",_=/constructor/i.test(V.HTMLElement)||V.safari,w=/CriOS\/[\d]+/.test(navigator.userAgent);if((w||c&&_||t)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var B=g.result;B=w?B:B.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=B:location=B,m=null},g.readAsDataURL(v)}else{var C=V.URL||V.webkitURL,L=C.createObjectURL(v);m?m.location=L:location.href=L,m=null,setTimeout(function(){C.revokeObjectURL(L)},4e4)}});V.saveAs=l.saveAs=l,M.exports=l})})(U_);var vv=U_.exports;(function(M){var f={};function A(D){if(f[D])return f[D].exports;var R=f[D]={i:D,l:!1,exports:{}};return M[D].call(R.exports,R,R.exports,A),R.l=!0,R.exports}A.m=M,A.c=f,A.d=function(D,R,z){A.o(D,R)||Object.defineProperty(D,R,{enumerable:!0,get:z})},A.r=function(D){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},A.t=function(D,R){if(1&R&&(D=A(D)),8&R||4&R&&typeof D=="object"&&D&&D.__esModule)return D;var z=Object.create(null);if(A.r(z),Object.defineProperty(z,"default",{enumerable:!0,value:D}),2&R&&typeof D!="string")for(var V in D)A.d(z,V,function(t){return D[t]}.bind(null,V));return z},A.n=function(D){var R=D&&D.__esModule?function(){return D.default}:function(){return D};return A.d(R,"a",R),R},A.o=function(D,R){return Object.prototype.hasOwnProperty.call(D,R)},A.p="",A(A.s=0)})([function(M,f,A){M.exports=A(1)},function(M,f){function A(R,z){for(var V=0;V<z.length;V++){var t=z[V];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(R,t.key,t)}}var D=function(){function R(){(function(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")})(this,R),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var z,V;return z=R,(V=[{key:"show",value:function(t){this.setOptions(t),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var t=document.getElementById("loading-overlay-stylesheet");t&&(t.disabled=!0,t.parentNode.removeChild(t),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(t){if(t!==void 0)for(var l in t)this.options[l]=t[l]}},{key:"generateAndAddOverlayElement",value:function(){var t="50%";this.options.offsetX!==0&&(t="calc(50% + "+this.options.offsetX+")");var l="50%";if(this.options.offsetY!==0&&(l="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var v='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(l,"; left: ").concat(t,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),x=document.getElementById(this.options.containerID);return x.style.position="relative",void x.insertAdjacentHTML("beforeend",v)}var d='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(l,"; left: ").concat(t,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",d)}},{key:"generateSpinnerElement",value:function(){var t=this,l=Object.keys(this.numberOfEmptyDivForSpinner).find(function(x){return x===t.options.spinnerIcon}),v=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[l]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(v,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var t=document.createElement("link");t.setAttribute("id","loading-overlay-stylesheet"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(t)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(t){for(var l="",v=1;v<=t;v++)l+="<div></div>";return l}}])&&A(z.prototype,V),R}();window.JsLoadingOverlay=new D,M.exports=JsLoadingOverlay}]);var V_={};const xv={},bv=Object.freeze(Object.defineProperty({__proto__:null,default:xv},Symbol.toStringTag,{value:"Module"})),Jd=x_(bv);(function(M){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var f=f||{version:"5.3.0"};if(M.fabric=f,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?f.document=document:f.document=document.implementation.createHTMLDocument(""),f.window=window;else{var A=Jd,D=new A.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;f.document=D.document,f.jsdomImplForWrapper=Jd.implForWrapper,f.nodeCanvas=Jd.Canvas,f.window=D,DOMParser=f.window.DOMParser}f.isTouchSupported="ontouchstart"in f.window||"ontouchstart"in f.document||f.window&&f.window.navigator&&f.window.navigator.maxTouchPoints>0,f.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",f.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],f.DPI=96,f.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",f.commaWsp="(?:\\s+,?\\s*|,\\s*)",f.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,f.reNonWord=/[ \n\.,;!\?\-]/,f.fontPaths={},f.iMatrix=[1,0,0,1,0,0],f.svgNS="http://www.w3.org/2000/svg",f.perfLimitSizeTotal=2097152,f.maxCacheSideLimit=4096,f.minCacheSideLimit=256,f.charWidthsCache={},f.textureSize=2048,f.disableStyleCopyPaste=!1,f.enableGLFiltering=!0,f.devicePixelRatio=f.window.devicePixelRatio||f.window.webkitDevicePixelRatio||f.window.mozDevicePixelRatio||1,f.browserShadowBlurConstant=1,f.arcToSegmentsCache={},f.boundsOfCurveCache={},f.cachesBoundsOfCurve=!0,f.forceGLPutImageData=!1,f.initFilterBackend=function(){if(f.enableGLFiltering&&f.isWebglSupported&&f.isWebglSupported(f.textureSize))return console.log("max texture size: "+f.maxTextureSize),new f.WebglFilterBackend({tileSize:f.textureSize});if(f.Canvas2dFilterBackend)return new f.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=f),function(){function t(c,_){if(this.__eventListeners[c]){var w=this.__eventListeners[c];_?w[w.indexOf(_)]=!1:f.util.array.fill(w,!1)}}function l(c,_){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var w in c)this.on(w,c[w]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(_);return this}function v(c,_){var w=function(){_.apply(this,arguments),this.off(c,w)}.bind(this);this.on(c,w)}function x(c,_){if(arguments.length===1)for(var w in c)v.call(this,w,c[w]);else v.call(this,c,_);return this}function d(c,_){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)t.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var w in c)t.call(this,w,c[w]);else t.call(this,c,_);return this}function m(c,_){if(!this.__eventListeners)return this;var w=this.__eventListeners[c];if(!w)return this;for(var g=0,C=w.length;g<C;g++)w[g]&&w[g].call(this,_||{});return this.__eventListeners[c]=w.filter(function(L){return L!==!1}),this}f.Observable={fire:m,on:l,once:x,off:d}}(),f.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,l=arguments.length;t<l;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,l,v){var x=this._objects;return v?x[l]=t:x.splice(l,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t=this._objects,l,v=!1,x=0,d=arguments.length;x<d;x++)l=t.indexOf(arguments[x]),l!==-1&&(v=!0,t.splice(l,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[x]));return this.renderOnAddRemove&&v&&this.requestRenderAll(),this},forEachObject:function(t,l){for(var v=this.getObjects(),x=0,d=v.length;x<d;x++)t.call(l,v[x],x,v);return this},getObjects:function(t){return typeof t>"u"?this._objects.concat():this._objects.filter(function(l){return l.type===t})},item:function(t){return this._objects[t]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(t,l){return this._objects.indexOf(t)>-1?!0:l?this._objects.some(function(v){return typeof v.contains=="function"&&v.contains(t,!0)}):!1},complexity:function(){return this._objects.reduce(function(t,l){return t+=l.complexity?l.complexity():0,t},0)}},f.CommonMethods={_setOptions:function(t){for(var l in t)this.set(l,t[l])},_initGradient:function(t,l){t&&t.colorStops&&!(t instanceof f.Gradient)&&this.set(l,new f.Gradient(t))},_initPattern:function(t,l,v){t&&t.source&&!(t instanceof f.Pattern)?this.set(l,new f.Pattern(t,v)):v&&v()},_setObject:function(t){for(var l in t)this._set(l,t[l])},set:function(t,l){return typeof t=="object"?this._setObject(t):this._set(t,l),this},_set:function(t,l){this[t]=l},toggle:function(t){var l=this.get(t);return typeof l=="boolean"&&this.set(t,!l),this},get:function(t){return this[t]}},function(t){var l=Math.sqrt,v=Math.atan2,x=Math.pow,d=Math.PI/180,m=Math.PI/2;f.util={cos:function(c){if(c===0)return 1;c<0&&(c=-c);var _=c/m;switch(_){case 1:case 3:return 0;case 2:return-1}return Math.cos(c)},sin:function(c){if(c===0)return 0;var _=c/m,w=1;switch(c<0&&(w=-1),_){case 1:return w;case 2:return 0;case 3:return-w}return Math.sin(c)},removeFromArray:function(c,_){var w=c.indexOf(_);return w!==-1&&c.splice(w,1),c},getRandomInt:function(c,_){return Math.floor(Math.random()*(_-c+1))+c},degreesToRadians:function(c){return c*d},radiansToDegrees:function(c){return c/d},rotatePoint:function(c,_,w){var g=new f.Point(c.x-_.x,c.y-_.y),C=f.util.rotateVector(g,w);return new f.Point(C.x,C.y).addEquals(_)},rotateVector:function(c,_){var w=f.util.sin(_),g=f.util.cos(_),C=c.x*g-c.y*w,L=c.x*w+c.y*g;return{x:C,y:L}},createVector:function(c,_){return new f.Point(_.x-c.x,_.y-c.y)},calcAngleBetweenVectors:function(c,_){return Math.acos((c.x*_.x+c.y*_.y)/(Math.hypot(c.x,c.y)*Math.hypot(_.x,_.y)))},getHatVector:function(c){return new f.Point(c.x,c.y).multiply(1/Math.hypot(c.x,c.y))},getBisector:function(c,_,w){var g=f.util.createVector(c,_),C=f.util.createVector(c,w),L=f.util.calcAngleBetweenVectors(g,C),B=f.util.calcAngleBetweenVectors(f.util.rotateVector(g,L),C),q=L*(B===0?1:-1)/2;return{vector:f.util.getHatVector(f.util.rotateVector(g,q)),angle:L}},projectStrokeOnPoints:function(c,_,w){var g=[],C=_.strokeWidth/2,L=_.strokeUniform?new f.Point(1/_.scaleX,1/_.scaleY):new f.Point(1,1),B=function(q){var K=C/Math.hypot(q.x,q.y);return new f.Point(q.x*K*L.x,q.y*K*L.y)};return c.length<=1||c.forEach(function(q,K){var se=new f.Point(q.x,q.y),he,le;K===0?(le=c[K+1],he=w?B(f.util.createVector(le,se)).addEquals(se):c[c.length-1]):K===c.length-1?(he=c[K-1],le=w?B(f.util.createVector(he,se)).addEquals(se):c[0]):(he=c[K-1],le=c[K+1]);var ve=f.util.getBisector(se,he,le),ot=ve.vector,_e=ve.angle,pe,ze;if(_.strokeLineJoin==="miter"&&(pe=-C/Math.sin(_e/2),ze=new f.Point(ot.x*pe*L.x,ot.y*pe*L.y),Math.hypot(ze.x,ze.y)/C<=_.strokeMiterLimit)){g.push(se.add(ze)),g.push(se.subtract(ze));return}pe=-C*Math.SQRT2,ze=new f.Point(ot.x*pe*L.x,ot.y*pe*L.y),g.push(se.add(ze)),g.push(se.subtract(ze))}),g},transformPoint:function(c,_,w){return w?new f.Point(_[0]*c.x+_[2]*c.y,_[1]*c.x+_[3]*c.y):new f.Point(_[0]*c.x+_[2]*c.y+_[4],_[1]*c.x+_[3]*c.y+_[5])},makeBoundingBoxFromPoints:function(c,_){if(_)for(var w=0;w<c.length;w++)c[w]=f.util.transformPoint(c[w],_);var g=[c[0].x,c[1].x,c[2].x,c[3].x],C=f.util.array.min(g),L=f.util.array.max(g),B=L-C,q=[c[0].y,c[1].y,c[2].y,c[3].y],K=f.util.array.min(q),se=f.util.array.max(q),he=se-K;return{left:C,top:K,width:B,height:he}},invertTransform:function(c){var _=1/(c[0]*c[3]-c[1]*c[2]),w=[_*c[3],-_*c[1],-_*c[2],_*c[0]],g=f.util.transformPoint({x:c[4],y:c[5]},w,!0);return w[4]=-g.x,w[5]=-g.y,w},toFixed:function(c,_){return parseFloat(Number(c).toFixed(_))},parseUnit:function(c,_){var w=/\D{0,2}$/.exec(c),g=parseFloat(c);switch(_||(_=f.Text.DEFAULT_SVG_FONT_SIZE),w[0]){case"mm":return g*f.DPI/25.4;case"cm":return g*f.DPI/2.54;case"in":return g*f.DPI;case"pt":return g*f.DPI/72;case"pc":return g*f.DPI/72*12;case"em":return g*_;default:return g}},falseFunction:function(){return!1},getKlass:function(c,_){return c=f.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1)),f.util.resolveNamespace(_)[c]},getSvgAttributes:function(c){var _=["instantiated_by_use","style","id","class"];switch(c){case"linearGradient":_=_.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":_=_.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":_=_.concat(["offset","stop-color","stop-opacity"]);break}return _},resolveNamespace:function(c){if(!c)return f;var _=c.split("."),w=_.length,g,C=t||f.window;for(g=0;g<w;++g)C=C[_[g]];return C},loadImage:function(c,_,w,g){if(!c){_&&_.call(w,c);return}var C=f.util.createImage(),L=function(){_&&_.call(w,C,!1),C=C.onload=C.onerror=null};C.onload=L,C.onerror=function(){f.log("Error loading "+C.src),_&&_.call(w,null,!0),C=C.onload=C.onerror=null},c.indexOf("data")!==0&&g!==void 0&&g!==null&&(C.crossOrigin=g),c.substring(0,14)==="data:image/svg"&&(C.onload=null,f.util.loadImageInDom(C,L)),C.src=c},loadImageInDom:function(c,_){var w=f.document.createElement("div");w.style.width=w.style.height="1px",w.style.left=w.style.top="-100%",w.style.position="absolute",w.appendChild(c),f.document.querySelector("body").appendChild(w),c.onload=function(){_(),w.parentNode.removeChild(w),w=null}},enlivenObjects:function(c,_,w,g){c=c||[];var C=[],L=0,B=c.length;function q(){++L===B&&_&&_(C.filter(function(K){return K}))}if(!B){_&&_(C);return}c.forEach(function(K,se){if(!K||!K.type){q();return}var he=f.util.getKlass(K.type,w);he.fromObject(K,function(le,ve){ve||(C[se]=le),g&&g(K,le,ve),q()})})},enlivenObjectEnlivables:function(c,_,w){var g=f.Object.ENLIVEN_PROPS.filter(function(C){return!!c[C]});f.util.enlivenObjects(g.map(function(C){return c[C]}),function(C){var L={};g.forEach(function(B,q){L[B]=C[q],_&&(_[B]=C[q])}),w&&w(L)})},enlivenPatterns:function(c,_){c=c||[];function w(){++C===L&&_&&_(g)}var g=[],C=0,L=c.length;if(!L){_&&_(g);return}c.forEach(function(B,q){B&&B.source?new f.Pattern(B,function(K){g[q]=K,w()}):(g[q]=B,w())})},groupSVGElements:function(c,_,w){var g;return c&&c.length===1?(typeof w<"u"&&(c[0].sourcePath=w),c[0]):(_&&(_.width&&_.height?_.centerPoint={x:_.width/2,y:_.height/2}:(delete _.width,delete _.height)),g=new f.Group(c,_),typeof w<"u"&&(g.sourcePath=w),g)},populateWithProperties:function(c,_,w){if(w&&Array.isArray(w))for(var g=0,C=w.length;g<C;g++)w[g]in c&&(_[w[g]]=c[w[g]])},createCanvasElement:function(){return f.document.createElement("canvas")},copyCanvasElement:function(c){var _=f.util.createCanvasElement();return _.width=c.width,_.height=c.height,_.getContext("2d").drawImage(c,0,0),_},toDataURL:function(c,_,w){return c.toDataURL("image/"+_,w)},createImage:function(){return f.document.createElement("img")},multiplyTransformMatrices:function(c,_,w){return[c[0]*_[0]+c[2]*_[1],c[1]*_[0]+c[3]*_[1],c[0]*_[2]+c[2]*_[3],c[1]*_[2]+c[3]*_[3],w?0:c[0]*_[4]+c[2]*_[5]+c[4],w?0:c[1]*_[4]+c[3]*_[5]+c[5]]},qrDecompose:function(c){var _=v(c[1],c[0]),w=x(c[0],2)+x(c[1],2),g=l(w),C=(c[0]*c[3]-c[2]*c[1])/g,L=v(c[0]*c[2]+c[1]*c[3],w);return{angle:_/d,scaleX:g,scaleY:C,skewX:L/d,skewY:0,translateX:c[4],translateY:c[5]}},calcRotateMatrix:function(c){if(!c.angle)return f.iMatrix.concat();var _=f.util.degreesToRadians(c.angle),w=f.util.cos(_),g=f.util.sin(_);return[w,g,-g,w,0,0]},calcDimensionsMatrix:function(c){var _=typeof c.scaleX>"u"?1:c.scaleX,w=typeof c.scaleY>"u"?1:c.scaleY,g=[c.flipX?-_:_,0,0,c.flipY?-w:w,0,0],C=f.util.multiplyTransformMatrices,L=f.util.degreesToRadians;return c.skewX&&(g=C(g,[1,0,Math.tan(L(c.skewX)),1],!0)),c.skewY&&(g=C(g,[1,Math.tan(L(c.skewY)),0,1],!0)),g},composeMatrix:function(c){var _=[1,0,0,1,c.translateX||0,c.translateY||0],w=f.util.multiplyTransformMatrices;return c.angle&&(_=w(_,f.util.calcRotateMatrix(c))),(c.scaleX!==1||c.scaleY!==1||c.skewX||c.skewY||c.flipX||c.flipY)&&(_=w(_,f.util.calcDimensionsMatrix(c))),_},resetObjectTransform:function(c){c.scaleX=1,c.scaleY=1,c.skewX=0,c.skewY=0,c.flipX=!1,c.flipY=!1,c.rotate(0)},saveObjectTransform:function(c){return{scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,angle:c.angle,left:c.left,flipX:c.flipX,flipY:c.flipY,top:c.top}},isTransparent:function(c,_,w,g){g>0&&(_>g?_-=g:_=0,w>g?w-=g:w=0);var C=!0,L,B,q=c.getImageData(_,w,g*2||1,g*2||1),K=q.data.length;for(L=3;L<K&&(B=q.data[L],C=B<=0,C!==!1);L+=4);return q=null,C},parsePreserveAspectRatioAttribute:function(c){var _="meet",w="Mid",g="Mid",C=c.split(" "),L;return C&&C.length&&(_=C.pop(),_!=="meet"&&_!=="slice"?(L=_,_="meet"):C.length&&(L=C.pop())),w=L!=="none"?L.slice(1,4):"none",g=L!=="none"?L.slice(5,8):"none",{meetOrSlice:_,alignX:w,alignY:g}},clearFabricFontCache:function(c){c=(c||"").toLowerCase(),c?f.charWidthsCache[c]&&delete f.charWidthsCache[c]:f.charWidthsCache={}},limitDimsByArea:function(c,_){var w=Math.sqrt(_*c),g=Math.floor(_/w);return{x:Math.floor(w),y:g}},capValue:function(c,_,w){return Math.max(c,Math.min(_,w))},findScaleToFit:function(c,_){return Math.min(_.width/c.width,_.height/c.height)},findScaleToCover:function(c,_){return Math.max(_.width/c.width,_.height/c.height)},matrixToSVG:function(c){return"matrix("+c.map(function(_){return f.util.toFixed(_,f.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(c,_){var w=f.util.invertTransform(_),g=f.util.multiplyTransformMatrices(w,c.calcOwnMatrix());f.util.applyTransformToObject(c,g)},addTransformToObject:function(c,_){f.util.applyTransformToObject(c,f.util.multiplyTransformMatrices(_,c.calcOwnMatrix()))},applyTransformToObject:function(c,_){var w=f.util.qrDecompose(_),g=new f.Point(w.translateX,w.translateY);c.flipX=!1,c.flipY=!1,c.set("scaleX",w.scaleX),c.set("scaleY",w.scaleY),c.skewX=w.skewX,c.skewY=w.skewY,c.angle=w.angle,c.setPositionByOrigin(g,"center","center")},sizeAfterTransform:function(c,_,w){var g=c/2,C=_/2,L=[{x:-g,y:-C},{x:g,y:-C},{x:-g,y:C},{x:g,y:C}],B=f.util.calcDimensionsMatrix(w),q=f.util.makeBoundingBoxFromPoints(L,B);return{x:q.width,y:q.height}},mergeClipPaths:function(c,_){var w=c,g=_;w.inverted&&!g.inverted&&(w=_,g=c),f.util.applyTransformToObject(g,f.util.multiplyTransformMatrices(f.util.invertTransform(w.calcTransformMatrix()),g.calcTransformMatrix()));var C=w.inverted&&g.inverted;return C&&(w.inverted=g.inverted=!1),new f.Group([w],{clipPath:g,inverted:C})},hasStyleChanged:function(c,_,w){return w=w||!1,c.fill!==_.fill||c.stroke!==_.stroke||c.strokeWidth!==_.strokeWidth||c.fontSize!==_.fontSize||c.fontFamily!==_.fontFamily||c.fontWeight!==_.fontWeight||c.fontStyle!==_.fontStyle||c.textBackgroundColor!==_.textBackgroundColor||c.deltaY!==_.deltaY||w&&(c.overline!==_.overline||c.underline!==_.underline||c.linethrough!==_.linethrough)},stylesToArray:function(w,_){for(var w=f.util.object.clone(w,!0),g=_.split(`
`),C=-1,L={},B=[],q=0;q<g.length;q++){if(!w[q]){C+=g[q].length;continue}for(var K=0;K<g[q].length;K++){C++;var se=w[q][K];if(se&&Object.keys(se).length>0){var he=f.util.hasStyleChanged(L,se,!0);he?B.push({start:C,end:C+1,style:se}):B[B.length-1].end++}L=se||{}}}return B},stylesFromArray:function(c,_){if(!Array.isArray(c))return c;for(var w=_.split(`
`),g=-1,C=0,L={},B=0;B<w.length;B++)for(var q=0;q<w[B].length;q++)g++,c[C]&&c[C].start<=g&&g<c[C].end&&(L[B]=L[B]||{},L[B][q]=Object.assign({},c[C].style),g===c[C].end-1&&C++);return L}}}(M),function(){var t=Array.prototype.join,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},v={m:"l",M:"L"};function x(ae,Te,Oe,Y,ce,re,te,we,ke,We,qe){var gt=f.util.cos(ae),lt=f.util.sin(ae),Bt=f.util.cos(Te),ht=f.util.sin(Te),ct=Oe*ce*Bt-Y*re*ht+te,Xe=Y*ce*Bt+Oe*re*ht+we,Se=We+ke*(-Oe*ce*lt-Y*re*gt),At=qe+ke*(-Y*ce*lt+Oe*re*gt),Et=ct+ke*(Oe*ce*ht+Y*re*Bt),wt=Xe+ke*(Y*ce*ht-Oe*re*Bt);return["C",Se,At,Et,wt,ct,Xe]}function d(ae,Te,Oe,Y,ce,re,te){var we=Math.PI,ke=te*we/180,We=f.util.sin(ke),qe=f.util.cos(ke),gt=0,lt=0;Oe=Math.abs(Oe),Y=Math.abs(Y);var Bt=-qe*ae*.5-We*Te*.5,ht=-qe*Te*.5+We*ae*.5,ct=Oe*Oe,Xe=Y*Y,Se=ht*ht,At=Bt*Bt,Et=ct*Xe-ct*Se-Xe*At,wt=0;if(Et<0){var Kt=Math.sqrt(1-Et/(ct*Xe));Oe*=Kt,Y*=Kt}else wt=(ce===re?-1:1)*Math.sqrt(Et/(ct*Se+Xe*At));var $t=wt*Oe*ht/Y,yt=-wt*Y*Bt/Oe,ri=qe*$t-We*yt+ae*.5,mi=We*$t+qe*yt+Te*.5,xi=m(1,0,(Bt-$t)/Oe,(ht-yt)/Y),Li=m((Bt-$t)/Oe,(ht-yt)/Y,(-Bt-$t)/Oe,(-ht-yt)/Y);re===0&&Li>0?Li-=2*we:re===1&&Li<0&&(Li+=2*we);for(var Ue=Math.ceil(Math.abs(Li/we*2)),ge=[],Rt=Li/Ue,si=8/3*Math.sin(Rt/4)*Math.sin(Rt/4)/Math.sin(Rt/2),jt=xi+Rt,Ii=0;Ii<Ue;Ii++)ge[Ii]=x(xi,jt,qe,We,Oe,Y,ri,mi,si,gt,lt),gt=ge[Ii][5],lt=ge[Ii][6],xi=jt,jt+=Rt;return ge}function m(ae,Te,Oe,Y){var ce=Math.atan2(Te,ae),re=Math.atan2(Y,Oe);return re>=ce?re-ce:2*Math.PI-(ce-re)}function c(ae,Te,Oe,Y,ce,re,te,we){var ke;if(f.cachesBoundsOfCurve&&(ke=t.call(arguments),f.boundsOfCurveCache[ke]))return f.boundsOfCurveCache[ke];var We=Math.sqrt,qe=Math.min,gt=Math.max,lt=Math.abs,Bt=[],ht=[[],[]],ct,Xe,Se,At,Et,wt,Kt,$t;Xe=6*ae-12*Oe+6*ce,ct=-3*ae+9*Oe-9*ce+3*te,Se=3*Oe-3*ae;for(var yt=0;yt<2;++yt){if(yt>0&&(Xe=6*Te-12*Y+6*re,ct=-3*Te+9*Y-9*re+3*we,Se=3*Y-3*Te),lt(ct)<1e-12){if(lt(Xe)<1e-12)continue;At=-Se/Xe,0<At&&At<1&&Bt.push(At);continue}Kt=Xe*Xe-4*Se*ct,!(Kt<0)&&($t=We(Kt),Et=(-Xe+$t)/(2*ct),0<Et&&Et<1&&Bt.push(Et),wt=(-Xe-$t)/(2*ct),0<wt&&wt<1&&Bt.push(wt))}for(var ri,mi,xi=Bt.length,Li=xi,Ue;xi--;)At=Bt[xi],Ue=1-At,ri=Ue*Ue*Ue*ae+3*Ue*Ue*At*Oe+3*Ue*At*At*ce+At*At*At*te,ht[0][xi]=ri,mi=Ue*Ue*Ue*Te+3*Ue*Ue*At*Y+3*Ue*At*At*re+At*At*At*we,ht[1][xi]=mi;ht[0][Li]=ae,ht[1][Li]=Te,ht[0][Li+1]=te,ht[1][Li+1]=we;var ge=[{x:qe.apply(null,ht[0]),y:qe.apply(null,ht[1])},{x:gt.apply(null,ht[0]),y:gt.apply(null,ht[1])}];return f.cachesBoundsOfCurve&&(f.boundsOfCurveCache[ke]=ge),ge}function _(ae,Te,Oe){for(var Y=Oe[1],ce=Oe[2],re=Oe[3],te=Oe[4],we=Oe[5],ke=Oe[6],We=Oe[7],qe=d(ke-ae,We-Te,Y,ce,te,we,re),gt=0,lt=qe.length;gt<lt;gt++)qe[gt][1]+=ae,qe[gt][2]+=Te,qe[gt][3]+=ae,qe[gt][4]+=Te,qe[gt][5]+=ae,qe[gt][6]+=Te;return qe}function w(ae){var Te=0,Oe=0,Y=ae.length,ce=0,re=0,te,we,ke,We=[],qe,gt,lt;for(we=0;we<Y;++we){switch(ke=!1,te=ae[we].slice(0),te[0]){case"l":te[0]="L",te[1]+=Te,te[2]+=Oe;case"L":Te=te[1],Oe=te[2];break;case"h":te[1]+=Te;case"H":te[0]="L",te[2]=Oe,Te=te[1];break;case"v":te[1]+=Oe;case"V":te[0]="L",Oe=te[1],te[1]=Te,te[2]=Oe;break;case"m":te[0]="M",te[1]+=Te,te[2]+=Oe;case"M":Te=te[1],Oe=te[2],ce=te[1],re=te[2];break;case"c":te[0]="C",te[1]+=Te,te[2]+=Oe,te[3]+=Te,te[4]+=Oe,te[5]+=Te,te[6]+=Oe;case"C":gt=te[3],lt=te[4],Te=te[5],Oe=te[6];break;case"s":te[0]="S",te[1]+=Te,te[2]+=Oe,te[3]+=Te,te[4]+=Oe;case"S":qe==="C"?(gt=2*Te-gt,lt=2*Oe-lt):(gt=Te,lt=Oe),Te=te[3],Oe=te[4],te[0]="C",te[5]=te[3],te[6]=te[4],te[3]=te[1],te[4]=te[2],te[1]=gt,te[2]=lt,gt=te[3],lt=te[4];break;case"q":te[0]="Q",te[1]+=Te,te[2]+=Oe,te[3]+=Te,te[4]+=Oe;case"Q":gt=te[1],lt=te[2],Te=te[3],Oe=te[4];break;case"t":te[0]="T",te[1]+=Te,te[2]+=Oe;case"T":qe==="Q"?(gt=2*Te-gt,lt=2*Oe-lt):(gt=Te,lt=Oe),te[0]="Q",Te=te[1],Oe=te[2],te[1]=gt,te[2]=lt,te[3]=Te,te[4]=Oe;break;case"a":te[0]="A",te[6]+=Te,te[7]+=Oe;case"A":ke=!0,We=We.concat(_(Te,Oe,te)),Te=te[6],Oe=te[7];break;case"z":case"Z":Te=ce,Oe=re;break}ke||We.push(te),qe=te[0]}return We}function g(ae,Te,Oe,Y){return Math.sqrt((Oe-ae)*(Oe-ae)+(Y-Te)*(Y-Te))}function C(ae){return ae*ae*ae}function L(ae){return 3*ae*ae*(1-ae)}function B(ae){return 3*ae*(1-ae)*(1-ae)}function q(ae){return(1-ae)*(1-ae)*(1-ae)}function K(ae,Te,Oe,Y,ce,re,te,we){return function(ke){var We=C(ke),qe=L(ke),gt=B(ke),lt=q(ke);return{x:te*We+ce*qe+Oe*gt+ae*lt,y:we*We+re*qe+Y*gt+Te*lt}}}function se(ae,Te,Oe,Y,ce,re,te,we){return function(ke){var We=1-ke,qe=3*We*We*(Oe-ae)+6*We*ke*(ce-Oe)+3*ke*ke*(te-ce),gt=3*We*We*(Y-Te)+6*We*ke*(re-Y)+3*ke*ke*(we-re);return Math.atan2(gt,qe)}}function he(ae){return ae*ae}function le(ae){return 2*ae*(1-ae)}function ve(ae){return(1-ae)*(1-ae)}function ot(ae,Te,Oe,Y,ce,re){return function(te){var we=he(te),ke=le(te),We=ve(te);return{x:ce*we+Oe*ke+ae*We,y:re*we+Y*ke+Te*We}}}function _e(ae,Te,Oe,Y,ce,re){return function(te){var we=1-te,ke=2*we*(Oe-ae)+2*te*(ce-Oe),We=2*we*(Y-Te)+2*te*(re-Y);return Math.atan2(We,ke)}}function pe(ae,Te,Oe){var Y={x:Te,y:Oe},ce,re=0,te;for(te=1;te<=100;te+=1)ce=ae(te/100),re+=g(Y.x,Y.y,ce.x,ce.y),Y=ce;return re}function ze(ae,Te){for(var Oe=0,Y=0,ce=ae.iterator,re={x:ae.x,y:ae.y},te,we,ke=.01,We=ae.angleFinder,qe;Y<Te&&ke>1e-4;)te=ce(Oe),qe=Oe,we=g(re.x,re.y,te.x,te.y),we+Y>Te?(Oe-=ke,ke/=2):(re=te,Oe+=ke,Y+=we);return te.angle=We(qe),te}function De(ae){for(var Te=0,Oe=ae.length,Y,ce=0,re=0,te=0,we=0,ke=[],We,qe,gt,lt=0;lt<Oe;lt++){switch(Y=ae[lt],qe={x:ce,y:re,command:Y[0]},Y[0]){case"M":qe.length=0,te=ce=Y[1],we=re=Y[2];break;case"L":qe.length=g(ce,re,Y[1],Y[2]),ce=Y[1],re=Y[2];break;case"C":We=K(ce,re,Y[1],Y[2],Y[3],Y[4],Y[5],Y[6]),gt=se(ce,re,Y[1],Y[2],Y[3],Y[4],Y[5],Y[6]),qe.iterator=We,qe.angleFinder=gt,qe.length=pe(We,ce,re),ce=Y[5],re=Y[6];break;case"Q":We=ot(ce,re,Y[1],Y[2],Y[3],Y[4]),gt=_e(ce,re,Y[1],Y[2],Y[3],Y[4]),qe.iterator=We,qe.angleFinder=gt,qe.length=pe(We,ce,re),ce=Y[3],re=Y[4];break;case"Z":case"z":qe.destX=te,qe.destY=we,qe.length=g(ce,re,te,we),ce=te,re=we;break}Te+=qe.length,ke.push(qe)}return ke.push({length:Te,x:ce,y:re}),ke}function at(ae,Te,Oe){Oe||(Oe=De(ae));for(var Y=0;Te-Oe[Y].length>0&&Y<Oe.length-2;)Te-=Oe[Y].length,Y++;var ce=Oe[Y],re=Te/ce.length,te=ce.command,we=ae[Y],ke;switch(te){case"M":return{x:ce.x,y:ce.y,angle:0};case"Z":case"z":return ke=new f.Point(ce.x,ce.y).lerp(new f.Point(ce.destX,ce.destY),re),ke.angle=Math.atan2(ce.destY-ce.y,ce.destX-ce.x),ke;case"L":return ke=new f.Point(ce.x,ce.y).lerp(new f.Point(we[1],we[2]),re),ke.angle=Math.atan2(we[2]-ce.y,we[1]-ce.x),ke;case"C":return ze(ce,Te);case"Q":return ze(ce,Te)}}function ft(ae){var Te=[],Oe=[],Y,ce,re=f.rePathCommand,te="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",we="("+te+")"+f.commaWsp,ke="([01])"+f.commaWsp+"?",We=we+"?"+we+"?"+we+ke+ke+we+"?("+te+")",qe=new RegExp(We,"g"),gt,lt,Bt;if(!ae||!ae.match)return Te;Bt=ae.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var ht=0,ct,Xe=Bt.length;ht<Xe;ht++){Y=Bt[ht],lt=Y.slice(1).trim(),Oe.length=0;var Se=Y.charAt(0);if(ct=[Se],Se.toLowerCase()==="a")for(var At;At=qe.exec(lt);)for(var Et=1;Et<At.length;Et++)Oe.push(At[Et]);else for(;gt=re.exec(lt);)Oe.push(gt[0]);for(var Et=0,wt=Oe.length;Et<wt;Et++)ce=parseFloat(Oe[Et]),isNaN(ce)||ct.push(ce);var Kt=l[Se.toLowerCase()],$t=v[Se]||Se;if(ct.length-1>Kt)for(var yt=1,ri=ct.length;yt<ri;yt+=Kt)Te.push([Se].concat(ct.slice(yt,yt+Kt))),Se=$t;else Te.push(ct)}return Te}function xt(ae,Te){var Oe=[],Y,ce=new f.Point(ae[0].x,ae[0].y),re=new f.Point(ae[1].x,ae[1].y),te=ae.length,we=1,ke=0,We=te>2;for(Te=Te||0,We&&(we=ae[2].x<re.x?-1:ae[2].x===re.x?0:1,ke=ae[2].y<re.y?-1:ae[2].y===re.y?0:1),Oe.push(["M",ce.x-we*Te,ce.y-ke*Te]),Y=1;Y<te;Y++){if(!ce.eq(re)){var qe=ce.midPointFrom(re);Oe.push(["Q",ce.x,ce.y,qe.x,qe.y])}ce=ae[Y],Y+1<ae.length&&(re=ae[Y+1])}return We&&(we=ce.x>ae[Y-2].x?1:ce.x===ae[Y-2].x?0:-1,ke=ce.y>ae[Y-2].y?1:ce.y===ae[Y-2].y?0:-1),Oe.push(["L",ce.x+we*Te,ce.y+ke*Te]),Oe}function He(ae,Te,Oe){return Oe&&(Te=f.util.multiplyTransformMatrices(Te,[1,0,0,1,-Oe.x,-Oe.y])),ae.map(function(Y){for(var ce=Y.slice(0),re={},te=1;te<Y.length-1;te+=2)re.x=Y[te],re.y=Y[te+1],re=f.util.transformPoint(re,Te),ce[te]=re.x,ce[te+1]=re.y;return ce})}f.util.joinPath=function(ae){return ae.map(function(Te){return Te.join(" ")}).join(" ")},f.util.parsePath=ft,f.util.makePathSimpler=w,f.util.getSmoothPathFromPoints=xt,f.util.getPathSegmentsInfo=De,f.util.getBoundsOfCurve=c,f.util.getPointOnPath=at,f.util.transformPath=He}(),function(){var t=Array.prototype.slice;function l(c,_){for(var w=t.call(arguments,2),g=[],C=0,L=c.length;C<L;C++)g[C]=w.length?c[C][_].apply(c[C],w):c[C][_].call(c[C]);return g}function v(c,_){return m(c,_,function(w,g){return w>=g})}function x(c,_){return m(c,_,function(w,g){return w<g})}function d(c,_){for(var w=c.length;w--;)c[w]=_;return c}function m(c,_,w){if(!(!c||c.length===0)){var g=c.length-1,C=_?c[g][_]:c[g];if(_)for(;g--;)w(c[g][_],C)&&(C=c[g][_]);else for(;g--;)w(c[g],C)&&(C=c[g]);return C}}f.util.array={fill:d,invoke:l,min:x,max:v}}(),function(){function t(v,x,d){if(d)if(!f.isLikelyNode&&x instanceof Element)v=x;else if(x instanceof Array){v=[];for(var m=0,c=x.length;m<c;m++)v[m]=t({},x[m],d)}else if(x&&typeof x=="object")for(var _ in x)_==="canvas"||_==="group"?v[_]=null:x.hasOwnProperty(_)&&(v[_]=t({},x[_],d));else v=x;else for(var _ in x)v[_]=x[_];return v}function l(v,x){return t({},v,x)}f.util.object={extend:t,clone:l},f.util.object.extend(f.util,f.Observable)}(),function(){function t(m){return m.replace(/-+(.)?/g,function(c,_){return _?_.toUpperCase():""})}function l(m,c){return m.charAt(0).toUpperCase()+(c?m.slice(1):m.slice(1).toLowerCase())}function v(m){return m.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function x(m){var c=0,_,w=[];for(c=0,_;c<m.length;c++)(_=d(m,c))!==!1&&w.push(_);return w}function d(m,c){var _=m.charCodeAt(c);if(isNaN(_))return"";if(_<55296||_>57343)return m.charAt(c);if(55296<=_&&_<=56319){if(m.length<=c+1)throw"High surrogate without following low surrogate";var w=m.charCodeAt(c+1);if(56320>w||w>57343)throw"High surrogate without following low surrogate";return m.charAt(c)+m.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var g=m.charCodeAt(c-1);if(55296>g||g>56319)throw"Low surrogate without preceding high surrogate";return!1}f.util.string={camelize:t,capitalize:l,escapeXml:v,graphemeSplit:x}}(),function(){var t=Array.prototype.slice,l=function(){},v=function(){for(var _ in{toString:1})if(_==="toString")return!1;return!0}(),x=function(_,w,g){for(var C in w)C in _.prototype&&typeof _.prototype[C]=="function"&&(w[C]+"").indexOf("callSuper")>-1?_.prototype[C]=function(L){return function(){var B=this.constructor.superclass;this.constructor.superclass=g;var q=w[L].apply(this,arguments);if(this.constructor.superclass=B,L!=="initialize")return q}}(C):_.prototype[C]=w[C],v&&(w.toString!==Object.prototype.toString&&(_.prototype.toString=w.toString),w.valueOf!==Object.prototype.valueOf&&(_.prototype.valueOf=w.valueOf))};function d(){}function m(_){for(var w=null,g=this;g.constructor.superclass;){var C=g.constructor.superclass.prototype[_];if(g[_]!==C){w=C;break}g=g.constructor.superclass.prototype}return w?arguments.length>1?w.apply(this,t.call(arguments,1)):w.call(this):console.log("tried to callSuper "+_+", method not found in prototype chain",this)}function c(){var _=null,w=t.call(arguments,0);typeof w[0]=="function"&&(_=w.shift());function g(){this.initialize.apply(this,arguments)}g.superclass=_,g.subclasses=[],_&&(d.prototype=_.prototype,g.prototype=new d,_.subclasses.push(g));for(var C=0,L=w.length;C<L;C++)x(g,w[C],_);return g.prototype.initialize||(g.prototype.initialize=l),g.prototype.constructor=g,g.prototype.callSuper=m,g}f.util.createClass=c}(),function(){var t=!!f.document.createElement("div").attachEvent,l=["touchstart","touchmove","touchend"];f.util.addListener=function(x,d,m,c){x&&x.addEventListener(d,m,t?!1:c)},f.util.removeListener=function(x,d,m,c){x&&x.removeEventListener(d,m,t?!1:c)};function v(x){var d=x.changedTouches;return d&&d[0]?d[0]:x}f.util.getPointer=function(x){var d=x.target,m=f.util.getScrollLeftTop(d),c=v(x);return{x:c.clientX+m.left,y:c.clientY+m.top}},f.util.isTouchEvent=function(x){return l.indexOf(x.type)>-1||x.pointerType==="touch"}}(),function(){function t(c,_){var w=c.style;if(!w)return c;if(typeof _=="string")return c.style.cssText+=";"+_,_.indexOf("opacity")>-1?m(c,_.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var g in _)if(g==="opacity")m(c,_[g]);else{var C=g==="float"||g==="cssFloat"?typeof w.styleFloat>"u"?"cssFloat":"styleFloat":g;w.setProperty(C,_[g])}return c}var l=f.document.createElement("div"),v=typeof l.style.opacity=="string",x=typeof l.style.filter=="string",d=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,m=function(c){return c};v?m=function(c,_){return c.style.opacity=_,c}:x&&(m=function(c,_){var w=c.style;return c.currentStyle&&!c.currentStyle.hasLayout&&(w.zoom=1),d.test(w.filter)?(_=_>=.9999?"":"alpha(opacity="+_*100+")",w.filter=w.filter.replace(d,_)):w.filter+=" alpha(opacity="+_*100+")",c}),f.util.setStyle=t}(),function(){var t=Array.prototype.slice;function l(q){return typeof q=="string"?f.document.getElementById(q):q}var v,x=function(q){return t.call(q,0)};try{v=x(f.document.childNodes)instanceof Array}catch{}v||(x=function(q){for(var K=new Array(q.length),se=q.length;se--;)K[se]=q[se];return K});function d(q,K){var se=f.document.createElement(q);for(var he in K)he==="class"?se.className=K[he]:he==="for"?se.htmlFor=K[he]:se.setAttribute(he,K[he]);return se}function m(q,K){q&&(" "+q.className+" ").indexOf(" "+K+" ")===-1&&(q.className+=(q.className?" ":"")+K)}function c(q,K,se){return typeof K=="string"&&(K=d(K,se)),q.parentNode&&q.parentNode.replaceChild(K,q),K.appendChild(q),K}function _(q){for(var K=0,se=0,he=f.document.documentElement,le=f.document.body||{scrollLeft:0,scrollTop:0};q&&(q.parentNode||q.host)&&(q=q.parentNode||q.host,q===f.document?(K=le.scrollLeft||he.scrollLeft||0,se=le.scrollTop||he.scrollTop||0):(K+=q.scrollLeft||0,se+=q.scrollTop||0),!(q.nodeType===1&&q.style.position==="fixed")););return{left:K,top:se}}function w(q){var K,se=q&&q.ownerDocument,he={left:0,top:0},le={left:0,top:0},ve,ot={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!se)return le;for(var _e in ot)le[ot[_e]]+=parseInt(g(q,_e),10)||0;return K=se.documentElement,typeof q.getBoundingClientRect<"u"&&(he=q.getBoundingClientRect()),ve=_(q),{left:he.left+ve.left-(K.clientLeft||0)+le.left,top:he.top+ve.top-(K.clientTop||0)+le.top}}var g;f.document.defaultView&&f.document.defaultView.getComputedStyle?g=function(q,K){var se=f.document.defaultView.getComputedStyle(q,null);return se?se[K]:void 0}:g=function(q,K){var se=q.style[K];return!se&&q.currentStyle&&(se=q.currentStyle[K]),se},function(){var q=f.document.documentElement.style,K="userSelect"in q?"userSelect":"MozUserSelect"in q?"MozUserSelect":"WebkitUserSelect"in q?"WebkitUserSelect":"KhtmlUserSelect"in q?"KhtmlUserSelect":"";function se(le){return typeof le.onselectstart<"u"&&(le.onselectstart=f.util.falseFunction),K?le.style[K]="none":typeof le.unselectable=="string"&&(le.unselectable="on"),le}function he(le){return typeof le.onselectstart<"u"&&(le.onselectstart=null),K?le.style[K]="":typeof le.unselectable=="string"&&(le.unselectable=""),le}f.util.makeElementUnselectable=se,f.util.makeElementSelectable=he}();function C(q){var K=f.jsdomImplForWrapper(q);return K._canvas||K._image}function L(q){if(f.isLikelyNode){var K=f.jsdomImplForWrapper(q);K&&(K._image=null,K._canvas=null,K._currentSrc=null,K._attributes=null,K._classList=null)}}function B(q,K){q.imageSmoothingEnabled=q.imageSmoothingEnabled||q.webkitImageSmoothingEnabled||q.mozImageSmoothingEnabled||q.msImageSmoothingEnabled||q.oImageSmoothingEnabled,q.imageSmoothingEnabled=K}f.util.setImageSmoothing=B,f.util.getById=l,f.util.toArray=x,f.util.addClass=m,f.util.makeElement=d,f.util.wrapElement=c,f.util.getScrollLeftTop=_,f.util.getElementOffset=w,f.util.getNodeCanvas=C,f.util.cleanUpJsdomNode=L}(),function(){function t(x,d){return x+(/\?/.test(x)?"&":"?")+d}function l(){}function v(x,d){d||(d={});var m=d.method?d.method.toUpperCase():"GET",c=d.onComplete||function(){},_=new f.window.XMLHttpRequest,w=d.body||d.parameters;return _.onreadystatechange=function(){_.readyState===4&&(c(_),_.onreadystatechange=l)},m==="GET"&&(w=null,typeof d.parameters=="string"&&(x=t(x,d.parameters))),_.open(m,x,!0),(m==="POST"||m==="PUT")&&_.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),_.send(w),_}f.util.request=v}(),f.log=console.log,f.warn=console.warn,function(){var t=f.util.object.extend,l=f.util.object.clone,v=[];f.util.object.extend(v,{cancelAll:function(){var C=this.splice(0);return C.forEach(function(L){L.cancel()}),C},cancelByCanvas:function(C){if(!C)return[];var L=this.filter(function(B){return typeof B.target=="object"&&B.target.canvas===C});return L.forEach(function(B){B.cancel()}),L},cancelByTarget:function(C){var L=this.findAnimationsByTarget(C);return L.forEach(function(B){B.cancel()}),L},findAnimationIndex:function(C){return this.indexOf(this.findAnimation(C))},findAnimation:function(C){return this.find(function(L){return L.cancel===C})},findAnimationsByTarget:function(C){return C?this.filter(function(L){return L.target===C}):[]}});function x(){return!1}function d(C,L,B,q){return-B*Math.cos(C/q*(Math.PI/2))+B+L}function m(C){C||(C={});var L=!1,B,q=function(){var K=f.runningAnimations.indexOf(B);return K>-1&&f.runningAnimations.splice(K,1)[0]};return B=t(l(C),{cancel:function(){return L=!0,q()},currentValue:"startValue"in C?C.startValue:0,completionRate:0,durationRate:0}),f.runningAnimations.push(B),w(function(K){var se=K||+new Date,he=C.duration||500,le=se+he,ve,ot=C.onChange||x,_e=C.abort||x,pe=C.onComplete||x,ze=C.easing||d,De="startValue"in C?C.startValue.length>0:!1,at="startValue"in C?C.startValue:0,ft="endValue"in C?C.endValue:100,xt=C.byValue||(De?at.map(function(He,ae){return ft[ae]-at[ae]}):ft-at);C.onStart&&C.onStart(),function He(ae){ve=ae||+new Date;var Te=ve>le?he:ve-se,Oe=Te/he,Y=De?at.map(function(re,te){return ze(Te,at[te],xt[te],he)}):ze(Te,at,xt,he),ce=Math.abs(De?(Y[0]-at[0])/xt[0]:(Y-at)/xt);if(B.currentValue=De?Y.slice():Y,B.completionRate=ce,B.durationRate=Oe,!L){if(_e(Y,ce,Oe)){q();return}if(ve>le){B.currentValue=De?ft.slice():ft,B.completionRate=1,B.durationRate=1,ot(De?ft.slice():ft,1,1),pe(ft,1,1),q();return}else ot(Y,ce,Oe),w(He)}}(se)}),B.cancel}var c=f.window.requestAnimationFrame||f.window.webkitRequestAnimationFrame||f.window.mozRequestAnimationFrame||f.window.oRequestAnimationFrame||f.window.msRequestAnimationFrame||function(C){return f.window.setTimeout(C,1e3/60)},_=f.window.cancelAnimationFrame||f.window.clearTimeout;function w(){return c.apply(f.window,arguments)}function g(){return _.apply(f.window,arguments)}f.util.animate=m,f.util.requestAnimFrame=w,f.util.cancelAnimFrame=g,f.runningAnimations=v}(),function(){function t(v,x,d){var m="rgba("+parseInt(v[0]+d*(x[0]-v[0]),10)+","+parseInt(v[1]+d*(x[1]-v[1]),10)+","+parseInt(v[2]+d*(x[2]-v[2]),10);return m+=","+(v&&x?parseFloat(v[3]+d*(x[3]-v[3])):1),m+=")",m}function l(v,x,d,m){var c=new f.Color(v).getSource(),_=new f.Color(x).getSource(),w=m.onComplete,g=m.onChange;return m=m||{},f.util.animate(f.util.object.extend(m,{duration:d||500,startValue:c,endValue:_,byValue:_,easing:function(C,L,B,q){var K=m.colorEasing?m.colorEasing(C,q):1-Math.cos(C/q*(Math.PI/2));return t(L,B,K)},onComplete:function(C,L,B){if(w)return w(t(_,_,0),L,B)},onChange:function(C,L,B){if(g){if(Array.isArray(C))return g(t(C,C,0),L,B);g(C,L,B)}}}))}f.util.animateColor=l}(),function(){function t(ae,Te,Oe,Y){return ae<Math.abs(Te)?(ae=Te,Y=Oe/4):Te===0&&ae===0?Y=Oe/(2*Math.PI)*Math.asin(1):Y=Oe/(2*Math.PI)*Math.asin(Te/ae),{a:ae,c:Te,p:Oe,s:Y}}function l(ae,Te,Oe){return ae.a*Math.pow(2,10*(Te-=1))*Math.sin((Te*Oe-ae.s)*(2*Math.PI)/ae.p)}function v(ae,Te,Oe,Y){return Oe*((ae=ae/Y-1)*ae*ae+1)+Te}function x(ae,Te,Oe,Y){return ae/=Y/2,ae<1?Oe/2*ae*ae*ae+Te:Oe/2*((ae-=2)*ae*ae+2)+Te}function d(ae,Te,Oe,Y){return Oe*(ae/=Y)*ae*ae*ae+Te}function m(ae,Te,Oe,Y){return-Oe*((ae=ae/Y-1)*ae*ae*ae-1)+Te}function c(ae,Te,Oe,Y){return ae/=Y/2,ae<1?Oe/2*ae*ae*ae*ae+Te:-Oe/2*((ae-=2)*ae*ae*ae-2)+Te}function _(ae,Te,Oe,Y){return Oe*(ae/=Y)*ae*ae*ae*ae+Te}function w(ae,Te,Oe,Y){return Oe*((ae=ae/Y-1)*ae*ae*ae*ae+1)+Te}function g(ae,Te,Oe,Y){return ae/=Y/2,ae<1?Oe/2*ae*ae*ae*ae*ae+Te:Oe/2*((ae-=2)*ae*ae*ae*ae+2)+Te}function C(ae,Te,Oe,Y){return-Oe*Math.cos(ae/Y*(Math.PI/2))+Oe+Te}function L(ae,Te,Oe,Y){return Oe*Math.sin(ae/Y*(Math.PI/2))+Te}function B(ae,Te,Oe,Y){return-Oe/2*(Math.cos(Math.PI*ae/Y)-1)+Te}function q(ae,Te,Oe,Y){return ae===0?Te:Oe*Math.pow(2,10*(ae/Y-1))+Te}function K(ae,Te,Oe,Y){return ae===Y?Te+Oe:Oe*(-Math.pow(2,-10*ae/Y)+1)+Te}function se(ae,Te,Oe,Y){return ae===0?Te:ae===Y?Te+Oe:(ae/=Y/2,ae<1?Oe/2*Math.pow(2,10*(ae-1))+Te:Oe/2*(-Math.pow(2,-10*--ae)+2)+Te)}function he(ae,Te,Oe,Y){return-Oe*(Math.sqrt(1-(ae/=Y)*ae)-1)+Te}function le(ae,Te,Oe,Y){return Oe*Math.sqrt(1-(ae=ae/Y-1)*ae)+Te}function ve(ae,Te,Oe,Y){return ae/=Y/2,ae<1?-Oe/2*(Math.sqrt(1-ae*ae)-1)+Te:Oe/2*(Math.sqrt(1-(ae-=2)*ae)+1)+Te}function ot(ae,Te,Oe,Y){var ce=1.70158,re=0,te=Oe;if(ae===0)return Te;if(ae/=Y,ae===1)return Te+Oe;re||(re=Y*.3);var we=t(te,Oe,re,ce);return-l(we,ae,Y)+Te}function _e(ae,Te,Oe,Y){var ce=1.70158,re=0,te=Oe;if(ae===0)return Te;if(ae/=Y,ae===1)return Te+Oe;re||(re=Y*.3);var we=t(te,Oe,re,ce);return we.a*Math.pow(2,-10*ae)*Math.sin((ae*Y-we.s)*(2*Math.PI)/we.p)+we.c+Te}function pe(ae,Te,Oe,Y){var ce=1.70158,re=0,te=Oe;if(ae===0)return Te;if(ae/=Y/2,ae===2)return Te+Oe;re||(re=Y*(.3*1.5));var we=t(te,Oe,re,ce);return ae<1?-.5*l(we,ae,Y)+Te:we.a*Math.pow(2,-10*(ae-=1))*Math.sin((ae*Y-we.s)*(2*Math.PI)/we.p)*.5+we.c+Te}function ze(ae,Te,Oe,Y,ce){return ce===void 0&&(ce=1.70158),Oe*(ae/=Y)*ae*((ce+1)*ae-ce)+Te}function De(ae,Te,Oe,Y,ce){return ce===void 0&&(ce=1.70158),Oe*((ae=ae/Y-1)*ae*((ce+1)*ae+ce)+1)+Te}function at(ae,Te,Oe,Y,ce){return ce===void 0&&(ce=1.70158),ae/=Y/2,ae<1?Oe/2*(ae*ae*(((ce*=1.525)+1)*ae-ce))+Te:Oe/2*((ae-=2)*ae*(((ce*=1.525)+1)*ae+ce)+2)+Te}function ft(ae,Te,Oe,Y){return Oe-xt(Y-ae,0,Oe,Y)+Te}function xt(ae,Te,Oe,Y){return(ae/=Y)<1/2.75?Oe*(7.5625*ae*ae)+Te:ae<2/2.75?Oe*(7.5625*(ae-=1.5/2.75)*ae+.75)+Te:ae<2.5/2.75?Oe*(7.5625*(ae-=2.25/2.75)*ae+.9375)+Te:Oe*(7.5625*(ae-=2.625/2.75)*ae+.984375)+Te}function He(ae,Te,Oe,Y){return ae<Y/2?ft(ae*2,0,Oe,Y)*.5+Te:xt(ae*2-Y,0,Oe,Y)*.5+Oe*.5+Te}f.util.ease={easeInQuad:function(ae,Te,Oe,Y){return Oe*(ae/=Y)*ae+Te},easeOutQuad:function(ae,Te,Oe,Y){return-Oe*(ae/=Y)*(ae-2)+Te},easeInOutQuad:function(ae,Te,Oe,Y){return ae/=Y/2,ae<1?Oe/2*ae*ae+Te:-Oe/2*(--ae*(ae-2)-1)+Te},easeInCubic:function(ae,Te,Oe,Y){return Oe*(ae/=Y)*ae*ae+Te},easeOutCubic:v,easeInOutCubic:x,easeInQuart:d,easeOutQuart:m,easeInOutQuart:c,easeInQuint:_,easeOutQuint:w,easeInOutQuint:g,easeInSine:C,easeOutSine:L,easeInOutSine:B,easeInExpo:q,easeOutExpo:K,easeInOutExpo:se,easeInCirc:he,easeOutCirc:le,easeInOutCirc:ve,easeInElastic:ot,easeOutElastic:_e,easeInOutElastic:pe,easeInBack:ze,easeOutBack:De,easeInOutBack:at,easeInBounce:ft,easeOutBounce:xt,easeInOutBounce:He}}(),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.util.object.clone,d=l.util.toFixed,m=l.util.parseUnit,c=l.util.multiplyTransformMatrices,_=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],w=["symbol","image","marker","pattern","view","svg"],g=["pattern","defs","symbol","metadata","clipPath","mask","desc"],C=["symbol","g","a","svg","clipPath","defs"],L={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},B={stroke:"strokeOpacity",fill:"fillOpacity"},q="font-size",K="clip-path";l.svgValidTagNamesRegEx=le(_),l.svgViewBoxElementsRegEx=le(w),l.svgInvalidAncestorsRegEx=le(g),l.svgValidParentsRegEx=le(C),l.cssRules={},l.gradientDefs={},l.clipPaths={};function se(re){return re in L?L[re]:re}function he(re,te,we,ke){var We=Array.isArray(te),qe;if((re==="fill"||re==="stroke")&&te==="none")te="";else{if(re==="strokeUniform")return te==="non-scaling-stroke";if(re==="strokeDashArray")te==="none"?te=null:te=te.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(re==="transformMatrix")we&&we.transformMatrix?te=c(we.transformMatrix,l.parseTransformAttribute(te)):te=l.parseTransformAttribute(te);else if(re==="visible")te=te!=="none"&&te!=="hidden",we&&we.visible===!1&&(te=!1);else if(re==="opacity")te=parseFloat(te),we&&typeof we.opacity<"u"&&(te*=we.opacity);else if(re==="textAnchor")te=te==="start"?"left":te==="end"?"right":"center";else if(re==="charSpacing")qe=m(te,ke)/ke*1e3;else if(re==="paintFirst"){var gt=te.indexOf("fill"),lt=te.indexOf("stroke"),te="fill";(gt>-1&&lt>-1&&lt<gt||gt===-1&&lt>-1)&&(te="stroke")}else{if(re==="href"||re==="xlink:href"||re==="font")return te;if(re==="imageSmoothing")return te==="optimizeQuality";qe=We?te.map(m):m(te,ke)}}return!We&&isNaN(qe)?te:qe}function le(re){return new RegExp("^("+re.join("|")+")\\b","i")}function ve(re){for(var te in B)if(!(typeof re[B[te]]>"u"||re[te]==="")){if(typeof re[te]>"u"){if(!l.Object.prototype[te])continue;re[te]=l.Object.prototype[te]}if(re[te].indexOf("url(")!==0){var we=new l.Color(re[te]);re[te]=we.setAlpha(d(we.getAlpha()*re[B[te]],2)).toRgba()}}return re}function ot(re,te){var we,ke=[],We,qe,gt;for(qe=0,gt=te.length;qe<gt;qe++)we=te[qe],We=re.getElementsByTagName(we),ke=ke.concat(Array.prototype.slice.call(We));return ke}l.parseTransformAttribute=function(){function re(yt,ri){var mi=l.util.cos(ri[0]),xi=l.util.sin(ri[0]),Li=0,Ue=0;ri.length===3&&(Li=ri[1],Ue=ri[2]),yt[0]=mi,yt[1]=xi,yt[2]=-xi,yt[3]=mi,yt[4]=Li-(mi*Li-xi*Ue),yt[5]=Ue-(xi*Li+mi*Ue)}function te(yt,ri){var mi=ri[0],xi=ri.length===2?ri[1]:ri[0];yt[0]=mi,yt[3]=xi}function we(yt,ri,mi){yt[mi]=Math.tan(l.util.degreesToRadians(ri[0]))}function ke(yt,ri){yt[4]=ri[0],ri.length===2&&(yt[5]=ri[1])}var We=l.iMatrix,qe=l.reNum,gt=l.commaWsp,lt="(?:(skewX)\\s*\\(\\s*("+qe+")\\s*\\))",Bt="(?:(skewY)\\s*\\(\\s*("+qe+")\\s*\\))",ht="(?:(rotate)\\s*\\(\\s*("+qe+")(?:"+gt+"("+qe+")"+gt+"("+qe+"))?\\s*\\))",ct="(?:(scale)\\s*\\(\\s*("+qe+")(?:"+gt+"("+qe+"))?\\s*\\))",Xe="(?:(translate)\\s*\\(\\s*("+qe+")(?:"+gt+"("+qe+"))?\\s*\\))",Se="(?:(matrix)\\s*\\(\\s*("+qe+")"+gt+"("+qe+")"+gt+"("+qe+")"+gt+"("+qe+")"+gt+"("+qe+")"+gt+"("+qe+")\\s*\\))",At="(?:"+Se+"|"+Xe+"|"+ct+"|"+ht+"|"+lt+"|"+Bt+")",Et="(?:"+At+"(?:"+gt+"*"+At+")*)",wt="^\\s*(?:"+Et+"?)\\s*$",Kt=new RegExp(wt),$t=new RegExp(At,"g");return function(yt){var ri=We.concat(),mi=[];if(!yt||yt&&!Kt.test(yt))return ri;yt.replace($t,function(Li){var Ue=new RegExp(At).exec(Li).filter(function(si){return!!si}),ge=Ue[1],Rt=Ue.slice(2).map(parseFloat);switch(ge){case"translate":ke(ri,Rt);break;case"rotate":Rt[0]=l.util.degreesToRadians(Rt[0]),re(ri,Rt);break;case"scale":te(ri,Rt);break;case"skewX":we(ri,Rt,2);break;case"skewY":we(ri,Rt,1);break;case"matrix":ri=Rt;break}mi.push(ri.concat()),ri=We.concat()});for(var xi=mi[0];mi.length>1;)mi.shift(),xi=l.util.multiplyTransformMatrices(xi,mi[0]);return xi}}();function _e(re,te){var we,ke;re.replace(/;\s*$/,"").split(";").forEach(function(We){var qe=We.split(":");we=qe[0].trim().toLowerCase(),ke=qe[1].trim(),te[we]=ke})}function pe(re,te){var we,ke;for(var We in re)typeof re[We]>"u"||(we=We.toLowerCase(),ke=re[We],te[we]=ke)}function ze(re,te){var we={};for(var ke in l.cssRules[te])if(De(re,ke.split(" ")))for(var We in l.cssRules[te][ke])we[We]=l.cssRules[te][ke][We];return we}function De(re,te){var we,ke=!0;return we=ft(re,te.pop()),we&&te.length&&(ke=at(re,te)),we&&ke&&te.length===0}function at(re,te){for(var we,ke=!0;re.parentNode&&re.parentNode.nodeType===1&&te.length;)ke&&(we=te.pop()),re=re.parentNode,ke=ft(re,we);return te.length===0}function ft(re,te){var we=re.nodeName,ke=re.getAttribute("class"),We=re.getAttribute("id"),qe,gt;if(qe=new RegExp("^"+we,"i"),te=te.replace(qe,""),We&&te.length&&(qe=new RegExp("#"+We+"(?![a-zA-Z\\-]+)","i"),te=te.replace(qe,"")),ke&&te.length)for(ke=ke.split(" "),gt=ke.length;gt--;)qe=new RegExp("\\."+ke[gt]+"(?![a-zA-Z\\-]+)","i"),te=te.replace(qe,"");return te.length===0}function xt(re,te){var we;if(re.getElementById&&(we=re.getElementById(te)),we)return we;var ke,We,qe,gt=re.getElementsByTagName("*");for(We=0,qe=gt.length;We<qe;We++)if(ke=gt[We],te===ke.getAttribute("id"))return ke}function He(re){for(var te=ot(re,["use","svg:use"]),we=0;te.length&&we<te.length;){var ke=te[we],We=ke.getAttribute("xlink:href")||ke.getAttribute("href");if(We===null)return;var qe=We.slice(1),gt=ke.getAttribute("x")||0,lt=ke.getAttribute("y")||0,Bt=xt(re,qe).cloneNode(!0),ht=(Bt.getAttribute("transform")||"")+" translate("+gt+", "+lt+")",ct,Xe=te.length,Se,At,Et,wt,Kt=l.svgNS;if(Te(Bt),/^svg$/i.test(Bt.nodeName)){var $t=Bt.ownerDocument.createElementNS(Kt,"g");for(At=0,Et=Bt.attributes,wt=Et.length;At<wt;At++)Se=Et.item(At),$t.setAttributeNS(Kt,Se.nodeName,Se.nodeValue);for(;Bt.firstChild;)$t.appendChild(Bt.firstChild);Bt=$t}for(At=0,Et=ke.attributes,wt=Et.length;At<wt;At++)Se=Et.item(At),!(Se.nodeName==="x"||Se.nodeName==="y"||Se.nodeName==="xlink:href"||Se.nodeName==="href")&&(Se.nodeName==="transform"?ht=Se.nodeValue+" "+ht:Bt.setAttribute(Se.nodeName,Se.nodeValue));Bt.setAttribute("transform",ht),Bt.setAttribute("instantiated_by_use","1"),Bt.removeAttribute("id"),ct=ke.parentNode,ct.replaceChild(Bt,ke),te.length===Xe&&we++}}var ae=new RegExp("^\\s*("+l.reNum+"+)\\s*,?\\s*("+l.reNum+"+)\\s*,?\\s*("+l.reNum+"+)\\s*,?\\s*("+l.reNum+"+)\\s*$");function Te(re){if(!l.svgViewBoxElementsRegEx.test(re.nodeName))return{};var te=re.getAttribute("viewBox"),we=1,ke=1,We=0,qe=0,gt,lt,Bt,ht,ct=re.getAttribute("width"),Xe=re.getAttribute("height"),Se=re.getAttribute("x")||0,At=re.getAttribute("y")||0,Et=re.getAttribute("preserveAspectRatio")||"",wt=!te||!(te=te.match(ae)),Kt=!ct||!Xe||ct==="100%"||Xe==="100%",$t=wt&&Kt,yt={},ri="",mi=0,xi=0;if(yt.width=0,yt.height=0,yt.toBeParsed=$t,wt&&(Se||At)&&re.parentNode&&re.parentNode.nodeName!=="#document"&&(ri=" translate("+m(Se)+" "+m(At)+") ",Bt=(re.getAttribute("transform")||"")+ri,re.setAttribute("transform",Bt),re.removeAttribute("x"),re.removeAttribute("y")),$t)return yt;if(wt)return yt.width=m(ct),yt.height=m(Xe),yt;if(We=-parseFloat(te[1]),qe=-parseFloat(te[2]),gt=parseFloat(te[3]),lt=parseFloat(te[4]),yt.minX=We,yt.minY=qe,yt.viewBoxWidth=gt,yt.viewBoxHeight=lt,Kt?(yt.width=gt,yt.height=lt):(yt.width=m(ct),yt.height=m(Xe),we=yt.width/gt,ke=yt.height/lt),Et=l.util.parsePreserveAspectRatioAttribute(Et),Et.alignX!=="none"&&(Et.meetOrSlice==="meet"&&(ke=we=we>ke?ke:we),Et.meetOrSlice==="slice"&&(ke=we=we>ke?we:ke),mi=yt.width-gt*we,xi=yt.height-lt*we,Et.alignX==="Mid"&&(mi/=2),Et.alignY==="Mid"&&(xi/=2),Et.alignX==="Min"&&(mi=0),Et.alignY==="Min"&&(xi=0)),we===1&&ke===1&&We===0&&qe===0&&Se===0&&At===0)return yt;if((Se||At)&&re.parentNode.nodeName!=="#document"&&(ri=" translate("+m(Se)+" "+m(At)+") "),Bt=ri+" matrix("+we+" 0 0 "+ke+" "+(We*we+mi)+" "+(qe*ke+xi)+") ",re.nodeName==="svg"){for(ht=re.ownerDocument.createElementNS(l.svgNS,"g");re.firstChild;)ht.appendChild(re.firstChild);re.appendChild(ht)}else ht=re,ht.removeAttribute("x"),ht.removeAttribute("y"),Bt=ht.getAttribute("transform")+Bt;return ht.setAttribute("transform",Bt),yt}function Oe(re,te){for(;re&&(re=re.parentNode);)if(re.nodeName&&te.test(re.nodeName.replace("svg:",""))&&!re.getAttribute("instantiated_by_use"))return!0;return!1}l.parseSVGDocument=function(re,te,we,ke){if(re){He(re);var We=l.Object.__uid++,qe,gt,lt=Te(re),Bt=l.util.toArray(re.getElementsByTagName("*"));if(lt.crossOrigin=ke&&ke.crossOrigin,lt.svgUid=We,Bt.length===0&&l.isLikelyNode){Bt=re.selectNodes('//*[name(.)!="svg"]');var ht=[];for(qe=0,gt=Bt.length;qe<gt;qe++)ht[qe]=Bt[qe];Bt=ht}var ct=Bt.filter(function(Se){return Te(Se),l.svgValidTagNamesRegEx.test(Se.nodeName.replace("svg:",""))&&!Oe(Se,l.svgInvalidAncestorsRegEx)});if(!ct||ct&&!ct.length){te&&te([],{});return}var Xe={};Bt.filter(function(Se){return Se.nodeName.replace("svg:","")==="clipPath"}).forEach(function(Se){var At=Se.getAttribute("id");Xe[At]=l.util.toArray(Se.getElementsByTagName("*")).filter(function(Et){return l.svgValidTagNamesRegEx.test(Et.nodeName.replace("svg:",""))})}),l.gradientDefs[We]=l.getGradientDefs(re),l.cssRules[We]=l.getCSSRules(re),l.clipPaths[We]=Xe,l.parseElements(ct,function(Se,At){te&&(te(Se,lt,At,Bt),delete l.gradientDefs[We],delete l.cssRules[We],delete l.clipPaths[We])},x(lt),we,ke)}};function Y(re,te){var we=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],ke="xlink:href",We=te.getAttribute(ke).slice(1),qe=xt(re,We);if(qe&&qe.getAttribute(ke)&&Y(re,qe),we.forEach(function(lt){qe&&!te.hasAttribute(lt)&&qe.hasAttribute(lt)&&te.setAttribute(lt,qe.getAttribute(lt))}),!te.children.length)for(var gt=qe.cloneNode(!0);gt.firstChild;)te.appendChild(gt.firstChild);te.removeAttribute(ke)}var ce=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+l.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+l.reNum+"))?\\s+(.*)");v(l,{parseFontDeclaration:function(re,te){var we=re.match(ce);if(we){var ke=we[1],We=we[3],qe=we[4],gt=we[5],lt=we[6];ke&&(te.fontStyle=ke),We&&(te.fontWeight=isNaN(parseFloat(We))?We:parseFloat(We)),qe&&(te.fontSize=m(qe)),lt&&(te.fontFamily=lt),gt&&(te.lineHeight=gt==="normal"?1:gt)}},getGradientDefs:function(re){var te=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],we=ot(re,te),ke,We=0,qe={};for(We=we.length;We--;)ke=we[We],ke.getAttribute("xlink:href")&&Y(re,ke),qe[ke.getAttribute("id")]=ke;return qe},parseAttributes:function(re,te,we){if(re){var ke,We={},qe,gt;typeof we>"u"&&(we=re.getAttribute("svgUid")),re.parentNode&&l.svgValidParentsRegEx.test(re.parentNode.nodeName)&&(We=l.parseAttributes(re.parentNode,te,we));var lt=te.reduce(function(Et,wt){return ke=re.getAttribute(wt),ke&&(Et[wt]=ke),Et},{}),Bt=v(ze(re,we),l.parseStyleAttribute(re));lt=v(lt,Bt),Bt[K]&&re.setAttribute(K,Bt[K]),qe=gt=We.fontSize||l.Text.DEFAULT_SVG_FONT_SIZE,lt[q]&&(lt[q]=qe=m(lt[q],gt));var ht,ct,Xe={};for(var Se in lt)ht=se(Se),ct=he(ht,lt[Se],We,qe),Xe[ht]=ct;Xe&&Xe.font&&l.parseFontDeclaration(Xe.font,Xe);var At=v(We,Xe);return l.svgValidParentsRegEx.test(re.nodeName)?At:ve(At)}},parseElements:function(re,te,we,ke,We){new l.ElementsParser(re,te,we,ke,We).parse()},parseStyleAttribute:function(re){var te={},we=re.getAttribute("style");return we&&(typeof we=="string"?_e(we,te):pe(we,te)),te},parsePointsAttribute:function(re){if(!re)return null;re=re.replace(/,/g," ").trim(),re=re.split(/\s+/);var te=[],we,ke;for(we=0,ke=re.length;we<ke;we+=2)te.push({x:parseFloat(re[we]),y:parseFloat(re[we+1])});return te},getCSSRules:function(re){var te=re.getElementsByTagName("style"),we,ke,We={},qe;for(we=0,ke=te.length;we<ke;we++){var gt=te[we].textContent;gt=gt.replace(/\/\*[\s\S]*?\*\//g,""),gt.trim()!==""&&(qe=gt.split("}"),qe=qe.filter(function(lt){return lt.trim()}),qe.forEach(function(lt){var Bt=lt.split("{"),ht={},ct=Bt[1].trim(),Xe=ct.split(";").filter(function(wt){return wt.trim()});for(we=0,ke=Xe.length;we<ke;we++){var Se=Xe[we].split(":"),At=Se[0].trim(),Et=Se[1].trim();ht[At]=Et}lt=Bt[0].trim(),lt.split(",").forEach(function(wt){wt=wt.replace(/^svg/i,"").trim(),wt!==""&&(We[wt]?l.util.object.extend(We[wt],ht):We[wt]=l.util.object.clone(ht))})}))}return We},loadSVGFromURL:function(re,te,we,ke){re=re.replace(/^\n\s*/,"").trim(),new l.util.request(re,{method:"get",onComplete:We});function We(qe){var gt=qe.responseXML;if(!gt||!gt.documentElement)return te&&te(null),!1;l.parseSVGDocument(gt.documentElement,function(lt,Bt,ht,ct){te&&te(lt,Bt,ht,ct)},we,ke)}},loadSVGFromString:function(re,te,we,ke){var We=new l.window.DOMParser,qe=We.parseFromString(re.trim(),"text/xml");l.parseSVGDocument(qe.documentElement,function(gt,lt,Bt,ht){te(gt,lt,Bt,ht)},we,ke)}})}(M),f.ElementsParser=function(t,l,v,x,d,m){this.elements=t,this.callback=l,this.options=v,this.reviver=x,this.svgUid=v&&v.svgUid||0,this.parsingOptions=d,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=m},function(t){t.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},t.createObjects=function(){var l=this;this.elements.forEach(function(v,x){v.setAttribute("svgUid",l.svgUid),l.createObject(v,x)})},t.findTag=function(l){return f[f.util.string.capitalize(l.tagName.replace("svg:",""))]},t.createObject=function(l,v){var x=this.findTag(l);if(x&&x.fromElement)try{x.fromElement(l,this.createCallback(v,l),this.options)}catch(d){f.log(d)}else this.checkIfDone()},t.createCallback=function(l,v){var x=this;return function(d){var m;x.resolveGradient(d,v,"fill"),x.resolveGradient(d,v,"stroke"),d instanceof f.Image&&d._originalElement&&(m=d.parsePreserveAspectRatioAttribute(v)),d._removeTransformMatrix(m),x.resolveClipPath(d,v),x.reviver&&x.reviver(v,d),x.instances[l]=d,x.checkIfDone()}},t.extractPropertyDefinition=function(l,v,x){var d=l[v],m=this.regexUrl;if(m.test(d)){m.lastIndex=0;var c=m.exec(d)[1];return m.lastIndex=0,f[x][this.svgUid][c]}},t.resolveGradient=function(l,v,x){var d=this.extractPropertyDefinition(l,x,"gradientDefs");if(d){var m=v.getAttribute(x+"-opacity"),c=f.Gradient.fromElement(d,l,m,this.options);l.set(x,c)}},t.createClipPathCallback=function(l,v){return function(x){x._removeTransformMatrix(),x.fillRule=x.clipRule,v.push(x)}},t.resolveClipPath=function(l,v){var x=this.extractPropertyDefinition(l,"clipPath","clipPaths"),d,m,c,_,w,g;if(x){_=[],c=f.util.invertTransform(l.calcTransformMatrix());for(var C=x[0].parentNode,L=v;L.parentNode&&L.getAttribute("clip-path")!==l.clipPath;)L=L.parentNode;L.parentNode.appendChild(C);for(var B=0;B<x.length;B++)d=x[B],m=this.findTag(d),m.fromElement(d,this.createClipPathCallback(l,_),this.options);_.length===1?x=_[0]:x=new f.Group(_),w=f.util.multiplyTransformMatrices(c,x.calcTransformMatrix()),x.clipPath&&this.resolveClipPath(x,L);var g=f.util.qrDecompose(w);x.flipX=!1,x.flipY=!1,x.set("scaleX",g.scaleX),x.set("scaleY",g.scaleY),x.angle=g.angle,x.skewX=g.skewX,x.skewY=0,x.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),l.clipPath=x}else delete l.clipPath},t.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(l){return l!=null}),this.callback(this.instances,this.elements))}}(f.ElementsParser.prototype),function(t){var l=t.fabric||(t.fabric={});if(l.Point){l.warn("fabric.Point is already defined");return}l.Point=v;function v(x,d){this.x=x,this.y=d}v.prototype={type:"point",constructor:v,add:function(x){return new v(this.x+x.x,this.y+x.y)},addEquals:function(x){return this.x+=x.x,this.y+=x.y,this},scalarAdd:function(x){return new v(this.x+x,this.y+x)},scalarAddEquals:function(x){return this.x+=x,this.y+=x,this},subtract:function(x){return new v(this.x-x.x,this.y-x.y)},subtractEquals:function(x){return this.x-=x.x,this.y-=x.y,this},scalarSubtract:function(x){return new v(this.x-x,this.y-x)},scalarSubtractEquals:function(x){return this.x-=x,this.y-=x,this},multiply:function(x){return new v(this.x*x,this.y*x)},multiplyEquals:function(x){return this.x*=x,this.y*=x,this},divide:function(x){return new v(this.x/x,this.y/x)},divideEquals:function(x){return this.x/=x,this.y/=x,this},eq:function(x){return this.x===x.x&&this.y===x.y},lt:function(x){return this.x<x.x&&this.y<x.y},lte:function(x){return this.x<=x.x&&this.y<=x.y},gt:function(x){return this.x>x.x&&this.y>x.y},gte:function(x){return this.x>=x.x&&this.y>=x.y},lerp:function(x,d){return typeof d>"u"&&(d=.5),d=Math.max(Math.min(1,d),0),new v(this.x+(x.x-this.x)*d,this.y+(x.y-this.y)*d)},distanceFrom:function(x){var d=this.x-x.x,m=this.y-x.y;return Math.sqrt(d*d+m*m)},midPointFrom:function(x){return this.lerp(x)},min:function(x){return new v(Math.min(this.x,x.x),Math.min(this.y,x.y))},max:function(x){return new v(Math.max(this.x,x.x),Math.max(this.y,x.y))},toString:function(){return this.x+","+this.y},setXY:function(x,d){return this.x=x,this.y=d,this},setX:function(x){return this.x=x,this},setY:function(x){return this.y=x,this},setFromPoint:function(x){return this.x=x.x,this.y=x.y,this},swap:function(x){var d=this.x,m=this.y;this.x=x.x,this.y=x.y,x.x=d,x.y=m},clone:function(){return new v(this.x,this.y)}}}(M),function(t){var l=t.fabric||(t.fabric={});if(l.Intersection){l.warn("fabric.Intersection is already defined");return}function v(x){this.status=x,this.points=[]}l.Intersection=v,l.Intersection.prototype={constructor:v,appendPoint:function(x){return this.points.push(x),this},appendPoints:function(x){return this.points=this.points.concat(x),this}},l.Intersection.intersectLineLine=function(x,d,m,c){var _,w=(c.x-m.x)*(x.y-m.y)-(c.y-m.y)*(x.x-m.x),g=(d.x-x.x)*(x.y-m.y)-(d.y-x.y)*(x.x-m.x),C=(c.y-m.y)*(d.x-x.x)-(c.x-m.x)*(d.y-x.y);if(C!==0){var L=w/C,B=g/C;0<=L&&L<=1&&0<=B&&B<=1?(_=new v("Intersection"),_.appendPoint(new l.Point(x.x+L*(d.x-x.x),x.y+L*(d.y-x.y)))):_=new v}else w===0||g===0?_=new v("Coincident"):_=new v("Parallel");return _},l.Intersection.intersectLinePolygon=function(x,d,m){var c=new v,_=m.length,w,g,C,L;for(L=0;L<_;L++)w=m[L],g=m[(L+1)%_],C=v.intersectLineLine(x,d,w,g),c.appendPoints(C.points);return c.points.length>0&&(c.status="Intersection"),c},l.Intersection.intersectPolygonPolygon=function(x,d){var m=new v,c=x.length,_;for(_=0;_<c;_++){var w=x[_],g=x[(_+1)%c],C=v.intersectLinePolygon(w,g,d);m.appendPoints(C.points)}return m.points.length>0&&(m.status="Intersection"),m},l.Intersection.intersectPolygonRectangle=function(x,d,m){var c=d.min(m),_=d.max(m),w=new l.Point(_.x,c.y),g=new l.Point(c.x,_.y),C=v.intersectLinePolygon(c,w,x),L=v.intersectLinePolygon(w,_,x),B=v.intersectLinePolygon(_,g,x),q=v.intersectLinePolygon(g,c,x),K=new v;return K.appendPoints(C.points),K.appendPoints(L.points),K.appendPoints(B.points),K.appendPoints(q.points),K.points.length>0&&(K.status="Intersection"),K}}(M),function(t){var l=t.fabric||(t.fabric={});if(l.Color){l.warn("fabric.Color is already defined.");return}function v(d){d?this._tryParsingColor(d):this.setSource([0,0,0,1])}l.Color=v,l.Color.prototype={_tryParsingColor:function(d){var m;d in v.colorNameMap&&(d=v.colorNameMap[d]),d==="transparent"&&(m=[255,255,255,0]),m||(m=v.sourceFromHex(d)),m||(m=v.sourceFromRgb(d)),m||(m=v.sourceFromHsl(d)),m||(m=[0,0,0,1]),m&&this.setSource(m)},_rgbToHsl:function(d,m,c){d/=255,m/=255,c/=255;var _,w,g,C=l.util.array.max([d,m,c]),L=l.util.array.min([d,m,c]);if(g=(C+L)/2,C===L)_=w=0;else{var B=C-L;switch(w=g>.5?B/(2-C-L):B/(C+L),C){case d:_=(m-c)/B+(m<c?6:0);break;case m:_=(c-d)/B+2;break;case c:_=(d-m)/B+4;break}_/=6}return[Math.round(_*360),Math.round(w*100),Math.round(g*100)]},getSource:function(){return this._source},setSource:function(d){this._source=d},toRgb:function(){var d=this.getSource();return"rgb("+d[0]+","+d[1]+","+d[2]+")"},toRgba:function(){var d=this.getSource();return"rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")"},toHsl:function(){var d=this.getSource(),m=this._rgbToHsl(d[0],d[1],d[2]);return"hsl("+m[0]+","+m[1]+"%,"+m[2]+"%)"},toHsla:function(){var d=this.getSource(),m=this._rgbToHsl(d[0],d[1],d[2]);return"hsla("+m[0]+","+m[1]+"%,"+m[2]+"%,"+d[3]+")"},toHex:function(){var d=this.getSource(),m,c,_;return m=d[0].toString(16),m=m.length===1?"0"+m:m,c=d[1].toString(16),c=c.length===1?"0"+c:c,_=d[2].toString(16),_=_.length===1?"0"+_:_,m.toUpperCase()+c.toUpperCase()+_.toUpperCase()},toHexa:function(){var d=this.getSource(),m;return m=Math.round(d[3]*255),m=m.toString(16),m=m.length===1?"0"+m:m,this.toHex()+m.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(d){var m=this.getSource();return m[3]=d,this.setSource(m),this},toGrayscale:function(){var d=this.getSource(),m=parseInt((d[0]*.3+d[1]*.59+d[2]*.11).toFixed(0),10),c=d[3];return this.setSource([m,m,m,c]),this},toBlackWhite:function(d){var m=this.getSource(),c=(m[0]*.3+m[1]*.59+m[2]*.11).toFixed(0),_=m[3];return d=d||127,c=Number(c)<Number(d)?0:255,this.setSource([c,c,c,_]),this},overlayWith:function(d){d instanceof v||(d=new v(d));var m=[],c=this.getAlpha(),_=.5,w=this.getSource(),g=d.getSource(),C;for(C=0;C<3;C++)m.push(Math.round(w[C]*(1-_)+g[C]*_));return m[3]=c,this.setSource(m),this}},l.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,l.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,l.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,l.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function x(d,m,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?d+(m-d)*6*c:c<1/2?m:c<2/3?d+(m-d)*(2/3-c)*6:d}l.Color.fromRgb=function(d){return v.fromSource(v.sourceFromRgb(d))},l.Color.sourceFromRgb=function(d){var m=d.match(v.reRGBa);if(m){var c=parseInt(m[1],10)/(/%$/.test(m[1])?100:1)*(/%$/.test(m[1])?255:1),_=parseInt(m[2],10)/(/%$/.test(m[2])?100:1)*(/%$/.test(m[2])?255:1),w=parseInt(m[3],10)/(/%$/.test(m[3])?100:1)*(/%$/.test(m[3])?255:1);return[parseInt(c,10),parseInt(_,10),parseInt(w,10),m[4]?parseFloat(m[4]):1]}},l.Color.fromRgba=v.fromRgb,l.Color.fromHsl=function(d){return v.fromSource(v.sourceFromHsl(d))},l.Color.sourceFromHsl=function(d){var m=d.match(v.reHSLa);if(m){var c=(parseFloat(m[1])%360+360)%360/360,_=parseFloat(m[2])/(/%$/.test(m[2])?100:1),w=parseFloat(m[3])/(/%$/.test(m[3])?100:1),g,C,L;if(_===0)g=C=L=w;else{var B=w<=.5?w*(_+1):w+_-w*_,q=w*2-B;g=x(q,B,c+1/3),C=x(q,B,c),L=x(q,B,c-1/3)}return[Math.round(g*255),Math.round(C*255),Math.round(L*255),m[4]?parseFloat(m[4]):1]}},l.Color.fromHsla=v.fromHsl,l.Color.fromHex=function(d){return v.fromSource(v.sourceFromHex(d))},l.Color.sourceFromHex=function(d){if(d.match(v.reHex)){var m=d.slice(d.indexOf("#")+1),c=m.length===3||m.length===4,_=m.length===8||m.length===4,w=c?m.charAt(0)+m.charAt(0):m.substring(0,2),g=c?m.charAt(1)+m.charAt(1):m.substring(2,4),C=c?m.charAt(2)+m.charAt(2):m.substring(4,6),L=_?c?m.charAt(3)+m.charAt(3):m.substring(6,8):"FF";return[parseInt(w,16),parseInt(g,16),parseInt(C,16),parseFloat((parseInt(L,16)/255).toFixed(2))]}},l.Color.fromSource=function(d){var m=new v;return m.setSource(d),m}}(M),function(t){var l=t.fabric||(t.fabric={}),v=["e","se","s","sw","w","nw","n","ne","e"],x=["ns","nesw","ew","nwse"],d={},m="left",c="top",_="right",w="bottom",g="center",C={top:w,bottom:c,left:_,right:m,center:g},L=l.util.radiansToDegrees,B=Math.sign||function(ht){return(ht>0)-(ht<0)||+ht};function q(ht,ct){var Xe=ht.angle+L(Math.atan2(ct.y,ct.x))+360;return Math.round(Xe%360/45)}function K(ht,ct){var Xe=ct.transform.target,Se=Xe.canvas,At=l.util.object.clone(ct);At.target=Xe,Se&&Se.fire("object:"+ht,At),Xe.fire(ht,ct)}function se(ht,ct){var Xe=ct.canvas,Se=Xe.uniScaleKey,At=ht[Se];return Xe.uniformScaling&&!At||!Xe.uniformScaling&&At}function he(ht){return ht.originX===g&&ht.originY===g}function le(ht,ct,Xe){var Se=ht.lockScalingX,At=ht.lockScalingY;return!!(Se&&At||!ct&&(Se||At)&&Xe||Se&&ct==="x"||At&&ct==="y")}function ve(ht,ct,Xe){var Se="not-allowed",At=se(ht,Xe),Et="";if(ct.x!==0&&ct.y===0?Et="x":ct.x===0&&ct.y!==0&&(Et="y"),le(Xe,Et,At))return Se;var wt=q(Xe,ct);return v[wt]+"-resize"}function ot(ht,ct,Xe){var Se="not-allowed";if(ct.x!==0&&Xe.lockSkewingY||ct.y!==0&&Xe.lockSkewingX)return Se;var At=q(Xe,ct)%4;return x[At]+"-resize"}function _e(ht,ct,Xe){return ht[Xe.canvas.altActionKey]?d.skewCursorStyleHandler(ht,ct,Xe):d.scaleCursorStyleHandler(ht,ct,Xe)}function pe(ht,ct,Xe){var Se=ht[Xe.canvas.altActionKey];if(ct.x===0)return Se?"skewX":"scaleY";if(ct.y===0)return Se?"skewY":"scaleX"}function ze(ht,ct,Xe){return Xe.lockRotation?"not-allowed":ct.cursorStyle}function De(ht,ct,Xe,Se){return{e:ht,transform:ct,pointer:{x:Xe,y:Se}}}function at(ht){return function(ct,Xe,Se,At){var Et=Xe.target,wt=Et.getCenterPoint(),Kt=Et.translateToOriginPoint(wt,Xe.originX,Xe.originY),$t=ht(ct,Xe,Se,At);return Et.setPositionByOrigin(Kt,Xe.originX,Xe.originY),$t}}function ft(ht,ct){return function(Xe,Se,At,Et){var wt=ct(Xe,Se,At,Et);return wt&&K(ht,De(Xe,Se,At,Et)),wt}}function xt(ht,ct,Xe,Se,At){var Et=ht.target,wt=Et.controls[ht.corner],Kt=Et.canvas.getZoom(),$t=Et.padding/Kt,yt=Et.toLocalPoint(new l.Point(Se,At),ct,Xe);return yt.x>=$t&&(yt.x-=$t),yt.x<=-$t&&(yt.x+=$t),yt.y>=$t&&(yt.y-=$t),yt.y<=$t&&(yt.y+=$t),yt.x-=wt.offsetX,yt.y-=wt.offsetY,yt}function He(ht){return ht.flipX!==ht.flipY}function ae(ht,ct,Xe,Se,At){if(ht[ct]!==0){var Et=ht._getTransformedDimensions()[Se],wt=At/Et*ht[Xe];ht.set(Xe,wt)}}function Te(ht,ct,Xe,Se){var At=ct.target,Et=At._getTransformedDimensions(0,At.skewY),wt=xt(ct,ct.originX,ct.originY,Xe,Se),Kt=Math.abs(wt.x*2)-Et.x,$t=At.skewX,yt;Kt<2?yt=0:(yt=L(Math.atan2(Kt/At.scaleX,Et.y/At.scaleY)),ct.originX===m&&ct.originY===w&&(yt=-yt),ct.originX===_&&ct.originY===c&&(yt=-yt),He(At)&&(yt=-yt));var ri=$t!==yt;if(ri){var mi=At._getTransformedDimensions().y;At.set("skewX",yt),ae(At,"skewY","scaleY","y",mi)}return ri}function Oe(ht,ct,Xe,Se){var At=ct.target,Et=At._getTransformedDimensions(At.skewX,0),wt=xt(ct,ct.originX,ct.originY,Xe,Se),Kt=Math.abs(wt.y*2)-Et.y,$t=At.skewY,yt;Kt<2?yt=0:(yt=L(Math.atan2(Kt/At.scaleY,Et.x/At.scaleX)),ct.originX===m&&ct.originY===w&&(yt=-yt),ct.originX===_&&ct.originY===c&&(yt=-yt),He(At)&&(yt=-yt));var ri=$t!==yt;if(ri){var mi=At._getTransformedDimensions().x;At.set("skewY",yt),ae(At,"skewX","scaleX","x",mi)}return ri}function Y(ht,ct,Xe,Se){var At=ct.target,Et=At.skewX,wt,Kt=ct.originY;if(At.lockSkewingX)return!1;if(Et===0){var $t=xt(ct,g,g,Xe,Se);$t.x>0?wt=m:wt=_}else Et>0&&(wt=Kt===c?m:_),Et<0&&(wt=Kt===c?_:m),He(At)&&(wt=wt===m?_:m);ct.originX=wt;var yt=ft("skewing",at(Te));return yt(ht,ct,Xe,Se)}function ce(ht,ct,Xe,Se){var At=ct.target,Et=At.skewY,wt,Kt=ct.originX;if(At.lockSkewingY)return!1;if(Et===0){var $t=xt(ct,g,g,Xe,Se);$t.y>0?wt=c:wt=w}else Et>0&&(wt=Kt===m?c:w),Et<0&&(wt=Kt===m?w:c),He(At)&&(wt=wt===c?w:c);ct.originY=wt;var yt=ft("skewing",at(Oe));return yt(ht,ct,Xe,Se)}function re(ht,ct,Xe,Se){var At=ct,Et=At.target,wt=Et.translateToOriginPoint(Et.getCenterPoint(),At.originX,At.originY);if(Et.lockRotation)return!1;var Kt=Math.atan2(At.ey-wt.y,At.ex-wt.x),$t=Math.atan2(Se-wt.y,Xe-wt.x),yt=L($t-Kt+At.theta),ri=!0;if(Et.snapAngle>0){var mi=Et.snapAngle,xi=Et.snapThreshold||mi,Li=Math.ceil(yt/mi)*mi,Ue=Math.floor(yt/mi)*mi;Math.abs(yt-Ue)<xi?yt=Ue:Math.abs(yt-Li)<xi&&(yt=Li)}return yt<0&&(yt=360+yt),yt%=360,ri=Et.angle!==yt,Et.angle=yt,ri}function te(ht,ct,Xe,Se,At){At=At||{};var Et=ct.target,wt=Et.lockScalingX,Kt=Et.lockScalingY,$t=At.by,yt,ri,mi,xi,Li=se(ht,Et),Ue=le(Et,$t,Li),ge,Rt,si=ct.gestureScale;if(Ue)return!1;if(si)ri=ct.scaleX*si,mi=ct.scaleY*si;else{if(yt=xt(ct,ct.originX,ct.originY,Xe,Se),ge=$t!=="y"?B(yt.x):1,Rt=$t!=="x"?B(yt.y):1,ct.signX||(ct.signX=ge),ct.signY||(ct.signY=Rt),Et.lockScalingFlip&&(ct.signX!==ge||ct.signY!==Rt))return!1;if(xi=Et._getTransformedDimensions(),Li&&!$t){var jt=Math.abs(yt.x)+Math.abs(yt.y),Ii=ct.original,wi=Math.abs(xi.x*Ii.scaleX/Et.scaleX)+Math.abs(xi.y*Ii.scaleY/Et.scaleY),or=jt/wi;ri=Ii.scaleX*or,mi=Ii.scaleY*or}else ri=Math.abs(yt.x*Et.scaleX/xi.x),mi=Math.abs(yt.y*Et.scaleY/xi.y);he(ct)&&(ri*=2,mi*=2),ct.signX!==ge&&$t!=="y"&&(ct.originX=C[ct.originX],ri*=-1,ct.signX=ge),ct.signY!==Rt&&$t!=="x"&&(ct.originY=C[ct.originY],mi*=-1,ct.signY=Rt)}var Ti=Et.scaleX,Yi=Et.scaleY;return $t?($t==="x"&&Et.set("scaleX",ri),$t==="y"&&Et.set("scaleY",mi)):(!wt&&Et.set("scaleX",ri),!Kt&&Et.set("scaleY",mi)),Ti!==Et.scaleX||Yi!==Et.scaleY}function we(ht,ct,Xe,Se){return te(ht,ct,Xe,Se)}function ke(ht,ct,Xe,Se){return te(ht,ct,Xe,Se,{by:"x"})}function We(ht,ct,Xe,Se){return te(ht,ct,Xe,Se,{by:"y"})}function qe(ht,ct,Xe,Se){return ht[ct.target.canvas.altActionKey]?d.skewHandlerX(ht,ct,Xe,Se):d.scalingY(ht,ct,Xe,Se)}function gt(ht,ct,Xe,Se){return ht[ct.target.canvas.altActionKey]?d.skewHandlerY(ht,ct,Xe,Se):d.scalingX(ht,ct,Xe,Se)}function lt(ht,ct,Xe,Se){var At=ct.target,Et=xt(ct,ct.originX,ct.originY,Xe,Se),wt=At.strokeWidth/(At.strokeUniform?At.scaleX:1),Kt=he(ct)?2:1,$t=At.width,yt=Math.abs(Et.x*Kt/At.scaleX)-wt;return At.set("width",Math.max(yt,0)),$t!==yt}function Bt(ht,ct,Xe,Se){var At=ct.target,Et=Xe-ct.offsetX,wt=Se-ct.offsetY,Kt=!At.get("lockMovementX")&&At.left!==Et,$t=!At.get("lockMovementY")&&At.top!==wt;return Kt&&At.set("left",Et),$t&&At.set("top",wt),(Kt||$t)&&K("moving",De(ht,ct,Xe,Se)),Kt||$t}d.scaleCursorStyleHandler=ve,d.skewCursorStyleHandler=ot,d.scaleSkewCursorStyleHandler=_e,d.rotationWithSnapping=ft("rotating",at(re)),d.scalingEqually=ft("scaling",at(we)),d.scalingX=ft("scaling",at(ke)),d.scalingY=ft("scaling",at(We)),d.scalingYOrSkewingX=qe,d.scalingXOrSkewingY=gt,d.changeWidth=ft("resizing",at(lt)),d.skewHandlerX=Y,d.skewHandlerY=ce,d.dragHandler=Bt,d.scaleOrSkewActionName=pe,d.rotationStyleHandler=ze,d.fireEvent=K,d.wrapWithFixedAnchor=at,d.wrapWithFireEvent=ft,d.getLocalPoint=xt,l.controlsUtils=d}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.degreesToRadians,x=l.controlsUtils;function d(c,_,w,g,C){g=g||{};var L=this.sizeX||g.cornerSize||C.cornerSize,B=this.sizeY||g.cornerSize||C.cornerSize,q=typeof g.transparentCorners<"u"?g.transparentCorners:C.transparentCorners,K=q?"stroke":"fill",se=!q&&(g.cornerStrokeColor||C.cornerStrokeColor),he=_,le=w,ve;c.save(),c.fillStyle=g.cornerColor||C.cornerColor,c.strokeStyle=g.cornerStrokeColor||C.cornerStrokeColor,L>B?(ve=L,c.scale(1,B/L),le=w*L/B):B>L?(ve=B,c.scale(L/B,1),he=_*B/L):ve=L,c.lineWidth=1,c.beginPath(),c.arc(he,le,ve/2,0,2*Math.PI,!1),c[K](),se&&c.stroke(),c.restore()}function m(c,_,w,g,C){g=g||{};var L=this.sizeX||g.cornerSize||C.cornerSize,B=this.sizeY||g.cornerSize||C.cornerSize,q=typeof g.transparentCorners<"u"?g.transparentCorners:C.transparentCorners,K=q?"stroke":"fill",se=!q&&(g.cornerStrokeColor||C.cornerStrokeColor),he=L/2,le=B/2;c.save(),c.fillStyle=g.cornerColor||C.cornerColor,c.strokeStyle=g.cornerStrokeColor||C.cornerStrokeColor,c.lineWidth=1,c.translate(_,w),c.rotate(v(C.angle)),c[K+"Rect"](-he,-le,L,B),se&&c.strokeRect(-he,-le,L,B),c.restore()}x.renderCircleControl=d,x.renderSquareControl=m}(M),function(t){var l=t.fabric||(t.fabric={});function v(x){for(var d in x)this[d]=x[d]}l.Control=v,l.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(x,d){return d.cursorStyle},getActionName:function(x,d){return d.actionName},getVisibility:function(x,d){var m=x._controlsVisibility;return m&&typeof m[d]<"u"?m[d]:this.visible},setVisibility:function(x){this.visible=x},positionHandler:function(x,d){var m=l.util.transformPoint({x:this.x*x.x+this.offsetX,y:this.y*x.y+this.offsetY},d);return m},calcCornerCoords:function(x,d,m,c,_){var w,g,C,L,B=_?this.touchSizeX:this.sizeX,q=_?this.touchSizeY:this.sizeY;if(B&&q&&B!==q){var K=Math.atan2(q,B),se=Math.sqrt(B*B+q*q)/2,he=K-l.util.degreesToRadians(x),le=Math.PI/2-K-l.util.degreesToRadians(x);w=se*l.util.cos(he),g=se*l.util.sin(he),C=se*l.util.cos(le),L=se*l.util.sin(le)}else{var ve=B&&q?B:d;se=ve*.7071067812;var he=l.util.degreesToRadians(45-x);w=C=se*l.util.cos(he),g=L=se*l.util.sin(he)}return{tl:{x:m-L,y:c-C},tr:{x:m+w,y:c-g},bl:{x:m-w,y:c+g},br:{x:m+L,y:c+C}}},render:function(x,d,m,c,_){switch(c=c||{},c.cornerStyle||_.cornerStyle){case"circle":l.controlsUtils.renderCircleControl.call(this,x,d,m,c,_);break;default:l.controlsUtils.renderSquareControl.call(this,x,d,m,c,_)}}}}(M),function(){function t(m,c){var _=m.getAttribute("style"),w=m.getAttribute("offset")||0,g,C,L,B;if(w=parseFloat(w)/(/%$/.test(w)?100:1),w=w<0?0:w>1?1:w,_){var q=_.split(/\s*;\s*/);for(q[q.length-1]===""&&q.pop(),B=q.length;B--;){var K=q[B].split(/\s*:\s*/),se=K[0].trim(),he=K[1].trim();se==="stop-color"?g=he:se==="stop-opacity"&&(L=he)}}return g||(g=m.getAttribute("stop-color")||"rgb(0,0,0)"),L||(L=m.getAttribute("stop-opacity")),g=new f.Color(g),C=g.getAlpha(),L=isNaN(parseFloat(L))?1:parseFloat(L),L*=C*c,{offset:w,color:g.toRgb(),opacity:L}}function l(m){return{x1:m.getAttribute("x1")||0,y1:m.getAttribute("y1")||0,x2:m.getAttribute("x2")||"100%",y2:m.getAttribute("y2")||0}}function v(m){return{x1:m.getAttribute("fx")||m.getAttribute("cx")||"50%",y1:m.getAttribute("fy")||m.getAttribute("cy")||"50%",r1:0,x2:m.getAttribute("cx")||"50%",y2:m.getAttribute("cy")||"50%",r2:m.getAttribute("r")||"50%"}}var x=f.util.object.clone;f.Gradient=f.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(m){m||(m={}),m.coords||(m.coords={});var c,_=this;Object.keys(m).forEach(function(w){_[w]=m[w]}),this.id?this.id+="_"+f.Object.__uid++:this.id=f.Object.__uid++,c={x1:m.coords.x1||0,y1:m.coords.y1||0,x2:m.coords.x2||0,y2:m.coords.y2||0},this.type==="radial"&&(c.r1=m.coords.r1||0,c.r2=m.coords.r2||0),this.coords=c,this.colorStops=m.colorStops.slice()},addColorStop:function(m){for(var c in m){var _=new f.Color(m[c]);this.colorStops.push({offset:parseFloat(c),color:_.toRgb(),opacity:_.getAlpha()})}return this},toObject:function(m){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return f.util.populateWithProperties(this,c,m),c},toSVG:function(m,C){var _=x(this.coords,!0),w,g,C=C||{},L,B,q=x(this.colorStops,!0),K=_.r1>_.r2,se=this.gradientTransform?this.gradientTransform.concat():f.iMatrix.concat(),he=-this.offsetX,le=-this.offsetY,ve=!!C.additionalTransform,ot=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(q.sort(function(at,ft){return at.offset-ft.offset}),ot==="objectBoundingBox"?(he/=m.width,le/=m.height):(he+=m.width/2,le+=m.height/2),m.type==="path"&&this.gradientUnits!=="percentage"&&(he-=m.pathOffset.x,le-=m.pathOffset.y),se[4]-=he,se[5]-=le,B='id="SVGID_'+this.id+'" gradientUnits="'+ot+'"',B+=' gradientTransform="'+(ve?C.additionalTransform+" ":"")+f.util.matrixToSVG(se)+'" ',this.type==="linear"?L=["<linearGradient ",B,' x1="',_.x1,'" y1="',_.y1,'" x2="',_.x2,'" y2="',_.y2,`">
`]:this.type==="radial"&&(L=["<radialGradient ",B,' cx="',K?_.x1:_.x2,'" cy="',K?_.y1:_.y2,'" r="',K?_.r1:_.r2,'" fx="',K?_.x2:_.x1,'" fy="',K?_.y2:_.y1,`">
`]),this.type==="radial"){if(K)for(q=q.concat(),q.reverse(),w=0,g=q.length;w<g;w++)q[w].offset=1-q[w].offset;var _e=Math.min(_.r1,_.r2);if(_e>0){var pe=Math.max(_.r1,_.r2),ze=_e/pe;for(w=0,g=q.length;w<g;w++)q[w].offset+=ze*(1-q[w].offset)}}for(w=0,g=q.length;w<g;w++){var De=q[w];L.push("<stop ",'offset="',De.offset*100+"%",'" style="stop-color:',De.color,typeof De.opacity<"u"?";stop-opacity: "+De.opacity:";",`"/>
`)}return L.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),L.join("")},toLive:function(m){var c,_=f.util.object.clone(this.coords),w,g;if(this.type){for(this.type==="linear"?c=m.createLinearGradient(_.x1,_.y1,_.x2,_.y2):this.type==="radial"&&(c=m.createRadialGradient(_.x1,_.y1,_.r1,_.x2,_.y2,_.r2)),w=0,g=this.colorStops.length;w<g;w++){var C=this.colorStops[w].color,L=this.colorStops[w].opacity,B=this.colorStops[w].offset;typeof L<"u"&&(C=new f.Color(C).setAlpha(L).toRgba()),c.addColorStop(B,C)}return c}}}),f.util.object.extend(f.Gradient,{fromElement:function(m,c,_,w){var g=parseFloat(_)/(/%$/.test(_)?100:1);g=g<0?0:g>1?1:g,isNaN(g)&&(g=1);var C=m.getElementsByTagName("stop"),L,B=m.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",q=m.getAttribute("gradientTransform")||"",K=[],se,he,le=0,ve=0,ot;for(m.nodeName==="linearGradient"||m.nodeName==="LINEARGRADIENT"?(L="linear",se=l(m)):(L="radial",se=v(m)),he=C.length;he--;)K.push(t(C[he],g));ot=f.parseTransformAttribute(q),d(c,se,w,B),B==="pixels"&&(le=-c.left,ve=-c.top);var _e=new f.Gradient({id:m.getAttribute("id"),type:L,coords:se,colorStops:K,gradientUnits:B,gradientTransform:ot,offsetX:le,offsetY:ve});return _e}});function d(m,c,_,w){var g,C;Object.keys(c).forEach(function(L){g=c[L],g==="Infinity"?C=1:g==="-Infinity"?C=0:(C=parseFloat(c[L],10),typeof g=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(g)&&(C*=.01,w==="pixels"&&((L==="x1"||L==="x2"||L==="r2")&&(C*=_.viewBoxWidth||_.width),(L==="y1"||L==="y2")&&(C*=_.viewBoxHeight||_.height)))),c[L]=C})}}(),function(){var t=f.util.toFixed;f.Pattern=f.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(l,v){if(l||(l={}),this.id=f.Object.__uid++,this.setOptions(l),!l.source||l.source&&typeof l.source!="string"){v&&v(this);return}else{var x=this;this.source=f.util.createImage(),f.util.loadImage(l.source,function(d,m){x.source=d,v&&v(x,m)},null,this.crossOrigin)}},toObject:function(l){var v=f.Object.NUM_FRACTION_DIGITS,x,d;return typeof this.source.src=="string"?x=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(x=this.source.toDataURL()),d={type:"pattern",source:x,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:t(this.offsetX,v),offsetY:t(this.offsetY,v),patternTransform:this.patternTransform?this.patternTransform.concat():null},f.util.populateWithProperties(this,d,l),d},toSVG:function(l){var v=typeof this.source=="function"?this.source():this.source,x=v.width/l.width,d=v.height/l.height,m=this.offsetX/l.width,c=this.offsetY/l.height,_="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(d=1,c&&(d+=Math.abs(c))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(x=1,m&&(x+=Math.abs(m))),v.src?_=v.src:v.toDataURL&&(_=v.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+m+'" y="'+c+'" width="'+x+'" height="'+d+`">
<image x="0" y="0" width="`+v.width+'" height="'+v.height+'" xlink:href="'+_+`"></image>
</pattern>
`},setOptions:function(l){for(var v in l)this[v]=l[v]},toLive:function(l){var v=this.source;return!v||typeof v.src<"u"&&(!v.complete||v.naturalWidth===0||v.naturalHeight===0)?"":l.createPattern(v,this.repeat)}})}(),function(t){var l=t.fabric||(t.fabric={}),v=l.util.toFixed;if(l.Shadow){l.warn("fabric.Shadow is already defined.");return}l.Shadow=l.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(x){typeof x=="string"&&(x=this._parseShadow(x));for(var d in x)this[d]=x[d];this.id=l.Object.__uid++},_parseShadow:function(x){var d=x.trim(),m=l.Shadow.reOffsetsAndBlur.exec(d)||[],c=d.replace(l.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseFloat(m[1],10)||0,offsetY:parseFloat(m[2],10)||0,blur:parseFloat(m[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(x){var d=40,m=40,c=l.Object.NUM_FRACTION_DIGITS,_=l.util.rotateVector({x:this.offsetX,y:this.offsetY},l.util.degreesToRadians(-x.angle)),w=20,g=new l.Color(this.color);return x.width&&x.height&&(d=v((Math.abs(_.x)+this.blur)/x.width,c)*100+w,m=v((Math.abs(_.y)+this.blur)/x.height,c)*100+w),x.flipX&&(_.x*=-1),x.flipY&&(_.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+m+'%" height="'+(100+2*m)+'%" x="-'+d+'%" width="'+(100+2*d)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+v(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+v(_.x,c)+'" dy="'+v(_.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+g.toRgb()+'" flood-opacity="'+g.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var x={},d=l.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(m){this[m]!==d[m]&&(x[m]=this[m])},this),x}}),l.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(M),function(){if(f.StaticCanvas){f.warn("fabric.StaticCanvas is already defined.");return}var t=f.util.object.extend,l=f.util.getElementOffset,v=f.util.removeFromArray,x=f.util.toFixed,d=f.util.transformPoint,m=f.util.invertTransform,c=f.util.getNodeCanvas,_=f.util.createCanvasElement,w=new Error("Could not initialize `canvas` element");f.StaticCanvas=f.util.createClass(f.CommonMethods,{initialize:function(g,C){C||(C={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,C)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:f.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,C){var L=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(C),this.interactive||this._initRetinaScaling(),C.overlayImage&&this.setOverlayImage(C.overlayImage,L),C.backgroundImage&&this.setBackgroundImage(C.backgroundImage,L),C.backgroundColor&&this.setBackgroundColor(C.backgroundColor,L),C.overlayColor&&this.setOverlayColor(C.overlayColor,L),this.calcOffset()},_isRetinaScaling:function(){return f.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,f.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var g=f.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,C,L){C.setAttribute("width",this.width*g),C.setAttribute("height",this.height*g),L.scale(g,g)},calcOffset:function(){return this._offset=l(this.lowerCanvasEl),this},setOverlayImage:function(g,C,L){return this.__setBgOverlayImage("overlayImage",g,C,L)},setBackgroundImage:function(g,C,L){return this.__setBgOverlayImage("backgroundImage",g,C,L)},setOverlayColor:function(g,C){return this.__setBgOverlayColor("overlayColor",g,C)},setBackgroundColor:function(g,C){return this.__setBgOverlayColor("backgroundColor",g,C)},__setBgOverlayImage:function(g,C,L,B){return typeof C=="string"?f.util.loadImage(C,function(q,K){if(q){var se=new f.Image(q,B);this[g]=se,se.canvas=this}L&&L(q,K)},this,B&&B.crossOrigin):(B&&C.setOptions(B),this[g]=C,C&&(C.canvas=this),L&&L(C,!1)),this},__setBgOverlayColor:function(g,C,L){return this[g]=C,this._initGradient(C,g),this._initPattern(C,g,L),this},_createCanvasElement:function(){var g=_();if(!g||(g.style||(g.style={}),typeof g.getContext>"u"))throw w;return g},_initOptions:function(g){var C=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(C.width,10)||0,this.height=this.height||parseInt(C.height,10)||0,this.lowerCanvasEl.style&&(C.width=this.width,C.height=this.height,C.style.width=this.width+"px",C.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=f.util.getById(g)||this._createCanvasElement(),f.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,C){return this.setDimensions({width:g},C)},setHeight:function(g,C){return this.setDimensions({height:g},C)},setDimensions:function(g,C){var L;C=C||{};for(var B in g)L=g[B],C.cssOnly||(this._setBackstoreDimension(B,g[B]),L+="px",this.hasLostContext=!0),C.backstoreOnly||this._setCssDimension(B,L);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),C.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,C){return this.lowerCanvasEl[g]=C,this.upperCanvasEl&&(this.upperCanvasEl[g]=C),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=C),this[g]=C,this},_setCssDimension:function(g,C){return this.lowerCanvasEl.style[g]=C,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=C),this.wrapperEl&&(this.wrapperEl.style[g]=C),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var C=this._activeObject,L=this.backgroundImage,B=this.overlayImage,q,K,se;for(this.viewportTransform=g,K=0,se=this._objects.length;K<se;K++)q=this._objects[K],q.group||q.setCoords(!0);return C&&C.setCoords(),L&&L.setCoords(!0),B&&B.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,C){var L=g,B=this.viewportTransform.slice(0);g=d(g,m(this.viewportTransform)),B[0]=C,B[3]=C;var q=d(g,B);return B[4]+=L.x-q.x,B[5]+=L.y-q.y,this.setViewportTransform(B)},setZoom:function(g){return this.zoomToPoint(new f.Point(0,0),g),this},absolutePan:function(g){var C=this.viewportTransform.slice(0);return C[4]=-g.x,C[5]=-g.y,this.setViewportTransform(C)},relativePan:function(g){return this.absolutePan(new f.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=f.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},C=this.width,L=this.height,B=m(this.viewportTransform);return g.tl=d({x:0,y:0},B),g.br=d({x:C,y:L},B),g.tr=new f.Point(g.br.x,g.tl.y),g.bl=new f.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(f.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,C){var L=this.viewportTransform,B=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),f.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(L[0],L[1],L[2],L[3],L[4],L[5]),this._renderObjects(g,C),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),B&&(B.canvas=this,B.shouldCache(),B._transformDone=!0,B.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var C=this.viewportTransform,L=this.clipPath;g.save(),g.transform(C[0],C[1],C[2],C[3],C[4],C[5]),g.globalCompositeOperation="destination-in",L.transform(g),g.scale(1/L.zoomX,1/L.zoomY),g.drawImage(L._cacheCanvas,-L.cacheTranslationX,-L.cacheTranslationY),g.restore()},_renderObjects:function(g,C){var L,B;for(L=0,B=C.length;L<B;++L)C[L]&&C[L].render(g)},_renderBackgroundOrOverlay:function(g,C){var L=this[C+"Color"],B=this[C+"Image"],q=this.viewportTransform,K=this[C+"Vpt"];if(!(!L&&!B)){if(L){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=L.toLive?L.toLive(g,this):L,K&&g.transform(q[0],q[1],q[2],q[3],q[4],q[5]),g.transform(1,0,0,1,L.offsetX||0,L.offsetY||0);var se=L.gradientTransform||L.patternTransform;se&&g.transform(se[0],se[1],se[2],se[3],se[4],se[5]),g.fill(),g.restore()}B&&(g.save(),K&&g.transform(q[0],q[1],q[2],q[3],q[4],q[5]),B.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new f.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new f.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new f.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var C=this.getCenterPoint();return this._centerObject(g,C)},viewportCenterObject:function(g){var C=this.getVpCenter();return this._centerObject(g,C)},viewportCenterObjectH:function(g){var C=this.getVpCenter();return this._centerObject(g,new f.Point(C.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var C=this.getVpCenter();return this._centerObject(g,new f.Point(g.getCenterPoint().x,C.y))},getVpCenter:function(){var g=this.getCenterPoint(),C=m(this.viewportTransform);return d(g,C)},_centerObject:function(g,C){return g.setPositionByOrigin(C,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,C){var L=this.clipPath,B={version:f.version,objects:this._toObjects(g,C)};return L&&!L.excludeFromExport&&(B.clipPath=this._toObject(this.clipPath,g,C)),t(B,this.__serializeBgOverlay(g,C)),f.util.populateWithProperties(this,B,C),B},_toObjects:function(g,C){return this._objects.filter(function(L){return!L.excludeFromExport}).map(function(L){return this._toObject(L,g,C)},this)},_toObject:function(g,C,L){var B;this.includeDefaultValues||(B=g.includeDefaultValues,g.includeDefaultValues=!1);var q=g[C](L);return this.includeDefaultValues||(g.includeDefaultValues=B),q},__serializeBgOverlay:function(g,C){var L={},B=this.backgroundImage,q=this.overlayImage,K=this.backgroundColor,se=this.overlayColor;return K&&K.toObject?K.excludeFromExport||(L.background=K.toObject(C)):K&&(L.background=K),se&&se.toObject?se.excludeFromExport||(L.overlay=se.toObject(C)):se&&(L.overlay=se),B&&!B.excludeFromExport&&(L.backgroundImage=this._toObject(B,g,C)),q&&!q.excludeFromExport&&(L.overlayImage=this._toObject(q,g,C)),L},svgViewportTransformation:!0,toSVG:function(g,C){g||(g={}),g.reviver=C;var L=[];return this._setSVGPreamble(L,g),this._setSVGHeader(L,g),this.clipPath&&L.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(L,"background"),this._setSVGBgOverlayImage(L,"backgroundImage",C),this._setSVGObjects(L,C),this.clipPath&&L.push(`</g>
`),this._setSVGBgOverlayColor(L,"overlay"),this._setSVGBgOverlayImage(L,"overlayImage",C),L.push("</svg>"),L.join("")},_setSVGPreamble:function(g,C){C.suppressPreamble||g.push('<?xml version="1.0" encoding="',C.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,C){var L=C.width||this.width,B=C.height||this.height,q,K='viewBox="0 0 '+this.width+" "+this.height+'" ',se=f.Object.NUM_FRACTION_DIGITS;C.viewBox?K='viewBox="'+C.viewBox.x+" "+C.viewBox.y+" "+C.viewBox.width+" "+C.viewBox.height+'" ':this.svgViewportTransformation&&(q=this.viewportTransform,K='viewBox="'+x(-q[4]/q[0],se)+" "+x(-q[5]/q[3],se)+" "+x(this.width/q[0],se)+" "+x(this.height/q[3],se)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',L,'" ','height="',B,'" ',K,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",f.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(C),`</defs>
`)},createSVGClipPathMarkup:function(g){var C=this.clipPath;return C?(C.clipPathId="CLIPPATH_"+f.Object.__uid++,'<clipPath id="'+C.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this,C=["background","overlay"].map(function(L){var B=g[L+"Color"];if(B&&B.toLive){var q=g[L+"Vpt"],K=g.viewportTransform,se={width:g.width/(q?K[0]:1),height:g.height/(q?K[3]:1)};return B.toSVG(se,{additionalTransform:q?f.util.matrixToSVG(K):""})}});return C.join("")},createSVGFontFacesMarkup:function(){var g="",C={},L,B,q,K,se,he,le,ve,ot,_e=f.fontPaths,pe=[];for(this._objects.forEach(function De(at){pe.push(at),at._objects&&at._objects.forEach(De)}),ve=0,ot=pe.length;ve<ot;ve++)if(L=pe[ve],B=L.fontFamily,!(L.type.indexOf("text")===-1||C[B]||!_e[B])&&(C[B]=!0,!!L.styles)){q=L.styles;for(se in q){K=q[se];for(le in K)he=K[le],B=he.fontFamily,!C[B]&&_e[B]&&(C[B]=!0)}}for(var ze in C)g+=[`		@font-face {
`,"			font-family: '",ze,`';
`,"			src: url('",_e[ze],`');
`,`		}
`].join("");return g&&(g=['	<style type="text/css">',`<![CDATA[
`,g,"]]>",`</style>
`].join("")),g},_setSVGObjects:function(g,C){var L,B,q,K=this._objects;for(B=0,q=K.length;B<q;B++)L=K[B],!L.excludeFromExport&&this._setSVGObject(g,L,C)},_setSVGObject:function(g,C,L){g.push(C.toSVG(L))},_setSVGBgOverlayImage:function(g,C,L){this[C]&&!this[C].excludeFromExport&&this[C].toSVG&&g.push(this[C].toSVG(L))},_setSVGBgOverlayColor:function(g,C){var L=this[C+"Color"],B=this.viewportTransform,q=this.width,K=this.height;if(L)if(L.toLive){var se=L.repeat,he=f.util.invertTransform(B),le=this[C+"Vpt"],ve=le?f.util.matrixToSVG(he):"";g.push('<rect transform="'+ve+" translate(",q/2,",",K/2,')"',' x="',L.offsetX-q/2,'" y="',L.offsetY-K/2,'" ','width="',se==="repeat-y"||se==="no-repeat"?L.source.width:q,'" height="',se==="repeat-x"||se==="no-repeat"?L.source.height:K,'" fill="url(#SVGID_'+L.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',L,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var C=this._activeObject,L,B,q;if(g===C&&g.type==="activeSelection")for(q=C._objects,L=q.length;L--;)B=q[L],v(this._objects,B),this._objects.unshift(B);else v(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var C=this._activeObject,L,B,q;if(g===C&&g.type==="activeSelection")for(q=C._objects,L=0;L<q.length;L++)B=q[L],v(this._objects,B),this._objects.push(B);else v(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,C){if(!g)return this;var L=this._activeObject,B,q,K,se,he,le=0;if(g===L&&g.type==="activeSelection")for(he=L._objects,B=0;B<he.length;B++)q=he[B],K=this._objects.indexOf(q),K>0+le&&(se=K-1,v(this._objects,q),this._objects.splice(se,0,q)),le++;else K=this._objects.indexOf(g),K!==0&&(se=this._findNewLowerIndex(g,K,C),v(this._objects,g),this._objects.splice(se,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,C,L){var B,q;if(L)for(B=C,q=C-1;q>=0;--q){var K=g.intersectsWithObject(this._objects[q])||g.isContainedWithinObject(this._objects[q])||this._objects[q].isContainedWithinObject(g);if(K){B=q;break}}else B=C-1;return B},bringForward:function(g,C){if(!g)return this;var L=this._activeObject,B,q,K,se,he,le=0;if(g===L&&g.type==="activeSelection")for(he=L._objects,B=he.length;B--;)q=he[B],K=this._objects.indexOf(q),K<this._objects.length-1-le&&(se=K+1,v(this._objects,q),this._objects.splice(se,0,q)),le++;else K=this._objects.indexOf(g),K!==this._objects.length-1&&(se=this._findNewUpperIndex(g,K,C),v(this._objects,g),this._objects.splice(se,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,C,L){var B,q,K;if(L)for(B=C,q=C+1,K=this._objects.length;q<K;++q){var se=g.intersectsWithObject(this._objects[q])||g.isContainedWithinObject(this._objects[q])||this._objects[q].isContainedWithinObject(g);if(se){B=q;break}}else B=C+1;return B},moveTo:function(g,C){return v(this._objects,g),this._objects.splice(C,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(f.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),f.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),f.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),t(f.StaticCanvas.prototype,f.Observable),t(f.StaticCanvas.prototype,f.Collection),t(f.StaticCanvas.prototype,f.DataURLExporter),t(f.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var C=_();if(!C||!C.getContext)return null;var L=C.getContext("2d");if(!L)return null;switch(g){case"setLineDash":return typeof L.setLineDash<"u";default:return null}}}),f.StaticCanvas.prototype.toJSON=f.StaticCanvas.prototype.toObject,f.isLikelyNode&&(f.StaticCanvas.prototype.createPNGStream=function(){var g=c(this.lowerCanvasEl);return g&&g.createPNGStream()},f.StaticCanvas.prototype.createJPEGStream=function(g){var C=c(this.lowerCanvasEl);return C&&C.createJPEGStream(g)})}(),f.BaseBrush=f.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(t){t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var l=this.canvas.viewportTransform;t.save(),t.transform(l[0],l[1],l[2],l[3],l[4],l[5])},_setShadow:function(){if(this.shadow){var t=this.canvas,l=this.shadow,v=t.contextTop,x=t.getZoom();t&&t._isRetinaScaling()&&(x*=f.devicePixelRatio),v.shadowColor=l.color,v.shadowBlur=l.blur*x,v.shadowOffsetX=l.offsetX*x,v.shadowOffsetY=l.offsetY*x}},needsFullRender:function(){var t=new f.Color(this.color);return t.getAlpha()<1||!!this.shadow},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_isOutSideCanvas:function(t){return t.x<0||t.x>this.canvas.getWidth()||t.y<0||t.y>this.canvas.getHeight()}}),function(){f.PencilBrush=f.util.createClass(f.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(t){this.canvas=t,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(t,l,v){var x=l.midPointFrom(v);return t.quadraticCurveTo(l.x,l.y,x.x,x.y),x},onMouseDown:function(t,l){this.canvas._isMainEvent(l.e)&&(this.drawStraightLine=l.e[this.straightLineKey],this._prepareForDrawing(t),this._captureDrawingPath(t),this._render())},onMouseMove:function(t,l){if(this.canvas._isMainEvent(l.e)&&(this.drawStraightLine=l.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(t))&&this._captureDrawingPath(t)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var v=this._points,x=v.length,d=this.canvas.contextTop;this._saveAndTransform(d),this.oldEnd&&(d.beginPath(),d.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(d,v[x-2],v[x-1],!0),d.stroke(),d.restore()}},onMouseUp:function(t){return this.canvas._isMainEvent(t.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(t){var l=new f.Point(t.x,t.y);this._reset(),this._addPoint(l),this.canvas.contextTop.moveTo(l.x,l.y)},_addPoint:function(t){return this._points.length>1&&t.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(t),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(t){var l=new f.Point(t.x,t.y);return this._addPoint(l)},_render:function(t){var l,v,x=this._points[0],d=this._points[1];if(t=t||this.canvas.contextTop,this._saveAndTransform(t),t.beginPath(),this._points.length===2&&x.x===d.x&&x.y===d.y){var m=this.width/1e3;x=new f.Point(x.x,x.y),d=new f.Point(d.x,d.y),x.x-=m,d.x+=m}for(t.moveTo(x.x,x.y),l=1,v=this._points.length;l<v;l++)this._drawSegment(t,x,d),x=this._points[l],d=this._points[l+1];t.lineTo(x.x,x.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var l=this.width/1e3;return f.util.getSmoothPathFromPoints(t,l)},_isEmptySVGPath:function(t){var l=f.util.joinPath(t);return l==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(t){var l=new f.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,l.shadow=new f.Shadow(this.shadow)),l},decimatePoints:function(t,l){if(t.length<=2)return t;var v=this.canvas.getZoom(),x=Math.pow(l/v,2),d,m=t.length-1,c=t[0],_=[c],w;for(d=1;d<m-1;d++)w=Math.pow(c.x-t[d].x,2)+Math.pow(c.y-t[d].y,2),w>=x&&(c=t[d],_.push(c));return _.push(t[m]),_},_finalizeAndAddPath:function(){var t=this.canvas.contextTop;t.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var l=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(l)){this.canvas.requestRenderAll();return}var v=this.createPath(l);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:v}),this.canvas.add(v),this.canvas.requestRenderAll(),v.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:v})}})}(),f.CircleBrush=f.util.createClass(f.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var l=this.addPoint(t),v=this.canvas.contextTop;this._saveAndTransform(v),this.dot(v,l),v.restore()},dot:function(t,l){t.fillStyle=l.fill,t.beginPath(),t.arc(l.x,l.y,l.radius,0,Math.PI*2,!1),t.closePath(),t.fill()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t=this.canvas.contextTop,l,v,x=this.points;for(this._saveAndTransform(t),l=0,v=x.length;l<v;l++)this.dot(t,x[l]);t.restore()},onMouseMove:function(t){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(t)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t))},onMouseUp:function(){var t=this.canvas.renderOnAddRemove,l,v;this.canvas.renderOnAddRemove=!1;var x=[];for(l=0,v=this.points.length;l<v;l++){var d=this.points[l],m=new f.Circle({radius:d.radius,left:d.x,top:d.y,originX:"center",originY:"center",fill:d.fill});this.shadow&&(m.shadow=new f.Shadow(this.shadow)),x.push(m)}var c=new f.Group(x);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},addPoint:function(t){var l=new f.Point(t.x,t.y),v=f.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,x=new f.Color(this.color).setAlpha(f.util.getRandomInt(0,100)/100).toRgba();return l.radius=v,l.fill=x,this.points.push(l),l}}),f.SprayBrush=f.util.createClass(f.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(t)||(this.addSprayChunk(t),this.render(this.sprayChunkPoints))},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var l=[],v=0,x=this.sprayChunks.length;v<x;v++)for(var d=this.sprayChunks[v],m=0,c=d.length;m<c;m++){var _=new f.Rect({width:d[m].width,height:d[m].width,left:d[m].x+1,top:d[m].y+1,originX:"center",originY:"center",fill:this.color});l.push(_)}this.optimizeOverlapping&&(l=this._getOptimizedRects(l));var w=new f.Group(l);this.shadow&&w.set("shadow",new f.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:w}),this.canvas.add(w),this.canvas.fire("path:created",{path:w}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var l={},v,x,d;for(x=0,d=t.length;x<d;x++)v=t[x].left+""+t[x].top,l[v]||(l[v]=t[x]);var m=[];for(v in l)m.push(l[v]);return m},render:function(t){var l=this.canvas.contextTop,v,x;for(l.fillStyle=this.color,this._saveAndTransform(l),v=0,x=t.length;v<x;v++){var d=t[v];typeof d.opacity<"u"&&(l.globalAlpha=d.opacity),l.fillRect(d.x,d.y,d.width,d.width)}l.restore()},_render:function(){var t=this.canvas.contextTop,l,v;for(t.fillStyle=this.color,this._saveAndTransform(t),l=0,v=this.sprayChunks.length;l<v;l++)this.render(this.sprayChunks[l]);t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var l,v,x,d=this.width/2,m;for(m=0;m<this.density;m++){l=f.util.getRandomInt(t.x-d,t.x+d),v=f.util.getRandomInt(t.y-d,t.y+d),this.dotWidthVariance?x=f.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):x=this.dotWidth;var c=new f.Point(l,v);c.width=x,this.randomOpacity&&(c.opacity=f.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),f.PatternBrush=f.util.createClass(f.PencilBrush,{getPatternSrc:function(){var t=20,l=5,v=f.util.createCanvasElement(),x=v.getContext("2d");return v.width=v.height=t+l,x.fillStyle=this.color,x.beginPath(),x.arc(t/2,t/2,t/2,0,Math.PI*2,!1),x.closePath(),x.fill(),v},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(t){return t.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(t){this.callSuper("_setBrushStyles",t),t.strokeStyle=this.getPattern(t)},createPath:function(t){var l=this.callSuper("createPath",t),v=l._getLeftTopCoords().scalarAdd(l.strokeWidth/2);return l.stroke=new f.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-v.x,offsetY:-v.y}),l}}),function(){var t=f.util.getPointer,l=f.util.degreesToRadians,v=f.util.isTouchEvent;f.Canvas=f.util.createClass(f.StaticCanvas,{initialize:function(d,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(d,m),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=f.PencilBrush&&new f.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var d=this.getActiveObjects(),m,c,_;if(d.length>0&&!this.preserveObjectStacking){c=[],_=[];for(var w=0,g=this._objects.length;w<g;w++)m=this._objects[w],d.indexOf(m)===-1?c.push(m):_.push(m);d.length>1&&(this._activeObject._objects=_),c.push.apply(c,_)}else c=this._objects;return c},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var d=this.contextContainer;return this.renderCanvas(d,this._chooseObjectsToRender()),this},renderTopLayer:function(d){d.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(d),this.contextTopDirty=!0),d.restore()},renderTop:function(){var d=this.contextTop;return this.clearContext(d),this.renderTopLayer(d),this.fire("after:render"),this},_normalizePointer:function(d,m){var c=d.calcTransformMatrix(),_=f.util.invertTransform(c),w=this.restorePointerVpt(m);return f.util.transformPoint(w,_)},isTargetTransparent:function(d,m,c){if(d.shouldCache()&&d._cacheCanvas&&d!==this._activeObject){var _=this._normalizePointer(d,{x:m,y:c}),w=Math.max(d.cacheTranslationX+_.x*d.zoomX,0),g=Math.max(d.cacheTranslationY+_.y*d.zoomY,0),q=f.util.isTransparent(d._cacheContext,Math.round(w),Math.round(g),this.targetFindTolerance);return q}var C=this.contextCache,L=d.selectionBackgroundColor,B=this.viewportTransform;d.selectionBackgroundColor="",this.clearContext(C),C.save(),C.transform(B[0],B[1],B[2],B[3],B[4],B[5]),d.render(C),C.restore(),d.selectionBackgroundColor=L;var q=f.util.isTransparent(C,m,c,this.targetFindTolerance);return q},_isSelectionKeyPressed:function(d){var m=!1;return Array.isArray(this.selectionKey)?m=!!this.selectionKey.find(function(c){return d[c]===!0}):m=d[this.selectionKey],m},_shouldClearSelection:function(d,m){var c=this.getActiveObjects(),_=this._activeObject;return!m||m&&_&&c.length>1&&c.indexOf(m)===-1&&_!==m&&!this._isSelectionKeyPressed(d)||m&&!m.evented||m&&!m.selectable&&_&&_!==m},_shouldCenterTransform:function(d,m,c){if(d){var _;return m==="scale"||m==="scaleX"||m==="scaleY"||m==="resizing"?_=this.centeredScaling||d.centeredScaling:m==="rotate"&&(_=this.centeredRotation||d.centeredRotation),_?!c:c}},_getOriginFromCorner:function(d,m){var c={x:d.originX,y:d.originY};return m==="ml"||m==="tl"||m==="bl"?c.x="right":(m==="mr"||m==="tr"||m==="br")&&(c.x="left"),m==="tl"||m==="mt"||m==="tr"?c.y="bottom":(m==="bl"||m==="mb"||m==="br")&&(c.y="top"),c},_getActionFromCorner:function(d,m,c,_){if(!m||!d)return"drag";var w=_.controls[m];return w.getActionName(c,w,_)},_setupCurrentTransform:function(d,m,c){if(m){var _=this.getPointer(d),w=m.__corner,g=m.controls[w],C=c&&w?g.getActionHandler(d,m,g):f.controlsUtils.dragHandler,L=this._getActionFromCorner(c,w,d,m),B=this._getOriginFromCorner(m,w),q=d[this.centeredKey],K={target:m,action:L,actionHandler:C,corner:w,scaleX:m.scaleX,scaleY:m.scaleY,skewX:m.skewX,skewY:m.skewY,offsetX:_.x-m.left,offsetY:_.y-m.top,originX:B.x,originY:B.y,ex:_.x,ey:_.y,lastX:_.x,lastY:_.y,theta:l(m.angle),width:m.width*m.scaleX,shiftKey:d.shiftKey,altKey:q,original:f.util.saveObjectTransform(m)};this._shouldCenterTransform(m,L,q)&&(K.originX="center",K.originY="center"),K.original.originX=B.x,K.original.originY=B.y,this._currentTransform=K,this._beforeTransform(d)}},setCursor:function(d){this.upperCanvasEl.style.cursor=d},_drawSelection:function(d){var m=this._groupSelector,c=new f.Point(m.ex,m.ey),_=f.util.transformPoint(c,this.viewportTransform),w=new f.Point(m.ex+m.left,m.ey+m.top),g=f.util.transformPoint(w,this.viewportTransform),C=Math.min(_.x,g.x),L=Math.min(_.y,g.y),B=Math.max(_.x,g.x),q=Math.max(_.y,g.y),K=this.selectionLineWidth/2;this.selectionColor&&(d.fillStyle=this.selectionColor,d.fillRect(C,L,B-C,q-L)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(d.lineWidth=this.selectionLineWidth,d.strokeStyle=this.selectionBorderColor,C+=K,L+=K,B-=K,q-=K,f.Object.prototype._setLineDash.call(this,d,this.selectionDashArray),d.strokeRect(C,L,B-C,q-L))},findTarget:function(d,m){if(!this.skipTargetFind){var c=!0,_=this.getPointer(d,c),w=this._activeObject,g=this.getActiveObjects(),C,L,B=v(d),q=g.length>1&&!m||g.length===1;if(this.targets=[],q&&w._findTargetCorner(_,B)||g.length>1&&!m&&w===this._searchPossibleTargets([w],_))return w;if(g.length===1&&w===this._searchPossibleTargets([w],_))if(this.preserveObjectStacking)C=w,L=this.targets,this.targets=[];else return w;var K=this._searchPossibleTargets(this._objects,_);return d[this.altSelectionKey]&&K&&C&&K!==C&&(K=C,this.targets=L),K}},_checkTarget:function(d,m,c){if(m&&m.visible&&m.evented&&m.containsPoint(d))if((this.perPixelTargetFind||m.perPixelTargetFind)&&!m.isEditing){var _=this.isTargetTransparent(m,c.x,c.y);if(!_)return!0}else return!0},_searchPossibleTargets:function(d,m){for(var c,_=d.length,w;_--;){var g=d[_],C=g.group?this._normalizePointer(g.group,m):m;if(this._checkTarget(C,g,m)){c=d[_],c.subTargetCheck&&c instanceof f.Group&&(w=this._searchPossibleTargets(c._objects,m),w&&this.targets.push(w));break}}return c},restorePointerVpt:function(d){return f.util.transformPoint(d,f.util.invertTransform(this.viewportTransform))},getPointer:function(d,m){if(this._absolutePointer&&!m)return this._absolutePointer;if(this._pointer&&m)return this._pointer;var c=t(d),_=this.upperCanvasEl,w=_.getBoundingClientRect(),g=w.width||0,C=w.height||0,L;(!g||!C)&&("top"in w&&"bottom"in w&&(C=Math.abs(w.top-w.bottom)),"right"in w&&"left"in w&&(g=Math.abs(w.right-w.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,m||(c=this.restorePointerVpt(c));var B=this.getRetinaScaling();return B!==1&&(c.x/=B,c.y/=B),g===0||C===0?L={width:1,height:1}:L={width:_.width/g,height:_.height/C},{x:c.x*L.width,y:c.y*L.height}},_createUpperCanvas:function(){var d=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),m=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),f.util.addClass(c,"upper-canvas "+d),this.wrapperEl.appendChild(c),this._copyCanvasStyle(m,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=f.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),f.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),f.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(d){var m=this.width||d.width,c=this.height||d.height;f.util.setStyle(d,{position:"absolute",width:m+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),d.width=m,d.height=c,f.util.makeElementUnselectable(d)},_copyCanvasStyle:function(d,m){m.style.cssText=d.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var d=this._activeObject;return d?d.type==="activeSelection"&&d._objects?d._objects.slice(0):[d]:[]},_onObjectRemoved:function(d){d===this._activeObject&&(this.fire("before:selection:cleared",{target:d}),this._discardActiveObject(),this.fire("selection:cleared",{target:d}),d.fire("deselected")),d===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",d)},_fireSelectionEvents:function(d,m){var c=!1,_=this.getActiveObjects(),w=[],g=[];d.forEach(function(C){_.indexOf(C)===-1&&(c=!0,C.fire("deselected",{e:m,target:C}),g.push(C))}),_.forEach(function(C){d.indexOf(C)===-1&&(c=!0,C.fire("selected",{e:m,target:C}),w.push(C))}),d.length>0&&_.length>0?c&&this.fire("selection:updated",{e:m,selected:w,deselected:g}):_.length>0?this.fire("selection:created",{e:m,selected:w}):d.length>0&&this.fire("selection:cleared",{e:m,deselected:g})},setActiveObject:function(d,m){var c=this.getActiveObjects();return this._setActiveObject(d,m),this._fireSelectionEvents(c,m),this},_setActiveObject:function(d,m){return this._activeObject===d||!this._discardActiveObject(m,d)||d.onSelect({e:m})?!1:(this._activeObject=d,!0)},_discardActiveObject:function(d,m){var c=this._activeObject;if(c){if(c.onDeselect({e:d,object:m}))return!1;this._activeObject=null}return!0},discardActiveObject:function(d){var m=this.getActiveObjects(),c=this.getActiveObject();return m.length&&this.fire("before:selection:cleared",{target:c,e:d}),this._discardActiveObject(d),this._fireSelectionEvents(m,d),this},dispose:function(){var d=this.wrapperEl;return this.removeListeners(),d.removeChild(this.upperCanvasEl),d.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(m){f.util.cleanUpJsdomNode(this[m]),this[m]=void 0}.bind(this)),d.parentNode&&d.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,f.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(d){var m=this._activeObject;m&&m._renderControls(d)},_toObject:function(d,m,c){var _=this._realizeGroupTransformOnObject(d),w=this.callSuper("_toObject",d,m,c);return this._unwindGroupTransformOnObject(d,_),w},_realizeGroupTransformOnObject:function(d){if(d.group&&d.group.type==="activeSelection"&&this._activeObject===d.group){var m=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return m.forEach(function(_){c[_]=d[_]}),f.util.addTransformToObject(d,this._activeObject.calcOwnMatrix()),c}else return null},_unwindGroupTransformOnObject:function(d,m){m&&d.set(m)},_setSVGObject:function(d,m,c){var _=this._realizeGroupTransformOnObject(m);this.callSuper("_setSVGObject",d,m,c),this._unwindGroupTransformOnObject(m,_)},setViewportTransform:function(d){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),f.StaticCanvas.prototype.setViewportTransform.call(this,d)}});for(var x in f.StaticCanvas)x!=="prototype"&&(f.Canvas[x]=f.StaticCanvas[x])}(),function(){var t=f.util.addListener,l=f.util.removeListener,v=3,x=2,d=1,m={passive:!1};function c(_,w){return _.button&&_.button===w-1}f.util.object.extend(f.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(t,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(_,w){var g=this.upperCanvasEl,C=this._getEventPrefix();_(f.window,"resize",this._onResize),_(g,C+"down",this._onMouseDown),_(g,C+"move",this._onMouseMove,m),_(g,C+"out",this._onMouseOut),_(g,C+"enter",this._onMouseEnter),_(g,"wheel",this._onMouseWheel),_(g,"contextmenu",this._onContextMenu),_(g,"dblclick",this._onDoubleClick),_(g,"dragover",this._onDragOver),_(g,"dragenter",this._onDragEnter),_(g,"dragleave",this._onDragLeave),_(g,"drop",this._onDrop),this.enablePointerEvents||_(g,"touchstart",this._onTouchStart,m),typeof eventjs<"u"&&w in eventjs&&(eventjs[w](g,"gesture",this._onGesture),eventjs[w](g,"drag",this._onDrag),eventjs[w](g,"orientation",this._onOrientationChange),eventjs[w](g,"shake",this._onShake),eventjs[w](g,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(l,"remove");var _=this._getEventPrefix();l(f.document,_+"up",this._onMouseUp),l(f.document,"touchend",this._onTouchEnd,m),l(f.document,_+"move",this._onMouseMove,m),l(f.document,"touchmove",this._onMouseMove,m)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(_,w){this.__onTransformGesture&&this.__onTransformGesture(_,w)},_onDrag:function(_,w){this.__onDrag&&this.__onDrag(_,w)},_onMouseWheel:function(_){this.__onMouseWheel(_)},_onMouseOut:function(_){var w=this._hoveredTarget;this.fire("mouse:out",{target:w,e:_}),this._hoveredTarget=null,w&&w.fire("mouseout",{e:_});var g=this;this._hoveredTargets.forEach(function(C){g.fire("mouse:out",{target:w,e:_}),C&&w.fire("mouseout",{e:_})}),this._hoveredTargets=[]},_onMouseEnter:function(_){!this._currentTransform&&!this.findTarget(_)&&(this.fire("mouse:over",{target:null,e:_}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(_,w){this.__onOrientationChange&&this.__onOrientationChange(_,w)},_onShake:function(_,w){this.__onShake&&this.__onShake(_,w)},_onLongPress:function(_,w){this.__onLongPress&&this.__onLongPress(_,w)},_onDragOver:function(_){_.preventDefault();var w=this._simpleEventHandler("dragover",_);this._fireEnterLeaveEvents(w,_)},_onDrop:function(_){return this._simpleEventHandler("drop:before",_),this._simpleEventHandler("drop",_)},_onContextMenu:function(_){return this.stopContextMenu&&(_.stopPropagation(),_.preventDefault()),!1},_onDoubleClick:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"dblclick"),this._resetTransformEventData(_)},getPointerId:function(_){var w=_.changedTouches;return w?w[0]&&w[0].identifier:this.enablePointerEvents?_.pointerId:-1},_isMainEvent:function(_){return _.isPrimary===!0?!0:_.isPrimary===!1?!1:_.type==="touchend"&&_.touches.length===0?!0:_.changedTouches?_.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(_){_.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(_)),this.__onMouseDown(_),this._resetTransformEventData();var w=this.upperCanvasEl,g=this._getEventPrefix();t(f.document,"touchend",this._onTouchEnd,m),t(f.document,"touchmove",this._onMouseMove,m),l(w,g+"down",this._onMouseDown)},_onMouseDown:function(_){this.__onMouseDown(_),this._resetTransformEventData();var w=this.upperCanvasEl,g=this._getEventPrefix();l(w,g+"move",this._onMouseMove,m),t(f.document,g+"up",this._onMouseUp),t(f.document,g+"move",this._onMouseMove,m)},_onTouchEnd:function(_){if(!(_.touches.length>0)){this.__onMouseUp(_),this._resetTransformEventData(),this.mainTouchId=null;var w=this._getEventPrefix();l(f.document,"touchend",this._onTouchEnd,m),l(f.document,"touchmove",this._onMouseMove,m);var g=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){t(g.upperCanvasEl,w+"down",g._onMouseDown),g._willAddMouseDown=0},400)}},_onMouseUp:function(_){this.__onMouseUp(_),this._resetTransformEventData();var w=this.upperCanvasEl,g=this._getEventPrefix();this._isMainEvent(_)&&(l(f.document,g+"up",this._onMouseUp),l(f.document,g+"move",this._onMouseMove,m),t(w,g+"move",this._onMouseMove,m))},_onMouseMove:function(_){!this.allowTouchScrolling&&_.preventDefault&&_.preventDefault(),this.__onMouseMove(_)},_onResize:function(){this.calcOffset()},_shouldRender:function(_){var w=this._activeObject;return!!w!=!!_||w&&_&&w!==_?!0:(w&&w.isEditing,!1)},__onMouseUp:function(_){var w,g=this._currentTransform,C=this._groupSelector,L=!1,B=!C||C.left===0&&C.top===0;if(this._cacheTransformEventData(_),w=this._target,this._handleEvent(_,"up:before"),c(_,v)){this.fireRightClick&&this._handleEvent(_,"up",v,B);return}if(c(_,x)){this.fireMiddleClick&&this._handleEvent(_,"up",x,B),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(_);return}if(this._isMainEvent(_)){if(g&&(this._finalizeCurrentTransform(_),L=g.actionPerformed),!B){var q=w===this._activeObject;this._maybeGroupObjects(_),L||(L=this._shouldRender(w)||!q&&w===this._activeObject)}var K,se;if(w){if(K=w._findTargetCorner(this.getPointer(_,!0),f.util.isTouchEvent(_)),w.selectable&&w!==this._activeObject&&w.activeOn==="up")this.setActiveObject(w,_),L=!0;else{var he=w.controls[K],le=he&&he.getMouseUpHandler(_,w,he);le&&(se=this.getPointer(_),le(_,g,se.x,se.y))}w.isMoving=!1}if(g&&(g.target!==w||g.corner!==K)){var ve=g.target&&g.target.controls[g.corner],ot=ve&&ve.getMouseUpHandler(_,w,he);se=se||this.getPointer(_),ot&&ot(_,g,se.x,se.y)}this._setCursorFromEvent(_,w),this._handleEvent(_,"up",d,B),this._groupSelector=null,this._currentTransform=null,w&&(w.__corner=0),L?this.requestRenderAll():B||this.renderTop()}},_simpleEventHandler:function(_,w){var g=this.findTarget(w),C=this.targets,L={e:w,target:g,subTargets:C};if(this.fire(_,L),g&&g.fire(_,L),!C)return g;for(var B=0;B<C.length;B++)C[B].fire(_,L);return g},_handleEvent:function(_,w,g,C){var L=this._target,B=this.targets||[],q={e:_,target:L,subTargets:B,button:g||d,isClick:C||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};w==="up"&&(q.currentTarget=this.findTarget(_),q.currentSubTargets=this.targets),this.fire("mouse:"+w,q),L&&L.fire("mouse"+w,q);for(var K=0;K<B.length;K++)B[K].fire("mouse"+w,q)},_finalizeCurrentTransform:function(_){var w=this._currentTransform,g=w.target,C={e:_,target:g,transform:w,action:w.action};g._scaling&&(g._scaling=!1),g.setCoords(),(w.actionPerformed||this.stateful&&g.hasStateChanged())&&this._fire("modified",C)},_onMouseDownInDrawingMode:function(_){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(_).requestRenderAll();var w=this.getPointer(_);this.freeDrawingBrush.onMouseDown(w,{e:_,pointer:w}),this._handleEvent(_,"down")},_onMouseMoveInDrawingMode:function(_){if(this._isCurrentlyDrawing){var w=this.getPointer(_);this.freeDrawingBrush.onMouseMove(w,{e:_,pointer:w})}this.setCursor(this.freeDrawingCursor),this._handleEvent(_,"move")},_onMouseUpInDrawingMode:function(_){var w=this.getPointer(_);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:_,pointer:w}),this._handleEvent(_,"up")},__onMouseDown:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"down:before");var w=this._target;if(c(_,v)){this.fireRightClick&&this._handleEvent(_,"down",v);return}if(c(_,x)){this.fireMiddleClick&&this._handleEvent(_,"down",x);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(_);return}if(this._isMainEvent(_)&&!this._currentTransform){var g=this._pointer;this._previousPointer=g;var C=this._shouldRender(w),L=this._shouldGroup(_,w);if(this._shouldClearSelection(_,w)?this.discardActiveObject(_):L&&(this._handleGrouping(_,w),w=this._activeObject),this.selection&&(!w||!w.selectable&&!w.isEditing&&w!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),w){var B=w===this._activeObject;w.selectable&&w.activeOn==="down"&&this.setActiveObject(w,_);var q=w._findTargetCorner(this.getPointer(_,!0),f.util.isTouchEvent(_));if(w.__corner=q,w===this._activeObject&&(q||!L)){this._setupCurrentTransform(_,w,B);var K=w.controls[q],g=this.getPointer(_),se=K&&K.getMouseDownHandler(_,w,K);se&&se(_,this._currentTransform,g.x,g.y)}}this._handleEvent(_,"down"),(C||L)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(_){this._resetTransformEventData(),this._pointer=this.getPointer(_,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(_)||null},_beforeTransform:function(_){var w=this._currentTransform;this.stateful&&w.target.saveState(),this.fire("before:transform",{e:_,transform:w})},__onMouseMove:function(_){this._handleEvent(_,"move:before"),this._cacheTransformEventData(_);var w,g;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(_);return}if(this._isMainEvent(_)){var C=this._groupSelector;C?(g=this._absolutePointer,C.left=g.x-C.ex,C.top=g.y-C.ey,this.renderTop()):this._currentTransform?this._transformObject(_):(w=this.findTarget(_)||null,this._setCursorFromEvent(_,w),this._fireOverOutEvents(w,_)),this._handleEvent(_,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(_,w){var g=this._hoveredTarget,C=this._hoveredTargets,L=this.targets,B=Math.max(C.length,L.length);this.fireSyntheticInOutEvents(_,w,{oldTarget:g,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var q=0;q<B;q++)this.fireSyntheticInOutEvents(L[q],w,{oldTarget:C[q],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=_,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(_,w){var g=this._draggedoverTarget,C=this._hoveredTargets,L=this.targets,B=Math.max(C.length,L.length);this.fireSyntheticInOutEvents(_,w,{oldTarget:g,evtOut:"dragleave",evtIn:"dragenter"});for(var q=0;q<B;q++)this.fireSyntheticInOutEvents(L[q],w,{oldTarget:C[q],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=_},fireSyntheticInOutEvents:function(_,w,g){var C,L,B=g.oldTarget,q,K,se=B!==_,he=g.canvasEvtIn,le=g.canvasEvtOut;se&&(C={e:w,target:_,previousTarget:B},L={e:w,target:B,nextTarget:_}),K=_&&se,q=B&&se,q&&(le&&this.fire(le,L),B.fire(g.evtOut,L)),K&&(he&&this.fire(he,C),_.fire(g.evtIn,C))},__onMouseWheel:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"wheel"),this._resetTransformEventData()},_transformObject:function(_){var w=this.getPointer(_),g=this._currentTransform;g.reset=!1,g.shiftKey=_.shiftKey,g.altKey=_[this.centeredKey],this._performTransformAction(_,g,w),g.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(_,w,g){var C=g.x,L=g.y,B=w.action,q=!1,K=w.actionHandler;K&&(q=K(_,w,C,L)),B==="drag"&&q&&(w.target.isMoving=!0,this.setCursor(w.target.moveCursor||this.moveCursor)),w.actionPerformed=w.actionPerformed||q},_fire:f.controlsUtils.fireEvent,_setCursorFromEvent:function(_,w){if(!w)return this.setCursor(this.defaultCursor),!1;var g=w.hoverCursor||this.hoverCursor,C=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,L=(!C||!C.contains(w))&&w._findTargetCorner(this.getPointer(_,!0));L?this.setCursor(this.getCornerCursor(L,w,_)):(w.subTargetCheck&&this.targets.concat().reverse().map(function(B){g=B.hoverCursor||g}),this.setCursor(g))},getCornerCursor:function(_,w,g){var C=w.controls[_];return C.cursorStyleHandler(g,C,w)}})}(),function(){var t=Math.min,l=Math.max;f.util.object.extend(f.Canvas.prototype,{_shouldGroup:function(v,x){var d=this._activeObject;return d&&this._isSelectionKeyPressed(v)&&x&&x.selectable&&this.selection&&(d!==x||d.type==="activeSelection")&&!x.onSelect({e:v})},_handleGrouping:function(v,x){var d=this._activeObject;d.__corner||x===d&&(x=this.findTarget(v,!0),!x||!x.selectable)||(d&&d.type==="activeSelection"?this._updateActiveSelection(x,v):this._createActiveSelection(x,v))},_updateActiveSelection:function(v,x){var d=this._activeObject,m=d._objects.slice(0);d.contains(v)?(d.removeWithUpdate(v),this._hoveredTarget=v,this._hoveredTargets=this.targets.concat(),d.size()===1&&this._setActiveObject(d.item(0),x)):(d.addWithUpdate(v),this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(m,x)},_createActiveSelection:function(v,x){var d=this.getActiveObjects(),m=this._createGroup(v);this._hoveredTarget=m,this._setActiveObject(m,x),this._fireSelectionEvents(d,x)},_createGroup:function(v){var x=this._objects,d=x.indexOf(this._activeObject)<x.indexOf(v),m=d?[this._activeObject,v]:[v,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new f.ActiveSelection(m,{canvas:this})},_groupSelectedObjects:function(v){var x=this._collectObjects(v),d;x.length===1?this.setActiveObject(x[0],v):x.length>1&&(d=new f.ActiveSelection(x.reverse(),{canvas:this}),this.setActiveObject(d,v))},_collectObjects:function(v){for(var x=[],d,m=this._groupSelector.ex,c=this._groupSelector.ey,_=m+this._groupSelector.left,w=c+this._groupSelector.top,g=new f.Point(t(m,_),t(c,w)),C=new f.Point(l(m,_),l(c,w)),L=!this.selectionFullyContained,B=m===_&&c===w,q=this._objects.length;q--&&(d=this._objects[q],!(!(!d||!d.selectable||!d.visible)&&(L&&d.intersectsWithRect(g,C,!0)||d.isContainedWithinRect(g,C,!0)||L&&d.containsPoint(g,null,!0)||L&&d.containsPoint(C,null,!0))&&(x.push(d),B))););return x.length>1&&(x=x.filter(function(K){return!K.onSelect({e:v})})),x},_maybeGroupObjects:function(v){this.selection&&this._groupSelector&&this._groupSelectedObjects(v),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){f.util.object.extend(f.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var l=t.format||"png",v=t.quality||1,x=(t.multiplier||1)*(t.enableRetinaScaling?this.getRetinaScaling():1),d=this.toCanvasElement(x,t);return f.util.toDataURL(d,l,v)},toCanvasElement:function(t,l){t=t||1,l=l||{};var v=(l.width||this.width)*t,x=(l.height||this.height)*t,d=this.getZoom(),m=this.width,c=this.height,_=d*t,w=this.viewportTransform,g=(w[4]-(l.left||0))*t,C=(w[5]-(l.top||0))*t,L=this.interactive,B=[_,0,0,_,g,C],q=this.enableRetinaScaling,K=f.util.createCanvasElement(),se=this.contextTop;return K.width=v,K.height=x,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=B,this.width=v,this.height=x,this.calcViewportBoundaries(),this.renderCanvas(K.getContext("2d"),this._objects),this.viewportTransform=w,this.width=m,this.height=c,this.calcViewportBoundaries(),this.interactive=L,this.enableRetinaScaling=q,this.contextTop=se,K}})}(),f.util.object.extend(f.StaticCanvas.prototype,{loadFromJSON:function(t,l,v){if(t){var x=typeof t=="string"?JSON.parse(t):f.util.object.clone(t),d=this,m=x.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete x.clipPath,this._enlivenObjects(x.objects,function(_){d.clear(),d._setBgOverlay(x,function(){m?d._enlivenObjects([m],function(w){d.clipPath=w[0],d.__setupCanvas.call(d,x,_,c,l)}):d.__setupCanvas.call(d,x,_,c,l)})},v),this}},__setupCanvas:function(t,l,v,x){var d=this;l.forEach(function(m,c){d.insertAt(m,c)}),this.renderOnAddRemove=v,delete t.objects,delete t.backgroundImage,delete t.overlayImage,delete t.background,delete t.overlay,this._setOptions(t),this.renderAll(),x&&x()},_setBgOverlay:function(t,l){var v={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!t.backgroundImage&&!t.overlayImage&&!t.background&&!t.overlay){l&&l();return}var x=function(){v.backgroundImage&&v.overlayImage&&v.backgroundColor&&v.overlayColor&&l&&l()};this.__setBgOverlay("backgroundImage",t.backgroundImage,v,x),this.__setBgOverlay("overlayImage",t.overlayImage,v,x),this.__setBgOverlay("backgroundColor",t.background,v,x),this.__setBgOverlay("overlayColor",t.overlay,v,x)},__setBgOverlay:function(t,l,v,x){var d=this;if(!l){v[t]=!0,x&&x();return}t==="backgroundImage"||t==="overlayImage"?f.util.enlivenObjects([l],function(m){d[t]=m[0],v[t]=!0,x&&x()}):this["set"+f.util.string.capitalize(t,!0)](l,function(){v[t]=!0,x&&x()})},_enlivenObjects:function(t,l,v){if(!t||t.length===0){l&&l([]);return}f.util.enlivenObjects(t,function(x){l&&l(x)},null,v)},_toDataURL:function(t,l){this.clone(function(v){l(v.toDataURL(t))})},_toDataURLWithMultiplier:function(t,l,v){this.clone(function(x){v(x.toDataURLWithMultiplier(t,l))})},clone:function(t,l){var v=JSON.stringify(this.toJSON(l));this.cloneWithoutData(function(x){x.loadFromJSON(v,function(){t&&t(x)})})},cloneWithoutData:function(t){var l=f.util.createCanvasElement();l.width=this.width,l.height=this.height;var v=new f.Canvas(l);this.backgroundImage?(v.setBackgroundImage(this.backgroundImage.src,function(){v.renderAll(),t&&t(v)}),v.backgroundImageOpacity=this.backgroundImageOpacity,v.backgroundImageStretch=this.backgroundImageStretch):t&&t(v)}}),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.util.object.clone,d=l.util.toFixed,m=l.util.string.capitalize,c=l.util.degreesToRadians,_=!l.isLikelyNode,w=2;l.Object||(l.Object=l.util.createClass(l.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:_,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(g){g&&this.setOptions(g)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=l.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(g){var C=l.perfLimitSizeTotal,L=g.width,B=g.height,q=l.maxCacheSideLimit,K=l.minCacheSideLimit;if(L<=q&&B<=q&&L*B<=C)return L<K&&(g.width=K),B<K&&(g.height=K),g;var se=L/B,he=l.util.limitDimsByArea(se,C),le=l.util.capValue,ve=le(K,he.x,q),ot=le(K,he.y,q);return L>ve&&(g.zoomX/=L/ve,g.width=ve,g.capped=!0),B>ot&&(g.zoomY/=B/ot,g.height=ot,g.capped=!0),g},_getCacheCanvasDimensions:function(){var g=this.getTotalObjectScaling(),C=this._getTransformedDimensions(0,0),L=C.x*g.scaleX/this.scaleX,B=C.y*g.scaleY/this.scaleY;return{width:L+w,height:B+w,zoomX:g.scaleX,zoomY:g.scaleY,x:L,y:B}},_updateCacheCanvas:function(){var g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){var C=g._currentTransform.target,L=g._currentTransform.action;if(this===C&&L.slice&&L.slice(0,5)==="scale")return!1}var B=this._cacheCanvas,q=this._limitCacheSize(this._getCacheCanvasDimensions()),K=l.minCacheSideLimit,se=q.width,he=q.height,le,ve,ot=q.zoomX,_e=q.zoomY,pe=se!==this.cacheWidth||he!==this.cacheHeight,ze=this.zoomX!==ot||this.zoomY!==_e,De=pe||ze,at=0,ft=0,xt=!1;if(pe){var He=this._cacheCanvas.width,ae=this._cacheCanvas.height,Te=se>He||he>ae,Oe=(se<He*.9||he<ae*.9)&&He>K&&ae>K;xt=Te||Oe,Te&&!q.capped&&(se>K||he>K)&&(at=se*.1,ft=he*.1)}return this instanceof l.Text&&this.path&&(De=!0,xt=!0,at+=this.getHeightOfLine(0)*this.zoomX,ft+=this.getHeightOfLine(0)*this.zoomY),De?(xt?(B.width=Math.ceil(se+at),B.height=Math.ceil(he+ft)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,B.width,B.height)),le=q.x/2,ve=q.y/2,this.cacheTranslationX=Math.round(B.width/2-le)+le,this.cacheTranslationY=Math.round(B.height/2-ve)+ve,this.cacheWidth=se,this.cacheHeight=he,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(ot,_e),this.zoomX=ot,this.zoomY=_e,!0):!1},setOptions:function(g){this._setOptions(g),this._initGradient(g.fill,"fill"),this._initGradient(g.stroke,"stroke"),this._initPattern(g.fill,"fill"),this._initPattern(g.stroke,"stroke")},transform:function(g){var C=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,L=this.calcTransformMatrix(!C);g.transform(L[0],L[1],L[2],L[3],L[4],L[5])},toObject:function(g){var C=l.Object.NUM_FRACTION_DIGITS,L={type:this.type,version:l.version,originX:this.originX,originY:this.originY,left:d(this.left,C),top:d(this.top,C),width:d(this.width,C),height:d(this.height,C),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,C),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:d(this.strokeMiterLimit,C),scaleX:d(this.scaleX,C),scaleY:d(this.scaleY,C),angle:d(this.angle,C),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,C),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:d(this.skewX,C),skewY:d(this.skewY,C)};return this.clipPath&&!this.clipPath.excludeFromExport&&(L.clipPath=this.clipPath.toObject(g),L.clipPath.inverted=this.clipPath.inverted,L.clipPath.absolutePositioned=this.clipPath.absolutePositioned),l.util.populateWithProperties(this,L,g),this.includeDefaultValues||(L=this._removeDefaultValues(L)),L},toDatalessObject:function(g){return this.toObject(g)},_removeDefaultValues:function(g){var C=l.util.getKlass(g.type).prototype,L=C.stateProperties;return L.forEach(function(B){B==="left"||B==="top"||(g[B]===C[B]&&delete g[B],Array.isArray(g[B])&&Array.isArray(C[B])&&g[B].length===0&&C[B].length===0&&delete g[B])}),g},toString:function(){return"#<fabric."+m(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var g=l.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(g.scaleX),scaleY:Math.abs(g.scaleY)}},getTotalObjectScaling:function(){var g=this.getObjectScaling(),C=g.scaleX,L=g.scaleY;if(this.canvas){var B=this.canvas.getZoom(),q=this.canvas.getRetinaScaling();C*=B*q,L*=B*q}return{scaleX:C,scaleY:L}},getObjectOpacity:function(){var g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g},_set:function(g,C){var L=g==="scaleX"||g==="scaleY",B=this[g]!==C,q=!1;return L&&(C=this._constrainScale(C)),g==="scaleX"&&C<0?(this.flipX=!this.flipX,C*=-1):g==="scaleY"&&C<0?(this.flipY=!this.flipY,C*=-1):g==="shadow"&&C&&!(C instanceof l.Shadow)?C=new l.Shadow(C):g==="dirty"&&this.group&&this.group.set("dirty",C),this[g]=C,B&&(q=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(g)>-1?(this.dirty=!0,q&&this.group.set("dirty",!0)):q&&this.stateProperties.indexOf(g)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:l.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(g),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),g.restore())},renderCache:function(g){g=g||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(g,C){if(g.save(),C.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",C.absolutePositioned){var L=l.util.invertTransform(this.calcTransformMatrix());g.transform(L[0],L[1],L[2],L[3],L[4],L[5])}C.transform(g),g.scale(1/C.zoomX,1/C.zoomY),g.drawImage(C._cacheCanvas,-C.cacheTranslationX,-C.cacheTranslationY),g.restore()},drawObject:function(g,C){var L=this.fill,B=this.stroke;C?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=L,this.stroke=B},_drawClipPath:function(g,C){C&&(C.canvas=this.canvas,C.shouldCache(),C._transformDone=!0,C.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,C))},drawCacheOnCanvas:function(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(g){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!g){var C=this.cacheWidth/this.zoomX,L=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-C/2,-L/2,C,L)}return!0}return!1},_renderBackground:function(g){if(this.backgroundColor){var C=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-C.x/2,-C.y/2,C.x,C.y),this._removeShadow(g)}},_setOpacity:function(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity},_setStrokeStyles:function(g,C){var L=C.stroke;L&&(g.lineWidth=C.strokeWidth,g.lineCap=C.strokeLineCap,g.lineDashOffset=C.strokeDashOffset,g.lineJoin=C.strokeLineJoin,g.miterLimit=C.strokeMiterLimit,L.toLive?L.gradientUnits==="percentage"||L.gradientTransform||L.patternTransform?this._applyPatternForTransformedGradient(g,L):(g.strokeStyle=L.toLive(g,this),this._applyPatternGradientTransform(g,L)):g.strokeStyle=C.stroke)},_setFillStyles:function(g,C){var L=C.fill;L&&(L.toLive?(g.fillStyle=L.toLive(g,this),this._applyPatternGradientTransform(g,C.fill)):g.fillStyle=L)},_setClippingProperties:function(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"},_setLineDash:function(g,C){!C||C.length===0||(1&C.length&&C.push.apply(C,C),g.setLineDash(C))},_renderControls:function(g,C){var L=this.getViewportTransform(),B=this.calcTransformMatrix(),q,K,se;C=C||{},K=typeof C.hasBorders<"u"?C.hasBorders:this.hasBorders,se=typeof C.hasControls<"u"?C.hasControls:this.hasControls,B=l.util.multiplyTransformMatrices(L,B),q=l.util.qrDecompose(B),g.save(),g.translate(q.translateX,q.translateY),g.lineWidth=1*this.borderScaleFactor,this.group||(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(q.angle-=180),g.rotate(c(this.group?q.angle:this.angle)),C.forActiveSelection||this.group?K&&this.drawBordersInGroup(g,q,C):K&&this.drawBorders(g,C),se&&this.drawControls(g,C),g.restore()},_setShadow:function(g){if(this.shadow){var C=this.shadow,L=this.canvas,B,q=L&&L.viewportTransform[0]||1,K=L&&L.viewportTransform[3]||1;C.nonScaling?B={scaleX:1,scaleY:1}:B=this.getObjectScaling(),L&&L._isRetinaScaling()&&(q*=l.devicePixelRatio,K*=l.devicePixelRatio),g.shadowColor=C.color,g.shadowBlur=C.blur*l.browserShadowBlurConstant*(q+K)*(B.scaleX+B.scaleY)/4,g.shadowOffsetX=C.offsetX*q*B.scaleX,g.shadowOffsetY=C.offsetY*K*B.scaleY}},_removeShadow:function(g){this.shadow&&(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)},_applyPatternGradientTransform:function(g,C){if(!C||!C.toLive)return{offsetX:0,offsetY:0};var L=C.gradientTransform||C.patternTransform,B=-this.width/2+C.offsetX||0,q=-this.height/2+C.offsetY||0;return C.gradientUnits==="percentage"?g.transform(this.width,0,0,this.height,B,q):g.transform(1,0,0,1,B,q),L&&g.transform(L[0],L[1],L[2],L[3],L[4],L[5]),{offsetX:B,offsetY:q}},_renderPaintInOrder:function(g){this.paintFirst==="stroke"?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))},_render:function(){},_renderFill:function(g){this.fill&&(g.save(),this._setFillStyles(g,this),this.fillRule==="evenodd"?g.fill("evenodd"):g.fill(),g.restore())},_renderStroke:function(g){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform&&this.group){var C=this.getObjectScaling();g.scale(1/C.scaleX,1/C.scaleY)}else this.strokeUniform&&g.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}},_applyPatternForTransformedGradient:function(g,C){var L=this._limitCacheSize(this._getCacheCanvasDimensions()),B=l.util.createCanvasElement(),q,K=this.canvas.getRetinaScaling(),se=L.x/this.scaleX/K,he=L.y/this.scaleY/K;B.width=se,B.height=he,q=B.getContext("2d"),q.beginPath(),q.moveTo(0,0),q.lineTo(se,0),q.lineTo(se,he),q.lineTo(0,he),q.closePath(),q.translate(se/2,he/2),q.scale(L.zoomX/this.scaleX/K,L.zoomY/this.scaleY/K),this._applyPatternGradientTransform(q,C),q.fillStyle=C.toLive(g),q.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(K*this.scaleX/L.zoomX,K*this.scaleY/L.zoomY),g.strokeStyle=q.createPattern(B,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var g=l.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",g.scaleX),this.set("scaleY",g.scaleY),this.angle=g.angle,this.skewX=g.skewX,this.skewY=0}},_removeTransformMatrix:function(g){var C=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),C=l.util.transformPoint(C,this.transformMatrix)),this.transformMatrix=null,g&&(this.scaleX*=g.scaleX,this.scaleY*=g.scaleY,this.cropX=g.cropX,this.cropY=g.cropY,C.x+=g.offsetLeft,C.y+=g.offsetTop,this.width=g.width,this.height=g.height),this.setPositionByOrigin(C,"center","center")},clone:function(g,C){var L=this.toObject(C);this.constructor.fromObject?this.constructor.fromObject(L,g):l.Object._fromObject("Object",L,g)},cloneAsImage:function(g,C){var L=this.toCanvasElement(C);return g&&g(new l.Image(L)),this},toCanvasElement:function(g){g||(g={});var C=l.util,L=C.saveObjectTransform(this),B=this.group,q=this.shadow,K=Math.abs,se=(g.multiplier||1)*(g.enableRetinaScaling?l.devicePixelRatio:1);delete this.group,g.withoutTransform&&C.resetObjectTransform(this),g.withoutShadow&&(this.shadow=null);var he=l.util.createCanvasElement(),le=this.getBoundingRect(!0,!0),ve=this.shadow,ot,_e={x:0,y:0},pe,ze,De;ve&&(pe=ve.blur,ve.nonScaling?ot={scaleX:1,scaleY:1}:ot=this.getObjectScaling(),_e.x=2*Math.round(K(ve.offsetX)+pe)*K(ot.scaleX),_e.y=2*Math.round(K(ve.offsetY)+pe)*K(ot.scaleY)),ze=le.width+_e.x,De=le.height+_e.y,he.width=Math.ceil(ze),he.height=Math.ceil(De);var at=new l.StaticCanvas(he,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});g.format==="jpeg"&&(at.backgroundColor="#fff"),this.setPositionByOrigin(new l.Point(at.width/2,at.height/2),"center","center");var ft=this.canvas;at.add(this);var xt=at.toCanvasElement(se||1,g);return this.shadow=q,this.set("canvas",ft),B&&(this.group=B),this.set(L).setCoords(),at._objects=[],at.dispose(),at=null,xt},toDataURL:function(g){return g||(g={}),l.util.toDataURL(this.toCanvasElement(g),g.format||"png",g.quality||1)},isType:function(g){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===g},complexity:function(){return 1},toJSON:function(g){return this.toObject(g)},rotate:function(g){var C=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return C&&this._setOriginToCenter(),this.set("angle",g),C&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(g,C){C=C||this.canvas.getPointer(g);var L=new l.Point(C.x,C.y),B=this._getLeftTopCoords();return this.angle&&(L=l.util.rotatePoint(L,B,c(-this.angle))),{x:L.x-B.x,y:L.y-B.y}},_setupCompositeOperation:function(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){l.runningAnimations&&l.runningAnimations.cancelByTarget(this)}}),l.util.createAccessors&&l.util.createAccessors(l.Object),v(l.Object.prototype,l.Observable),l.Object.NUM_FRACTION_DIGITS=2,l.Object.ENLIVEN_PROPS=["clipPath"],l.Object._fromObject=function(g,C,L,B){var q=l[g];C=x(C,!0),l.util.enlivenPatterns([C.fill,C.stroke],function(K){typeof K[0]<"u"&&(C.fill=K[0]),typeof K[1]<"u"&&(C.stroke=K[1]),l.util.enlivenObjectEnlivables(C,C,function(){var se=B?new q(C[B],C):new q(C);L&&L(se)})})},l.Object.__uid=0)}(M),function(){var t=f.util.degreesToRadians,l={left:-.5,center:0,right:.5},v={top:-.5,center:0,bottom:.5};f.util.object.extend(f.Object.prototype,{translateToGivenOrigin:function(x,d,m,c,_){var w=x.x,g=x.y,C,L,B;return typeof d=="string"?d=l[d]:d-=.5,typeof c=="string"?c=l[c]:c-=.5,C=c-d,typeof m=="string"?m=v[m]:m-=.5,typeof _=="string"?_=v[_]:_-=.5,L=_-m,(C||L)&&(B=this._getTransformedDimensions(),w=x.x+C*B.x,g=x.y+L*B.y),new f.Point(w,g)},translateToCenterPoint:function(x,d,m){var c=this.translateToGivenOrigin(x,d,m,"center","center");return this.angle?f.util.rotatePoint(c,x,t(this.angle)):c},translateToOriginPoint:function(x,d,m){var c=this.translateToGivenOrigin(x,"center","center",d,m);return this.angle?f.util.rotatePoint(c,x,t(this.angle)):c},getCenterPoint:function(){var x=new f.Point(this.left,this.top);return this.translateToCenterPoint(x,this.originX,this.originY)},getPointByOrigin:function(x,d){var m=this.getCenterPoint();return this.translateToOriginPoint(m,x,d)},toLocalPoint:function(x,d,m){var c=this.getCenterPoint(),_,w;return typeof d<"u"&&typeof m<"u"?_=this.translateToGivenOrigin(c,"center","center",d,m):_=new f.Point(this.left,this.top),w=new f.Point(x.x,x.y),this.angle&&(w=f.util.rotatePoint(w,c,-t(this.angle))),w.subtractEquals(_)},setPositionByOrigin:function(x,d,m){var c=this.translateToCenterPoint(x,d,m),_=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",_.x),this.set("top",_.y)},adjustPosition:function(x){var d=t(this.angle),m=this.getScaledWidth(),c=f.util.cos(d)*m,_=f.util.sin(d)*m,w,g;typeof this.originX=="string"?w=l[this.originX]:w=this.originX-.5,typeof x=="string"?g=l[x]:g=x-.5,this.left+=c*(g-w),this.top+=_*(g-w),this.setCoords(),this.originX=x},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var x=this.getCenterPoint();this.originX="center",this.originY="center",this.left=x.x,this.top=x.y},_resetOrigin:function(){var x=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=x.x,this.top=x.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function t(m){return[new f.Point(m.tl.x,m.tl.y),new f.Point(m.tr.x,m.tr.y),new f.Point(m.br.x,m.br.y),new f.Point(m.bl.x,m.bl.y)]}var l=f.util,v=l.degreesToRadians,x=l.multiplyTransformMatrices,d=l.transformPoint;l.object.extend(f.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(m,c){return c?m?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),m?this.aCoords:this.lineCoords)},getCoords:function(m,c){return t(this._getCoords(m,c))},intersectsWithRect:function(m,c,_,w){var g=this.getCoords(_,w),C=f.Intersection.intersectPolygonRectangle(g,m,c);return C.status==="Intersection"},intersectsWithObject:function(m,c,_){var w=f.Intersection.intersectPolygonPolygon(this.getCoords(c,_),m.getCoords(c,_));return w.status==="Intersection"||m.isContainedWithinObject(this,c,_)||this.isContainedWithinObject(m,c,_)},isContainedWithinObject:function(m,c,_){for(var w=this.getCoords(c,_),g=c?m.aCoords:m.lineCoords,C=0,L=m._getImageLines(g);C<4;C++)if(!m.containsPoint(w[C],L))return!1;return!0},isContainedWithinRect:function(m,c,_,w){var g=this.getBoundingRect(_,w);return g.left>=m.x&&g.left+g.width<=c.x&&g.top>=m.y&&g.top+g.height<=c.y},containsPoint:function(m,C,_,w){var g=this._getCoords(_,w),C=C||this._getImageLines(g),L=this._findCrossPoints(m,C);return L!==0&&L%2===1},isOnScreen:function(m){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,_=this.canvas.vptCoords.br,w=this.getCoords(!0,m);return w.some(function(g){return g.x<=_.x&&g.x>=c.x&&g.y<=_.y&&g.y>=c.y})||this.intersectsWithRect(c,_,!0,m)?!0:this._containsCenterOfCanvas(c,_,m)},_containsCenterOfCanvas:function(m,c,_){var w={x:(m.x+c.x)/2,y:(m.y+c.y)/2};return!!this.containsPoint(w,null,!0,_)},isPartiallyOnScreen:function(m){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,_=this.canvas.vptCoords.br;if(this.intersectsWithRect(c,_,!0,m))return!0;var w=this.getCoords(!0,m).every(function(g){return(g.x>=_.x||g.x<=c.x)&&(g.y>=_.y||g.y<=c.y)});return w&&this._containsCenterOfCanvas(c,_,m)},_getImageLines:function(m){var c={topline:{o:m.tl,d:m.tr},rightline:{o:m.tr,d:m.br},bottomline:{o:m.br,d:m.bl},leftline:{o:m.bl,d:m.tl}};return c},_findCrossPoints:function(m,c){var _,w,g,C,L,B=0,q;for(var K in c)if(q=c[K],!(q.o.y<m.y&&q.d.y<m.y)&&!(q.o.y>=m.y&&q.d.y>=m.y)&&(q.o.x===q.d.x&&q.o.x>=m.x?L=q.o.x:(_=0,w=(q.d.y-q.o.y)/(q.d.x-q.o.x),g=m.y-_*m.x,C=q.o.y-w*q.o.x,L=-(g-C)/(_-w)),L>=m.x&&(B+=1),B===2))break;return B},getBoundingRect:function(m,c){var _=this.getCoords(m,c);return l.makeBoundingBoxFromPoints(_)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(m){return Math.abs(m)<this.minScaleLimit?m<0?-this.minScaleLimit:this.minScaleLimit:m===0?1e-4:m},scale:function(m){return this._set("scaleX",m),this._set("scaleY",m),this.setCoords()},scaleToWidth:function(m,c){var _=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(m/this.width/_)},scaleToHeight:function(m,c){var _=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(m/this.height/_)},calcLineCoords:function(){var m=this.getViewportTransform(),c=this.padding,_=v(this.angle),w=l.cos(_),g=l.sin(_),C=w*c,L=g*c,B=C+L,q=C-L,K=this.calcACoords(),se={tl:d(K.tl,m),tr:d(K.tr,m),bl:d(K.bl,m),br:d(K.br,m)};return c&&(se.tl.x-=q,se.tl.y-=B,se.tr.x+=B,se.tr.y-=q,se.bl.x-=B,se.bl.y+=q,se.br.x+=q,se.br.y+=B),se},calcOCoords:function(){var m=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),_=this.getViewportTransform(),w=x(_,c),g=x(w,m),g=x(g,[1/_[0],0,0,1/_[3],0,0]),C=this._calculateCurrentDimensions(),L={};return this.forEachControl(function(B,q,K){L[q]=B.positionHandler(C,g,K)}),L},calcACoords:function(){var m=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),_=x(c,m),w=this._getTransformedDimensions(),g=w.x/2,C=w.y/2;return{tl:d({x:-g,y:-C},_),tr:d({x:g,y:-C},_),bl:d({x:-g,y:C},_),br:d({x:g,y:C},_)}},setCoords:function(m){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),m?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return l.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var m=this.getCenterPoint();return[1,0,0,1,m.x,m.y]},transformMatrixKey:function(m){var c="_",_="";return!m&&this.group&&(_=this.group.transformMatrixKey(m)+c),_+this.top+c+this.left+c+this.scaleX+c+this.scaleY+c+this.skewX+c+this.skewY+c+this.angle+c+this.originX+c+this.originY+c+this.width+c+this.height+c+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(m){var c=this.calcOwnMatrix();if(m||!this.group)return c;var _=this.transformMatrixKey(m),w=this.matrixCache||(this.matrixCache={});return w.key===_?w.value:(this.group&&(c=x(this.group.calcTransformMatrix(!1),c)),w.key=_,w.value=c,c)},calcOwnMatrix:function(){var m=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===m)return c.value;var _=this._calcTranslateMatrix(),w={angle:this.angle,translateX:_[4],translateY:_[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return c.key=m,c.value=l.composeMatrix(w),c.value},_getNonTransformedDimensions:function(){var m=this.strokeWidth,c=this.width+m,_=this.height+m;return{x:c,y:_}},_getTransformedDimensions:function(m,c){typeof m>"u"&&(m=this.skewX),typeof c>"u"&&(c=this.skewY);var _,w,g,C=m===0&&c===0;if(this.strokeUniform?(w=this.width,g=this.height):(_=this._getNonTransformedDimensions(),w=_.x,g=_.y),C)return this._finalizeDimensions(w*this.scaleX,g*this.scaleY);var L=l.sizeAfterTransform(w,g,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:m,skewY:c});return this._finalizeDimensions(L.x,L.y)},_finalizeDimensions:function(m,c){return this.strokeUniform?{x:m+this.strokeWidth,y:c+this.strokeWidth}:{x:m,y:c}},_calculateCurrentDimensions:function(){var m=this.getViewportTransform(),c=this._getTransformedDimensions(),_=d(c,m,!0);return _.scalarAdd(2*this.padding)}})}(),f.util.object.extend(f.Object.prototype,{sendToBack:function(){return this.group?f.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?f.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?f.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas&&this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?f.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas&&this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&this.group.type!=="activeSelection"?f.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas&&this.canvas.moveTo(this,t),this}}),function(){function t(v,x){if(x){if(x.toLive)return v+": url(#SVGID_"+x.id+"); ";var d=new f.Color(x),m=v+": "+d.toRgb()+"; ",c=d.getAlpha();return c!==1&&(m+=v+"-opacity: "+c.toString()+"; "),m}else return v+": none; "}var l=f.util.toFixed;f.util.object.extend(f.Object.prototype,{getSvgStyles:function(v){var x=this.fillRule?this.fillRule:"nonzero",d=this.strokeWidth?this.strokeWidth:"0",m=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",_=this.strokeLineCap?this.strokeLineCap:"butt",w=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",C=typeof this.opacity<"u"?this.opacity:"1",L=this.visible?"":" visibility: hidden;",B=v?"":this.getSvgFilter(),q=t("fill",this.fill),K=t("stroke",this.stroke);return[K,"stroke-width: ",d,"; ","stroke-dasharray: ",m,"; ","stroke-linecap: ",_,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",w,"; ","stroke-miterlimit: ",g,"; ",q,"fill-rule: ",x,"; ","opacity: ",C,";",B,L].join("")},getSvgSpanStyles:function(v,x){var d="; ",c=v.fontFamily?"font-family: "+(v.fontFamily.indexOf("'")===-1&&v.fontFamily.indexOf('"')===-1?"'"+v.fontFamily+"'":v.fontFamily)+d:"",m=v.strokeWidth?"stroke-width: "+v.strokeWidth+d:"",c=c,_=v.fontSize?"font-size: "+v.fontSize+"px"+d:"",w=v.fontStyle?"font-style: "+v.fontStyle+d:"",g=v.fontWeight?"font-weight: "+v.fontWeight+d:"",C=v.fill?t("fill",v.fill):"",L=v.stroke?t("stroke",v.stroke):"",B=this.getSvgTextDecoration(v),q=v.deltaY?"baseline-shift: "+-v.deltaY+"; ":"";return B&&(B="text-decoration: "+B+d),[L,m,c,_,w,g,B,C,q,x?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(v){return["overline","underline","line-through"].filter(function(x){return v[x.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(v,x){var d=v?this.calcTransformMatrix():this.calcOwnMatrix(),m='transform="'+f.util.matrixToSVG(d);return m+(x||"")+'" '},_setSVGBg:function(v){if(this.backgroundColor){var x=f.Object.NUM_FRACTION_DIGITS;v.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',l(-this.width/2,x),'" y="',l(-this.height/2,x),'" width="',l(this.width,x),'" height="',l(this.height,x),`"></rect>
`)}},toSVG:function(v){return this._createBaseSVGMarkup(this._toSVG(v),{reviver:v})},toClipPathSVG:function(v){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(v),{reviver:v})},_createBaseClipPathSVGMarkup:function(v,x){x=x||{};var d=x.reviver,m=x.additionalTransform||"",c=[this.getSvgTransform(!0,m),this.getSvgCommons()].join(""),_=v.indexOf("COMMON_PARTS");return v[_]=c,d?d(v.join("")):v.join("")},_createBaseSVGMarkup:function(v,x){x=x||{};var d=x.noStyle,m=x.reviver,c=d?"":'style="'+this.getSvgStyles()+'" ',_=x.withShadow?'style="'+this.getSvgFilter()+'" ':"",w=this.clipPath,g=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",C=w&&w.absolutePositioned,L=this.stroke,B=this.fill,q=this.shadow,K,se=[],he,le=v.indexOf("COMMON_PARTS"),ve=x.additionalTransform;return w&&(w.clipPathId="CLIPPATH_"+f.Object.__uid++,he='<clipPath id="'+w.clipPathId+`" >
`+w.toClipPathSVG(m)+`</clipPath>
`),C&&se.push("<g ",_,this.getSvgCommons(),` >
`),se.push("<g ",this.getSvgTransform(!1),C?"":_+this.getSvgCommons(),` >
`),K=[c,g,d?"":this.addPaintOrder()," ",ve?'transform="'+ve+'" ':""].join(""),v[le]=K,B&&B.toLive&&se.push(B.toSVG(this)),L&&L.toLive&&se.push(L.toSVG(this)),q&&se.push(q.toSVG(this)),w&&se.push(he),se.push(v.join("")),se.push(`</g>
`),C&&se.push(`</g>
`),m?m(se.join("")):se.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var t=f.util.object.extend,l="stateProperties";function v(d,m,c){var _={},w=!0;c.forEach(function(g){_[g]=d[g]}),t(d[m],_,w)}function x(d,m,c){if(d===m)return!0;if(Array.isArray(d)){if(!Array.isArray(m)||d.length!==m.length)return!1;for(var _=0,w=d.length;_<w;_++)if(!x(d[_],m[_]))return!1;return!0}else if(d&&typeof d=="object"){var g=Object.keys(d),C;if(!m||typeof m!="object"||!c&&g.length!==Object.keys(m).length)return!1;for(var _=0,w=g.length;_<w;_++)if(C=g[_],!(C==="canvas"||C==="group")&&!x(d[C],m[C]))return!1;return!0}}f.util.object.extend(f.Object.prototype,{hasStateChanged:function(d){d=d||l;var m="_"+d;return Object.keys(this[m]).length<this[d].length?!0:!x(this[m],this,!0)},saveState:function(d){var m=d&&d.propertySet||l,c="_"+m;return this[c]?(v(this,c,this[m]),d&&d.stateProperties&&v(this,c,d.stateProperties),this):this.setupState(d)},setupState:function(d){d=d||{};var m=d.propertySet||l;return d.propertySet=m,this["_"+m]={},this.saveState(d),this}})}(),function(){var t=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{_findTargetCorner:function(l,v){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var x=l.x,d=l.y,m,c,_=Object.keys(this.oCoords),w=_.length-1,g;for(this.__corner=0;w>=0;w--)if(g=_[w],!!this.isControlVisible(g)&&(c=this._getImageLines(v?this.oCoords[g].touchCorner:this.oCoords[g].corner),m=this._findCrossPoints({x,y:d},c),m!==0&&m%2===1))return this.__corner=g,g;return!1},forEachControl:function(l){for(var v in this.controls)l(this.controls[v],v,this)},_setCornerCoords:function(){var l=this.oCoords;for(var v in l){var x=this.controls[v];l[v].corner=x.calcCornerCoords(this.angle,this.cornerSize,l[v].x,l[v].y,!1),l[v].touchCorner=x.calcCornerCoords(this.angle,this.touchCornerSize,l[v].x,l[v].y,!0)}},drawSelectionBackground:function(l){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;l.save();var v=this.getCenterPoint(),x=this._calculateCurrentDimensions(),d=this.canvas.viewportTransform;return l.translate(v.x,v.y),l.scale(1/d[0],1/d[3]),l.rotate(t(this.angle)),l.fillStyle=this.selectionBackgroundColor,l.fillRect(-x.x/2,-x.y/2,x.x,x.y),l.restore(),this},drawBorders:function(l,v){v=v||{};var x=this._calculateCurrentDimensions(),d=this.borderScaleFactor,m=x.x+d,c=x.y+d,_=typeof v.hasControls<"u"?v.hasControls:this.hasControls,w=!1;return l.save(),l.strokeStyle=v.borderColor||this.borderColor,this._setLineDash(l,v.borderDashArray||this.borderDashArray),l.strokeRect(-m/2,-c/2,m,c),_&&(l.beginPath(),this.forEachControl(function(g,C,L){g.withConnection&&g.getVisibility(L,C)&&(w=!0,l.moveTo(g.x*m,g.y*c),l.lineTo(g.x*m+g.offsetX,g.y*c+g.offsetY))}),w&&l.stroke()),l.restore(),this},drawBordersInGroup:function(l,v,x){x=x||{};var d=f.util.sizeAfterTransform(this.width,this.height,v),m=this.strokeWidth,c=this.strokeUniform,_=this.borderScaleFactor,w=d.x+m*(c?this.canvas.getZoom():v.scaleX)+_,g=d.y+m*(c?this.canvas.getZoom():v.scaleY)+_;return l.save(),this._setLineDash(l,x.borderDashArray||this.borderDashArray),l.strokeStyle=x.borderColor||this.borderColor,l.strokeRect(-w/2,-g/2,w,g),l.restore(),this},drawControls:function(l,v){v=v||{},l.save();var x=this.canvas.getRetinaScaling(),d,m;return l.setTransform(x,0,0,x,0,0),l.strokeStyle=l.fillStyle=v.cornerColor||this.cornerColor,this.transparentCorners||(l.strokeStyle=v.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(l,v.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(d=this.group.calcTransformMatrix()),this.forEachControl(function(c,_,w){m=w.oCoords[_],c.getVisibility(w,_)&&(d&&(m=f.util.transformPoint(m,d)),c.render(l,m.x,m.y,v,w))}),l.restore(),this},isControlVisible:function(l){return this.controls[l]&&this.controls[l].getVisibility(this,l)},setControlVisible:function(l,v){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[l]=v,this},setControlsVisibility:function(l){l||(l={});for(var v in l)this.setControlVisible(v,l[v]);return this},onDeselect:function(){},onSelect:function(){}})}(),f.util.object.extend(f.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,l){l=l||{};var v=function(){},x=l.onComplete||v,d=l.onChange||v,m=this;return f.util.animate({target:this,startValue:t.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){t.set("left",c),m.requestRenderAll(),d()},onComplete:function(){t.setCoords(),x()}})},fxCenterObjectV:function(t,l){l=l||{};var v=function(){},x=l.onComplete||v,d=l.onChange||v,m=this;return f.util.animate({target:this,startValue:t.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){t.set("top",c),m.requestRenderAll(),d()},onComplete:function(){t.setCoords(),x()}})},fxRemove:function(t,l){l=l||{};var v=function(){},x=l.onComplete||v,d=l.onChange||v,m=this;return f.util.animate({target:this,startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){t.set("opacity",c),m.requestRenderAll(),d()},onComplete:function(){m.remove(t),x()}})}}),f.util.object.extend(f.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var t=[],l,v,x=[];for(l in arguments[0])t.push(l);for(var d=0,m=t.length;d<m;d++)l=t[d],v=d!==m-1,x.push(this._animate(l,arguments[0][l],arguments[1],v));return x}else return this._animate.apply(this,arguments)},_animate:function(t,l,v,x){var d=this,m;l=l.toString(),v?v=f.util.object.clone(v):v={},~t.indexOf(".")&&(m=t.split("."));var c=d.colorProperties.indexOf(t)>-1||m&&d.colorProperties.indexOf(m[1])>-1,_=m?this.get(m[0])[m[1]]:this.get(t);"from"in v||(v.from=_),c||(~l.indexOf("=")?l=_+parseFloat(l.replace("=","")):l=parseFloat(l));var w={target:this,startValue:v.from,endValue:l,byValue:v.by,easing:v.easing,duration:v.duration,abort:v.abort&&function(g,C,L){return v.abort.call(d,g,C,L)},onChange:function(g,C,L){m?d[m[0]][m[1]]=g:d.set(t,g),!x&&v.onChange&&v.onChange(g,C,L)},onComplete:function(g,C,L){x||(d.setCoords(),v.onComplete&&v.onComplete(g,C,L))}};return c?f.util.animateColor(w.startValue,w.endValue,w.duration,w):f.util.animate(w)}}),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.util.object.clone,d={x1:1,x2:1,y1:1,y2:1};if(l.Line){l.warn("fabric.Line is already defined");return}l.Line=l.util.createClass(l.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:l.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,_){c||(c=[0,0,0,0]),this.callSuper("initialize",_),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(_)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,_){return this.callSuper("_set",c,_),typeof d[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:m({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:m({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var _=this.calcLinePoints();c.moveTo(_.x1,_.y1),c.lineTo(_.x2,_.y2),c.lineWidth=this.strokeWidth;var w=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=w},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return v(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,_=this.y1<=this.y2?-1:1,w=c*this.width*.5,g=_*this.height*.5,C=c*this.width*-.5,L=_*this.height*-.5;return{x1:w,x2:C,y1:g,y2:L}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),l.Line.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),l.Line.fromElement=function(c,_,w){w=w||{};var g=l.parseAttributes(c,l.Line.ATTRIBUTE_NAMES),C=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];_(new l.Line(C,v(g,w)))},l.Line.fromObject=function(c,_){function w(C){delete C.points,_&&_(C)}var g=x(c,!0);g.points=[c.x1,c.y1,c.x2,c.y2],l.Object._fromObject("Line",g,w,"points")};function m(c,_){var w=c.origin,g=c.axis1,C=c.axis2,L=c.dimension,B=_.nearest,q=_.center,K=_.farthest;return function(){switch(this.get(w)){case B:return Math.min(this.get(g),this.get(C));case q:return Math.min(this.get(g),this.get(C))+.5*this.get(L);case K:return Math.max(this.get(g),this.get(C))}}}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.degreesToRadians;if(l.Circle){l.warn("fabric.Circle is already defined.");return}l.Circle=l.util.createClass(l.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:l.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(d,m){return this.callSuper("_set",d,m),d==="radius"&&this.setRadius(m),this},toObject:function(d){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(d))},_toSVG:function(){var d,m=0,c=0,_=(this.endAngle-this.startAngle)%360;if(_===0)d=["<circle ","COMMON_PARTS",'cx="'+m+'" cy="'+c+'" ','r="',this.radius,`" />
`];else{var w=v(this.startAngle),g=v(this.endAngle),C=this.radius,L=l.util.cos(w)*C,B=l.util.sin(w)*C,q=l.util.cos(g)*C,K=l.util.sin(g)*C,se=_>180?"1":"0";d=['<path d="M '+L+" "+B," A "+C+" "+C," 0 ",+se+" 1"," "+q+" "+K,'" ',"COMMON_PARTS",` />
`]}return d},_render:function(d){d.beginPath(),d.arc(0,0,this.radius,v(this.startAngle),v(this.endAngle),!1),this._renderPaintInOrder(d)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(d){return this.radius=d,this.set("width",d*2).set("height",d*2)}}),l.Circle.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),l.Circle.fromElement=function(d,m){var c=l.parseAttributes(d,l.Circle.ATTRIBUTE_NAMES);if(!x(c))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,m(new l.Circle(c))};function x(d){return"radius"in d&&d.radius>=0}l.Circle.fromObject=function(d,m){l.Object._fromObject("Circle",d,m)}}(M),function(t){var l=t.fabric||(t.fabric={});if(l.Triangle){l.warn("fabric.Triangle is already defined");return}l.Triangle=l.util.createClass(l.Object,{type:"triangle",width:100,height:100,_render:function(v){var x=this.width/2,d=this.height/2;v.beginPath(),v.moveTo(-x,d),v.lineTo(0,-d),v.lineTo(x,d),v.closePath(),this._renderPaintInOrder(v)},_toSVG:function(){var v=this.width/2,x=this.height/2,d=[-v+" "+x,"0 "+-x,v+" "+x].join(",");return["<polygon ","COMMON_PARTS",'points="',d,'" />']}}),l.Triangle.fromObject=function(v,x){return l.Object._fromObject("Triangle",v,x)}}(M),function(t){var l=t.fabric||(t.fabric={}),v=Math.PI*2;if(l.Ellipse){l.warn("fabric.Ellipse is already defined.");return}l.Ellipse=l.util.createClass(l.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:l.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(x){this.callSuper("initialize",x),this.set("rx",x&&x.rx||0),this.set("ry",x&&x.ry||0)},_set:function(x,d){switch(this.callSuper("_set",x,d),x){case"rx":this.rx=d,this.set("width",d*2);break;case"ry":this.ry=d,this.set("height",d*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(x){return this.callSuper("toObject",["rx","ry"].concat(x))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(x){x.beginPath(),x.save(),x.transform(1,0,0,this.ry/this.rx,0,0),x.arc(0,0,this.rx,0,v,!1),x.restore(),this._renderPaintInOrder(x)}}),l.Ellipse.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),l.Ellipse.fromElement=function(x,d){var m=l.parseAttributes(x,l.Ellipse.ATTRIBUTE_NAMES);m.left=(m.left||0)-m.rx,m.top=(m.top||0)-m.ry,d(new l.Ellipse(m))},l.Ellipse.fromObject=function(x,d){l.Object._fromObject("Ellipse",x,d)}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend;if(l.Rect){l.warn("fabric.Rect is already defined");return}l.Rect=l.util.createClass(l.Object,{stateProperties:l.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:l.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(x){this.callSuper("initialize",x),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(x){var d=this.rx?Math.min(this.rx,this.width/2):0,m=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,_=this.height,w=-this.width/2,g=-this.height/2,C=d!==0||m!==0,L=1-.5522847498;x.beginPath(),x.moveTo(w+d,g),x.lineTo(w+c-d,g),C&&x.bezierCurveTo(w+c-L*d,g,w+c,g+L*m,w+c,g+m),x.lineTo(w+c,g+_-m),C&&x.bezierCurveTo(w+c,g+_-L*m,w+c-L*d,g+_,w+c-d,g+_),x.lineTo(w+d,g+_),C&&x.bezierCurveTo(w+L*d,g+_,w,g+_-L*m,w,g+_-m),x.lineTo(w,g+m),C&&x.bezierCurveTo(w,g+L*m,w+L*d,g,w+d,g),x.closePath(),this._renderPaintInOrder(x)},toObject:function(x){return this.callSuper("toObject",["rx","ry"].concat(x))},_toSVG:function(){var x=-this.width/2,d=-this.height/2;return["<rect ","COMMON_PARTS",'x="',x,'" y="',d,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),l.Rect.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),l.Rect.fromElement=function(x,d,m){if(!x)return d(null);m=m||{};var c=l.parseAttributes(x,l.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var _=new l.Rect(v(m?l.util.object.clone(m):{},c));_.visible=_.visible&&_.width>0&&_.height>0,d(_)},l.Rect.fromObject=function(x,d){return l.Object._fromObject("Rect",x,d)}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.util.array.min,d=l.util.array.max,m=l.util.toFixed,c=l.util.projectStrokeOnPoints;if(l.Polyline){l.warn("fabric.Polyline is already defined");return}l.Polyline=l.util.createClass(l.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:l.Object.prototype.cacheProperties.concat("points"),initialize:function(_,w){w=w||{},this.points=_||[],this.callSuper("initialize",w),this._setPositionDimensions(w)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(_){var w=this._calcDimensions(_),g,C=this.exactBoundingBox?this.strokeWidth:0;this.width=w.width-C,this.height=w.height-C,_.fromSVG||(g=this.translateToGivenOrigin({x:w.left-this.strokeWidth/2+C/2,y:w.top-this.strokeWidth/2+C/2},"left","top",this.originX,this.originY)),typeof _.left>"u"&&(this.left=_.fromSVG?w.left:g.x),typeof _.top>"u"&&(this.top=_.fromSVG?w.top:g.y),this.pathOffset={x:w.left+this.width/2+C/2,y:w.top+this.height/2+C/2}},_calcDimensions:function(){var _=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,w=x(_,"x")||0,g=x(_,"y")||0,C=d(_,"x")||0,L=d(_,"y")||0,B=C-w,q=L-g;return{left:w,top:g,width:B,height:q}},toObject:function(_){return v(this.callSuper("toObject",_),{points:this.points.concat()})},_toSVG:function(){for(var _=[],w=this.pathOffset.x,g=this.pathOffset.y,C=l.Object.NUM_FRACTION_DIGITS,L=0,B=this.points.length;L<B;L++)_.push(m(this.points[L].x-w,C),",",m(this.points[L].y-g,C)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',_.join(""),`" />
`]},commonRender:function(_){var w,g=this.points.length,C=this.pathOffset.x,L=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;_.beginPath(),_.moveTo(this.points[0].x-C,this.points[0].y-L);for(var B=0;B<g;B++)w=this.points[B],_.lineTo(w.x-C,w.y-L);return!0},_render:function(_){this.commonRender(_)&&this._renderPaintInOrder(_)},complexity:function(){return this.get("points").length}}),l.Polyline.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat(),l.Polyline.fromElementGenerator=function(_){return function(w,g,C){if(!w)return g(null);C||(C={});var L=l.parsePointsAttribute(w.getAttribute("points")),B=l.parseAttributes(w,l[_].ATTRIBUTE_NAMES);B.fromSVG=!0,g(new l[_](L,v(B,C)))}},l.Polyline.fromElement=l.Polyline.fromElementGenerator("Polyline"),l.Polyline.fromObject=function(_,w){return l.Object._fromObject("Polyline",_,w,"points")}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.projectStrokeOnPoints;if(l.Polygon){l.warn("fabric.Polygon is already defined");return}l.Polygon=l.util.createClass(l.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return v(this.points,this)},_render:function(x){this.commonRender(x)&&(x.closePath(),this._renderPaintInOrder(x))}}),l.Polygon.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat(),l.Polygon.fromElement=l.Polyline.fromElementGenerator("Polygon"),l.Polygon.fromObject=function(x,d){l.Object._fromObject("Polygon",x,d,"points")}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.array.min,x=l.util.array.max,d=l.util.object.extend,m=l.util.object.clone,c=l.util.toFixed;if(l.Path){l.warn("fabric.Path is already defined");return}l.Path=l.util.createClass(l.Object,{type:"path",path:null,cacheProperties:l.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:l.Object.prototype.stateProperties.concat("path"),initialize:function(_,w){w=m(w||{}),delete w.path,this.callSuper("initialize",w),this._setPath(_||[],w)},_setPath:function(_,w){this.path=l.util.makePathSimpler(Array.isArray(_)?_:l.util.parsePath(_)),l.Polyline.prototype._setPositionDimensions.call(this,w||{})},_renderPathCommands:function(_){var w,g=0,C=0,L=0,B=0,q=0,K=0,se=-this.pathOffset.x,he=-this.pathOffset.y;_.beginPath();for(var le=0,ve=this.path.length;le<ve;++le)switch(w=this.path[le],w[0]){case"L":L=w[1],B=w[2],_.lineTo(L+se,B+he);break;case"M":L=w[1],B=w[2],g=L,C=B,_.moveTo(L+se,B+he);break;case"C":L=w[5],B=w[6],q=w[3],K=w[4],_.bezierCurveTo(w[1]+se,w[2]+he,q+se,K+he,L+se,B+he);break;case"Q":_.quadraticCurveTo(w[1]+se,w[2]+he,w[3]+se,w[4]+he),L=w[3],B=w[4],q=w[1],K=w[2];break;case"z":case"Z":L=g,B=C,_.closePath();break}},_render:function(_){this._renderPathCommands(_),this._renderPaintInOrder(_)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(_){return d(this.callSuper("toObject",_),{path:this.path.map(function(w){return w.slice()})})},toDatalessObject:function(_){var w=this.toObject(["sourcePath"].concat(_));return w.sourcePath&&delete w.path,w},_toSVG:function(){var _=l.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',_,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var _=l.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,_)+", "+c(-this.pathOffset.y,_)+")"},toClipPathSVG:function(_){var w=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:w})},toSVG:function(_){var w=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:w})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var _=[],w=[],g,C=0,L=0,B=0,q=0,K,se=0,he=this.path.length;se<he;++se){switch(g=this.path[se],g[0]){case"L":B=g[1],q=g[2],K=[];break;case"M":B=g[1],q=g[2],C=B,L=q,K=[];break;case"C":K=l.util.getBoundsOfCurve(B,q,g[1],g[2],g[3],g[4],g[5],g[6]),B=g[5],q=g[6];break;case"Q":K=l.util.getBoundsOfCurve(B,q,g[1],g[2],g[1],g[2],g[3],g[4]),B=g[3],q=g[4];break;case"z":case"Z":B=C,q=L;break}K.forEach(function(De){_.push(De.x),w.push(De.y)}),_.push(B),w.push(q)}var le=v(_)||0,ve=v(w)||0,ot=x(_)||0,_e=x(w)||0,pe=ot-le,ze=_e-ve;return{left:le,top:ve,width:pe,height:ze}}}),l.Path.fromObject=function(_,w){if(typeof _.sourcePath=="string"){var g=_.sourcePath;l.loadSVGFromURL(g,function(C){var L=C[0];L.setOptions(_),_.clipPath?l.util.enlivenObjects([_.clipPath],function(B){L.clipPath=B[0],w&&w(L)}):w&&w(L)})}else l.Object._fromObject("Path",_,w,"path")},l.Path.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat(["d"]),l.Path.fromElement=function(_,w,g){var C=l.parseAttributes(_,l.Path.ATTRIBUTE_NAMES);C.fromSVG=!0,w(new l.Path(C.d,d(C,g)))}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.array.min,x=l.util.array.max;l.Group||(l.Group=l.util.createClass(l.Object,l.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(d,m,c){m=m||{},this._objects=[],c&&this.callSuper("initialize",m),this._objects=d||[];for(var _=this._objects.length;_--;)this._objects[_].group=this;if(c)this._updateObjectsACoords();else{var w=m&&m.centerPoint;m.originX!==void 0&&(this.originX=m.originX),m.originY!==void 0&&(this.originY=m.originY),w||this._calcBounds(),this._updateObjectsCoords(w),delete m.centerPoint,this.callSuper("initialize",m)}this.setCoords()},_updateObjectsACoords:function(){for(var d=!0,m=this._objects.length;m--;)this._objects[m].setCoords(d)},_updateObjectsCoords:function(m){for(var m=m||this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],m)},_updateObjectCoords:function(d,m){var c=d.left,_=d.top,w=!0;d.set({left:c-m.x,top:_-m.y}),d.group=this,d.setCoords(w)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(d){var m=!!this.group;return this._restoreObjectsState(),l.util.resetObjectTransform(this),d&&(m&&l.util.removeTransformFromObject(d,this.group.calcTransformMatrix()),this._objects.push(d),d.group=this,d._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,m?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(d){return this._restoreObjectsState(),l.util.resetObjectTransform(this),this.remove(d),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(d){this.dirty=!0,d.group=this,d._set("canvas",this.canvas)},_onObjectRemoved:function(d){this.dirty=!0,delete d.group},_set:function(d,m){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(d,m);if(d==="canvas")for(;c--;)this._objects[c]._set(d,m);l.Object.prototype._set.call(this,d,m)},toObject:function(d){var m=this.includeDefaultValues,c=this._objects.filter(function(w){return!w.excludeFromExport}).map(function(w){var g=w.includeDefaultValues;w.includeDefaultValues=m;var C=w.toObject(d);return w.includeDefaultValues=g,C}),_=l.Object.prototype.toObject.call(this,d);return _.objects=c,_},toDatalessObject:function(d){var m,c=this.sourcePath;if(c)m=c;else{var _=this.includeDefaultValues;m=this._objects.map(function(g){var C=g.includeDefaultValues;g.includeDefaultValues=_;var L=g.toDatalessObject(d);return g.includeDefaultValues=C,L})}var w=l.Object.prototype.toDatalessObject.call(this,d);return w.objects=m,w},render:function(d){this._transformDone=!0,this.callSuper("render",d),this._transformDone=!1},shouldCache:function(){var d=l.Object.prototype.shouldCache.call(this);if(d){for(var m=0,c=this._objects.length;m<c;m++)if(this._objects[m].willDrawShadow())return this.ownCaching=!1,!1}return d},willDrawShadow:function(){if(l.Object.prototype.willDrawShadow.call(this))return!0;for(var d=0,m=this._objects.length;d<m;d++)if(this._objects[d].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(d){for(var m=0,c=this._objects.length;m<c;m++)this._objects[m].render(d);this._drawClipPath(d,this.clipPath)},isCacheDirty:function(d){if(this.callSuper("isCacheDirty",d))return!0;if(!this.statefullCache)return!1;for(var m=0,c=this._objects.length;m<c;m++)if(this._objects[m].isCacheDirty(!0)){if(this._cacheCanvas){var _=this.cacheWidth/this.zoomX,w=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-_/2,-w/2,_,w)}return!0}return!1},_restoreObjectsState:function(){var d=this.calcOwnMatrix();return this._objects.forEach(function(m){l.util.addTransformToObject(m,d),delete m.group,m.setCoords()}),this},destroy:function(){return this._objects.forEach(function(d){d.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(d){d.dispose&&d.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var d=this._objects,m=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var _=new l.ActiveSelection([]);return _.set(c),_.type="activeSelection",m.remove(this),d.forEach(function(w){w.group=_,w.dirty=!0,m.add(w)}),_.canvas=m,_._objects=d,m._activeObject=_,_.setCoords(),_}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var d=!0;return this.forEachObject(function(m){m.setCoords(d)}),this},_calcBounds:function(d){for(var m=[],c=[],_,w,g,C=["tr","br","bl","tl"],L=0,B=this._objects.length,q,K=C.length;L<B;++L){for(_=this._objects[L],g=_.calcACoords(),q=0;q<K;q++)w=C[q],m.push(g[w].x),c.push(g[w].y);_.aCoords=g}this._getBounds(m,c,d)},_getBounds:function(d,m,c){var _=new l.Point(v(d),v(m)),w=new l.Point(x(d),x(m)),g=_.y||0,C=_.x||0,L=w.x-_.x||0,B=w.y-_.y||0;this.width=L,this.height=B,c||this.setPositionByOrigin({x:C,y:g},"left","top")},_toSVG:function(d){for(var m=["<g ","COMMON_PARTS",` >
`],c=0,_=this._objects.length;c<_;c++)m.push("		",this._objects[c].toSVG(d));return m.push(`</g>
`),m},getSvgStyles:function(){var d=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",m=this.visible?"":" visibility: hidden;";return[d,this.getSvgFilter(),m].join("")},toClipPathSVG:function(d){for(var m=[],c=0,_=this._objects.length;c<_;c++)m.push("	",this._objects[c].toClipPathSVG(d));return this._createBaseClipPathSVGMarkup(m,{reviver:d})}}),l.Group.fromObject=function(d,m){var c=d.objects,_=l.util.object.clone(d,!0);if(delete _.objects,typeof c=="string"){l.loadSVGFromURL(c,function(w){var g=l.util.groupSVGElements(w,d,c),C=_.clipPath;delete _.clipPath,g.set(_),C?l.util.enlivenObjects([C],function(L){g.clipPath=L[0],m&&m(g)}):m&&m(g)});return}l.util.enlivenObjects(c,function(w){l.util.enlivenObjectEnlivables(d,_,function(){m&&m(new l.Group(w,_,!0))})})})}(M),function(t){var l=t.fabric||(t.fabric={});l.ActiveSelection||(l.ActiveSelection=l.util.createClass(l.Group,{type:"activeSelection",initialize:function(v,x){x=x||{},this._objects=v||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;x.originX&&(this.originX=x.originX),x.originY&&(this.originY=x.originY),this._calcBounds(),this._updateObjectsCoords(),l.Object.prototype.initialize.call(this,x),this.setCoords()},toGroup:function(){var v=this._objects.concat();this._objects=[];var x=l.Object.prototype.toObject.call(this),d=new l.Group([]);if(delete x.type,d.set(x),v.forEach(function(c){c.canvas.remove(c),c.group=d}),d._objects=v,!this.canvas)return d;var m=this.canvas;return m.add(d),m._activeObject=d,d.setCoords(),d},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(v,x,d){v.save(),v.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",v,x),d=d||{},typeof d.hasControls>"u"&&(d.hasControls=!1),d.forActiveSelection=!0;for(var m=0,c=this._objects.length;m<c;m++)this._objects[m]._renderControls(v,d);v.restore()}}),l.ActiveSelection.fromObject=function(v,x){l.util.enlivenObjects(v.objects,function(d){delete v.objects,x&&x(new l.ActiveSelection(d,v,!0))})})}(M),function(t){var l=f.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image){f.warn("fabric.Image is already defined.");return}f.Image=f.util.createClass(f.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:f.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:f.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(v,x){x||(x={}),this.filters=[],this.cacheKey="texture"+f.Object.__uid++,this.callSuper("initialize",x),this._initElement(v,x)},getElement:function(){return this._element||{}},setElement:function(v,x){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=v,this._originalElement=v,this._initConfig(x),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(v){var x=f.filterBackend;x&&x.evictCachesForKey&&x.evictCachesForKey(v)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(v){f.util.cleanUpJsdomNode(this[v]),this[v]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var v=this.getElement();return{width:v.naturalWidth||v.width,height:v.naturalHeight||v.height}},_stroke:function(v){if(!(!this.stroke||this.strokeWidth===0)){var x=this.width/2,d=this.height/2;v.beginPath(),v.moveTo(-x,-d),v.lineTo(x,-d),v.lineTo(x,d),v.lineTo(-x,d),v.lineTo(-x,-d),v.closePath()}},toObject:function(v){var x=[];this.filters.forEach(function(m){m&&x.push(m.toObject())});var d=l(this.callSuper("toObject",["cropX","cropY"].concat(v)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:x});return this.resizeFilter&&(d.resizeFilter=this.resizeFilter.toObject()),d},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var v=[],x=[],d,m=this._element,c=-this.width/2,_=-this.height/2,w="",g="";if(!m)return[];if(this.hasCrop()){var C=f.Object.__uid++;v.push('<clipPath id="imageCrop_'+C+`">
`,'	<rect x="'+c+'" y="'+_+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),w=' clip-path="url(#imageCrop_'+C+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),x.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',_-this.cropY,'" width="',m.width||m.naturalWidth,'" height="',m.height||m.height,g,'"',w,`></image>
`),this.stroke||this.strokeDashArray){var L=this.fill;this.fill=null,d=["	<rect ",'x="',c,'" y="',_,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=L}return this.paintFirst!=="fill"?v=v.concat(d,x):v=v.concat(x,d),v},getSrc:function(v){var x=v?this._element:this._originalElement;return x?x.toDataURL?x.toDataURL():this.srcFromAttribute?x.getAttribute("src"):x.src:this.src||""},setSrc:function(v,x,d){return f.util.loadImage(v,function(m,c){this.setElement(m,d),this._setWidthHeight(),x&&x(this,c)},this,d&&d.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var v=this.resizeFilter,x=this.minimumScaleTrigger,d=this.getTotalObjectScaling(),m=d.scaleX,c=d.scaleY,_=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!v||m>x&&c>x){this._element=_,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=m,this._lastScaleY=c;return}f.filterBackend||(f.filterBackend=f.initFilterBackend());var w=f.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,C=_.width,L=_.height;w.width=C,w.height=L,this._element=w,this._lastScaleX=v.scaleX=m,this._lastScaleY=v.scaleY=c,f.filterBackend.applyFilters([v],_,C,L,this._element,g),this._filterScalingX=w.width/this._originalElement.width,this._filterScalingY=w.height/this._originalElement.height},applyFilters:function(v){if(v=v||this.filters||[],v=v.filter(function(_){return _&&!_.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),v.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var x=this._originalElement,d=x.naturalWidth||x.width,m=x.naturalHeight||x.height;if(this._element===this._originalElement){var c=f.util.createCanvasElement();c.width=d,c.height=m,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,d,m),this._lastScaleX=1,this._lastScaleY=1;return f.filterBackend||(f.filterBackend=f.initFilterBackend()),f.filterBackend.applyFilters(v,this._originalElement,d,m,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(v){f.util.setImageSmoothing(v,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(v),this._renderPaintInOrder(v)},drawCacheOnCanvas:function(v){f.util.setImageSmoothing(v,this.imageSmoothing),f.Object.prototype.drawCacheOnCanvas.call(this,v)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(v){var x=this._element;if(x){var d=this._filterScalingX,m=this._filterScalingY,c=this.width,_=this.height,w=Math.min,g=Math.max,C=g(this.cropX,0),L=g(this.cropY,0),B=x.naturalWidth||x.width,q=x.naturalHeight||x.height,K=C*d,se=L*m,he=w(c*d,B-K),le=w(_*m,q-se),ve=-c/2,ot=-_/2,_e=w(c,B/d-C),pe=w(_,q/m-L);x&&v.drawImage(x,K,se,he,le,ve,ot,_e,pe)}},_needsResize:function(){var v=this.getTotalObjectScaling();return v.scaleX!==this._lastScaleX||v.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(v,x){this.setElement(f.util.getById(v),x),f.util.addClass(this.getElement(),f.Image.CSS_CANVAS)},_initConfig:function(v){v||(v={}),this.setOptions(v),this._setWidthHeight(v)},_initFilters:function(v,x){v&&v.length?f.util.enlivenObjects(v,function(d){x&&x(d)},"fabric.Image.filters"):x&&x()},_setWidthHeight:function(v){v||(v={});var x=this.getElement();this.width=v.width||x.naturalWidth||x.width||0,this.height=v.height||x.naturalHeight||x.height||0},parsePreserveAspectRatioAttribute:function(){var v=f.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),x=this._element.width,d=this._element.height,m=1,c=1,_=0,w=0,g=0,C=0,L,B=this.width,q=this.height,K={width:B,height:q};return v&&(v.alignX!=="none"||v.alignY!=="none")?(v.meetOrSlice==="meet"&&(m=c=f.util.findScaleToFit(this._element,K),L=(B-x*m)/2,v.alignX==="Min"&&(_=-L),v.alignX==="Max"&&(_=L),L=(q-d*c)/2,v.alignY==="Min"&&(w=-L),v.alignY==="Max"&&(w=L)),v.meetOrSlice==="slice"&&(m=c=f.util.findScaleToCover(this._element,K),L=x-B/m,v.alignX==="Mid"&&(g=L/2),v.alignX==="Max"&&(g=L),L=d-q/c,v.alignY==="Mid"&&(C=L/2),v.alignY==="Max"&&(C=L),x=B/m,d=q/c)):(m=B/x,c=q/d),{width:x,height:d,scaleX:m,scaleY:c,offsetLeft:_,offsetTop:w,cropX:g,cropY:C}}}),f.Image.CSS_CANVAS="canvas-img",f.Image.prototype.getSvgSrc=f.Image.prototype.getSrc,f.Image.fromObject=function(v,x){var d=f.util.object.clone(v);f.util.loadImage(d.src,function(m,c){if(c){x&&x(null,!0);return}f.Image.prototype._initFilters.call(d,d.filters,function(_){d.filters=_||[],f.Image.prototype._initFilters.call(d,[d.resizeFilter],function(w){d.resizeFilter=w[0],f.util.enlivenObjectEnlivables(d,d,function(){var g=new f.Image(m,d);x(g,!1)})})})},null,d.crossOrigin)},f.Image.fromURL=function(v,x,d){f.util.loadImage(v,function(m,c){x&&x(new f.Image(m,d),c)},null,d&&d.crossOrigin)},f.Image.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),f.Image.fromElement=function(v,x,d){var m=f.parseAttributes(v,f.Image.ATTRIBUTE_NAMES);f.Image.fromURL(m["xlink:href"],x,l(d?f.util.object.clone(d):{},m))}}(M),f.util.object.extend(f.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return t>0?Math.round((t-1)/90)*90:Math.round(t/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(t){t=t||{};var l=function(){},v=t.onComplete||l,x=t.onChange||l,d=this;return f.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(m){d.rotate(m),x()},onComplete:function(){d.setCoords(),v()}})}}),f.util.object.extend(f.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function t(v,x){var d="precision "+x+` float;
void main(){}`,m=v.createShader(v.FRAGMENT_SHADER);return v.shaderSource(m,d),v.compileShader(m),!!v.getShaderParameter(m,v.COMPILE_STATUS)}f.isWebglSupported=function(v){if(f.isLikelyNode)return!1;v=v||f.WebglFilterBackend.prototype.tileSize;var x=document.createElement("canvas"),d=x.getContext("webgl")||x.getContext("experimental-webgl"),m=!1;if(d){f.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),m=f.maxTextureSize>=v;for(var c=["highp","mediump","lowp"],_=0;_<3;_++)if(t(d,c[_])){f.webGlPrecision=c[_];break}}return this.isSupported=m,m},f.WebglFilterBackend=l;function l(v){v&&v.tileSize&&(this.tileSize=v.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}l.prototype={tileSize:2048,resources:{},setupGLContext:function(v,x){this.dispose(),this.createWebGLCanvas(v,x),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(v,x)},chooseFastestCopyGLTo2DMethod:function(v,x){var d=typeof window.performance<"u",m;try{new ImageData(1,1),m=!0}catch{m=!1}var c=typeof ArrayBuffer<"u",_=typeof Uint8ClampedArray<"u";if(d&&m&&c&&_){var w=f.util.createCanvasElement(),g=new ArrayBuffer(v*x*4);if(f.forceGLPutImageData){this.imageBuffer=g,this.copyGLTo2D=V;return}var C={imageBuffer:g,destinationWidth:v,destinationHeight:x,targetCanvas:w},L,B,q;w.width=v,w.height=x,L=window.performance.now(),z.call(C,this.gl,C),B=window.performance.now()-L,L=window.performance.now(),V.call(C,this.gl,C),q=window.performance.now()-L,B>q?(this.imageBuffer=g,this.copyGLTo2D=V):this.copyGLTo2D=z}},createWebGLCanvas:function(v,x){var d=f.util.createCanvasElement();d.width=v,d.height=x;var m={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=d.getContext("webgl",m);c||(c=d.getContext("experimental-webgl",m)),c&&(c.clearColor(0,0,0,0),this.canvas=d,this.gl=c)},applyFilters:function(v,x,d,m,c,_){var w=this.gl,g;_&&(g=this.getCachedTexture(_,x));var C={originalWidth:x.width||x.originalWidth,originalHeight:x.height||x.originalHeight,sourceWidth:d,sourceHeight:m,destinationWidth:d,destinationHeight:m,context:w,sourceTexture:this.createTexture(w,d,m,!g&&x),targetTexture:this.createTexture(w,d,m),originalTexture:g||this.createTexture(w,d,m,!g&&x),passes:v.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},L=w.createFramebuffer();return w.bindFramebuffer(w.FRAMEBUFFER,L),v.forEach(function(B){B&&B.applyTo(C)}),R(C),this.copyGLTo2D(w,C),w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(C.sourceTexture),w.deleteTexture(C.targetTexture),w.deleteFramebuffer(L),c.getContext("2d").setTransform(1,0,0,1,0,0),C},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(v,x,d,m,c){var _=v.createTexture();return v.bindTexture(v.TEXTURE_2D,_),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,c||v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,c||v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),m?v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,m):v.texImage2D(v.TEXTURE_2D,0,v.RGBA,x,d,0,v.RGBA,v.UNSIGNED_BYTE,null),_},getCachedTexture:function(v,x){if(this.textureCache[v])return this.textureCache[v];var d=this.createTexture(this.gl,x.width,x.height,x);return this.textureCache[v]=d,d},evictCachesForKey:function(v){this.textureCache[v]&&(this.gl.deleteTexture(this.textureCache[v]),delete this.textureCache[v])},copyGLTo2D:z,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var v=this.gl,x={renderer:"",vendor:""};if(!v)return x;var d=v.getExtension("WEBGL_debug_renderer_info");if(d){var m=v.getParameter(d.UNMASKED_RENDERER_WEBGL),c=v.getParameter(d.UNMASKED_VENDOR_WEBGL);m&&(x.renderer=m.toLowerCase()),c&&(x.vendor=c.toLowerCase())}return this.gpuInfo=x,x}}}();function R(t){var l=t.targetCanvas,v=l.width,x=l.height,d=t.destinationWidth,m=t.destinationHeight;(v!==d||x!==m)&&(l.width=d,l.height=m)}function z(t,l){var v=t.canvas,x=l.targetCanvas,d=x.getContext("2d");d.translate(0,x.height),d.scale(1,-1);var m=v.height-x.height;d.drawImage(v,0,m,x.width,x.height,0,0,x.width,x.height)}function V(t,l){var v=l.targetCanvas,x=v.getContext("2d"),d=l.destinationWidth,m=l.destinationHeight,c=d*m*4,_=new Uint8Array(this.imageBuffer,0,c),w=new Uint8ClampedArray(this.imageBuffer,0,c);t.readPixels(0,0,d,m,t.RGBA,t.UNSIGNED_BYTE,_);var g=new ImageData(w,d,m);x.putImageData(g,0,0)}(function(){var t=function(){};f.Canvas2dFilterBackend=l;function l(){}l.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(v,x,d,m,c){var _=c.getContext("2d");_.drawImage(x,0,0,d,m);var w=_.getImageData(0,0,d,m),g=_.getImageData(0,0,d,m),C={sourceWidth:d,sourceHeight:m,imageData:w,originalEl:x,originalImageData:g,canvasEl:c,ctx:_,filterBackend:this};return v.forEach(function(L){L.applyTo(C)}),(C.imageData.width!==d||C.imageData.height!==m)&&(c.width=C.imageData.width,c.height=C.imageData.height),_.putImageData(C.imageData,0,0),C}}})(),f.Image=f.Image||{},f.Image.filters=f.Image.filters||{},f.Image.filters.BaseFilter=f.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var l in t)this[l]=t[l]},createProgram:function(t,l,v){l=l||this.fragmentSource,v=v||this.vertexSource,f.webGlPrecision!=="highp"&&(l=l.replace(/precision highp float/g,"precision "+f.webGlPrecision+" float"));var x=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(x,v),t.compileShader(x),!t.getShaderParameter(x,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(x));var d=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(d,l),t.compileShader(d),!t.getShaderParameter(d,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(d));var m=t.createProgram();if(t.attachShader(m,x),t.attachShader(m,d),t.linkProgram(m),!t.getProgramParameter(m,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(m));var c=this.getAttributeLocations(t,m),_=this.getUniformLocations(t,m)||{};return _.uStepW=t.getUniformLocation(m,"uStepW"),_.uStepH=t.getUniformLocation(m,"uStepH"),{program:m,attributeLocations:c,uniformLocations:_}},getAttributeLocations:function(t,l){return{aPosition:t.getAttribLocation(l,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,l,v){var x=l.aPosition,d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.enableVertexAttribArray(x),t.vertexAttribPointer(x,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var l=t.context,v,x;t.passes>1?(v=t.destinationWidth,x=t.destinationHeight,(t.sourceWidth!==v||t.sourceHeight!==x)&&(l.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(l,v,x)),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t.targetTexture,0)):(l.bindFramebuffer(l.FRAMEBUFFER,null),l.finish())},_swapTextures:function(t){t.passes--,t.pass++;var l=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=l},isNeutralState:function(){var t=this.mainParameter,l=f.Image.filters[this.type].prototype;if(t)if(Array.isArray(l[t])){for(var v=l[t].length;v--;)if(this[t][v]!==l[t][v])return!1;return!0}else return l[t]===this[t];else return!1},applyTo:function(t){t.webgl?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var l=t.context,v=this.retrieveShader(t);t.pass===0&&t.originalTexture?l.bindTexture(l.TEXTURE_2D,t.originalTexture):l.bindTexture(l.TEXTURE_2D,t.sourceTexture),l.useProgram(v.program),this.sendAttributeData(l,v.attributeLocations,t.aPosition),l.uniform1f(v.uniformLocations.uStepW,1/t.sourceWidth),l.uniform1f(v.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(l,v.uniformLocations),l.viewport(0,0,t.destinationWidth,t.destinationHeight),l.drawArrays(l.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,l,v){t.activeTexture(v),t.bindTexture(t.TEXTURE_2D,l),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,l){t.activeTexture(l),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var l=document.createElement("canvas");l.width=t.sourceWidth,l.height=t.sourceHeight,t.helpLayer=l}},toObject:function(){var t={type:this.type},l=this.mainParameter;return l&&(t[l]=this[l]),t},toJSON:function(){return this.toObject()}}),f.Image.filters.BaseFilter.fromObject=function(t,l){var v=new f.Image.filters[t.type](t);return l&&l(v),v},function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.ColorMatrix=x(v.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(d){this.callSuper("initialize",d),this.matrix=this.matrix.slice(0)},applyTo2d:function(d){var m=d.imageData,c=m.data,_=c.length,w=this.matrix,g,C,L,B,q,K=this.colorsOnly;for(q=0;q<_;q+=4)g=c[q],C=c[q+1],L=c[q+2],K?(c[q]=g*w[0]+C*w[1]+L*w[2]+w[4]*255,c[q+1]=g*w[5]+C*w[6]+L*w[7]+w[9]*255,c[q+2]=g*w[10]+C*w[11]+L*w[12]+w[14]*255):(B=c[q+3],c[q]=g*w[0]+C*w[1]+L*w[2]+B*w[3]+w[4]*255,c[q+1]=g*w[5]+C*w[6]+L*w[7]+B*w[8]+w[9]*255,c[q+2]=g*w[10]+C*w[11]+L*w[12]+B*w[13]+w[14]*255,c[q+3]=g*w[15]+C*w[16]+L*w[17]+B*w[18]+w[19]*255)},getUniformLocations:function(d,m){return{uColorMatrix:d.getUniformLocation(m,"uColorMatrix"),uConstants:d.getUniformLocation(m,"uConstants")}},sendUniformData:function(d,m){var c=this.matrix,_=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],w=[c[4],c[9],c[14],c[19]];d.uniformMatrix4fv(m.uColorMatrix,!1,_),d.uniform4fv(m.uConstants,w)}}),l.Image.filters.ColorMatrix.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Brightness=x(v.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(d){if(this.brightness!==0){var m=d.imageData,c=m.data,_,w=c.length,g=Math.round(this.brightness*255);for(_=0;_<w;_+=4)c[_]=c[_]+g,c[_+1]=c[_+1]+g,c[_+2]=c[_+2]+g}},getUniformLocations:function(d,m){return{uBrightness:d.getUniformLocation(m,"uBrightness")}},sendUniformData:function(d,m){d.uniform1f(m.uBrightness,this.brightness)}}),l.Image.filters.Brightness.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.Image.filters,d=l.util.createClass;x.Convolute=d(x.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(m){var c=Math.sqrt(this.matrix.length),_=this.type+"_"+c+"_"+(this.opaque?1:0),w=this.fragmentSource[_];return m.programCache.hasOwnProperty(_)||(m.programCache[_]=this.createProgram(m.context,w)),m.programCache[_]},applyTo2d:function(m){var c=m.imageData,_=c.data,w=this.matrix,g=Math.round(Math.sqrt(w.length)),C=Math.floor(g/2),L=c.width,B=c.height,q=m.ctx.createImageData(L,B),K=q.data,se=this.opaque?1:0,he,le,ve,ot,_e,pe,ze,De,at,ft,xt,He,ae;for(xt=0;xt<B;xt++)for(ft=0;ft<L;ft++){for(_e=(xt*L+ft)*4,he=0,le=0,ve=0,ot=0,ae=0;ae<g;ae++)for(He=0;He<g;He++)ze=xt+ae-C,pe=ft+He-C,!(ze<0||ze>=B||pe<0||pe>=L)&&(De=(ze*L+pe)*4,at=w[ae*g+He],he+=_[De]*at,le+=_[De+1]*at,ve+=_[De+2]*at,se||(ot+=_[De+3]*at));K[_e]=he,K[_e+1]=le,K[_e+2]=ve,se?K[_e+3]=_[_e+3]:K[_e+3]=ot}m.imageData=q},getUniformLocations:function(m,c){return{uMatrix:m.getUniformLocation(c,"uMatrix"),uOpaque:m.getUniformLocation(c,"uOpaque"),uHalfSize:m.getUniformLocation(c,"uHalfSize"),uSize:m.getUniformLocation(c,"uSize")}},sendUniformData:function(m,c){m.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return v(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),l.Image.filters.Convolute.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Grayscale=x(v.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(d){var m=d.imageData,c=m.data,_,w=c.length,g,C=this.mode;for(_=0;_<w;_+=4)C==="average"?g=(c[_]+c[_+1]+c[_+2])/3:C==="lightness"?g=(Math.min(c[_],c[_+1],c[_+2])+Math.max(c[_],c[_+1],c[_+2]))/2:C==="luminosity"&&(g=.21*c[_]+.72*c[_+1]+.07*c[_+2]),c[_]=g,c[_+1]=g,c[_+2]=g},retrieveShader:function(d){var m=this.type+"_"+this.mode;if(!d.programCache.hasOwnProperty(m)){var c=this.fragmentSource[this.mode];d.programCache[m]=this.createProgram(d.context,c)}return d.programCache[m]},getUniformLocations:function(d,m){return{uMode:d.getUniformLocation(m,"uMode")}},sendUniformData:function(d,m){var c=1;d.uniform1i(m.uMode,c)},isNeutralState:function(){return!1}}),l.Image.filters.Grayscale.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Invert=x(v.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(d){var m=d.imageData,c=m.data,_,w=c.length;for(_=0;_<w;_+=4)c[_]=255-c[_],c[_+1]=255-c[_+1],c[_+2]=255-c[_+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(d,m){return{uInvert:d.getUniformLocation(m,"uInvert")}},sendUniformData:function(d,m){d.uniform1i(m.uInvert,this.invert)}}),l.Image.filters.Invert.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.Image.filters,d=l.util.createClass;x.Noise=d(x.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(m){if(this.noise!==0){var c=m.imageData,_=c.data,w,g=_.length,C=this.noise,L;for(w=0,g=_.length;w<g;w+=4)L=(.5-Math.random())*C,_[w]+=L,_[w+1]+=L,_[w+2]+=L}},getUniformLocations:function(m,c){return{uNoise:m.getUniformLocation(c,"uNoise"),uSeed:m.getUniformLocation(c,"uSeed")}},sendUniformData:function(m,c){m.uniform1f(c.uNoise,this.noise/255),m.uniform1f(c.uSeed,Math.random())},toObject:function(){return v(this.callSuper("toObject"),{noise:this.noise})}}),l.Image.filters.Noise.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Pixelate=x(v.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(d){var m=d.imageData,c=m.data,_=m.height,w=m.width,g,C,L,B,q,K,se,he,le,ve,ot;for(C=0;C<_;C+=this.blocksize)for(L=0;L<w;L+=this.blocksize)for(g=C*4*w+L*4,B=c[g],q=c[g+1],K=c[g+2],se=c[g+3],ve=Math.min(C+this.blocksize,_),ot=Math.min(L+this.blocksize,w),he=C;he<ve;he++)for(le=L;le<ot;le++)g=he*4*w+le*4,c[g]=B,c[g+1]=q,c[g+2]=K,c[g+3]=se},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(d,m){return{uBlocksize:d.getUniformLocation(m,"uBlocksize"),uStepW:d.getUniformLocation(m,"uStepW"),uStepH:d.getUniformLocation(m,"uStepH")}},sendUniformData:function(d,m){d.uniform1f(m.uBlocksize,this.blocksize)}}),l.Image.filters.Pixelate.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.extend,x=l.Image.filters,d=l.util.createClass;x.RemoveColor=d(x.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(m){var c=m.imageData,_=c.data,w,g=this.distance*255,C,L,B,q=new l.Color(this.color).getSource(),K=[q[0]-g,q[1]-g,q[2]-g],se=[q[0]+g,q[1]+g,q[2]+g];for(w=0;w<_.length;w+=4)C=_[w],L=_[w+1],B=_[w+2],C>K[0]&&L>K[1]&&B>K[2]&&C<se[0]&&L<se[1]&&B<se[2]&&(_[w+3]=0)},getUniformLocations:function(m,c){return{uLow:m.getUniformLocation(c,"uLow"),uHigh:m.getUniformLocation(c,"uHigh")}},sendUniformData:function(m,c){var _=new l.Color(this.color).getSource(),w=parseFloat(this.distance),g=[0+_[0]/255-w,0+_[1]/255-w,0+_[2]/255-w,1],C=[_[0]/255+w,_[1]/255+w,_[2]/255+w,1];m.uniform4fv(c.uLow,g),m.uniform4fv(c.uHigh,C)},toObject:function(){return v(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),l.Image.filters.RemoveColor.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass,d={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var m in d)v[m]=x(v.ColorMatrix,{type:m,matrix:d[m],mainParameter:!1,colorsOnly:!0}),l.Image.filters[m].fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric,v=l.Image.filters,x=l.util.createClass;v.BlendColor=x(v.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(d){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[d]+`}
}`},retrieveShader:function(d){var m=this.type+"_"+this.mode,c;return d.programCache.hasOwnProperty(m)||(c=this.buildSource(this.mode),d.programCache[m]=this.createProgram(d.context,c)),d.programCache[m]},applyTo2d:function(d){var m=d.imageData,c=m.data,_=c.length,w,g,C,L,B,q,K,se=1-this.alpha;K=new l.Color(this.color).getSource(),w=K[0]*this.alpha,g=K[1]*this.alpha,C=K[2]*this.alpha;for(var he=0;he<_;he+=4)switch(L=c[he],B=c[he+1],q=c[he+2],this.mode){case"multiply":c[he]=L*w/255,c[he+1]=B*g/255,c[he+2]=q*C/255;break;case"screen":c[he]=255-(255-L)*(255-w)/255,c[he+1]=255-(255-B)*(255-g)/255,c[he+2]=255-(255-q)*(255-C)/255;break;case"add":c[he]=L+w,c[he+1]=B+g,c[he+2]=q+C;break;case"diff":case"difference":c[he]=Math.abs(L-w),c[he+1]=Math.abs(B-g),c[he+2]=Math.abs(q-C);break;case"subtract":c[he]=L-w,c[he+1]=B-g,c[he+2]=q-C;break;case"darken":c[he]=Math.min(L,w),c[he+1]=Math.min(B,g),c[he+2]=Math.min(q,C);break;case"lighten":c[he]=Math.max(L,w),c[he+1]=Math.max(B,g),c[he+2]=Math.max(q,C);break;case"overlay":c[he]=w<128?2*L*w/255:255-2*(255-L)*(255-w)/255,c[he+1]=g<128?2*B*g/255:255-2*(255-B)*(255-g)/255,c[he+2]=C<128?2*q*C/255:255-2*(255-q)*(255-C)/255;break;case"exclusion":c[he]=w+L-2*w*L/255,c[he+1]=g+B-2*g*B/255,c[he+2]=C+q-2*C*q/255;break;case"tint":c[he]=w+L*se,c[he+1]=g+B*se,c[he+2]=C+q*se}},getUniformLocations:function(d,m){return{uColor:d.getUniformLocation(m,"uColor")}},sendUniformData:function(d,m){var c=new l.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,d.uniform4fv(m.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),l.Image.filters.BlendColor.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric,v=l.Image.filters,x=l.util.createClass;v.BlendImage=x(v.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(d){var m=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return d.programCache.hasOwnProperty(m)||(d.programCache[m]=this.createProgram(d.context,c)),d.programCache[m]},applyToWebGL:function(d){var m=d.context,c=this.createTexture(d.filterBackend,this.image);this.bindAdditionalTexture(m,c,m.TEXTURE1),this.callSuper("applyToWebGL",d),this.unbindAdditionalTexture(m,m.TEXTURE1)},createTexture:function(d,m){return d.getCachedTexture(m.cacheKey,m._element)},calculateMatrix:function(){var d=this.image,m=d._element.width,c=d._element.height;return[1/d.scaleX,0,0,0,1/d.scaleY,0,-d.left/m,-d.top/c,1]},applyTo2d:function(d){var m=d.imageData,c=d.filterBackend.resources,_=m.data,w=_.length,g=m.width,C=m.height,L,B,q,K,se,he,le,ve,ot,_e,pe=this.image,ze;c.blendImage||(c.blendImage=l.util.createCanvasElement()),ot=c.blendImage,_e=ot.getContext("2d"),ot.width!==g||ot.height!==C?(ot.width=g,ot.height=C):_e.clearRect(0,0,g,C),_e.setTransform(pe.scaleX,0,0,pe.scaleY,pe.left,pe.top),_e.drawImage(pe._element,0,0,g,C),ze=_e.getImageData(0,0,g,C).data;for(var De=0;De<w;De+=4)switch(se=_[De],he=_[De+1],le=_[De+2],ve=_[De+3],L=ze[De],B=ze[De+1],q=ze[De+2],K=ze[De+3],this.mode){case"multiply":_[De]=se*L/255,_[De+1]=he*B/255,_[De+2]=le*q/255,_[De+3]=ve*K/255;break;case"mask":_[De+3]=K;break}},getUniformLocations:function(d,m){return{uTransformMatrix:d.getUniformLocation(m,"uTransformMatrix"),uImage:d.getUniformLocation(m,"uImage")}},sendUniformData:function(d,m){var c=this.calculateMatrix();d.uniform1i(m.uImage,1),d.uniformMatrix3fv(m.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),l.Image.filters.BlendImage.fromObject=function(d,m){l.Image.fromObject(d.image,function(c){var _=l.util.object.clone(d);_.image=c,m(new l.Image.filters.BlendImage(_))})}}(M),function(t){var l=t.fabric||(t.fabric={}),v=Math.pow,x=Math.floor,d=Math.sqrt,m=Math.abs,c=Math.round,_=Math.sin,w=Math.ceil,g=l.Image.filters,C=l.util.createClass;g.Resize=C(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(L,B){return{uDelta:L.getUniformLocation(B,"uDelta"),uTaps:L.getUniformLocation(B,"uTaps")}},sendUniformData:function(L,B){L.uniform2fv(B.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),L.uniform1fv(B.uTaps,this.taps)},retrieveShader:function(L){var B=this.getFilterWindow(),q=this.type+"_"+B;if(!L.programCache.hasOwnProperty(q)){var K=this.generateShader(B);L.programCache[q]=this.createProgram(L.context,K)}return L.programCache[q]},getFilterWindow:function(){var L=this.tempScale;return Math.ceil(this.lanczosLobes/L)},getTaps:function(){for(var L=this.lanczosCreate(this.lanczosLobes),B=this.tempScale,q=this.getFilterWindow(),K=new Array(q),se=1;se<=q;se++)K[se-1]=L(se*B);return K},generateShader:function(K){for(var B=new Array(K),q=this.fragmentSourceTOP,K,se=1;se<=K;se++)B[se-1]=se+".0 * uDelta";return q+="uniform float uTaps["+K+`];
`,q+=`void main() {
`,q+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,q+=`  float sum = 1.0;
`,B.forEach(function(he,le){q+="  color += texture2D(uTexture, vTexCoord + "+he+") * uTaps["+le+`];
`,q+="  color += texture2D(uTexture, vTexCoord - "+he+") * uTaps["+le+`];
`,q+="  sum += 2.0 * uTaps["+le+`];
`}),q+=`  gl_FragColor = color / sum;
`,q+="}",q},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(L){L.webgl?(L.passes++,this.width=L.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=L.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),L.destinationWidth=this.dW,this._setupFrameBuffer(L),this.applyToWebGL(L),this._swapTextures(L),L.sourceWidth=L.destinationWidth,this.height=L.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),L.destinationHeight=this.dH,this._setupFrameBuffer(L),this.applyToWebGL(L),this._swapTextures(L),L.sourceHeight=L.destinationHeight):this.applyTo2d(L)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(L){return function(B){if(B>=L||B<=-L)return 0;if(B<11920929e-14&&B>-11920929e-14)return 1;B*=Math.PI;var q=B/L;return _(B)/B*_(q)/q}},applyTo2d:function(L){var B=L.imageData,q=this.scaleX,K=this.scaleY;this.rcpScaleX=1/q,this.rcpScaleY=1/K;var se=B.width,he=B.height,le=c(se*q),ve=c(he*K),ot;this.resizeType==="sliceHack"?ot=this.sliceByTwo(L,se,he,le,ve):this.resizeType==="hermite"?ot=this.hermiteFastResize(L,se,he,le,ve):this.resizeType==="bilinear"?ot=this.bilinearFiltering(L,se,he,le,ve):this.resizeType==="lanczos"&&(ot=this.lanczosResize(L,se,he,le,ve)),L.imageData=ot},sliceByTwo:function(L,B,q,K,se){var he=L.imageData,le=.5,ve=!1,ot=!1,_e=B*le,pe=q*le,ze=l.filterBackend.resources,De,at,ft=0,xt=0,He=B,ae=0;for(ze.sliceByTwo||(ze.sliceByTwo=document.createElement("canvas")),De=ze.sliceByTwo,(De.width<B*1.5||De.height<q)&&(De.width=B*1.5,De.height=q),at=De.getContext("2d"),at.clearRect(0,0,B*1.5,q),at.putImageData(he,0,0),K=x(K),se=x(se);!ve||!ot;)B=_e,q=pe,K<x(_e*le)?_e=x(_e*le):(_e=K,ve=!0),se<x(pe*le)?pe=x(pe*le):(pe=se,ot=!0),at.drawImage(De,ft,xt,B,q,He,ae,_e,pe),ft=He,xt=ae,ae+=pe;return at.getImageData(ft,xt,K,se)},lanczosResize:function(L,B,q,K,se){function he(Oe){var Y,ce,re,te,we,ke,We,qe,gt,lt,Bt;for(ae.x=(Oe+.5)*pe,Te.x=x(ae.x),Y=0;Y<se;Y++){for(ae.y=(Y+.5)*ze,Te.y=x(ae.y),we=0,ke=0,We=0,qe=0,gt=0,ce=Te.x-ft;ce<=Te.x+ft;ce++)if(!(ce<0||ce>=B)){lt=x(1e3*m(ce-ae.x)),He[lt]||(He[lt]={});for(var ht=Te.y-xt;ht<=Te.y+xt;ht++)ht<0||ht>=q||(Bt=x(1e3*m(ht-ae.y)),He[lt][Bt]||(He[lt][Bt]=_e(d(v(lt*De,2)+v(Bt*at,2))/1e3)),re=He[lt][Bt],re>0&&(te=(ht*B+ce)*4,we+=re,ke+=re*le[te],We+=re*le[te+1],qe+=re*le[te+2],gt+=re*le[te+3]))}te=(Y*K+Oe)*4,ot[te]=ke/we,ot[te+1]=We/we,ot[te+2]=qe/we,ot[te+3]=gt/we}return++Oe<K?he(Oe):ve}var le=L.imageData.data,ve=L.ctx.createImageData(K,se),ot=ve.data,_e=this.lanczosCreate(this.lanczosLobes),pe=this.rcpScaleX,ze=this.rcpScaleY,De=2/this.rcpScaleX,at=2/this.rcpScaleY,ft=w(pe*this.lanczosLobes/2),xt=w(ze*this.lanczosLobes/2),He={},ae={},Te={};return he(0)},bilinearFiltering:function(L,B,q,K,se){var he,le,ve,ot,_e,pe,ze,De,at,ft,xt,He,ae=0,Te,Oe=this.rcpScaleX,Y=this.rcpScaleY,ce=4*(B-1),re=L.imageData,te=re.data,we=L.ctx.createImageData(K,se),ke=we.data;for(ze=0;ze<se;ze++)for(De=0;De<K;De++)for(_e=x(Oe*De),pe=x(Y*ze),at=Oe*De-_e,ft=Y*ze-pe,Te=4*(pe*B+_e),xt=0;xt<4;xt++)he=te[Te+xt],le=te[Te+4+xt],ve=te[Te+ce+xt],ot=te[Te+ce+4+xt],He=he*(1-at)*(1-ft)+le*at*(1-ft)+ve*ft*(1-at)+ot*at*ft,ke[ae++]=He;return we},hermiteFastResize:function(L,B,q,K,se){for(var he=this.rcpScaleX,le=this.rcpScaleY,ve=w(he/2),ot=w(le/2),_e=L.imageData,pe=_e.data,ze=L.ctx.createImageData(K,se),De=ze.data,at=0;at<se;at++)for(var ft=0;ft<K;ft++){for(var xt=(ft+at*K)*4,He=0,ae=0,Te=0,Oe=0,Y=0,ce=0,re=0,te=(at+.5)*le,we=x(at*le);we<(at+1)*le;we++)for(var ke=m(te-(we+.5))/ot,We=(ft+.5)*he,qe=ke*ke,gt=x(ft*he);gt<(ft+1)*he;gt++){var lt=m(We-(gt+.5))/ve,Bt=d(qe+lt*lt);Bt>1&&Bt<-1||(He=2*Bt*Bt*Bt-3*Bt*Bt+1,He>0&&(lt=4*(gt+we*B),re+=He*pe[lt+3],Te+=He,pe[lt+3]<255&&(He=He*pe[lt+3]/250),Oe+=He*pe[lt],Y+=He*pe[lt+1],ce+=He*pe[lt+2],ae+=He))}De[xt]=Oe/ae,De[xt+1]=Y/ae,De[xt+2]=ce/ae,De[xt+3]=re/Te}return ze},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),l.Image.filters.Resize.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Contrast=x(v.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(d){if(this.contrast!==0){var m=d.imageData,c,w,_=m.data,w=_.length,g=Math.floor(this.contrast*255),C=259*(g+255)/(255*(259-g));for(c=0;c<w;c+=4)_[c]=C*(_[c]-128)+128,_[c+1]=C*(_[c+1]-128)+128,_[c+2]=C*(_[c+2]-128)+128}},getUniformLocations:function(d,m){return{uContrast:d.getUniformLocation(m,"uContrast")}},sendUniformData:function(d,m){d.uniform1f(m.uContrast,this.contrast)}}),l.Image.filters.Contrast.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Saturation=x(v.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(d){if(this.saturation!==0){var m=d.imageData,c=m.data,_=c.length,w=-this.saturation,g,C;for(g=0;g<_;g+=4)C=Math.max(c[g],c[g+1],c[g+2]),c[g]+=C!==c[g]?(C-c[g])*w:0,c[g+1]+=C!==c[g+1]?(C-c[g+1])*w:0,c[g+2]+=C!==c[g+2]?(C-c[g+2])*w:0}},getUniformLocations:function(d,m){return{uSaturation:d.getUniformLocation(m,"uSaturation")}},sendUniformData:function(d,m){d.uniform1f(m.uSaturation,-this.saturation)}}),l.Image.filters.Saturation.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Vibrance=x(v.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(d){if(this.vibrance!==0){var m=d.imageData,c=m.data,_=c.length,w=-this.vibrance,g,C,L,B;for(g=0;g<_;g+=4)C=Math.max(c[g],c[g+1],c[g+2]),L=(c[g]+c[g+1]+c[g+2])/3,B=Math.abs(C-L)*2/255*w,c[g]+=C!==c[g]?(C-c[g])*B:0,c[g+1]+=C!==c[g+1]?(C-c[g+1])*B:0,c[g+2]+=C!==c[g+2]?(C-c[g+2])*B:0}},getUniformLocations:function(d,m){return{uVibrance:d.getUniformLocation(m,"uVibrance")}},sendUniformData:function(d,m){d.uniform1f(m.uVibrance,-this.vibrance)}}),l.Image.filters.Vibrance.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Blur=x(v.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(d){d.webgl?(this.aspectRatio=d.sourceWidth/d.sourceHeight,d.passes++,this._setupFrameBuffer(d),this.horizontal=!0,this.applyToWebGL(d),this._swapTextures(d),this._setupFrameBuffer(d),this.horizontal=!1,this.applyToWebGL(d),this._swapTextures(d)):this.applyTo2d(d)},applyTo2d:function(d){d.imageData=this.simpleBlur(d)},simpleBlur:function(d){var m=d.filterBackend.resources,c,_,w=d.imageData.width,g=d.imageData.height;m.blurLayer1||(m.blurLayer1=l.util.createCanvasElement(),m.blurLayer2=l.util.createCanvasElement()),c=m.blurLayer1,_=m.blurLayer2,(c.width!==w||c.height!==g)&&(_.width=c.width=w,_.height=c.height=g);var C=c.getContext("2d"),L=_.getContext("2d"),B=15,q,K,se,he,le=this.blur*.06*.5;for(C.putImageData(d.imageData,0,0),L.clearRect(0,0,w,g),he=-B;he<=B;he++)q=(Math.random()-.5)/4,K=he/B,se=le*K*w+q,L.globalAlpha=1-Math.abs(K),L.drawImage(c,se,q),C.drawImage(_,0,0),L.globalAlpha=1,L.clearRect(0,0,_.width,_.height);for(he=-B;he<=B;he++)q=(Math.random()-.5)/4,K=he/B,se=le*K*g+q,L.globalAlpha=1-Math.abs(K),L.drawImage(c,q,se),C.drawImage(_,0,0),L.globalAlpha=1,L.clearRect(0,0,_.width,_.height);d.ctx.drawImage(c,0,0);var ve=d.ctx.getImageData(0,0,c.width,c.height);return C.globalAlpha=1,C.clearRect(0,0,c.width,c.height),ve},getUniformLocations:function(d,m){return{delta:d.getUniformLocation(m,"uDelta")}},sendUniformData:function(d,m){var c=this.chooseRightDelta();d.uniform2fv(m.delta,c)},chooseRightDelta:function(){var d=1,m=[0,0],c;return this.horizontal?this.aspectRatio>1&&(d=1/this.aspectRatio):this.aspectRatio<1&&(d=this.aspectRatio),c=d*this.blur*.12,this.horizontal?m[0]=c:m[1]=c,m}}),v.Blur.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Gamma=x(v.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(d){this.gamma=[1,1,1],v.BaseFilter.prototype.initialize.call(this,d)},applyTo2d:function(d){var m=d.imageData,c=m.data,_=this.gamma,w=c.length,g=1/_[0],C=1/_[1],L=1/_[2],B;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),B=0,w=256;B<w;B++)this.rVals[B]=Math.pow(B/255,g)*255,this.gVals[B]=Math.pow(B/255,C)*255,this.bVals[B]=Math.pow(B/255,L)*255;for(B=0,w=c.length;B<w;B+=4)c[B]=this.rVals[c[B]],c[B+1]=this.gVals[c[B+1]],c[B+2]=this.bVals[c[B+2]]},getUniformLocations:function(d,m){return{uGamma:d.getUniformLocation(m,"uGamma")}},sendUniformData:function(d,m){d.uniform3fv(m.uGamma,this.gamma)}}),l.Image.filters.Gamma.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.Composed=x(v.BaseFilter,{type:"Composed",subFilters:[],initialize:function(d){this.callSuper("initialize",d),this.subFilters=this.subFilters.slice(0)},applyTo:function(d){d.passes+=this.subFilters.length-1,this.subFilters.forEach(function(m){m.applyTo(d)})},toObject:function(){return l.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(d){return d.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(d){return!d.isNeutralState()})}}),l.Image.filters.Composed.fromObject=function(d,m){var c=d.subFilters||[],_=c.map(function(g){return new l.Image.filters[g.type](g)}),w=new l.Image.filters.Composed({subFilters:_});return m&&m(w),w}}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.Image.filters,x=l.util.createClass;v.HueRotation=x(v.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var d=this.rotation*Math.PI,m=l.util.cos(d),c=l.util.sin(d),_=1/3,w=Math.sqrt(_)*c,g=1-m;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=m+g/3,this.matrix[1]=_*g-w,this.matrix[2]=_*g+w,this.matrix[5]=_*g+w,this.matrix[6]=m+_*g,this.matrix[7]=_*g-w,this.matrix[10]=_*g-w,this.matrix[11]=_*g+w,this.matrix[12]=m+_*g},isNeutralState:function(d){return this.calculateMatrix(),v.BaseFilter.prototype.isNeutralState.call(this,d)},applyTo:function(d){this.calculateMatrix(),v.BaseFilter.prototype.applyTo.call(this,d)}}),l.Image.filters.HueRotation.fromObject=l.Image.filters.BaseFilter.fromObject}(M),function(t){var l=t.fabric||(t.fabric={}),v=l.util.object.clone;if(l.Text){l.warn("fabric.Text is already defined");return}var x="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");l.Text=l.util.createClass(l.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:l.Object.prototype.stateProperties.concat(x),cacheProperties:l.Object.prototype.cacheProperties.concat(x),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(d,m){this.styles=m?m.styles||{}:{},this.text=d,this.__skipDimension=!0,this.callSuper("initialize",m),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var d=this.path;d&&(d.segmentsInfo=l.util.getPathSegmentsInfo(d.path))},getMeasuringContext:function(){return l._measuringContext||(l._measuringContext=this.canvas&&this.canvas.contextCache||l.util.createCanvasElement().getContext("2d")),l._measuringContext},_splitText:function(){var d=this._splitTextIntoLines(this.text);return this.textLines=d.lines,this._textLines=d.graphemeLines,this._unwrappedTextLines=d._unwrappedLines,this._text=d.graphemeText,d},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var d,m,c,_,w,g,C,L=0,B=this._textLines.length;L<B;L++)if(!(this.textAlign!=="justify"&&(L===B-1||this.isEndOfWrapping(L)))&&(_=0,w=this._textLines[L],m=this.getLineWidth(L),m<this.width&&(C=this.textLines[L].match(this._reSpacesAndTabs)))){c=C.length,d=(this.width-m)/c;for(var q=0,K=w.length;q<=K;q++)g=this.__charBounds[L][q],this._reSpaceAndTab.test(w[q])?(g.width+=d,g.kernedWidth+=d,g.left+=_,_+=d):g.left+=_}},isEndOfWrapping:function(d){return d===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var d=this.callSuper("_getCacheCanvasDimensions"),m=this.fontSize;return d.width+=m*d.zoomX,d.height+=m*d.zoomY,d},_render:function(d){var m=this.path;m&&!m.isNotVisible()&&m._render(d),this._setTextStyles(d),this._renderTextLinesBackground(d),this._renderTextDecoration(d,"underline"),this._renderText(d),this._renderTextDecoration(d,"overline"),this._renderTextDecoration(d,"linethrough")},_renderText:function(d){this.paintFirst==="stroke"?(this._renderTextStroke(d),this._renderTextFill(d)):(this._renderTextFill(d),this._renderTextStroke(d))},_setTextStyles:function(d,m,c){if(d.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":d.textBaseline="middle";break;case"ascender":d.textBaseline="top";break;case"descender":d.textBaseline="bottom";break}d.font=this._getFontDeclaration(m,c)},calcTextWidth:function(){for(var d=this.getLineWidth(0),m=1,c=this._textLines.length;m<c;m++){var _=this.getLineWidth(m);_>d&&(d=_)}return d},_renderTextLine:function(d,m,c,_,w,g){this._renderChars(d,m,c,_,w,g)},_renderTextLinesBackground:function(d){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var m,c,_=d.fillStyle,w,g,C=this._getLeftOffset(),L=this._getTopOffset(),B=0,q=0,K,se,he=this.path,le,ve=0,ot=this._textLines.length;ve<ot;ve++){if(m=this.getHeightOfLine(ve),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",ve)){L+=m;continue}w=this._textLines[ve],c=this._getLineLeftOffset(ve),q=0,B=0,g=this.getValueOfPropertyAt(ve,0,"textBackgroundColor");for(var _e=0,pe=w.length;_e<pe;_e++)K=this.__charBounds[ve][_e],se=this.getValueOfPropertyAt(ve,_e,"textBackgroundColor"),he?(d.save(),d.translate(K.renderLeft,K.renderTop),d.rotate(K.angle),d.fillStyle=se,se&&d.fillRect(-K.width/2,-m/this.lineHeight*(1-this._fontSizeFraction),K.width,m/this.lineHeight),d.restore()):se!==g?(le=C+c+B,this.direction==="rtl"&&(le=this.width-le-q),d.fillStyle=g,g&&d.fillRect(le,L,q,m/this.lineHeight),B=K.left,q=K.width,g=se):q+=K.kernedWidth;se&&!he&&(le=C+c+B,this.direction==="rtl"&&(le=this.width-le-q),d.fillStyle=se,d.fillRect(le,L,q,m/this.lineHeight)),L+=m}d.fillStyle=_,this._removeShadow(d)}},getFontCache:function(d){var m=d.fontFamily.toLowerCase();l.charWidthsCache[m]||(l.charWidthsCache[m]={});var c=l.charWidthsCache[m],_=d.fontStyle.toLowerCase()+"_"+(d.fontWeight+"").toLowerCase();return c[_]||(c[_]={}),c[_]},_measureChar:function(d,m,c,_){var w=this.getFontCache(m),g=this._getFontDeclaration(m),C=this._getFontDeclaration(_),L=c+d,B=g===C,q,K,se,he=m.fontSize/this.CACHE_FONT_SIZE,le;if(c&&w[c]!==void 0&&(se=w[c]),w[d]!==void 0&&(le=q=w[d]),B&&w[L]!==void 0&&(K=w[L],le=K-se),q===void 0||se===void 0||K===void 0){var ve=this.getMeasuringContext();this._setTextStyles(ve,m,!0)}return q===void 0&&(le=q=ve.measureText(d).width,w[d]=q),se===void 0&&B&&c&&(se=ve.measureText(c).width,w[c]=se),B&&K===void 0&&(K=ve.measureText(L).width,w[L]=K,le=K-se),{width:q*he,kernedWidth:le*he}},getHeightOfChar:function(d,m){return this.getValueOfPropertyAt(d,m,"fontSize")},measureLine:function(d){var m=this._measureLine(d);return this.charSpacing!==0&&(m.width-=this._getWidthOfCharSpacing()),m.width<0&&(m.width=0),m},_measureLine:function(d){var m=0,c,_,w=this._textLines[d],g,C,L=0,B=new Array(w.length),q=0,K,se,he=this.path,le=this.pathSide==="right";for(this.__charBounds[d]=B,c=0;c<w.length;c++)_=w[c],C=this._getGraphemeBox(_,d,c,g),B[c]=C,m+=C.kernedWidth,g=_;if(B[c]={left:C?C.left+C.width:0,width:0,kernedWidth:0,height:this.fontSize},he){switch(se=he.segmentsInfo[he.segmentsInfo.length-1].length,K=l.util.getPointOnPath(he.path,0,he.segmentsInfo),K.x+=he.pathOffset.x,K.y+=he.pathOffset.y,this.textAlign){case"left":q=le?se-m:0;break;case"center":q=(se-m)/2;break;case"right":q=le?0:se-m;break}for(q+=this.pathStartOffset*(le?-1:1),c=le?w.length-1:0;le?c>=0:c<w.length;le?c--:c++)C=B[c],q>se?q%=se:q<0&&(q+=se),this._setGraphemeOnPath(q,C,K),q+=C.kernedWidth}return{width:m,numOfSpaces:L}},_setGraphemeOnPath:function(d,m,c){var _=d+m.kernedWidth/2,w=this.path,g=l.util.getPointOnPath(w.path,_,w.segmentsInfo);m.renderLeft=g.x-c.x,m.renderTop=g.y-c.y,m.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(d,m,c,_,w){var g=this.getCompleteStyleDeclaration(m,c),C=_?this.getCompleteStyleDeclaration(m,c-1):{},L=this._measureChar(d,g,_,C),B=L.kernedWidth,q=L.width,K;this.charSpacing!==0&&(K=this._getWidthOfCharSpacing(),q+=K,B+=K);var se={width:q,left:0,height:g.fontSize,kernedWidth:B,deltaY:g.deltaY};if(c>0&&!w){var he=this.__charBounds[m][c-1];se.left=he.left+he.width+L.kernedWidth-L.width}return se},getHeightOfLine:function(d){if(this.__lineHeights[d])return this.__lineHeights[d];for(var m=this._textLines[d],c=this.getHeightOfChar(d,0),_=1,w=m.length;_<w;_++)c=Math.max(this.getHeightOfChar(d,_),c);return this.__lineHeights[d]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var d,m=0,c=0,_=this._textLines.length;c<_;c++)d=this.getHeightOfLine(c),m+=c===_-1?d/this.lineHeight:d;return m},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(d,m){d.save();for(var c=0,_=this._getLeftOffset(),w=this._getTopOffset(),g=0,C=this._textLines.length;g<C;g++){var L=this.getHeightOfLine(g),B=L/this.lineHeight,q=this._getLineLeftOffset(g);this._renderTextLine(m,d,this._textLines[g],_+q,w+c+B,g),c+=L}d.restore()},_renderTextFill:function(d){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(d,"fillText")},_renderTextStroke:function(d){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this._setLineDash(d,this.strokeDashArray),d.beginPath(),this._renderTextCommon(d,"strokeText"),d.closePath(),d.restore())},_renderChars:function(d,m,c,_,w,g){var C=this.getHeightOfLine(g),L=this.textAlign.indexOf("justify")!==-1,B,q,K="",se,he=0,le,ve=this.path,ot=!L&&this.charSpacing===0&&this.isEmptyStyles(g)&&!ve,_e=this.direction==="ltr",pe=this.direction==="ltr"?1:-1,ze,De=m.canvas.getAttribute("dir");if(m.save(),De!==this.direction&&(m.canvas.setAttribute("dir",_e?"ltr":"rtl"),m.direction=_e?"ltr":"rtl",m.textAlign=_e?"left":"right"),w-=C*this._fontSizeFraction/this.lineHeight,ot){this._renderChar(d,m,g,0,c.join(""),_,w,C),m.restore();return}for(var at=0,ft=c.length-1;at<=ft;at++)le=at===ft||this.charSpacing||ve,K+=c[at],se=this.__charBounds[g][at],he===0?(_+=pe*(se.kernedWidth-se.width),he+=se.width):he+=se.kernedWidth,L&&!le&&this._reSpaceAndTab.test(c[at])&&(le=!0),le||(B=B||this.getCompleteStyleDeclaration(g,at),q=this.getCompleteStyleDeclaration(g,at+1),le=l.util.hasStyleChanged(B,q,!1)),le&&(ve?(m.save(),m.translate(se.renderLeft,se.renderTop),m.rotate(se.angle),this._renderChar(d,m,g,at,K,-he/2,0,C),m.restore()):(ze=_,this._renderChar(d,m,g,at,K,ze,w,C)),K="",B=q,_+=pe*he,he=0);m.restore()},_applyPatternGradientTransformText:function(d){var m=l.util.createCanvasElement(),c,_=this.width+this.strokeWidth,w=this.height+this.strokeWidth;return m.width=_,m.height=w,c=m.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.lineTo(_,0),c.lineTo(_,w),c.lineTo(0,w),c.closePath(),c.translate(_/2,w/2),c.fillStyle=d.toLive(c),this._applyPatternGradientTransform(c,d),c.fill(),c.createPattern(m,"no-repeat")},handleFiller:function(d,m,c){var _,w;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(_=-this.width/2,w=-this.height/2,d.translate(_,w),d[m]=this._applyPatternGradientTransformText(c),{offsetX:_,offsetY:w}):(d[m]=c.toLive(d,this),this._applyPatternGradientTransform(d,c)):(d[m]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(d,m){return d.lineWidth=m.strokeWidth,d.lineCap=this.strokeLineCap,d.lineDashOffset=this.strokeDashOffset,d.lineJoin=this.strokeLineJoin,d.miterLimit=this.strokeMiterLimit,this.handleFiller(d,"strokeStyle",m.stroke)},_setFillStyles:function(d,m){return this.handleFiller(d,"fillStyle",m.fill)},_renderChar:function(d,m,c,_,w,g,C){var L=this._getStyleDeclaration(c,_),B=this.getCompleteStyleDeclaration(c,_),q=d==="fillText"&&B.fill,K=d==="strokeText"&&B.stroke&&B.strokeWidth,se,he;!K&&!q||(m.save(),q&&(se=this._setFillStyles(m,B)),K&&(he=this._setStrokeStyles(m,B)),m.font=this._getFontDeclaration(B),L&&L.textBackgroundColor&&this._removeShadow(m),L&&L.deltaY&&(C+=L.deltaY),q&&m.fillText(w,g-se.offsetX,C-se.offsetY),K&&m.strokeText(w,g-he.offsetX,C-he.offsetY),m.restore())},setSuperscript:function(d,m){return this._setScript(d,m,this.superscript)},setSubscript:function(d,m){return this._setScript(d,m,this.subscript)},_setScript:function(d,m,c){var _=this.get2DCursorLocation(d,!0),w=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"fontSize"),g=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"deltaY"),C={fontSize:w*c.size,deltaY:g+w*c.baseline};return this.setSelectionStyles(C,d,m),this},_getLineLeftOffset:function(d){var m=this.getLineWidth(d),c=this.width-m,_=this.textAlign,w=this.direction,C,g=0,C=this.isEndOfWrapping(d);return _==="justify"||_==="justify-center"&&!C||_==="justify-right"&&!C||_==="justify-left"&&!C?0:(_==="center"&&(g=c/2),_==="right"&&(g=c),_==="justify-center"&&(g=c/2),_==="justify-right"&&(g=c),w==="rtl"&&(g-=c),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var d=this._forceClearCache;return d||(d=this.hasStateChanged("_dimensionAffectingProps")),d&&(this.dirty=!0,this._forceClearCache=!1),d},getLineWidth:function(d){if(this.__lineWidths[d]!==void 0)return this.__lineWidths[d];var m=this.measureLine(d),c=m.width;return this.__lineWidths[d]=c,c},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(d,m,c){var _=this._getStyleDeclaration(d,m);return _&&typeof _[c]<"u"?_[c]:this[c]},_renderTextDecoration:function(d,m){if(!(!this[m]&&!this.styleHas(m))){for(var c,_,w,g,C,L,B,q,K=this._getLeftOffset(),se=this._getTopOffset(),he,le,ve,ot,_e,pe,ze,De,at=this.path,ft=this._getWidthOfCharSpacing(),xt=this.offsets[m],He=0,ae=this._textLines.length;He<ae;He++){if(c=this.getHeightOfLine(He),!this[m]&&!this.styleHas(m,He)){se+=c;continue}B=this._textLines[He],pe=c/this.lineHeight,g=this._getLineLeftOffset(He),le=0,ve=0,q=this.getValueOfPropertyAt(He,0,m),De=this.getValueOfPropertyAt(He,0,"fill"),he=se+pe*(1-this._fontSizeFraction),_=this.getHeightOfChar(He,0),C=this.getValueOfPropertyAt(He,0,"deltaY");for(var Te=0,Oe=B.length;Te<Oe;Te++)if(ot=this.__charBounds[He][Te],_e=this.getValueOfPropertyAt(He,Te,m),ze=this.getValueOfPropertyAt(He,Te,"fill"),w=this.getHeightOfChar(He,Te),L=this.getValueOfPropertyAt(He,Te,"deltaY"),at&&_e&&ze)d.save(),d.fillStyle=De,d.translate(ot.renderLeft,ot.renderTop),d.rotate(ot.angle),d.fillRect(-ot.kernedWidth/2,xt*w+L,ot.kernedWidth,this.fontSize/15),d.restore();else if((_e!==q||ze!==De||w!==_||L!==C)&&ve>0){var Y=K+g+le;this.direction==="rtl"&&(Y=this.width-Y-ve),q&&De&&(d.fillStyle=De,d.fillRect(Y,he+xt*_+C,ve,this.fontSize/15)),le=ot.left,ve=ot.width,q=_e,De=ze,_=w,C=L}else ve+=ot.kernedWidth;var Y=K+g+le;this.direction==="rtl"&&(Y=this.width-Y-ve),d.fillStyle=ze,_e&&ze&&d.fillRect(Y,he+xt*_+C,ve-ft,this.fontSize/15),se+=c}this._removeShadow(d)}},_getFontDeclaration:function(d,m){var c=d||this,_=this.fontFamily,w=l.Text.genericFonts.indexOf(_.toLowerCase())>-1,g=_===void 0||_.indexOf("'")>-1||_.indexOf(",")>-1||_.indexOf('"')>-1||w?c.fontFamily:'"'+c.fontFamily+'"';return[l.isLikelyNode?c.fontWeight:c.fontStyle,l.isLikelyNode?c.fontStyle:c.fontWeight,m?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",g].join(" ")},render:function(d){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",d)))},_splitTextIntoLines:function(d){for(var m=d.split(this._reNewline),c=new Array(m.length),_=[`
`],w=[],g=0;g<m.length;g++)c[g]=l.util.string.graphemeSplit(m[g]),w=w.concat(c[g],_);return w.pop(),{_unwrappedLines:c,lines:m,graphemeText:w,graphemeLines:c}},toObject:function(d){var m=x.concat(d),c=this.callSuper("toObject",m);return c.styles=l.util.stylesToArray(this.styles,this.text),c.path&&(c.path=this.path.toObject()),c},set:function(d,m){this.callSuper("set",d,m);var c=!1,_=!1;if(typeof d=="object")for(var w in d)w==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(w)!==-1,_=_||w==="path";else c=this._dimensionAffectingProps.indexOf(d)!==-1,_=d==="path";return _&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),l.Text.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),l.Text.DEFAULT_SVG_FONT_SIZE=16,l.Text.fromElement=function(d,m,c){if(!d)return m(null);var _=l.parseAttributes(d,l.Text.ATTRIBUTE_NAMES),w=_.textAnchor||"left";if(c=l.util.object.extend(c?v(c):{},_),c.top=c.top||0,c.left=c.left||0,_.textDecoration){var g=_.textDecoration;g.indexOf("underline")!==-1&&(c.underline=!0),g.indexOf("overline")!==-1&&(c.overline=!0),g.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in _&&(c.left+=_.dx),"dy"in _&&(c.top+=_.dy),"fontSize"in c||(c.fontSize=l.Text.DEFAULT_SVG_FONT_SIZE);var C="";"textContent"in d?C=d.textContent:"firstChild"in d&&d.firstChild!==null&&"data"in d.firstChild&&d.firstChild.data!==null&&(C=d.firstChild.data),C=C.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var L=c.strokeWidth;c.strokeWidth=0;var B=new l.Text(C,c),q=B.getScaledHeight()/B.height,K=(B.height+B.strokeWidth)*B.lineHeight-B.height,se=K*q,he=B.getScaledHeight()+se,le=0;w==="center"&&(le=B.getScaledWidth()/2),w==="right"&&(le=B.getScaledWidth()),B.set({left:B.left-le,top:B.top-(he-B.fontSize*(.07+B._fontSizeFraction))/B.lineHeight,strokeWidth:typeof L<"u"?L:1}),m(B)},l.Text.fromObject=function(d,m){var c=v(d),_=d.path;return delete c.path,l.Object._fromObject("Text",c,function(w){w.styles=l.util.stylesFromArray(d.styles,d.text),_?l.Object._fromObject("Path",_,function(g){w.set("path",g),m(w)},"path"):m(w)},"text")},l.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],l.util.createAccessors&&l.util.createAccessors(l.Text)}(M),function(){f.util.object.extend(f.Text.prototype,{isEmptyStyles:function(t){if(!this.styles||typeof t<"u"&&!this.styles[t])return!0;var l=typeof t>"u"?this.styles:{line:this.styles[t]};for(var v in l)for(var x in l[v])for(var d in l[v][x])return!1;return!0},styleHas:function(t,l){if(!this.styles||!t||t===""||typeof l<"u"&&!this.styles[l])return!1;var v=typeof l>"u"?this.styles:{0:this.styles[l]};for(var x in v)for(var d in v[x])if(typeof v[x][d][t]<"u")return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||t==="")return!1;var l=this.styles,v=0,x,d,m=!0,c=0,_;for(var w in l){x=0;for(var g in l[w]){var _=l[w][g],C=_.hasOwnProperty(t);v++,C?(d?_[t]!==d&&(m=!1):d=_[t],_[t]===this[t]&&delete _[t]):m=!1,Object.keys(_).length!==0?x++:delete l[w][g]}x===0&&delete l[w]}for(var L=0;L<this._textLines.length;L++)c+=this._textLines[L].length;m&&v===c&&(this[t]=d,this.removeStyle(t))},removeStyle:function(t){if(!(!this.styles||!t||t==="")){var l=this.styles,v,x,d;for(x in l){v=l[x];for(d in v)delete v[d][t],Object.keys(v[d]).length===0&&delete v[d];Object.keys(v).length===0&&delete l[x]}}},_extendStyles:function(t,l){var v=this.get2DCursorLocation(t);this._getLineStyle(v.lineIndex)||this._setLineStyle(v.lineIndex),this._getStyleDeclaration(v.lineIndex,v.charIndex)||this._setStyleDeclaration(v.lineIndex,v.charIndex,{}),f.util.object.extend(this._getStyleDeclaration(v.lineIndex,v.charIndex),l)},get2DCursorLocation:function(t,l){typeof t>"u"&&(t=this.selectionStart);for(var v=l?this._unwrappedTextLines:this._textLines,x=v.length,d=0;d<x;d++){if(t<=v[d].length)return{lineIndex:d,charIndex:t};t-=v[d].length+this.missingNewlineOffset(d)}return{lineIndex:d-1,charIndex:v[d-1].length<t?v[d-1].length:t}},getSelectionStyles:function(t,l,v){typeof t>"u"&&(t=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||t);for(var x=[],d=t;d<l;d++)x.push(this.getStyleAtPosition(d,v));return x},getStyleAtPosition:function(t,l){var v=this.get2DCursorLocation(t),x=l?this.getCompleteStyleDeclaration(v.lineIndex,v.charIndex):this._getStyleDeclaration(v.lineIndex,v.charIndex);return x||{}},setSelectionStyles:function(t,l,v){typeof l>"u"&&(l=this.selectionStart||0),typeof v>"u"&&(v=this.selectionEnd||l);for(var x=l;x<v;x++)this._extendStyles(x,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,l){var v=this.styles&&this.styles[t];return v?v[l]:null},getCompleteStyleDeclaration:function(t,l){for(var v=this._getStyleDeclaration(t,l)||{},x={},d,m=0;m<this._styleProperties.length;m++)d=this._styleProperties[m],x[d]=typeof v[d]>"u"?this[d]:v[d];return x},_setStyleDeclaration:function(t,l,v){this.styles[t][l]=v},_deleteStyleDeclaration:function(t,l){delete this.styles[t][l]},_getLineStyle:function(t){return!!this.styles[t]},_setLineStyle:function(t){this.styles[t]={}},_deleteLineStyle:function(t){delete this.styles[t]}})}(),function(){function t(l){l.textDecoration&&(l.textDecoration.indexOf("underline")>-1&&(l.underline=!0),l.textDecoration.indexOf("line-through")>-1&&(l.linethrough=!0),l.textDecoration.indexOf("overline")>-1&&(l.overline=!0),delete l.textDecoration)}f.IText=f.util.createClass(f.Text,f.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(l,v){this.callSuper("initialize",l,v),this.initBehavior()},setSelectionStart:function(l){l=Math.max(l,0),this._updateAndFire("selectionStart",l)},setSelectionEnd:function(l){l=Math.min(l,this.text.length),this._updateAndFire("selectionEnd",l)},_updateAndFire:function(l,v){this[l]!==v&&(this._fireSelectionChanged(),this[l]=v),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(l){this.clearContextTop(),this.callSuper("render",l),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(l){this.callSuper("_render",l)},clearContextTop:function(l){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var v=this.canvas.contextTop,x=this.canvas.viewportTransform;v.save(),v.transform(x[0],x[1],x[2],x[3],x[4],x[5]),this.transform(v),this._clearTextArea(v),l||v.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this._getCursorBoundaries(),v=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(l,v):this.renderSelection(l,v),v.restore()}},_clearTextArea:function(l){var v=this.width+4,x=this.height+4;l.clearRect(-v/2,-x/2,v,x)},_getCursorBoundaries:function(l){typeof l>"u"&&(l=this.selectionStart);var v=this._getLeftOffset(),x=this._getTopOffset(),d=this._getCursorBoundariesOffsets(l);return{left:v,top:x,leftOffset:d.left,topOffset:d.top}},_getCursorBoundariesOffsets:function(l){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var v,x,d,m=0,c=0,_,w=this.get2DCursorLocation(l);d=w.charIndex,x=w.lineIndex;for(var g=0;g<x;g++)m+=this.getHeightOfLine(g);v=this._getLineLeftOffset(x);var C=this.__charBounds[x][d];return C&&(c=C.left),this.charSpacing!==0&&d===this._textLines[x].length&&(c-=this._getWidthOfCharSpacing()),_={top:m,left:v+(c>0?c:0)},this.direction==="rtl"&&(_.left*=-1),this.cursorOffsetCache=_,this.cursorOffsetCache},renderCursor:function(l,v){var x=this.get2DCursorLocation(),d=x.lineIndex,m=x.charIndex>0?x.charIndex-1:0,c=this.getValueOfPropertyAt(d,m,"fontSize"),_=this.scaleX*this.canvas.getZoom(),w=this.cursorWidth/_,g=l.topOffset,C=this.getValueOfPropertyAt(d,m,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(d)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(l,v),v.fillStyle=this.cursorColor||this.getValueOfPropertyAt(d,m,"fill"),v.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,v.fillRect(l.left+l.leftOffset-w/2,g+l.top+C,w,c)},renderSelection:function(l,v){for(var x=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,d=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,m=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(x),_=this.get2DCursorLocation(d),w=c.lineIndex,g=_.lineIndex,C=c.charIndex<0?0:c.charIndex,L=_.charIndex<0?0:_.charIndex,B=w;B<=g;B++){var q=this._getLineLeftOffset(B)||0,K=this.getHeightOfLine(B),se=0,he=0,le=0;if(B===w&&(he=this.__charBounds[w][C].left),B>=w&&B<g)le=m&&!this.isEndOfWrapping(B)?this.width:this.getLineWidth(B)||5;else if(B===g)if(L===0)le=this.__charBounds[g][L].left;else{var ve=this._getWidthOfCharSpacing();le=this.__charBounds[g][L-1].left+this.__charBounds[g][L-1].width-ve}se=K,(this.lineHeight<1||B===g&&this.lineHeight>1)&&(K/=this.lineHeight);var ot=l.left+q+he,_e=le-he,pe=K,ze=0;this.inCompositionMode?(v.fillStyle=this.compositionColor||"black",pe=1,ze=K):v.fillStyle=this.selectionColor,this.direction==="rtl"&&(ot=this.width-ot-_e),v.fillRect(ot,l.top+l.topOffset+ze,_e,pe),l.topOffset+=se}},getCurrentCharFontSize:function(){var l=this._getCurrentCharIndex();return this.getValueOfPropertyAt(l.l,l.c,"fontSize")},getCurrentCharColor:function(){var l=this._getCurrentCharIndex();return this.getValueOfPropertyAt(l.l,l.c,"fill")},_getCurrentCharIndex:function(){var l=this.get2DCursorLocation(this.selectionStart,!0),v=l.charIndex>0?l.charIndex-1:0;return{l:l.lineIndex,c:v}}}),f.IText.fromObject=function(l,v){var x=f.util.stylesFromArray(l.styles,l.text),d=Object.assign({},l,{styles:x});if(t(d),d.styles)for(var m in d.styles)for(var c in d.styles[m])t(d.styles[m][c]);f.Object._fromObject("IText",d,v,"text")}}(),function(){var t=f.util.object.clone;f.util.object.extend(f.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var l=this;this.on("added",function(){var v=l.canvas;v&&(v._hasITextHandlers||(v._hasITextHandlers=!0,l._initCanvasHandlers(v)),v._iTextInstances=v._iTextInstances||[],v._iTextInstances.push(l))})},initRemovedHandler:function(){var l=this;this.on("removed",function(){var v=l.canvas;v&&(v._iTextInstances=v._iTextInstances||[],f.util.removeFromArray(v._iTextInstances,l),v._iTextInstances.length===0&&(v._hasITextHandlers=!1,l._removeCanvasHandlers(v)))})},_initCanvasHandlers:function(l){l._mouseUpITextHandler=function(){l._iTextInstances&&l._iTextInstances.forEach(function(v){v.__isMousedown=!1})},l.on("mouse:up",l._mouseUpITextHandler)},_removeCanvasHandlers:function(l){l.off("mouse:up",l._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(l,v,x,d){var m;return m={isAborted:!1,abort:function(){this.isAborted=!0}},l.animate("_currentCursorOpacity",v,{duration:x,onComplete:function(){m.isAborted||l[d]()},onChange:function(){l.canvas&&l.selectionStart===l.selectionEnd&&l.renderCursorOrSelection()},abort:function(){return m.isAborted}}),m},_onTickComplete:function(){var l=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){l._currentTickCompleteState=l._animateCursor(l,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(l){var v=this,x=l?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){v._tick()},x)},abortCursorAnimation:function(){var l=this._currentTickState||this._currentTickCompleteState,v=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,l&&v&&v.clearContext(v.contextTop||v.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(l){var v=0,x=l-1;if(this._reSpace.test(this._text[x]))for(;this._reSpace.test(this._text[x]);)v++,x--;for(;/\S/.test(this._text[x])&&x>-1;)v++,x--;return l-v},findWordBoundaryRight:function(l){var v=0,x=l;if(this._reSpace.test(this._text[x]))for(;this._reSpace.test(this._text[x]);)v++,x++;for(;/\S/.test(this._text[x])&&x<this._text.length;)v++,x++;return l+v},findLineBoundaryLeft:function(l){for(var v=0,x=l-1;!/\n/.test(this._text[x])&&x>-1;)v++,x--;return l-v},findLineBoundaryRight:function(l){for(var v=0,x=l;!/\n/.test(this._text[x])&&x<this._text.length;)v++,x++;return l+v},searchWordBoundary:function(l,v){for(var x=this._text,d=this._reSpace.test(x[l])?l-1:l,m=x[d],c=f.reNonWord;!c.test(m)&&d>0&&d<x.length;)d+=v,m=x[d];return c.test(m)&&(d+=v===1?0:1),d},selectWord:function(l){l=l||this.selectionStart;var v=this.searchWordBoundary(l,-1),x=this.searchWordBoundary(l,1);this.selectionStart=v,this.selectionEnd=x,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(l){l=l||this.selectionStart;var v=this.findLineBoundaryLeft(l),x=this.findLineBoundaryRight(l);return this.selectionStart=v,this.selectionEnd=x,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(l){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(l),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(l){l._iTextInstances&&l._iTextInstances.forEach(function(v){v.selected=!1,v.isEditing&&v.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(l){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var v=this.getSelectionStartFromPointer(l.e),x=this.selectionStart,d=this.selectionEnd;(v!==this.__selectionStartOnMouseDown||x===d)&&(x===v||d===v)||(v>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=v):(this.selectionStart=v,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==x||this.selectionEnd!==d)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(l,v,x){var d=x.slice(0,l),m=f.util.string.graphemeSplit(d).length;if(l===v)return{selectionStart:m,selectionEnd:m};var c=x.slice(l,v),_=f.util.string.graphemeSplit(c).length;return{selectionStart:m,selectionEnd:m+_}},fromGraphemeToStringSelection:function(l,v,x){var d=x.slice(0,l),m=d.join("").length;if(l===v)return{selectionStart:m,selectionEnd:m};var c=x.slice(l,v),_=c.join("").length;return{selectionStart:m,selectionEnd:m+_}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var l=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=l.selectionStart,this.hiddenTextarea.selectionEnd=l.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=l.selectionEnd,this.inCompositionMode||(this.selectionStart=l.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var l=this._calcTextareaPosition();this.hiddenTextarea.style.left=l.left,this.hiddenTextarea.style.top=l.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var l=this.inCompositionMode?this.compositionStart:this.selectionStart,v=this._getCursorBoundaries(l),x=this.get2DCursorLocation(l),d=x.lineIndex,m=x.charIndex,c=this.getValueOfPropertyAt(d,m,"fontSize")*this.lineHeight,_=v.leftOffset,w=this.calcTransformMatrix(),g={x:v.left+_,y:v.top+v.topOffset+c},C=this.canvas.getRetinaScaling(),L=this.canvas.upperCanvasEl,B=L.width/C,q=L.height/C,K=B-c,se=q-c,he=L.clientWidth/B,le=L.clientHeight/q;return g=f.util.transformPoint(g,w),g=f.util.transformPoint(g,this.canvas.viewportTransform),g.x*=he,g.y*=le,g.x<0&&(g.x=0),g.x>K&&(g.x=K),g.y<0&&(g.y=0),g.y>se&&(g.y=se),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:g.x+"px",top:g.y+"px",fontSize:c+"px",charHeight:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var l=this._textBeforeEdit!==this.text,v=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,v&&(v.blur&&v.blur(),v.parentNode&&v.parentNode.removeChild(v)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),l&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),l&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var l in this.styles)this._textLines[l]||delete this.styles[l]},removeStyleFromTo:function(l,v){var x=this.get2DCursorLocation(l,!0),d=this.get2DCursorLocation(v,!0),m=x.lineIndex,c=x.charIndex,_=d.lineIndex,w=d.charIndex,g,C;if(m!==_){if(this.styles[m])for(g=c;g<this._unwrappedTextLines[m].length;g++)delete this.styles[m][g];if(this.styles[_])for(g=w;g<this._unwrappedTextLines[_].length;g++)C=this.styles[_][g],C&&(this.styles[m]||(this.styles[m]={}),this.styles[m][c+g-w]=C);for(g=m+1;g<=_;g++)delete this.styles[g];this.shiftLineStyles(_,m-_)}else if(this.styles[m]){C=this.styles[m];var L=w-c,B,q;for(g=c;g<w;g++)delete C[g];for(q in this.styles[m])B=parseInt(q,10),B>=w&&(C[B-L]=C[q],delete C[q])}},shiftLineStyles:function(l,v){var x=t(this.styles);for(var d in this.styles){var m=parseInt(d,10);m>l&&(this.styles[m+v]=x[m],x[m-v]||delete this.styles[m])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(l,v,x,d){var m,c={},_=!1,w=this._unwrappedTextLines[l].length===v;x||(x=1),this.shiftLineStyles(l,x),this.styles[l]&&(m=this.styles[l][v===0?v:v-1]);for(var g in this.styles[l]){var C=parseInt(g,10);C>=v&&(_=!0,c[C-v]=this.styles[l][g],w&&v===0||delete this.styles[l][g])}var L=!1;for(_&&!w&&(this.styles[l+x]=c,L=!0),L&&x--;x>0;)d&&d[x-1]?this.styles[l+x]={0:t(d[x-1])}:m?this.styles[l+x]={0:t(m)}:delete this.styles[l+x],x--;this._forceClearCache=!0},insertCharStyleObject:function(l,v,x,d){this.styles||(this.styles={});var m=this.styles[l],c=m?t(m):{};x||(x=1);for(var _ in c){var w=parseInt(_,10);w>=v&&(m[w+x]=c[w],c[w-x]||delete m[w])}if(this._forceClearCache=!0,d){for(;x--;)Object.keys(d[x]).length&&(this.styles[l]||(this.styles[l]={}),this.styles[l][v+x]=t(d[x]));return}if(m)for(var g=m[v?v-1:1];g&&x--;)this.styles[l][v+x]=t(g)},insertNewStyleBlock:function(l,v,x){for(var d=this.get2DCursorLocation(v,!0),m=[0],c=0,_=0;_<l.length;_++)l[_]===`
`?(c++,m[c]=0):m[c]++;m[0]>0&&(this.insertCharStyleObject(d.lineIndex,d.charIndex,m[0],x),x=x&&x.slice(m[0]+1)),c&&this.insertNewlineStyleObject(d.lineIndex,d.charIndex+m[0],c);for(var _=1;_<c;_++)m[_]>0?this.insertCharStyleObject(d.lineIndex+_,0,m[_],x):x&&this.styles[d.lineIndex+_]&&x[0]&&(this.styles[d.lineIndex+_][0]=x[0]),x=x&&x.slice(m[_]+1);m[_]>0&&this.insertCharStyleObject(d.lineIndex+_,0,m[_],x)},setSelectionStartEndWithShift:function(l,v,x){x<=l?(v===l?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=l),this.selectionStart=x):x>l&&x<v?this._selectionDirection==="right"?this.selectionEnd=x:this.selectionStart=x:(v===l?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=v),this.selectionEnd=x)},setSelectionInBoundaries:function(){var l=this.text.length;this.selectionStart>l?this.selectionStart=l:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>l?this.selectionEnd=l:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),f.util.object.extend(f.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(t){if(this.canvas){this.__newClickTime=+new Date;var l=t.pointer;this.isTripleClick(l)&&(this.fire("tripleclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=l,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))},tripleClickHandler:function(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(t){!this.canvas||!this.editable||t.e.button&&t.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(t.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(t){!this.canvas||!this.editable||t.e.button&&t.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){if(this.__isMousedown=!1,!(!this.editable||this.group||t.transform&&t.transform.actionPerformed||t.e.button&&t.e.button!==1)){if(this.canvas){var l=this.canvas._activeObject;if(l&&l!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(t){var l=this.getSelectionStartFromPointer(t),v=this.selectionStart,x=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(v,x,l):(this.selectionStart=l,this.selectionEnd=l),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var l=this.getLocalPointer(t),v=0,x=0,d=0,m=0,c=0,_,w,g=0,C=this._textLines.length;g<C&&d<=l.y;g++)d+=this.getHeightOfLine(g)*this.scaleY,c=g,g>0&&(m+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));_=this._getLineLeftOffset(c),x=_*this.scaleX,w=this._textLines[c],this.direction==="rtl"&&(l.x=this.width*this.scaleX-l.x+x);for(var L=0,B=w.length;L<B&&(v=x,x+=this.__charBounds[c][L].kernedWidth*this.scaleX,x<=l.x);L++)m++;return this._getNewSelectionStartFromOffset(l,v,x,m,B)},_getNewSelectionStartFromOffset:function(t,l,v,x,d){var m=t.x-l,c=v-t.x,_=c>m||c<0?0:1,w=x+_;return this.flipX&&(w=d-w),w>this._text.length&&(w=this._text.length),w}}),f.util.object.extend(f.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=f.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+t.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):f.document.body.appendChild(this.hiddenTextarea),f.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),f.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),f.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),f.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),f.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),f.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),f.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),f.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),f.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(f.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){var l=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in l)this[l[t.keyCode]](t);else if(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapDown[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapUp[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(t){var l=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!!this.isEditing){var v=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,x=this._text.length,d=v.length,m,c,_=d-x,w=this.selectionStart,g=this.selectionEnd,C=w!==g,L,B,q;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var K=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),se=w>K.selectionStart;C?(m=this._text.slice(w,g),_+=g-w):d<x&&(se?m=this._text.slice(g+_,g):m=this._text.slice(w,w-_)),c=v.slice(K.selectionEnd-_,K.selectionEnd),m&&m.length&&(c.length&&(L=this.getSelectionStyles(w,w+1,!1),L=c.map(function(){return L[0]})),C?(B=w,q=g):se?(B=g-m.length,q=g):(B=g,q=g+m.length),this.removeStyleFromTo(B,q)),c.length&&(l&&c.join("")===f.copiedText&&!f.disableStyleCopyPaste&&(L=f.copiedTextStyle),this.insertNewStyleBlock(c,w,L)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(f.copiedText=this.getSelectedText(),f.disableStyleCopyPaste?f.copiedTextStyle=null:f.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||f.window.clipboardData},_getWidthBeforeCursor:function(t,l){var v=this._getLineLeftOffset(t),x;return l>0&&(x=this.__charBounds[t][l-1],v+=x.left+x.width),v},getDownCursorOffset:function(t,l){var v=this._getSelectionForOffset(t,l),x=this.get2DCursorLocation(v),d=x.lineIndex;if(d===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-v;var m=x.charIndex,c=this._getWidthBeforeCursor(d,m),_=this._getIndexOnLine(d+1,c),w=this._textLines[d].slice(m);return w.length+_+1+this.missingNewlineOffset(d)},_getSelectionForOffset:function(t,l){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&l?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,l){var v=this._getSelectionForOffset(t,l),x=this.get2DCursorLocation(v),d=x.lineIndex;if(d===0||t.metaKey||t.keyCode===33)return-v;var m=x.charIndex,c=this._getWidthBeforeCursor(d,m),_=this._getIndexOnLine(d-1,c),w=this._textLines[d].slice(0,m),g=this.missingNewlineOffset(d-1);return-this._textLines[d-1].length+_-w.length+(1-g)},_getIndexOnLine:function(t,l){for(var v=this._textLines[t],x=this._getLineLeftOffset(t),d=x,m=0,c,_,w=0,g=v.length;w<g;w++)if(c=this.__charBounds[t][w].width,d+=c,d>l){_=!0;var C=d-c,L=d,B=Math.abs(C-l),q=Math.abs(L-l);m=q<B?w:w-1;break}return _||(m=v.length-1),m},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,l){var v="get"+t+"CursorOffset",x=this[v](l,this._selectionDirection==="right");l.shiftKey?this.moveCursorWithShift(x):this.moveCursorWithoutShift(x),x!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var l=this._selectionDirection==="left"?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,l),t!==0},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0},moveCursorLeft:function(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)},_move:function(t,l,v){var x;if(t.altKey)x=this["findWordBoundary"+v](this[l]);else if(t.metaKey||t.keyCode===35||t.keyCode===36)x=this["findLineBoundary"+v](this[l]);else return this[l]+=v==="Left"?-1:1,!0;if(typeof x<"u"&&this[l]!==x)return this[l]=x,!0},_moveLeft:function(t,l){return this._move(t,l,"Left")},_moveRight:function(t,l){return this._move(t,l,"Right")},moveCursorLeftWithoutShift:function(t){var l=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(l=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,l},moveCursorLeftWithShift:function(t){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(t,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(t,"selectionStart")},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,l){var v="moveCursor"+t+"With";this._currentCursorOpacity=1,l.shiftKey?v+="Shift":v+="outShift",this[v](l)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(t,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(t,"selectionEnd")},moveCursorRightWithoutShift:function(t){var l=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(l=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,l},removeChars:function(t,l){typeof l>"u"&&(l=t+1),this.removeStyleFromTo(t,l),this._text.splice(t,l-t),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(t,l,v,x){typeof x>"u"&&(x=v),x>v&&this.removeStyleFromTo(v,x);var d=f.util.string.graphemeSplit(t);this.insertNewStyleBlock(d,v,l),this._text=[].concat(this._text.slice(0,v),d,this._text.slice(x)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var t=f.util.toFixed,l=/  +/g;f.util.object.extend(f.Text.prototype,{_toSVG:function(){var v=this._getSVGLeftTopOffsets(),x=this._getSVGTextAndBg(v.textTop,v.textLeft);return this._wrapSVGTextAndBg(x)},toSVG:function(v){return this._createBaseSVGMarkup(this._toSVG(),{reviver:v,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(v){var x=!0,d=this.getSvgTextDecoration(this);return[v.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",d?'text-decoration="'+d+'" ':"",'style="',this.getSvgStyles(x),'"',this.addPaintOrder()," >",v.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(v,x){var d=[],m=[],c=v,_;this._setSVGBg(m);for(var w=0,g=this._textLines.length;w<g;w++)_=this._getLineLeftOffset(w),(this.textBackgroundColor||this.styleHas("textBackgroundColor",w))&&this._setSVGTextLineBg(m,w,x+_,c),this._setSVGTextLineText(d,w,x+_,c),c+=this.getHeightOfLine(w);return{textSpans:d,textBgRects:m}},_createTextCharSpan:function(v,x,d,m){var c=v!==v.trim()||v.match(l),_=this.getSvgSpanStyles(x,c),w=_?'style="'+_+'"':"",g=x.deltaY,C="",L=f.Object.NUM_FRACTION_DIGITS;return g&&(C=' dy="'+t(g,L)+'" '),['<tspan x="',t(d,L),'" y="',t(m,L),'" ',C,w,">",f.util.string.escapeXml(v),"</tspan>"].join("")},_setSVGTextLineText:function(v,x,d,m){var c=this.getHeightOfLine(x),_=this.textAlign.indexOf("justify")!==-1,w,g,C="",L,B,q=0,K=this._textLines[x],se;m+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var he=0,le=K.length-1;he<=le;he++)se=he===le||this.charSpacing,C+=K[he],L=this.__charBounds[x][he],q===0?(d+=L.kernedWidth-L.width,q+=L.width):q+=L.kernedWidth,_&&!se&&this._reSpaceAndTab.test(K[he])&&(se=!0),se||(w=w||this.getCompleteStyleDeclaration(x,he),g=this.getCompleteStyleDeclaration(x,he+1),se=f.util.hasStyleChanged(w,g,!0)),se&&(B=this._getStyleDeclaration(x,he)||{},v.push(this._createTextCharSpan(C,B,d,m)),C="",w=g,d+=q,q=0)},_pushTextBgRect:function(v,x,d,m,c,_){var w=f.Object.NUM_FRACTION_DIGITS;v.push("		<rect ",this._getFillAttributes(x),' x="',t(d,w),'" y="',t(m,w),'" width="',t(c,w),'" height="',t(_,w),`"></rect>
`)},_setSVGTextLineBg:function(v,x,d,m){for(var c=this._textLines[x],_=this.getHeightOfLine(x)/this.lineHeight,w=0,g=0,C,L,B=this.getValueOfPropertyAt(x,0,"textBackgroundColor"),q=0,K=c.length;q<K;q++)C=this.__charBounds[x][q],L=this.getValueOfPropertyAt(x,q,"textBackgroundColor"),L!==B?(B&&this._pushTextBgRect(v,B,d+g,m,w,_),g=C.left,w=C.width,B=L):w+=C.kernedWidth;L&&this._pushTextBgRect(v,L,d+g,m,w,_)},_getFillAttributes:function(v){var x=v&&typeof v=="string"?new f.Color(v):"";return!x||!x.getSource()||x.getAlpha()===1?'fill="'+v+'"':'opacity="'+x.getAlpha()+'" fill="'+x.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(v){for(var x=0,d=0,m=0;m<v;m++)x+=this.getHeightOfLine(m);return d=this.getHeightOfLine(m),{lineTop:x,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(v){var x=f.Object.prototype.getSvgStyles.call(this,v);return x+" white-space: pre;"}})}(),function(t){var l=t.fabric||(t.fabric={});l.Textbox=l.util.createClass(l.IText,l.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:l.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(v){for(var x=0,d=0,m=0,c={},_=0;_<v.graphemeLines.length;_++)v.graphemeText[m]===`
`&&_>0?(d=0,m++,x++):!this.splitByGrapheme&&this._reSpaceAndTab.test(v.graphemeText[m])&&_>0&&(d++,m++),c[_]={line:x,offset:d},m+=v.graphemeLines[_].length,d+=v.graphemeLines[_].length;return c},styleHas:function(v,x){if(this._styleMap&&!this.isWrapping){var d=this._styleMap[x];d&&(x=d.line)}return l.Text.prototype.styleHas.call(this,v,x)},isEmptyStyles:function(v){if(!this.styles)return!0;var x=0,d=v+1,m,c,_=!1,w=this._styleMap[v],g=this._styleMap[v+1];w&&(v=w.line,x=w.offset),g&&(d=g.line,_=d===v,m=g.offset),c=typeof v>"u"?this.styles:{line:this.styles[v]};for(var C in c)for(var L in c[C])if(L>=x&&(!_||L<m))for(var B in c[C][L])return!1;return!0},_getStyleDeclaration:function(v,x){if(this._styleMap&&!this.isWrapping){var d=this._styleMap[v];if(!d)return null;v=d.line,x=d.offset+x}return this.callSuper("_getStyleDeclaration",v,x)},_setStyleDeclaration:function(v,x,d){var m=this._styleMap[v];v=m.line,x=m.offset+x,this.styles[v][x]=d},_deleteStyleDeclaration:function(v,x){var d=this._styleMap[v];v=d.line,x=d.offset+x,delete this.styles[v][x]},_getLineStyle:function(v){var x=this._styleMap[v];return!!this.styles[x.line]},_setLineStyle:function(v){var x=this._styleMap[v];this.styles[x.line]={}},_wrapText:function(v,x){var d=[],m;for(this.isWrapping=!0,m=0;m<v.length;m++)d=d.concat(this._wrapLine(v[m],m,x));return this.isWrapping=!1,d},_measureWord:function(v,x,d){var m=0,c,_=!0;d=d||0;for(var w=0,g=v.length;w<g;w++){var C=this._getGraphemeBox(v[w],x,w+d,c,_);m+=C.kernedWidth,c=v[w]}return m},_wrapLine:function(v,x,d,ot){var c=0,_=this.splitByGrapheme,w=[],g=[],C=_?l.util.string.graphemeSplit(v):v.split(this._wordJoiners),L="",B=0,q=_?"":" ",K=0,se=0,he=0,le=!0,ve=this._getWidthOfCharSpacing(),ot=ot||0;C.length===0&&C.push([]),d-=ot;for(var _e=0;_e<C.length;_e++)L=_?C[_e]:l.util.string.graphemeSplit(C[_e]),K=this._measureWord(L,x,B),B+=L.length,c+=se+K-ve,c>d&&!le?(w.push(g),g=[],c=K,le=!0):c+=ve,!le&&!_&&g.push(q),g=g.concat(L),se=_?0:this._measureWord([q],x,B),B++,le=!1,K>he&&(he=K);return _e&&w.push(g),he+ot>this.dynamicMinWidth&&(this.dynamicMinWidth=he-ve+ot),w},isEndOfWrapping:function(v){return!this._styleMap[v+1]||this._styleMap[v+1].line!==this._styleMap[v].line},missingNewlineOffset:function(v){return this.splitByGrapheme?this.isEndOfWrapping(v)?1:0:1},_splitTextIntoLines:function(v){for(var x=l.Text.prototype._splitTextIntoLines.call(this,v),d=this._wrapText(x.lines,this.width),m=new Array(d.length),c=0;c<d.length;c++)m[c]=d[c].join("");return x.lines=m,x.graphemeLines=d,x},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var v={};for(var x in this._styleMap)this._textLines[x]&&(v[this._styleMap[x].line]=1);for(var x in this.styles)v[x]||delete this.styles[x]},toObject:function(v){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(v))}}),l.Textbox.fromObject=function(v,x){var d=l.util.stylesFromArray(v.styles,v.text),m=Object.assign({},v,{styles:d});return l.Object._fromObject("Textbox",m,x,"text")}}(M),function(){var t=f.controlsUtils,l=t.scaleSkewCursorStyleHandler,v=t.scaleCursorStyleHandler,x=t.scalingEqually,d=t.scalingYOrSkewingX,m=t.scalingXOrSkewingY,c=t.scaleOrSkewActionName,_=f.Object.prototype.controls;if(_.ml=new f.Control({x:-.5,y:0,cursorStyleHandler:l,actionHandler:m,getActionName:c}),_.mr=new f.Control({x:.5,y:0,cursorStyleHandler:l,actionHandler:m,getActionName:c}),_.mb=new f.Control({x:0,y:.5,cursorStyleHandler:l,actionHandler:d,getActionName:c}),_.mt=new f.Control({x:0,y:-.5,cursorStyleHandler:l,actionHandler:d,getActionName:c}),_.tl=new f.Control({x:-.5,y:-.5,cursorStyleHandler:v,actionHandler:x}),_.tr=new f.Control({x:.5,y:-.5,cursorStyleHandler:v,actionHandler:x}),_.bl=new f.Control({x:-.5,y:.5,cursorStyleHandler:v,actionHandler:x}),_.br=new f.Control({x:.5,y:.5,cursorStyleHandler:v,actionHandler:x}),_.mtr=new f.Control({x:0,y:-.5,actionHandler:t.rotationWithSnapping,cursorStyleHandler:t.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),f.Textbox){var w=f.Textbox.prototype.controls={};w.mtr=_.mtr,w.tr=_.tr,w.br=_.br,w.tl=_.tl,w.bl=_.bl,w.mt=_.mt,w.mb=_.mb,w.mr=new f.Control({x:.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:l,actionName:"resizing"}),w.ml=new f.Control({x:-.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:l,actionName:"resizing"})}}()})(V_);(function(M){Object.defineProperty(M,"__esModule",{value:!0}),M.DPI=M.PageOrientation=M.Size=M.Unit=M.Format=void 0;const f=yv,A=vv,D=Nh,R=V_;M.Format={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},M.Unit={in:"in",mm:"mm"},M.Size={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},M.PageOrientation={Landscape:"landscape",Portrait:"portrait"},M.DPI={72:72,96:96,200:200,300:300,400:400};class z{constructor(t,l=M.Size.A4,v=300,x=M.Format.PNG.toString(),d=M.Unit.mm,m){this.map=t,this.width=l[0],this.height=l[1],this.dpi=v,this.format=x,this.unit=d,this.accesstoken=m}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const l=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const v=document.createElement("div");v.className="hidden-map",document.body.appendChild(v);const x=document.createElement("div");x.style.width=this.toPixels(this.width),x.style.height=this.toPixels(this.height),v.appendChild(x);const d=this.map.getStyle();if(d&&d.sources){const _=d.sources;Object.keys(_).forEach(w=>{const g=_[w];Object.keys(g).forEach(C=>{g[C]||delete g[C]})})}const m=new D.Map({accessToken:this.accesstoken||D.accessToken,container:x,style:d,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn}),c=(this.map.style.imageManager||{}).images||[];Object.keys(c).forEach(_=>{m.addImage(_,c[_].data)}),m.once("idle",()=>{var _;const w=m.getCanvas(),g=`map.${t.format}`;switch(t.format){case M.Format.PNG:t.toPNG(w,g);break;case M.Format.JPEG:t.toJPEG(w,g);break;case M.Format.PDF:t.toPDF(m,g);break;case M.Format.SVG:t.toSVG(w,g);break;default:console.error(`Invalid file format: ${t.format}`);break}m.remove(),(_=v.parentNode)===null||_===void 0||_.removeChild(v),Object.defineProperty(window,"devicePixelRatio",{get(){return l}}),JsLoadingOverlay.hide()})}toPNG(t,l){t.toBlob(v=>{(0,A.saveAs)(v,l)})}toJPEG(t,l){const v=t.toDataURL("image/jpeg",.85),x=document.createElement("a");x.href=v,x.download=l,x.click(),x.remove()}toPDF(t,l){const v=t.getCanvas(),x=new f.jsPDF({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0});x.addImage(v.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:d,lat:m}=t.getCenter();x.setProperties({title:t.getStyle().name,subject:`center: [${d}, ${m}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),x.save(l)}toSVG(t,l){const v=t.toDataURL("image/png");R.fabric.Image.fromURL(v,x=>{const d=new R.fabric.Canvas("canvas"),m=Number(this.toPixels(this.width,this.dpi).replace("px","")),c=Number(this.toPixels(this.height,this.dpi).replace("px",""));x.scaleToWidth(m),x.scaleToHeight(c),d.add(x);const _=d.toSVG({x:0,y:0,width:m,height:c,viewBox:{x:0,y:0,width:m,height:c}}),w=document.createElement("a");w.href=`data:application/xml,${encodeURIComponent(_)}`,w.download=l,w.click(),w.remove()})}toPixels(t,l=96){return this.unit===M.Unit.mm&&(l/=25.4),`${l*t}px`}}M.default=z})(Lf);Object.defineProperty(yp,"__esModule",{value:!0});const v_=Lf;class wv{constructor(f){var A,D,R;if(this.map=f,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const z=(A=this.map)===null||A===void 0?void 0:A.getCanvas().clientWidth,V=(D=this.map)===null||D===void 0?void 0:D.getCanvas().clientHeight,t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.setAttribute("width",`${z}px`),t.setAttribute("height",`${V}px`);const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("style","fill:#888888;stroke-width:0"),l.setAttribute("fill-opacity","0.5"),t.append(l),(R=this.map)===null||R===void 0||R.getCanvasContainer().appendChild(t),this.svgCanvas=t,this.svgPath=l}mapResize(){this.generateCutOut()}updateArea(f,A){this.width=f,this.height=A,this.unit=v_.Unit.mm,this.generateCutOut()}generateCutOut(){var f,A;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const D=this.toPixels(this.width),R=this.toPixels(this.height),z=(f=this.map)===null||f===void 0?void 0:f.getCanvas().clientWidth,V=(A=this.map)===null||A===void 0?void 0:A.getCanvas().clientHeight,t=z/2-D/2,l=t+D,v=V/2-R/2,x=v+R;this.svgCanvas.setAttribute("width",`${z}px`),this.svgCanvas.setAttribute("height",`${V}px`),this.svgPath.setAttribute("d",`M 0 0 L ${z} 0 L ${z} ${V} L 0 ${V} M ${t} ${v} L ${t} ${x} L ${l} ${x} L ${l} ${v}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(f,A=96){return this.unit===v_.Unit.mm&&(A/=25.4),A*f}}yp.default=wv;var Mo={},bp={};Object.defineProperty(bp,"__esModule",{value:!0});const Sv={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"};bp.default=Sv;var wp={};Object.defineProperty(wp,"__esModule",{value:!0});const Tv={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer"};wp.default=Tv;var Sp={};Object.defineProperty(Sp,"__esModule",{value:!0});const Cv={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"};Sp.default=Cv;var Tp={};Object.defineProperty(Tp,"__esModule",{value:!0});const Av={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen"};Tp.default=Av;var Cp={};Object.defineProperty(Cp,"__esModule",{value:!0});const Ev={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"};Cp.default=Ev;var Ap={};Object.defineProperty(Ap,"__esModule",{value:!0});const Pv={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo"};Ap.default=Pv;Object.defineProperty(Mo,"__esModule",{value:!0});Mo.vietnam=Mo.swedish=Mo.german=Mo.finnish=Mo.french=Mo.english=void 0;const Mv=bp;Mo.english=Mv.default;const Lv=wp;Mo.french=Lv.default;const Iv=Sp;Mo.finnish=Iv.default;const kv=Tp;Mo.german=kv.default;const Dv=Cp;Mo.swedish=Dv.default;const Ov=Ap;Mo.vietnam=Ov.default;Object.defineProperty(gp,"__esModule",{value:!0});const Fv=_p,zv=yp,Zc=Mo,pa=Lf;class Rv{constructor(f){this.options={PageSize:pa.Size.A4,PageOrientation:pa.PageOrientation.Landscape,Format:pa.Format.PDF,DPI:pa.DPI[300],Crosshair:!1,PrintableArea:!1,accessToken:void 0},f&&(this.options=Object.assign(this.options,f)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Zc.german;case"en":return Zc.english;case"fr":return Zc.french;case"fi":return Zc.finnish;case"sv":return Zc.swedish;case"vi":return Zc.vietnam;default:return Zc.english}}onAdd(f){this.map=f,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("mapboxgl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("mapboxgl-ctrl-icon"),this.exportButton.classList.add("mapboxgl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const A=document.createElement("TABLE");A.className="print-table";const D=this.createSelection(pa.Size,this.getTranslation().PageSize,"page-size",this.options.PageSize,(l,v)=>JSON.stringify(l[v]));A.appendChild(D);const R=this.createSelection(pa.PageOrientation,this.getTranslation().PageOrientation,"page-orientaiton",this.options.PageOrientation,(l,v)=>l[v]);A.appendChild(R);const z=this.createSelection(pa.Format,this.getTranslation().Format,"format-type",this.options.Format,(l,v)=>l[v]);A.appendChild(z);const V=this.createSelection(pa.DPI,this.getTranslation().DPI,"dpi-type",this.options.DPI,(l,v)=>l[v]);A.appendChild(V),this.exportContainer.appendChild(A);const t=document.createElement("button");return t.type="button",t.textContent=this.getTranslation().Generate,t.classList.add("generate-button"),t.addEventListener("click",()=>{const l=document.getElementById("mapbox-gl-export-page-size"),v=document.getElementById("mapbox-gl-export-page-orientaiton"),x=document.getElementById("mapbox-gl-export-format-type"),d=document.getElementById("mapbox-gl-export-dpi-type"),m=v.value;let c=JSON.parse(l.value);m===pa.PageOrientation.Portrait&&(c=c.reverse()),new pa.default(f,c,Number(d.value),x.value,pa.Unit.mm,this.options.accessToken).generate()}),this.exportContainer.appendChild(t),this.controlContainer}createSelection(f,A,D,R,z){const V=document.createElement("label");V.textContent=A;const t=document.createElement("select");t.setAttribute("id",`mapbox-gl-export-${D}`),t.style.width="100%",Object.keys(f).forEach(d=>{const m=document.createElement("option");m.setAttribute("value",z(f,d)),m.appendChild(document.createTextNode(d)),m.setAttribute("name",D),R===f[d]&&(m.selected=!0),t.appendChild(m)}),t.addEventListener("change",()=>{this.updatePrintableArea()});const l=document.createElement("TR"),v=document.createElement("TD"),x=document.createElement("TD");return v.appendChild(V),x.appendChild(t),l.appendChild(v),l.appendChild(x),l}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(f){this.controlContainer&&!this.controlContainer.contains(f.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(f){this.options.Crosshair===!0&&(f===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Fv.default(this.map),this.crosshair.create()))}togglePrintableArea(f){this.options.PrintableArea===!0&&(f===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new zv.default(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const f=document.getElementById("mapbox-gl-export-page-size"),D=document.getElementById("mapbox-gl-export-page-orientaiton").value;let R=JSON.parse(f.value);D===pa.PageOrientation.Portrait&&(R=R.reverse()),this.printableArea.updateArea(R[0],R[1])}}gp.default=Rv;(function(M){Object.defineProperty(M,"__esModule",{value:!0}),M.DPI=M.Format=M.PageOrientation=M.Size=M.MapboxExportControl=void 0;var f=gp;Object.defineProperty(M,"MapboxExportControl",{enumerable:!0,get:function(){return f.default}});var A=Lf;Object.defineProperty(M,"Size",{enumerable:!0,get:function(){return A.Size}}),Object.defineProperty(M,"PageOrientation",{enumerable:!0,get:function(){return A.PageOrientation}}),Object.defineProperty(M,"Format",{enumerable:!0,get:function(){return A.Format}}),Object.defineProperty(M,"DPI",{enumerable:!0,get:function(){return A.DPI}})})(zh);class Bv{constructor(f){co(this,"onStyleChange",()=>{});co(this,"toggleTerrain",()=>{this._map.getSource("mapbox-dem")||this._map.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.threeDim?(this._map.easeTo({pitch:0,duration:1e3}),this._map.setTerrain()):(this._map.setTerrain({source:"mapbox-dem",exaggeration:1}),this._map.easeTo({pitch:80,duration:1e3})),this.threeDim=!this.threeDim});this.backgroundMaps={},this.overlayMaps={},this.currentMap,this._map,this.currentRasterMapName,this.currentVectorMapName,this.currentMapType,this.currentOverlayMaps=[],this.threeDim=!1,Object.entries(f).forEach(([A,D])=>{D.name=A,D.overlay?this.overlayMaps[A]=D:(this.backgroundMaps[A]=D,D.visible&&(this.currentMap=A))})}onAdd(f){this._map=f,this._container=document.createElement("div"),this._container.id="layer-switcher-container";const A=document.createElement("div");A.className="mapboxgl-ctrl mapboxgl-ctrl-group",A.id="layer-switcher";const D=document.createElement("button");D.id="layer-switcher-button",D.innerHTML='<i class="fa-solid fa-layer-group"></i>';const R=document.createElement("button");R.innerHTML='<i class="fa-solid fa-mountain-sun"></i>',this.threeDim&&R.classList.add("layer-switcher-3d-active"),R.onclick=()=>{R.classList.toggle("layer-switcher-3d-active"),this.toggleTerrain()},A.appendChild(D),A.appendChild(R),this._container.appendChild(A);const z=document.createElement("div");return z.id="layer-switcher-content",z.appendChild(this.layerTable(this.backgroundMaps,!1)),z.appendChild(this.layerTable(this.overlayMaps,!0)),this._container.appendChild(z),this.setMap(this.backgroundMaps[this.currentMap]),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}async setMap(f){if(f.type==="vector")this.currentMapType==="raster"&&(this._map.removeLayer(this.currentRasterMapName),this._map.removeSource(this.currentRasterMapName)),this.currentVectorMapName!=f.name&&(this._map.setStyle(f.url),this._map.once("styledata",()=>{this.onStyleChange(),this.threeDim&&(this.threeDim=!1,this.toggleTerrain()),this.addOverlayMaps()}),this.previousVectorMap=f.name,this.currentMapType="vector");else{this.currentMapType==="raster"&&(this._map.removeLayer(this.currentRasterMapName),this._map.removeSource(this.currentRasterMapName));const A=this.currentOverlayMaps.length>0?this.currentOverlayMaps[0]:"routeLayer";this._map.addSource(f.name,{type:"raster",tiles:[f.url],tileSize:256}),this._map.addLayer({id:f.name,type:"raster",source:f.name},A),this.currentMapType="raster",this.currentRasterMapName=f.name}}async addOverlayMap(f){this._map.addSource(f.name,{type:"raster",tiles:[f.url],tileSize:256}),this._map.addLayer({id:f.name,type:"raster",source:f.name,paint:{"raster-opacity":f.opacity}},"routeLayer")}async addOverlayMaps(){Object.entries(this.overlayMaps).forEach(([f,A])=>{A.visible&&this.addOverlayMap(A)})}layerTable(f,A=!1){const D=document.createElement("div");return D.className="mapboxgl-ctrl mapboxgl-ctrl-group",Object.entries(f).forEach(([R,z])=>{const V=document.createElement("button");V.id=R,V.className="mapboxgl-ctrl-layer",z.visible&&V.classList.toggle("mapboxgl-ctrl-layer-active"),V.innerHTML=R,V.onclick=()=>{!A&&!z.visible&&(Object.entries(f).forEach(([t,l])=>{l.visible=!1,document.getElementById(t).classList.remove("mapboxgl-ctrl-layer-active")}),z.visible=!0,V.classList.toggle("mapboxgl-ctrl-layer-active"),this.setMap(z)),A&&(z.visible=!z.visible,V.classList.toggle("mapboxgl-ctrl-layer-active"),z.visible?(this.addOverlayMap(z),this.currentOverlayMaps.push(R)):(this._map.removeLayer(R),this._map.removeSource(R),this.currentOverlayMaps.pop(R)))},D.appendChild(V)}),D}}class Nv{constructor(f){this.allCategories=[],this.sportsCategories=f,this.shownTracks={},this.colorMap=new Proxy({},{get:(A,D)=>D in A?A[D]:this.sportsCategories.Misc.color}),this.aliasMap=new Proxy({},{get:(A,D)=>D in A?A[D]:"Misc"}),this.lineColor=["match",["get","type"]],Object.entries(this.sportsCategories).forEach(([A,D])=>{this.shownTracks[A]=!0,D.alias.forEach(R=>{this.aliasMap[R]=A,this.colorMap[R]=D.color,this.lineColor.push(R,D.color)}),A=="Misc"&&this.lineColor.push(D.color)})}onAdd(f){this._map=f,this._container=document.createElement("div"),this._container.id="activity-filter-container";const A=document.createElement("div");return A.className="mapboxgl-ctrl mapboxgl-ctrl-group",A.id="activity-filter",Object.entries(this.sportsCategories).forEach(([D,R])=>{const z=document.createElement("button");z.id=D,z.innerHTML=`<i class="${R.icon}"></i>`,R.active||z.classList.add("category-not-active"),z.style.color=R.color,z.onclick=()=>{R.active=!R.active,z.classList.toggle("category-not-active"),this.onChange()},A.appendChild(z),Object.entries(R.alias).forEach(([V,t])=>{this.allCategories.push(t)})}),this._container.appendChild(A),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}filter(){var f=[];return Object.entries(this.sportsCategories).forEach(([A,D])=>{D.active&&Object.entries(D.alias).forEach(([R,z])=>{f.push(z)})}),this.sportsCategories.Misc.active?["any",["in","type",...f],["!in","type","Hike",...this.allCategories]]:["in","type",...f]}}class jv{constructor(f,A,D){co(this,"postSelection",()=>{this.selectedFeatureIDs.forEach(f=>{this._map.setFeatureState({source:this.source,id:f},{selected:!1})}),this.selectedFeatureIDs=[],this.selectedFeatures.forEach(f=>{this.selectedFeatureIDs.includes(f.properties.id)?this.selectedFeatures.pop(f):(this.selectedFeatureIDs.push(f.properties.id),this._map.setFeatureState({source:this.source,id:f.id},{selected:!0}))}),this.selectionHandler(this.selectedFeatures),this.onChange()});co(this,"mousePos",f=>{const A=this.canvas.getBoundingClientRect();return new Nh.Point(f.clientX-A.left-this.canvas.clientLeft,f.clientY-A.top-this.canvas.clientTop)});co(this,"mouseDown",f=>{f.shiftKey&&f.button===0&&(this._map.dragPan.disable(),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),this.start=this.mousePos(f))});co(this,"onMouseMove",f=>{this.current=this.mousePos(f),this.box||(this.box=document.createElement("div"),this.box.classList.add("boxdraw"),this.canvas.appendChild(this.box));const A=Math.min(this.start.x,this.current.x),D=Math.max(this.start.x,this.current.x),R=Math.min(this.start.y,this.current.y),z=Math.max(this.start.y,this.current.y),V=`translate(${A}px, ${R}px)`;this.box.style.transform=V,this.box.style.width=D-A+"px",this.box.style.height=z-R+"px"});co(this,"onMouseUp",f=>{this.finish([this.start,this.mousePos(f)])});co(this,"onKeyDown",f=>{f.keyCode===27&&finish()});co(this,"finish",f=>{if(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("mouseup",this.onMouseUp),this.box&&(this.box.parentNode.removeChild(this.box),this.box=null),f){if(this.selectedFeatures=this._map.queryRenderedFeatures(f,{layers:this.layers}),this.selectedFeatures.length>=1e3)return window.alert("Select a smaller number of features");this.postSelection()}this._map.dragPan.enable()});this._map,this.selectedFeatureIDs=[],this.selectedFeatures=[],this.canvas,this.layers=f,this.source=A,this.selectionHandler=D,this.start,this.current,this.box=null}onChange(){}onAdd(f){return this._map=f,this.canvas=f.getCanvasContainer(),this._container=document.createElement("div"),f.boxZoom.disable(),f.on("click",A=>{const D=[[A.point.x-5,A.point.y-5],[A.point.x+5,A.point.y+5]];this.selectedFeatures=f.queryRenderedFeatures(D,{layers:this.layers}),this.postSelection()}),this.canvas.addEventListener("mousedown",this.mouseDown,!0),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}filter(){return["in","id",...this.selectedFeatureIDs]}}class Uv{constructor(f){co(this,"tableRow",f=>{const A=Object.entries(this.tableColumns).map(function([D,R]){return"sort"in R?`<td data-sort='${R.sort(f)}'>${R.body(f)}</td>`:`<td>${R.body(f)}</td>`});return`<tr id=${f.properties.id} class="${f.properties.type}">`+A.join("")+"</tr>"});co(this,"update",f=>{const A=f.map(this.tableRow);A.length>0?this._container.innerHTML=`<table class="sortable"><thead>
            <tr>${Object.entries(this.tableColumns).map(([D,R])=>`<th>${R.title}</th>`).join("")}</tr>
            </thead><tbody>`+A.join(`
`)+"</tbody></table>":this._container.innerHTML="",f.forEach(D=>{document.getElementById(D.properties.id).addEventListener("mouseover",()=>{this._map.setFeatureState({source:"strava",id:D.properties.id},{hover:!0}),this.hover=D.properties.id,this.onChange()}),document.getElementById(D.properties.id).addEventListener("mouseout",()=>{this._map.setFeatureState({source:"strava",id:D.properties.id},{hover:!1}),this.hover="",this.onChange()})})});co(this,"filter",()=>["==","id",this.hover]);this.tableColumns=f,this.hover=""}onChange(){}onAdd(f){return this._map=f,this._container=document.createElement("div"),this._container.id="feature-table-container",f.boxZoom.disable(),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}class Vv{constructor(){co(this,"negation",f=>[this.negationDict[f[0]],...f.slice(1,f.length)]);this.filterCache={},this._filters={},this.changeHandlers=[],this.negationDict={"==":"!=","!=":"==",">":"<=","<=":">",">=":"<","<":">=",in:"!in","!in":"in",has:"!has","!has":"has"}}onChange(){this.changeHandlers.forEach(f=>f())}addFilter(f,A){this._filters[f]=A,this.filterCache[f]=A.filter(),A.onChange=()=>{this.filterCache[f]=A.filter(),this.onChange()}}filter(f){var A=["all"];return Object.entries(f).forEach(([D,R])=>{R?A.push(this.filterCache[D]):A.push(this.negation(this.filterCache[D]))}),A}}var fp={exports:{}};(function(M,f){(function(A,D){D(f)})(Jc,function(A){A.PipsMode=void 0,function(Ue){Ue.Range="range",Ue.Steps="steps",Ue.Positions="positions",Ue.Count="count",Ue.Values="values"}(A.PipsMode||(A.PipsMode={})),A.PipsType=void 0,function(Ue){Ue[Ue.None=-1]="None",Ue[Ue.NoValue=0]="NoValue",Ue[Ue.LargeValue=1]="LargeValue",Ue[Ue.SmallValue=2]="SmallValue"}(A.PipsType||(A.PipsType={}));function D(Ue){return R(Ue)&&typeof Ue.from=="function"}function R(Ue){return typeof Ue=="object"&&typeof Ue.to=="function"}function z(Ue){Ue.parentElement.removeChild(Ue)}function V(Ue){return Ue!=null}function t(Ue){Ue.preventDefault()}function l(Ue){return Ue.filter(function(ge){return this[ge]?!1:this[ge]=!0},{})}function v(Ue,ge){return Math.round(Ue/ge)*ge}function x(Ue,ge){var Rt=Ue.getBoundingClientRect(),si=Ue.ownerDocument,jt=si.documentElement,Ii=B(si);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(Ii.x=0),ge?Rt.top+Ii.y-jt.clientTop:Rt.left+Ii.x-jt.clientLeft}function d(Ue){return typeof Ue=="number"&&!isNaN(Ue)&&isFinite(Ue)}function m(Ue,ge,Rt){Rt>0&&(g(Ue,ge),setTimeout(function(){C(Ue,ge)},Rt))}function c(Ue){return Math.max(Math.min(Ue,100),0)}function _(Ue){return Array.isArray(Ue)?Ue:[Ue]}function w(Ue){Ue=String(Ue);var ge=Ue.split(".");return ge.length>1?ge[1].length:0}function g(Ue,ge){Ue.classList&&!/\s/.test(ge)?Ue.classList.add(ge):Ue.className+=" "+ge}function C(Ue,ge){Ue.classList&&!/\s/.test(ge)?Ue.classList.remove(ge):Ue.className=Ue.className.replace(new RegExp("(^|\\b)"+ge.split(" ").join("|")+"(\\b|$)","gi")," ")}function L(Ue,ge){return Ue.classList?Ue.classList.contains(ge):new RegExp("\\b"+ge+"\\b").test(Ue.className)}function B(Ue){var ge=window.pageXOffset!==void 0,Rt=(Ue.compatMode||"")==="CSS1Compat",si=ge?window.pageXOffset:Rt?Ue.documentElement.scrollLeft:Ue.body.scrollLeft,jt=ge?window.pageYOffset:Rt?Ue.documentElement.scrollTop:Ue.body.scrollTop;return{x:si,y:jt}}function q(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function K(){var Ue=!1;try{var ge=Object.defineProperty({},"passive",{get:function(){Ue=!0}});window.addEventListener("test",null,ge)}catch{}return Ue}function se(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function he(Ue,ge){return 100/(ge-Ue)}function le(Ue,ge,Rt){return ge*100/(Ue[Rt+1]-Ue[Rt])}function ve(Ue,ge){return le(Ue,Ue[0]<0?ge+Math.abs(Ue[0]):ge-Ue[0],0)}function ot(Ue,ge){return ge*(Ue[1]-Ue[0])/100+Ue[0]}function _e(Ue,ge){for(var Rt=1;Ue>=ge[Rt];)Rt+=1;return Rt}function pe(Ue,ge,Rt){if(Rt>=Ue.slice(-1)[0])return 100;var si=_e(Rt,Ue),jt=Ue[si-1],Ii=Ue[si],wi=ge[si-1],or=ge[si];return wi+ve([jt,Ii],Rt)/he(wi,or)}function ze(Ue,ge,Rt){if(Rt>=100)return Ue.slice(-1)[0];var si=_e(Rt,ge),jt=Ue[si-1],Ii=Ue[si],wi=ge[si-1],or=ge[si];return ot([jt,Ii],(Rt-wi)*he(wi,or))}function De(Ue,ge,Rt,si){if(si===100)return si;var jt=_e(si,Ue),Ii=Ue[jt-1],wi=Ue[jt];return Rt?si-Ii>(wi-Ii)/2?wi:Ii:ge[jt-1]?Ue[jt-1]+v(si-Ue[jt-1],ge[jt-1]):si}var at=function(){function Ue(ge,Rt,si){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[si||!1],this.xNumSteps=[!1],this.snap=Rt;var jt,Ii=[];for(Object.keys(ge).forEach(function(wi){Ii.push([_(ge[wi]),wi])}),Ii.sort(function(wi,or){return wi[0][0]-or[0][0]}),jt=0;jt<Ii.length;jt++)this.handleEntryPoint(Ii[jt][1],Ii[jt][0]);for(this.xNumSteps=this.xSteps.slice(0),jt=0;jt<this.xNumSteps.length;jt++)this.handleStepPoint(jt,this.xNumSteps[jt])}return Ue.prototype.getDistance=function(ge){for(var Rt=[],si=0;si<this.xNumSteps.length-1;si++)Rt[si]=le(this.xVal,ge,si);return Rt},Ue.prototype.getAbsoluteDistance=function(ge,Rt,si){var jt=0;if(ge<this.xPct[this.xPct.length-1])for(;ge>this.xPct[jt+1];)jt++;else ge===this.xPct[this.xPct.length-1]&&(jt=this.xPct.length-2);!si&&ge===this.xPct[jt+1]&&jt++,Rt===null&&(Rt=[]);var Ii,wi=1,or=Rt[jt],Ti=0,Yi=0,qr=0,Hi=0;for(si?Ii=(ge-this.xPct[jt])/(this.xPct[jt+1]-this.xPct[jt]):Ii=(this.xPct[jt+1]-ge)/(this.xPct[jt+1]-this.xPct[jt]);or>0;)Ti=this.xPct[jt+1+Hi]-this.xPct[jt+Hi],Rt[jt+Hi]*wi+100-Ii*100>100?(Yi=Ti*Ii,wi=(or-100*Ii)/Rt[jt+Hi],Ii=1):(Yi=Rt[jt+Hi]*Ti/100*wi,wi=0),si?(qr=qr-Yi,this.xPct.length+Hi>=1&&Hi--):(qr=qr+Yi,this.xPct.length-Hi>=1&&Hi++),or=Rt[jt+Hi]*wi;return ge+qr},Ue.prototype.toStepping=function(ge){return ge=pe(this.xVal,this.xPct,ge),ge},Ue.prototype.fromStepping=function(ge){return ze(this.xVal,this.xPct,ge)},Ue.prototype.getStep=function(ge){return ge=De(this.xPct,this.xSteps,this.snap,ge),ge},Ue.prototype.getDefaultStep=function(ge,Rt,si){var jt=_e(ge,this.xPct);return(ge===100||Rt&&ge===this.xPct[jt-1])&&(jt=Math.max(jt-1,1)),(this.xVal[jt]-this.xVal[jt-1])/si},Ue.prototype.getNearbySteps=function(ge){var Rt=_e(ge,this.xPct);return{stepBefore:{startValue:this.xVal[Rt-2],step:this.xNumSteps[Rt-2],highestStep:this.xHighestCompleteStep[Rt-2]},thisStep:{startValue:this.xVal[Rt-1],step:this.xNumSteps[Rt-1],highestStep:this.xHighestCompleteStep[Rt-1]},stepAfter:{startValue:this.xVal[Rt],step:this.xNumSteps[Rt],highestStep:this.xHighestCompleteStep[Rt]}}},Ue.prototype.countStepDecimals=function(){var ge=this.xNumSteps.map(w);return Math.max.apply(null,ge)},Ue.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},Ue.prototype.convert=function(ge){return this.getStep(this.toStepping(ge))},Ue.prototype.handleEntryPoint=function(ge,Rt){var si;if(ge==="min"?si=0:ge==="max"?si=100:si=parseFloat(ge),!d(si)||!d(Rt[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(si),this.xVal.push(Rt[0]);var jt=Number(Rt[1]);si?this.xSteps.push(isNaN(jt)?!1:jt):isNaN(jt)||(this.xSteps[0]=jt),this.xHighestCompleteStep.push(0)},Ue.prototype.handleStepPoint=function(ge,Rt){if(Rt){if(this.xVal[ge]===this.xVal[ge+1]){this.xSteps[ge]=this.xHighestCompleteStep[ge]=this.xVal[ge];return}this.xSteps[ge]=le([this.xVal[ge],this.xVal[ge+1]],Rt,0)/he(this.xPct[ge],this.xPct[ge+1]);var si=(this.xVal[ge+1]-this.xVal[ge])/this.xNumSteps[ge],jt=Math.ceil(Number(si.toFixed(3))-1),Ii=this.xVal[ge]+this.xNumSteps[ge]*jt;this.xHighestCompleteStep[ge]=Ii}},Ue}(),ft={to:function(Ue){return Ue===void 0?"":Ue.toFixed(2)},from:Number},xt={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},He={tooltips:".__tooltips",aria:".__aria"};function ae(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'step' is not numeric.");Ue.singleStep=ge}function Te(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");Ue.keyboardPageMultiplier=ge}function Oe(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");Ue.keyboardMultiplier=ge}function Y(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");Ue.keyboardDefaultStep=ge}function ce(Ue,ge){if(typeof ge!="object"||Array.isArray(ge))throw new Error("noUiSlider: 'range' is not an object.");if(ge.min===void 0||ge.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");Ue.spectrum=new at(ge,Ue.snap||!1,Ue.singleStep)}function re(Ue,ge){if(ge=_(ge),!Array.isArray(ge)||!ge.length)throw new Error("noUiSlider: 'start' option is incorrect.");Ue.handles=ge.length,Ue.start=ge}function te(Ue,ge){if(typeof ge!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");Ue.snap=ge}function we(Ue,ge){if(typeof ge!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");Ue.animate=ge}function ke(Ue,ge){if(typeof ge!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");Ue.animationDuration=ge}function We(Ue,ge){var Rt=[!1],si;if(ge==="lower"?ge=[!0,!1]:ge==="upper"&&(ge=[!1,!0]),ge===!0||ge===!1){for(si=1;si<Ue.handles;si++)Rt.push(ge);Rt.push(!1)}else{if(!Array.isArray(ge)||!ge.length||ge.length!==Ue.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");Rt=ge}Ue.connect=Rt}function qe(Ue,ge){switch(ge){case"horizontal":Ue.ort=0;break;case"vertical":Ue.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function gt(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'margin' option must be numeric.");ge!==0&&(Ue.margin=Ue.spectrum.getDistance(ge))}function lt(Ue,ge){if(!d(ge))throw new Error("noUiSlider: 'limit' option must be numeric.");if(Ue.limit=Ue.spectrum.getDistance(ge),!Ue.limit||Ue.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Bt(Ue,ge){var Rt;if(!d(ge)&&!Array.isArray(ge))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(ge)&&!(ge.length===2||d(ge[0])||d(ge[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(ge!==0){for(Array.isArray(ge)||(ge=[ge,ge]),Ue.padding=[Ue.spectrum.getDistance(ge[0]),Ue.spectrum.getDistance(ge[1])],Rt=0;Rt<Ue.spectrum.xNumSteps.length-1;Rt++)if(Ue.padding[0][Rt]<0||Ue.padding[1][Rt]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var si=ge[0]+ge[1],jt=Ue.spectrum.xVal[0],Ii=Ue.spectrum.xVal[Ue.spectrum.xVal.length-1];if(si/(Ii-jt)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function ht(Ue,ge){switch(ge){case"ltr":Ue.dir=0;break;case"rtl":Ue.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function ct(Ue,ge){if(typeof ge!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var Rt=ge.indexOf("tap")>=0,si=ge.indexOf("drag")>=0,jt=ge.indexOf("fixed")>=0,Ii=ge.indexOf("snap")>=0,wi=ge.indexOf("hover")>=0,or=ge.indexOf("unconstrained")>=0,Ti=ge.indexOf("drag-all")>=0,Yi=ge.indexOf("smooth-steps")>=0;if(jt){if(Ue.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");gt(Ue,Ue.start[1]-Ue.start[0])}if(or&&(Ue.margin||Ue.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");Ue.events={tap:Rt||Ii,drag:si,dragAll:Ti,smoothSteps:Yi,fixed:jt,snap:Ii,hover:wi,unconstrained:or}}function Xe(Ue,ge){if(ge!==!1)if(ge===!0||R(ge)){Ue.tooltips=[];for(var Rt=0;Rt<Ue.handles;Rt++)Ue.tooltips.push(ge)}else{if(ge=_(ge),ge.length!==Ue.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");ge.forEach(function(si){if(typeof si!="boolean"&&!R(si))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),Ue.tooltips=ge}}function Se(Ue,ge){if(ge.length!==Ue.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");Ue.handleAttributes=ge}function At(Ue,ge){if(!R(ge))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");Ue.ariaFormat=ge}function Et(Ue,ge){if(!D(ge))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");Ue.format=ge}function wt(Ue,ge){if(typeof ge!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");Ue.keyboardSupport=ge}function Kt(Ue,ge){Ue.documentElement=ge}function $t(Ue,ge){if(typeof ge!="string"&&ge!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");Ue.cssPrefix=ge}function yt(Ue,ge){if(typeof ge!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof Ue.cssPrefix=="string"?(Ue.cssClasses={},Object.keys(ge).forEach(function(Rt){Ue.cssClasses[Rt]=Ue.cssPrefix+ge[Rt]})):Ue.cssClasses=ge}function ri(Ue){var ge={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:ft,format:ft},Rt={step:{r:!1,t:ae},keyboardPageMultiplier:{r:!1,t:Te},keyboardMultiplier:{r:!1,t:Oe},keyboardDefaultStep:{r:!1,t:Y},start:{r:!0,t:re},connect:{r:!0,t:We},direction:{r:!0,t:ht},snap:{r:!1,t:te},animate:{r:!1,t:we},animationDuration:{r:!1,t:ke},range:{r:!0,t:ce},orientation:{r:!1,t:qe},margin:{r:!1,t:gt},limit:{r:!1,t:lt},padding:{r:!1,t:Bt},behaviour:{r:!0,t:ct},ariaFormat:{r:!1,t:At},format:{r:!1,t:Et},tooltips:{r:!1,t:Xe},keyboardSupport:{r:!0,t:wt},documentElement:{r:!1,t:Kt},cssPrefix:{r:!0,t:$t},cssClasses:{r:!0,t:yt},handleAttributes:{r:!1,t:Se}},si={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:xt,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};Ue.format&&!Ue.ariaFormat&&(Ue.ariaFormat=Ue.format),Object.keys(Rt).forEach(function(Ti){if(!V(Ue[Ti])&&si[Ti]===void 0){if(Rt[Ti].r)throw new Error("noUiSlider: '"+Ti+"' is required.");return}Rt[Ti].t(ge,V(Ue[Ti])?Ue[Ti]:si[Ti])}),ge.pips=Ue.pips;var jt=document.createElement("div"),Ii=jt.style.msTransform!==void 0,wi=jt.style.transform!==void 0;ge.transformRule=wi?"transform":Ii?"msTransform":"webkitTransform";var or=[["left","top"],["right","bottom"]];return ge.style=or[ge.dir][ge.ort],ge}function mi(Ue,ge,Rt){var si=q(),jt=se(),Ii=jt&&K(),wi=Ue,or,Ti,Yi,qr,Hi,je=ge.spectrum,oe=[],fe=[],Ve=[],Ke=0,$e={},dt=Ue.ownerDocument,bt=ge.documentElement||dt.documentElement,st=dt.body,Dt=dt.dir==="rtl"||ge.ort===1?0:100;function ti(it,vt){var Lt=dt.createElement("div");return vt&&g(Lt,vt),it.appendChild(Lt),Lt}function Vt(it,vt){var Lt=ti(it,ge.cssClasses.origin),li=ti(Lt,ge.cssClasses.handle);if(ti(li,ge.cssClasses.touchArea),li.setAttribute("data-handle",String(vt)),ge.keyboardSupport&&(li.setAttribute("tabindex","0"),li.addEventListener("keydown",function(Yt){return Ut(Yt,vt)})),ge.handleAttributes!==void 0){var _i=ge.handleAttributes[vt];Object.keys(_i).forEach(function(Yt){li.setAttribute(Yt,_i[Yt])})}return li.setAttribute("role","slider"),li.setAttribute("aria-orientation",ge.ort?"vertical":"horizontal"),vt===0?g(li,ge.cssClasses.handleLower):vt===ge.handles-1&&g(li,ge.cssClasses.handleUpper),Lt.handle=li,Lt}function ni(it,vt){return vt?ti(it,ge.cssClasses.connect):!1}function Ui(it,vt){var Lt=ti(vt,ge.cssClasses.connects);Ti=[],Yi=[],Yi.push(ni(Lt,it[0]));for(var li=0;li<ge.handles;li++)Ti.push(Vt(vt,li)),Ve[li]=li,Yi.push(ni(Lt,it[li+1]))}function Vi(it){g(it,ge.cssClasses.target),ge.dir===0?g(it,ge.cssClasses.ltr):g(it,ge.cssClasses.rtl),ge.ort===0?g(it,ge.cssClasses.horizontal):g(it,ge.cssClasses.vertical);var vt=getComputedStyle(it).direction;return vt==="rtl"?g(it,ge.cssClasses.textDirectionRtl):g(it,ge.cssClasses.textDirectionLtr),ti(it,ge.cssClasses.base)}function ki(it,vt){return!ge.tooltips||!ge.tooltips[vt]?!1:ti(it.firstChild,ge.cssClasses.tooltip)}function Fi(){return wi.hasAttribute("disabled")}function Wi(it){var vt=Ti[it];return vt.hasAttribute("disabled")}function Ar(it){it!=null?(Ti[it].setAttribute("disabled",""),Ti[it].handle.removeAttribute("tabindex")):(wi.setAttribute("disabled",""),Ti.forEach(function(vt){vt.handle.removeAttribute("tabindex")}))}function Pr(it){it!=null?(Ti[it].removeAttribute("disabled"),Ti[it].handle.setAttribute("tabindex","0")):(wi.removeAttribute("disabled"),Ti.forEach(function(vt){vt.removeAttribute("disabled"),vt.handle.setAttribute("tabindex","0")}))}function kr(){Hi&&(Ys("update"+He.tooltips),Hi.forEach(function(it){it&&z(it)}),Hi=null)}function Sr(){kr(),Hi=Ti.map(ki),Gr("update"+He.tooltips,function(it,vt,Lt){if(!(!Hi||!ge.tooltips)&&Hi[vt]!==!1){var li=it[vt];ge.tooltips[vt]!==!0&&(li=ge.tooltips[vt].to(Lt[vt])),Hi[vt].innerHTML=li}})}function un(){Ys("update"+He.aria),Gr("update"+He.aria,function(it,vt,Lt,li,_i){Ve.forEach(function(Yt){var Mi=Ti[Yt],Di=Zs(fe,Yt,0,!0,!0,!0),gr=Zs(fe,Yt,100,!0,!0,!0),ar=_i[Yt],pr=String(ge.ariaFormat.to(Lt[Yt]));Di=je.fromStepping(Di).toFixed(1),gr=je.fromStepping(gr).toFixed(1),ar=je.fromStepping(ar).toFixed(1),Mi.children[0].setAttribute("aria-valuemin",Di),Mi.children[0].setAttribute("aria-valuemax",gr),Mi.children[0].setAttribute("aria-valuenow",ar),Mi.children[0].setAttribute("aria-valuetext",pr)})})}function Or(it){if(it.mode===A.PipsMode.Range||it.mode===A.PipsMode.Steps)return je.xVal;if(it.mode===A.PipsMode.Count){if(it.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var vt=it.values-1,Lt=100/vt,li=[];vt--;)li[vt]=vt*Lt;return li.push(100),Fr(li,it.stepped)}return it.mode===A.PipsMode.Positions?Fr(it.values,it.stepped):it.mode===A.PipsMode.Values?it.stepped?it.values.map(function(_i){return je.fromStepping(je.getStep(je.toStepping(_i)))}):it.values:[]}function Fr(it,vt){return it.map(function(Lt){return je.fromStepping(vt?je.getStep(Lt):Lt)})}function Bn(it){function vt(ar,pr){return Number((ar+pr).toFixed(7))}var Lt=Or(it),li={},_i=je.xVal[0],Yt=je.xVal[je.xVal.length-1],Mi=!1,Di=!1,gr=0;return Lt=l(Lt.slice().sort(function(ar,pr){return ar-pr})),Lt[0]!==_i&&(Lt.unshift(_i),Mi=!0),Lt[Lt.length-1]!==Yt&&(Lt.push(Yt),Di=!0),Lt.forEach(function(ar,pr){var Mr,fr,ir,nn=ar,sn=Lt[pr+1],zr,Wr,hs,zo,Dn,Xn,Ps,ga=it.mode===A.PipsMode.Steps;for(ga&&(Mr=je.xNumSteps[pr]),Mr||(Mr=sn-nn),sn===void 0&&(sn=nn),Mr=Math.max(Mr,1e-7),fr=nn;fr<=sn;fr=vt(fr,Mr)){for(zr=je.toStepping(fr),Wr=zr-gr,Dn=Wr/(it.density||1),Xn=Math.round(Dn),Ps=Wr/Xn,ir=1;ir<=Xn;ir+=1)hs=gr+ir*Ps,li[hs.toFixed(5)]=[je.fromStepping(hs),0];zo=Lt.indexOf(fr)>-1?A.PipsType.LargeValue:ga?A.PipsType.SmallValue:A.PipsType.NoValue,!pr&&Mi&&fr!==sn&&(zo=0),fr===sn&&Di||(li[zr.toFixed(5)]=[fr,zo]),gr=zr}}),li}function Io(it,vt,Lt){var li,_i,Yt=dt.createElement("div"),Mi=(li={},li[A.PipsType.None]="",li[A.PipsType.NoValue]=ge.cssClasses.valueNormal,li[A.PipsType.LargeValue]=ge.cssClasses.valueLarge,li[A.PipsType.SmallValue]=ge.cssClasses.valueSub,li),Di=(_i={},_i[A.PipsType.None]="",_i[A.PipsType.NoValue]=ge.cssClasses.markerNormal,_i[A.PipsType.LargeValue]=ge.cssClasses.markerLarge,_i[A.PipsType.SmallValue]=ge.cssClasses.markerSub,_i),gr=[ge.cssClasses.valueHorizontal,ge.cssClasses.valueVertical],ar=[ge.cssClasses.markerHorizontal,ge.cssClasses.markerVertical];g(Yt,ge.cssClasses.pips),g(Yt,ge.ort===0?ge.cssClasses.pipsHorizontal:ge.cssClasses.pipsVertical);function pr(fr,ir){var nn=ir===ge.cssClasses.value,sn=nn?gr:ar,zr=nn?Mi:Di;return ir+" "+sn[ge.ort]+" "+zr[fr]}function Mr(fr,ir,nn){if(nn=vt?vt(ir,nn):nn,nn!==A.PipsType.None){var sn=ti(Yt,!1);sn.className=pr(nn,ge.cssClasses.marker),sn.style[ge.style]=fr+"%",nn>A.PipsType.NoValue&&(sn=ti(Yt,!1),sn.className=pr(nn,ge.cssClasses.value),sn.setAttribute("data-value",String(ir)),sn.style[ge.style]=fr+"%",sn.innerHTML=String(Lt.to(ir)))}}return Object.keys(it).forEach(function(fr){Mr(fr,it[fr][0],it[fr][1])}),Yt}function Hs(){qr&&(z(qr),qr=null)}function hr(it){Hs();var vt=Bn(it),Lt=it.filter,li=it.format||{to:function(_i){return String(Math.round(_i))}};return qr=wi.appendChild(Io(vt,Lt,li)),qr}function $s(){var it=or.getBoundingClientRect(),vt="offset"+["Width","Height"][ge.ort];return ge.ort===0?it.width||or[vt]:it.height||or[vt]}function kn(it,vt,Lt,li){var _i=function(Mi){var Di=Qo(Mi,li.pageOffset,li.target||vt);if(!Di||Fi()&&!li.doNotReject||L(wi,ge.cssClasses.tap)&&!li.doNotReject||it===si.start&&Di.buttons!==void 0&&Di.buttons>1||li.hover&&Di.buttons)return!1;Ii||Di.preventDefault(),Di.calcPoint=Di.points[ge.ort],Lt(Di,li)},Yt=[];return it.split(" ").forEach(function(Mi){vt.addEventListener(Mi,_i,Ii?{passive:!0}:!1),Yt.push([Mi,_i])}),Yt}function Qo(it,vt,Lt){var li=it.type.indexOf("touch")===0,_i=it.type.indexOf("mouse")===0,Yt=it.type.indexOf("pointer")===0,Mi=0,Di=0;if(it.type.indexOf("MSPointer")===0&&(Yt=!0),it.type==="mousedown"&&!it.buttons&&!it.touches)return!1;if(li){var gr=function(Mr){var fr=Mr.target;return fr===Lt||Lt.contains(fr)||it.composed&&it.composedPath().shift()===Lt};if(it.type==="touchstart"){var ar=Array.prototype.filter.call(it.touches,gr);if(ar.length>1)return!1;Mi=ar[0].pageX,Di=ar[0].pageY}else{var pr=Array.prototype.find.call(it.changedTouches,gr);if(!pr)return!1;Mi=pr.pageX,Di=pr.pageY}}return vt=vt||B(dt),(_i||Yt)&&(Mi=it.clientX+vt.x,Di=it.clientY+vt.y),it.pageOffset=vt,it.points=[Mi,Di],it.cursor=_i||Yt,it}function ko(it){var vt=it-x(or,ge.ort),Lt=vt*100/$s();return Lt=c(Lt),ge.dir?100-Lt:Lt}function cs(it){var vt=100,Lt=!1;return Ti.forEach(function(li,_i){if(!Wi(_i)){var Yt=fe[_i],Mi=Math.abs(Yt-it),Di=Mi===100&&vt===100,gr=Mi<vt,ar=Mi<=vt&&it>Yt;(gr||ar||Di)&&(Lt=_i,vt=Mi)}}),Lt}function Gn(it,vt){it.type==="mouseout"&&it.target.nodeName==="HTML"&&it.relatedTarget===null&&Do(it,vt)}function ea(it,vt){if(navigator.appVersion.indexOf("MSIE 9")===-1&&it.buttons===0&&vt.buttonsProperty!==0)return Do(it,vt);var Lt=(ge.dir?-1:1)*(it.calcPoint-vt.startCalcPoint),li=Lt*100/vt.baseSize;Ks(Lt>0,li,vt.locations,vt.handleNumbers,vt.connect)}function Do(it,vt){vt.handle&&(C(vt.handle,ge.cssClasses.active),Ke-=1),vt.listeners.forEach(function(Lt){bt.removeEventListener(Lt[0],Lt[1])}),Ke===0&&(C(wi,ge.cssClasses.drag),ji(),it.cursor&&(st.style.cursor="",st.removeEventListener("selectstart",t))),ge.events.smoothSteps&&(vt.handleNumbers.forEach(function(Lt){tn(Lt,fe[Lt],!0,!0,!1,!1)}),vt.handleNumbers.forEach(function(Lt){br("update",Lt)})),vt.handleNumbers.forEach(function(Lt){br("change",Lt),br("set",Lt),br("end",Lt)})}function Qn(it,vt){if(!vt.handleNumbers.some(Wi)){var Lt;if(vt.handleNumbers.length===1){var li=Ti[vt.handleNumbers[0]];Lt=li.children[0],Ke+=1,g(Lt,ge.cssClasses.active)}it.stopPropagation();var _i=[],Yt=kn(si.move,bt,ea,{target:it.target,handle:Lt,connect:vt.connect,listeners:_i,startCalcPoint:it.calcPoint,baseSize:$s(),pageOffset:it.pageOffset,handleNumbers:vt.handleNumbers,buttonsProperty:it.buttons,locations:fe.slice()}),Mi=kn(si.end,bt,Do,{target:it.target,handle:Lt,listeners:_i,doNotReject:!0,handleNumbers:vt.handleNumbers}),Di=kn("mouseout",bt,Gn,{target:it.target,handle:Lt,listeners:_i,doNotReject:!0,handleNumbers:vt.handleNumbers});_i.push.apply(_i,Yt.concat(Mi,Di)),it.cursor&&(st.style.cursor=getComputedStyle(it.target).cursor,Ti.length>1&&g(wi,ge.cssClasses.drag),st.addEventListener("selectstart",t,!1)),vt.handleNumbers.forEach(function(gr){br("start",gr)})}}function bs(it){it.stopPropagation();var vt=ko(it.calcPoint),Lt=cs(vt);Lt!==!1&&(ge.events.snap||m(wi,ge.cssClasses.tap,ge.animationDuration),tn(Lt,vt,!0,!0),ji(),br("slide",Lt,!0),br("update",Lt,!0),ge.events.snap?Qn(it,{handleNumbers:[Lt]}):(br("change",Lt,!0),br("set",Lt,!0)))}function fo(it){var vt=ko(it.calcPoint),Lt=je.getStep(vt),li=je.fromStepping(Lt);Object.keys($e).forEach(function(_i){_i.split(".")[0]==="hover"&&$e[_i].forEach(function(Yt){Yt.call(Ss,li)})})}function Ut(it,vt){if(Fi()||Wi(vt))return!1;var Lt=["Left","Right"],li=["Down","Up"],_i=["PageDown","PageUp"],Yt=["Home","End"];ge.dir&&!ge.ort?Lt.reverse():ge.ort&&!ge.dir&&(li.reverse(),_i.reverse());var Mi=it.key.replace("Arrow",""),Di=Mi===_i[0],gr=Mi===_i[1],ar=Mi===li[0]||Mi===Lt[0]||Di,pr=Mi===li[1]||Mi===Lt[1]||gr,Mr=Mi===Yt[0],fr=Mi===Yt[1];if(!ar&&!pr&&!Mr&&!fr)return!0;it.preventDefault();var ir;if(pr||ar){var nn=ar?0:1,sn=ma(vt),zr=sn[nn];if(zr===null)return!1;zr===!1&&(zr=je.getDefaultStep(fe[vt],ar,ge.keyboardDefaultStep)),gr||Di?zr*=ge.keyboardPageMultiplier:zr*=ge.keyboardMultiplier,zr=Math.max(zr,1e-7),zr=(ar?-1:1)*zr,ir=oe[vt]+zr}else fr?ir=ge.spectrum.xVal[ge.spectrum.xVal.length-1]:ir=ge.spectrum.xVal[0];return tn(vt,je.toStepping(ir),!0,!0),br("slide",vt),br("update",vt),br("change",vt),br("set",vt),!1}function Wn(it){it.fixed||Ti.forEach(function(vt,Lt){kn(si.start,vt.children[0],Qn,{handleNumbers:[Lt]})}),it.tap&&kn(si.start,or,bs,{}),it.hover&&kn(si.move,or,fo,{hover:!0}),it.drag&&Yi.forEach(function(vt,Lt){if(!(vt===!1||Lt===0||Lt===Yi.length-1)){var li=Ti[Lt-1],_i=Ti[Lt],Yt=[vt],Mi=[li,_i],Di=[Lt-1,Lt];g(vt,ge.cssClasses.draggable),it.fixed&&(Yt.push(li.children[0]),Yt.push(_i.children[0])),it.dragAll&&(Mi=Ti,Di=Ve),Yt.forEach(function(gr){kn(si.start,gr,Qn,{handles:Mi,handleNumbers:Di,connect:vt})})}})}function Gr(it,vt){$e[it]=$e[it]||[],$e[it].push(vt),it.split(".")[0]==="update"&&Ti.forEach(function(Lt,li){br("update",li)})}function ur(it){return it===He.aria||it===He.tooltips}function Ys(it){var vt=it&&it.split(".")[0],Lt=vt?it.substring(vt.length):it;Object.keys($e).forEach(function(li){var _i=li.split(".")[0],Yt=li.substring(_i.length);(!vt||vt===_i)&&(!Lt||Lt===Yt)&&(!ur(Yt)||Lt===Yt)&&delete $e[li]})}function br(it,vt,Lt){Object.keys($e).forEach(function(li){var _i=li.split(".")[0];it===_i&&$e[li].forEach(function(Yt){Yt.call(Ss,oe.map(ge.format.to),vt,oe.slice(),Lt||!1,fe.slice(),Ss)})})}function Zs(it,vt,Lt,li,_i,Yt,Mi){var Di;return Ti.length>1&&!ge.events.unconstrained&&(li&&vt>0&&(Di=je.getAbsoluteDistance(it[vt-1],ge.margin,!1),Lt=Math.max(Lt,Di)),_i&&vt<Ti.length-1&&(Di=je.getAbsoluteDistance(it[vt+1],ge.margin,!0),Lt=Math.min(Lt,Di))),Ti.length>1&&ge.limit&&(li&&vt>0&&(Di=je.getAbsoluteDistance(it[vt-1],ge.limit,!1),Lt=Math.min(Lt,Di)),_i&&vt<Ti.length-1&&(Di=je.getAbsoluteDistance(it[vt+1],ge.limit,!0),Lt=Math.max(Lt,Di))),ge.padding&&(vt===0&&(Di=je.getAbsoluteDistance(0,ge.padding[0],!1),Lt=Math.max(Lt,Di)),vt===Ti.length-1&&(Di=je.getAbsoluteDistance(100,ge.padding[1],!0),Lt=Math.min(Lt,Di))),Mi||(Lt=je.getStep(Lt)),Lt=c(Lt),Lt===it[vt]&&!Yt?!1:Lt}function po(it,vt){var Lt=ge.ort;return(Lt?vt:it)+", "+(Lt?it:vt)}function Ks(it,vt,Lt,li,_i){var Yt=Lt.slice(),Mi=li[0],Di=ge.events.smoothSteps,gr=[!it,it],ar=[it,!it];li=li.slice(),it&&li.reverse(),li.length>1?li.forEach(function(Mr,fr){var ir=Zs(Yt,Mr,Yt[Mr]+vt,gr[fr],ar[fr],!1,Di);ir===!1?vt=0:(vt=ir-Yt[Mr],Yt[Mr]=ir)}):gr=ar=[!0];var pr=!1;li.forEach(function(Mr,fr){pr=tn(Mr,Lt[Mr]+vt,gr[fr],ar[fr],!1,Di)||pr}),pr&&(li.forEach(function(Mr){br("update",Mr),br("slide",Mr)}),_i!=null&&br("drag",Mi))}function di(it,vt){return ge.dir?100-it-vt:it}function Zi(it,vt){fe[it]=vt,oe[it]=je.fromStepping(vt);var Lt=di(vt,0)-Dt,li="translate("+po(Lt+"%","0")+")";Ti[it].style[ge.transformRule]=li,Nn(it),Nn(it+1)}function ji(){Ve.forEach(function(it){var vt=fe[it]>50?-1:1,Lt=3+(Ti.length+vt*it);Ti[it].style.zIndex=String(Lt)})}function tn(it,vt,Lt,li,_i,Yt){return _i||(vt=Zs(fe,it,vt,Lt,li,!1,Yt)),vt===!1?!1:(Zi(it,vt),!0)}function Nn(it){if(Yi[it]){var vt=0,Lt=100;it!==0&&(vt=fe[it-1]),it!==Yi.length-1&&(Lt=fe[it]);var li=Lt-vt,_i="translate("+po(di(vt,li)+"%","0")+")",Yt="scale("+po(li/100,"1")+")";Yi[it].style[ge.transformRule]=_i+" "+Yt}}function Ki(it,vt){return it===null||it===!1||it===void 0||(typeof it=="number"&&(it=String(it)),it=ge.format.from(it),it!==!1&&(it=je.toStepping(it)),it===!1||isNaN(it))?fe[vt]:it}function mn(it,vt,Lt){var li=_(it),_i=fe[0]===void 0;vt=vt===void 0?!0:vt,ge.animate&&!_i&&m(wi,ge.cssClasses.tap,ge.animationDuration),Ve.forEach(function(Di){tn(Di,Ki(li[Di],Di),!0,!1,Lt)});var Yt=Ve.length===1?0:1;if(_i&&je.hasNoSize()&&(Lt=!0,fe[0]=0,Ve.length>1)){var Mi=100/(Ve.length-1);Ve.forEach(function(Di){fe[Di]=Di*Mi})}for(;Yt<Ve.length;++Yt)Ve.forEach(function(Di){tn(Di,fe[Di],!0,!0,Lt)});ji(),Ve.forEach(function(Di){br("update",Di),li[Di]!==null&&vt&&br("set",Di)})}function Oo(it){mn(ge.start,it)}function Es(it,vt,Lt,li){if(it=Number(it),!(it>=0&&it<Ve.length))throw new Error("noUiSlider: invalid handle number, got: "+it);tn(it,Ki(vt,it),!0,!0,li),br("update",it),Lt&&br("set",it)}function jn(it){if(it===void 0&&(it=!1),it)return oe.length===1?oe[0]:oe.slice(0);var vt=oe.map(ge.format.to);return vt.length===1?vt[0]:vt}function Er(){for(Ys(He.aria),Ys(He.tooltips),Object.keys(ge.cssClasses).forEach(function(it){C(wi,ge.cssClasses[it])});wi.firstChild;)wi.removeChild(wi.firstChild);delete wi.noUiSlider}function ma(it){var vt=fe[it],Lt=je.getNearbySteps(vt),li=oe[it],_i=Lt.thisStep.step,Yt=null;if(ge.snap)return[li-Lt.stepBefore.startValue||null,Lt.stepAfter.startValue-li||null];_i!==!1&&li+_i>Lt.stepAfter.startValue&&(_i=Lt.stepAfter.startValue-li),li>Lt.thisStep.startValue?Yt=Lt.thisStep.step:Lt.stepBefore.step===!1?Yt=!1:Yt=li-Lt.stepBefore.highestStep,vt===100?_i=null:vt===0&&(Yt=null);var Mi=je.countStepDecimals();return _i!==null&&_i!==!1&&(_i=Number(_i.toFixed(Mi))),Yt!==null&&Yt!==!1&&(Yt=Number(Yt.toFixed(Mi))),[Yt,_i]}function ws(){return Ve.map(ma)}function Fo(it,vt){var Lt=jn(),li=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];li.forEach(function(Yt){it[Yt]!==void 0&&(Rt[Yt]=it[Yt])});var _i=ri(Rt);li.forEach(function(Yt){it[Yt]!==void 0&&(ge[Yt]=_i[Yt])}),je=_i.spectrum,ge.margin=_i.margin,ge.limit=_i.limit,ge.padding=_i.padding,ge.pips?hr(ge.pips):Hs(),ge.tooltips?Sr():kr(),fe=[],mn(V(it.start)?it.start:Lt,vt)}function es(){or=Vi(wi),Ui(ge.connect,or),Wn(ge.events),mn(ge.start),ge.pips&&hr(ge.pips),ge.tooltips&&Sr(),un()}es();var Ss={destroy:Er,steps:ws,on:Gr,off:Ys,get:jn,set:mn,setHandle:Es,reset:Oo,disable:Ar,enable:Pr,__moveHandles:function(it,vt,Lt){Ks(it,vt,fe,Lt)},options:Rt,updateOptions:Fo,target:wi,removePips:Hs,removeTooltips:kr,getPositions:function(){return fe.slice()},getTooltips:function(){return Hi},getOrigins:function(){return Ti},pips:hr};return Ss}function xi(Ue,ge){if(!Ue||!Ue.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+Ue);if(Ue.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var Rt=ri(ge),si=mi(Ue,Rt,ge);return Ue.noUiSlider=si,si}var Li={__spectrum:at,cssClasses:xt,create:xi};A.create=xi,A.cssClasses=xt,A.default=Li,Object.defineProperty(A,"__esModule",{value:!0})})})(fp,fp.exports);var qv=fp.exports;const Gv=mp(qv);var q_={exports:{}};(function(M,f){(function(A){M.exports=A()})(function(){var A=["decimals","thousand","mark","prefix","suffix","encoder","decoder","negativeBefore","negative","edit","undo"];function D(_){return _.split("").reverse().join("")}function R(_,w){return _.substring(0,w.length)===w}function z(_,w){return _.slice(-1*w.length)===w}function V(_,w,g){if((_[w]||_[g])&&_[w]===_[g])throw new Error(w)}function t(_){return typeof _=="number"&&isFinite(_)}function l(_,w){return _=_.toString().split("e"),_=Math.round(+(_[0]+"e"+(_[1]?+_[1]+w:w))),_=_.toString().split("e"),(+(_[0]+"e"+(_[1]?+_[1]-w:-w))).toFixed(w)}function v(_,w,g,C,L,B,q,K,se,he,le,ve){var ot=ve,_e,pe,ze,De="",at="";return B&&(ve=B(ve)),t(ve)?(_!==!1&&parseFloat(ve.toFixed(_))===0&&(ve=0),ve<0&&(_e=!0,ve=Math.abs(ve)),_!==!1&&(ve=l(ve,_)),ve=ve.toString(),ve.indexOf(".")!==-1?(pe=ve.split("."),ze=pe[0],g&&(De=g+pe[1])):ze=ve,w&&(ze=D(ze).match(/.{1,3}/g),ze=D(ze.join(D(w)))),_e&&K&&(at+=K),C&&(at+=C),_e&&se&&(at+=se),at+=ze,at+=De,L&&(at+=L),he&&(at=he(at,ot)),at):!1}function x(_,w,g,C,L,B,q,K,se,he,le,ve){var ot,_e="";return le&&(ve=le(ve)),!ve||typeof ve!="string"||(K&&R(ve,K)&&(ve=ve.replace(K,""),ot=!0),C&&R(ve,C)&&(ve=ve.replace(C,"")),se&&R(ve,se)&&(ve=ve.replace(se,""),ot=!0),L&&z(ve,L)&&(ve=ve.slice(0,-1*L.length)),w&&(ve=ve.split(w).join("")),g&&(ve=ve.replace(g,".")),ot&&(_e+="-"),_e+=ve,_e=_e.replace(/[^0-9\.\-.]/g,""),_e==="")||(_e=Number(_e),q&&(_e=q(_e)),!t(_e))?!1:_e}function d(_){var w,g,C,L={};for(_.suffix===void 0&&(_.suffix=_.postfix),w=0;w<A.length;w+=1)if(g=A[w],C=_[g],C===void 0)g==="negative"&&!L.negativeBefore?L[g]="-":g==="mark"&&L.thousand!=="."?L[g]=".":L[g]=!1;else if(g==="decimals")if(C>=0&&C<8)L[g]=C;else throw new Error(g);else if(g==="encoder"||g==="decoder"||g==="edit"||g==="undo")if(typeof C=="function")L[g]=C;else throw new Error(g);else if(typeof C=="string")L[g]=C;else throw new Error(g);return V(L,"mark","thousand"),V(L,"prefix","negative"),V(L,"prefix","negativeBefore"),L}function m(_,w,g){var C,L=[];for(C=0;C<A.length;C+=1)L.push(_[A[C]]);return L.push(g),w.apply("",L)}function c(_){if(!(this instanceof c))return new c(_);typeof _=="object"&&(_=d(_),this.to=function(w){return m(_,v,w)},this.from=function(w){return m(_,x,w)})}return c})})(q_);var Wv=q_.exports;const Xv=mp(Wv);class Hv{constructor(f,A){co(this,"onAdd",f=>{this._map=f,this._container=document.createElement("div"),this._container.id="value-filter-container";const A=document.createElement("div");return A.className="mapboxgl-ctrl mapboxgl-ctrl-group",A.id="value-filter",Object.entries(this.valueFilters).forEach(([D,R])=>{const z=document.createElement("button");z.id=D,z.classList.add("filter-label"),z.innerHTML=`<i class="${R.icon}"></i>`,A.appendChild(z);const V=document.createElement("div");V.classList.add("slider-box");const t=document.createElement("div");t.classList.add("noUiSlider"),t.id=`${D}-slider`,V.appendChild(t),A.appendChild(V),Gv.create(t,{range:R.range,step:R.step,start:R.values,format:Xv({decimals:R.decimals}),connect:!0,tooltips:{to:R.tooltip}}),t.noUiSlider.on("change",(l,v)=>{R.values[0]=Number(l[0]),R.values[1]=Number(l[1]),this.onChange()})}),this._container.appendChild(A),this._container});this.valueFilters=f,this.data=A,Object.entries(this.valueFilters).forEach(([D,R])=>{const z=this.data.features.map(V=>V.properties[D]);R.range={min:Math.min(...z),max:Math.max(...z)},R.values=[R.range.min,R.range.max]})}onChange(){}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}filter(){var f=["all"];return Object.entries(this.valueFilters).forEach(([A,D])=>{f.push([">=",A,D.values[0]]),f.push(["<=",A,D.values[1]])}),f}}var dp=new URL(window.location.href).searchParams.get("athlete");dp===null&&(dp="6824046");const $v=`./strava_${dp}.json`,G_=new Bv({"Mapbox Street":{url:"mapbox://styles/mapbox/streets-v12",type:"vector",visible:!0,overlay:!1},"Mapbox Outdoors":{url:"mapbox://styles/mapbox/outdoors-v12",type:"vector",visible:!1,overlay:!1},"Mapbox Light":{url:"mapbox://styles/mapbox/light-v11",type:"vector",visible:!1,overlay:!1},"Mapbox Dark":{url:"mapbox://styles/mapbox/dark-v11",type:"vector",visible:!1,overlay:!1},"Mapbox Satellite":{url:"mapbox://styles/mapbox/satellite-v9",type:"vector",visible:!1,overlay:!1},"Swisstopo Light":{url:"https://vectortiles.geo.admin.ch/styles/ch.swisstopo.leichte-basiskarte.vt/style.json",type:"vector",visible:!1,overlay:!1},"Swisstopo Pixelkarte":{url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg",type:"raster",visible:!1,overlay:!1},"Swisstopo Winter":{url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe-winter/default/current/3857/{z}/{x}/{y}.jpeg",type:"raster",visible:!1,overlay:!1},"Swisstopo Ski":{url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo-karto.skitouren/default/current/3857/{z}/{x}/{y}.png",type:"raster",visible:!1,opacity:.8,overlay:!0},"Swisstopo Slope":{url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.hangneigung-ueber_30/default/current/3857/{z}/{x}/{y}.png",type:"raster",visible:!1,opacity:.4,overlay:!0},Veloland:{url:"https://wmts.geo.admin.ch/1.0.0/ch.astra.veloland/default/current/3857/{z}/{x}/{y}.png",type:"raster",visible:!1,opacity:.4,overlay:!0},Wanderland:{url:"https://wmts.geo.admin.ch/1.0.0/ch.astra.wanderland/default/current/3857/{z}/{x}/{y}.png",type:"raster",visible:!1,opacity:.4,overlay:!0}}),eh=new Nv({BackcountryNordicSki:{color:"#1982C4",icon:"fa-solid fa-skiing-nordic",alias:["BackcountrySki","NordicSki"],active:!0},WalkRun:{color:"#FF595E",icon:"fa-solid fa-walking",alias:["Walk","Run","Hike","RockClimbing","Snowshoe"],active:!0},Ride:{color:"#8AC926",icon:"fa-solid fa-biking",alias:["Ride","VirtualRide"],active:!0},AlpineSki:{color:"#3FA7D6",icon:"fa-solid fa-person-skiing",alias:["AlpineSki"],active:!0},Misc:{color:"#6A4C93",icon:"fa-solid fa-person-circle-question",alias:[],active:!0}}),pp=new Uv({name:{title:"TOUR",body:M=>`<a href='https://www.strava.com/activities/${M.id}' style='color:${eh.colorMap[M.properties.type]}'>${M.properties.name}</a>`},total_elevation_gain:{title:"ELEV",body:M=>M.properties.total_elevation_gain.toFixed(0)},distance:{title:"DIST",body:M=>(M.properties.distance/1e3).toFixed(1)},elapsed_time:{title:"TIME",body:M=>new Date(M.properties.elapsed_time*1e3).toISOString().substr(11,8)},start_date_local:{title:"DATE",body:M=>new Date(M.properties.start_date_local*1e3).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}}),Yv={start_date_local:{icon:"fa-solid fa-calendar-days",tooltip:M=>new Date(M*1e3).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),step:3600,decimals:0},distance:{icon:"fa-solid fa-ruler-horizontal",tooltip:M=>`${Math.round(M)/1e3}km`,step:100,decimals:0},total_elevation_gain:{icon:"fa-solid fa-ruler-vertical",tooltip:M=>`${Math.round(M)}m`,step:10,decimals:0},elapsed_time:{icon:"fa-solid fa-stopwatch",tooltip:M=>`${new Date(M*1e3).toISOString().substr(11,8)}`,step:1,decimals:0}},W_=new jv(["routeLayer","routeLayerSelected"],"strava",pp.update),Zv=new Nh.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),Kv=new zh.MapboxExportControl({PageSize:zh.Size.A3,PageOrientation:zh.PageOrientation.Portrait,Format:zh.Format.PDF,DPI:zh.DPI[300],Crosshair:!1,PrintableArea:!0});var El=new Vv;El.addFilter("categoryActive",eh);El.addFilter("selected",W_);const Jv="#3298FD";document.body.style.setProperty("--highlight-color",Jv);S_.accessToken="pk.eyJ1Ijoid2lyaGFiZW56ZWl0IiwiYSI6ImNrNHJrd3FidTByajkzbnA0anltbXVzcjIifQ.I2ThzlzjoJZ4KryOw2nbow";const Jn=new S_.Map({container:"map",zoom:9,center:[8,47]});var Mf={};Jn.addControl(new Nh.NavigationControl,"top-left");Jn.addControl(Zv,"top-left");Jn.addControl(G_,"top-left");Jn.addControl(new Nh.FullscreenControl,"top-left");Jn.addControl(Kv,"top-left");Jn.on("load",()=>{Qv()});Jn.on("mousemove","routeLayer",M=>{Jn.getCanvas().style.cursor="pointer"});Jn.on("mouseleave","routeLayer",M=>{Jn.getCanvas().style.cursor=""});async function Qv(){Mf=await(await fetch($v)).json(),Jn.addControl(eh,"top-right");const f=new Hv(Yv,Mf);El.addFilter("valueInRange",f),El.addFilter("hovered",pp),Jn.addControl(f,"top-right"),Jn.addControl(W_),Jn.addControl(pp,"bottom-left"),X_()}function Qd(M,f,A,D,R,z,V){Jn.addLayer({id:z,type:"line",source:R,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":D,"line-width":f},filter:El.filter(V)}),Jn.addLayer({id:z+"2",type:"line",source:R,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":A,"line-width":M},filter:El.filter(V)}),El.changeHandlers.push(()=>{Jn.setFilter(z,El.filter(V))}),El.changeHandlers.push(()=>{Jn.setFilter(z+"2",El.filter(V))})}function X_(){"features"in Mf&&Jn.getSource("strava")===void 0&&(Jn.addSource("strava",{type:"geojson",data:Mf,generateId:!1}),Qd(2,3,eh.lineColor,"black","strava","routeLayer",{selected:!1,valueInRange:!0,categoryActive:!0}),Qd(2,4,"white",eh.lineColor,"strava","routeLayerSelected",{selected:!0,valueInRange:!0,categoryActive:!0}),Qd(2,4,eh.lineColor,eh.lineColor,"strava","routeLayerHover",{hovered:!0}))}G_.onStyleChange=X_;export{rn as _,Jc as c,mp as g};
//# sourceMappingURL=index-4878acd6.js.map
