(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const style="",fontawesome_min="",solid_min="",brands_min="";document.addEventListener("click",function(r){try{let p=function(T,w){return T.nodeName===w?T:p(T.parentNode,w)},C=function(T,w){T.classList.remove("dir-d"),T.classList.remove("dir-u"),w&&T.classList.add(w)},v=function(T){return t&&T.dataset.sortAlt||T.dataset.sort||T.textContent};var _=p,m=C,y=v,t=r.shiftKey||r.altKey,i=p(r.target,"TH"),n=p(i,"TR"),s=p(n,"TABLE");if(s.classList.contains("sortable")){var o,a=n.cells,l=parseInt(i.dataset.sortTbr);for(r=0;r<a.length;r++)a[r]===i?o=parseInt(i.dataset.sortCol)||r:C(a[r],"");a="dir-d",(i.classList.contains("dir-d")||s.classList.contains("asc")&&!i.classList.contains("dir-u"))&&(a="dir-u"),C(i,a);var h=a==="dir-u",c=function(T,w,I){var O=v((h?T:w).cells[I]);return T=v((h?w:T).cells[I]),w=parseFloat(O)-parseFloat(T),isNaN(w)?O.localeCompare(T):w};for(r=0;r<s.tBodies.length;r++){var u=s.tBodies[r],d=[].slice.call(u.rows,0);d.sort(function(T,w){var I=c(T,w,o);return I!==0||isNaN(l)?I:c(T,w,l)});var f=u.cloneNode();f.append.apply(f,d),s.replaceChild(f,u)}}}catch{}});var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var nouislider={exports:{}};(function(r,t){(function(i,n){n(t)})(commonjsGlobal,function(i){i.PipsMode=void 0,function(x){x.Range="range",x.Steps="steps",x.Positions="positions",x.Count="count",x.Values="values"}(i.PipsMode||(i.PipsMode={})),i.PipsType=void 0,function(x){x[x.None=-1]="None",x[x.NoValue=0]="NoValue",x[x.LargeValue=1]="LargeValue",x[x.SmallValue=2]="SmallValue"}(i.PipsType||(i.PipsType={}));function n(x){return s(x)&&typeof x.from=="function"}function s(x){return typeof x=="object"&&typeof x.to=="function"}function o(x){x.parentElement.removeChild(x)}function a(x){return x!=null}function l(x){x.preventDefault()}function h(x){return x.filter(function(g){return this[g]?!1:this[g]=!0},{})}function c(x,g){return Math.round(x/g)*g}function u(x,g){var P=x.getBoundingClientRect(),N=x.ownerDocument,A=N.documentElement,q=T(N);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(q.x=0),g?P.top+q.y-A.clientTop:P.left+q.x-A.clientLeft}function d(x){return typeof x=="number"&&!isNaN(x)&&isFinite(x)}function f(x,g,P){P>0&&(p(x,g),setTimeout(function(){C(x,g)},P))}function _(x){return Math.max(Math.min(x,100),0)}function m(x){return Array.isArray(x)?x:[x]}function y(x){x=String(x);var g=x.split(".");return g.length>1?g[1].length:0}function p(x,g){x.classList&&!/\s/.test(g)?x.classList.add(g):x.className+=" "+g}function C(x,g){x.classList&&!/\s/.test(g)?x.classList.remove(g):x.className=x.className.replace(new RegExp("(^|\\b)"+g.split(" ").join("|")+"(\\b|$)","gi")," ")}function v(x,g){return x.classList?x.classList.contains(g):new RegExp("\\b"+g+"\\b").test(x.className)}function T(x){var g=window.pageXOffset!==void 0,P=(x.compatMode||"")==="CSS1Compat",N=g?window.pageXOffset:P?x.documentElement.scrollLeft:x.body.scrollLeft,A=g?window.pageYOffset:P?x.documentElement.scrollTop:x.body.scrollTop;return{x:N,y:A}}function w(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function I(){var x=!1;try{var g=Object.defineProperty({},"passive",{get:function(){x=!0}});window.addEventListener("test",null,g)}catch{}return x}function O(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function $(x,g){return 100/(g-x)}function k(x,g,P){return g*100/(x[P+1]-x[P])}function b(x,g){return k(x,x[0]<0?g+Math.abs(x[0]):g-x[0],0)}function W(x,g){return g*(x[1]-x[0])/100+x[0]}function X(x,g){for(var P=1;x>=g[P];)P+=1;return P}function Z(x,g,P){if(P>=x.slice(-1)[0])return 100;var N=X(P,x),A=x[N-1],q=x[N],H=g[N-1],oe=g[N];return H+b([A,q],P)/$(H,oe)}function Y(x,g,P){if(P>=100)return x.slice(-1)[0];var N=X(P,g),A=x[N-1],q=x[N],H=g[N-1],oe=g[N];return W([A,q],(P-H)*$(H,oe))}function le(x,g,P,N){if(N===100)return N;var A=X(N,x),q=x[A-1],H=x[A];return P?N-q>(H-q)/2?H:q:g[A-1]?x[A-1]+c(N-x[A-1],g[A-1]):N}var B=function(){function x(g,P,N){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[N||!1],this.xNumSteps=[!1],this.snap=P;var A,q=[];for(Object.keys(g).forEach(function(H){q.push([m(g[H]),H])}),q.sort(function(H,oe){return H[0][0]-oe[0][0]}),A=0;A<q.length;A++)this.handleEntryPoint(q[A][1],q[A][0]);for(this.xNumSteps=this.xSteps.slice(0),A=0;A<this.xNumSteps.length;A++)this.handleStepPoint(A,this.xNumSteps[A])}return x.prototype.getDistance=function(g){for(var P=[],N=0;N<this.xNumSteps.length-1;N++)P[N]=k(this.xVal,g,N);return P},x.prototype.getAbsoluteDistance=function(g,P,N){var A=0;if(g<this.xPct[this.xPct.length-1])for(;g>this.xPct[A+1];)A++;else g===this.xPct[this.xPct.length-1]&&(A=this.xPct.length-2);!N&&g===this.xPct[A+1]&&A++,P===null&&(P=[]);var q,H=1,oe=P[A],K=0,Ee=0,Le=0,de=0;for(N?q=(g-this.xPct[A])/(this.xPct[A+1]-this.xPct[A]):q=(this.xPct[A+1]-g)/(this.xPct[A+1]-this.xPct[A]);oe>0;)K=this.xPct[A+1+de]-this.xPct[A+de],P[A+de]*H+100-q*100>100?(Ee=K*q,H=(oe-100*q)/P[A+de],q=1):(Ee=P[A+de]*K/100*H,H=0),N?(Le=Le-Ee,this.xPct.length+de>=1&&de--):(Le=Le+Ee,this.xPct.length-de>=1&&de++),oe=P[A+de]*H;return g+Le},x.prototype.toStepping=function(g){return g=Z(this.xVal,this.xPct,g),g},x.prototype.fromStepping=function(g){return Y(this.xVal,this.xPct,g)},x.prototype.getStep=function(g){return g=le(this.xPct,this.xSteps,this.snap,g),g},x.prototype.getDefaultStep=function(g,P,N){var A=X(g,this.xPct);return(g===100||P&&g===this.xPct[A-1])&&(A=Math.max(A-1,1)),(this.xVal[A]-this.xVal[A-1])/N},x.prototype.getNearbySteps=function(g){var P=X(g,this.xPct);return{stepBefore:{startValue:this.xVal[P-2],step:this.xNumSteps[P-2],highestStep:this.xHighestCompleteStep[P-2]},thisStep:{startValue:this.xVal[P-1],step:this.xNumSteps[P-1],highestStep:this.xHighestCompleteStep[P-1]},stepAfter:{startValue:this.xVal[P],step:this.xNumSteps[P],highestStep:this.xHighestCompleteStep[P]}}},x.prototype.countStepDecimals=function(){var g=this.xNumSteps.map(y);return Math.max.apply(null,g)},x.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},x.prototype.convert=function(g){return this.getStep(this.toStepping(g))},x.prototype.handleEntryPoint=function(g,P){var N;if(g==="min"?N=0:g==="max"?N=100:N=parseFloat(g),!d(N)||!d(P[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(N),this.xVal.push(P[0]);var A=Number(P[1]);N?this.xSteps.push(isNaN(A)?!1:A):isNaN(A)||(this.xSteps[0]=A),this.xHighestCompleteStep.push(0)},x.prototype.handleStepPoint=function(g,P){if(P){if(this.xVal[g]===this.xVal[g+1]){this.xSteps[g]=this.xHighestCompleteStep[g]=this.xVal[g];return}this.xSteps[g]=k([this.xVal[g],this.xVal[g+1]],P,0)/$(this.xPct[g],this.xPct[g+1]);var N=(this.xVal[g+1]-this.xVal[g])/this.xNumSteps[g],A=Math.ceil(Number(N.toFixed(3))-1),q=this.xVal[g]+this.xNumSteps[g]*A;this.xHighestCompleteStep[g]=q}},x}(),z={to:function(x){return x===void 0?"":x.toFixed(2)},from:Number},G={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},V={tooltips:".__tooltips",aria:".__aria"};function te(x,g){if(!d(g))throw new Error("noUiSlider: 'step' is not numeric.");x.singleStep=g}function ee(x,g){if(!d(g))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");x.keyboardPageMultiplier=g}function ge(x,g){if(!d(g))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");x.keyboardMultiplier=g}function M(x,g){if(!d(g))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");x.keyboardDefaultStep=g}function we(x,g){if(typeof g!="object"||Array.isArray(g))throw new Error("noUiSlider: 'range' is not an object.");if(g.min===void 0||g.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");x.spectrum=new B(g,x.snap||!1,x.singleStep)}function Q(x,g){if(g=m(g),!Array.isArray(g)||!g.length)throw new Error("noUiSlider: 'start' option is incorrect.");x.handles=g.length,x.start=g}function ne(x,g){if(typeof g!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");x.snap=g}function $e(x,g){if(typeof g!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");x.animate=g}function Ae(x,g){if(typeof g!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");x.animationDuration=g}function ye(x,g){var P=[!1],N;if(g==="lower"?g=[!0,!1]:g==="upper"&&(g=[!1,!0]),g===!0||g===!1){for(N=1;N<x.handles;N++)P.push(g);P.push(!1)}else{if(!Array.isArray(g)||!g.length||g.length!==x.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");P=g}x.connect=P}function De(x,g){switch(g){case"horizontal":x.ort=0;break;case"vertical":x.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Xe(x,g){if(!d(g))throw new Error("noUiSlider: 'margin' option must be numeric.");g!==0&&(x.margin=x.spectrum.getDistance(g))}function He(x,g){if(!d(g))throw new Error("noUiSlider: 'limit' option must be numeric.");if(x.limit=x.spectrum.getDistance(g),!x.limit||x.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function We(x,g){var P;if(!d(g)&&!Array.isArray(g))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(g)&&!(g.length===2||d(g[0])||d(g[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(g!==0){for(Array.isArray(g)||(g=[g,g]),x.padding=[x.spectrum.getDistance(g[0]),x.spectrum.getDistance(g[1])],P=0;P<x.spectrum.xNumSteps.length-1;P++)if(x.padding[0][P]<0||x.padding[1][P]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var N=g[0]+g[1],A=x.spectrum.xVal[0],q=x.spectrum.xVal[x.spectrum.xVal.length-1];if(N/(q-A)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function qe(x,g){switch(g){case"ltr":x.dir=0;break;case"rtl":x.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Be(x,g){if(typeof g!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var P=g.indexOf("tap")>=0,N=g.indexOf("drag")>=0,A=g.indexOf("fixed")>=0,q=g.indexOf("snap")>=0,H=g.indexOf("hover")>=0,oe=g.indexOf("unconstrained")>=0,K=g.indexOf("drag-all")>=0,Ee=g.indexOf("smooth-steps")>=0;if(A){if(x.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Xe(x,x.start[1]-x.start[0])}if(oe&&(x.margin||x.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");x.events={tap:P||q,drag:N,dragAll:K,smoothSteps:Ee,fixed:A,snap:q,hover:H,unconstrained:oe}}function Ye(x,g){if(g!==!1)if(g===!0||s(g)){x.tooltips=[];for(var P=0;P<x.handles;P++)x.tooltips.push(g)}else{if(g=m(g),g.length!==x.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");g.forEach(function(N){if(typeof N!="boolean"&&!s(N))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),x.tooltips=g}}function Ue(x,g){if(g.length!==x.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");x.handleAttributes=g}function Je(x,g){if(!s(g))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");x.ariaFormat=g}function Qe(x,g){if(!n(g))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");x.format=g}function et(x,g){if(typeof g!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");x.keyboardSupport=g}function Ve(x,g){x.documentElement=g}function nt(x,g){if(typeof g!="string"&&g!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");x.cssPrefix=g}function Se(x,g){if(typeof g!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof x.cssPrefix=="string"?(x.cssClasses={},Object.keys(g).forEach(function(P){x.cssClasses[P]=x.cssPrefix+g[P]})):x.cssClasses=g}function Ie(x){var g={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:z,format:z},P={step:{r:!1,t:te},keyboardPageMultiplier:{r:!1,t:ee},keyboardMultiplier:{r:!1,t:ge},keyboardDefaultStep:{r:!1,t:M},start:{r:!0,t:Q},connect:{r:!0,t:ye},direction:{r:!0,t:qe},snap:{r:!1,t:ne},animate:{r:!1,t:$e},animationDuration:{r:!1,t:Ae},range:{r:!0,t:we},orientation:{r:!1,t:De},margin:{r:!1,t:Xe},limit:{r:!1,t:He},padding:{r:!1,t:We},behaviour:{r:!0,t:Be},ariaFormat:{r:!1,t:Je},format:{r:!1,t:Qe},tooltips:{r:!1,t:Ye},keyboardSupport:{r:!0,t:et},documentElement:{r:!1,t:Ve},cssPrefix:{r:!0,t:nt},cssClasses:{r:!0,t:Se},handleAttributes:{r:!1,t:Ue}},N={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:G,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};x.format&&!x.ariaFormat&&(x.ariaFormat=x.format),Object.keys(P).forEach(function(K){if(!a(x[K])&&N[K]===void 0){if(P[K].r)throw new Error("noUiSlider: '"+K+"' is required.");return}P[K].t(g,a(x[K])?x[K]:N[K])}),g.pips=x.pips;var A=document.createElement("div"),q=A.style.msTransform!==void 0,H=A.style.transform!==void 0;g.transformRule=H?"transform":q?"msTransform":"webkitTransform";var oe=[["left","top"],["right","bottom"]];return g.style=oe[g.dir][g.ort],g}function Me(x,g,P){var N=w(),A=O(),q=A&&I(),H=x,oe,K,Ee,Le,de,J=g.spectrum,Pe=[],se=[],me=[],tt=0,Fe={},_e=x.ownerDocument,ke=g.documentElement||_e.documentElement,Ce=_e.body,Ne=_e.dir==="rtl"||g.ort===1?0:100;function he(E,S){var R=_e.createElement("div");return S&&p(R,S),E.appendChild(R),R}function it(E,S){var R=he(E,g.cssClasses.origin),L=he(R,g.cssClasses.handle);if(he(L,g.cssClasses.touchArea),L.setAttribute("data-handle",String(S)),g.keyboardSupport&&(L.setAttribute("tabindex","0"),L.addEventListener("keydown",function(F){return jt(F,S)})),g.handleAttributes!==void 0){var D=g.handleAttributes[S];Object.keys(D).forEach(function(F){L.setAttribute(F,D[F])})}return L.setAttribute("role","slider"),L.setAttribute("aria-orientation",g.ort?"vertical":"horizontal"),S===0?p(L,g.cssClasses.handleLower):S===g.handles-1&&p(L,g.cssClasses.handleUpper),R.handle=L,R}function je(E,S){return S?he(E,g.cssClasses.connect):!1}function Te(E,S){var R=he(S,g.cssClasses.connects);K=[],Ee=[],Ee.push(je(R,E[0]));for(var L=0;L<g.handles;L++)K.push(it(S,L)),me[L]=L,Ee.push(je(R,E[L+1]))}function be(E){p(E,g.cssClasses.target),g.dir===0?p(E,g.cssClasses.ltr):p(E,g.cssClasses.rtl),g.ort===0?p(E,g.cssClasses.horizontal):p(E,g.cssClasses.vertical);var S=getComputedStyle(E).direction;return S==="rtl"?p(E,g.cssClasses.textDirectionRtl):p(E,g.cssClasses.textDirectionLtr),he(E,g.cssClasses.base)}function Ge(E,S){return!g.tooltips||!g.tooltips[S]?!1:he(E.firstChild,g.cssClasses.tooltip)}function rt(){return H.hasAttribute("disabled")}function ht(E){var S=K[E];return S.hasAttribute("disabled")}function Dt(E){E!=null?(K[E].setAttribute("disabled",""),K[E].handle.removeAttribute("tabindex")):(H.setAttribute("disabled",""),K.forEach(function(S){S.handle.removeAttribute("tabindex")}))}function kt(E){E!=null?(K[E].removeAttribute("disabled"),K[E].handle.setAttribute("tabindex","0")):(H.removeAttribute("disabled"),K.forEach(function(S){S.removeAttribute("disabled"),S.handle.setAttribute("tabindex","0")}))}function ct(){de&&(st("update"+V.tooltips),de.forEach(function(E){E&&o(E)}),de=null)}function vt(){ct(),de=K.map(Ge),mt("update"+V.tooltips,function(E,S,R){if(!(!de||!g.tooltips)&&de[S]!==!1){var L=E[S];g.tooltips[S]!==!0&&(L=g.tooltips[S].to(R[S])),de[S].innerHTML=L}})}function Nt(){st("update"+V.aria),mt("update"+V.aria,function(E,S,R,L,D){me.forEach(function(F){var j=K[F],U=ot(se,F,0,!0,!0,!0),ae=ot(se,F,100,!0,!0,!0),re=D[F],ce=String(g.ariaFormat.to(R[F]));U=J.fromStepping(U).toFixed(1),ae=J.fromStepping(ae).toFixed(1),re=J.fromStepping(re).toFixed(1),j.children[0].setAttribute("aria-valuemin",U),j.children[0].setAttribute("aria-valuemax",ae),j.children[0].setAttribute("aria-valuenow",re),j.children[0].setAttribute("aria-valuetext",ce)})})}function Gt(E){if(E.mode===i.PipsMode.Range||E.mode===i.PipsMode.Steps)return J.xVal;if(E.mode===i.PipsMode.Count){if(E.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var S=E.values-1,R=100/S,L=[];S--;)L[S]=S*R;return L.push(100),St(L,E.stepped)}return E.mode===i.PipsMode.Positions?St(E.values,E.stepped):E.mode===i.PipsMode.Values?E.stepped?E.values.map(function(D){return J.fromStepping(J.getStep(J.toStepping(D)))}):E.values:[]}function St(E,S){return E.map(function(R){return J.fromStepping(S?J.getStep(R):R)})}function $t(E){function S(re,ce){return Number((re+ce).toFixed(7))}var R=Gt(E),L={},D=J.xVal[0],F=J.xVal[J.xVal.length-1],j=!1,U=!1,ae=0;return R=h(R.slice().sort(function(re,ce){return re-ce})),R[0]!==D&&(R.unshift(D),j=!0),R[R.length-1]!==F&&(R.push(F),U=!0),R.forEach(function(re,ce){var ue,ie,pe,Re=re,xe=R[ce+1],ve,yt,Et,xt,At,Ct,Ot,Ft=E.mode===i.PipsMode.Steps;for(Ft&&(ue=J.xNumSteps[ce]),ue||(ue=xe-Re),xe===void 0&&(xe=Re),ue=Math.max(ue,1e-7),ie=Re;ie<=xe;ie=S(ie,ue)){for(ve=J.toStepping(ie),yt=ve-ae,At=yt/(E.density||1),Ct=Math.round(At),Ot=yt/Ct,pe=1;pe<=Ct;pe+=1)Et=ae+pe*Ot,L[Et.toFixed(5)]=[J.fromStepping(Et),0];xt=R.indexOf(ie)>-1?i.PipsType.LargeValue:Ft?i.PipsType.SmallValue:i.PipsType.NoValue,!ce&&j&&ie!==xe&&(xt=0),ie===xe&&U||(L[ve.toFixed(5)]=[ie,xt]),ae=ve}}),L}function Bt(E,S,R){var L,D,F=_e.createElement("div"),j=(L={},L[i.PipsType.None]="",L[i.PipsType.NoValue]=g.cssClasses.valueNormal,L[i.PipsType.LargeValue]=g.cssClasses.valueLarge,L[i.PipsType.SmallValue]=g.cssClasses.valueSub,L),U=(D={},D[i.PipsType.None]="",D[i.PipsType.NoValue]=g.cssClasses.markerNormal,D[i.PipsType.LargeValue]=g.cssClasses.markerLarge,D[i.PipsType.SmallValue]=g.cssClasses.markerSub,D),ae=[g.cssClasses.valueHorizontal,g.cssClasses.valueVertical],re=[g.cssClasses.markerHorizontal,g.cssClasses.markerVertical];p(F,g.cssClasses.pips),p(F,g.ort===0?g.cssClasses.pipsHorizontal:g.cssClasses.pipsVertical);function ce(ie,pe){var Re=pe===g.cssClasses.value,xe=Re?ae:re,ve=Re?j:U;return pe+" "+xe[g.ort]+" "+ve[ie]}function ue(ie,pe,Re){if(Re=S?S(pe,Re):Re,Re!==i.PipsType.None){var xe=he(F,!1);xe.className=ce(Re,g.cssClasses.marker),xe.style[g.style]=ie+"%",Re>i.PipsType.NoValue&&(xe=he(F,!1),xe.className=ce(Re,g.cssClasses.value),xe.setAttribute("data-value",String(pe)),xe.style[g.style]=ie+"%",xe.innerHTML=String(R.to(pe)))}}return Object.keys(E).forEach(function(ie){ue(ie,E[ie][0],E[ie][1])}),F}function ut(){Le&&(o(Le),Le=null)}function dt(E){ut();var S=$t(E),R=E.filter,L=E.format||{to:function(D){return String(Math.round(D))}};return Le=H.appendChild(Bt(S,R,L)),Le}function Tt(){var E=oe.getBoundingClientRect(),S="offset"+["Width","Height"][g.ort];return g.ort===0?E.width||oe[S]:E.height||oe[S]}function Ke(E,S,R,L){var D=function(j){var U=Ut(j,L.pageOffset,L.target||S);if(!U||rt()&&!L.doNotReject||v(H,g.cssClasses.tap)&&!L.doNotReject||E===N.start&&U.buttons!==void 0&&U.buttons>1||L.hover&&U.buttons)return!1;q||U.preventDefault(),U.calcPoint=U.points[g.ort],R(U,L)},F=[];return E.split(" ").forEach(function(j){S.addEventListener(j,D,q?{passive:!0}:!1),F.push([j,D])}),F}function Ut(E,S,R){var L=E.type.indexOf("touch")===0,D=E.type.indexOf("mouse")===0,F=E.type.indexOf("pointer")===0,j=0,U=0;if(E.type.indexOf("MSPointer")===0&&(F=!0),E.type==="mousedown"&&!E.buttons&&!E.touches)return!1;if(L){var ae=function(ue){var ie=ue.target;return ie===R||R.contains(ie)||E.composed&&E.composedPath().shift()===R};if(E.type==="touchstart"){var re=Array.prototype.filter.call(E.touches,ae);if(re.length>1)return!1;j=re[0].pageX,U=re[0].pageY}else{var ce=Array.prototype.find.call(E.changedTouches,ae);if(!ce)return!1;j=ce.pageX,U=ce.pageY}}return S=S||T(_e),(D||F)&&(j=E.clientX+S.x,U=E.clientY+S.y),E.pageOffset=S,E.points=[j,U],E.cursor=D||F,E}function Rt(E){var S=E-u(oe,g.ort),R=S*100/Tt();return R=_(R),g.dir?100-R:R}function Xt(E){var S=100,R=!1;return K.forEach(function(L,D){if(!ht(D)){var F=se[D],j=Math.abs(F-E),U=j===100&&S===100,ae=j<S,re=j<=S&&E>F;(ae||re||U)&&(R=D,S=j)}}),R}function Wt(E,S){E.type==="mouseout"&&E.target.nodeName==="HTML"&&E.relatedTarget===null&&ft(E,S)}function Vt(E,S){if(navigator.appVersion.indexOf("MSIE 9")===-1&&E.buttons===0&&S.buttonsProperty!==0)return ft(E,S);var R=(g.dir?-1:1)*(E.calcPoint-S.startCalcPoint),L=R*100/S.baseSize;wt(R>0,L,S.locations,S.handleNumbers,S.connect)}function ft(E,S){S.handle&&(C(S.handle,g.cssClasses.active),tt-=1),S.listeners.forEach(function(R){ke.removeEventListener(R[0],R[1])}),tt===0&&(C(H,g.cssClasses.drag),pt(),E.cursor&&(Ce.style.cursor="",Ce.removeEventListener("selectstart",l))),g.events.smoothSteps&&(S.handleNumbers.forEach(function(R){Ze(R,se[R],!0,!0,!1,!1)}),S.handleNumbers.forEach(function(R){fe("update",R)})),S.handleNumbers.forEach(function(R){fe("change",R),fe("set",R),fe("end",R)})}function gt(E,S){if(!S.handleNumbers.some(ht)){var R;if(S.handleNumbers.length===1){var L=K[S.handleNumbers[0]];R=L.children[0],tt+=1,p(R,g.cssClasses.active)}E.stopPropagation();var D=[],F=Ke(N.move,ke,Vt,{target:E.target,handle:R,connect:S.connect,listeners:D,startCalcPoint:E.calcPoint,baseSize:Tt(),pageOffset:E.pageOffset,handleNumbers:S.handleNumbers,buttonsProperty:E.buttons,locations:se.slice()}),j=Ke(N.end,ke,ft,{target:E.target,handle:R,listeners:D,doNotReject:!0,handleNumbers:S.handleNumbers}),U=Ke("mouseout",ke,Wt,{target:E.target,handle:R,listeners:D,doNotReject:!0,handleNumbers:S.handleNumbers});D.push.apply(D,F.concat(j,U)),E.cursor&&(Ce.style.cursor=getComputedStyle(E.target).cursor,K.length>1&&p(H,g.cssClasses.drag),Ce.addEventListener("selectstart",l,!1)),S.handleNumbers.forEach(function(ae){fe("start",ae)})}}function zt(E){E.stopPropagation();var S=Rt(E.calcPoint),R=Xt(S);R!==!1&&(g.events.snap||f(H,g.cssClasses.tap,g.animationDuration),Ze(R,S,!0,!0),pt(),fe("slide",R,!0),fe("update",R,!0),g.events.snap?gt(E,{handleNumbers:[R]}):(fe("change",R,!0),fe("set",R,!0)))}function Yt(E){var S=Rt(E.calcPoint),R=J.getStep(S),L=J.fromStepping(R);Object.keys(Fe).forEach(function(D){D.split(".")[0]==="hover"&&Fe[D].forEach(function(F){F.call(lt,L)})})}function jt(E,S){if(rt()||ht(S))return!1;var R=["Left","Right"],L=["Down","Up"],D=["PageDown","PageUp"],F=["Home","End"];g.dir&&!g.ort?R.reverse():g.ort&&!g.dir&&(L.reverse(),D.reverse());var j=E.key.replace("Arrow",""),U=j===D[0],ae=j===D[1],re=j===L[0]||j===R[0]||U,ce=j===L[1]||j===R[1]||ae,ue=j===F[0],ie=j===F[1];if(!re&&!ce&&!ue&&!ie)return!0;E.preventDefault();var pe;if(ce||re){var Re=re?0:1,xe=Mt(S),ve=xe[Re];if(ve===null)return!1;ve===!1&&(ve=J.getDefaultStep(se[S],re,g.keyboardDefaultStep)),ae||U?ve*=g.keyboardPageMultiplier:ve*=g.keyboardMultiplier,ve=Math.max(ve,1e-7),ve=(re?-1:1)*ve,pe=Pe[S]+ve}else ie?pe=g.spectrum.xVal[g.spectrum.xVal.length-1]:pe=g.spectrum.xVal[0];return Ze(S,J.toStepping(pe),!0,!0),fe("slide",S),fe("update",S),fe("change",S),fe("set",S),!1}function Kt(E){E.fixed||K.forEach(function(S,R){Ke(N.start,S.children[0],gt,{handleNumbers:[R]})}),E.tap&&Ke(N.start,oe,zt,{}),E.hover&&Ke(N.move,oe,Yt,{hover:!0}),E.drag&&Ee.forEach(function(S,R){if(!(S===!1||R===0||R===Ee.length-1)){var L=K[R-1],D=K[R],F=[S],j=[L,D],U=[R-1,R];p(S,g.cssClasses.draggable),E.fixed&&(F.push(L.children[0]),F.push(D.children[0])),E.dragAll&&(j=K,U=me),F.forEach(function(ae){Ke(N.start,ae,gt,{handles:j,handleNumbers:U,connect:S})})}})}function mt(E,S){Fe[E]=Fe[E]||[],Fe[E].push(S),E.split(".")[0]==="update"&&K.forEach(function(R,L){fe("update",L)})}function Zt(E){return E===V.aria||E===V.tooltips}function st(E){var S=E&&E.split(".")[0],R=S?E.substring(S.length):E;Object.keys(Fe).forEach(function(L){var D=L.split(".")[0],F=L.substring(D.length);(!S||S===D)&&(!R||R===F)&&(!Zt(F)||R===F)&&delete Fe[L]})}function fe(E,S,R){Object.keys(Fe).forEach(function(L){var D=L.split(".")[0];E===D&&Fe[L].forEach(function(F){F.call(lt,Pe.map(g.format.to),S,Pe.slice(),R||!1,se.slice(),lt)})})}function ot(E,S,R,L,D,F,j){var U;return K.length>1&&!g.events.unconstrained&&(L&&S>0&&(U=J.getAbsoluteDistance(E[S-1],g.margin,!1),R=Math.max(R,U)),D&&S<K.length-1&&(U=J.getAbsoluteDistance(E[S+1],g.margin,!0),R=Math.min(R,U))),K.length>1&&g.limit&&(L&&S>0&&(U=J.getAbsoluteDistance(E[S-1],g.limit,!1),R=Math.min(R,U)),D&&S<K.length-1&&(U=J.getAbsoluteDistance(E[S+1],g.limit,!0),R=Math.max(R,U))),g.padding&&(S===0&&(U=J.getAbsoluteDistance(0,g.padding[0],!1),R=Math.max(R,U)),S===K.length-1&&(U=J.getAbsoluteDistance(100,g.padding[1],!0),R=Math.min(R,U))),j||(R=J.getStep(R)),R=_(R),R===E[S]&&!F?!1:R}function _t(E,S){var R=g.ort;return(R?S:E)+", "+(R?E:S)}function wt(E,S,R,L,D){var F=R.slice(),j=L[0],U=g.events.smoothSteps,ae=[!E,E],re=[E,!E];L=L.slice(),E&&L.reverse(),L.length>1?L.forEach(function(ue,ie){var pe=ot(F,ue,F[ue]+S,ae[ie],re[ie],!1,U);pe===!1?S=0:(S=pe-F[ue],F[ue]=pe)}):ae=re=[!0];var ce=!1;L.forEach(function(ue,ie){ce=Ze(ue,R[ue]+S,ae[ie],re[ie],!1,U)||ce}),ce&&(L.forEach(function(ue){fe("update",ue),fe("slide",ue)}),D!=null&&fe("drag",j))}function It(E,S){return g.dir?100-E-S:E}function Ht(E,S){se[E]=S,Pe[E]=J.fromStepping(S);var R=It(S,0)-Ne,L="translate("+_t(R+"%","0")+")";K[E].style[g.transformRule]=L,Lt(E),Lt(E+1)}function pt(){me.forEach(function(E){var S=se[E]>50?-1:1,R=3+(K.length+S*E);K[E].style.zIndex=String(R)})}function Ze(E,S,R,L,D,F){return D||(S=ot(se,E,S,R,L,!1,F)),S===!1?!1:(Ht(E,S),!0)}function Lt(E){if(Ee[E]){var S=0,R=100;E!==0&&(S=se[E-1]),E!==Ee.length-1&&(R=se[E]);var L=R-S,D="translate("+_t(It(S,L)+"%","0")+")",F="scale("+_t(L/100,"1")+")";Ee[E].style[g.transformRule]=D+" "+F}}function Pt(E,S){return E===null||E===!1||E===void 0||(typeof E=="number"&&(E=String(E)),E=g.format.from(E),E!==!1&&(E=J.toStepping(E)),E===!1||isNaN(E))?se[S]:E}function at(E,S,R){var L=m(E),D=se[0]===void 0;S=S===void 0?!0:S,g.animate&&!D&&f(H,g.cssClasses.tap,g.animationDuration),me.forEach(function(U){Ze(U,Pt(L[U],U),!0,!1,R)});var F=me.length===1?0:1;if(D&&J.hasNoSize()&&(R=!0,se[0]=0,me.length>1)){var j=100/(me.length-1);me.forEach(function(U){se[U]=U*j})}for(;F<me.length;++F)me.forEach(function(U){Ze(U,se[U],!0,!0,R)});pt(),me.forEach(function(U){fe("update",U),L[U]!==null&&S&&fe("set",U)})}function qt(E){at(g.start,E)}function Jt(E,S,R,L){if(E=Number(E),!(E>=0&&E<me.length))throw new Error("noUiSlider: invalid handle number, got: "+E);Ze(E,Pt(S,E),!0,!0,L),fe("update",E),R&&fe("set",E)}function bt(E){if(E===void 0&&(E=!1),E)return Pe.length===1?Pe[0]:Pe.slice(0);var S=Pe.map(g.format.to);return S.length===1?S[0]:S}function Qt(){for(st(V.aria),st(V.tooltips),Object.keys(g.cssClasses).forEach(function(E){C(H,g.cssClasses[E])});H.firstChild;)H.removeChild(H.firstChild);delete H.noUiSlider}function Mt(E){var S=se[E],R=J.getNearbySteps(S),L=Pe[E],D=R.thisStep.step,F=null;if(g.snap)return[L-R.stepBefore.startValue||null,R.stepAfter.startValue-L||null];D!==!1&&L+D>R.stepAfter.startValue&&(D=R.stepAfter.startValue-L),L>R.thisStep.startValue?F=R.thisStep.step:R.stepBefore.step===!1?F=!1:F=L-R.stepBefore.highestStep,S===100?D=null:S===0&&(F=null);var j=J.countStepDecimals();return D!==null&&D!==!1&&(D=Number(D.toFixed(j))),F!==null&&F!==!1&&(F=Number(F.toFixed(j))),[F,D]}function ei(){return me.map(Mt)}function ti(E,S){var R=bt(),L=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];L.forEach(function(F){E[F]!==void 0&&(P[F]=E[F])});var D=Ie(P);L.forEach(function(F){E[F]!==void 0&&(g[F]=D[F])}),J=D.spectrum,g.margin=D.margin,g.limit=D.limit,g.padding=D.padding,g.pips?dt(g.pips):ut(),g.tooltips?vt():ct(),se=[],at(a(E.start)?E.start:R,S)}function ii(){oe=be(H),Te(g.connect,oe),Kt(g.events),at(g.start),g.pips&&dt(g.pips),g.tooltips&&vt(),Nt()}ii();var lt={destroy:Qt,steps:ei,on:mt,off:st,get:bt,set:at,setHandle:Jt,reset:qt,disable:Dt,enable:kt,__moveHandles:function(E,S,R){wt(E,S,se,R)},options:P,updateOptions:ti,target:H,removePips:ut,removeTooltips:ct,getPositions:function(){return se.slice()},getTooltips:function(){return de},getOrigins:function(){return K},pips:dt};return lt}function Oe(x,g){if(!x||!x.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+x);if(x.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var P=Ie(g),N=Me(x,P,g);return x.noUiSlider=N,N}var ze={__spectrum:B,cssClasses:G,create:Oe};i.create=Oe,i.cssClasses=G,i.default=ze,Object.defineProperty(i,"__esModule",{value:!0})})})(nouislider,nouislider.exports);var nouisliderExports=nouislider.exports;const noUiSlider=getDefaultExportFromCjs(nouisliderExports);var wNumb$1={exports:{}};(function(r,t){(function(i){r.exports=i()})(function(){var i=["decimals","thousand","mark","prefix","suffix","encoder","decoder","negativeBefore","negative","edit","undo"];function n(m){return m.split("").reverse().join("")}function s(m,y){return m.substring(0,y.length)===y}function o(m,y){return m.slice(-1*y.length)===y}function a(m,y,p){if((m[y]||m[p])&&m[y]===m[p])throw new Error(y)}function l(m){return typeof m=="number"&&isFinite(m)}function h(m,y){return m=m.toString().split("e"),m=Math.round(+(m[0]+"e"+(m[1]?+m[1]+y:y))),m=m.toString().split("e"),(+(m[0]+"e"+(m[1]?+m[1]-y:-y))).toFixed(y)}function c(m,y,p,C,v,T,w,I,O,$,k,b){var W=b,X,Z,Y,le="",B="";return T&&(b=T(b)),l(b)?(m!==!1&&parseFloat(b.toFixed(m))===0&&(b=0),b<0&&(X=!0,b=Math.abs(b)),m!==!1&&(b=h(b,m)),b=b.toString(),b.indexOf(".")!==-1?(Z=b.split("."),Y=Z[0],p&&(le=p+Z[1])):Y=b,y&&(Y=n(Y).match(/.{1,3}/g),Y=n(Y.join(n(y)))),X&&I&&(B+=I),C&&(B+=C),X&&O&&(B+=O),B+=Y,B+=le,v&&(B+=v),$&&(B=$(B,W)),B):!1}function u(m,y,p,C,v,T,w,I,O,$,k,b){var W,X="";return k&&(b=k(b)),!b||typeof b!="string"||(I&&s(b,I)&&(b=b.replace(I,""),W=!0),C&&s(b,C)&&(b=b.replace(C,"")),O&&s(b,O)&&(b=b.replace(O,""),W=!0),v&&o(b,v)&&(b=b.slice(0,-1*v.length)),y&&(b=b.split(y).join("")),p&&(b=b.replace(p,".")),W&&(X+="-"),X+=b,X=X.replace(/[^0-9\.\-.]/g,""),X==="")||(X=Number(X),w&&(X=w(X)),!l(X))?!1:X}function d(m){var y,p,C,v={};for(m.suffix===void 0&&(m.suffix=m.postfix),y=0;y<i.length;y+=1)if(p=i[y],C=m[p],C===void 0)p==="negative"&&!v.negativeBefore?v[p]="-":p==="mark"&&v.thousand!=="."?v[p]=".":v[p]=!1;else if(p==="decimals")if(C>=0&&C<8)v[p]=C;else throw new Error(p);else if(p==="encoder"||p==="decoder"||p==="edit"||p==="undo")if(typeof C=="function")v[p]=C;else throw new Error(p);else if(typeof C=="string")v[p]=C;else throw new Error(p);return a(v,"mark","thousand"),a(v,"prefix","negative"),a(v,"prefix","negativeBefore"),v}function f(m,y,p){var C,v=[];for(C=0;C<i.length;C+=1)v.push(m[i[C]]);return v.push(p),y.apply("",v)}function _(m){if(!(this instanceof _))return new _(m);typeof m=="object"&&(m=d(m),this.to=function(y){return f(m,c,y)},this.from=function(y){return f(m,u,y)})}return _})})(wNumb$1);var wNumbExports=wNumb$1.exports;const wNumb=getDefaultExportFromCjs(wNumbExports),messages={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class AssertionError extends Error{constructor(t){const i=messages[t];super(i),this.code=t,this.name="AssertionError",this.message=i}}const AssertionError$1=AssertionError;class BaseEvent{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Event=BaseEvent,ObjectEventType={PROPERTYCHANGE:"propertychange"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const Disposable$1=Disposable;function binarySearch(r,t,i){let n,s;i=i||ascending;let o=0,a=r.length,l=!1;for(;o<a;)n=o+(a-o>>1),s=+i(r[n],t),s<0?o=n+1:(a=n,l=!s);return l?o:~o}function ascending(r,t){return r>t?1:r<t?-1:0}function linearFindNearest(r,t,i){const n=r.length;if(r[0]<=t)return 0;if(t<=r[n-1])return n-1;let s;if(i>0){for(s=1;s<n;++s)if(r[s]<t)return s-1}else if(i<0){for(s=1;s<n;++s)if(r[s]<=t)return s}else for(s=1;s<n;++s){if(r[s]==t)return s;if(r[s]<t)return typeof i=="function"?i(t,r[s-1],r[s])>0?s-1:s:r[s-1]-t<t-r[s]?s-1:s}return n-1}function reverseSubArray(r,t,i){for(;t<i;){const n=r[t];r[t]=r[i],r[i]=n,++t,--i}}function extend$2(r,t){const i=Array.isArray(t)?t:[t],n=i.length;for(let s=0;s<n;s++)r[r.length]=i[s]}function equals$2(r,t){const i=r.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(r[n]!==t[n])return!1;return!0}function isSorted(r,t,i){const n=t||ascending;return r.every(function(s,o){if(o===0)return!0;const a=n(r[o-1],s);return!(a>0||i&&a===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(r){let t=!1,i,n,s;return function(){const o=Array.prototype.slice.call(arguments);return(!t||this!==s||!equals$2(o,n))&&(t=!0,s=this,n=o,i=r.apply(this,arguments)),i}}function clear(r){for(const t in r)delete r[t]}function isEmpty$1(r){let t;for(t in r)return!1;return!t}class Target extends Disposable$1{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const o=i?new Event(t):t;o.target||(o.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,l[n]=0),++a[n];let h;for(let c=0,u=s.length;c<u;++c)if("handleEvent"in s[c]?h=s[c].handleEvent(o):h=s[c].call(this,o),h===!1||o.propagationStopped){h=!1;break}if(--a[n]===0){let c=l[n];for(delete l[n];c--;)this.removeEventListener(n,VOID);delete a[n]}return h}disposeInternal(){this.listeners_&&clear(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){const n=this.listeners_&&this.listeners_[t];if(n){const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=VOID,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}}const EventTarget=Target,EventType={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function listen(r,t,i,n,s){if(n&&n!==r&&(i=i.bind(n)),s){const a=i;i=function(){r.removeEventListener(t,i),a.apply(this,arguments)}}const o={target:r,type:t,listener:i};return r.addEventListener(t,i),o}function listenOnce(r,t,i,n){return listen(r,t,i,n,!0)}function unlistenByKey(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),clear(r))}class Observable extends EventTarget{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=listen(this,t[o],i);return s}return listen(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let o=0;o<s;++o)n[o]=listenOnce(this,t[o],i)}else n=listenOnce(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)unByKey(n);else if(Array.isArray(t))for(let s=0,o=t.length;s<o;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(r){if(Array.isArray(r))for(let t=0,i=r.length;t<i;++t)unlistenByKey(r[t]);else unlistenByKey(r)}const Observable$1=Observable;function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_=0;function getUid(r){return r.ol_uid||(r.ol_uid=String(++uidCounter_))}class ObjectEvent extends Event{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}class BaseObject extends Observable$1{constructor(t){super(),this.on,this.once,this.un,getUid(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new ObjectEvent(n,t,i)),n=ObjectEventType.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ObjectEvent(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const o=s[t];s[t]=i,o!==i&&this.notify(t,o)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],isEmpty$1(this.values_)&&(this.values_=null),i||this.notify(t,n)}}}const BaseObject$1=BaseObject,CollectionEventType={ADD:"add",REMOVE:"remove"},Property$2={LENGTH:"length"};class CollectionEvent extends Event{constructor(t,i,n){super(t),this.element=i,this.index=n}}class Collection extends BaseObject$1{constructor(t,i){if(super(),this.on,this.once,this.un,i=i||{},this.unique_=!!i.unique,this.array_=t||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let i=0,n=t.length;i<n;++i)this.push(t[i]);return this}forEach(t){const i=this.array_;for(let n=0,s=i.length;n<s;++n)t(i[n],n,i)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Property$2.LENGTH)}insertAt(t,i){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const i=this.getLength();return this.insertAt(i,t),this.getLength()}remove(t){const i=this.array_;for(let n=0,s=i.length;n<s;++n)if(i[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,i,t)),i}setAt(t,i){const n=this.getLength();if(t>=n){this.insertAt(t,i);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i,t);const s=this.array_[t];this.array_[t]=i,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,s,t)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,t))}updateLength_(){this.set(Property$2.LENGTH,this.array_.length)}assertUnique_(t,i){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===t&&n!==i)throw new AssertionError$1(58)}}const Collection$1=Collection;function assert(r,t){if(!r)throw new AssertionError$1(t)}class Feature extends BaseObject$1{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const i=t;this.setGeometry(i)}else{const i=t;this.setProperties(i)}}clone(){const t=new Feature(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const i=this.getGeometry();i&&t.setGeometry(i.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=listen(t,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?createStyleFunction(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(r){if(typeof r=="function")return r;let t;return Array.isArray(r)?t=r:(assert(typeof r.getZIndex=="function",41),t=[r]),function(){return t}}const Feature$1=Feature,ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",FIREFOX=ua.includes("firefox"),SAFARI=ua.includes("safari")&&!ua.includes("chrom");SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua));const WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,PASSIVE_EVENT_LISTENERS=function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r}();new Array(6);function create(){return[1,0,0,1,0,0]}function set(r,t,i,n,s,o,a){return r[0]=t,r[1]=i,r[2]=n,r[3]=s,r[4]=o,r[5]=a,r}function setFromArray(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function apply(r,t){const i=t[0],n=t[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function makeScale(r,t,i){return set(r,t,0,0,i,0,0)}function compose(r,t,i,n,s,o,a,l){const h=Math.sin(o),c=Math.cos(o);return r[0]=n*c,r[1]=s*h,r[2]=-n*h,r[3]=s*c,r[4]=a*n*c-l*n*h+t,r[5]=a*s*h+l*s*c+i,r}function makeInverse(r,t){const i=determinant(t);assert(i!==0,32);const n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],h=t[5];return r[0]=a/i,r[1]=-s/i,r[2]=-o/i,r[3]=n/i,r[4]=(o*h-a*l)/i,r[5]=-(n*h-s*l)/i,r}function determinant(r){return r[0]*r[3]-r[1]*r[2]}let transformStringDiv;function toString$1(r){const t="matrix("+r.join(", ")+")";if(WORKER_OFFSCREEN_CANVAS)return t;const i=transformStringDiv||(transformStringDiv=document.createElement("div"));return i.style.transform=t,i.style.transform}const Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(r){const t=createEmpty();for(let i=0,n=r.length;i<n;++i)extendCoordinate(t,r[i]);return t}function buffer(r,t,i){return i?(i[0]=r[0]-t,i[1]=r[1]-t,i[2]=r[2]+t,i[3]=r[3]+t,i):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function clone(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function closestSquaredDistanceXY(r,t,i){let n,s;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,i<r[1]?s=r[1]-i:r[3]<i?s=i-r[3]:s=0,n*n+s*s}function containsCoordinate(r,t){return containsXY(r,t[0],t[1])}function containsExtent(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function containsXY(r,t,i){return r[0]<=t&&t<=r[2]&&r[1]<=i&&i<=r[3]}function coordinateRelationship(r,t){const i=r[0],n=r[1],s=r[2],o=r[3],a=t[0],l=t[1];let h=Relationship.UNKNOWN;return a<i?h=h|Relationship.LEFT:a>s&&(h=h|Relationship.RIGHT),l<n?h=h|Relationship.BELOW:l>o&&(h=h|Relationship.ABOVE),h===Relationship.UNKNOWN&&(h=Relationship.INTERSECTING),h}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(r,t,i,n,s){return s?(s[0]=r,s[1]=t,s[2]=i,s[3]=n,s):[r,t,i,n]}function createOrUpdateEmpty(r){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,r)}function createOrUpdateFromCoordinate(r,t){const i=r[0],n=r[1];return createOrUpdate$2(i,n,i,n,t)}function createOrUpdateFromFlatCoordinates(r,t,i,n,s){const o=createOrUpdateEmpty(s);return extendFlatCoordinates(o,r,t,i,n)}function equals$1(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function extend$1(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function extendCoordinate(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function extendFlatCoordinates(r,t,i,n,s){for(;i<n;i+=s)extendXY(r,t[i],t[i+1]);return r}function extendXY(r,t,i){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],i),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],i)}function forEachCorner(r,t){let i;return i=t(getBottomLeft(r)),i||(i=t(getBottomRight(r)),i)||(i=t(getTopRight(r)),i)||(i=t(getTopLeft(r)),i)?i:!1}function getArea(r){let t=0;return isEmpty(r)||(t=getWidth(r)*getHeight(r)),t}function getBottomLeft(r){return[r[0],r[1]]}function getBottomRight(r){return[r[2],r[1]]}function getCenter(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function getCorner(r,t){let i;return t==="bottom-left"?i=getBottomLeft(r):t==="bottom-right"?i=getBottomRight(r):t==="top-left"?i=getTopLeft(r):t==="top-right"?i=getTopRight(r):assert(!1,13),i}function getForViewAndSize(r,t,i,n,s){const[o,a,l,h,c,u,d,f]=getRotatedViewport(r,t,i,n);return createOrUpdate$2(Math.min(o,l,c,d),Math.min(a,h,u,f),Math.max(o,l,c,d),Math.max(a,h,u,f),s)}function getRotatedViewport(r,t,i,n){const s=t*n[0]/2,o=t*n[1]/2,a=Math.cos(i),l=Math.sin(i),h=s*a,c=s*l,u=o*a,d=o*l,f=r[0],_=r[1];return[f-h+d,_-c-u,f-h-d,_-c+u,f+h-d,_+c+u,f+h+d,_+c-u,f-h+d,_-c-u]}function getHeight(r){return r[3]-r[1]}function getIntersection(r,t,i){const n=i||createEmpty();return intersects$1(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):createOrUpdateEmpty(n),n}function getTopLeft(r){return[r[0],r[3]]}function getTopRight(r){return[r[2],r[3]]}function getWidth(r){return r[2]-r[0]}function intersects$1(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function isEmpty(r){return r[2]<r[0]||r[3]<r[1]}function returnOrUpdate(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function intersectsSegment(r,t,i){let n=!1;const s=coordinateRelationship(r,t),o=coordinateRelationship(r,i);if(s===Relationship.INTERSECTING||o===Relationship.INTERSECTING)n=!0;else{const a=r[0],l=r[1],h=r[2],c=r[3],u=t[0],d=t[1],f=i[0],_=i[1],m=(_-d)/(f-u);let y,p;o&Relationship.ABOVE&&!(s&Relationship.ABOVE)&&(y=f-(_-c)/m,n=y>=a&&y<=h),!n&&o&Relationship.RIGHT&&!(s&Relationship.RIGHT)&&(p=_-(f-h)*m,n=p>=l&&p<=c),!n&&o&Relationship.BELOW&&!(s&Relationship.BELOW)&&(y=f-(_-l)/m,n=y>=a&&y<=h),!n&&o&Relationship.LEFT&&!(s&Relationship.LEFT)&&(p=_-(f-a)*m,n=p>=l&&p<=c)}return n}function wrapX$2(r,t){const i=t.getExtent(),n=getCenter(r);if(t.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const s=getWidth(i),a=Math.floor((n[0]-i[0])/s)*s;r[0]-=a,r[2]-=a}return r}function wrapAndSliceX(r,t){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[i[0],r[1],i[2],r[3]]];wrapX$2(r,t);const n=getWidth(i);if(getWidth(r)>n)return[[i[0],r[1],i[2],r[3]]];if(r[0]<i[0])return[[r[0]+n,r[1],i[2],r[3]],[i[0],r[1],r[2],r[3]]];if(r[2]>i[2])return[[r[0],r[1],i[2],r[3]],[i[0],r[1],r[2]-n,r[3]]]}return[r]}const METERS_PER_UNIT$1={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Projection{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Projection$1=Projection,RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$1=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2));class EPSG3857Projection extends Projection$1{constructor(t){super({code:t,units:"m",extent:EXTENT$1,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(i,n){return i/Math.cosh(n[1]/RADIUS$1)}})}}const PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(r,t,i){const n=r.length;i=i>1?i:2,t===void 0&&(i>2?t=r.slice():t=new Array(n));for(let s=0;s<n;s+=i){t[s]=HALF_SIZE*r[s]/180;let o=RADIUS$1*Math.log(Math.tan(Math.PI*(+r[s+1]+90)/360));o>MAX_SAFE_Y?o=MAX_SAFE_Y:o<-MAX_SAFE_Y&&(o=-MAX_SAFE_Y),t[s+1]=o}return t}function toEPSG4326(r,t,i){const n=r.length;i=i>1?i:2,t===void 0&&(i>2?t=r.slice():t=new Array(n));for(let s=0;s<n;s+=i)t[s]=180*r[s]/HALF_SIZE,t[s+1]=360*Math.atan(Math.exp(r[s+1]/RADIUS$1))/Math.PI-90;return t}const RADIUS=6378137,EXTENT=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180;class EPSG4326Projection extends Projection$1{constructor(t,i){super({code:t,units:"degrees",extent:EXTENT,axisOrientation:i,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT})}}const PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let cache={};function get$3(r){return cache[r]||cache[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$2(r,t){cache[r]=t}let transforms={};function add$1(r,t,i){const n=r.getCode(),s=t.getCode();n in transforms||(transforms[n]={}),transforms[n][s]=i}function get$2(r,t){let i;return r in transforms&&t in transforms[r]&&(i=transforms[r][t]),i}function clamp(r,t,i){return Math.min(Math.max(r,t),i)}function squaredSegmentDistance(r,t,i,n,s,o){const a=s-i,l=o-n;if(a!==0||l!==0){const h=((r-i)*a+(t-n)*l)/(a*a+l*l);h>1?(i=s,n=o):h>0&&(i+=a*h,n+=l*h)}return squaredDistance(r,t,i,n)}function squaredDistance(r,t,i,n){const s=i-r,o=n-t;return s*s+o*o}function solveLinearSystem(r){const t=r.length;for(let n=0;n<t;n++){let s=n,o=Math.abs(r[n][n]);for(let l=n+1;l<t;l++){const h=Math.abs(r[l][n]);h>o&&(o=h,s=l)}if(o===0)return null;const a=r[s];r[s]=r[n],r[n]=a;for(let l=n+1;l<t;l++){const h=-r[l][n]/r[n][n];for(let c=n;c<t+1;c++)n==c?r[l][c]=0:r[l][c]+=h*r[n][c]}}const i=new Array(t);for(let n=t-1;n>=0;n--){i[n]=r[n][t]/r[n][n];for(let s=n-1;s>=0;s--)r[s][t]-=r[s][n]*i[n]}return i}function toRadians(r){return r*Math.PI/180}function modulo(r,t){const i=r%t;return i*t<0?i+t:i}function lerp(r,t,i){return r+i*(t-r)}function toFixed(r,t){const i=Math.pow(10,t);return Math.round(r*i)/i}function floor(r,t){return Math.floor(toFixed(r,t))}function ceil(r,t){return Math.ceil(toFixed(r,t))}function add(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function equals(r,t){let i=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){i=!1;break}return i}function rotate$1(r,t){const i=Math.cos(t),n=Math.sin(t),s=r[0]*i-r[1]*n,o=r[1]*i+r[0]*n;return r[0]=s,r[1]=o,r}function scale$2(r,t){return r[0]*=t,r[1]*=t,r}function wrapX$1(r,t){if(t.canWrapX()){const i=getWidth(t.getExtent()),n=getWorldsAway(r,t,i);n&&(r[0]-=n*i)}return r}function getWorldsAway(r,t,i){const n=t.getExtent();let s=0;return t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(i=i||getWidth(n),s=Math.floor((r[0]-n[0])/i)),s}const DEFAULT_RADIUS=63710088e-1;function getDistance(r,t,i){i=i||DEFAULT_RADIUS;const n=toRadians(r[1]),s=toRadians(t[1]),o=(s-n)/2,a=toRadians(t[0]-r[0])/2,l=Math.sin(o)*Math.sin(o)+Math.sin(a)*Math.sin(a)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const levels={info:1,warn:2,error:3,none:4};let level=levels.info;function warn(...r){level>levels.warn||console.warn(...r)}let showCoordinateWarning=!0;function disableCoordinateWarning(r){showCoordinateWarning=!(r===void 0?!0:r)}function cloneTransform(r,t){if(t!==void 0){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];t=t}else t=r.slice();return t}function identityTransform(r,t){if(t!==void 0&&r!==t){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];r=t}return r}function addProjection(r){add$2(r.getCode(),r),add$1(r,r,cloneTransform)}function addProjections(r){r.forEach(addProjection)}function get$1(r){return typeof r=="string"?get$3(r):r||null}function getPointResolution(r,t,i,n){r=get$1(r);let s;const o=r.getPointResolutionFunc();if(o){if(s=o(t,i),n&&n!==r.getUnits()){const a=r.getMetersPerUnit();a&&(s=s*a/METERS_PER_UNIT$1[n])}}else{const a=r.getUnits();if(a=="degrees"&&!n||n=="degrees")s=t;else{const l=getTransformFromProjections(r,get$1("EPSG:4326"));if(l===identityTransform&&a!=="degrees")s=t*r.getMetersPerUnit();else{let c=[i[0]-t/2,i[1],i[0]+t/2,i[1],i[0],i[1]-t/2,i[0],i[1]+t/2];c=l(c,c,2);const u=getDistance(c.slice(0,2),c.slice(2,4)),d=getDistance(c.slice(4,6),c.slice(6,8));s=(u+d)/2}const h=n?METERS_PER_UNIT$1[n]:r.getMetersPerUnit();h!==void 0&&(s/=h)}}return s}function addEquivalentProjections(r){addProjections(r),r.forEach(function(t){r.forEach(function(i){t!==i&&add$1(t,i,cloneTransform)})})}function addEquivalentTransforms(r,t,i,n){r.forEach(function(s){t.forEach(function(o){add$1(s,o,i),add$1(o,s,n)})})}function createProjection(r,t){if(r){if(typeof r=="string")return get$1(r)}else return get$1(t);return r}function equivalent(r,t){if(r===t)return!0;const i=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||getTransformFromProjections(r,t)===cloneTransform)&&i}function getTransformFromProjections(r,t){const i=r.getCode(),n=t.getCode();let s=get$2(i,n);return s||(s=identityTransform),s}function getTransform(r,t){const i=get$1(r),n=get$1(t);return getTransformFromProjections(i,n)}function transform(r,t,i){return getTransform(t,i)(r,void 0,r.length)}function toUserCoordinate(r,t){return r}function fromUserCoordinate(r,t){return showCoordinateWarning&&!equals(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(showCoordinateWarning=!1,warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function toUserExtent(r,t){return r}function fromUserExtent(r,t){return r}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();function transform2D(r,t,i,n,s,o){o=o||[];let a=0;for(let l=t;l<i;l+=n){const h=r[l],c=r[l+1];o[a++]=s[0]*h+s[2]*c+s[4],o[a++]=s[1]*h+s[3]*c+s[5]}return o&&o.length!=a&&(o.length=a),o}function rotate(r,t,i,n,s,o,a){a=a||[];const l=Math.cos(s),h=Math.sin(s),c=o[0],u=o[1];let d=0;for(let f=t;f<i;f+=n){const _=r[f]-c,m=r[f+1]-u;a[d++]=c+_*l-m*h,a[d++]=u+_*h+m*l;for(let y=f+2;y<f+n;++y)a[d++]=r[y]}return a&&a.length!=d&&(a.length=d),a}function scale$1(r,t,i,n,s,o,a,l){l=l||[];const h=a[0],c=a[1];let u=0;for(let d=t;d<i;d+=n){const f=r[d]-h,_=r[d+1]-c;l[u++]=h+s*f,l[u++]=c+o*_;for(let m=d+2;m<d+n;++m)l[u++]=r[m]}return l&&l.length!=u&&(l.length=u),l}function translate(r,t,i,n,s,o,a){a=a||[];let l=0;for(let h=t;h<i;h+=n){a[l++]=r[h]+s,a[l++]=r[h+1]+o;for(let c=h+2;c<h+n;++c)a[l++]=r[c]}return a&&a.length!=l&&(a.length=l),a}const tmpTransform=create();class Geometry extends BaseObject$1{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne(function(t,i,n){if(!n)return this.getSimplifiedGeometry(i);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(i)})}simplifyTransformed(t,i){return this.simplifyTransformedInternal(this.getRevision(),t,i)}clone(){return abstract()}closestPointXY(t,i,n,s){return abstract()}containsXY(t,i){const n=this.getClosestPoint([t,i]);return n[0]===t&&n[1]===i}getClosestPoint(t,i){return i=i||[NaN,NaN],this.closestPointXY(t[0],t[1],i,1/0),i}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return abstract()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const i=this.computeExtent(this.extent_);(isNaN(i[0])||isNaN(i[1]))&&createOrUpdateEmpty(i),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,t)}rotate(t,i){abstract()}scale(t,i,n){abstract()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return abstract()}getType(){return abstract()}applyTransform(t){abstract()}intersectsExtent(t){return abstract()}translate(t,i){abstract()}transform(t,i){const n=get$1(t),s=n.getUnits()=="tile-pixels"?function(o,a,l){const h=n.getExtent(),c=n.getWorldExtent(),u=getHeight(c)/getHeight(h);return compose(tmpTransform,c[0],c[3],u,-u,0,0,0),transform2D(o,0,o.length,l,tmpTransform,a),getTransform(n,i)(o,a,l)}:getTransform(n,i);return this.applyTransform(s),this}}const Geometry$1=Geometry;class SimpleGeometry extends Geometry$1{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=this.getSimplifiedGeometryInternal(t);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,i){this.stride=getStrideForLayout(t),this.layout=t,this.flatCoordinates=i}setCoordinates(t,i){abstract()}setLayout(t,i,n){let s;if(t)s=getStrideForLayout(t);else{for(let o=0;o<n;++o){if(i.length===0){this.layout="XY",this.stride=2;return}i=i[0]}s=i.length,t=getLayoutForStride(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,i){const n=this.getFlatCoordinates();if(n){const s=this.getStride();rotate(n,0,n.length,s,t,i,n),this.changed()}}scale(t,i,n){i===void 0&&(i=t),n||(n=getCenter(this.getExtent()));const s=this.getFlatCoordinates();if(s){const o=this.getStride();scale$1(s,0,s.length,o,t,i,n,s),this.changed()}}translate(t,i){const n=this.getFlatCoordinates();if(n){const s=this.getStride();translate(n,0,n.length,s,t,i,n),this.changed()}}}function getLayoutForStride(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function getStrideForLayout(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function transformGeom2D(r,t,i){const n=r.getFlatCoordinates();if(!n)return null;const s=r.getStride();return transform2D(n,0,n.length,s,t,i)}const SimpleGeometry$1=SimpleGeometry;function assignClosest(r,t,i,n,s,o,a){const l=r[t],h=r[t+1],c=r[i]-l,u=r[i+1]-h;let d;if(c===0&&u===0)d=t;else{const f=((s-l)*c+(o-h)*u)/(c*c+u*u);if(f>1)d=i;else if(f>0){for(let _=0;_<n;++_)a[_]=lerp(r[t+_],r[i+_],f);a.length=n;return}else d=t}for(let f=0;f<n;++f)a[f]=r[d+f];a.length=n}function maxSquaredDelta(r,t,i,n,s){let o=r[t],a=r[t+1];for(t+=n;t<i;t+=n){const l=r[t],h=r[t+1],c=squaredDistance(o,a,l,h);c>s&&(s=c),o=l,a=h}return s}function arrayMaxSquaredDelta(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o];s=maxSquaredDelta(r,t,l,n,s),t=l}return s}function multiArrayMaxSquaredDelta(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o];s=arrayMaxSquaredDelta(r,t,l,n,s),t=l[l.length-1]}return s}function assignClosestPoint(r,t,i,n,s,o,a,l,h,c,u){if(t==i)return c;let d,f;if(s===0){if(f=squaredDistance(a,l,r[t],r[t+1]),f<c){for(d=0;d<n;++d)h[d]=r[t+d];return h.length=n,f}return c}u=u||[NaN,NaN];let _=t+n;for(;_<i;)if(assignClosest(r,_-n,_,n,a,l,u),f=squaredDistance(a,l,u[0],u[1]),f<c){for(c=f,d=0;d<n;++d)h[d]=u[d];h.length=n,_+=n}else _+=n*Math.max((Math.sqrt(f)-Math.sqrt(c))/s|0,1);if(o&&(assignClosest(r,i-n,t,n,a,l,u),f=squaredDistance(a,l,u[0],u[1]),f<c)){for(c=f,d=0;d<n;++d)h[d]=u[d];h.length=n}return c}function assignClosestArrayPoint(r,t,i,n,s,o,a,l,h,c,u){u=u||[NaN,NaN];for(let d=0,f=i.length;d<f;++d){const _=i[d];c=assignClosestPoint(r,t,_,n,s,o,a,l,h,c,u),t=_}return c}function assignClosestMultiArrayPoint(r,t,i,n,s,o,a,l,h,c,u){u=u||[NaN,NaN];for(let d=0,f=i.length;d<f;++d){const _=i[d];c=assignClosestArrayPoint(r,t,_,n,s,o,a,l,h,c,u),t=_[_.length-1]}return c}function deflateCoordinate(r,t,i,n){for(let s=0,o=i.length;s<o;++s)r[t++]=i[s];return t}function deflateCoordinates(r,t,i,n){for(let s=0,o=i.length;s<o;++s){const a=i[s];for(let l=0;l<n;++l)r[t++]=a[l]}return t}function deflateCoordinatesArray(r,t,i,n,s){s=s||[];let o=0;for(let a=0,l=i.length;a<l;++a){const h=deflateCoordinates(r,t,i[a],n);s[o++]=h,t=h}return s.length=o,s}function deflateMultiCoordinatesArray(r,t,i,n,s){s=s||[];let o=0;for(let a=0,l=i.length;a<l;++a){const h=deflateCoordinatesArray(r,t,i[a],n,s[o]);h.length===0&&(h[0]=t),s[o++]=h,t=h[h.length-1]}return s.length=o,s}function douglasPeucker(r,t,i,n,s,o,a){const l=(i-t)/n;if(l<3){for(;t<i;t+=n)o[a++]=r[t],o[a++]=r[t+1];return a}const h=new Array(l);h[0]=1,h[l-1]=1;const c=[t,i-n];let u=0;for(;c.length>0;){const d=c.pop(),f=c.pop();let _=0;const m=r[f],y=r[f+1],p=r[d],C=r[d+1];for(let v=f+n;v<d;v+=n){const T=r[v],w=r[v+1],I=squaredSegmentDistance(T,w,m,y,p,C);I>_&&(u=v,_=I)}_>s&&(h[(u-t)/n]=1,f+n<u&&c.push(f,u),u+n<d&&c.push(u,d))}for(let d=0;d<l;++d)h[d]&&(o[a++]=r[t+d*n],o[a++]=r[t+d*n+1]);return a}function douglasPeuckerArray(r,t,i,n,s,o,a,l){for(let h=0,c=i.length;h<c;++h){const u=i[h];a=douglasPeucker(r,t,u,n,s,o,a),l.push(a),t=u}return a}function snap(r,t){return t*Math.round(r/t)}function quantize(r,t,i,n,s,o,a){if(t==i)return a;let l=snap(r[t],s),h=snap(r[t+1],s);t+=n,o[a++]=l,o[a++]=h;let c,u;do if(c=snap(r[t],s),u=snap(r[t+1],s),t+=n,t==i)return o[a++]=c,o[a++]=u,a;while(c==l&&u==h);for(;t<i;){const d=snap(r[t],s),f=snap(r[t+1],s);if(t+=n,d==c&&f==u)continue;const _=c-l,m=u-h,y=d-l,p=f-h;if(_*p==m*y&&(_<0&&y<_||_==y||_>0&&y>_)&&(m<0&&p<m||m==p||m>0&&p>m)){c=d,u=f;continue}o[a++]=c,o[a++]=u,l=c,h=u,c=d,u=f}return o[a++]=c,o[a++]=u,a}function quantizeArray(r,t,i,n,s,o,a,l){for(let h=0,c=i.length;h<c;++h){const u=i[h];a=quantize(r,t,u,n,s,o,a),l.push(a),t=u}return a}function quantizeMultiArray(r,t,i,n,s,o,a,l){for(let h=0,c=i.length;h<c;++h){const u=i[h],d=[];a=quantizeArray(r,t,u,n,s,o,a,d),l.push(d),t=u[u.length-1]}return a}function inflateCoordinates(r,t,i,n,s){s=s!==void 0?s:[];let o=0;for(let a=t;a<i;a+=n)s[o++]=r.slice(a,a+n);return s.length=o,s}function inflateCoordinatesArray(r,t,i,n,s){s=s!==void 0?s:[];let o=0;for(let a=0,l=i.length;a<l;++a){const h=i[a];s[o++]=inflateCoordinates(r,t,h,n,s[o]),t=h}return s.length=o,s}function inflateMultiCoordinatesArray(r,t,i,n,s){s=s!==void 0?s:[];let o=0;for(let a=0,l=i.length;a<l;++a){const h=i[a];s[o++]=h.length===1&&h[0]===t?[]:inflateCoordinatesArray(r,t,h,n,s[o]),t=h[h.length-1]}return s.length=o,s}function linearRing(r,t,i,n){let s=0,o=r[i-n],a=r[i-n+1];for(;t<i;t+=n){const l=r[t],h=r[t+1];s+=a*l-o*h,o=l,a=h}return s/2}function linearRings(r,t,i,n){let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o];s+=linearRing(r,t,l,n),t=l}return s}function linearRingss$1(r,t,i,n){let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o];s+=linearRings(r,t,l,n),t=l[l.length-1]}return s}class LinearRing extends SimpleGeometry$1{constructor(t,i){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,i,n,s){return s<closestSquaredDistanceXY(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,i,n,s))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new LinearRing(i,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,t,this.stride),this.changed()}}const LinearRing$1=LinearRing;class Point extends SimpleGeometry$1{constructor(t,i){super(),this.setCoordinates(t,i)}clone(){const t=new Point(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,s){const o=this.flatCoordinates,a=squaredDistance(t,i,o[0],o[1]);if(a<s){const l=this.stride;for(let h=0;h<l;++h)n[h]=o[h];return n.length=l,a}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return createOrUpdateFromCoordinate(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return containsXY(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,t,this.stride),this.changed()}}const Point$1=Point;function linearRingContainsExtent(r,t,i,n,s){return!forEachCorner(s,function(a){return!linearRingContainsXY(r,t,i,n,a[0],a[1])})}function linearRingContainsXY(r,t,i,n,s,o){let a=0,l=r[i-n],h=r[i-n+1];for(;t<i;t+=n){const c=r[t],u=r[t+1];h<=o?u>o&&(c-l)*(o-h)-(s-l)*(u-h)>0&&a++:u<=o&&(c-l)*(o-h)-(s-l)*(u-h)<0&&a--,l=c,h=u}return a!==0}function linearRingsContainsXY(r,t,i,n,s,o){if(i.length===0||!linearRingContainsXY(r,t,i[0],n,s,o))return!1;for(let a=1,l=i.length;a<l;++a)if(linearRingContainsXY(r,i[a-1],i[a],n,s,o))return!1;return!0}function linearRingssContainsXY(r,t,i,n,s,o){if(i.length===0)return!1;for(let a=0,l=i.length;a<l;++a){const h=i[a];if(linearRingsContainsXY(r,t,h,n,s,o))return!0;t=h[h.length-1]}return!1}function getInteriorPointOfArray(r,t,i,n,s,o,a){let l,h,c,u,d,f,_;const m=s[o+1],y=[];for(let v=0,T=i.length;v<T;++v){const w=i[v];for(u=r[w-n],f=r[w-n+1],l=t;l<w;l+=n)d=r[l],_=r[l+1],(m<=f&&_<=m||f<=m&&m<=_)&&(c=(m-f)/(_-f)*(d-u)+u,y.push(c)),u=d,f=_}let p=NaN,C=-1/0;for(y.sort(ascending),u=y[0],l=1,h=y.length;l<h;++l){d=y[l];const v=Math.abs(d-u);v>C&&(c=(u+d)/2,linearRingsContainsXY(r,t,i,n,c,m)&&(p=c,C=v)),u=d}return isNaN(p)&&(p=s[o]),a?(a.push(p,m,C),a):[p,m,C]}function getInteriorPointsOfMultiArray(r,t,i,n,s){let o=[];for(let a=0,l=i.length;a<l;++a){const h=i[a];o=getInteriorPointOfArray(r,t,h,n,s,2*a,o),t=h[h.length-1]}return o}function forEach(r,t,i,n,s){let o;for(t+=n;t<i;t+=n)if(o=s(r.slice(t-n,t),r.slice(t,t+n)),o)return o;return!1}function intersectsLineString(r,t,i,n,s){const o=extendFlatCoordinates(createEmpty(),r,t,i,n);return intersects$1(s,o)?containsExtent(s,o)||o[0]>=s[0]&&o[2]<=s[2]||o[1]>=s[1]&&o[3]<=s[3]?!0:forEach(r,t,i,n,function(a,l){return intersectsSegment(s,a,l)}):!1}function intersectsLineStringArray(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o){if(intersectsLineString(r,t,i[o],n,s))return!0;t=i[o]}return!1}function intersectsLinearRing(r,t,i,n,s){return!!(intersectsLineString(r,t,i,n,s)||linearRingContainsXY(r,t,i,n,s[0],s[1])||linearRingContainsXY(r,t,i,n,s[0],s[3])||linearRingContainsXY(r,t,i,n,s[2],s[1])||linearRingContainsXY(r,t,i,n,s[2],s[3]))}function intersectsLinearRingArray(r,t,i,n,s){if(!intersectsLinearRing(r,t,i[0],n,s))return!1;if(i.length===1)return!0;for(let o=1,a=i.length;o<a;++o)if(linearRingContainsExtent(r,i[o-1],i[o],n,s)&&!intersectsLineString(r,i[o-1],i[o],n,s))return!1;return!0}function intersectsLinearRingMultiArray(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o];if(intersectsLinearRingArray(r,t,l,n,s))return!0;t=l[l.length-1]}return!1}function coordinates(r,t,i,n){for(;t<i-n;){for(let s=0;s<n;++s){const o=r[t+s];r[t+s]=r[i-n+s],r[i-n+s]=o}t+=n,i-=n}}function linearRingIsClockwise(r,t,i,n){let s=0,o=r[i-n],a=r[i-n+1];for(;t<i;t+=n){const l=r[t],h=r[t+1];s+=(l-o)*(h+a),o=l,a=h}return s===0?void 0:s>0}function linearRingsAreOriented(r,t,i,n,s){s=s!==void 0?s:!1;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=linearRingIsClockwise(r,t,l,n);if(o===0){if(s&&h||!s&&!h)return!1}else if(s&&!h||!s&&h)return!1;t=l}return!0}function linearRingssAreOriented(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o];if(!linearRingsAreOriented(r,t,l,n,s))return!1;l.length&&(t=l[l.length-1])}return!0}function orientLinearRings(r,t,i,n,s){s=s!==void 0?s:!1;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=linearRingIsClockwise(r,t,l,n);(o===0?s&&h||!s&&!h:s&&!h||!s&&h)&&coordinates(r,t,l,n),t=l}return t}function orientLinearRingsArray(r,t,i,n,s){for(let o=0,a=i.length;o<a;++o)t=orientLinearRings(r,t,i[o],n,s);return t}class Polygon extends SimpleGeometry$1{constructor(t,i,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,i!==void 0&&n?(this.setFlatCoordinates(i,t),this.ends_=n):this.setCoordinates(t,i)}appendLinearRing(t){this.flatCoordinates?extend$2(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,n,s){return s<closestSquaredDistanceXY(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,i,n,s))}containsXY(t,i){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,i)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRings(i,0,this.ends_,this.stride,t)):i=this.flatCoordinates,inflateCoordinatesArray(i,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point$1(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new LinearRing$1(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,i=this.flatCoordinates,n=this.ends_,s=[];let o=0;for(let a=0,l=n.length;a<l;++a){const h=n[a],c=new LinearRing$1(i.slice(o,h),t);s.push(c),o=h}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;linearRingsAreOriented(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new Polygon(i,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Polygon$1=Polygon;function fromExtent(r){const t=r[0],i=r[1],n=r[2],s=r[3],o=[t,i,t,s,n,s,n,i,t,i];return new Polygon(o,"XY",[o.length])}const RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Fill{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new Fill({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const Fill$1=Fill;function interpolatePoint(r,t,i,n,s,o,a){let l,h;const c=(i-t)/n;if(c===1)l=t;else if(c===2)l=t,h=s;else if(c!==0){let u=r[t],d=r[t+1],f=0;const _=[0];for(let p=t+n;p<i;p+=n){const C=r[p],v=r[p+1];f+=Math.sqrt((C-u)*(C-u)+(v-d)*(v-d)),_.push(f),u=C,d=v}const m=s*f,y=binarySearch(_,m);y<0?(h=(m-_[-y-2])/(_[-y-1]-_[-y-2]),l=t+(-y-2)*n):l=t+y*n}a=a>1?a:2,o=o||new Array(a);for(let u=0;u<a;++u)o[u]=l===void 0?NaN:h===void 0?r[l+u]:lerp(r[l+u],r[l+n+u],h);return o}function lineStringCoordinateAtM(r,t,i,n,s,o){if(i==t)return null;let a;if(s<r[t+n-1])return o?(a=r.slice(t,t+n),a[n-1]=s,a):null;if(r[i-1]<s)return o?(a=r.slice(i-n,i),a[n-1]=s,a):null;if(s==r[t+n-1])return r.slice(t,t+n);let l=t/n,h=i/n;for(;l<h;){const f=l+h>>1;s<r[(f+1)*n-1]?h=f:l=f+1}const c=r[l*n-1];if(s==c)return r.slice((l-1)*n,(l-1)*n+n);const u=r[(l+1)*n-1],d=(s-c)/(u-c);a=[];for(let f=0;f<n-1;++f)a.push(lerp(r[(l-1)*n+f],r[l*n+f],d));return a.push(s),a}function lineStringsCoordinateAtM(r,t,i,n,s,o,a){if(a)return lineStringCoordinateAtM(r,t,i[i.length-1],n,s,o);let l;if(s<r[n-1])return o?(l=r.slice(0,n),l[n-1]=s,l):null;if(r[r.length-1]<s)return o?(l=r.slice(r.length-n),l[n-1]=s,l):null;for(let h=0,c=i.length;h<c;++h){const u=i[h];if(t!=u){if(s<r[t+n-1])return null;if(s<=r[u-1])return lineStringCoordinateAtM(r,t,u,n,s,!1);t=u}}return null}function lineStringLength(r,t,i,n){let s=r[t],o=r[t+1],a=0;for(let l=t+n;l<i;l+=n){const h=r[l],c=r[l+1];a+=Math.sqrt((h-s)*(h-s)+(c-o)*(c-o)),s=h,o=c}return a}class LineString extends SimpleGeometry$1{constructor(t,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendCoordinate(t){this.flatCoordinates?extend$2(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new LineString(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,s){return s<closestSquaredDistanceXY(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,i,n,s))}forEachSegment(t){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0?i:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,i){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new LineString(i,"XY")}getType(){return"LineString"}intersectsExtent(t){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,t,this.stride),this.changed()}}const LineString$1=LineString;class Stroke{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Stroke({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Stroke$1=Stroke,ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function hasArea(r){return r[0]>0&&r[1]>0}function scale(r,t,i){return i===void 0&&(i=[0,0]),i[0]=r[0]*t+.5|0,i[1]=r[1]*t+.5|0,i}function toSize(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class ImageStyle{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=toSize(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(t){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(t){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=toSize(t)}listenImageChange(t){abstract()}load(){abstract()}unlistenImageChange(t){abstract()}}const ImageStyle$1=ImageStyle,HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$|^hsla?\(.*\)$/i;function asString(r){return typeof r=="string"?r:toString(r)}function fromNamed(r){const t=document.createElement("div");if(t.style.color=r,t.style.color!==""){document.body.appendChild(t);const i=getComputedStyle(t).color;return document.body.removeChild(t),i}return""}const fromString=function(){const t={};let i=0;return function(n){let s;if(t.hasOwnProperty(n))s=t[n];else{if(i>=1024){let o=0;for(const a in t)o++&3||(delete t[a],--i)}s=fromStringInternal_(n),t[n]=s,++i}return s}}();function asArray(r){return Array.isArray(r)?r:fromString(r)}function fromStringInternal_(r){let t,i,n,s,o;if(NAMED_COLOR_RE_.exec(r)&&(r=fromNamed(r)),HEX_COLOR_RE_.exec(r)){const a=r.length-1;let l;a<=4?l=1:l=2;const h=a===4||a===8;t=parseInt(r.substr(1+0*l,l),16),i=parseInt(r.substr(1+1*l,l),16),n=parseInt(r.substr(1+2*l,l),16),h?s=parseInt(r.substr(1+3*l,l),16):s=255,l==1&&(t=(t<<4)+t,i=(i<<4)+i,n=(n<<4)+n,h&&(s=(s<<4)+s)),o=[t,i,n,s/255]}else r.startsWith("rgba(")?(o=r.slice(5,-1).split(",").map(Number),normalize(o)):r.startsWith("rgb(")?(o=r.slice(4,-1).split(",").map(Number),o.push(1),normalize(o)):assert(!1,14);return o}function normalize(r){return r[0]=clamp(r[0]+.5|0,0,255),r[1]=clamp(r[1]+.5|0,0,255),r[2]=clamp(r[2]+.5|0,0,255),r[3]=clamp(r[3],0,1),r}function toString(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let i=r[1];i!=(i|0)&&(i=i+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const s=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+t+","+i+","+n+","+s+")"}function asColorLike(r){return Array.isArray(r)?toString(r):r}function createCanvasContext2D(r,t,i,n){let s;return i&&i.length?s=i.shift():WORKER_OFFSCREEN_CANVAS?s=new OffscreenCanvas(r||300,t||300):s=document.createElement("canvas"),r&&(s.width=r),t&&(s.height=t),s.getContext("2d",n)}function releaseCanvas(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}function replaceNode(r,t){const i=t.parentNode;i&&i.replaceChild(r,t)}function removeNode(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function removeChildren(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function replaceChildren(r,t){const i=r.childNodes;for(let n=0;;++n){const s=i[n],o=t[n];if(!s&&!o)break;if(s!==o){if(!s){r.appendChild(o);continue}if(!o){r.removeChild(s),--n;continue}r.insertBefore(o,s)}}}const CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],getFontParameters=function(r){const t=r.match(fontRegEx);if(!t)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,s=fontRegExMatchIndex.length;n<s;++n){const o=t[n+1];o!==void 0&&(i[fontRegExMatchIndex[n]]=o)}return i.families=i.family.split(/,\s?/),i},defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject$1;let measureContext=null,measureFont;const textHeights={},registerFont=function(){const t="32px ",i=["monospace","serif"],n=i.length,s="wmytzilWMYTZIL@#/&?$%10";let o,a;function l(c,u,d){let f=!0;for(let _=0;_<n;++_){const m=i[_];if(a=measureTextWidth(c+" "+u+" "+t+m,s),d!=m){const y=measureTextWidth(c+" "+u+" "+t+d+","+m,s);f=f&&y!=a}}return!!f}function h(){let c=!0;const u=checkedFonts.getKeys();for(let d=0,f=u.length;d<f;++d){const _=u[d];checkedFonts.get(_)<100&&(l.apply(this,_.split(`
`))?(clear(textHeights),measureContext=null,measureFont=void 0,checkedFonts.set(_,100)):(checkedFonts.set(_,checkedFonts.get(_)+1,!0),c=!1))}c&&(clearInterval(o),o=void 0)}return function(c){const u=getFontParameters(c);if(!u)return;const d=u.families;for(let f=0,_=d.length;f<_;++f){const m=d[f],y=u.style+`
`+u.weight+`
`+m;checkedFonts.get(y)===void 0&&(checkedFonts.set(y,100,!0),l(u.style,u.weight,m)||(checkedFonts.set(y,0,!0),o===void 0&&(o=setInterval(h,32))))}}}(),measureTextHeight=function(){let r;return function(t){let i=textHeights[t];if(i==null){if(WORKER_OFFSCREEN_CANVAS){const n=getFontParameters(t),s=measureText(t,"Žg");i=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),i=r.offsetHeight,document.body.removeChild(r);textHeights[t]=i}return i}}();function measureText(r,t){return measureContext||(measureContext=createCanvasContext2D(1,1)),r!=measureFont&&(measureContext.font=r,measureFont=measureContext.font),measureContext.measureText(t)}function measureTextWidth(r,t){return measureText(r,t).width}function measureAndCacheTextWidth(r,t,i){if(t in i)return i[t];const n=t.split(`
`).reduce((s,o)=>Math.max(s,measureTextWidth(r,o)),0);return i[t]=n,n}function getTextDimensions(r,t){const i=[],n=[],s=[];let o=0,a=0,l=0,h=0;for(let c=0,u=t.length;c<=u;c+=2){const d=t[c];if(d===`
`||c===u){o=Math.max(o,a),s.push(a),a=0,l+=h;continue}const f=t[c+1]||r.font,_=measureTextWidth(f,d);i.push(_),a+=_;const m=measureTextHeight(f);n.push(m),h=Math.max(h,m)}return{width:o,height:l,widths:i,heights:n,lineWidths:s}}function drawImageOrLabel(r,t,i,n,s,o,a,l,h,c,u){r.save(),i!==1&&(r.globalAlpha*=i),t&&r.setTransform.apply(r,t),n.contextInstructions?(r.translate(h,c),r.scale(u[0],u[1]),executeLabelInstructions(n,r)):u[0]<0||u[1]<0?(r.translate(h,c),r.scale(u[0],u[1]),r.drawImage(n,s,o,a,l,0,0,a,l)):r.drawImage(n,s,o,a,l,h,c,a*u[0],l*u[1]),r.restore()}function executeLabelInstructions(r,t){const i=r.contextInstructions;for(let n=0,s=i.length;n<s;n+=2)Array.isArray(i[n+1])?t[i[n]].apply(t,i[n+1]):t[i[n]]=i[n+1]}class RegularShape extends ImageStyle$1{constructor(t){const i=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:i,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),i=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}getAnchor(){const t=this.size_;if(!t)return null;const i=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-i[0]/n[0],t[1]/2+i[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let i=this.canvas_[t];if(!i){const n=this.renderOptions_,s=createCanvasContext2D(n.size*t,n.size*t);this.draw_(n,s,t),i=s.canvas,this.canvas_[t]=i}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return ImageState.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,i,n){if(i===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return i;let s=this.radius_,o=this.radius2_===void 0?s:this.radius2_;if(s<o){const O=s;s=o,o=O}const a=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/a,h=o*Math.sin(l),c=Math.sqrt(o*o-h*h),u=s-c,d=Math.sqrt(h*h+u*u),f=d/h;if(t==="miter"&&f<=n)return f*i;const _=i/2/f,m=i/2*(u/d),p=Math.sqrt((s+_)*(s+_)+m*m)-s;if(this.radius2_===void 0||t==="bevel")return p*2;const C=s*Math.sin(l),v=Math.sqrt(s*s-C*C),T=o-v,I=Math.sqrt(C*C+T*T)/C;if(I<=n){const O=I*i/2-o-s;return 2*Math.max(p,O)}return p*2}createRenderOptions(){let t=defaultLineJoin,i=0,n=null,s=0,o,a=0;this.stroke_&&(o=this.stroke_.getColor(),o===null&&(o=defaultStrokeStyle),o=asColorLike(o),a=this.stroke_.getWidth(),a===void 0&&(a=defaultLineWidth),n=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=defaultLineJoin),i=this.stroke_.getMiterLimit(),i===void 0&&(i=defaultMiterLimit));const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineDash:n,lineDashOffset:s,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,i,n){if(i.scale(n,n),i.translate(t.size/2,t.size/2),this.createPath_(i),this.fill_){let s=this.fill_.getColor();s===null&&(s=defaultFillStyle),i.fillStyle=asColorLike(s),i.fill()}this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let i=this.fill_.getColor(),n=0;if(typeof i=="string"&&(i=asArray(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0){const s=createCanvasContext2D(t.size,t.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(t,s)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let i=this.points_;const n=this.radius_;if(i===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(i*=2);const o=this.angle_-Math.PI/2,a=2*Math.PI/i;for(let l=0;l<i;l++){const h=o+l*a,c=l%2===0?n:s;t.lineTo(c*Math.cos(h),c*Math.sin(h))}t.closePath()}}drawHitDetectionCanvas_(t,i){i.translate(t.size/2,t.size/2),this.createPath_(i),i.fillStyle=defaultFillStyle,i.fill(),this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}}const RegularShape$1=RegularShape;class CircleStyle extends RegularShape$1{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),i=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}setRadius(t){this.radius_=t,this.render()}}const Circle=CircleStyle;class Style{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Style({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(i){return i.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function toFunction(r){let t;if(typeof r=="function")t=r;else{let i;Array.isArray(r)?i=r:(assert(typeof r.getZIndex=="function",41),i=[r]),t=function(){return i}}return t}let defaultStyles=null;function createDefaultStyle(r,t){if(!defaultStyles){const i=new Fill$1({color:"rgba(255,255,255,0.4)"}),n=new Stroke$1({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new Circle({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return defaultStyles}function createEditingStyle(){const r={},t=[255,255,255,1],i=[0,153,255,1],n=3;return r.Polygon=[new Style({fill:new Fill$1({color:[255,255,255,.5]})})],r.MultiPolygon=r.Polygon,r.LineString=[new Style({stroke:new Stroke$1({color:t,width:n+2})}),new Style({stroke:new Stroke$1({color:i,width:n})})],r.MultiLineString=r.LineString,r.Circle=r.Polygon.concat(r.LineString),r.Point=[new Style({image:new Circle({radius:n*2,fill:new Fill$1({color:i}),stroke:new Stroke$1({color:t,width:n/2})}),zIndex:1/0})],r.MultiPoint=r.Point,r.GeometryCollection=r.Polygon.concat(r.LineString,r.Point),r}function defaultGeometryFunction(r){return r.getGeometry()}const Style$1=Style,DEFAULT_FILL_COLOR="#333";class Text{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=toSize(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Fill$1({color:DEFAULT_FILL_COLOR}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=toSize(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Text$1=Text,LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject$1{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const i=Object.assign({},t);typeof t.properties=="object"&&(delete i.properties,Object.assign(i,t.properties)),i[LayerProperty.OPACITY]=t.opacity!==void 0?t.opacity:1,assert(typeof i[LayerProperty.OPACITY]=="number",64),i[LayerProperty.VISIBLE]=t.visible!==void 0?t.visible:!0,i[LayerProperty.Z_INDEX]=t.zIndex,i[LayerProperty.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,i[LayerProperty.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,i[LayerProperty.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,i[LayerProperty.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=i.className!==void 0?i.className:"ol-layer",delete i.className,this.setProperties(i),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const i=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return i.opacity=clamp(Math.round(this.getOpacity()*100)/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=n===void 0&&!i.managed?1/0:n,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i,i}getLayersArray(t){return abstract()}getLayerStatesArray(t){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(LayerProperty.EXTENT,t)}setMaxResolution(t){this.set(LayerProperty.MAX_RESOLUTION,t)}setMinResolution(t){this.set(LayerProperty.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(LayerProperty.MAX_ZOOM,t)}setMinZoom(t){this.set(LayerProperty.MIN_ZOOM,t)}setOpacity(t){assert(typeof t=="number",64),this.set(LayerProperty.OPACITY,t)}setVisible(t){this.set(LayerProperty.VISIBLE,t)}setZIndex(t){this.set(LayerProperty.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const BaseLayer$1=BaseLayer,ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256;function createExtent(r,t,i){return function(n,s,o,a,l){if(!n)return;if(!s&&!t)return n;const h=t?0:o[0]*s,c=t?0:o[1]*s,u=l?l[0]:0,d=l?l[1]:0;let f=r[0]+h/2+u,_=r[2]-h/2+u,m=r[1]+c/2+d,y=r[3]-c/2+d;f>_&&(f=(_+f)/2,_=f),m>y&&(m=(y+m)/2,y=m);let p=clamp(n[0],f,_),C=clamp(n[1],m,y);if(a&&i&&s){const v=30*s;p+=-v*Math.log(1+Math.max(0,f-n[0])/v)+v*Math.log(1+Math.max(0,n[0]-_)/v),C+=-v*Math.log(1+Math.max(0,m-n[1])/v)+v*Math.log(1+Math.max(0,n[1]-y)/v)}return[p,C]}}function none$1(r){return r}function getViewportClampedResolution(r,t,i,n){const s=getWidth(t)/i[0],o=getHeight(t)/i[1];return n?Math.min(r,Math.max(s,o)):Math.min(r,Math.min(s,o))}function getSmoothClampedResolution(r,t,i){let n=Math.min(r,t);const s=50;return n*=Math.log(1+s*Math.max(0,r/t-1))/s+1,i&&(n=Math.max(n,i),n/=Math.log(1+s*Math.max(0,i/r-1))/s+1),clamp(n,i/2,t*2)}function createSnapToResolutions(r,t,i,n){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=r[0],c=r[r.length-1],u=i?getViewportClampedResolution(h,i,a,n):h;if(l)return t?getSmoothClampedResolution(s,u,c):clamp(s,c,u);const d=Math.min(u,s),f=Math.floor(linearFindNearest(r,d,o));return r[f]>u&&f<r.length-1?r[f+1]:r[f]}}}function createSnapToPower(r,t,i,n,s,o){return n=n!==void 0?n:!0,i=i!==void 0?i:0,function(a,l,h,c){if(a!==void 0){const u=s?getViewportClampedResolution(t,s,h,o):t;if(c)return n?getSmoothClampedResolution(a,u,i):clamp(a,i,u);const d=1e-9,f=Math.ceil(Math.log(t/u)/Math.log(r)-d),_=-l*(.5-d)+.5,m=Math.min(u,a),y=Math.floor(Math.log(t/m)/Math.log(r)+_),p=Math.max(f,y),C=t/Math.pow(r,p);return clamp(C,i,u)}}}function createMinMaxResolution(r,t,i,n,s){return i=i!==void 0?i:!0,function(o,a,l,h){if(o!==void 0){const c=n?getViewportClampedResolution(r,n,l,s):r;return!i||!h?clamp(o,t,c):getSmoothClampedResolution(o,c,t)}}}function disable(r){if(r!==void 0)return 0}function none(r){if(r!==void 0)return r}function createSnapToN(r){const t=2*Math.PI/r;return function(i,n){if(n)return i;if(i!==void 0)return i=Math.floor(i/t+.5)*t,i}}function createSnapToZero(r){return r=r||toRadians(5),function(t,i){if(i)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}function easeIn(r){return Math.pow(r,3)}function easeOut(r){return 1-easeIn(1-r)}function inAndOut(r){return 3*r*r-2*r*r*r}function linear(r){return r}const DEFAULT_MIN_ZOOM=0;class View extends BaseObject$1{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&disableCoordinateWarning(),t.center&&(t.center=fromUserCoordinate(t.center,this.projection_)),t.extent&&(t.extent=fromUserExtent(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const i=Object.assign({},t);for(const l in ViewProperty)delete i[l];this.setProperties(i,!0);const n=createResolutionConstraint(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const s=createCenterConstraint(t),o=n.constraint,a=createRotationConstraint(t);this.constraints_={center:s,resolution:o,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let i=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const s=t||[0,0,0,0];i=i||[0,0,0,0];const o=this.getResolution(),a=o/2*(s[3]-i[3]+i[1]-s[1]),l=o/2*(s[0]-i[0]+i[2]-s[2]);this.setCenterInternal([n[0]+a,n[1]-l])}}getUpdatedOptions_(t){const i=this.getProperties();return i.resolution!==void 0?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),Object.assign({},i,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const i=new Array(arguments.length);for(let n=0;n<i.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=fromUserCoordinate(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=fromUserCoordinate(s.anchor,this.getProjection())),i[n]=s}this.animateInternal.apply(this,i)}animateInternal(t){let i=arguments.length,n;i>1&&typeof arguments[i-1]=="function"&&(n=arguments[i-1],--i);let s=0;for(;s<i&&!this.isDef();++s){const u=arguments[s];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(s===i){n&&animationCallback(n,!0);return}let o=Date.now(),a=this.targetCenter_.slice(),l=this.targetResolution_,h=this.targetRotation_;const c=[];for(;s<i;++s){const u=arguments[s],d={start:o,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||inAndOut,callback:n};if(u.center&&(d.sourceCenter=a,d.targetCenter=u.center.slice(),a=d.targetCenter),u.zoom!==void 0?(d.sourceResolution=l,d.targetResolution=this.getResolutionForZoom(u.zoom),l=d.targetResolution):u.resolution&&(d.sourceResolution=l,d.targetResolution=u.resolution,l=d.targetResolution),u.rotation!==void 0){d.sourceRotation=h;const f=modulo(u.rotation-h+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=h+f,h=d.targetRotation}isNoopAnimation(d)?d.complete=!0:o+=d.duration,c.push(d)}this.animations_.push(c),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let t;for(let i=0,n=this.animations_.length;i<n;++i){const s=this.animations_[i];if(s[0].callback&&animationCallback(s[0].callback,!1),!t)for(let o=0,a=s.length;o<a;++o){const l=s[o];if(!l.complete){t=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let i=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let o=!0;for(let a=0,l=s.length;a<l;++a){const h=s[a];if(h.complete)continue;const c=t-h.start;let u=h.duration>0?c/h.duration:1;u>=1?(h.complete=!0,u=1):o=!1;const d=h.easing(u);if(h.sourceCenter){const f=h.sourceCenter[0],_=h.sourceCenter[1],m=h.targetCenter[0],y=h.targetCenter[1];this.nextCenter_=h.targetCenter;const p=f+d*(m-f),C=_+d*(y-_);this.targetCenter_=[p,C]}if(h.sourceResolution&&h.targetResolution){const f=d===1?h.targetResolution:h.sourceResolution+d*(h.targetResolution-h.sourceResolution);if(h.anchor){const _=this.getViewportSize_(this.getRotation()),m=this.constraints_.resolution(f,0,_,!0);this.targetCenter_=this.calculateCenterZoom(m,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const f=d===1?modulo(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+d*(h.targetRotation-h.sourceRotation);if(h.anchor){const _=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(_,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),i=!0,!h.complete)break}if(o){this.animations_[n]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&animationCallback(a,!0)}}this.animations_=this.animations_.filter(Boolean),i&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,i){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-i[0],s[1]-i[1]],rotate$1(n,t-this.getRotation()),add(n,i)),n}calculateCenterZoom(t,i){let n;const s=this.getCenterInternal(),o=this.getResolution();if(s!==void 0&&o!==void 0){const a=i[0]-t*(i[0]-s[0])/o,l=i[1]-t*(i[1]-s[1])/o;n=[a,l]}return n}getViewportSize_(t){const i=this.viewportSize_;if(t){const n=i[0],s=i[1];return[Math.abs(n*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(s*Math.cos(t))]}return i}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&toUserCoordinate(t,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const i=this.calculateExtentInternal(t);return toUserExtent(i,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const i=this.getCenterInternal();assert(i,1);const n=this.getResolution();assert(n!==void 0,2);const s=this.getRotation();return assert(s!==void 0,3),getForViewAndSize(i,n,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,i){return this.getResolutionForExtentInternal(fromUserExtent(t,this.getProjection()),i)}getResolutionForExtentInternal(t,i){i=i||this.getViewportSizeMinusPadding_();const n=getWidth(t)/i[0],s=getHeight(t)/i[1];return Math.max(n,s)}getResolutionForValueFunction(t){t=t||2;const i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/Math.log(t);return function(o){return i/Math.pow(t,o*s)}}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(t){const i=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,o=Math.log(n/s)/i;return function(a){return Math.log(n/a)/i/o}}getViewportSizeMinusPadding_(t){let i=this.getViewportSize_(t);const n=this.padding_;return n&&(i=[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]),i}getState(){const t=this.getProjection(),i=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const o=this.padding_;if(o){const a=this.getViewportSizeMinusPadding_();s=calculateCenterOn(s,this.getViewportSize_(),[a[0]/2+o[3],a[1]/2+o[0]],i,n)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:i,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const i=this.getResolution();return i!==void 0&&(t=this.getZoomForResolution(i)),t}getZoomForResolution(t){let i=this.minZoom_||0,n,s;if(this.resolutions_){const o=linearFindNearest(this.resolutions_,t,1);i=o,n=this.resolutions_[o],o==this.resolutions_.length-1?s=2:s=n/this.resolutions_[o+1]}else n=this.maxResolution_,s=this.zoomFactor_;return i+Math.log(n/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const i=clamp(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,clamp(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,i){let n;if(assert(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){assert(!isEmpty(t),25);const s=fromUserExtent(t,this.getProjection());n=fromExtent(s)}else if(t.getType()==="Circle"){const s=fromUserExtent(t.getExtent(),this.getProjection());n=fromExtent(s),n.rotate(this.getRotation(),getCenter(s))}else n=t;this.fitInternal(n,i)}rotatedExtentForGeometry(t){const i=this.getRotation(),n=Math.cos(i),s=Math.sin(-i),o=t.getFlatCoordinates(),a=t.getStride();let l=1/0,h=1/0,c=-1/0,u=-1/0;for(let d=0,f=o.length;d<f;d+=a){const _=o[d]*n-o[d+1]*s,m=o[d]*s+o[d+1]*n;l=Math.min(l,_),h=Math.min(h,m),c=Math.max(c,_),u=Math.max(u,m)}return[l,h,c,u]}fitInternal(t,i){i=i||{};let n=i.size;n||(n=this.getViewportSizeMinusPadding_());const s=i.padding!==void 0?i.padding:[0,0,0,0],o=i.nearest!==void 0?i.nearest:!1;let a;i.minResolution!==void 0?a=i.minResolution:i.maxZoom!==void 0?a=this.getResolutionForZoom(i.maxZoom):a=0;const l=this.rotatedExtentForGeometry(t);let h=this.getResolutionForExtentInternal(l,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);h=isNaN(h)?a:Math.max(h,a),h=this.getConstrainedResolution(h,o?0:1);const c=this.getRotation(),u=Math.sin(c),d=Math.cos(c),f=getCenter(l);f[0]+=(s[1]-s[3])/2*h,f[1]+=(s[0]-s[2])/2*h;const _=f[0]*d-f[1]*u,m=f[1]*d+f[0]*u,y=this.getConstrainedCenter([_,m],h),p=i.callback?i.callback:VOID;i.duration!==void 0?this.animateInternal({resolution:h,center:y,duration:i.duration,easing:i.easing},p):(this.targetResolution_=h,this.targetCenter_=y,this.applyTargetState_(!1,!0),animationCallback(p,!0))}centerOn(t,i,n){this.centerOnInternal(fromUserCoordinate(t,this.getProjection()),i,n)}centerOnInternal(t,i,n){this.setCenterInternal(calculateCenterOn(t,i,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,i,n,s){let o;const a=this.padding_;if(a&&t){const l=this.getViewportSizeMinusPadding_(-n),h=calculateCenterOn(t,s,[l[0]/2+a[3],l[1]/2+a[0]],i,n);o=[t[0]-h[0],t[1]-h[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const i=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([i[0]+t[0],i[1]+t[1]])}adjustCenterInternal(t){const i=this.targetCenter_;this.setCenterInternal([i[0]+t[0],i[1]+t[1]])}adjustResolution(t,i){i=i&&fromUserCoordinate(i,this.getProjection()),this.adjustResolutionInternal(t,i)}adjustResolutionInternal(t,i){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,s,n);i&&(this.targetCenter_=this.calculateCenterZoom(o,i)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,i){this.adjustResolution(Math.pow(this.zoomFactor_,-t),i)}adjustRotation(t,i){i&&(i=fromUserCoordinate(i,this.getProjection())),this.adjustRotationInternal(t,i)}adjustRotationInternal(t,i){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,n);i&&(this.targetCenter_=this.calculateCenterRotate(s,i)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&fromUserCoordinate(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,i){return this.hints_[t]+=i,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,i){const n=this.getAnimating()||this.getInteracting()||i,s=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,o,n),l=this.constraints_.center(this.targetCenter_,a,o,n,this.calculateCenterShift(this.targetCenter_,a,s,o));this.get(ViewProperty.ROTATION)!==s&&this.set(ViewProperty.ROTATION,s),this.get(ViewProperty.RESOLUTION)!==a&&(this.set(ViewProperty.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),l))&&this.set(ViewProperty.CENTER,l),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,i,n){t=t!==void 0?t:200;const s=i||0,o=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(o),l=this.constraints_.resolution(this.targetResolution_,s,a),h=this.constraints_.center(this.targetCenter_,l,a,!1,this.calculateCenterShift(this.targetCenter_,l,o,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=o,this.targetCenter_=h,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==o||!this.getCenterInternal()||!equals(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:h,resolution:l,duration:t,easing:easeOut,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(t,i,n){n=n&&fromUserCoordinate(n,this.getProjection()),this.endInteractionInternal(t,i,n)}endInteractionInternal(t,i,n){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(t,i,n))}getConstrainedCenter(t,i){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,i||this.getResolution(),n)}getConstrainedZoom(t,i){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,i))}getConstrainedResolution(t,i){i=i||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,i,n)}}function animationCallback(r,t){setTimeout(function(){r(t)},0)}function createCenterConstraint(r){if(r.extent!==void 0){const i=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return createExtent(r.extent,r.constrainOnlyCenter,i)}const t=createProjection(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const i=t.getExtent().slice();return i[0]=-1/0,i[2]=1/0,createExtent(i,!1,!1)}return none$1}function createResolutionConstraint(r){let t,i,n,a=r.minZoom!==void 0?r.minZoom:DEFAULT_MIN_ZOOM,l=r.maxZoom!==void 0?r.maxZoom:28;const h=r.zoomFactor!==void 0?r.zoomFactor:2,c=r.multiWorld!==void 0?r.multiWorld:!1,u=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,d=r.showFullExtent!==void 0?r.showFullExtent:!1,f=createProjection(r.projection,"EPSG:3857"),_=f.getExtent();let m=r.constrainOnlyCenter,y=r.extent;if(!c&&!y&&f.isGlobal()&&(m=!1,y=_),r.resolutions!==void 0){const p=r.resolutions;i=p[a],n=p[l]!==void 0?p[l]:p[p.length-1],r.constrainResolution?t=createSnapToResolutions(p,u,!m&&y,d):t=createMinMaxResolution(i,n,u,!m&&y,d)}else{const C=(_?Math.max(getWidth(_),getHeight(_)):360*METERS_PER_UNIT$1.degrees/f.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),v=C/Math.pow(2,28-DEFAULT_MIN_ZOOM);i=r.maxResolution,i!==void 0?a=0:i=C/Math.pow(h,a),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=i/Math.pow(h,l):n=C/Math.pow(h,l):n=v),l=a+Math.floor(Math.log(i/n)/Math.log(h)),n=i/Math.pow(h,l-a),r.constrainResolution?t=createSnapToPower(h,i,n,u,!m&&y,d):t=createMinMaxResolution(i,n,u,!m&&y,d)}return{constraint:t,maxResolution:i,minResolution:n,minZoom:a,zoomFactor:h}}function createRotationConstraint(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const i=r.constrainRotation;return i===void 0||i===!0?createSnapToZero():i===!1?none:typeof i=="number"?createSnapToN(i):none}return disable}function isNoopAnimation(r){return!(r.sourceCenter&&r.targetCenter&&!equals(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function calculateCenterOn(r,t,i,n,s){const o=Math.cos(-s);let a=Math.sin(-s),l=r[0]*o-r[1]*a,h=r[1]*o+r[0]*a;l+=(t[0]/2-i[0])*n,h+=(i[1]-t[1]/2)*n,a=-a;const c=l*o-h*a,u=h*o+l*a;return[c,u]}const View$1=View;class Layer extends BaseLayer$1{constructor(t){const i=Object.assign({},t);delete i.source,super(i),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=listen(t,EventType.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let i;t instanceof View$1?i={viewState:t.getState(),extent:t.calculateExtent()}:i=t;const n=this.getExtent();return this.getVisible()&&inView(this.getLayerState(),i.viewState)&&(!n||intersects$1(n,i.extent))}getAttributions(t){if(!this.isVisible(t))return[];let i;const n=this.getSource();if(n&&(i=n.getAttributions()),!i)return[];const s=t instanceof View$1?t.getViewStateAndExtent():t;let o=i(s);return Array.isArray(o)||(o=[o]),o}render(t,i){const n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,i)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(LayerProperty.MAP,t)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(t){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=listen(t,RenderEventType.PRECOMPOSE,function(i){const s=i.frameState.layerStatesArray,o=this.getLayerState(!1);assert(!s.some(function(a){return a.layer===o.layer}),67),s.push(o)},this),this.mapRenderKey_=listen(this,EventType.CHANGE,t.render,t),this.changed())}setSource(t){this.set(LayerProperty.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function inView(r,t){if(!r.visible)return!1;const i=t.resolution;if(i<r.minResolution||i>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}const Layer$1=Layer;function quickselect(r,t,i,n,s){quickselectStep(r,t,i||0,n||r.length-1,s||defaultCompare)}function quickselectStep(r,t,i,n,s){for(;n>i;){if(n-i>600){var o=n-i+1,a=t-i+1,l=Math.log(o),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(o-h)/o)*(a-o/2<0?-1:1),u=Math.max(i,Math.floor(t-a*h/o+c)),d=Math.min(n,Math.floor(t+(o-a)*h/o+c));quickselectStep(r,t,u,d,s)}var f=r[t],_=i,m=n;for(swap(r,i,t),s(r[n],f)>0&&swap(r,i,n);_<m;){for(swap(r,_,m),_++,m--;s(r[_],f)<0;)_++;for(;s(r[m],f)>0;)m--}s(r[i],f)===0?swap(r,i,m):(m++,swap(r,m,n)),m<=t&&(i=m+1),t<=m&&(n=m-1)}}function swap(r,t,i){var n=r[t];r[t]=r[i],r[i]=n}function defaultCompare(r,t){return r<t?-1:r>t?1:0}let RBush$2=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!intersects(t,i))return n;const s=this.toBBox,o=[];for(;i;){for(let a=0;a<i.children.length;a++){const l=i.children[a],h=i.leaf?s(l):l;intersects(t,h)&&(i.leaf?n.push(l):contains(t,h)?this._all(l,n):o.push(l))}i=o.pop()}return n}collides(t){let i=this.data;if(!intersects(t,i))return!1;const n=[];for(;i;){for(let s=0;s<i.children.length;s++){const o=i.children[s],a=i.leaf?this.toBBox(o):o;if(intersects(t,a)){if(i.leaf||contains(t,a))return!0;n.push(o)}}i=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(t,i){if(!t)return this;let n=this.data;const s=this.toBBox(t),o=[],a=[];let l,h,c;for(;n||o.length;){if(n||(n=o.pop(),h=o[o.length-1],l=a.pop(),c=!0),n.leaf){const u=findItem(t,n.children,i);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}!c&&!n.leaf&&contains(n,s)?(o.push(n),a.push(l),l=0,h=n,n=n.children[0]):h?(l++,n=h.children[l],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,s){const o=n-i+1;let a=this._maxEntries,l;if(o<=a)return l=createNode(t.slice(i,n+1)),calcBBox(l,this.toBBox),l;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),l=createNode([]),l.leaf=!1,l.height=s;const h=Math.ceil(o/a),c=h*Math.ceil(Math.sqrt(a));multiSelect(t,i,n,c,this.compareMinX);for(let u=i;u<=n;u+=c){const d=Math.min(u+c-1,n);multiSelect(t,u,d,h,this.compareMinY);for(let f=u;f<=d;f+=h){const _=Math.min(f+h-1,d);l.children.push(this._build(t,f,_,s-1))}}return calcBBox(l,this.toBBox),l}_chooseSubtree(t,i,n,s){for(;s.push(i),!(i.leaf||s.length-1===n);){let o=1/0,a=1/0,l;for(let h=0;h<i.children.length;h++){const c=i.children[h],u=bboxArea(c),d=enlargedArea(t,c)-u;d<a?(a=d,o=u<o?u:o,l=c):d===a&&u<o&&(o=u,l=c)}i=l||i.children[0]}return i}_insert(t,i,n){const s=n?t:this.toBBox(t),o=[],a=this._chooseSubtree(s,this.data,i,o);for(a.children.push(t),extend(a,s);i>=0&&o[i].children.length>this._maxEntries;)this._split(o,i),i--;this._adjustParentBBoxes(s,o,i)}_split(t,i){const n=t[i],s=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,s);const a=this._chooseSplitIndex(n,o,s),l=createNode(n.children.splice(a,n.children.length-a));l.height=n.height,l.leaf=n.leaf,calcBBox(n,this.toBBox),calcBBox(l,this.toBBox),i?t[i-1].children.push(l):this._splitRoot(n,l)}_splitRoot(t,i){this.data=createNode([t,i]),this.data.height=t.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let s,o=1/0,a=1/0;for(let l=i;l<=n-i;l++){const h=distBBox(t,0,l,this.toBBox),c=distBBox(t,l,n,this.toBBox),u=intersectionArea(h,c),d=bboxArea(h)+bboxArea(c);u<o?(o=u,s=l,a=d<a?d:a):u===o&&d<a&&(a=d,s=l)}return s||n-i}_chooseSplitAxis(t,i,n){const s=t.leaf?this.compareMinX:compareNodeMinX,o=t.leaf?this.compareMinY:compareNodeMinY,a=this._allDistMargin(t,i,n,s),l=this._allDistMargin(t,i,n,o);a<l&&t.children.sort(s)}_allDistMargin(t,i,n,s){t.children.sort(s);const o=this.toBBox,a=distBBox(t,0,i,o),l=distBBox(t,n-i,n,o);let h=bboxMargin(a)+bboxMargin(l);for(let c=i;c<n-i;c++){const u=t.children[c];extend(a,t.leaf?o(u):u),h+=bboxMargin(a)}for(let c=n-i-1;c>=i;c--){const u=t.children[c];extend(l,t.leaf?o(u):u),h+=bboxMargin(l)}return h}_adjustParentBBoxes(t,i,n){for(let s=n;s>=0;s--)extend(i[s],t)}_condense(t){for(let i=t.length-1,n;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children,n.splice(n.indexOf(t[i]),1)):this.clear():calcBBox(t[i],this.toBBox)}};function findItem(r,t,i){if(!i)return t.indexOf(r);for(let n=0;n<t.length;n++)if(i(r,t[n]))return n;return-1}function calcBBox(r,t){distBBox(r,0,r.children.length,t,r)}function distBBox(r,t,i,n,s){s||(s=createNode(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let o=t;o<i;o++){const a=r.children[o];extend(s,r.leaf?n(a):a)}return s}function extend(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function compareNodeMinX(r,t){return r.minX-t.minX}function compareNodeMinY(r,t){return r.minY-t.minY}function bboxArea(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function bboxMargin(r){return r.maxX-r.minX+(r.maxY-r.minY)}function enlargedArea(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function intersectionArea(r,t){const i=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),s=Math.min(r.maxX,t.maxX),o=Math.min(r.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,o-n)}function contains(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function intersects(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function createNode(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(r,t,i,n,s){const o=[t,i];for(;o.length;){if(i=o.pop(),t=o.pop(),i-t<=n)continue;const a=t+Math.ceil((i-t)/n/2)*n;quickselect(r,a,t,i,s),o.push(t,a,a,i)}}class IconImageCache{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const i in this.cache_){const n=this.cache_[i];!(t++&3)&&!n.hasListener()&&(delete this.cache_[i],--this.cacheSize_)}}}get(t,i,n){const s=getKey$1(t,i,n);return s in this.cache_?this.cache_[s]:null}set(t,i,n,s){const o=getKey$1(t,i,n);this.cache_[o]=s,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function getKey$1(r,t,i){const n=i?asString(i):"null";return t+":"+r+":"+n}const shared=new IconImageCache;function listenImage(r,t,i){const n=r;let s=!0,o=!1,a=!1;const l=[listenOnce(n,EventType.LOAD,function(){a=!0,o||t()})];return n.src&&IMAGE_DECODE?(o=!0,n.decode().then(function(){s&&t()}).catch(function(h){s&&(a?t():i())})):l.push(listenOnce(n,EventType.ERROR,i)),function(){s=!1,l.forEach(unlistenByKey)}}let taintedTestContext=null;class IconImage extends EventTarget{constructor(t,i,n,s,o,a){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=a,this.unlisten_=null,this.imageState_=o,this.size_=n,this.src_=i,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],i=this.size_[1],n=createCanvasContext2D(t,i);n.fillRect(0,0,t,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ImageState.LOADED)return;const i=this.image_,n=document.createElement("canvas");n.width=Math.ceil(i.width*t),n.height=Math.ceil(i.height*t);const s=n.getContext("2d");s.scale(t,t),s.drawImage(i,0,0),s.globalCompositeOperation="multiply",s.fillStyle=asString(this.color_),s.fillRect(0,0,n.width/t,n.height/t),s.globalCompositeOperation="destination-in",s.drawImage(i,0,0),this.canvas_[t]=n}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function get(r,t,i,n,s,o){let a=shared.get(t,n,o);return a||(a=new IconImage(r,t,i,n,s,o),shared.set(t,n,o,a)),a}class Icon extends ImageStyle$1{constructor(t){t=t||{};const i=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:i,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let l=t.src;assert(!(l!==void 0&&a),4),assert(!a||a&&this.imgSize_,5),(l===void 0||l.length===0)&&a&&(l=a.src||getUid(a)),assert(l!==void 0&&l.length>0,6),assert(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),69);const h=t.src!==void 0?ImageState.IDLE:ImageState.LOADED;if(this.color_=t.color!==void 0?asArray(t.color):null,this.iconImage_=get(a,l,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,h,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.width_=t.width,this.height_=t.height,this.width_!==void 0||this.height_!==void 0){const c=this.getImage(1),u=()=>{this.updateScaleFromWidthAndHeight(this.width_,this.height_)};c.width>0?this.updateScaleFromWidthAndHeight(this.width_,this.height_):c.addEventListener("load",u)}}clone(){let t=this.getScale();return t=Array.isArray(t)?t.slice():t,(this.width_!==void 0||this.height_!==void 0)&&(t=void 0),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode(),width:this.width_,height:this.height_})}updateScaleFromWidthAndHeight(t,i){const n=this.getImage(1);t!==void 0&&i!==void 0?super.setScale([t/n.width,i/n.height]):t!==void 0?super.setScale([t/n.width,t/n.width]):i!==void 0?super.setScale([i/n.height,i/n.height]):super.setScale([1,1])}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const i=this.getDisplacement(),n=this.getScaleArray();return[t[0]-i[0]/n[0],t[1]+i[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),n=this.iconImage_.getSize();if(!i||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-i[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-i[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){return this.width_}getHeight(){return this.height_}setWidth(t){this.width_=t,this.updateScaleFromWidthAndHeight(t,this.height_)}setHeight(t){this.height_=t,this.updateScaleFromWidthAndHeight(this.width_,t)}setScale(t){super.setScale(t);const i=this.getImage(1);if(i){const n=Array.isArray(t)?t[0]:t;n!==void 0&&(this.width_=n*i.width);const s=Array.isArray(t)?t[1]:t;s!==void 0&&(this.height_=s*i.height)}}listenImageChange(t){this.iconImage_.addEventListener(EventType.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(EventType.CHANGE,t)}}const Icon$1=Icon;function toStyle(r){return new Style$1({fill:getFill(r,""),stroke:getStroke(r,""),text:getText(r),image:getImage(r)})}function getFill(r,t){const i=r[t+"fill-color"];if(i)return new Fill$1({color:i})}function getStroke(r,t){const i=r[t+"stroke-width"],n=r[t+"stroke-color"];if(!(!i&&!n))return new Stroke$1({width:i,color:n,lineCap:r[t+"stroke-line-cap"],lineJoin:r[t+"stroke-line-join"],lineDash:r[t+"stroke-line-dash"],lineDashOffset:r[t+"stroke-line-dash-offset"],miterLimit:r[t+"stroke-miter-limit"]})}function getText(r){const t=r["text-value"];return t?new Text$1({text:t,font:r["text-font"],maxAngle:r["text-max-angle"],offsetX:r["text-offset-x"],offsetY:r["text-offset-y"],overflow:r["text-overflow"],placement:r["text-placement"],repeat:r["text-repeat"],scale:r["text-scale"],rotateWithView:r["text-rotate-with-view"],rotation:r["text-rotation"],textAlign:r["text-align"],justify:r["text-justify"],textBaseline:r["text-baseline"],padding:r["text-padding"],fill:getFill(r,"text-"),backgroundFill:getFill(r,"text-background-"),stroke:getStroke(r,"text-"),backgroundStroke:getStroke(r,"text-background-")}):void 0}function getImage(r){const t=r["icon-src"],i=r["icon-img"];if(t||i)return new Icon$1({src:t,img:i,imgSize:r["icon-img-size"],anchor:r["icon-anchor"],anchorOrigin:r["icon-anchor-origin"],anchorXUnits:r["icon-anchor-x-units"],anchorYUnits:r["icon-anchor-y-units"],color:r["icon-color"],crossOrigin:r["icon-cross-origin"],offset:r["icon-offset"],displacement:r["icon-displacement"],opacity:r["icon-opacity"],scale:r["icon-scale"],rotation:r["icon-rotation"],rotateWithView:r["icon-rotate-with-view"],size:r["icon-size"],declutterMode:r["icon-declutter-mode"]});const n=r["shape-points"];if(n){const o="shape-";return new RegularShape$1({points:n,fill:getFill(r,o),stroke:getStroke(r,o),radius:r["shape-radius"],radius1:r["shape-radius1"],radius2:r["shape-radius2"],angle:r["shape-angle"],displacement:r["shape-displacement"],rotation:r["shape-rotation"],rotateWithView:r["shape-rotate-with-view"],scale:r["shape-scale"],declutterMode:r["shape-declutter-mode"]})}const s=r["circle-radius"];if(s){const o="circle-";return new Circle({radius:s,fill:getFill(r,o),stroke:getStroke(r,o),displacement:r["circle-displacement"],scale:r["circle-scale"],rotation:r["circle-rotation"],rotateWithView:r["circle-rotate-with-view"],declutterMode:r["circle-declutter-mode"]})}}const Property$1={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer$1{constructor(t){t=t||{};const i=Object.assign({},t);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,super(i),this.declutter_=t.declutter!==void 0?t.declutter:!1,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property$1.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new RBush$2(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(Property$1.RENDER_ORDER,t)}setStyle(t){let i;if(t===void 0)i=createDefaultStyle;else if(t===null)i=null;else if(typeof t=="function")i=t;else if(t instanceof Style$1)i=t;else if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let o=0;o<n;++o){const a=t[o];a instanceof Style$1?s[o]=a:s[o]=toStyle(a)}i=s}else i=toStyle(t);this.style_=i,this.styleFunction_=t===null?void 0:toFunction(this.style_),this.changed()}}const BaseVectorLayer$1=BaseVectorLayer,Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],CanvasInstruction=Instruction;class VectorContext{drawCustom(t,i,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,i){}drawFeature(t,i){}drawGeometryCollection(t,i){}drawLineString(t,i){}drawMultiLineString(t,i){}drawMultiPoint(t,i){}drawMultiPolygon(t,i){}drawPoint(t,i){}drawPolygon(t,i){}drawText(t,i){}setFillStrokeStyle(t,i){}setImageStyle(t,i){}setTextStyle(t,i){}}const VectorContext$1=VectorContext;class CanvasBuilder extends VectorContext$1{constructor(t,i,n,s){super(),this.tolerance=t,this.maxExtent=i,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const i=this.pixelRatio;return i==1?t:t.map(function(n){return n*i})}appendFlatPointCoordinates(t,i){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,o=this.coordinates;let a=o.length;for(let l=0,h=t.length;l<h;l+=i)s[0]=t[l],s[1]=t[l+1],containsCoordinate(n,s)&&(o[a++]=s[0],o[a++]=s[1]);return a}appendFlatLineCoordinates(t,i,n,s,o,a){const l=this.coordinates;let h=l.length;const c=this.getBufferedMaxExtent();a&&(i+=s);let u=t[i],d=t[i+1];const f=this.tmpCoordinate_;let _=!0,m,y,p;for(m=i+s;m<n;m+=s)f[0]=t[m],f[1]=t[m+1],p=coordinateRelationship(c,f),p!==y?(_&&(l[h++]=u,l[h++]=d,_=!1),l[h++]=f[0],l[h++]=f[1]):p===Relationship.INTERSECTING?(l[h++]=f[0],l[h++]=f[1],_=!1):_=!0,u=f[0],d=f[1],y=p;return(o&&_||m===i+s)&&(l[h++]=u,l[h++]=d),h}drawCustomCoordinates_(t,i,n,s,o){for(let a=0,l=n.length;a<l;++a){const h=n[a],c=this.appendFlatLineCoordinates(t,i,h,s,!1,!1);o.push(c),i=h}return i}drawCustom(t,i,n,s){this.beginGeometry(t,i);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,f;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const _=t.getEndss();f=0;for(let m=0,y=_.length;m<y;++m){const p=[];f=this.drawCustomCoordinates_(h,f,_[m],a,p),d.push(p)}this.instructions.push([CanvasInstruction.CUSTOM,l,d,t,n,inflateMultiCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,d,t,s||n,inflateMultiCoordinatesArray]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([CanvasInstruction.CUSTOM,l,u,t,n,inflateCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,u,t,s||n,inflateCoordinatesArray]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([CanvasInstruction.CUSTOM,l,c,t,n,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,c,t,s||n,inflateCoordinates]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([CanvasInstruction.CUSTOM,l,c,t,n,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,c,t,s||n,inflateCoordinates]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([CanvasInstruction.CUSTOM,l,c,t,n]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,c,t,s||n]);break}this.endGeometry(i)}beginGeometry(t,i){this.beginGeometryInstruction1_=[CanvasInstruction.BEGIN_GEOMETRY,i,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[CanvasInstruction.BEGIN_GEOMETRY,i,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let i;const n=t.length;let s,o,a=-1;for(i=0;i<n;++i)s=t[i],o=s[0],o==CanvasInstruction.END_GEOMETRY?a=i:o==CanvasInstruction.BEGIN_GEOMETRY&&(s[2]=i,reverseSubArray(this.hitDetectionInstructions,a,i),a=-1)}setFillStrokeStyle(t,i){const n=this.state;if(t){const s=t.getColor();n.fillStyle=asColorLike(s||defaultFillStyle)}else n.fillStyle=void 0;if(i){const s=i.getColor();n.strokeStyle=asColorLike(s||defaultStrokeStyle);const o=i.getLineCap();n.lineCap=o!==void 0?o:defaultLineCap;const a=i.getLineDash();n.lineDash=a?a.slice():defaultLineDash;const l=i.getLineDashOffset();n.lineDashOffset=l||defaultLineDashOffset;const h=i.getLineJoin();n.lineJoin=h!==void 0?h:defaultLineJoin;const c=i.getWidth();n.lineWidth=c!==void 0?c:defaultLineWidth;const u=i.getMiterLimit();n.miterLimit=u!==void 0?u:defaultMiterLimit,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const i=t.fillStyle,n=[CanvasInstruction.SET_FILL_STYLE,i];return typeof i!="string"&&n.push(!0),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[CanvasInstruction.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,i){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(i.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,i){const n=t.strokeStyle,s=t.lineCap,o=t.lineDash,a=t.lineDashOffset,l=t.lineJoin,h=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||o!=t.currentLineDash&&!equals$2(t.currentLineDash,o)||t.currentLineDashOffset!=a||t.currentLineJoin!=l||t.currentLineWidth!=h||t.currentMiterLimit!=c)&&(n!==void 0&&i.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=o,t.currentLineDashOffset=a,t.currentLineJoin=l,t.currentLineWidth=h,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const i=[CanvasInstruction.END_GEOMETRY,t];this.instructions.push(i),this.hitDetectionInstructions.push(i)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Builder=CanvasBuilder;class CanvasImageBuilder extends Builder{constructor(t,i,n,s){super(t,i,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,i){if(!this.image_)return;this.beginGeometry(t,i);const n=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,s);this.instructions.push([CanvasInstruction.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}drawMultiPoint(t,i){if(!this.image_)return;this.beginGeometry(t,i);const n=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,s);this.instructions.push([CanvasInstruction.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,i){const n=t.getAnchor(),s=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=i}}const ImageBuilder=CanvasImageBuilder;class CanvasLineStringBuilder extends Builder{constructor(t,i,n,s){super(t,i,n,s)}drawFlatCoordinates_(t,i,n,s){const o=this.coordinates.length,a=this.appendFlatLineCoordinates(t,i,n,s,!1,!1),l=[CanvasInstruction.MOVE_TO_LINE_TO,o,a];return this.instructions.push(l),this.hitDetectionInstructions.push(l),n}drawLineString(t,i){const n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}drawMultiLineString(t,i){const n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],beginPathInstruction);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(beginPathInstruction)}}const LineStringBuilder=CanvasLineStringBuilder;class CanvasPolygonBuilder extends Builder{constructor(t,i,n,s){super(t,i,n,s)}drawFlatCoordinatess_(t,i,n,s){const o=this.state,a=o.fillStyle!==void 0,l=o.strokeStyle!==void 0,h=n.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let c=0;c<h;++c){const u=n[c],d=this.coordinates.length,f=this.appendFlatLineCoordinates(t,i,u,s,!0,!l),_=[CanvasInstruction.MOVE_TO_LINE_TO,d,f];this.instructions.push(_),this.hitDetectionInstructions.push(_),l&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),i=u}return a&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),l&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),i}drawCircle(t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[CanvasInstruction.CIRCLE,h];this.instructions.push(beginPathInstruction,c),this.hitDetectionInstructions.push(beginPathInstruction,c),n.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),n.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(i)}drawPolygon(t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(i)}drawMultiPolygon(t,i){const n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(i)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const i=this.coordinates;for(let n=0,s=i.length;n<s;++n)i[n]=snap(i[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const PolygonBuilder=CanvasPolygonBuilder;function lineChunk(r,t,i,n,s){const o=[];let a=i,l=0,h=t.slice(i,2);for(;l<r&&a+s<n;){const[c,u]=h.slice(-2),d=t[a+s],f=t[a+s+1],_=Math.sqrt((d-c)*(d-c)+(f-u)*(f-u));if(l+=_,l>=r){const m=(r-l+_)/_,y=lerp(c,d,m),p=lerp(u,f,m);h.push(y,p),o.push(h),h=[y,p],l==r&&(a+=s),l=0}else if(l<r)h.push(t[a+s],t[a+s+1]),a+=s;else{const m=_-l,y=lerp(c,d,m/_),p=lerp(u,f,m/_);h.push(y,p),o.push(h),h=[y,p],l=0,a+=s}}return l>0&&o.push(h),o}function matchingChunk(r,t,i,n,s){let o=i,a=i,l=0,h=0,c=i,u,d,f,_,m,y,p,C,v,T;for(d=i;d<n;d+=s){const w=t[d],I=t[d+1];m!==void 0&&(v=w-m,T=I-y,_=Math.sqrt(v*v+T*T),p!==void 0&&(h+=f,u=Math.acos((p*v+C*T)/(f*_)),u>r&&(h>l&&(l=h,o=c,a=d),h=0,c=d-s)),f=_,p=v,C=T),m=w,y=I}return h+=_,h>l?[c,d]:[o,a]}const TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends Builder{constructor(t,i,n,s){super(t,i,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,i){const n=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!s)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!intersects$1(this.getBufferedMaxExtent(),t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const y=t.getEndss();d=[];for(let p=0,C=y.length;p<C;++p)d.push(y[p][0])}this.beginGeometry(t,i);const f=o.repeat,_=f?void 0:o.textAlign;let m=0;for(let y=0,p=d.length;y<p;++y){let C;f?C=lineChunk(f*this.resolution,c,m,d[y],u):C=[c.slice(m,d[y])];for(let v=0,T=C.length;v<T;++v){const w=C[v];let I=0,O=w.length;if(_==null){const k=matchingChunk(o.maxAngle,w,0,w.length,2);I=k[0],O=k[1]}for(let k=I;k<O;k+=u)a.push(w[k],w[k+1]);const $=a.length;m=d[y],this.drawChars_(l,$),l=$}}this.endGeometry(i)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const p=t.getFlatInteriorPoints();c=[];for(let C=0,v=p.length;C<v;C+=3)o.overflow||d.push(p[C+2]/this.resolution),c.push(p[C],p[C+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(d&&(f-l)/2!==c.length/u){let p=l/2;d=d.filter((C,v)=>{const T=a[(p+v)*2]===c[v*u]&&a[(p+v)*2+1]===c[v*u+1];return T||--p,T})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,i);let _=o.padding;if(_!=defaultPadding&&(o.scale[0]<0||o.scale[1]<0)){let p=o.padding[0],C=o.padding[1],v=o.padding[2],T=o.padding[3];o.scale[0]<0&&(C=-C,T=-T),o.scale[1]<0&&(p=-p,v=-v),_=[p,C,v,T]}const m=this.pixelRatio;this.instructions.push([CanvasInstruction.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,_==defaultPadding?defaultPadding:_.map(function(p){return p*m}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/m;this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,void 0,this.declutterImageWithText_,_,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(i)}}saveTextStates_(){const t=this.textStrokeState_,i=this.textState_,n=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:i.font,textAlign:i.textAlign||defaultTextAlign,justify:i.justify,textBaseline:i.textBaseline||defaultTextBaseline,scale:i.scale});const a=this.fillKey_;n&&(a in this.fillStates||(this.fillStates[a]={fillStyle:n.fillStyle}))}drawChars_(t,i){const n=this.textStrokeState_,s=this.textState_,o=this.strokeKey_,a=this.textKey_,l=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,c=TEXT_ALIGN[s.textBaseline],u=this.textOffsetY_*h,d=this.text_,f=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([CanvasInstruction.DRAW_CHARS,t,i,c,s.overflow,l,s.maxAngle,h,u,o,f*h,d,a,1]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_CHARS,t,i,c,s.overflow,l,s.maxAngle,1,u,o,f,d,a,1/h])}setTextStyle(t,i){let n,s,o;if(!t)this.text_="";else{const a=t.getFill();a?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=asColorLike(a.getColor()||defaultFillStyle)):(s=null,this.textFillState_=s);const l=t.getStroke();if(!l)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const m=l.getLineDash(),y=l.getLineDashOffset(),p=l.getWidth(),C=l.getMiterLimit();o.lineCap=l.getLineCap()||defaultLineCap,o.lineDash=m?m.slice():defaultLineDash,o.lineDashOffset=y===void 0?defaultLineDashOffset:y,o.lineJoin=l.getLineJoin()||defaultLineJoin,o.lineWidth=p===void 0?defaultLineWidth:p,o.miterLimit=C===void 0?defaultMiterLimit:C,o.strokeStyle=asColorLike(l.getColor()||defaultStrokeStyle)}n=this.textState_;const h=t.getFont()||defaultFont;registerFont(h);const c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=h,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||defaultTextBaseline,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||defaultPadding,n.scale=c===void 0?[1,1]:c;const u=t.getOffsetX(),d=t.getOffsetY(),f=t.getRotateWithView(),_=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=f===void 0?!1:f,this.textRotation_=_===void 0?0:_,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:getUid(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s?typeof s.fillStyle=="string"?s.fillStyle:"|"+getUid(s.fillStyle):""}this.declutterImageWithText_=i}}const BATCH_CONSTRUCTORS={Circle:PolygonBuilder,Default:Builder,Image:ImageBuilder,LineString:LineStringBuilder,Polygon:PolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(t,i,n,s){this.tolerance_=t,this.maxExtent_=i,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const i in this.buildersByZIndex_){t[i]=t[i]||{};const n=this.buildersByZIndex_[i];for(const s in n){const o=n[s].finish();t[i][s]=o}}return t}getBuilder(t,i){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let o=s[i];if(o===void 0){const a=BATCH_CONSTRUCTORS[i];o=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[i]=o}return o}}const CanvasBuilderGroup=BuilderGroup;class LayerRenderer extends Observable$1{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return abstract()}getData(t){return null}prepareFrame(t){return abstract()}renderFrame(t,i){return abstract()}loadedTileCallback(t,i,n){t[i]||(t[i]={}),t[i][n.tileCoord.toString()]=n}createLoadedTileFinder(t,i,n){return(s,o)=>{const a=this.loadedTileCallback.bind(this,n,s);return t.forEachLoadedTile(i,s,o,a)}}forEachFeatureAtCoordinate(t,i,n,s,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===ImageState.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let i=t.getState();return i!=ImageState.LOADED&&i!=ImageState.ERROR&&t.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),i==ImageState.IDLE&&(t.load(),i=t.getState()),i==ImageState.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const LayerRenderer$1=LayerRenderer;class RenderEvent extends Event{constructor(t,i,n,s){super(t),this.inversePixelTransform=i,this.frameState=n,this.context=s}}const RenderEvent$1=RenderEvent,canvasPool$1=[];let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer$1{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=create(),this.pixelTransform=create(),this.inversePixelTransform=create(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,i,n){pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);let s;try{pixelContext.drawImage(t,i,n,1,1,0,0,1,1),s=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return s}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,i,n){const s=this.getLayer().getClassName();let o,a;if(t&&t.className===s&&(!n||t&&t.style.backgroundColor&&equals$2(asArray(t.style.backgroundColor),asArray(n)))){const l=t.firstElementChild;l instanceof HTMLCanvasElement&&(a=l.getContext("2d"))}if(a&&a.canvas.style.transform===i?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){o=document.createElement("div"),o.className=s;let l=o.style;l.position="absolute",l.width="100%",l.height="100%",a=createCanvasContext2D();const h=a.canvas;o.appendChild(h),l=h.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=o,this.context=a}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,i,n){const s=getTopLeft(n),o=getTopRight(n),a=getBottomRight(n),l=getBottomLeft(n);apply(i.coordinateToPixelTransform,s),apply(i.coordinateToPixelTransform,o),apply(i.coordinateToPixelTransform,a),apply(i.coordinateToPixelTransform,l);const h=this.inversePixelTransform;apply(h,s),apply(h,o),apply(h,a),apply(h,l),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.clip()}dispatchRenderEvent_(t,i,n){const s=this.getLayer();if(s.hasListener(t)){const o=new RenderEvent$1(t,this.inversePixelTransform,n,i);s.dispatchEvent(o)}}preRender(t,i){this.frameState=i,this.dispatchRenderEvent_(RenderEventType.PRERENDER,t,i)}postRender(t,i){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,t,i)}getRenderTransform(t,i,n,s,o,a,l){const h=o/2,c=a/2,u=s/i,d=-u,f=-t[0]+l,_=-t[1];return compose(this.tempTransform,h,c,u,d,-n,f,_)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const CanvasLayerRenderer$1=CanvasLayerRenderer;function drawTextOnPath(r,t,i,n,s,o,a,l,h,c,u,d){let f=r[t],_=r[t+1],m=0,y=0,p=0,C=0;function v(){m=f,y=_,t+=n,f=r[t],_=r[t+1],C+=p,p=Math.sqrt((f-m)*(f-m)+(_-y)*(_-y))}do v();while(t<i-n&&C+p<o);let T=p===0?0:(o-C)/p;const w=lerp(m,f,T),I=lerp(y,_,T),O=t-n,$=C,k=o+l*h(c,s,u);for(;t<i-n&&C+p<k;)v();T=p===0?0:(k-C)/p;const b=lerp(m,f,T),W=lerp(y,_,T);let X;if(d){const z=[w,I,b,W];rotate(z,0,4,2,d,z,z),X=z[0]>z[2]}else X=w>b;const Z=Math.PI,Y=[],le=O+n===t;t=O,p=0,C=$,f=r[t],_=r[t+1];let B;if(le){v(),B=Math.atan2(_-y,f-m),X&&(B+=B>0?-Z:Z);const z=(b+w)/2,G=(W+I)/2;return Y[0]=[z,G,(k-o)/2,B,s],Y}s=s.replace(/\n/g," ");for(let z=0,G=s.length;z<G;){v();let V=Math.atan2(_-y,f-m);if(X&&(V+=V>0?-Z:Z),B!==void 0){let Q=V-B;if(Q+=Q>Z?-2*Z:Q<-Z?2*Z:0,Math.abs(Q)>a)return null}B=V;const te=z;let ee=0;for(;z<G;++z){const Q=X?G-z-1:z,ne=l*h(c,s[Q],u);if(t+n<i&&C+p<o+ee+ne/2)break;ee+=ne}if(z===te)continue;const ge=X?s.substring(G-te,G-z):s.substring(te,z);T=p===0?0:(o+ee/2-C)/p;const M=lerp(m,f,T),we=lerp(y,_,T);Y.push([M,we,ee/2,V,ge]),o+=ee}return Y}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(r){return r[3].declutterBox}const rtlRegEx=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function horizontalTextAlign(r,t){return(t==="start"||t==="end")&&!rtlRegEx.test(r)&&(t=t==="start"?"left":"right"),TEXT_ALIGN[t]}function createTextChunks(r,t,i){return i>0&&r.push(`
`,""),r.push(t,""),r}class Executor{constructor(t,i,n,s){this.overlaps=n,this.pixelRatio=i,this.resolution=t,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=create(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,i,n,s){const o=t+i+n+s;if(this.labels_[o])return this.labels_[o];const a=s?this.strokeStates[s]:null,l=n?this.fillStates[n]:null,h=this.textStates[i],c=this.pixelRatio,u=[h.scale[0]*c,h.scale[1]*c],d=Array.isArray(t),f=h.justify?TEXT_ALIGN[h.justify]:horizontalTextAlign(Array.isArray(t)?t[0]:t,h.textAlign||defaultTextAlign),_=s&&a.lineWidth?a.lineWidth:0,m=d?t:t.split(`
`).reduce(createTextChunks,[]),{width:y,height:p,widths:C,heights:v,lineWidths:T}=getTextDimensions(h,m),w=y+_,I=[],O=(w+2)*u[0],$=(p+_)*u[1],k={width:O<0?Math.floor(O):Math.ceil(O),height:$<0?Math.floor($):Math.ceil($),contextInstructions:I};(u[0]!=1||u[1]!=1)&&I.push("scale",u),s&&(I.push("strokeStyle",a.strokeStyle),I.push("lineWidth",_),I.push("lineCap",a.lineCap),I.push("lineJoin",a.lineJoin),I.push("miterLimit",a.miterLimit),I.push("setLineDash",[a.lineDash]),I.push("lineDashOffset",a.lineDashOffset)),n&&I.push("fillStyle",l.fillStyle),I.push("textBaseline","middle"),I.push("textAlign","center");const b=.5-f;let W=f*w+b*_;const X=[],Z=[];let Y=0,le=0,B=0,z=0,G;for(let V=0,te=m.length;V<te;V+=2){const ee=m[V];if(ee===`
`){le+=Y,Y=0,W=f*w+b*_,++z;continue}const ge=m[V+1]||h.font;ge!==G&&(s&&X.push("font",ge),n&&Z.push("font",ge),G=ge),Y=Math.max(Y,v[B]);const M=[ee,W+b*C[B]+f*(C[B]-T[z]),.5*(_+Y)+le];W+=C[B],s&&X.push("strokeText",M),n&&Z.push("fillText",M),++B}return Array.prototype.push.apply(I,X),Array.prototype.push.apply(I,Z),this.labels_[o]=k,k}replayTextBackground_(t,i,n,s,o,a,l){t.beginPath(),t.moveTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,o),t.lineTo.apply(t,i),a&&(this.alignFill_=a[2],this.fill_(t)),l&&(this.setStrokeStyle_(t,l),t.stroke())}calculateImageOrLabelDimensions_(t,i,n,s,o,a,l,h,c,u,d,f,_,m,y,p){l*=f[0],h*=f[1];let C=n-l,v=s-h;const T=o+c>t?t-c:o,w=a+u>i?i-u:a,I=m[3]+T*f[0]+m[1],O=m[0]+w*f[1]+m[2],$=C-m[3],k=v-m[0];(y||d!==0)&&(p1[0]=$,p4[0]=$,p1[1]=k,p2[1]=k,p2[0]=$+I,p3[0]=p2[0],p3[1]=k+O,p4[1]=p3[1]);let b;return d!==0?(b=compose(create(),n,s,1,1,d,-n,-s),apply(b,p1),apply(b,p2),apply(b,p3),apply(b,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min($,$+I),Math.min(k,k+O),Math.max($,$+I),Math.max(k,k+O),tmpExtent),_&&(C=Math.round(C),v=Math.round(v)),{drawImageX:C,drawImageY:v,drawImageW:T,drawImageH:w,originX:c,originY:u,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:p},canvasTransform:b,scale:f}}replayImageOrLabel_(t,i,n,s,o,a,l){const h=!!(a||l),c=s.declutterBox,u=t.canvas,d=l?l[2]*s.scale[0]/2:0;return c.minX-d<=u.width/i&&c.maxX+d>=0&&c.minY-d<=u.height/i&&c.maxY+d>=0&&(h&&this.replayTextBackground_(t,p1,p2,p3,p4,a,l),drawImageOrLabel(t,s.canvasTransform,o,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const i=apply(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(i[0]%n,i[1]%n),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,i){t.strokeStyle=i[1],t.lineWidth=i[2],t.lineCap=i[3],t.lineJoin=i[4],t.miterLimit=i[5],t.lineDashOffset=i[7],t.setLineDash(i[6])}drawLabelWithPointPlacement_(t,i,n,s){const o=this.textStates[i],a=this.createLabel(t,i,s,n),l=this.strokeStates[n],h=this.pixelRatio,c=horizontalTextAlign(Array.isArray(t)?t[0]:t,o.textAlign||defaultTextAlign),u=TEXT_ALIGN[o.textBaseline||defaultTextBaseline],d=l&&l.lineWidth?l.lineWidth:0,f=a.width/h-2*o.scale[0],_=c*f+2*(.5-c)*d,m=u*a.height/h+2*(.5-u)*d;return{label:a,anchorX:_,anchorY:m}}execute_(t,i,n,s,o,a,l,h){let c;this.pixelCoordinates_&&equals$2(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=transform2D(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),setFromArray(this.renderedTransform_,n));let u=0;const d=s.length;let f=0,_,m,y,p,C,v,T,w,I,O,$,k,b=0,W=0,X=null,Z=null;const Y=this.coordinateCache_,le=this.viewRotation_,B=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,z={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:le},G=this.instructions!=s||this.overlaps?0:200;let V,te,ee,ge;for(;u<d;){const M=s[u];switch(M[0]){case CanvasInstruction.BEGIN_GEOMETRY:V=M[1],ge=M[3],V.getGeometry()?l!==void 0&&!intersects$1(l,ge.getExtent())?u=M[2]+1:++u:u=M[2];break;case CanvasInstruction.BEGIN_PATH:b>G&&(this.fill_(t),b=0),W>G&&(t.stroke(),W=0),!b&&!W&&(t.beginPath(),p=NaN,C=NaN),++u;break;case CanvasInstruction.CIRCLE:f=M[1];const Q=c[f],ne=c[f+1],$e=c[f+2],Ae=c[f+3],ye=$e-Q,De=Ae-ne,Xe=Math.sqrt(ye*ye+De*De);t.moveTo(Q+Xe,ne),t.arc(Q,ne,Xe,0,2*Math.PI,!0),++u;break;case CanvasInstruction.CLOSE_PATH:t.closePath(),++u;break;case CanvasInstruction.CUSTOM:f=M[1],_=M[2];const He=M[3],We=M[4],qe=M.length==6?M[5]:void 0;z.geometry=He,z.feature=V,u in Y||(Y[u]=[]);const Be=Y[u];qe?qe(c,f,_,2,Be):(Be[0]=c[f],Be[1]=c[f+1],Be.length=2),We(Be,z),++u;break;case CanvasInstruction.DRAW_IMAGE:f=M[1],_=M[2],w=M[3],m=M[4],y=M[5];let Ye=M[6];const Ue=M[7],Je=M[8],Qe=M[9],et=M[10];let Ve=M[11];const nt=M[12];let Se=M[13];const Ie=M[14],Me=M[15];if(!w&&M.length>=20){I=M[19],O=M[20],$=M[21],k=M[22];const _e=this.drawLabelWithPointPlacement_(I,O,$,k);w=_e.label,M[3]=w;const ke=M[23];m=(_e.anchorX-ke)*this.pixelRatio,M[4]=m;const Ce=M[24];y=(_e.anchorY-Ce)*this.pixelRatio,M[5]=y,Ye=w.height,M[6]=Ye,Se=w.width,M[13]=Se}let Oe;M.length>25&&(Oe=M[25]);let ze,x,g;M.length>17?(ze=M[16],x=M[17],g=M[18]):(ze=defaultPadding,x=!1,g=!1),et&&B?Ve+=le:!et&&!B&&(Ve-=le);let P=0;for(;f<_;f+=2){if(Oe&&Oe[P++]<Se/this.pixelRatio)continue;const _e=this.calculateImageOrLabelDimensions_(w.width,w.height,c[f],c[f+1],Se,Ye,m,y,Je,Qe,Ve,nt,o,ze,x||g,V),ke=[t,i,w,_e,Ue,x?X:null,g?Z:null];if(h){if(Ie==="none")continue;if(Ie==="obstacle"){h.insert(_e.declutterBox);continue}else{let Ce,Ne;if(Me){const he=_-f;if(!Me[he]){Me[he]=ke;continue}if(Ce=Me[he],delete Me[he],Ne=getDeclutterBox(Ce),h.collides(Ne))continue}if(h.collides(_e.declutterBox))continue;Ce&&(h.insert(Ne),this.replayImageOrLabel_.apply(this,Ce)),h.insert(_e.declutterBox)}}this.replayImageOrLabel_.apply(this,ke)}++u;break;case CanvasInstruction.DRAW_CHARS:const N=M[1],A=M[2],q=M[3],H=M[4];k=M[5];const oe=M[6],K=M[7],Ee=M[8];$=M[9];const Le=M[10];I=M[11],O=M[12];const de=[M[13],M[13]],J=this.textStates[O],Pe=J.font,se=[J.scale[0]*K,J.scale[1]*K];let me;Pe in this.widths_?me=this.widths_[Pe]:(me={},this.widths_[Pe]=me);const tt=lineStringLength(c,N,A,2),Fe=Math.abs(se[0])*measureAndCacheTextWidth(Pe,I,me);if(H||Fe<=tt){const _e=this.textStates[O].textAlign,ke=(tt-Fe)*TEXT_ALIGN[_e],Ce=drawTextOnPath(c,N,A,2,I,ke,oe,Math.abs(se[0]),measureAndCacheTextWidth,Pe,me,B?0:this.viewRotation_);e:if(Ce){const Ne=[];let he,it,je,Te,be;if($)for(he=0,it=Ce.length;he<it;++he){be=Ce[he],je=be[4],Te=this.createLabel(je,O,"",$),m=be[2]+(se[0]<0?-Le:Le),y=q*Te.height+(.5-q)*2*Le*se[1]/se[0]-Ee;const Ge=this.calculateImageOrLabelDimensions_(Te.width,Te.height,be[0],be[1],Te.width,Te.height,m,y,0,0,be[3],de,!1,defaultPadding,!1,V);if(h&&h.collides(Ge.declutterBox))break e;Ne.push([t,i,Te,Ge,1,null,null])}if(k)for(he=0,it=Ce.length;he<it;++he){be=Ce[he],je=be[4],Te=this.createLabel(je,O,k,""),m=be[2],y=q*Te.height-Ee;const Ge=this.calculateImageOrLabelDimensions_(Te.width,Te.height,be[0],be[1],Te.width,Te.height,m,y,0,0,be[3],de,!1,defaultPadding,!1,V);if(h&&h.collides(Ge.declutterBox))break e;Ne.push([t,i,Te,Ge,1,null,null])}h&&h.load(Ne.map(getDeclutterBox));for(let Ge=0,rt=Ne.length;Ge<rt;++Ge)this.replayImageOrLabel_.apply(this,Ne[Ge])}}++u;break;case CanvasInstruction.END_GEOMETRY:if(a!==void 0){V=M[1];const _e=a(V,ge);if(_e)return _e}++u;break;case CanvasInstruction.FILL:G?b++:this.fill_(t),++u;break;case CanvasInstruction.MOVE_TO_LINE_TO:for(f=M[1],_=M[2],te=c[f],ee=c[f+1],v=te+.5|0,T=ee+.5|0,(v!==p||T!==C)&&(t.moveTo(te,ee),p=v,C=T),f+=2;f<_;f+=2)te=c[f],ee=c[f+1],v=te+.5|0,T=ee+.5|0,(f==_-2||v!==p||T!==C)&&(t.lineTo(te,ee),p=v,C=T);++u;break;case CanvasInstruction.SET_FILL_STYLE:X=M,this.alignFill_=M[2],b&&(this.fill_(t),b=0,W&&(t.stroke(),W=0)),t.fillStyle=M[1],++u;break;case CanvasInstruction.SET_STROKE_STYLE:Z=M,W&&(t.stroke(),W=0),this.setStrokeStyle_(t,M),++u;break;case CanvasInstruction.STROKE:G?W++:t.stroke(),++u;break;default:++u;break}}b&&this.fill_(t),W&&t.stroke()}execute(t,i,n,s,o,a){this.viewRotation_=s,this.execute_(t,i,n,this.instructions,o,void 0,void 0,a)}executeHitDetection(t,i,n,s,o){return this.viewRotation_=n,this.execute_(t,1,i,this.hitDetectionInstructions,!0,s,o)}}const Executor$1=Executor,ORDER=["Polygon","Circle","LineString","Image","Text","Default"];class ExecutorGroup{constructor(t,i,n,s,o,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=i,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create(),this.createExecutors_(o)}clip(t,i){const n=this.getClipCoords(i);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t){for(const i in t){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const s=t[i];for(const o in s){const a=s[o];n[o]=new Executor$1(this.resolution_,this.pixelRatio_,this.overlaps_,a)}}}hasExecutors(t){for(const i in this.executorsByZIndex_){const n=this.executorsByZIndex_[i];for(let s=0,o=t.length;s<o;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,i,n,s,o,a){s=Math.round(s);const l=s*2+1,h=compose(this.hitDetectionTransform_,s+.5,s+.5,1/i,-1/i,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=createCanvasContext2D(l,l,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==l||u.canvas.height!==l?(u.canvas.width=l,u.canvas.height=l):c||u.clearRect(0,0,l,l);let d;this.renderBuffer_!==void 0&&(d=createEmpty(),extendCoordinate(d,t),buffer(d,i*(this.renderBuffer_+s),d));const f=getPixelIndexArray(s);let _;function m(I,O){const $=u.getImageData(0,0,l,l).data;for(let k=0,b=f.length;k<b;k++)if($[f[k]]>0){if(!a||_!=="Image"&&_!=="Text"||a.includes(I)){const W=(f[k]-3)/4,X=s-W%l,Z=s-(W/l|0),Y=o(I,O,X*X+Z*Z);if(Y)return Y}u.clearRect(0,0,l,l);break}}const y=Object.keys(this.executorsByZIndex_).map(Number);y.sort(ascending);let p,C,v,T,w;for(p=y.length-1;p>=0;--p){const I=y[p].toString();for(v=this.executorsByZIndex_[I],C=ORDER.length-1;C>=0;--C)if(_=ORDER[C],T=v[_],T!==void 0&&(w=T.executeHitDetection(u,h,n,m,d),w))return w}}getClipCoords(t){const i=this.maxExtent_;if(!i)return null;const n=i[0],s=i[1],o=i[2],a=i[3],l=[n,s,n,a,o,a,o,s];return transform2D(l,0,8,2,t,l),l}isEmpty(){return isEmpty$1(this.executorsByZIndex_)}execute(t,i,n,s,o,a,l){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(ascending),this.maxExtent_&&(t.save(),this.clip(t,n)),a=a||ORDER;let c,u,d,f,_,m;for(l&&h.reverse(),c=0,u=h.length;c<u;++c){const y=h[c].toString();for(_=this.executorsByZIndex_[y],d=0,f=a.length;d<f;++d){const p=a[d];m=_[p],m!==void 0&&m.execute(t,i,n,s,o,l)}}this.maxExtent_&&t.restore()}}const circlePixelIndexArrayCache={};function getPixelIndexArray(r){if(circlePixelIndexArrayCache[r]!==void 0)return circlePixelIndexArrayCache[r];const t=r*2+1,i=r*r,n=new Array(i+1);for(let o=0;o<=r;++o)for(let a=0;a<=r;++a){const l=o*o+a*a;if(l>i)break;let h=n[l];h||(h=[],n[l]=h),h.push(((r+o)*t+(r+a))*4+3),o>0&&h.push(((r-o)*t+(r+a))*4+3),a>0&&(h.push(((r+o)*t+(r-a))*4+3),o>0&&h.push(((r-o)*t+(r-a))*4+3))}const s=[];for(let o=0,a=n.length;o<a;++o)n[o]&&s.push(...n[o]);return circlePixelIndexArrayCache[r]=s,s}const CanvasExecutorGroup=ExecutorGroup;class CanvasImmediateRenderer extends VectorContext$1{constructor(t,i,n,s,o,a,l){super(),this.context_=t,this.pixelRatio_=i,this.extent_=n,this.transform_=s,this.transformRotation_=s?toFixed(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=a,this.userTransform_=l,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create()}drawImages_(t,i,n,s){if(!this.image_)return;const o=transform2D(t,i,n,s,this.transform_,this.pixelCoordinates_),a=this.context_,l=this.tmpLocalTransform_,h=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=h*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,d=o.length;u<d;u+=2){const f=o[u]-this.imageAnchorX_,_=o[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const m=f+this.imageAnchorX_,y=_+this.imageAnchorY_;compose(l,m,y,1,1,c,-m,-y),a.setTransform.apply(a,l),a.translate(m,y),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.setTransform(1,0,0,1,0,0)}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=h)}drawText_(t,i,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const o=transform2D(t,i,n,s,this.transform_,this.pixelCoordinates_),a=this.context_;let l=this.textRotation_;for(this.transformRotation_===0&&(l-=this.viewRotation_),this.textRotateWithView_&&(l+=this.viewRotation_);i<n;i+=s){const h=o[i]+this.textOffsetX_,c=o[i+1]+this.textOffsetY_;l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.translate(h-this.textOffsetX_,c-this.textOffsetY_),a.rotate(l),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&a.strokeText(this.text_,h,c),this.textFillState_&&a.fillText(this.text_,h,c))}}moveToLineTo_(t,i,n,s,o){const a=this.context_,l=transform2D(t,i,n,s,this.transform_,this.pixelCoordinates_);a.moveTo(l[0],l[1]);let h=l.length;o&&(h-=2);for(let c=2;c<h;c+=2)a.lineTo(l[c],l[c+1]);return o&&a.closePath(),n}drawRings_(t,i,n,s){for(let o=0,a=n.length;o<a;++o)i=this.moveToLineTo_(t,i,n[o],s,!0);return i}drawCircle(t){if(intersects$1(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=transformGeom2D(t,this.transform_,this.pixelCoordinates_),n=i[2]-i[0],s=i[3]-i[1],o=Math.sqrt(n*n+s*s),a=this.context_;a.beginPath(),a.arc(i[0],i[1],o,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,i){const n=i.getGeometryFunction()(t);!n||!intersects$1(this.extent_,n.getExtent())||(this.setStyle(i),this.drawGeometry(n))}drawGeometryCollection(t){const i=t.getGeometriesArray();for(let n=0,s=i.length;n<s;++n)this.drawGeometry(i[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoint();this.drawText_(i,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getExtent();if(intersects$1(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let o=0;const a=t.getEnds(),l=t.getStride();n.beginPath();for(let h=0,c=a.length;h<c;++h)o=this.moveToLineTo_(s,o,a[h],l,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_;i.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const o=t.getEndss(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l){const c=o[l];s=this.drawRings_(n,s,c,a)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=t.getFlatInteriorPoints();this.drawText_(i,0,i.length,2)}}}setContextFillState_(t){const i=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,i.fillStyle=t.fillStyle):(i.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const i=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,i.lineCap=t.lineCap),equals$2(n.lineDash,t.lineDash)||i.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,i.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,i.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,i.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,i.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,i.strokeStyle=t.strokeStyle)):(i.lineCap=t.lineCap,i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset,i.lineJoin=t.lineJoin,i.lineWidth=t.lineWidth,i.miterLimit=t.miterLimit,i.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const i=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:defaultTextAlign;n?(n.font!=t.font&&(n.font=t.font,i.font=t.font),n.textAlign!=s&&(n.textAlign=s,i.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,i.textBaseline=t.textBaseline)):(i.font=t.font,i.textAlign=s,i.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,i){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:asColorLike(n||defaultFillStyle)}}if(!i)this.strokeState_=null;else{const n=i.getColor(),s=i.getLineCap(),o=i.getLineDash(),a=i.getLineDashOffset(),l=i.getLineJoin(),h=i.getWidth(),c=i.getMiterLimit(),u=o||defaultLineDash;this.strokeState_={lineCap:s!==void 0?s:defaultLineCap,lineDash:this.pixelRatio_===1?u:u.map(d=>d*this.pixelRatio_),lineDashOffset:(a||defaultLineDashOffset)*this.pixelRatio_,lineJoin:l!==void 0?l:defaultLineJoin,lineWidth:(h!==void 0?h:defaultLineWidth)*this.pixelRatio_,miterLimit:c!==void 0?c:defaultMiterLimit,strokeStyle:asColorLike(n||defaultStrokeStyle)}}}setImageStyle(t){let i;if(!t||!(i=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=i[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/n,a[1]*this.pixelRatio_/n],this.imageWidth_=i[0]*n}setTextStyle(t){if(!t)this.text_="";else{const i=t.getFill();if(!i)this.textFillState_=null;else{const _=i.getColor();this.textFillState_={fillStyle:asColorLike(_||defaultFillStyle)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const _=n.getColor(),m=n.getLineCap(),y=n.getLineDash(),p=n.getLineDashOffset(),C=n.getLineJoin(),v=n.getWidth(),T=n.getMiterLimit();this.textStrokeState_={lineCap:m!==void 0?m:defaultLineCap,lineDash:y||defaultLineDash,lineDashOffset:p||defaultLineDashOffset,lineJoin:C!==void 0?C:defaultLineJoin,lineWidth:v!==void 0?v:defaultLineWidth,miterLimit:T!==void 0?T:defaultMiterLimit,strokeStyle:asColorLike(_||defaultStrokeStyle)}}const s=t.getFont(),o=t.getOffsetX(),a=t.getOffsetY(),l=t.getRotateWithView(),h=t.getRotation(),c=t.getScaleArray(),u=t.getText(),d=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:s!==void 0?s:defaultFont,textAlign:d!==void 0?d:defaultTextAlign,textBaseline:f!==void 0?f:defaultTextBaseline},this.text_=u!==void 0?Array.isArray(u)?u.reduce((_,m,y)=>_+=y%2?" ":m,""):u:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=l!==void 0?l:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const CanvasImmediateRenderer$1=CanvasImmediateRenderer,HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(r,t,i,n,s,o,a){const l=r[0]*HIT_DETECT_RESOLUTION,h=r[1]*HIT_DETECT_RESOLUTION,c=createCanvasContext2D(l,h);c.imageSmoothingEnabled=!1;const u=c.canvas,d=new CanvasImmediateRenderer$1(c,HIT_DETECT_RESOLUTION,s,null,a),f=i.length,_=Math.floor((256*256*256-1)/f),m={};for(let p=1;p<=f;++p){const C=i[p-1],v=C.getStyleFunction()||n;if(!n)continue;let T=v(C,o);if(!T)continue;Array.isArray(T)||(T=[T]);const I=(p*_).toString(16).padStart(7,"#00000");for(let O=0,$=T.length;O<$;++O){const k=T[O],b=k.getGeometryFunction()(C);if(!b||!intersects$1(s,b.getExtent()))continue;const W=k.clone(),X=W.getFill();X&&X.setColor(I);const Z=W.getStroke();Z&&(Z.setColor(I),Z.setLineDash(null)),W.setText(void 0);const Y=k.getImage();if(Y&&Y.getOpacity()!==0){const G=Y.getImageSize();if(!G)continue;const V=createCanvasContext2D(G[0],G[1],void 0,{alpha:!1}),te=V.canvas;V.fillStyle=I,V.fillRect(0,0,te.width,te.height),W.setImage(new Icon$1({img:te,imgSize:G,anchor:Y.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Y.getOrigin(),opacity:1,size:Y.getSize(),scale:Y.getScale(),rotation:Y.getRotation(),rotateWithView:Y.getRotateWithView()}))}const le=W.getZIndex()||0;let B=m[le];B||(B={},m[le]=B,B.Polygon=[],B.Circle=[],B.LineString=[],B.Point=[]);const z=b.getType();if(z==="GeometryCollection"){const G=b.getGeometriesArrayRecursive();for(let V=0,te=G.length;V<te;++V){const ee=G[V];B[ee.getType().replace("Multi","")].push(ee,W)}}else B[z.replace("Multi","")].push(b,W)}}const y=Object.keys(m).map(Number).sort(ascending);for(let p=0,C=y.length;p<C;++p){const v=m[y[p]];for(const T in v){const w=v[T];for(let I=0,O=w.length;I<O;I+=2){d.setStyle(w[I+1]);for(let $=0,k=t.length;$<k;++$)d.setTransform(t[$]),d.drawGeometry(w[I])}}}return c.getImageData(0,0,u.width,u.height)}function hitDetect(r,t,i){const n=[];if(i){const s=Math.floor(Math.round(r[0])*HIT_DETECT_RESOLUTION),o=Math.floor(Math.round(r[1])*HIT_DETECT_RESOLUTION),a=(clamp(s,0,i.width-1)+clamp(o,0,i.height-1)*i.width)*4,l=i.data[a],h=i.data[a+1],u=i.data[a+2]+256*(h+256*l),d=Math.floor((256*256*256-1)/t.length);u&&u%d===0&&n.push(t[u/d-1])}return n}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(r,t){return parseInt(getUid(r),10)-parseInt(getUid(t),10)}function getSquaredTolerance(r,t){const i=getTolerance(r,t);return i*i}function getTolerance(r,t){return SIMPLIFY_TOLERANCE*r/t}function renderCircleGeometry(r,t,i,n,s){const o=i.getFill(),a=i.getStroke();if(o||a){const h=r.getBuilder(i.getZIndex(),"Circle");h.setFillStrokeStyle(o,a),h.drawCircle(t,n)}const l=i.getText();if(l&&l.getText()){const h=(s||r).getBuilder(i.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,n)}}function renderFeature(r,t,i,n,s,o,a){let l=!1;const h=i.getImage();if(h){const c=h.getImageState();c==ImageState.LOADED||c==ImageState.ERROR?h.unlistenImageChange(s):(c==ImageState.IDLE&&h.load(),h.listenImageChange(s),l=!0)}return renderFeatureInternal(r,t,i,n,o,a),l}function renderFeatureInternal(r,t,i,n,s,o){const a=i.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,s);if(i.getRenderer())renderGeometry(r,l,i,t);else{const c=GEOMETRY_RENDERERS[l.getType()];c(r,l,i,t,o)}}function renderGeometry(r,t,i,n){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let a=0,l=o.length;a<l;++a)renderGeometry(r,o[a],i,n);return}r.getBuilder(i.getZIndex(),"Default").drawCustom(t,n,i.getRenderer(),i.getHitDetectionRenderer())}function renderGeometryCollectionGeometry(r,t,i,n,s){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=GEOMETRY_RENDERERS[o[a].getType()];h(r,o[a],i,n,s)}}function renderLineStringGeometry(r,t,i,n,s){const o=i.getStroke();if(o){const l=r.getBuilder(i.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawLineString(t,n)}const a=i.getText();if(a&&a.getText()){const l=(s||r).getBuilder(i.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function renderMultiLineStringGeometry(r,t,i,n,s){const o=i.getStroke();if(o){const l=r.getBuilder(i.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawMultiLineString(t,n)}const a=i.getText();if(a&&a.getText()){const l=(s||r).getBuilder(i.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function renderMultiPolygonGeometry(r,t,i,n,s){const o=i.getFill(),a=i.getStroke();if(a||o){const h=r.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(o,a),h.drawMultiPolygon(t,n)}const l=i.getText();if(l&&l.getText()){const h=(s||r).getBuilder(i.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,n)}}function renderPointGeometry(r,t,i,n,s){const o=i.getImage(),a=i.getText();let l;if(o){if(o.getImageState()!=ImageState.LOADED)return;let h=r;if(s){const u=o.getDeclutterMode();if(u!=="none")if(h=s,u==="obstacle"){const d=r.getBuilder(i.getZIndex(),"Image");d.setImageStyle(o,l),d.drawPoint(t,n)}else a&&a.getText()&&(l={})}const c=h.getBuilder(i.getZIndex(),"Image");c.setImageStyle(o,l),c.drawPoint(t,n)}if(a&&a.getText()){let h=r;s&&(h=s);const c=h.getBuilder(i.getZIndex(),"Text");c.setTextStyle(a,l),c.drawText(t,n)}}function renderMultiPointGeometry(r,t,i,n,s){const o=i.getImage(),a=i.getText();let l;if(o){if(o.getImageState()!=ImageState.LOADED)return;let h=r;if(s){const u=o.getDeclutterMode();if(u!=="none")if(h=s,u==="obstacle"){const d=r.getBuilder(i.getZIndex(),"Image");d.setImageStyle(o,l),d.drawMultiPoint(t,n)}else a&&a.getText()&&(l={})}const c=h.getBuilder(i.getZIndex(),"Image");c.setImageStyle(o,l),c.drawMultiPoint(t,n)}if(a&&a.getText()){let h=r;s&&(h=s);const c=h.getBuilder(i.getZIndex(),"Text");c.setTextStyle(a,l),c.drawText(t,n)}}function renderPolygonGeometry(r,t,i,n,s){const o=i.getFill(),a=i.getStroke();if(o||a){const h=r.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(o,a),h.drawPolygon(t,n)}const l=i.getText();if(l&&l.getText()){const h=(s||r).getBuilder(i.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,n)}}class CanvasVectorLayerRenderer extends CanvasLayerRenderer$1{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.wrappedRenderedExtent_=createEmpty(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,i,n){const s=i.extent,o=i.viewState,a=o.center,l=o.resolution,h=o.projection,c=o.rotation,u=h.getExtent(),d=this.getLayer().getSource(),f=i.pixelRatio,_=i.viewHints,m=!(_[ViewHint.ANIMATING]||_[ViewHint.INTERACTING]),y=this.compositionContext_,p=Math.round(i.size[0]*f),C=Math.round(i.size[1]*f),v=d.getWrapX()&&h.canWrapX(),T=v?getWidth(u):null,w=v?Math.ceil((s[2]-u[2])/T)+1:1;let I=v?Math.floor((s[0]-u[0])/T):0;do{const O=this.getRenderTransform(a,l,c,f,p,C,I*T);t.execute(y,1,O,c,m,void 0,n)}while(++I<w)}setupCompositionContext_(){if(this.opacity_!==1){const t=createCanvasContext2D(this.context.canvas.width,this.context.canvas.height,canvasPool$1);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,releaseCanvas(this.compositionContext_),canvasPool$1.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,i){const n=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];makeScale(this.pixelTransform,1/n,1/n),makeInverse(this.inversePixelTransform,this.pixelTransform);const o=toString$1(this.pixelTransform);this.useContainer(i,o,this.getBackground(t));const a=this.context,l=a.canvas,h=this.replayGroup_,c=this.declutterExecutorGroup;if((!h||h.isEmpty())&&(!c||c.isEmpty()))return null;const u=Math.round(t.size[0]*n),d=Math.round(t.size[1]*n);l.width!=u||l.height!=d?(l.width=u,l.height=d,l.style.transform!==o&&(l.style.transform=o)):this.containerReused||a.clearRect(0,0,u,d),this.preRender(a,t);const f=t.viewState;f.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let _=!1,m=!0;if(s.extent&&this.clipping){const y=fromUserExtent(s.extent);m=intersects$1(y,t.extent),_=m&&!containsExtent(y,t.extent),_&&this.clipUnrotated(this.compositionContext_,t,y)}return m&&this.renderWorlds(h,t),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(a,t),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(i=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];apply(this.pixelTransform,n);const s=this.renderedCenter_,o=this.renderedResolution_,a=this.renderedRotation_,l=this.renderedProjection_,h=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],d=n[0]*HIT_DETECT_RESOLUTION,f=n[1]*HIT_DETECT_RESOLUTION;u.push(this.getRenderTransform(s,o,a,HIT_DETECT_RESOLUTION,d,f,0).slice());const _=c.getSource(),m=l.getExtent();if(_.getWrapX()&&l.canWrapX()&&!containsExtent(m,h)){let y=h[0];const p=getWidth(m);let C=0,v;for(;y<m[0];)--C,v=p*C,u.push(this.getRenderTransform(s,o,a,HIT_DETECT_RESOLUTION,d,f,v).slice()),y+=p;for(C=0,y=h[2];y>m[2];)++C,v=p*C,u.push(this.getRenderTransform(s,o,a,HIT_DETECT_RESOLUTION,d,f,v).slice()),y-=p}this.hitDetectionImageData_=createHitDetectionImageData(n,u,this.renderedFeatures_,c.getStyleFunction(),h,o,a)}i(hitDetect(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,i,n,s,o){if(!this.replayGroup_)return;const a=i.viewState.resolution,l=i.viewState.rotation,h=this.getLayer(),c={},u=function(_,m,y){const p=getUid(_),C=c[p];if(C){if(C!==!0&&y<C.distanceSq){if(y===0)return c[p]=!0,o.splice(o.lastIndexOf(C),1),s(_,h,m);C.geometry=m,C.distanceSq=y}}else{if(y===0)return c[p]=!0,s(_,h,m);o.push(c[p]={feature:_,layer:h,geometry:m,distanceSq:y,callback:s})}};let d;const f=[this.replayGroup_];return this.declutterExecutorGroup&&f.push(this.declutterExecutorGroup),f.some(_=>d=_.forEachFeatureAtCoordinate(t,a,l,n,u,_===this.declutterExecutorGroup&&i.declutterTree?i.declutterTree.all().map(m=>m.value):null)),d}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const i=this.getLayer(),n=i.getSource();if(!n)return!1;const s=t.viewHints[ViewHint.ANIMATING],o=t.viewHints[ViewHint.INTERACTING],a=i.getUpdateWhileAnimating(),l=i.getUpdateWhileInteracting();if(this.ready&&!a&&s||!l&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=t.extent,c=t.viewState,u=c.projection,d=c.resolution,f=t.pixelRatio,_=i.getRevision(),m=i.getRenderBuffer();let y=i.getRenderOrder();y===void 0&&(y=defaultOrder);const p=c.center.slice(),C=buffer(h,m*d),v=C.slice(),T=[C.slice()],w=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!containsExtent(w,t.extent)){const B=getWidth(w),z=Math.max(getWidth(C)/2,B);C[0]=w[0]-z,C[2]=w[2]+z,wrapX$1(p,u);const G=wrapX$2(T[0],u);G[0]<w[0]&&G[2]<w[2]?T.push([G[0]+B,G[1],G[2]+B,G[3]]):G[0]>w[0]&&G[2]>w[2]&&T.push([G[0]-B,G[1],G[2]-B,G[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==_&&this.renderedRenderOrder_==y&&containsExtent(this.wrappedRenderedExtent_,C))return equals$2(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const I=new CanvasBuilderGroup(getTolerance(d,f),C,d,f);let O;this.getLayer().getDeclutter()&&(O=new CanvasBuilderGroup(getTolerance(d,f),C,d,f));let $;for(let B=0,z=T.length;B<z;++B)n.loadFeatures(T[B],d,u);const k=getSquaredTolerance(d,f);let b=!0;const W=B=>{let z;const G=B.getStyleFunction()||i.getStyleFunction();if(G&&(z=G(B,d)),z){const V=this.renderFeature(B,k,z,I,$,O);b=b&&!V}},X=toUserExtent(C),Z=n.getFeaturesInExtent(X);y&&Z.sort(y);for(let B=0,z=Z.length;B<z;++B)W(Z[B]);this.renderedFeatures_=Z,this.ready=b;const Y=I.finish(),le=new CanvasExecutorGroup(C,d,f,n.getOverlaps(),Y,i.getRenderBuffer());return O&&(this.declutterExecutorGroup=new CanvasExecutorGroup(C,d,f,n.getOverlaps(),O.finish(),i.getRenderBuffer())),this.renderedResolution_=d,this.renderedRevision_=_,this.renderedRenderOrder_=y,this.renderedExtent_=v,this.wrappedRenderedExtent_=C,this.renderedCenter_=p,this.renderedProjection_=u,this.replayGroup_=le,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,i,n,s,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=renderFeature(s,t,n[h],i,this.boundHandleStyleImageChange_,o,a)||l;else l=renderFeature(s,t,n,i,this.boundHandleStyleImageChange_,o,a);return l}}const CanvasVectorLayerRenderer$1=CanvasVectorLayerRenderer;class VectorLayer extends BaseVectorLayer$1{constructor(t){super(t)}createRenderer(){return new CanvasVectorLayerRenderer$1(this)}}const VectorLayer$1=VectorLayer;class RBush{constructor(t){this.rbush_=new RBush$2(t),this.items_={}}insert(t,i){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:i};this.rbush_.insert(n),this.items_[getUid(i)]=n}load(t,i){const n=new Array(i.length);for(let s=0,o=i.length;s<o;s++){const a=t[s],l=i[s],h={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:l};n[s]=h,this.items_[getUid(l)]=h}this.rbush_.load(n)}remove(t){const i=getUid(t),n=this.items_[i];return delete this.items_[i],this.rbush_.remove(n)!==null}update(t,i){const n=this.items_[getUid(i)],s=[n.minX,n.minY,n.maxX,n.maxY];equals$1(s,t)||(this.remove(i),this.insert(t,i))}getAll(){return this.rbush_.all().map(function(i){return i.value})}getInExtent(t){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(i).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,i){return this.forEach_(this.getInExtent(t),i)}forEach_(t,i){let n;for(let s=0,o=t.length;s<o;s++)if(n=i(t[s]),n)return n;return n}isEmpty(){return isEmpty$1(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const i=this.rbush_.toJSON();return createOrUpdate$2(i.minX,i.minY,i.maxX,i.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const i in t.items_)this.items_[i]=t.items_[i]}}const RBush$1=RBush;class Source extends BaseObject$1{constructor(t){super(),this.projection=get$1(t.projection),this.attributions_=adaptAttributions(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,s){i.viewResolver=n,i.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=adaptAttributions(t),this.changed()}setState(t){this.state_=t,this.changed()}}function adaptAttributions(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const Source$1=Source,VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function all$1(r,t){return[[-1/0,-1/0,1/0,1/0]]}let withCredentials=!1;function loadFeaturesXhr(r,t,i,n,s,o,a){const l=new XMLHttpRequest;l.open("GET",typeof r=="function"?r(i,n,s):r,!0),t.getType()=="arraybuffer"&&(l.responseType="arraybuffer"),l.withCredentials=withCredentials,l.onload=function(h){if(!l.status||l.status>=200&&l.status<300){const c=t.getType();let u;c=="json"||c=="text"?u=l.responseText:c=="xml"?(u=l.responseXML,u||(u=new DOMParser().parseFromString(l.responseText,"application/xml"))):c=="arraybuffer"&&(u=l.response),u?o(t.readFeatures(u,{extent:i,featureProjection:s}),t.readProjection(u)):a()}else a()},l.onerror=a,l.send()}function xhr(r,t){return function(i,n,s,o,a){const l=this;loadFeaturesXhr(r,t,i,n,s,function(h,c){l.addFeatures(h),o!==void 0&&o(h)},a||VOID)}}class VectorSourceEvent extends Event{constructor(t,i,n){super(t),this.feature=i,this.features=n}}class VectorSource extends Source$1{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=VOID,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(assert(this.format_,7),this.loader_=xhr(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:all$1;const i=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=i?new RBush$1:null,this.loadedExtentsRtree_=new RBush$1,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(t.features)?s=t.features:t.features&&(n=t.features,s=n.getArray()),!i&&n===void 0&&(n=new Collection$1(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const i=getUid(t);if(!this.addToIndex_(i,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(i,t);const n=t.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[i]=t;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,t))}setupChangeEvents_(t,i){this.featureChangeKeys_[t]=[listen(i,EventType.CHANGE,this.handleFeatureChange_,this),listen(i,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,i){let n=!0;const s=i.getId();return s!==void 0&&(s.toString()in this.idIndex_?n=!1:this.idIndex_[s.toString()]=i),n&&(assert(!(t in this.uidIndex_),30),this.uidIndex_[t]=i),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const i=[],n=[],s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o],h=getUid(l);this.addToIndex_(h,l)&&n.push(l)}for(let o=0,a=n.length;o<a;o++){const l=n[o],h=getUid(l);this.setupChangeEvents_(h,l);const c=l.getGeometry();if(c){const u=c.getExtent();i.push(u),s.push(l)}else this.nullGeometryFeatures_[h]=l}if(this.featuresRtree_&&this.featuresRtree_.load(i,s),this.hasListener(VectorEventType.ADDFEATURE))for(let o=0,a=n.length;o<a;o++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,n[o]))}bindFeaturesCollection_(t){let i=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(n){i||(i=!0,t.push(n.feature),i=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(n){i||(i=!0,t.remove(n.feature),i=!1)}),t.addEventListener(CollectionEventType.ADD,n=>{i||(i=!0,this.addFeature(n.element),i=!1)}),t.addEventListener(CollectionEventType.REMOVE,n=>{i||(i=!0,this.removeFeature(n.element),i=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(n);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const i=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(i),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,i){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(s){if(s.getGeometry().intersectsCoordinate(t))return i(s)})}forEachFeatureInExtent(t,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureIntersectingExtent(t,i){return this.forEachFeatureInExtent(t,function(n){if(n.getGeometry().intersectsExtent(t)){const o=i(n);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),isEmpty$1(this.nullGeometryFeatures_)||extend$2(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const i=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){i.push(n)}),i}getFeaturesInExtent(t,i){if(this.featuresRtree_){if(!(i&&i.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=wrapAndSliceX(t,i);return[].concat(...s.map(o=>this.featuresRtree_.getInExtent(o)))}else if(this.featuresCollection_)return this.featuresCollection_.getArray().slice(0);return[]}getClosestFeatureToCoordinate(t,i){const n=t[0],s=t[1];let o=null;const a=[NaN,NaN];let l=1/0;const h=[-1/0,-1/0,1/0,1/0];return i=i||TRUE,this.featuresRtree_.forEachInExtent(h,function(c){if(i(c)){const u=c.getGeometry(),d=l;if(l=u.closestPointXY(n,s,a,l),l<d){o=c;const f=Math.sqrt(l);h[0]=n-f,h[1]=s-f,h[2]=n+f,h[3]=s+f}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const i=this.idIndex_[t.toString()];return i!==void 0?i:null}getFeatureByUid(t){const i=this.uidIndex_[t];return i!==void 0?i:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const i=t.target,n=getUid(i),s=i.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[n]=i);else{const a=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(a,i)):this.featuresRtree_&&this.featuresRtree_.update(a,i)}const o=i.getId();if(o!==void 0){const a=o.toString();this.idIndex_[a]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[a]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[n]=i;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,i))}hasFeature(t){const i=t.getId();return i!==void 0?i in this.idIndex_:getUid(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&isEmpty$1(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,i,n){const s=this.loadedExtentsRtree_,o=this.strategy_(t,i,n);for(let a=0,l=o.length;a<l;++a){const h=o[a];s.forEachInExtent(h,function(u){return containsExtent(u.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),this.loader_.call(this,h,i,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}),s.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const i=this.loadedExtentsRtree_;let n;i.forEachInExtent(t,function(s){if(equals$1(s.extent,t))return n=s,!0}),n&&i.remove(n)}removeFeature(t){if(!t)return;const i=getUid(t);i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const i=getUid(t),n=this.featureChangeKeys_[i];if(!n)return;n.forEach(unlistenByKey),delete this.featureChangeKeys_[i];const s=t.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[i],this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let i=!1;for(const n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],i=!0;break}return i}setLoader(t){this.loader_=t}setUrl(t){assert(this.format_,7),this.url_=t,this.setLoader(xhr(t,this.format_))}}const VectorSource$1=VectorSource,TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Tile extends EventTarget{constructor(t,i,n){super(),n=n||{},this.tileCoord=t,this.state=i,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.state===TileState.ERROR&&this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==TileState.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,i=this;do{if(t.getState()==TileState.LOADED){t.interimTile=null;break}else t.getState()==TileState.LOADING?i=t:t.getState()==TileState.IDLE?i.interimTile=t.interimTile:i=t;t=i.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==TileState.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){abstract()}getAlpha(t,i){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=i,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=i-n+1e3/60;return s>=this.transition_?1:easeIn(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const Tile$1=Tile;class ImageTile extends Tile$1{constructor(t,i,n,s,o,a){super(t,i,a),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function getBlankImage(){const r=createCanvasContext2D(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const ImageTile$1=ImageTile;class Kinetic{constructor(t,i,n){this.decay_=t,this.minVelocity_=i,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,i){this.points_.push(t,i,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<t)return!1;let n=i-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const s=this.points_[i+2]-this.points_[n+2];if(s<1e3/60)return!1;const o=this.points_[i]-this.points_[n],a=this.points_[i+1]-this.points_[n+1];return this.angle_=Math.atan2(a,o),this.initialVelocity_=Math.sqrt(o*o+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Kinetic$1=Kinetic;class MapRenderer extends Disposable$1{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,i){abstract()}calculateMatrices2D(t){const i=t.viewState,n=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;compose(n,t.size[0]/2,t.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),makeInverse(s,n)}forEachFeatureAtCoordinate(t,i,n,s,o,a,l,h){let c;const u=i.viewState;function d(w,I,O,$){return o.call(a,I,w?O:null,$)}const f=u.projection,_=wrapX$1(t.slice(),f),m=[[0,0]];if(f.canWrapX()&&s){const w=f.getExtent(),I=getWidth(w);m.push([-I,0],[I,0])}const y=i.layerStatesArray,p=y.length,C=[],v=[];for(let w=0;w<m.length;w++)for(let I=p-1;I>=0;--I){const O=y[I],$=O.layer;if($.hasRenderer()&&inView(O,u)&&l.call(h,$)){const k=$.getRenderer(),b=$.getSource();if(k&&b){const W=b.getWrapX()?_:t,X=d.bind(null,O.managed);v[0]=W[0]+m[w][0],v[1]=W[1]+m[w][1],c=k.forEachFeatureAtCoordinate(v,i,n,X,C)}if(c)return c}}if(C.length===0)return;const T=1/C.length;return C.forEach((w,I)=>w.distanceSq+=I*T),C.sort((w,I)=>w.distanceSq-I.distanceSq),C.some(w=>c=w.callback(w.feature,w.layer,w.geometry)),c}hasFeatureAtCoordinate(t,i,n,s,o,a){return this.forEachFeatureAtCoordinate(t,i,n,s,TRUE,this,o,a)!==void 0}getMap(){return this.map_}renderFrame(t){abstract()}scheduleExpireIconCache(t){shared.canExpireCache()&&t.postRenderFunctions.push(expireIconCache)}}function expireIconCache(r,t){shared.expire()}const MapRenderer$1=MapRenderer;class CompositeMapRenderer extends MapRenderer$1{constructor(t){super(t),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const i=this.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,i){const n=this.getMap();if(n.hasListener(t)){const s=new RenderEvent$1(t,void 0,i);n.dispatchEvent(s)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,t);const i=t.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex}),n=t.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=i.length;a<l;++a){const h=i[a];t.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!inView(h,n)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(t,o);d&&(d!==o&&(this.children_.push(d),o=d),"getDeclutter"in c&&s.push(c))}for(let a=s.length-1;a>=0;--a)s[a].renderDeclutter(t);replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}const CompositeMapRenderer$1=CompositeMapRenderer;class GroupEvent extends Event{constructor(t,i){super(t),this.layer=i}}const Property={LAYERS:"layers"};class LayerGroup extends BaseLayer$1{constructor(t){t=t||{};const i=Object.assign({},t);delete i.layers;let n=t.layers;super(i),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Collection$1(n.slice(),{unique:!0}):assert(typeof n.getArray=="function",43):n=new Collection$1(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(listen(t,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(t,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(unlistenByKey);clear(this.listenerKeys_);const i=t.getArray();for(let n=0,s=i.length;n<s;n++){const o=i[n];this.registerLayerListeners_(o),this.dispatchEvent(new GroupEvent("addlayer",o))}this.changed()}registerLayerListeners_(t){const i=[listen(t,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(t,EventType.CHANGE,this.handleLayerChange_,this)];t instanceof LayerGroup&&i.push(listen(t,"addlayer",this.handleLayerGroupAdd_,this),listen(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(t)]=i}handleLayerGroupAdd_(t){this.dispatchEvent(new GroupEvent("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new GroupEvent("removelayer",t.layer))}handleLayersAdd_(t){const i=t.element;this.registerLayerListeners_(i),this.dispatchEvent(new GroupEvent("addlayer",i)),this.changed()}handleLayersRemove_(t){const i=t.element,n=getUid(i);this.listenerKeys_[n].forEach(unlistenByKey),delete this.listenerKeys_[n],this.dispatchEvent(new GroupEvent("removelayer",i)),this.changed()}getLayers(){return this.get(Property.LAYERS)}setLayers(t){const i=this.getLayers();if(i){const n=i.getArray();for(let s=0,o=n.length;s<o;++s)this.dispatchEvent(new GroupEvent("removelayer",n[s]))}this.set(Property.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(i){i.getLayersArray(t)}),t}getLayerStatesArray(t){const i=t!==void 0?t:[],n=i.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(i)});const s=this.getLayerState();let o=s.zIndex;!t&&s.zIndex===void 0&&(o=0);for(let a=n,l=i.length;a<l;a++){const h=i[a];h.opacity*=s.opacity,h.visible=h.visible&&s.visible,h.maxResolution=Math.min(h.maxResolution,s.maxResolution),h.minResolution=Math.max(h.minResolution,s.minResolution),h.minZoom=Math.max(h.minZoom,s.minZoom),h.maxZoom=Math.min(h.maxZoom,s.maxZoom),s.extent!==void 0&&(h.extent!==void 0?h.extent=getIntersection(h.extent,s.extent):h.extent=s.extent),h.zIndex===void 0&&(h.zIndex=o)}return i}getSourceState(){return"ready"}}const LayerGroup$1=LayerGroup;class MapEvent extends Event{constructor(t,i,n){super(t),this.map=i,this.frameState=n!==void 0?n:null}}const MapEvent$1=MapEvent;class MapBrowserEvent extends MapEvent$1{constructor(t,i,n,s,o,a){super(t,i,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const MapBrowserEvent$1=MapBrowserEvent,MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class MapBrowserEventHandler extends EventTarget{constructor(t,i){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=i===void 0?1:i,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=listen(n,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(n,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(t){let i=new MapBrowserEvent$1(MapBrowserEventType.CLICK,this.map_,t);this.dispatchEvent(i),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new MapBrowserEvent$1(MapBrowserEventType.DBLCLICK,this.map_,t),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new MapBrowserEvent$1(MapBrowserEventType.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const i=t,n=i.pointerId;if(i.type==MapBrowserEventType.POINTERUP||i.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==i.target){delete this.trackedTouches_[s];break}}else(i.type==MapBrowserEventType.POINTERDOWN||i.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[n]=i);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const i=new MapBrowserEvent$1(MapBrowserEventType.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(i),this.emulateClicks_&&!i.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const i=new MapBrowserEvent$1(MapBrowserEventType.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(i),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(n,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(n,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const i=new MapBrowserEvent$1(MapBrowserEventType.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(i)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const i=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new MapBrowserEvent$1(MapBrowserEventType.POINTERMOVE,this.map_,t,i))}handleTouchMove_(t){const i=this.originalPointerMoveEvent_;(!i||i.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapBrowserEventHandler$1=MapBrowserEventHandler,MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0;class PriorityQueue{constructor(t,i){this.priorityFunction_=t,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)}dequeue(){const t=this.elements_,i=this.priorities_,n=t[0];t.length==1?(t.length=0,i.length=0):(t[0]=t.pop(),i[0]=i.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){assert(!(this.keyFunction_(t)in this.queuedElements_),31);const i=this.priorityFunction_(t);return i!=DROP?(this.elements_.push(t),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const i=this.elements_,n=this.priorities_,s=i.length,o=i[t],a=n[t],l=t;for(;t<s>>1;){const h=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<s&&n[c]<n[h]?c:h;i[t]=i[u],n[t]=n[u],t=u}i[t]=o,n[t]=a,this.siftDown_(l,t)}siftDown_(t,i){const n=this.elements_,s=this.priorities_,o=n[i],a=s[i];for(;i>t;){const l=this.getParentIndex_(i);if(s[l]>a)n[i]=n[l],s[i]=s[l],i=l;else break}n[i]=o,s[i]=a}reprioritize(){const t=this.priorityFunction_,i=this.elements_,n=this.priorities_;let s=0;const o=i.length;let a,l,h;for(l=0;l<o;++l)a=i[l],h=t(a),h==DROP?delete this.queuedElements_[this.keyFunction_(a)]:(n[s]=h,i[s++]=a);i.length=s,n.length=s,this.heapify_()}}const PriorityQueue$1=PriorityQueue;class TileQueue extends PriorityQueue$1{constructor(t,i){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=i,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const i=super.enqueue(t);return i&&t[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),i}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const i=t.target,n=i.getState();if(n===TileState.LOADED||n===TileState.ERROR||n===TileState.EMPTY){n!==TileState.ERROR&&i.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);const s=i.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,i){let n=0,s,o,a;for(;this.tilesLoading_<t&&n<i&&this.getCount()>0;)o=this.dequeue()[0],a=o.getKey(),s=o.getState(),s===TileState.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++n,o.load())}}const TileQueue$1=TileQueue;function getTilePriority(r,t,i,n,s){if(!r||!(i in r.wantedTiles)||!r.wantedTiles[i][t.getKey()])return DROP;const o=r.viewState.center,a=n[0]-o[0],l=n[1]-o[1];return 65536*Math.log(s)+Math.sqrt(a*a+l*l)/s}class Control extends BaseObject$1{constructor(t){super();const i=t.element;i&&!t.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),this.element=i||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){removeNode(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&removeNode(this.element);for(let i=0,n=this.listenerKeys.length;i<n;++i)unlistenByKey(this.listenerKeys[i]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(t,MapEventType.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const Control$1=Control;class Attribution extends Control$1{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const i=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:i+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"›",a=t.collapseClassName!==void 0?t.collapseClassName:i+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=a):this.collapseLabel_=o;const l=t.label!==void 0?t.label:"i";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l,this.label_.className=s):this.label_=l;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const c=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const i=Array.from(new Set(this.getMap().getAllLayers().flatMap(s=>s.getAttributions(t)))),n=!this.getMap().getAllLayers().some(s=>s.getSource()&&s.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=this.collectSourceAttributions_(t),n=i.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!equals$2(i,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let s=0,o=i.length;s<o;++s){const a=document.createElement("li");a.innerHTML=i[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=i}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const Attribution$1=Attribution;class Rotate extends Control$1{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const i=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const o=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=i+"-reset",a.setAttribute("type","button"),a.title=o,a.appendChild(this.label_),a.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const l=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,h=this.element;h.className=l,h.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const i=this.getMap().getView();if(!i)return;const n=i.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?i.animate({rotation:0,duration:this.duration_,easing:easeOut}):i.setRotation(0))}render(t){const i=t.frameState;if(!i)return;const n=i.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const o=this.element.classList.contains(CLASS_HIDDEN);!o&&n===0?this.element.classList.add(CLASS_HIDDEN):o&&n!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=s}this.rotation_=n}}const Rotate$1=Rotate;class Zoom extends Control$1{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const i=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:i+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:i+"-out",a=t.zoomInLabel!==void 0?t.zoomInLabel:"+",l=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",h=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(EventType.CLICK,this.handleClick_.bind(this,n),!1);const d=document.createElement("button");d.className=o,d.setAttribute("type","button"),d.title=c,d.appendChild(typeof l=="string"?document.createTextNode(l):l),d.addEventListener(EventType.CLICK,this.handleClick_.bind(this,-n),!1);const f=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,_=this.element;_.className=f,_.appendChild(u),_.appendChild(d),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,i){i.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const o=n.getConstrainedZoom(s+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:easeOut})):n.setZoom(o)}}}const Zoom$1=Zoom;function defaults$1(r){r=r||{};const t=new Collection$1;return(r.zoom!==void 0?r.zoom:!0)&&t.push(new Zoom$1(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&t.push(new Rotate$1(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&t.push(new Attribution$1(r.attributionOptions)),t}const InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject$1{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(InteractionProperty.ACTIVE,t)}setMap(t){this.map_=t}}function pan(r,t,i){const n=r.getCenterInternal();if(n){const s=[n[0]+t[0],n[1]+t[1]];r.animateInternal({duration:i!==void 0?i:250,easing:linear,center:r.getConstrainedCenter(s)})}}function zoomByDelta(r,t,i,n){const s=r.getZoom();if(s===void 0)return;const o=r.getConstrainedZoom(s+t),a=r.getResolutionForZoom(o);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:a,anchor:i,duration:n!==void 0?n:250,easing:easeOut})}const Interaction$1=Interaction;class DoubleClickZoom extends Interaction$1{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let i=!1;if(t.type==MapBrowserEventType.DBLCLICK){const n=t.originalEvent,s=t.map,o=t.coordinate,a=n.shiftKey?-this.delta_:this.delta_,l=s.getView();zoomByDelta(l,a,o,this.duration_),n.preventDefault(),i=!0}return!i}}const DoubleClickZoom$1=DoubleClickZoom;class PointerInteraction extends Interaction$1{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let i=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==MapBrowserEventType.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==MapBrowserEventType.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,i=this.stopDown(n)}else t.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(t);return!i}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function centroid(r){const t=r.length;let i=0,n=0;for(let s=0;s<t;s++)i+=r[s].clientX,n+=r[s].clientY;return{clientX:i/t,clientY:n/t}}const PointerInteraction$1=PointerInteraction;function all(r){const t=arguments;return function(i){let n=!0;for(let s=0,o=t.length;s<o&&(n=n&&t[s](i),!!n);++s);return n}}const altShiftKeysOnly=function(r){const t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},focus=function(r){const t=r.map.getTargetElement(),i=r.map.getOwnerDocument().activeElement;return t.contains(i)},focusWithTabindex=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?focus(r):!0},always=TRUE,mouseActionButton=function(r){const t=r.originalEvent;return t.button==0&&!(WEBKIT&&MAC&&t.ctrlKey)},never=FALSE,singleClick=function(r){return r.type==MapBrowserEventType.SINGLECLICK},noModifierKeys=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},platformModifierKeyOnly=function(r){const t=r.originalEvent;return!t.altKey&&(MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey},shiftKeyOnly=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},targetNotEditable=function(r){const t=r.originalEvent,i=t.target.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"&&!t.target.isContentEditable},mouseOnly=function(r){const t=r.originalEvent;return assert(t!==void 0,56),t.pointerType=="mouse"},primaryAction=function(r){const t=r.originalEvent;return assert(t!==void 0,56),t.isPrimary&&t.button===0};class DragPan extends PointerInteraction$1{constructor(t){super({stopDown:FALSE}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const i=t.condition?t.condition:all(noModifierKeys,primaryAction);this.condition_=t.onFocusOnly?all(focusWithTabindex,i):i,this.noKinetic_=!1}handleDragEvent(t){const i=t.map;this.panning_||(this.panning_=!0,i.getView().beginInteraction());const n=this.targetPointers,s=i.getEventPixel(centroid(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const o=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],l=t.map.getView();scale$2(o,l.getResolution()),rotate$1(o,l.getRotation()),l.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const i=t.map,n=i.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),a=n.getCenterInternal(),l=i.getPixelFromCoordinateInternal(a),h=i.getCoordinateFromPixelInternal([l[0]-s*Math.cos(o),l[1]-s*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(h),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const DragPan$1=DragPan;class DragRotate extends PointerInteraction$1{constructor(t){t=t||{},super({stopDown:FALSE}),this.condition_=t.condition?t.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!mouseOnly(t))return;const i=t.map,n=i.getView();if(n.getConstraints().rotation===disable)return;const s=i.getSize(),o=t.pixel,a=Math.atan2(s[1]/2-o[1],o[0]-s[0]/2);if(this.lastAngle_!==void 0){const l=a-this.lastAngle_;n.adjustRotationInternal(-l)}this.lastAngle_=a}handleUpEvent(t){return mouseOnly(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return mouseOnly(t)&&mouseActionButton(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const DragRotate$1=DragRotate;class RenderBox extends Disposable$1{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,i=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(t[0],i[0])+n,s.top=Math.min(t[1],i[1])+n,s.width=Math.abs(i[0]-t[0])+n,s.height=Math.abs(i[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const i=this.element_.style;i.left="inherit",i.top="inherit",i.width="inherit",i.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,i){this.startPixel_=t,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,i=this.endPixel_,s=[t,[t[0],i[1]],i,[i[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Polygon$1([s])}getGeometry(){return this.geometry_}}const RenderBox$1=RenderBox,DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends Event{constructor(t,i,n){super(t),this.coordinate=i,this.mapBrowserEvent=n}}class DragBox extends PointerInteraction$1{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new RenderBox$1(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:mouseActionButton,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,i,n){const s=n[0]-i[0],o=n[1]-i[1];return s*s+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const i=this.boxEndCondition_(t,this.startPixel_,t.pixel);return i&&this.onBoxEnd(t),this.dispatchEvent(new DragBoxEvent(i?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}const DragBox$1=DragBox;class DragZoom extends DragBox$1{constructor(t){t=t||{};const i=t.condition?t.condition:shiftKeyOnly;super({condition:i,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const o=n.rotatedExtentForGeometry(s),a=n.getResolutionForExtentInternal(o),l=n.getResolution()/a;s=s.clone(),s.scale(l*l)}n.fitInternal(s,{duration:this.duration_,easing:easeOut})}}const DragZoom$1=DragZoom,KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40};class KeyboardPan extends Interaction$1{constructor(t){super(),t=t||{},this.defaultCondition_=function(i){return noModifierKeys(i)&&targetNotEditable(i)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let i=!1;if(t.type==EventType.KEYDOWN){const n=t.originalEvent,s=n.keyCode;if(this.condition_(t)&&(s==KeyCode.DOWN||s==KeyCode.LEFT||s==KeyCode.RIGHT||s==KeyCode.UP)){const a=t.map.getView(),l=a.getResolution()*this.pixelDelta_;let h=0,c=0;s==KeyCode.DOWN?c=-l:s==KeyCode.LEFT?h=-l:s==KeyCode.RIGHT?h=l:c=l;const u=[h,c];rotate$1(u,a.getRotation()),pan(a,u,this.duration_),n.preventDefault(),i=!0}}return!i}}const KeyboardPan$1=KeyboardPan;class KeyboardZoom extends Interaction$1{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:targetNotEditable,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let i=!1;if(t.type==EventType.KEYDOWN||t.type==EventType.KEYPRESS){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==="+"||s==="-")){const o=t.map,a=s==="+"?this.delta_:-this.delta_,l=o.getView();zoomByDelta(l,a,void 0,this.duration_),n.preventDefault(),i=!0}}return!i}}const KeyboardZoom$1=KeyboardZoom;class MouseWheelZoom extends Interaction$1{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const i=t.condition?t.condition:always;this.condition_=t.onFocusOnly?all(focusWithTabindex,i):i,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==EventType.WHEEL)return!0;const n=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let o;if(t.type==EventType.WHEEL&&(o=s.deltaY,FIREFOX&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(o/=DEVICE_PIXEL_RATIO),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o*=40)),o===0)return!1;this.lastDelta_=o;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");const l=n.getView();if(this.mode_==="trackpad"&&!(l.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=a,!1;this.totalDelta_+=o;const h=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),h),!1}handleWheelZoom_(t){const i=t.getView();i.getAnimating()&&i.cancelAnimations();let n=-clamp(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(i.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),zoomByDelta(i,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const MouseWheelZoom$1=MouseWheelZoom;class PinchRotate extends PointerInteraction$1{constructor(t){t=t||{};const i=t;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let i=0;const n=this.targetPointers[0],s=this.targetPointers[1],o=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const h=o-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=h}this.lastAngle_=o;const a=t.map,l=a.getView();l.getConstraints().rotation!==disable&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(a.render(),l.adjustRotationInternal(i,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const i=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}const PinchRotate$1=PinchRotate;class PinchZoom extends PointerInteraction$1{constructor(t){t=t||{};const i=t;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let i=1;const n=this.targetPointers[0],s=this.targetPointers[1],o=n.clientX-s.clientX,a=n.clientY-s.clientY,l=Math.sqrt(o*o+a*a);this.lastDistance_!==void 0&&(i=this.lastDistance_/l),this.lastDistance_=l;const h=t.map,c=h.getView();i!=1&&(this.lastScaleDelta_=i),this.anchor_=h.getCoordinateFromPixelInternal(h.getEventPixel(centroid(this.targetPointers))),h.render(),c.adjustResolutionInternal(i,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const i=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}const PinchZoom$1=PinchZoom;function defaults(r){r=r||{};const t=new Collection$1,i=new Kinetic$1(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&t.push(new DragRotate$1),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&t.push(new DoubleClickZoom$1({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&t.push(new DragPan$1({onFocusOnly:r.onFocusOnly,kinetic:i})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&t.push(new PinchRotate$1),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&t.push(new PinchZoom$1({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(t.push(new KeyboardPan$1),t.push(new KeyboardZoom$1({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&t.push(new MouseWheelZoom$1({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&t.push(new DragZoom$1({duration:r.zoomDuration})),t}function removeLayerMapProperty(r){if(r instanceof Layer$1){r.setMapInternal(null);return}r instanceof LayerGroup$1&&r.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(r,t){if(r instanceof Layer$1){r.setMapInternal(t);return}if(r instanceof LayerGroup$1){const i=r.getLayers().getArray();for(let n=0,s=i.length;n<s;++n)setLayerMapProperty(i[n],t)}}class Map extends BaseObject$1{constructor(t){super(),t=t||{},this.on,this.once,this.un;const i=createOptionsInternal(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create(),this.pixelToCoordinateTransform_=create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=i.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=i.controls||defaults$1(),this.interactions=i.interactions||defaults({onFocusOnly:!0}),this.overlays_=i.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue$1(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(i.values);const n=this;t.view&&!(t.view instanceof View$1)&&t.view.then(function(s){n.setView(new View$1(s))}),this.controls.addEventListener(CollectionEventType.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,s=>{const o=s.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){setLayerMapProperty(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const i=t.getId();i!==void 0&&(this.overlayIdIndex_[i.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,i,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const o=n.hitTolerance!==void 0?n.hitTolerance:0,a=n.layerFilter!==void 0?n.layerFilter:TRUE,l=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,o,l,i,null,a,null)}getFeaturesAtPixel(t,i){const n=[];return this.forEachFeatureAtPixel(t,function(s){n.push(s)},i),n}getAllLayers(){const t=[];function i(n){n.forEach(function(s){s instanceof LayerGroup$1?i(s.getLayers()):t.push(s)})}return i(this.getLayers()),t}hasFeatureAtPixel(t,i){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const s=i.layerFilter!==void 0?i.layerFilter:TRUE,o=i.hitTolerance!==void 0?i.hitTolerance:0,a=i.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,a,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),o=n.width/s[0],a=n.height/s[1],l="changedTouches"in t?t.changedTouches[0]:t;return[(l.clientX-n.left)/o,(l.clientY-n.top)/a]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return toUserCoordinate(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const i=this.frameState_;return i?apply(i.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const i=this.overlayIdIndex_[t.toString()];return i!==void 0?i:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(t){const i=this.getLayerGroup();if(t instanceof Collection$1){i.setLayers(t);return}const n=i.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let i=0,n=t.length;i<n;++i){const s=t[i];if(!s.visible)continue;const o=s.layer.getRenderer();if(o&&!o.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const i=fromUserCoordinate(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(i)}getPixelFromCoordinateInternal(t){const i=this.frameState_;return i?apply(i.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,i,n,s){return getTilePriority(this.frameState_,t,i,n,s)}handleBrowserEvent(t,i){i=i||t.type;const n=new MapBrowserEvent$1(i,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const i=t.originalEvent,n=i.type;if(n===PointerEventType.POINTERDOWN||n===EventType.WHEEL||n===EventType.KEYDOWN){const s=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=i.target;if(this.overlayContainerStopEvent_.contains(a)||!(o===s?s.documentElement:o).contains(a))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let o=s.length-1;o>=0;o--){const a=s[o];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){let s=this.maxTilesLoading_,o=s;if(t){const a=t.viewHints;if(a[ViewHint.ANIMATING]||a[ViewHint.INTERACTING]){const l=Date.now()-t.time>8;s=l?0:8,o=l?0:2}}i.getTilesLoading()<s&&(i.reprioritize(),i.loadMoreTiles(s,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent$1(MapEventType.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent$1(MapEventType.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let s=0,o=n.length;s<o;++s)n[s](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)unlistenByKey(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,removeNode(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host)}const t=this.getTarget(),i=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=i,!i)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{i.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer$1(this)),this.mapBrowserEventHandler_=new MapBrowserEventHandler$1(this,this.moveTolerance_);for(const o in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:i;this.targetChangeHandlerKeys_=[listen(n,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(n,EventType.KEYPRESS,this.handleBrowserEvent,this)];const s=i.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(i)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=listen(t,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(t,EventType.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new GroupEvent("addlayer",t)),this.layerGroupPropertyListenerKeys_=[listen(t,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(t,EventType.CHANGE,this.render,this),listen(t,"addlayer",this.handleLayerAdd_,this),listen(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let i=0,n=t.length;i<n;++i){const s=t[i].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){removeLayerMapProperty(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const i=this.getSize(),n=this.getView(),s=this.frameState_;let o=null;if(i!==void 0&&hasArea(i)&&n&&n.isDef()){const a=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:getForViewAndSize(l.center,l.resolution,l.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:a,wantedTiles:{},mapId:getUid(this),renderTargets:{}},l.nextCenter&&l.nextResolution){const h=isNaN(l.nextRotation)?l.rotation:l.nextRotation;o.nextExtent=getForViewAndSize(l.nextCenter,l.nextResolution,h,i)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),s&&(!this.previousExtent_||!isEmpty(this.previousExtent_)&&!equals$1(o.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent$1(MapEventType.MOVESTART,this,s)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!o.viewHints[ViewHint.ANIMATING]&&!o.viewHints[ViewHint.INTERACTING]&&!equals$1(o.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent$1(MapEventType.MOVEEND,this,o)),clone(o.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent$1(MapEventType.POSTRENDER,this,o)),this.renderComplete_=this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const i=this.getLayerGroup();i&&this.handleLayerRemove_(new GroupEvent("removelayer",i)),this.set(MapProperty.LAYERGROUP,t)}setSize(t){this.set(MapProperty.SIZE,t)}setTarget(t){this.set(MapProperty.TARGET,t)}setView(t){if(!t||t instanceof View$1){this.set(MapProperty.VIEW,t);return}this.set(MapProperty.VIEW,new View$1);const i=this;t.then(function(n){i.setView(new View$1(n))})}updateSize(){const t=this.getTargetElement();let i;if(t){const s=getComputedStyle(t),o=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),a=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(o)&&!isNaN(a)&&(i=[o,a],!hasArea(i)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const n=this.getSize();i&&(!n||!equals$2(i,n))&&(this.setSize(i),this.updateViewportSize_())}updateViewportSize_(){const t=this.getView();if(t){let i;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(i=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(i)}}}function createOptionsInternal(r){let t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const i={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new LayerGroup$1({layers:r.layers});i[MapProperty.LAYERGROUP]=n,i[MapProperty.TARGET]=r.target,i[MapProperty.VIEW]=r.view instanceof View$1?r.view:new View$1;let s;r.controls!==void 0&&(Array.isArray(r.controls)?s=new Collection$1(r.controls.slice()):(assert(typeof r.controls.getArray=="function",47),s=r.controls));let o;r.interactions!==void 0&&(Array.isArray(r.interactions)?o=new Collection$1(r.interactions.slice()):(assert(typeof r.interactions.getArray=="function",48),o=r.interactions));let a;return r.overlays!==void 0?Array.isArray(r.overlays)?a=new Collection$1(r.overlays.slice()):(assert(typeof r.overlays.getArray=="function",49),a=r.overlays):a=new Collection$1,{controls:s,interactions:o,keyboardEventTarget:t,overlays:a,values:i}}const Map$1=Map;class LRUCache{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let i=this.oldest_;for(;i;)t(i.value_,i.key_,this),i=i.newer}get(t,i){const n=this.entries_[t];return assert(n!==void 0,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const i=this.entries_[t];return assert(i!==void 0,15),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[t],--this.count_,i.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let i=0,n;for(n=this.newest_;n;n=n.older)t[i++]=n.key_;return t}getValues(){const t=new Array(this.count_);let i=0,n;for(n=this.newest_;n;n=n.older)t[i++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,i){this.get(t),this.entries_[t].value_=i}set(t,i){assert(!(t in this.entries_),16);const n={key_:t,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}const LRUCache$1=LRUCache;function createOrUpdate$1(r,t,i,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=i,n):[r,t,i]}function getKeyZXY(r,t,i){return r+"/"+t+"/"+i}function getKey(r){return getKeyZXY(r[0],r[1],r[2])}function fromKey(r){return r.split("/").map(Number)}function hash(r){return(r[1]<<r[0])+r[2]}function withinExtentAndZ(r,t){const i=r[0],n=r[1],s=r[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const o=t.getFullTileRange(i);return o?o.containsXY(n,s):!0}class TileCache extends LRUCache$1{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=fromKey(t)[0];this.forEach(s=>{s.tileCoord[0]!==n&&(this.remove(getKey(s.tileCoord)),s.release())})}}const TileCache$1=TileCache;class TileRange{constructor(t,i,n,s){this.minX=t,this.maxX=i,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function createOrUpdate(r,t,i,n,s){return s!==void 0?(s.minX=r,s.maxX=t,s.minY=i,s.maxY=n,s):new TileRange(r,t,i,n)}const TileRange$1=TileRange;class FeatureFormat{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,i){if(i){let n=i.dataProjection?get$1(i.dataProjection):this.readProjection(t);i.extent&&n&&n.getUnits()==="tile-pixels"&&(n=get$1(n),n.setWorldExtent(i.extent)),i={dataProjection:n,featureProjection:i.featureProjection}}return this.adaptOptions(i)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return abstract()}readFeature(t,i){return abstract()}readFeatures(t,i){return abstract()}readGeometry(t,i){return abstract()}readProjection(t){return abstract()}writeFeature(t,i){return abstract()}writeFeatures(t,i){return abstract()}writeGeometry(t,i){return abstract()}}function transformGeometryWithOptions(r,t,i){const n=i?get$1(i.featureProjection):null,s=i?get$1(i.dataProjection):null;let o;if(n&&s&&!equivalent(n,s)?o=(t?r.clone():r).transform(t?n:s,t?s:n):o=r,t&&i&&i.decimals!==void 0){const a=Math.pow(10,i.decimals),l=function(h){for(let c=0,u=h.length;c<u;++c)h[c]=Math.round(h[c]*a)/a;return h};o===r&&(o=r.clone()),o.applyTransform(l)}return o}class MultiLineString extends SimpleGeometry$1{constructor(t,i,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,i);else if(i!==void 0&&n)this.setFlatCoordinates(i,t),this.ends_=n;else{let s=this.getLayout();const o=t,a=[],l=[];for(let h=0,c=o.length;h<c;++h){const u=o[h];h===0&&(s=u.getLayout()),extend$2(a,u.getFlatCoordinates()),l.push(a.length)}this.setFlatCoordinates(s,a),this.ends_=l}}appendLineString(t){this.flatCoordinates?extend$2(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,n,s){return s<closestSquaredDistanceXY(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,i,n,s))}getCoordinateAtM(t,i,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(i=i!==void 0?i:!1,n=n!==void 0?n:!1,lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,t,i,n))}getCoordinates(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new LineString$1(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,i=this.ends_,n=this.layout,s=[];let o=0;for(let a=0,l=i.length;a<l;++a){const h=i[a],c=new LineString$1(t.slice(o,h),n);s.push(c),o=h}return s}getFlatMidpoints(){const t=[],i=this.flatCoordinates;let n=0;const s=this.ends_,o=this.stride;for(let a=0,l=s.length;a<l;++a){const h=s[a],c=interpolatePoint(i,n,h,o,.5);extend$2(t,c),n=h}return t}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,n),new MultiLineString(i,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const MultiLineString$1=MultiLineString;class MultiPoint extends SimpleGeometry$1{constructor(t,i){super(),i&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendPoint(t){this.flatCoordinates?extend$2(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new MultiPoint(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,s){if(s<closestSquaredDistanceXY(this.getExtent(),t,i))return s;const o=this.flatCoordinates,a=this.stride;for(let l=0,h=o.length;l<h;l+=a){const c=squaredDistance(t,i,o[l],o[l+1]);if(c<s){s=c;for(let u=0;u<a;++u)n[u]=o[l+u];n.length=a}}return s}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const i=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||i<=t?null:new Point$1(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,i=this.layout,n=this.stride,s=[];for(let o=0,a=t.length;o<a;o+=n){const l=new Point$1(t.slice(o,o+n),i);s.push(l)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const i=this.flatCoordinates,n=this.stride;for(let s=0,o=i.length;s<o;s+=n){const a=i[s],l=i[s+1];if(containsXY(t,a,l))return!0}return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,t,this.stride),this.changed()}}const MultiPoint$1=MultiPoint;function linearRingss(r,t,i,n){const s=[];let o=createEmpty();for(let a=0,l=i.length;a<l;++a){const h=i[a];o=createOrUpdateFromFlatCoordinates(r,t,h[0],n),s.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=h[h.length-1]}return s}class MultiPolygon extends SimpleGeometry$1{constructor(t,i,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){let s=this.getLayout();const o=t,a=[],l=[];for(let h=0,c=o.length;h<c;++h){const u=o[h];h===0&&(s=u.getLayout());const d=a.length,f=u.getEnds();for(let _=0,m=f.length;_<m;++_)f[_]+=d;extend$2(a,u.getFlatCoordinates()),l.push(f)}i=s,t=a,n=l}i!==void 0&&n?(this.setFlatCoordinates(i,t),this.endss_=n):this.setCoordinates(t,i)}appendPolygon(t){let i;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),i=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;extend$2(this.flatCoordinates,t.getFlatCoordinates()),i=t.getEnds().slice();for(let s=0,o=i.length;s<o;++s)i[s]+=n}this.endss_.push(i),this.changed()}clone(){const t=this.endss_.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=this.endss_[s].slice();const n=new MultiPolygon(this.flatCoordinates.slice(),this.layout,i);return n.applyProperties(this),n}closestPointXY(t,i,n,s){return s<closestSquaredDistanceXY(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,i,n,s))}containsXY(t,i){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,i)}getArea(){return linearRingss$1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(i,0,this.endss_,this.stride,t)):i=this.flatCoordinates,inflateMultiCoordinatesArray(i,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new MultiPoint$1(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;linearRingssAreOriented(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new MultiPolygon(i,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let i;if(t===0)i=0;else{const o=this.endss_[t-1];i=o[o.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(i!==0)for(let o=0,a=n.length;o<a;++o)n[o]-=i;return new Polygon$1(this.flatCoordinates.slice(i,s),this.layout,n)}getPolygons(){const t=this.layout,i=this.flatCoordinates,n=this.endss_,s=[];let o=0;for(let a=0,l=n.length;a<l;++a){const h=n[a].slice(),c=h[h.length-1];if(o!==0)for(let d=0,f=h.length;d<f;++d)h[d]-=o;const u=new Polygon$1(i.slice(o,c),t,h);s.push(u),o=c}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateMultiCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const MultiPolygon$1=MultiPolygon;class GeometryCollection extends Geometry$1{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,i=this.geometries_.length;t<i;++t)this.changeEventsKeys_.push(listen(this.geometries_[t],EventType.CHANGE,this.changed,this))}clone(){const t=new GeometryCollection(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,i,n,s){if(s<closestSquaredDistanceXY(this.getExtent(),t,i))return s;const o=this.geometries_;for(let a=0,l=o.length;a<l;++a)s=o[a].closestPointXY(t,i,n,s);return s}containsXY(t,i){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)if(n[s].containsXY(t,i))return!0;return!1}computeExtent(t){createOrUpdateEmpty(t);const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)extend$1(t,i[n].getExtent());return t}getGeometries(){return cloneGeometries(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].getType()===this.getType()?t=t.concat(i[n].getGeometriesArrayRecursive()):t.push(i[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=[],n=this.geometries_;let s=!1;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=l.getSimplifiedGeometry(t);i.push(h),h!==l&&(s=!0)}if(s){const o=new GeometryCollection(null);return o.setGeometriesArray(i),o}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,i){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].rotate(t,i);this.changed()}scale(t,i,n){n||(n=getCenter(this.getExtent()));const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)s[o].scale(t,i,n);this.changed()}setGeometries(t){this.setGeometriesArray(cloneGeometries(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].applyTransform(t);this.changed()}translate(t,i){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].translate(t,i);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cloneGeometries(r){const t=[];for(let i=0,n=r.length;i<n;++i)t.push(r[i].clone());return t}const GeometryCollection$1=GeometryCollection,ERROR_THRESHOLD=.5,MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(t,i,n,s,o,a){this.sourceProj_=t,this.targetProj_=i;let l={};const h=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(v){const T=v[0]+"/"+v[1];return l[T]||(l[T]=h(v)),l[T]},this.maxSourceExtent_=s,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&getWidth(s)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const c=getTopLeft(n),u=getTopRight(n),d=getBottomRight(n),f=getBottomLeft(n),_=this.transformInv_(c),m=this.transformInv_(u),y=this.transformInv_(d),p=this.transformInv_(f),C=MAX_SUBDIVISION+(a?Math.max(0,Math.ceil(Math.log2(getArea(n)/(a*a*256*256)))):0);if(this.addQuad_(c,u,d,f,_,m,y,p,C),this.wrapsXInSource_){let v=1/0;this.triangles_.forEach(function(T,w,I){v=Math.min(v,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-v>this.sourceWorldWidth_/2){const w=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];w[0][0]-v>this.sourceWorldWidth_/2&&(w[0][0]-=this.sourceWorldWidth_),w[1][0]-v>this.sourceWorldWidth_/2&&(w[1][0]-=this.sourceWorldWidth_),w[2][0]-v>this.sourceWorldWidth_/2&&(w[2][0]-=this.sourceWorldWidth_);const I=Math.min(w[0][0],w[1][0],w[2][0]);Math.max(w[0][0],w[1][0],w[2][0])-I<this.sourceWorldWidth_/2&&(T.source=w)}})}l={}}addTriangle_(t,i,n,s,o,a){this.triangles_.push({source:[s,o,a],target:[t,i,n]})}addQuad_(t,i,n,s,o,a,l,h,c){const u=boundingExtent([o,a,l,h]),d=this.sourceWorldWidth_?getWidth(u)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&d>.5&&d<1;let m=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const p=boundingExtent([t,i,n,s]);m=getWidth(p)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||m}!_&&this.sourceProj_.isGlobal()&&d&&(m=d>MAX_TRIANGLE_WIDTH||m)}if(!m&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!intersects$1(u,this.maxSourceExtent_))return;let y=0;if(!m&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(h[0])||!isFinite(h[1]))){if(c>0)m=!0;else if(y=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),y!=1&&y!=2&&y!=4&&y!=8)return}if(c>0){if(!m){const p=[(t[0]+n[0])/2,(t[1]+n[1])/2],C=this.transformInv_(p);let v;_?v=(modulo(o[0],f)+modulo(l[0],f))/2-modulo(C[0],f):v=(o[0]+l[0])/2-C[0];const T=(o[1]+l[1])/2-C[1];m=v*v+T*T>this.errorThresholdSquared_}if(m){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const p=[(i[0]+n[0])/2,(i[1]+n[1])/2],C=this.transformInv_(p),v=[(s[0]+t[0])/2,(s[1]+t[1])/2],T=this.transformInv_(v);this.addQuad_(t,i,p,v,o,a,C,T,c-1),this.addQuad_(v,p,n,s,T,C,l,h,c-1)}else{const p=[(t[0]+i[0])/2,(t[1]+i[1])/2],C=this.transformInv_(p),v=[(n[0]+s[0])/2,(n[1]+s[1])/2],T=this.transformInv_(v);this.addQuad_(t,p,v,s,o,C,T,h,c-1),this.addQuad_(p,i,n,v,C,a,l,T,c-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}y&11||this.addTriangle_(t,n,s,o,l,h),y&14||this.addTriangle_(t,n,i,o,l,a),y&&(y&13||this.addTriangle_(i,s,t,a,h,o),y&7||this.addTriangle_(i,s,n,a,h,l))}calculateSourceExtent(){const t=createEmpty();return this.triangles_.forEach(function(i,n,s){const o=i.source;extendCoordinate(t,o[0]),extendCoordinate(t,o[1]),extendCoordinate(t,o[2])}),t}getTriangles(){return this.triangles_}}const Triangulation$1=Triangulation;let brokenDiagonalRendering_;const canvasPool=[];function drawTestTriangle(r,t,i,n,s){r.beginPath(),r.moveTo(0,0),r.lineTo(t,i),r.lineTo(n,s),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(i,s)),r.restore()}function verifyBrokenDiagonalRendering(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const r=createCanvasContext2D(6,6,canvasPool);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(r,4,5,4,0),drawTestTriangle(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(t,0)||verifyBrokenDiagonalRendering(t,4)||verifyBrokenDiagonalRendering(t,8),releaseCanvas(r),canvasPool.push(r.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(r,t,i,n){const s=transform(i,t,r);let o=getPointResolution(t,n,i);const a=t.getMetersPerUnit();a!==void 0&&(o*=a);const l=r.getMetersPerUnit();l!==void 0&&(o/=l);const h=r.getExtent();if(!h||containsCoordinate(h,s)){const c=getPointResolution(r,o,s)/o;isFinite(c)&&c>0&&(o/=c)}return o}function calculateSourceExtentResolution(r,t,i,n){const s=getCenter(i);let o=calculateSourceResolution(r,t,s,n);return(!isFinite(o)||o<=0)&&forEachCorner(i,function(a){return o=calculateSourceResolution(r,t,a,n),isFinite(o)&&o>0}),o}function render(r,t,i,n,s,o,a,l,h,c,u,d){const f=createCanvasContext2D(Math.round(i*r),Math.round(i*t),canvasPool);if(d||(f.imageSmoothingEnabled=!1),h.length===0)return f.canvas;f.scale(i,i);function _(w){return Math.round(w*i)/i}f.globalCompositeOperation="lighter";const m=createEmpty();h.forEach(function(w,I,O){extend$1(m,w.extent)});const y=getWidth(m),p=getHeight(m),C=createCanvasContext2D(Math.round(i*y/n),Math.round(i*p/n),canvasPool);d||(C.imageSmoothingEnabled=!1);const v=i/n;h.forEach(function(w,I,O){const $=w.extent[0]-m[0],k=-(w.extent[3]-m[3]),b=getWidth(w.extent),W=getHeight(w.extent);w.image.width>0&&w.image.height>0&&C.drawImage(w.image,c,c,w.image.width-2*c,w.image.height-2*c,$*v,k*v,b*v,W*v)});const T=getTopLeft(a);return l.getTriangles().forEach(function(w,I,O){const $=w.source,k=w.target;let b=$[0][0],W=$[0][1],X=$[1][0],Z=$[1][1],Y=$[2][0],le=$[2][1];const B=_((k[0][0]-T[0])/o),z=_(-(k[0][1]-T[1])/o),G=_((k[1][0]-T[0])/o),V=_(-(k[1][1]-T[1])/o),te=_((k[2][0]-T[0])/o),ee=_(-(k[2][1]-T[1])/o),ge=b,M=W;b=0,W=0,X-=ge,Z-=M,Y-=ge,le-=M;const we=[[X,Z,0,0,G-B],[Y,le,0,0,te-B],[0,0,X,Z,V-z],[0,0,Y,le,ee-z]],Q=solveLinearSystem(we);if(Q){if(f.save(),f.beginPath(),isBrokenDiagonalRendering()||!d){f.moveTo(G,V);const ne=4,$e=B-G,Ae=z-V;for(let ye=0;ye<ne;ye++)f.lineTo(G+_((ye+1)*$e/ne),V+_(ye*Ae/(ne-1))),ye!=ne-1&&f.lineTo(G+_((ye+1)*$e/ne),V+_((ye+1)*Ae/(ne-1)));f.lineTo(te,ee)}else f.moveTo(G,V),f.lineTo(B,z),f.lineTo(te,ee);f.clip(),f.transform(Q[0],Q[2],Q[1],Q[3],B,z),f.translate(m[0]-ge,m[3]-M),f.scale(n/i,-n/i),f.drawImage(C.canvas,0,0),f.restore()}}),releaseCanvas(C),canvasPool.push(C.canvas),u&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,l.getTriangles().forEach(function(w,I,O){const $=w.target,k=($[0][0]-T[0])/o,b=-($[0][1]-T[1])/o,W=($[1][0]-T[0])/o,X=-($[1][1]-T[1])/o,Z=($[2][0]-T[0])/o,Y=-($[2][1]-T[1])/o;f.beginPath(),f.moveTo(W,X),f.lineTo(k,b),f.lineTo(Z,Y),f.closePath(),f.stroke()}),f.restore()),f.canvas}class ReprojTile extends Tile$1{constructor(t,i,n,s,o,a,l,h,c,u,d,f){super(o,TileState.IDLE,{interpolate:!!f}),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=s,this.wrappedTileCoord_=a||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const _=s.getTileCoordExtent(this.wrappedTileCoord_),m=this.targetTileGrid_.getExtent();let y=this.sourceTileGrid_.getExtent();const p=m?getIntersection(_,m):_;if(getArea(p)===0){this.state=TileState.EMPTY;return}const C=t.getExtent();C&&(y?y=getIntersection(y,C):y=C);const v=s.getResolution(this.wrappedTileCoord_[0]),T=calculateSourceExtentResolution(t,n,p,v);if(!isFinite(T)||T<=0){this.state=TileState.EMPTY;return}const w=u!==void 0?u:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation$1(t,n,p,y,T*w,v),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=i.getZForResolution(T);let I=this.triangulation_.calculateSourceExtent();if(y&&(t.canWrapX()?(I[1]=clamp(I[1],y[1],y[3]),I[3]=clamp(I[3],y[1],y[3])):I=getIntersection(I,y)),!getArea(I))this.state=TileState.EMPTY;else{const O=i.getTileRangeForExtentAndZ(I,this.sourceZ_);for(let $=O.minX;$<=O.maxX;$++)for(let k=O.minY;k<=O.maxY;k++){const b=c(this.sourceZ_,$,k,l);b&&this.sourceTiles_.push(b)}this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(i=>{i&&i.getState()==TileState.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(i.tileCoord),image:i.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=TileState.ERROR;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],a=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(s,o,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),a,h,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(i=>{const n=i.getState();if(n==TileState.IDLE||n==TileState.LOADING){t++;const s=listen(i,EventType.CHANGE,function(o){const a=i.getState();(a==TileState.LOADED||a==TileState.ERROR||a==TileState.EMPTY)&&(unlistenByKey(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(i,n,s){i.getState()==TileState.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas(this.canvas_.getContext("2d")),canvasPool.push(this.canvas_),this.canvas_=null),super.release()}}const ReprojTile$1=ReprojTile;class CanvasTileLayerRenderer extends CanvasLayerRenderer$1{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=createEmpty(),this.tmpTileRange_=new TileRange$1(0,0,0,0)}isDrawableTile(t){const i=this.getLayer(),n=t.getState(),s=i.getUseInterimTilesOnError();return n==TileState.LOADED||n==TileState.EMPTY||n==TileState.ERROR&&!s}getTile(t,i,n,s){const o=s.pixelRatio,a=s.viewState.projection,l=this.getLayer();let c=l.getSource().getTile(t,i,n,o,a);return c.getState()==TileState.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(t){const i=this.frameState;if(!i)return null;const n=this.getLayer(),s=apply(i.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!containsCoordinate(o,s))return null;const a=i.pixelRatio,l=i.viewState.projection,h=i.viewState,c=n.getRenderSource(),u=c.getTileGridForProjection(h.projection),d=c.getTilePixelRatio(i.pixelRatio);for(let f=u.getZForResolution(h.resolution);f>=u.getMinZoom();--f){const _=u.getTileCoordForCoordAndZ(s,f),m=c.getTile(f,_[1],_[2],a,l);if(!(m instanceof ImageTile$1||m instanceof ReprojTile$1)||m instanceof ReprojTile$1&&m.getState()===TileState.EMPTY)return null;if(m.getState()!==TileState.LOADED)continue;const y=u.getOrigin(f),p=toSize(u.getTileSize(f)),C=u.getResolution(f),v=Math.floor(d*((s[0]-y[0])/C-_[1]*p[0])),T=Math.floor(d*((y[1]-s[1])/C-_[2]*p[1])),w=Math.round(d*c.getGutterForProjection(h.projection));return this.getImageData(m.getImage(),v+w,T+w)}return null}loadedTileCallback(t,i,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,i,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,i){const n=t.layerStatesArray[t.layerIndex],s=t.viewState,o=s.projection,a=s.resolution,l=s.center,h=s.rotation,c=t.pixelRatio,u=this.getLayer(),d=u.getSource(),f=d.getRevision(),_=d.getTileGridForProjection(o),m=_.getZForResolution(a,d.zDirection),y=_.getResolution(m);let p=t.extent;const C=t.viewState.resolution,v=d.getTilePixelRatio(c),T=Math.round(getWidth(p)/C*c),w=Math.round(getHeight(p)/C*c),I=n.extent&&fromUserExtent(n.extent);I&&(p=getIntersection(p,fromUserExtent(n.extent)));const O=y*T/2/v,$=y*w/2/v,k=[l[0]-O,l[1]-$,l[0]+O,l[1]+$],b=_.getTileRangeForExtentAndZ(p,m),W={};W[m]={};const X=this.createLoadedTileFinder(d,o,W),Z=this.tmpExtent,Y=this.tmpTileRange_;this.newTiles_=!1;const le=h?getRotatedViewport(s.center,C,h,t.size):void 0;for(let we=b.minX;we<=b.maxX;++we)for(let Q=b.minY;Q<=b.maxY;++Q){if(h&&!_.tileCoordIntersectsViewport([m,we,Q],le))continue;const ne=this.getTile(m,we,Q,t);if(this.isDrawableTile(ne)){const ye=getUid(this);if(ne.getState()==TileState.LOADED){W[m][ne.tileCoord.toString()]=ne;let De=ne.inTransition(ye);De&&n.opacity!==1&&(ne.endTransition(ye),De=!1),!this.newTiles_&&(De||!this.renderedTiles.includes(ne))&&(this.newTiles_=!0)}if(ne.getAlpha(ye,t.time)===1)continue}const $e=_.getTileCoordChildTileRange(ne.tileCoord,Y,Z);let Ae=!1;$e&&(Ae=X(m+1,$e)),Ae||_.forEachTileCoordParentTileRange(ne.tileCoord,X,Y,Z)}const B=y/a*c/v;compose(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,h,-T/2,-w/2);const z=toString$1(this.pixelTransform);this.useContainer(i,z,this.getBackground(t));const G=this.context,V=G.canvas;makeInverse(this.inversePixelTransform,this.pixelTransform),compose(this.tempTransform,T/2,w/2,B,B,0,-T/2,-w/2),V.width!=T||V.height!=w?(V.width=T,V.height=w):this.containerReused||G.clearRect(0,0,T,w),I&&this.clipUnrotated(G,t,I),d.getInterpolate()||(G.imageSmoothingEnabled=!1),this.preRender(G,t),this.renderedTiles.length=0;let te=Object.keys(W).map(Number);te.sort(ascending);let ee,ge,M;n.opacity===1&&(!this.containerReused||d.getOpaque(t.viewState.projection))?te=te.reverse():(ee=[],ge=[]);for(let we=te.length-1;we>=0;--we){const Q=te[we],ne=d.getTilePixelSize(Q,c,o),Ae=_.getResolution(Q)/y,ye=ne[0]*Ae*B,De=ne[1]*Ae*B,Xe=_.getTileCoordForCoordAndZ(getTopLeft(k),Q),He=_.getTileCoordExtent(Xe),We=apply(this.tempTransform,[v*(He[0]-k[0])/y,v*(k[3]-He[3])/y]),qe=v*d.getGutterForProjection(o),Be=W[Q];for(const Ye in Be){const Ue=Be[Ye],Je=Ue.tileCoord,Qe=Xe[1]-Je[1],et=Math.round(We[0]-(Qe-1)*ye),Ve=Xe[2]-Je[2],nt=Math.round(We[1]-(Ve-1)*De),Se=Math.round(We[0]-Qe*ye),Ie=Math.round(We[1]-Ve*De),Me=et-Se,Oe=nt-Ie,ze=m===Q,x=ze&&Ue.getAlpha(getUid(this),t.time)!==1;let g=!1;if(!x)if(ee){M=[Se,Ie,Se+Me,Ie,Se+Me,Ie+Oe,Se,Ie+Oe];for(let P=0,N=ee.length;P<N;++P)if(m!==Q&&Q<ge[P]){const A=ee[P];intersects$1([Se,Ie,Se+Me,Ie+Oe],[A[0],A[3],A[4],A[7]])&&(g||(G.save(),g=!0),G.beginPath(),G.moveTo(M[0],M[1]),G.lineTo(M[2],M[3]),G.lineTo(M[4],M[5]),G.lineTo(M[6],M[7]),G.moveTo(A[6],A[7]),G.lineTo(A[4],A[5]),G.lineTo(A[2],A[3]),G.lineTo(A[0],A[1]),G.clip())}ee.push(M),ge.push(Q)}else G.clearRect(Se,Ie,Me,Oe);this.drawTileImage(Ue,t,Se,Ie,Me,Oe,qe,ze),ee&&!x?(g&&G.restore(),this.renderedTiles.unshift(Ue)):this.renderedTiles.push(Ue),this.updateUsedTiles(t.usedTiles,d,Ue)}}return this.renderedRevision=f,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,k),this.renderedExtent_=k,this.renderedPixelRatio=c,this.renderedProjection=o,this.manageTilePyramid(t,d,_,c,o,p,m,u.getPreload()),this.scheduleExpireCache(t,d),this.postRender(G,t),n.extent&&G.restore(),G.imageSmoothingEnabled=!0,z!==V.style.transform&&(V.style.transform=z),this.container}drawTileImage(t,i,n,s,o,a,l,h){const c=this.getTileImage(t);if(!c)return;const u=getUid(this),d=i.layerStatesArray[i.layerIndex],f=d.opacity*(h?t.getAlpha(u,i.time):1),_=f!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(c,l,l,c.width-2*l,c.height-2*l,n,s,o,a),_&&this.context.restore(),f!==d.opacity?i.animate=!0:h&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,i){if(i.canExpireCache()){const n=function(s,o,a){const l=getUid(s);l in a.usedTiles&&s.expireCache(a.viewState.projection,a.usedTiles[l])}.bind(null,i);t.postRenderFunctions.push(n)}}updateUsedTiles(t,i,n){const s=getUid(i);s in t||(t[s]={}),t[s][n.getKey()]=!0}manageTilePyramid(t,i,n,s,o,a,l,h,c){const u=getUid(i);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],f=t.tileQueue,_=n.getMinZoom(),m=t.viewState.rotation,y=m?getRotatedViewport(t.viewState.center,t.viewState.resolution,m,t.size):void 0;let p=0,C,v,T,w,I,O;for(O=_;O<=l;++O)for(v=n.getTileRangeForExtentAndZ(a,O,v),T=n.getResolution(O),w=v.minX;w<=v.maxX;++w)for(I=v.minY;I<=v.maxY;++I)m&&!n.tileCoordIntersectsViewport([O,w,I],y)||(l-O<=h?(++p,C=i.getTile(O,w,I,s,o),C.getState()==TileState.IDLE&&(d[C.getKey()]=!0,f.isKeyQueued(C.getKey())||f.enqueue([C,u,n.getTileCoordCenter(C.tileCoord),T])),c!==void 0&&c(C)):i.useTile(O,w,I,o));i.updateCacheSize(p,o)}}const CanvasTileLayerRenderer$1=CanvasTileLayerRenderer,TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},tmpTileCoord=[0,0,0],DECIMALS=5;class TileGrid{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,assert(isSorted(this.resolutions_,function(s,o){return o-s},!0),17);let i;if(!t.origins){for(let s=0,o=this.resolutions_.length-1;s<o;++s)if(!i)i=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,assert(this.origins_.length==this.resolutions_.length,20));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(n)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(s,o){const a=new TileRange$1(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const l=this.getTileRangeForExtentAndZ(n,o);a.minX=Math.max(l.minX,a.minX),a.maxX=Math.min(l.maxX,a.maxX),a.minY=Math.max(l.minY,a.minY),a.maxY=Math.min(l.maxY,a.maxY)}return a},this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,i,n){const s=this.getTileRangeForExtentAndZ(t,i);for(let o=s.minX,a=s.maxX;o<=a;++o)for(let l=s.minY,h=s.maxY;l<=h;++l)n([i,o,l])}forEachTileCoordParentTileRange(t,i,n,s){let o,a,l,h=null,c=t[0]-1;for(this.zoomFactor_===2?(a=t[1],l=t[2]):h=this.getTileCoordExtent(t,s);c>=this.minZoom;){if(this.zoomFactor_===2?(a=Math.floor(a/2),l=Math.floor(l/2),o=createOrUpdate(a,a,l,l,n)):o=this.getTileRangeForExtentAndZ(h,c,n),i(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,i,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const o=t[1]*2,a=t[2]*2;return createOrUpdate(o,o+1,a,a+1,i)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,i)}return null}getTileRangeForTileCoordAndZ(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;const s=t[0],o=t[1],a=t[2];if(i===s)return createOrUpdate(o,a,o,a,n);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,i-s),c=Math.floor(o*h),u=Math.floor(a*h);if(i<s)return createOrUpdate(c,c,u,u,n);const d=Math.floor(h*(o+1))-1,f=Math.floor(h*(a+1))-1;return createOrUpdate(c,d,u,f,n)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,i,n)}getTileRangeExtent(t,i,n){const s=this.getOrigin(t),o=this.getResolution(t),a=toSize(this.getTileSize(t),this.tmpSize_),l=s[0]+i.minX*a[0]*o,h=s[0]+(i.maxX+1)*a[0]*o,c=s[1]+i.minY*a[1]*o,u=s[1]+(i.maxY+1)*a[1]*o;return createOrUpdate$2(l,c,h,u,n)}getTileRangeForExtentAndZ(t,i,n){this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,tmpTileCoord);const s=tmpTileCoord[1],o=tmpTileCoord[2];this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,tmpTileCoord);const a=tmpTileCoord[1],l=tmpTileCoord[2];return createOrUpdate(s,a,o,l,n)}getTileCoordCenter(t){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=toSize(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*s[0]*n,i[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,i){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),o=toSize(this.getTileSize(t[0]),this.tmpSize_),a=n[0]+t[1]*o[0]*s,l=n[1]-(t[2]+1)*o[1]*s,h=a+o[0]*s,c=l+o[1]*s;return createOrUpdate$2(a,l,h,c,i)}getTileCoordForCoordAndResolution(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}getTileCoordForXYAndResolution_(t,i,n,s,o){const a=this.getZForResolution(n),l=n/this.getResolution(a),h=this.getOrigin(a),c=toSize(this.getTileSize(a),this.tmpSize_);let u=l*(t-h[0])/n/c[0],d=l*(h[1]-i)/n/c[1];return s?(u=ceil(u,DECIMALS)-1,d=ceil(d,DECIMALS)-1):(u=floor(u,DECIMALS),d=floor(d,DECIMALS)),createOrUpdate$1(a,u,d,o)}getTileCoordForXYAndZ_(t,i,n,s,o){const a=this.getOrigin(n),l=this.getResolution(n),h=toSize(this.getTileSize(n),this.tmpSize_);let c=(t-a[0])/l/h[0],u=(a[1]-i)/l/h[1];return s?(c=ceil(c,DECIMALS)-1,u=ceil(u,DECIMALS)-1):(c=floor(c,DECIMALS),u=floor(u,DECIMALS)),createOrUpdate$1(n,c,u,o)}getTileCoordForCoordAndZ(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,i){const n=linearFindNearest(this.resolutions_,t,i||0);return clamp(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,i){return intersectsLinearRing(i,0,i.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const i=this.resolutions_.length,n=new Array(i);for(let s=this.minZoom;s<i;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}}const TileGrid$1=TileGrid,TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function getForProjection(r){let t=r.getDefaultTileGrid();return t||(t=createForProjection(r),r.setDefaultTileGrid(t)),t}function wrapX(r,t,i){const n=t[0],s=r.getTileCoordCenter(t),o=extentFromProjection(i);if(!containsCoordinate(o,s)){const a=getWidth(o),l=Math.ceil((o[0]-s[0])/a);return s[0]+=a*l,r.getTileCoordForCoordAndZ(s,n)}return t}function createForExtent(r,t,i,n){n=n!==void 0?n:"top-left";const s=resolutionsFromExtent(r,t,i);return new TileGrid$1({extent:r,origin:getCorner(r,n),resolutions:s,tileSize:i})}function createXYZ(r){const t=r||{},i=t.extent||get$1("EPSG:3857").getExtent(),n={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:resolutionsFromExtent(i,t.maxZoom,t.tileSize,t.maxResolution)};return new TileGrid$1(n)}function resolutionsFromExtent(r,t,i,n){t=t!==void 0?t:DEFAULT_MAX_ZOOM,i=toSize(i!==void 0?i:DEFAULT_TILE_SIZE);const s=getHeight(r),o=getWidth(r);n=n>0?n:Math.max(o/i[0],s/i[1]);const a=t+1,l=new Array(a);for(let h=0;h<a;++h)l[h]=n/Math.pow(2,h);return l}function createForProjection(r,t,i,n){const s=extentFromProjection(r);return createForExtent(s,t,i,n)}function extentFromProjection(r){r=get$1(r);let t=r.getExtent();if(!t){const i=180*METERS_PER_UNIT$1.degrees/r.getMetersPerUnit();t=createOrUpdate$2(-i,-i,i,i)}return t}class TileSource extends Source$1{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const i=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tileCache=new TileCache$1(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,i){const n=this.getTileCacheForProjection(t);n&&n.expireCache(i)}forEachLoadedTile(t,i,n,s){const o=this.getTileCacheForProjection(t);if(!o)return!1;let a=!0,l,h,c;for(let u=n.minX;u<=n.maxX;++u)for(let d=n.minY;d<=n.maxY;++d)h=getKeyZXY(i,u,d),c=!1,o.containsKey(h)&&(l=o.get(h),c=l.getState()===TileState.LOADED,c&&(c=s(l)!==!1)),c||(a=!1);return a}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const i=t?this.getTileGridForProjection(t):this.tileGrid;return i?i.getResolutions():null}getTile(t,i,n,s,o){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:getForProjection(t)}getTileCacheForProjection(t){const i=this.getProjection();return assert(i===null||equivalent(i,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,i,n){const s=this.getTileGridForProjection(n),o=this.getTilePixelRatio(i),a=toSize(s.getTileSize(t),this.tmpSize);return o==1?a:scale(a,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,i){i=i!==void 0?i:this.getProjection();const n=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=wrapX(n,t,i)),withinExtentAndZ(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,i){const n=this.getTileCacheForProjection(i);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,i,n,s){}}class TileSourceEvent extends Event{constructor(t,i){super(t),this.tile=i}}const TileSource$1=TileSource;function createFromTemplate(r,t){const i=/\{z\}/g,n=/\{x\}/g,s=/\{y\}/g,o=/\{-y\}/g;return function(a,l,h){if(a)return r.replace(i,a[0].toString()).replace(n,a[1].toString()).replace(s,a[2].toString()).replace(o,function(){const c=a[0],u=t.getFullTileRange(c);return assert(u,55),(u.getHeight()-a[2]-1).toString()})}}function createFromTemplates(r,t){const i=r.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=createFromTemplate(r[s],t);return createFromTileUrlFunctions(n)}function createFromTileUrlFunctions(r){return r.length===1?r[0]:function(t,i,n){if(!t)return;const s=hash(t),o=modulo(s,r.length);return r[o](t,i,n)}}function expandUrl(r){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(r);if(i){const n=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let o;for(o=n;o<=s;++o)t.push(r.replace(i[0],String.fromCharCode(o)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(r),i){const n=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=n;s++)t.push(r.replace(i[0],s.toString()));return t}return t.push(r),t}class UrlTile extends TileSource$1{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const i=t.target,n=getUid(i),s=i.getState();let o;s==TileState.LOADING?(this.tileLoadingKeys_[n]=!0,o=TileEventType.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=s==TileState.ERROR?TileEventType.TILELOADERROR:s==TileState.LOADED?TileEventType.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new TileSourceEvent(o,i))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,i){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof i<"u"?this.setKey(i):this.changed()}setUrl(t){const i=expandUrl(t);this.urls=i,this.setUrls(i)}setUrls(t){this.urls=t;const i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(t,this.tileGrid),i):this.setKey(i)}tileUrlFunction(t,i,n){}useTile(t,i,n){const s=getKeyZXY(t,i,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const UrlTile$1=UrlTile;class JSONFeature extends FeatureFormat{constructor(){super()}getType(){return"json"}readFeature(t,i){return this.readFeatureFromObject(getObject(t),this.getReadOptions(t,i))}readFeatures(t,i){return this.readFeaturesFromObject(getObject(t),this.getReadOptions(t,i))}readFeatureFromObject(t,i){return abstract()}readFeaturesFromObject(t,i){return abstract()}readGeometry(t,i){return this.readGeometryFromObject(getObject(t),this.getReadOptions(t,i))}readGeometryFromObject(t,i){return abstract()}readProjection(t){return this.readProjectionFromObject(getObject(t))}readProjectionFromObject(t){return abstract()}writeFeature(t,i){return JSON.stringify(this.writeFeatureObject(t,i))}writeFeatureObject(t,i){return abstract()}writeFeatures(t,i){return JSON.stringify(this.writeFeaturesObject(t,i))}writeFeaturesObject(t,i){return abstract()}writeGeometry(t,i){return JSON.stringify(this.writeGeometryObject(t,i))}writeGeometryObject(t,i){return abstract()}}function getObject(r){if(typeof r=="string"){const t=JSON.parse(r);return t||null}else if(r!==null)return r;return null}const JSONFeature$1=JSONFeature;class GeoJSON extends JSONFeature$1{constructor(t){t=t||{},super(),this.dataProjection=get$1(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=get$1(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,i){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const s=readGeometry(n.geometry,i),o=new Feature$1;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&o.setGeometryName(n.geometry_name),o.setGeometry(s),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o}readFeaturesFromObject(t,i){const n=t;let s=null;if(n.type==="FeatureCollection"){const o=t;s=[];const a=o.features;for(let l=0,h=a.length;l<h;++l)s.push(this.readFeatureFromObject(a[l],i))}else s=[this.readFeatureFromObject(t,i)];return s}readGeometryFromObject(t,i){return readGeometry(t,i)}readProjectionFromObject(t){const i=t.crs;let n;return i?i.type=="name"?n=get$1(i.properties.name):i.type==="EPSG"?n=get$1("EPSG:"+i.properties.code):assert(!1,36):n=this.dataProjection,n}writeFeatureObject(t,i){i=this.adaptOptions(i);const n={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(n.id=s),!t.hasProperties())return n;const o=t.getProperties(),a=t.getGeometry();return a&&(n.geometry=writeGeometry(a,i),delete o[t.getGeometryName()]),isEmpty$1(o)||(n.properties=o),n}writeFeaturesObject(t,i){i=this.adaptOptions(i);const n=[];for(let s=0,o=t.length;s<o;++s)n.push(this.writeFeatureObject(t[s],i));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,i){return writeGeometry(t,this.adaptOptions(i))}}function readGeometry(r,t){if(!r)return null;let i;switch(r.type){case"Point":{i=readPointGeometry(r);break}case"LineString":{i=readLineStringGeometry(r);break}case"Polygon":{i=readPolygonGeometry(r);break}case"MultiPoint":{i=readMultiPointGeometry(r);break}case"MultiLineString":{i=readMultiLineStringGeometry(r);break}case"MultiPolygon":{i=readMultiPolygonGeometry(r);break}case"GeometryCollection":{i=readGeometryCollectionGeometry(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return transformGeometryWithOptions(i,!1,t)}function readGeometryCollectionGeometry(r,t){const i=r.geometries.map(function(n){return readGeometry(n,t)});return new GeometryCollection$1(i)}function readPointGeometry(r){return new Point$1(r.coordinates)}function readLineStringGeometry(r){return new LineString$1(r.coordinates)}function readMultiLineStringGeometry(r){return new MultiLineString$1(r.coordinates)}function readMultiPointGeometry(r){return new MultiPoint$1(r.coordinates)}function readMultiPolygonGeometry(r){return new MultiPolygon$1(r.coordinates)}function readPolygonGeometry(r){return new Polygon$1(r.coordinates)}function writeGeometry(r,t){r=transformGeometryWithOptions(r,!0,t);const i=r.getType();let n;switch(i){case"Point":{n=writePointGeometry(r);break}case"LineString":{n=writeLineStringGeometry(r);break}case"Polygon":{n=writePolygonGeometry(r,t);break}case"MultiPoint":{n=writeMultiPointGeometry(r);break}case"MultiLineString":{n=writeMultiLineStringGeometry(r);break}case"MultiPolygon":{n=writeMultiPolygonGeometry(r,t);break}case"GeometryCollection":{n=writeGeometryCollectionGeometry(r,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+i)}return n}function writeGeometryCollectionGeometry(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return writeGeometry(n,t)})}}function writeLineStringGeometry(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function writeMultiLineStringGeometry(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function writeMultiPointGeometry(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function writeMultiPolygonGeometry(r,t){let i;return t&&(i=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(i)}}function writePointGeometry(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function writePolygonGeometry(r,t){let i;return t&&(i=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(i)}}const GeoJSON$1=GeoJSON;class BaseTileLayer extends Layer$1{constructor(t){t=t||{};const i=Object.assign({},t);delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(t){this.set(TileProperty.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const BaseTileLayer$1=BaseTileLayer;class TileLayer extends BaseTileLayer$1{constructor(t){super(t)}createRenderer(){return new CanvasTileLayerRenderer$1(this)}}const TileLayer$1=TileLayer;class TileImage extends UrlTile$1{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:ImageTile$1,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,i){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?i:{});for(const s in this.tileCacheForProjection){const o=this.tileCacheForProjection[s];o.expireCache(o==n?i:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!equivalent(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!equivalent(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const i=this.getProjection();if(this.tileGrid&&(!i||equivalent(i,t)))return this.tileGrid;const n=getUid(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=getForProjection(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const i=this.getProjection();if(!i||equivalent(i,t))return this.tileCache;const n=getUid(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new TileCache$1(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,i,n,s,o,a){const l=[t,i,n],h=this.getTileCoordForTileUrlFunction(l,o),c=h?this.tileUrlFunction(h,s,o):void 0,u=new this.tileClass(l,c!==void 0?TileState.IDLE:TileState.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=a,u.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,i,n,s,o){const a=this.getProjection();if(!a||!o||equivalent(a,o))return this.getTileInternal(t,i,n,s,a||o);const l=this.getTileCacheForProjection(o),h=[t,i,n];let c;const u=getKey(h);l.containsKey(u)&&(c=l.get(u));const d=this.getKey();if(c&&c.key==d)return c;const f=this.getTileGridForProjection(a),_=this.getTileGridForProjection(o),m=this.getTileCoordForTileUrlFunction(h,o),y=new ReprojTile$1(a,f,o,_,h,m,this.getTilePixelRatio(s),this.getGutter(),(p,C,v,T)=>this.getTileInternal(p,C,v,T,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return y.key=d,c?(y.interimTile=c,y.refreshInterimChain(),l.replace(u,y)):l.set(u,y),y}getTileInternal(t,i,n,s,o){let a=null;const l=getKeyZXY(t,i,n),h=this.getKey();if(!this.tileCache.containsKey(l))a=this.createTile_(t,i,n,s,o,h),this.tileCache.set(l,a);else if(a=this.tileCache.get(l),a.key!=h){const c=a;a=this.createTile_(t,i,n,s,o,h),c.getState()==TileState.IDLE?a.interimTile=c.interimTile:a.interimTile=c,a.refreshInterimChain(),this.tileCache.replace(l,a)}return a}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const i in this.tileCacheForProjection)this.tileCacheForProjection[i].clear();this.changed()}}setTileGridForProjection(t,i){const n=get$1(t);if(n){const s=getUid(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=i)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function defaultTileLoadFunction(r,t){r.getImage().src=t}const TileImage$1=TileImage,UNITS_PROP="units",LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28;class ScaleLine extends Control$1{constructor(t){t=t||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:t.render,target:t.target}),this.on,this.once,this.un;const n=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+CLASS_UNSELECTABLE,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(UNITS_PROP,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(UNITS_PROP)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(UNITS_PROP,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=t.center,n=t.projection,s=this.getUnits(),o=s=="degrees"?"degrees":"m";let a=getPointResolution(n,t.resolution,i,o);const l=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,h=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI:void 0;let c=l*a,u="";if(s=="degrees"){const T=METERS_PER_UNIT$1.degrees;c*=T,c<T/60?(u="″",a*=3600):c<T?(u="′",a*=60):u="°"}else s=="imperial"?c<.9144?(u="in",a/=.0254):c<1609.344?(u="ft",a/=.3048):(u="mi",a/=1609.344):s=="nautical"?(a/=1852,u="NM"):s=="metric"?c<.001?(u="μm",a*=1e6):c<1?(u="mm",a*=1e3):c<1e3?u="m":(u="km",a/=1e3):s=="us"?c<.9144?(u="in",a*=39.37):c<1609.344?(u="ft",a/=.30480061):(u="mi",a/=1609.3472):assert(!1,33);let d=3*Math.floor(Math.log(l*a)/Math.log(10)),f,_,m,y,p,C;for(;;){m=Math.floor(d/3);const T=Math.pow(10,m);if(f=LEADING_DIGITS[(d%3+3)%3]*T,_=Math.round(f/a),isNaN(_)){this.element.style.display="none",this.renderedVisible_=!1;return}if(h!==void 0&&_>=h){f=y,_=p,m=C;break}else if(_>=l)break;y=f,p=_,C=m,++d}const v=this.scaleBar_?this.createScaleBar(_,f,u):f.toFixed(m<0?-m:0)+" "+u;this.renderedHTML_!=v&&(this.innerElement_.innerHTML=v,this.renderedHTML_=v),this.renderedWidth_!=_&&(this.innerElement_.style.width=_+"px",this.renderedWidth_=_),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,i,n){const s=this.getScaleForResolution(),o=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),a=this.scaleBarSteps_,l=t/a,h=[this.createMarker("absolute")];for(let u=0;u<a;++u){const d=u%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";h.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${l}px;"></div>`+this.createMarker("relative")+(u%2===0||a===2?this.createStepText(u,t,!1,i,n):"")+"</div>")}return h.push(this.createStepText(a,t,!0,i,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+o+"</div>":"")+h.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,i,n,s,o){const l=(t===0?0:Math.round(s/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+o),h=t===0?-3:i/this.scaleBarSteps_*-1,c=t===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${h}px;text-align: ${t===0?"left":"center"};min-width: ${c}px;left: ${n?i+"px":"unset"};">`+l+"</div>"}getScaleForResolution(){const t=getPointResolution(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||DEFAULT_DPI,n=1e3/25.4;return t*n*i}render(t){const i=t.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}const ScaleLine$1=ScaleLine,SelectEventType={SELECT:"select"};class SelectEvent extends Event{constructor(t,i,n,s){super(t),this.selected=i,this.deselected=n,this.mapBrowserEvent=s}}const originalFeatureStyles={};class Select extends Interaction$1{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:singleClick,this.addCondition_=t.addCondition?t.addCondition:never,this.removeCondition_=t.removeCondition?t.removeCondition:never,this.toggleCondition_=t.toggleCondition?t.toggleCondition:shiftKeyOnly,this.multi_=t.multi?t.multi:!1,this.filter_=t.filter?t.filter:TRUE,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:getDefaultStyleFunction(),this.features_=t.features||new Collection$1;let i;if(t.layers)if(typeof t.layers=="function")i=t.layers;else{const n=t.layers;i=function(s){return n.includes(s)}}else i=TRUE;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,i){this.featureLayerAssociation_[getUid(t)]=i}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[getUid(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.addEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.removeEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const i=t.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof VectorLayer$1&&s.getSource()&&s.getSource().hasFeature(i))return s});n&&this.addFeatureLayerAssociation_(i,n)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const i=getUid(t);i in originalFeatureStyles||(originalFeatureStyles[i]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const i=this.getMap().getInteractions().getArray();for(let s=i.length-1;s>=0;--s){const o=i[s];if(o!==this&&o instanceof Select&&o.getStyle()&&o.getFeatures().getArray().lastIndexOf(t)!==-1){t.setStyle(o.getStyle());return}}const n=getUid(t);t.setStyle(originalFeatureStyles[n]),delete originalFeatureStyles[n]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[getUid(t)]}handleEvent(t){if(!this.condition_(t))return!0;const i=this.addCondition_(t),n=this.removeCondition_(t),s=this.toggleCondition_(t),o=!i&&!n&&!s,a=t.map,l=this.getFeatures(),h=[],c=[];if(o){clear(this.featureLayerAssociation_),a.forEachFeatureAtPixel(t.pixel,(u,d)=>{if(!(!(u instanceof Feature$1)||!this.filter_(u,d)))return this.addFeatureLayerAssociation_(u,d),c.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.getLength()-1;u>=0;--u){const d=l.item(u),f=c.indexOf(d);f>-1?c.splice(f,1):(l.remove(d),h.push(d))}c.length!==0&&l.extend(c)}else{a.forEachFeatureAtPixel(t.pixel,(u,d)=>{if(!(!(u instanceof Feature$1)||!this.filter_(u,d)))return(i||s)&&!l.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,d),c.push(u)):(n||s)&&l.getArray().includes(u)&&(h.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=h.length-1;u>=0;--u)l.remove(h[u]);l.extend(c)}return(c.length>0||h.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,c,h,t)),!0}}function getDefaultStyleFunction(){const r=createEditingStyle();return extend$2(r.Polygon,r.LineString),extend$2(r.GeometryCollection,r.LineString),function(t){return t.getGeometry()?r[t.getGeometry().getType()]:null}}const Select$1=Select;class XYZ extends TileImage$1{constructor(t){t=t||{};const i=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:createXYZ({extent:extentFromProjection(i),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const XYZ$1=XYZ,ATTRIBUTION='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class OSM extends XYZ$1{constructor(t){t=t||{};let i;t.attributions!==void 0?i=t.attributions:i=[ATTRIBUTION];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:i,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}const OSM$1=OSM,backgroundMaps={CH:{source:new XYZ$1({url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg"}),visible:!0,preview:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/15/17174/11536.jpeg"},"CH(b/w)":{source:new XYZ$1({url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-grau/default/current/3857/{z}/{x}/{y}.jpeg"}),visible:!1,preview:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-grau/default/current/3857/15/17174/11536.jpeg"},"CH(ski)":{source:new XYZ$1({url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe-winter/default/current/3857/{z}/{x}/{y}.jpeg"}),visible:!1,preview:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe-winter/default/current/3857/15/17174/11536.jpeg"},OSM:{source:new OSM$1,visible:!1,preview:"https://tile.openstreetmap.org/15/17174/11536.png"},OTM:{source:new OSM$1({url:"https://{a-c}.tile.opentopomap.org/{z}/{x}/{y}.png",attributions:'Kartendaten: © <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>-Mitwirkende, SRTM | Kartendarstellung: © <a href="http://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}),visible:!1,preview:"https://c.tile.opentopomap.org/15/17174/11536.png"}},overlayMaps={slope:{source:new XYZ$1({url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.hangneigung-ueber_30/default/current/3857/{z}/{x}/{y}.png"}),visible:!1,preview:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.hangneigung-ueber_30/default/current/3857/15/17174/11536.png",opacity:.5},ski:{source:new XYZ$1({url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo-karto.skitouren/default/current/3857/{z}/{x}/{y}.png"}),visible:!1,preview:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo-karto.skitouren/default/current/3857/15/17174/11536.png",opacity:1}},sportsCategories$1={BackcountryNordicSki:{color:"#1982C4",icon:"fa-solid fa-person-skiing-nordic",alias:["BackcountrySki","NordicSki"]},WalkRun:{color:"#FF595E",icon:"fa-solid fa-walking",alias:["Walk","Run","Hike","RockClimbing","Snowshoe"]},Ride:{color:"#8AC926",icon:"fa-solid fa-biking",alias:["Ride","VirtualRide"]},AlpineSki:{color:"#3FA7D6",icon:"fa-solid fa-person-skiing",alias:["AlpineSki"]},Misc:{color:"#6A4C93",icon:"fa-solid fa-person-circle-question",alias:[]}},activityFilters$1={start_date_local:{icon:"fa-solid fa-calendar-days",transform:"new Date(value).getTime()",tooltip:"new Date(value).toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'})",step:6048e5,decimals:0},distance:{icon:"fa-solid fa-ruler-horizontal",transform:"value",tooltip:"`${Math.round(value)/1000}km`",step:100,decimals:0},total_elevation_gain:{icon:"fa-solid fa-ruler-vertical",transform:"value",tooltip:"`${Math.round(value)}m`",step:10,decimals:0}},tableColumns$1={name:{title:"TOUR",body:"`<a href='https://www.strava.com/activities/${feature.id_}' style='color:${colorMap[feature.values_['type']]}'>${feature.values_['name']}</a>`"},total_elevation_gain:{title:"ELEV",body:"feature.values_['total_elevation_gain'].toFixed(0)"},distance:{title:"DIST",body:"(feature.values_['distance']/1000).toFixed(1)"},elapsed_time:{title:"TIME",body:"new Date(feature.values_['elapsed_time']*1000).toISOString().substr(11, 8)"},start_date_local:{title:"DATE",body:"new Date(feature.values_['start_date_local']).toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'})",sort:"new Date(feature.values_['start_date_local']).getTime()"}},ac={sportsCategories:sportsCategories$1,activityFilters:activityFilters$1,tableColumns:tableColumns$1};var activityFilters=ac.activityFilters;const sportsCategories=ac.sportsCategories,tableColumns=ac.tableColumns;var shownTracks={};const colorMap=new Proxy({},{get:(r,t)=>t in r?r[t]:sportsCategories.Misc.color}),aliasMap=new Proxy({},{get:(r,t)=>t in r?r[t]:"Misc"});Object.entries(sportsCategories).forEach(function([r,t]){document.getElementById("activity-switcher").innerHTML+=`<button id="${r}" type="button" title="${r}" style="color:${t.color}" class="active"><i class="${t.icon}"></i></button>`,shownTracks[r]=!0,t.alias.forEach(function(i){aliasMap[i]=r,colorMap[i]=t.color})});const highlightColor="#FFC107";document.body.style.setProperty("--highlight-color",highlightColor);document.getElementById("layer-switcher-content").getElementsByTagName("ul")[0].innerHTML=Object.entries(backgroundMaps).map(function([r,t]){return`<button id=${r} class="${t.visible?"selected-true":""}"><div class="layer-preview" style="background-image: url(${t.preview});"></div><label>${r}</label></button>`}).join(`
`);document.getElementById("layer-switcher-content").getElementsByTagName("ul")[1].innerHTML=Object.entries(overlayMaps).map(function([r,t]){return`<button id=${r} class="${t.visible?"selected-true":""}"><div class="layer-preview" style="background-image: url(${t.preview});"></div><label>${r}</label></button>`}).join(`
`);var backgroundLayers=Object.entries(backgroundMaps).map(function([r,t]){const i=new TileLayer$1({id:r,title:r,type:"base",visible:t.visible,source:t.source});return document.getElementById(r).onclick=function(){setActiveMap(r)},i.on("change:visible",function(n){t.visible=!t.visible,document.getElementById("layer-switcher-content").getElementsByTagName("button")[r].classList.toggle("selected-true")}),i}),overlayLayers=Object.entries(overlayMaps).map(function([r,t]){const i=new TileLayer$1({id:r,title:r,type:"overlay",visible:t.visible,source:t.source,opacity:t.opacity});return document.getElementById(r).onclick=function(){i.setVisible(!i.getVisible())},i.on("change:visible",function(n){t.visible=!t.visible,document.getElementById("layer-switcher-content").getElementsByTagName("button")[r].classList.toggle("selected-true")}),i});function setActiveMap(r){backgroundLayers.forEach(function(t){t.setVisible(t.get("id")==r)})}const baseMaps=new LayerGroup$1({title:"Karte",layers:backgroundLayers}),overlays=new LayerGroup$1({title:"Overlays",layers:overlayLayers}),view=new View$1({projection:"EPSG:3857",center:[9e5,59e5],zoom:8}),trackSource=new VectorSource$1({format:new GeoJSON$1,url:"./activities_geo.json"});trackSource.on("featuresloadend",function(e){var prev_legend_element="activity-switcher";Object.entries(activityFilters).forEach(function([id,filter]){const activity_values=trackSource.getFeatures().map(function(r){return new Function("value","return "+filter.transform)(r.values_[id])});noUiSlider.create(document.getElementById(`${id}-slider`),{range:{min:Math.min(...activity_values),max:Math.max(...activity_values)},step:filter.step,start:[Math.min(...activity_values),Math.max(...activity_values)],format:wNumb({decimals:filter.decimals}),connect:!0,tooltips:{to:function(value){return eval(filter.tooltip)}}}),filter.limits=[Math.min(...activity_values),Math.max(...activity_values)],document.getElementById(`${id}-slider`).noUiSlider.on("change",function(r,t){filter.limits=r,trackLayer.setStyle(trackStyleUnselected)}),document.getElementById(`${id}-label`).style.top=document.getElementById(prev_legend_element).getBoundingClientRect().bottom+8+"px",document.getElementById(`${id}-label`).nextSibling.style.top=document.getElementById(prev_legend_element).getBoundingClientRect().bottom+14+"px",prev_legend_element=`${id}-label`})});const trackLayer=new VectorLayer$1({source:trackSource,style:trackStyleUnselected}),map=new Map$1({target:"map",controls:defaults$1().extend([new ScaleLine$1({units:"metric"})]),layers:[baseMaps,overlays,trackLayer],view});function trackStyle(r,t){var i=[];if(t==-1)return new Style$1({});if(t>=1)i.push(new Style$1({stroke:new Stroke$1({color:r,width:4*t}),zIndex:100})),i.push(new Style$1({stroke:new Stroke$1({color:"white",width:t}),zIndex:100}));else{var n=asArray(r).slice();n[3]=.75,i.push(new Style$1({stroke:new Stroke$1({color:n,width:4})}))}return i}function featureVisible(r){if(!shownTracks[aliasMap[r.get("type")]])return-1;for(let[i,n]of Object.entries(activityFilters)){var t=n.limits;if(t[0]>new Function("value","return "+n.transform)(r.get(i))||t[1]<new Function("value","return "+n.transform)(r.get(i)))return-1}return 0}function trackStyleUnselected(r){return trackStyle(colorMap[r.get("type")],featureVisible(r))}function trackStyleSelected(r){return trackStyle(colorMap[r.get("type")],1)}document.getElementById("layer-switcher").style.top=document.getElementsByClassName("ol-zoom")[0].getBoundingClientRect().bottom+8+"px";document.getElementById("activity-switcher").style.top=document.getElementById("layer-switcher").getBoundingClientRect().bottom+8+"px";Object.entries(activityFilters).forEach(function([r,t]){document.getElementById("activity-filters").innerHTML+=`<div id="${r}-label" class="ol-control filter-label"><button><i class="${t.icon}"></i></button></div><div class="slider-box"><div id="${r}-slider" class="noUiSlider"></div></div>`});Array.from(document.getElementById("activity-switcher").getElementsByTagName("button")).forEach(function(r){r.onclick=function(){shownTracks[r.id]=!shownTracks[r.id],r.classList.toggle("active"),r.style.color=shownTracks[r.id]?sportsCategories[r.id].color:"grey",trackLayer.setStyle(trackStyleUnselected)}});const select=new Select$1({style:trackStyleSelected});map.addInteraction(select);var selectedFeatures=select.getFeatures();const dragBox=new DragBox$1({condition:platformModifierKeyOnly});map.addInteraction(dragBox);dragBox.on("boxend",function(){const r=dragBox.getGeometry().getExtent(),t=trackSource.getFeatures().filter(s=>s.getProperties().geometry==null?!1:s.getProperties().geometry.intersectsExtent(r)&&featureVisible(s)>=0),i=map.getView().getRotation();if(i%(Math.PI/2)!==0){const s=[0,0],o=dragBox.getGeometry().clone();o.rotate(-i,s);const a=o.getExtent();t.forEach(function(l){const h=l.getGeometry().clone();h.rotate(-i,s),h.intersectsExtent(a)&&selectedFeatures.push(l)})}else selectedFeatures.extend(t)});dragBox.on("boxstart",function(){selectedFeatures.clear()});map.on("pointermove",function(r){var t=this.forEachFeatureAtPixel(r.pixel,function(i,n){return!0});t?this.getTargetElement().style.cursor="pointer":this.getTargetElement().style.cursor=""});const infoBox=document.getElementById("info");function tableRow(feature){return`<tr id=${feature.id_} class="${feature.values_.type}">`+Object.entries(tableColumns).map(function([id,column]){return"sort"in column?`<td data-sort='${eval(column.sort)}'>${eval(column.body)}</td>`:`<td>${eval(column.body)}</td>`}).join("")+"</tr>"}selectedFeatures.on(["add","remove"],function(){const r=selectedFeatures.getArray().map(tableRow);r.length>0?infoBox.innerHTML=`<thead>
    <tr>${Object.entries(tableColumns).map(function([t,i]){return`<th>${i.title}</th>`}).join("")}</tr>
    </thead><tbody>`+r.join(`
`)+"</tbody>":infoBox.innerHTML="",selectedFeatures.getArray().forEach(function(t){document.getElementById(t.id_).addEventListener("mouseover",function(){t.setStyle(trackStyle(colorMap[t.values_.type],2))}),document.getElementById(t.id_).addEventListener("mouseout",function(){t.setStyle(trackStyle(colorMap[t.values_.type],1))})})});
//# sourceMappingURL=index-1f1dec54.js.map
